function bandwidthTestAppletEventHandler(bandwidthTestApplet,event,data){if("BandwidthTestAppletInited"==event){if(null==bandwidthTestApplet)return!1;Util.Network.AppletBandWidthTester.bandwidthTestApplet=bandwidthTestApplet,Util.Network.AppletBandWidthTester.sectionDiagnosticsObject.setAppletSpeedTestClickHandler()}else if("AppletSpeedTestMeasurementsReady"==event){var downloadMeasurements=parseFloat(data[0]),uploadMeasurements=parseFloat(data[1]),callbackFn=Util.Network.AppletBandWidthTester.currentRunConfig.onSuccessCallbackFn,callbackContext=Util.Network.AppletBandWidthTester.currentRunConfig.owner;callbackFn.call(callbackContext,downloadMeasurements,uploadMeasurements)}}function ItemDurationTimer(){}function onglobalkeyevent(evt,type,key,keyCode,charCode){if(!evt.ctrlKey||Util.Browser.supportsModifierKeys()){var shiftKey=evt.shiftKey,ctrlKey=evt.ctrlKey,metaKey=evt.metaKey,altKey=evt.altKey,target=YUE.getTarget(evt),inTextInput=Util.Event.inTextInput(evt),inLoadingDialog=YAHOO.util.Dom.hasClass(document.body,"showingLoading"),inModalDialog=YAHOO.util.Dom.hasClass(document.body,"showingDialog"),keyObj={type:type,key:key,keyCode:keyCode,charCode:charCode,shiftKey:shiftKey,ctrlKey:ctrlKey,altKey:altKey,metaKey:metaKey,target:target};if(KeyManager.onKeyEvent.fire(keyObj),!(evt.ctrlKey&&evt.altKey&&evt.shiftKey&&"F10"==key||Util.Browser.isLinux()&&evt.ctrlKey&&evt.shiftKey&&"Escape"==key)){var stopEvent=function(){YAHOO.util.Event.stopEvent(evt)},isKeySafeForLanguage=function(){if(!inTextInput)return!1;if("object"!=typeof TDS)return!1;if("HAW"==TDS.getLanguage()&&evt.altKey)switch(keyCode){case 65:case 69:case 73:case 79:case 85:case 222:return!0}return!1},isKeyNavigational=function(){return!evt.altKey&&!evt.ctrlKey&&9==evt.keyCode||(!(Util.Event.hasModifier(evt)||13!=keyCode&&32!=keyCode)||(!!((!Util.Event.hasModifier(evt)||evt.shiftKey)&&keyCode>=37&&keyCode<=40)||!!isKeySafeForLanguage()))};if(inLoadingDialog)stopEvent();else if(!inModalDialog||inTextInput){var keyResult;"function"==typeof window.onkeyevent&&(keyResult=window.onkeyevent(evt,type,key,keyCode,charCode,target)),Util.Browser.isChromeOS()&&"keydown"==type&&evt.ctrlKey&&(evt.altKey&&90==evt.keyCode||166==evt.keyCode||167==evt.keyCode)&&(keyResult=KeyEventResult.Stop),keyResult||(keyResult=isKeyNavigational()?KeyEventResult.Allow:KeyEventResult.Ignored),keyResult!==KeyEventResult.Allow&&(keyResult===KeyEventResult.Stop?stopEvent():inTextInput?(Util.Event.hasModifier(evt)||keyResult===KeyEventResult.Matched)&&stopEvent():keyResult!==KeyEventResult.Allow&&stopEvent())}else isKeyNavigational()||stopEvent()}}}function TTSService_Generic(){function convertDeviceStatusToTTStatus(deviceStatus){return"idle"==deviceStatus?TTS.Status.Stopped:"playing"==deviceStatus?TTS.Status.Playing:"unavailable"==deviceStatus?TTS.Status.NotSupported:TTS.Status.Unknown}var that=this;this.status=TTS.Status.Uninitialized,this.browserComponent=null,this.rate=20,this.pitch=20,this.currentVolume=10,this.voicepacks=[],this.currentVoice="",this.pauseEnabled=!Util.Browser.isAndroid()&&!Util.Browser.isIOS(),this.supportsVolumeControl=function(){return Util.Browser.isIOS()&&Util.Browser.getSecureVersion()>3},this.supportsPitchControl=function(){return Util.Browser.isIOS()&&Util.Browser.getSecureVersion()>3},this.supportsRateControl=function(){return Util.Browser.isIOS()&&Util.Browser.getSecureVersion()>3},this.isSupported=function(){return this.status!=TTS.Status.NotSupported},this.subscribe=function(EventManager){},this.loadVoices=function(){this.voicepacks=[];var voices=AIRMobile.tts.getVoices();if(voices)for(var i=0;i<voices.length;i++){var voice=voices[i];voice.language&&this.voicepacks.push(voice.language)}},this.hasVoicepack=function(language){if(0==this.voicepacks.length)return!1;for(var i=0;i<this.voicepacks.length;i++)if(this.voicepacks[i]==language)return!0;return!1},this.load=function(){return this.browserComponent=Util.SecureBrowser.getRunTime(),this.browserComponent.checkTextToSpeechStatus(null,function(){var service=that;return function(statusData){"idle"==statusData.ttsEngineStatus?(service.status=TTS.Status.Stopped,service.loadVoices()):service.status=TTS.Status.NotSupported,TTS.Manager.Events.onServiceLoad.fire()}}()),this.browserComponent.listen(this.browserComponent.EVENT_TTS_CHANGED,document,function(){var service=that,deviceStatus=service.browserComponent.device.ttsEngineStatus;service.status=convertDeviceStatusToTTStatus(deviceStatus)}),!0},this.getStatus=function(){return this.status},this.subscribe=function(EventManager){try{if(!EventManager)return;this.eM=EventManager,this.browserComponent.listen(this.browserComponent.EVENT_TTS_SYNCHRONIZED,document,function(result){service=that,result&&result.data&&service.eM.fire({index:result.data.location,length:result.data.length})})}catch(e){console.error("Failed to subscribe to EventManager MSB tts events",e)}},this.play=function(text){try{var options={language:this.currentVoice};null==this.browserComponent.tts.getVoices()&&(options=null),this.browserComponent.tts.speak(text,options,function(){var service=that;service.status=convertDeviceStatusToTTStatus(service.browserComponent.device.ttsEngineStatus)})}catch(ex){return this.status=TTS.Status.Unknown,!1}return!0},this.pause=function(){if(this.pauseEnabled)return this.browserComponent.tts.pause(),this.status=TTS.Status.Paused,!0;this.stop()},this.resume=function(){return!!this.pauseEnabled&&(this.browserComponent.tts.resume(),this.status=TTS.Status.Playing,!0)},this.stop=function(){try{this.browserComponent.tts.stop(null,function(){var service=that;return function(data){service.status=convertDeviceStatusToTTStatus(data.ttsEngineStatus)}}())}catch(ex){return this.status=TTS.Status.Stopped,!1}return!0},this.getVolume=function(){return Math.min(this.browserComponent.tts.getVolume(),10)},this.setVolume=function(level){return"number"==typeof level&&(!(level<0||level>10)&&(this.getVolume()!=level&&(this.browserComponent.tts.setVolume(level),!0)))},this.getPitch=function(){return Math.min(this.browserComponent.tts.getPitch(),20)},this.setPitch=function(level){return"number"==typeof level&&(!(level<0||level>20)&&(this.getPitch()!=level&&(this.browserComponent.tts.setPitch(level),!0)))},this.getRate=function(){return Math.min(this.browserComponent.tts.getRate(),20)},this.setRate=function(level){return"number"==typeof level&&(!(level<0||level>20)&&(this.getRate()!=level&&(this.browserComponent.tts.setRate(level),!0)))},this.getVoices=function(){return 0==this.voicepacks.length?["eng"]:this.voicepacks},this.getVoice=function(){return this.currentVoice},this.setVoice=function(voice){return this.currentVoice=voice,!0}}function TTSService_SB(){this.runtime=null,this.wordBoundaryRegex=new RegExp(/<[^>]+>|[\s,.;]+|[^<^ ]+/g),this.isSpeakable=new RegExp(/[A-Za-z0-9_]+/),this.BOOKMARK_TAG='<bookmark mark="start"/> ',this.bookmarks=[],this.supportsVolumeControl=function(){return!0},this.supportsPitchControl=function(){return!0},this.supportsRateControl=function(){return!0},this.isSupported=function(){var components=Mozilla.enableComponents();return!!components&&components.classes["@mozilla.org/securebrowser;1"]},this.load=function(){try{return!!this.isSupported()&&(Mozilla.execPrivileged(function(){var sbClass=Components.classes["@mozilla.org/securebrowser;1"];sbClass&&(this.runtime=sbClass.createInstance(Components.interfaces.mozISecureBrowser))}.bind(this))||console.log("SB runtime component failed to load"),!!this.runtime&&(YUE.on(window,"beforeunload",this.dispose.bind(this)),this.runtime.initialize(),this.osHacks(),setTimeout(function(){TTS.Manager.Events.onServiceLoad.fire()},0),!0))}catch(ex){return!1}},this.dispose=function(){console.log("Disposing TTS Runtime..."),null!=this.runtime&&(delete this.runtime,this.runtime=null)},this.osHacks=function(){this.pluginWordBoundaryFunction=null,Util.Browser.isLinux()?this.pluginWordBoundaryFunction=null:Util.Browser.isWindows()&&Util.Browser.getSecureVersion()>=6.4?this.pluginWordBoundaryFunction="SPEI_WORD_BOUNDARY":Util.Browser.isWindows()?this.pluginWordBoundaryFunction="SPEI_TTS_BOOKMARK":Util.Browser.isMac()&&(this.pluginWordBoundaryFunction="soWordCallBack")},this.subscribe=function(EventManager){try{if(!EventManager)return;this.unregisterAll(),this.eM=EventManager,Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService).addObserver(this,"sb-word-speak",!1),this.runtime.initializeListener(this.pluginWordBoundaryFunction)}catch(e){console.error("Failed to subscribe to EventManager firefox tts events",e)}},this.unregisterAll=function(){try{for(var os=Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService),deadButNotTruly=os.enumerateObservers("sb-word-speak");deadButNotTruly.hasMoreElements();)os.removeObserver(deadButNotTruly.getNext(),"sb-word-speak")}catch(e){console.error("Remove listeners that may actually be listening.",e)}},this.unregister=function(ref){Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService).removeObserver(ref||this,"sb-word-speak",!1)},this.observe=function(subject,topic,data){if("sb-word-speak"==topic&&this.eM){if("SPEI_TTS_BOOKMARK"==this.pluginWordBoundaryFunction){var syncpoint=this.bookmarks.shift();if(!syncpoint||syncpoint.indexOf("-1")>0)return;data=syncpoint}for(var dataArray=data.split(","),parsedData={},i=0;i<dataArray.length;i++){var dataField=dataArray[i].split(":");parsedData[dataField[0]]=parseInt(dataField[1])}var index=parsedData.WordStart?parsedData.WordStart:null;this.eM.fire({subject:subject,topic:topic,data:data,index:index})}},this.getStatus=function(){if(this.runtime){var currentStatus=this.runtime.status;if("Stopped"==currentStatus)return TTS.Status.Stopped;if("Playing"==currentStatus)return TTS.Status.Playing;if("Paused"==currentStatus)return TTS.Status.Paused;if(null==currentStatus||""==currentStatus)return TTS.Status.Unknown}return TTS.Status.Uninitialized},this.play=function(text){return!!this.runtime&&("SPEI_TTS_BOOKMARK"==this.pluginWordBoundaryFunction&&(text=this._injectSyncTags(text)),this.runtime.play(text),!0)},this.pause=function(){return!!this.runtime&&(this.runtime.pause(),!0)},this.resume=function(){return!!this.runtime&&(this.runtime.resume(),!0)},this.stop=function(){return!!this.runtime&&(this.runtime.stop(),!0)},this.getVolume=function(){return this.runtime?Math.min(this.runtime.volume,10):-1},this.setVolume=function(level){return!!this.runtime&&("number"==typeof level&&(!(level<0||level>10)&&(this.runtime.volume!=level&&(this.runtime.volume=level,!0))))},this.getPitch=function(){return this.runtime?Math.min(this.runtime.pitch,20):-1},this.setPitch=function(level){if(!this.runtime)return!1;if("number"!=typeof level)return!1;if(level<0||level>20)return!1;var oldPitch=this.runtime.pitch;return this.runtime.pitch=level,oldPitch!=level},this.getRate=function(){return this.runtime?Math.min(this.runtime.rate,20):-1},this.setRate=function(level){if(!this.runtime)return!1;if("number"!=typeof level)return!1;if(level<0||level>20)return!1;var oldRate=this.runtime.rate;return this.runtime.rate=level,oldRate!=level},this.getVoices=function(){if(!this.runtime)return null;var voicesData=this.runtime.voices;return null==voicesData||0==voicesData.length?[]:voicesData.split(",")},this.getVoice=function(){return this.runtime?this.runtime.voiceName:null},this.setVoice=function(voice){return!!this.runtime&&(this.runtime.voiceName=voice,!0)},this._injectSyncTags=function(inputText){var text=0==inputText.indexOf(this.BOOKMARK_TAG)?inputText.substring(this.BOOKMARK_TAG.length):inputText;this.bookmarks=[];for(var pos=this.BOOKMARK_TAG.length,matches=text.match(this.wordBoundaryRegex),newText="",i=0;null!=matches&&i<matches.length;i++){var match=matches[i];match.trim().length>0&&match.indexOf("<")<0&&this.isSpeakable.test(match)&&(newText+=this.BOOKMARK_TAG,this.bookmarks.push("WordStart:"+pos+", WordLength:"+match.length)),pos+=match.length,newText+=match}return this.BOOKMARK_TAG+newText}}function TTSService_Certified(){this.browserComponent=null,this.rate=20,this.pitch=20,this.currentVolume=10,this.voicepacks=[],this.currentVoice="",this.pauseEnabled=!0,this.supportsVolumeControl=function(){return!1},this.supportsPitchControl=function(){return!1},this.supportsRateControl=function(){return!1},this.isSupported=function(){return this.getStatus()!=TTS.Status.NotSupported},this.subscribe=function(EventManager){},this.loadVoices=function(){this.voicepacks=[];var voices=browser.tts.getVoices();if(voices)for(var i=0;i<voices.length;i++){var voice=voices[i];this.voicepacks.push(voice)}},this.hasVoicepack=function(language){if(0==this.voicepacks.length)return!1;for(var i=0;i<this.voicepacks.length;i++)if(this.voicepacks[i]==language)return!0;return!1},this.load=function(){return this.getStatus()==TTS.Status.Stopped&&this.loadVoices(),TTS.Manager.Events.onServiceLoad.fire(),!0},this.getStatus=function(){if(browser&&browser.tts&&browser.tts.getStatus&&"function"==typeof browser.tts.getStatus){var currentStatus=browser.tts.getStatus();if(console.log("TTS certified.js currentStatus = "+currentStatus),"IDLE"==currentStatus)return TTS.Status.Stopped;if("SPEAKING"==currentStatus)return TTS.Status.Playing;if("UNAVAILABLE"==currentStatus)return TTS.Status.NotSupported;if(null==currentStatus||""==currentStatus)return TTS.Status.Unknown}return TTS.Status.Uninitialized},this.subscribe=function(EventManager){try{if(!EventManager)return;this.eM=EventManager}catch(e){console.error("Failed to subscribe to EventManager MSB tts events",e)}},this.play=function(text){try{var options={voicename:this.currentVoice,volume:1,pitch:1,rate:1};null==browser.tts.getVoices()&&(options=null),browser.tts.speak(text,options,this.getStatus)}catch(ex){return!1}return!0},this.pause=function(){if(this.pauseEnabled)return browser.tts.pause(),!0;this.stop()},this.resume=function(){return!!this.pauseEnabled&&(browser.tts.resume(),!0)},this.stop=function(){try{browser.tts.stop()}catch(ex){return!1}return!0},this.getVolume=function(){return this.currentVolume},this.setVolume=function(level){return this.currentVolume=level,!0},this.getPitch=function(){return this.pitch},this.setPitch=function(level){return this.pitch=level,!0},this.getRate=function(){return this.rate},this.setRate=function(level){return this.rate=level,!0},this.getVoices=function(){return console.log("certified.js, line 225 - voicepacks.length: "+this.voicepacks.length),0==this.voicepacks.length?["eng"]:this.voicepacks},this.getVoice=function(){return console.log("certified.js, line 235 - currentVoice: "+this.currentVoice),this.currentVoice},this.setVoice=function(voice){return this.currentVoice=voice,!0}}function TTSService_Chrome(){this.runtime=null,this.voices=[],this.status=TTS.Status.unknown,this.currentVoice="",this.volume=10,this.rate=10,this.pitch=10,this.supportsVolumeControl=function(){return!0},this.supportsPitchControl=function(){return!0},this.supportsRateControl=function(){return!0},this.isSupported=function(){return Util.Browser.isChrome()},this.load=function(){if(!this.isSupported())return!1;var thisObj=this;this.status=TTS.Status.Initializing,window.addEventListener("message",function(event){try{if(event.data.type&&"CHROME RESPONSE"==event.data.type&&"OK"==event.data.status)switch(event.data.command){case"TTS INIT":thisObj.status==TTS.Status.Initializing&&(thisObj.voices=event.data.result.split(","),thisObj.status=TTS.Status.Stopped,setTimeout(function(){TTS.Manager.Events.onServiceLoad.fire()},2));break;case"TTS STATUS":thisObj.status=event.data.result,thisObj.status==TTS.Status.Playing&&(clearTimeout(thisObj.showingProgress),TTS.Manager.Events.onHideProgress.fire());break;case"TTS WORD":thisObj.EventManager&&thisObj.EventManager.fire({subject:"TTS WORD",index:event.data.result})}}catch(e){console.error("Failed to add a message listener.",e)}},!1);var nativeInit=function(){this.status==TTS.Status.Initializing?TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"TTS INIT",params:""},"*"):timer&&clearInterval(timer)};nativeInit();var timer=setInterval(nativeInit.bind(this),1e3);return!0},this.subscribe=function(EventManager){this.EventManager=EventManager},this.getStatus=function(){if(this.status==TTS.Status.Initializing)return this.status;var params={type:"CHROME COMMAND",command:"TTS STATUS",params:""};return TDS.AppWindow.postMessage(params,"*"),this.status},this.play=function(text){console.log("We never actually get to the play?.",text,this.currentVoice);var param=[text,{rate:this.rate/10*1,voiceName:this.currentVoice,lang:this._extractLangCode(this.currentVoice),pitch:this.pitch/10*1,volume:this.volume/10*1}];return TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"TTS SPEAK",params:param},"*"),Util.Browser.isChromeOS()&&(Util.Browser.getChromeVersion()<34?this.status=TTS.Status.Playing:this.EventManager&&this.EventManager.fire({subject:"TTS WORD",index:0})),clearTimeout(this.showingProgress),this.showingProgress=setTimeout(function(){TTS.Manager.Events.onShowProgress.fire(Messages.getAlt("TDSTTS.Label.TTSwait","Waiting for Text-to-Speech"))},1e3),!0},this.pause=function(){return TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"TTS PAUSE",params:""},"*"),!0},this.resume=function(){return TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"TTS RESUME",params:""},"*"),!0},this.stop=function(){return TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"TTS STOP",params:""},"*"),!0},this.getVolume=function(){return this.volume},this.setVolume=function(level){return this.volume=level,!0},this.getPitch=function(){return this.pitch},this.setPitch=function(level){return this.pitch=level,!0},this.getRate=function(){return this.rate},this.setRate=function(level){return this.rate=level,!0},this.getVoices=function(){return this.voices},this.getVoice=function(){return this.currentVoice},this.setVoice=function(voice){return this.currentVoice=voice,!0},this._extractLangCode=function(voiceName){return voiceName&&"native"==voiceName?"":voiceName&&voiceName.indexOf("Spanish")>=0?"es-ES":"en-US"}}function tdsItemResource(name,bankKey,itemKey){if(TDS.ToolManager.hideAll(),ContentManager.Dialog.isShowing())ContentManager.Dialog.hide();else{var id=name+"_"+bankKey+"_"+itemKey;ContentManager.Dialog.show(id,bankKey,itemKey)}}function MozSpellChecker(language){this._lang=language.length>2?language.substr(0,2):language,this._spellCheckEngine=null,this._dictionaryLoaded=!1,this._init=function(){try{if("object"!=typeof Components)return void(this._spellCheckEngine=null);this._spellCheckEngine=Components.classes["@mozilla.org/spellchecker/engine;1"].createInstance(Components.interfaces.mozISpellCheckingEngine)}catch(ex){this._spellCheckEngine=null}},this._findDictionary=function(lang){if(null!=this._spellCheckEngine&&null!=lang){var dictList=new Array,dictListLength=new Object;this._spellCheckEngine.getDictionaryList(dictList,dictListLength);for(d=0;d<dictListLength.value;d++)if(dictList.value[d]==lang)return dictList.value[d];var shortLang;shortLang=lang.indexOf("-")>-1?lang.substring(0,lang.indexOf("-")):lang;for(var d=0;d<dictListLength.value;d++){if((dictList.value[d].indexOf("-")>-1?dictList.value[d].substring(0,dictList.value[d].indexOf("-")):dictList.value[d])==shortLang)return dictList.value[d]}}return null},this._load=function(){this._init();var dict=this._findDictionary(this._lang);return null!=dict&&null!=this._spellCheckEngine&&(this._spellCheckEngine.dictionary=dict,this._dictionaryLoaded=!0,!0)},this.availableForUse=function(){return this._dictionaryLoaded},this.checkSpelling=function(wordList,provideSuggestions){var errors=new Array,numErrors=0,len=null!=wordList?wordList.length:0;if(this._dictionaryLoaded){"SUCCESS";for(var i=0;i<len;i++){var word=wordList[i];if(0,!this._spellCheckEngine.check(word)){var suggestions={};provideSuggestions&&this._spellCheckEngine.suggest(word,suggestions,{}),errors[numErrors]={word:word,suggestions:suggestions.value},numErrors++}}}return errors},this._load()}function WritingUnit(divUnit){this.onOpenEdit=new YAHOO.util.CustomEvent("onOpenEdit",this,!1,YAHOO.util.CustomEvent.FLAT),this.onCloseEdit=new YAHOO.util.CustomEvent("onCloseEdit",this,!1,YAHOO.util.CustomEvent.FLAT),this.item=null,this.position=1*divUnit.id.split("_")[1],this.divPrompt=YUD.getElementsByClassName("prompt","div",divUnit)[0],this.divContent=YUD.getElementsByClassName("promptContent","span",this.divPrompt)[0],this.linkSelect=YUD.getElementsByClassName("addMark","span",divUnit)[0],this.linkExpandPrompt=YUD.getElementsByClassName("expandPrompt","a",divUnit)[0];var unitDoc=divUnit.ownerDocument;this.divComment=unitDoc.getElementById("Item_CommentBox_"+this.position),this.textComment=unitDoc.getElementById("Item_Comment_"+this.position),this.hiddenChanged=unitDoc.getElementById("Item_Changed_"+this.position),this.hiddenSelected=unitDoc.getElementById("Item_Selected_"+this.position),this.textResponse=unitDoc.getElementById("Item_Response_CR_"+this.position),this.checkMark=unitDoc.getElementById("Item_Mark_"+this.position),this.isExpanded=function(){return YUD.hasClass(this.divPrompt,"openedPrompt")},this.expand=function(){return YUD.addClass(this.divPrompt,"openedPrompt")},this.collapse=function(){return YUD.removeClass(this.divPrompt,"openedPrompt")},this.toggleExpand=function(){this.isExpanded()?this.collapse():this.expand()},this.isSelected=function(){return"TRUE"==this.hiddenSelected.value.toUpperCase()},this.getValue=function(){return this.textResponse.value},this.hasChanges=function(){return"TRUE"==this.hiddenChanged.value.toUpperCase()},this.select=function(){YUD.addClass(divUnit,"selectedPrompt"),this.hiddenSelected.value=!0},this.deselect=function(){YUD.removeClass(divUnit,"selectedPrompt"),this.hiddenSelected.value=!1}}function WritingLayout(divLayout){this.units=[],this.divBigTable=YUD.getFirstChild(divLayout),this.linkStart=YUD.getElementsByClassName("writeNow","a",divLayout)[0],this.linksChangePrompt=YUD.getElementsByClassName("changePrompt","a",divLayout),this.linkExpandAll=YUD.getElementsByClassName("expandAll","a",divLayout)[0],this.isEditing=function(){return YUD.hasClass(this.divBigTable,"nowWrite")},this.enableEditing=function(){var selectedUnit=this.getSelectedUnit();return null!=selectedUnit&&(YUD.addClass(this.divBigTable,"nowWrite"),selectedUnit.item&&selectedUnit.item.editor&&selectedUnit.item.editor.contentLoaded&&(selectedUnit.item.editor.show(),selectedUnit.item.editor.hide(),selectedUnit.item.editor.show(),ContentManager.focus(window),ContentManager.focus(divLayout)),selectedUnit.onOpenEdit.fire(),!0)},this.disableEditing=function(){var selectedUnit=this.getSelectedUnit();null!=selectedUnit&&(selectedUnit.item&&selectedUnit.item.editor&&selectedUnit.item.editor.spell&&selectedUnit.item.editor.spell.destroy(),"block"==YUD.getStyle(selectedUnit.divComment,"display")&&YUD.setStyle(selectedUnit.divComment,"display","none")),YUD.removeClass(this.divBigTable,"nowWrite"),selectedUnit.onCloseEdit.fire()},this.toggleEdit=function(){if(!this.checkForErrors("toggleEdit"))if(this.isEditing()){if(this.getSelectedUnit().item.isReadOnly())return;if(YUD.hasClass(document.body,"dialogPromptShow"))return;var self=this,closeEdit=function(){self.disableEditing(),TTS.getInstance().stop(),ContentManager.Menu.hide()};window.TestShell?TestShell.UI.showWarningPrompt("TDSWritingJS.Label.ChangePassage",{yes:closeEdit}):closeEdit()}else this.enableEditing(),TTS.getInstance().stop(),ContentManager.Menu.hide()},this.isExpandAll=function(){return YUD.hasClass(this.linkExpandAll,"collapse")},this.toggleExpandAll=function(){if(!this.isEditing()){for(var i=0;i<this.units.length;i++)this.isExpandAll()?this.units[i].collapse():this.units[i].expand();this.isExpandAll()?YUD.removeClass(this.linkExpandAll,"collapse"):YUD.addClass(this.linkExpandAll,"collapse")}},this.selectUnit=function(unit){YUD.removeClass(this.linkStart,"inactive");var selectedUnit=this.getSelectedUnit();if(null!=selectedUnit){if(selectedUnit==unit)return void(this.isEditing()&&selectedUnit.toggleExpand());selectedUnit.deselect()}unit.select(),this.checkForErrors("selectUnit")},this.getSelectedUnit=function(){for(var i=0;i<this.units.length;i++)if(this.units[i].isSelected())return this.units[i];return null},this.checkForErrors=function(stack){stack=null==stack?"":stack;for(var selectedUnits=[],i=0;i<this.units.length;i++){var unit=this.units[i];unit.isSelected()&&selectedUnits.push(unit)}if(selectedUnits.length>1){for(i=0;i<selectedUnits.length;i++)selectedUnits[i].deselect(),selectedUnits[i].hiddenChanged.value=!0;return this.isEditing()&&this.disableEditing(),!0}return!1},YUE.addListener(this.linkStart,"click",this.toggleEdit,this,!0),YUE.addListener(this.linksChangePrompt,"click",this.toggleEdit,this,!0),YUE.addListener(this.linkExpandAll,"click",this.toggleExpandAll,this,!0)}function CRTool(grid,mode){this.grid=grid,this._selectedBackgroundImage=null,this.mode=mode||CRToolMode.Test,this.resetCRToolData(),this.grid.showCoordinates=!0}function removeChildren(id){for(var crtoolNode=this.grid.view.getElementById(id),len=crtoolNode.childNodes.length,centerIDs=[],i=0;i<len;i++)centerIDs.push(crtoolNode.childNodes[i].id);for(var j=0;j<len;j++)this.grid.view.removeElement(centerIDs[j])}function Point2D(x,y){arguments.length>0&&(this.x=x,this.y=y)}function Intersection(status){arguments.length>0&&this.init(status)}function createLine(x1,y1,x2,y2){var line=document.createElement("a");return YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9?line.className="line ieline":line.className="line",updateLine(line,x1,y1,x2,y2),line}function updateLine(line,x1,y1,x2,y2){if(x2<x1){var temp=x1;x1=x2,x2=temp,temp=y1,y1=y2,y2=temp}var length=Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));if(line.style.width=length+"px",YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9){line.style.top=y2>y1?y1+"px":y2+"px",line.style.left=x1+"px";var nCos=(x2-x1)/length,nSin=(y2-y1)/length;line.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+nCos+", M12="+-1*nSin+", M21="+nSin+", M22="+nCos+")"}else{var angle=Math.atan((y2-y1)/(x2-x1));line.style.top=y1+.5*length*Math.sin(angle)+"px",line.style.left=x1-.5*length*(1-Math.cos(angle))+"px";var property=getTransformProperty(line);line.style[property]="rotate("+angle+"rad)"}return line}function getTransformProperty(element){for(var p,properties=["transform","WebkitTransform","msTransform","MozTransform","OTransform"];p=properties.shift();)if(void 0!==element.style[p])return p;return!1}function WordListItem(){var myPageSpans=[],myPageWLWords={current:-1,last:-1,total:0},spanCount=0;this.getSpanCount=function(){return spanCount},this.TagSingleSpan=function(span){var anchor=document.createElement("a");$(anchor).html($(span).html()),$.each(span.attributes,function(i,attrib){$(anchor).attr(attrib.name,attrib.value)}),$(anchor).addClass(WordListItem.ClassNameString);var spanid="word-list-"+WordListItem.CTag;WordListItem.CTag++,$(anchor).attr("id",spanid),$(anchor).attr("tabindex","0"),$(anchor).attr("title","lookup word"),$(anchor).attr("role","button"),YAHOO.util.Event.addListener(anchor,"mouseenter",WordListItem.mouseOver,this),YAHOO.util.Event.addListener(anchor,"mouseleave",WordListItem.mouseOut,this),YAHOO.util.Event.addListener(anchor,"click",WordListItem.clickHandler,this),Accommodations.Manager.getCurrentProps().isStreamlinedMode()&&YAHOO.util.Event.addListener(anchor,"keyup",WordListItem.clickHandler,this),$(span).after(anchor),$(span).remove(),myPageSpans[spanCount]=anchor,++spanCount,myPageWLWords.total=spanCount},this.TagSpans=function(elements){for(var spans=[],tmpSpanCount=0,i=0;i<WordListItem.tagType.length;++i){for(var divs=elements.getElementsByTagName(WordListItem.tagType[i]),j=0;null!=divs&&j<divs.length;++j){var div=divs[j];null!=YUD.getAttribute(div,WordListItem.attributeName)&&(spans[tmpSpanCount]=div,++tmpSpanCount)}for(j=0;j<spans.length;++j)spans[j].setAttribute(WordListItem.groupAttributeName,""+WordListItem.GTag),new Retagger(spans[j]).Retag(),WordListItem.GTag++}var itemKey=this.wl_res.itemKey,baseKey=this.wl_res.bankKey+"-"+this.wl_res.itemKey+"-";WordListPanel.requestQ[itemKey]={},WordListPanel.tagQ[itemKey]||(WordListPanel.tagQ[itemKey]=[]);var self=this;WordListItem.tagType.forEach(function(tagType){null!=(divs=elements.getElementsByTagName(tagType))&&$.each(divs,function(i,div){var index=YUD.getAttribute(div,WordListItem.attributeName);if(null!=index){var key=baseKey+index.toString();WordListPanel.tagQ[itemKey].push({wl_item:self,span:div,key:key}),null==WordListPanel.requestQ[itemKey][key]&&null==WordListPanel.contentWordCache[key]&&(WordListPanel.requestQ[itemKey][key]=index)}})}),WordListPanel.sendRequest(this)},this.ClearSelectedWord=function(){var zo=myPageWLWords;zo&&(zo.last=zo.current,zo.current=-1)},this.HandleKey=function(evt){var isHandled=!1,zo=myPageWLWords,spans=myPageSpans;if("keyup"==evt.type&&!evt.ctrlKey&&null!=zo&&zo.current>=0){var div=spans[zo.current],entry={wl_item:this,span:div};WordListPanel.processClick(entry,this.getGroupHtml(div)),this.AddClassToGroup(div,WordListItem.ClassNameString,WordListItem.ClassNameStringHover),isHandled=!0}if(27==evt.keyCode)return null!=WordListPanel.panel&&WordListPanel.panel.hide(),isHandled;if("keydown"!=evt.type)return isHandled;if(!evt.ctrlKey)return isHandled;if(88!=evt.keyCode)return isHandled;if(isHandled=!0,null!=WordListPanel.panel&&WordListPanel.IsVisible()&&null!=WordListPanel.tabView&&WordListPanel.tabCount>0)return WordListPanel.tabCurrent=(WordListPanel.tabCurrent+1)%WordListPanel.tabCount,WordListPanel.tabView.selectTab(WordListPanel.tabCurrent),isHandled;var spanGroupAttr="";if(null!=zo){if(zo.current>=0&&(spanGroupAttr=YUD.getAttribute(spans[zo.current],WordListItem.groupAttributeName),this.AddClassToGroup(spans[zo.current],WordListItem.ClassNameString,WordListItem.ClassNameStringHover)),-1!=zo.last)zo.current=zo.last;else{for(++zo.current;zo.current<zo.total&&YUD.getAttribute(spans[zo.current],WordListItem.groupAttributeName)==spanGroupAttr;)++zo.current;zo.current==zo.total&&(zo.current=-1)}zo.last=-1,-1!=zo.current&&(this.AddClassToGroup(spans[zo.current],WordListItem.ClassNameStringHover,WordListItem.ClassNameString),ContentManager.log("wordlist: focus span "+zo.current+" out of "+zo.total+" evt is "+evt.type))}return isHandled},this.AddClassToGroup=function(div,classToAdd,classToRemove){for(var groupTag=YAHOO.util.Dom.getAttribute(div,WordListItem.groupAttributeName),j=0;j<myPageSpans.length;++j)YAHOO.util.Dom.getAttribute(myPageSpans[j],WordListItem.groupAttributeName)==groupTag&&(YAHOO.util.Dom.removeClass(myPageSpans[j],classToRemove),YAHOO.util.Dom.addClass(myPageSpans[j],classToAdd))},this.getGroupHtml=function(div){for(var groupTag=YAHOO.util.Dom.getAttribute(div,WordListItem.groupAttributeName),rv="",j=0;j<myPageSpans.length;++j)YAHOO.util.Dom.getAttribute(myPageSpans[j],WordListItem.groupAttributeName)==groupTag&&(rv+=myPageSpans[j].innerHTML);return rv}}function WordListPanel(){}function Retagger(astartElement){var endSibling=null,_startElement=astartElement;this.Retag=function(){debugLog(0,_startElement,"Retagging entry"),RetagSiblings(astartElement,!1,0)};var consumeInners=function(startElement,innerElements,level){if(null!=startElement&&0!=innerElements.length){debugLog(level,startElement,"consumeInners: make sibs children of ");for(var i=0;i<innerElements.length;++i){var newNode=innerElements[i].cloneNode(!0);debugLog(level,newNode,"consumeInners: adding child "),startElement.appendChild(newNode),innerElements[i].parentNode.removeChild(innerElements[i])}}},doesChildContainEnd=function(startElement,peerElement){var child=YUD.getFirstChild(peerElement);if(null==child)return!1;for(;child;){if(isEndElement(startElement,child))return!0;if(doesChildContainEnd(startElement,child))return!0;child=child.nextSibling}return!1},debugLog=function(level,obj,str){if(Retagger.verboseDebug){var props=["outerHTML","nodeType","nodeName","nodeValue"],op="";if("object"==typeof obj&&null!=obj)for(var i=0;i<props.length;++i){var pp=props[i];void 0!=obj[pp]&&null!=obj[pp]&&(op=op+" "+pp+":"+obj[pp])}null!=str&&(op=str+":"+op),console.log("lvl: "+level+" "+op)}},isEndElement=function(startElement,endElementTest){return"end"==YUD.getAttribute(endElementTest,"data-tag-boundary")&&YUD.getAttribute(endElementTest,"data-tag-ref")==YUD.getAttribute(startElement,"id")},RetagSiblings=function(startElement,endFound,level){var isParentElement=!1,innerElements=[];if(null!=startElement){for(var sib=startElement.nextSibling;null!=sib;){if(debugLog(level,sib,"Iterating"),isEndElement(startElement,sib)){debugLog(level,sib,"Found end span in sib"),endSibling=sib;break}if(level>=0&&doesChildContainEnd(startElement,sib)){debugLog(level,sib,"Found end span in child"),isParentElement=!0,endSibling=sib;break}debugLog(level,sib,"Sib neither child nor parent, pushing"),innerElements.push(sib),sib=sib.nextSibling}if(null!=endSibling){if(isParentElement){var newStartElem=startElement.cloneNode(!1),child=endSibling.firstChild;endSibling.insertBefore(newStartElem,child),debugLog(level,newStartElem,"recursively calling retag on child"),RetagSiblings(newStartElem,!0,level+1)}consumeInners(startElement,innerElements,level),isParentElement||(debugLog(level,endSibling,"End tag found at this level, removing."),endSibling.parentNode.removeChild(endSibling))}else if(0==endFound){if(consumeInners(startElement,innerElements,level),null==(sib=startElement.parentNode)||null==sib.parentNode||void 0!=sib.nodeName&&"FORM"==sib.nodeName||"BODY"==sib.nodeName)return void debugLog(level,sib," endtag not found");newStartElem=startElement.cloneNode(!1),sib.parentNode.insertBefore(newStartElem,sib.nextSibling),debugLog(level,sib,"End tag not found, looking in sibling of parent"),RetagSiblings(newStartElem,!1,level-1)}}}}function WordBuilder(keyboardDiv,textfield){this._keyboard=keyboardDiv,this._textfield=textfield,this._keyLinkToValueMap=new Object,this._allowedKeyCodesMap=new Object,this._allowedCharCodesMap=new Object,this._allowedKeyCodesMap[8]="OK",this._allowedKeyCodesMap[9]="OK",this._allowedKeyCodesMap[46]="OK",this._allowedKeyCodesMap[37]="OK",this._allowedKeyCodesMap[38]="OK",this._allowedKeyCodesMap[39]="OK",this._allowedKeyCodesMap[40]="OK",this.activate=function(){this._textfield||(this._textfield=this._getAssociatedTextField());for(var keyContainers=this._keyboard.getElementsByTagName("li"),allowableKeysArray=[],i=0;i<keyContainers.length;i++){var keyValue=this._getText(YAHOO.util.Dom.getElementsByClassName("keyvalue","span",keyContainers[i])[0]),keyLink=keyContainers[i].getElementsByTagName("a")[0],keyDisplay=this._getText(keyLink);allowableKeysArray.push(keyDisplay);YAHOO.util.Event.addListener(keyLink,"click",this._keyboardClick,null,this);this._keyLinkToValueMap[keyLink.id]=keyValue,1==keyDisplay.length&&(this._allowedCharCodesMap[keyDisplay.toUpperCase().charCodeAt()+""]="OK",this._allowedCharCodesMap[keyDisplay.toLowerCase().charCodeAt()+""]="OK"),"space"==keyDisplay.toLowerCase()&&(this._allowedCharCodesMap[32]="OK",this._allowedKeyCodesMap[32]="OK")}var instructions;$(keyboardDiv).hasClass("fullsize")?instructions=Messages.getAlt("WB.Accessible.LetterKeys","Use the letter keys on your keyboard to answer the question."):(instructions=Messages.getAlt("WB.Accessible.AllowableKeys","Use the following keys on your keyboard to answer the question: "),instructions+=allowableKeysArray.join(", ")),this._textfield.setAttribute("aria-label",instructions),this._textfield.setAttribute("aria-required","true"),YAHOO.util.Event.addListener(this._textfield,"keypress",this._keyboardClick2,this,!0)},this._getAssociatedTextField=function(){var containerDiv=YAHOO.util.Dom.getAncestorByClassName(this._keyboard,"itemContainer");return YAHOO.util.Dom.getElementsByClassName("inputCloze","input",containerDiv)[0]},this._getAssociatedStem=function(){var containerDiv=YAHOO.util.Dom.getAncestorByClassName(this._keyboard,"itemContainer");return YAHOO.util.Dom.getElementsByClassName("stemContainer","div",containerDiv)[0]},this._simulate_key=function(type,ctrlKey,altKey,shiftKey,keyCode,charCode){var textFieldValueBeforeKeyPress=this._textfield.value;try{YAHOO.util.UserAction.simulateKeyEvent(this._textfield,type,!0,!0,null,ctrlKey,altKey,shiftKey,!1,keyCode,charCode)}catch(ex){return!1}return this._textfield.value!=textFieldValueBeforeKeyPress},this._keyboardClick=function(event){YAHOO.util.Event.stopEvent(event);var linkClicked=YAHOO.util.Event.getTarget(event),value=this._keyLinkToValueMap[linkClicked.id];ContentManager.isReadOnly()||("delete"==value.toLowerCase()?this._simulate_key("keypress",!1,!1,!1,8,0)||this._deleteFromTextField():(1==parseInt(this._textfield.maxLength)&&(this._textfield.value=""),this._simulate_key("keypress",!1,!1,!1,null,value.charCodeAt())||this._appendToTextField(value)))},this._keyboardClick2=function(key){var charCode=key.charCode;return charCode&&0!=charCode||(charCode=String.fromCharCode(key.keyCode).charCodeAt()),!!(key.ctrlKey||this._allowedCharCodesMap[charCode+""]||0==key.charCode&&this._allowedKeyCodesMap[key.keyCode+""])||(!(!(!key.shiftKey&&190==key.keyCode||110==key.keyCode&&46==charCode)||!this._allowedKeyCodesMap[46])||(YAHOO.util.Event.stopEvent(key),!1))},this._appendToTextField=function(valueToInsert){if(valueToInsert){var cursorPosition=this._getCursorPosition();-1!=parseInt(this._textfield.maxLength)&&this._textfield.value.length>=parseInt(this._textfield.maxLength)?(this._textfield.value=this._textfield.value.substr(0,this._textfield.value.length-1)+valueToInsert,this._setCursorPosition(this._textfield.value.length)):(this._textfield.value=this._textfield.value.substr(0,cursorPosition)+valueToInsert+this._textfield.value.substr(cursorPosition,this._textfield.value.length),cursorPosition==this._textfield.value.length-1?this._setCursorPosition(this._textfield.value.length):this._setCursorPosition(cursorPosition+1))}ContentManager.focus(this._textfield)},this._deleteFromTextField=function(){if(this._textfield.value.length>0){var cursorPosition=this._getCursorPosition();this._textfield.value=this._textfield.value.substr(0,cursorPosition-1)+this._textfield.value.substr(cursorPosition,this._textfield.value.length),cursorPosition-1<this._textfield.value.length&&this._setCursorPosition(cursorPosition-1)}ContentManager.focus(this._textfield)},this._getText=function(element){return element.text?element.text:element.innerText?element.innerText:element.innerHTML},this._getCursorPosition=function(){var CaretPos=0;if(document.selection){this._textfield.focus();var Sel=document.selection.createRange(),SelLength=document.selection.createRange().text.length;Sel.moveStart("character",-this._textfield.value.length),CaretPos=Sel.text.length-SelLength}else(this._textfield.selectionStart||"0"==this._textfield.selectionStart)&&(CaretPos=this._textfield.selectionStart);return CaretPos},this._setCursorPosition=function(pos){if(ContentManager.focus(this._textfield),this._textfield.setSelectionRange)this._textfield.setSelectionRange(pos,pos);else if(this._textfield.createTextRange){var range=this._textfield.createTextRange();range.collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}}}function log(message){try{"object"==typeof top.console&&"function"==typeof top.console.log&&console.log(message)}catch(e){}}function dump(obj){try{"object"==typeof top.console&&"function"==typeof top.console.dir&&console.dir(obj)}catch(e){}}function Calculator(){}function Dictionary(){}function Masking(){}var javaFolder="/Shared/Applets/";if("object"!=typeof blackboxConfig&&(blackboxConfig={}),blackboxConfig.baseUrl="/",blackboxConfig.client="SBAC",blackboxConfig.testShellName="modern",blackboxConfig.testShellHtml='  <div id="topBar">    <a href="#contents" id="skipNav" tabindex="0">Skip navigation</a>    <div id="infoBar" role="banner">    <div id="jumpQuestions">     <label id="jumpLabel" i18n-content="TestShellModern.Label.Items">Items:</label> <select id="ddlNavigation" name="ddlNavigation" aria-labelledby="jumpLabel"></select> <input id="jumpGo" type="button" value="Go" aria-label="Press enter to jump to question" style="display: none;" />    </div>    <h1 id="lblTestName"></h1>    <h2 id="lblStudentName"></h2>    <span class="sessionID"></span>    <div id="smallButtons">     <a href="#" id="btnHelp" aria-haspopup="true">Help</a> <a href="#" id="btnSettings" aria-haspopup="true">Settings</a> <a href="#" id="proctorLogout" aria-hidden="true" style="display: none;">Log      Out</a>    </div>   </div>    <nav id="navigation" role="navigation">   <ul id="studentControls"></ul>   <div id="soundCues"></div>   <ul id="studentTools"></ul>   </nav>  </div>   \x3c!-- alertActive shows the dialog, alertClosed is added after a student dismisses the dialog <div class="alertBar alertActive" role="alertdialog"> <div class="alertBar alertActive alertClosed" role="alertdialog"> --\x3e  <div class="alertBar alertClosed" aria-live="assertive" aria-atomic="true">   <a href="#" class="alertDismiss" role="button" aria-expanded="false"> <span class="alertDismissOpen">Open alerts</span> <span class="alertDismissClose">Close alerts</span>   </a>   <ul class="alertContent" aria-relevant="additions"></ul>  </div>   <div id="contents" role="main">   <div id="reviews"></div>  </div>   <div id="tool-ClosedCaptioning" class="tdsClosedCaptioning" aria-live="polite" aria-label="Captioning for current audio"></div>',blackboxConfig.testShellToolbars={controls:{save:{id:"btnSave",classname:"save",i18n:"TestShell.Link.Save",label:"Save"},back:{id:"btnBack",classname:"back",i18n:"TestShell.Link.Back",label:"Back",inactive:!0},next:{id:"btnNext",classname:"next",i18n:"TestShell.Link.Next",label:"Next",inactive:!0},pause:{id:"btnPause",classname:"pause",i18n:"TestShell.Link.Pause",label:"Pause"},end:{id:"btnEnd",classname:"endTest confirmexitCSS",i18n:"TestShell.Link.EndTest",label:"End Test",inactive:!0},itemscore:{id:"btnItemScore",label:"Item Score",hidden:!0},results:{id:"btnResults",classname:"endTest",i18n:"TestShell.Link.TestResults",label:"Test Results",inactive:!0},fullscreen:{id:"btnFullScreen",classname:"fullscreen",i18n:"TestShell.Link.FullScreen",label:"Full Screen",hidden:!0}},tools:{contextmenu:{id:"btnContext",classname:"openContext"},zoomin:{id:"btnZoomIn",classname:"zoomIn",i18n:"TestShell.Link.ZoomIn",label:"Zoom In"},zoomout:{id:"btnZoomOut",classname:"zoomOut",i18n:"TestShell.Link.ZoomOut",label:"Zoom In"},linereader:{id:"btnLineReader",classname:"lineReader",i18n:"TestShell.Link.LineReader",label:"LineReader"},notes:{id:"btnGlobalNotes",classname:"globalNotes",i18n:"TestShell.Link.GlobalNotes",label:"Notes"},calculator:{id:"btnCalculator",classname:"calculator",i18n:"TestShell.Link.Calculator",label:"Calculator"},formula:{id:"btnFormula",classname:"math",i18n:"TestShell.Link.Formula",label:"Formula"},periodictable:{id:"btnPeriodic",classname:"periodic",i18n:"TestShell.Link.PeriodicTable",label:"Periodic Table"},print:{id:"btnPrint",classname:"printer excludeMenu",i18n:"TestShell.Link.Print",label:"Print"},printpage:{id:"btnPagePrint",classname:"printerPage",i18n:"TestShell.Link.PrintPage",label:"Print Page"},printpractice:{id:"btnPrintPractice",classname:"printerPractice excludeMenu",i18n:"TestShell.Link.PrintPractice",label:"Print"},dictionary:{id:"btnDictionary",classname:"dictionary",i18n:"TestShell.Link.Dictionary",label:"Dictionary",hidden:!0},masking:{id:"btnMask",classname:"maskingtool",i18n:"TestShell.Link.Masking",label:"Masking",hidden:!0},ruler:{id:"btnRuler",classname:"mt_ruler",i18n:"TestShell.Link.Ruler",label:"Ruler",hidden:!0},protractor:{id:"btnProtractor",classname:"mt_protractor",i18n:"TestShell.Link.Protractor",label:"Protractor",hidden:!0},rubric:{id:"btnRubric",classname:"rubric",i18n:"TestShell.Link.Rubric",label:"Rubric",hidden:!0}},toolbars:{modern:{controls:["save","back","next","pause","end","itemscore","results"],tools:["contextmenu","zoomin","zoomout","print","linereader","notes","calculator","formula","periodictable","dictionary","masking","ruler","protractor","rubric"]},universal:{controls:["back","next","save","pause","end","itemscore","results"],tools:["rubric","protractor","ruler","masking","dictionary","periodictable","formula","calculator","notes","linereader","print","printpage","zoomout","zoomin","contextmenu"]}}},blackboxConfig.styles=[],blackboxConfig.scripts=[],function(){if("object"==typeof blackboxConfig){blackboxConfig.container||(blackboxConfig.container="testShell");for(var blackboxStyleTags=[],blackboxScriptTags=[],i=0,ii=blackboxConfig.styles.length;i<ii;i++){var blackboxStyle=blackboxConfig.styles[i];blackboxStyleTags.push(function(src){return'<link type="text/css" media="all" rel="stylesheet" href="{0}" />'.replace("{0}",src)}(blackboxStyle))}for(var i=0,ii=blackboxConfig.scripts.length;i<ii;i++){var blackboxScript=blackboxConfig.scripts[i];blackboxScriptTags.push(function(src){return'<script type="text/javascript" src="{0}"><\/script>'.replace("{0}",src)}(blackboxScript))}document.write(blackboxStyleTags.join("")),document.write(blackboxScriptTags.join(""));var tsTemplateTag=function(id,src){return'<script id="{0}" type="text/html">{1}<\/script>'.replace("{0}",id).replace("{1}",src)}("testShellHtml",blackboxConfig.testShellHtml);document.write(tsTemplateTag)}}(),function(window,undefined){function _has(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function _isUndefined(what){return void 0===what}var TraceKit={},_oldTraceKit=window.TraceKit,_slice=[].slice,UNKNOWN_FUNCTION="?";TraceKit.noConflict=function(){return window.TraceKit=_oldTraceKit,TraceKit},TraceKit.wrap=function(func){return function(){try{return func.apply(this,arguments)}catch(e){throw TraceKit.report(e),e}}},TraceKit.report=function(){function notifyHandlers(stack,windowError){var exception=null;if(!windowError||TraceKit.collectWindowErrors){for(var i in handlers)if(_has(handlers,i))try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}if(exception)throw exception}}function traceKitWindowOnError(message,url,lineNo,columnNo,error){var stack=null;if(error)stack=TraceKit.computeStackTrace(error);else if(lastExceptionStack)TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message),stack=lastExceptionStack,lastExceptionStack=null,lastException=null;else{var location={url:url,line:lineNo,column:columnNo};location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line),location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line),stack={mode:"onerror",message:message,url:document.location.href,stack:[location],useragent:navigator.userAgent}}return notifyHandlers(stack,"from window.onerror"),!!_oldOnerrorHandler&&_oldOnerrorHandler.apply(this,arguments)}function installGlobalHandler(){!0!==_onErrorHandlerInstalled&&(_oldOnerrorHandler=window.onerror,window.onerror=traceKitWindowOnError,_onErrorHandlerInstalled=!0)}function report(ex){var args=_slice.call(arguments,1);if(lastExceptionStack){if(lastException===ex)return;var s=lastExceptionStack;lastExceptionStack=null,lastException=null,notifyHandlers.apply(null,[s,null].concat(args))}var stack=TraceKit.computeStackTrace(ex);throw lastExceptionStack=stack,lastException=ex,window.setTimeout(function(){lastException===ex&&(lastExceptionStack=null,lastException=null,notifyHandlers.apply(null,[stack,null].concat(args)))},stack.incomplete?2e3:0),ex}var _oldOnerrorHandler,_onErrorHandlerInstalled,handlers=[],lastException=null,lastExceptionStack=null;return report.subscribe=function(handler){installGlobalHandler(),handlers.push(handler)},report.unsubscribe=function(handler){for(var i=handlers.length-1;i>=0;--i)handlers[i]===handler&&handlers.splice(i,1)},report}(),TraceKit.computeStackTrace=function(){function loadSource(url){if(!TraceKit.remoteFetching)return"";try{var request=function(){try{return new window.XMLHttpRequest}catch(e){return new window.ActiveXObject("Microsoft.XMLHTTP")}}();return request.open("GET",url,!1),request.send(""),request.responseText}catch(e){return""}}function getSource(url){if("string"!=typeof url)return[];if(!_has(sourceCache,url)){var source="";-1!==url.indexOf(document.domain)&&(source=loadSource(url)),sourceCache[url]=source?source.split("\n"):[]}return sourceCache[url]}function guessFunctionName(url,lineNo){var m,reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line="",source=getSource(url);if(!source.length)return UNKNOWN_FUNCTION;for(var i=0;i<10;++i)if(line=source[lineNo-i]+line,!_isUndefined(line)){if(m=reGuessFunction.exec(line))return m[1];if(m=reFunctionArgNames.exec(line))return m[1]}return UNKNOWN_FUNCTION}function gatherContext(url,line){var source=getSource(url);if(!source.length)return null;var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+TraceKit.linesOfContext%2,start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);line-=1;for(var i=start;i<end;++i)_isUndefined(source[i])||context.push(source[i]);return context.length>0?context:null}function escapeRegExp(text){return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function escapeCodeAsRegExpForMatchingInsideHTML(body){return escapeRegExp(body).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function findSourceInUrls(re,urls){for(var source,m,i=0,j=urls.length;i<j;++i)if((source=getSource(urls[i])).length&&(source=source.join("\n"),m=re.exec(source)))return{url:urls[i],line:source.substring(0,m.index).split("\n").length,column:m.index-source.lastIndexOf("\n",m.index)-1};return null}function findSourceInLine(fragment,url,line){var m,source=getSource(url),re=new RegExp("\\b"+escapeRegExp(fragment)+"\\b");return line-=1,source&&source.length>line&&(m=re.exec(source[line]))?m.index:null}function findSourceByFunctionBody(func){for(var body,re,parts,result,urls=[window.location.href],scripts=document.getElementsByTagName("script"),code=""+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,i=0;i<scripts.length;++i){var script=scripts[i];script.src&&urls.push(script.src)}if(parts=codeRE.exec(code)){var name=parts[1]?"\\s+"+parts[1]:"",args=parts[2].split(",").join("\\s*,\\s*");body=escapeRegExp(parts[3]).replace(/;$/,";?"),re=new RegExp("function"+name+"\\s*\\(\\s*"+args+"\\s*\\)\\s*{\\s*"+body+"\\s*}")}else re=new RegExp(escapeRegExp(code).replace(/\s+/g,"\\s+"));if(result=findSourceInUrls(re,urls))return result;if(parts=eventRE.exec(code)){var event=parts[1];if(body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]),re=new RegExp("on"+event+"=[\\'\"]\\s*"+body+"\\s*[\\'\"]","i"),result=findSourceInUrls(re,urls[0]))return result;if(re=new RegExp(body),result=findSourceInUrls(re,urls))return result}return null}function computeStackTraceFromStackProp(ex){if(!ex.stack)return null;for(var parts,element,chrome=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|http|https):.*?):(\d+)(?::(\d+))?\)?\s*$/i,gecko=/^\s*(\S*)(?:\((.*?)\))?@((?:file|http|https).*?):(\d+)(?::(\d+))?\s*$/i,lines=ex.stack.split("\n"),stack=[],reference=/^(.*) is undefined$/.exec(ex.message),i=0,j=lines.length;i<j;++i){if(parts=gecko.exec(lines[i]))element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):"",line:+parts[4],column:parts[5]?+parts[5]:null};else{if(!(parts=chrome.exec(lines[i])))continue;element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,line:+parts[3],column:parts[4]?+parts[4]:null}}!element.func&&element.line&&(element.func=guessFunctionName(element.url,element.line)),element.line&&(element.context=gatherContext(element.url,element.line)),stack.push(element)}return stack[0]&&(stack[0].line&&!stack[0].column&&reference?stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line):stack[0].column||void 0===ex.columnNumber||(stack[0].column=ex.columnNumber+1)),stack.length?{mode:"stack",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent}:null}function computeStackTraceFromStacktraceProp(ex){for(var parts,testRE=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,lines=ex.stacktrace.split("\n"),stack=[],i=0,j=lines.length;i<j;i+=2)if(parts=testRE.exec(lines[i])){var element={line:+parts[1],column:+parts[2],func:parts[3]||parts[4],args:parts[5]?parts[5].split(","):[],url:parts[6]};if(!element.func&&element.line&&(element.func=guessFunctionName(element.url,element.line)),element.line)try{element.context=gatherContext(element.url,element.line)}catch(exc){}element.context||(element.context=[lines[i+1]]),stack.push(element)}return stack.length?{mode:"stacktrace",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent}:null}function computeStackTraceFromOperaMultiLineMessage(ex){var lines=ex.message.split("\n");if(lines.length<4)return null;var parts,i,len,source,lineRE1=/^\s*Line (\d+) of linked script ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http|https)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=document.getElementsByTagName("script"),inlineScriptBlocks=[];for(i in scripts)_has(scripts,i)&&!scripts[i].src&&inlineScriptBlocks.push(scripts[i]);for(i=2,len=lines.length;i<len;i+=2){var item=null;if(parts=lineRE1.exec(lines[i]))item={url:parts[2],func:parts[3],line:+parts[1]};else if(parts=lineRE2.exec(lines[i])){item={url:parts[3],func:parts[4]};var relativeLine=+parts[1],script=inlineScriptBlocks[parts[2]-1];if(script&&(source=getSource(item.url))){var pos=(source=source.join("\n")).indexOf(script.innerText);pos>=0&&(item.line=relativeLine+source.substring(0,pos).split("\n").length)}}else if(parts=lineRE3.exec(lines[i])){var url=window.location.href.replace(/#.*$/,""),line=parts[1];item={url:url,line:(source=findSourceInUrls(new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[i+1])),[url]))?source.line:line,func:""}}if(item){item.func||(item.func=guessFunctionName(item.url,item.line));var context=gatherContext(item.url,item.line),midline=context?context[Math.floor(context.length/2)]:null;context&&midline.replace(/^\s*/,"")===lines[i+1].replace(/^\s*/,"")?item.context=context:item.context=[lines[i+1]],stack.push(item)}}return stack.length?{mode:"multiline",name:ex.name,message:lines[0],url:document.location.href,stack:stack,useragent:navigator.userAgent}:null}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={url:url,line:lineNo};if(initial.url&&initial.line){stackInfo.incomplete=!1,initial.func||(initial.func=guessFunctionName(initial.url,initial.line)),initial.context||(initial.context=gatherContext(initial.url,initial.line));var reference=/ '([^']+)' /.exec(message);if(reference&&(initial.column=findSourceInLine(reference[1],initial.url,initial.line)),stackInfo.stack.length>0&&stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line)return!1;if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func)return stackInfo.stack[0].line=initial.line,stackInfo.stack[0].context=initial.context,!1}return stackInfo.stack.unshift(initial),stackInfo.partial=!0,!0}return stackInfo.incomplete=!0,!1}function computeStackTraceByWalkingCallerChain(ex,depth){for(var parts,item,source,functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=!1,curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller)if(curr!==computeStackTrace&&curr!==TraceKit.report){if(item={url:null,func:UNKNOWN_FUNCTION,line:null,column:null},curr.name?item.func=curr.name:(parts=functionName.exec(curr.toString()))&&(item.func=parts[1]),source=findSourceByFunctionBody(curr)){item.url=source.url,item.line=source.line,item.func===UNKNOWN_FUNCTION&&(item.func=guessFunctionName(item.url,item.line));var reference=/ '([^']+)' /.exec(ex.message||ex.description);reference&&(item.column=findSourceInLine(reference[1],source.url,source.line))}funcs[""+curr]?recursion=!0:funcs[""+curr]=!0,stack.push(item)}depth&&stack.splice(0,depth);var result={mode:"callers",name:ex.name,message:ex.message,url:document.location.href,stack:stack,useragent:navigator.userAgent};return augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description),result}function computeStackTrace(ex,depth){var stack=null;depth=null==depth?0:+depth;try{if(stack=computeStackTraceFromStacktraceProp(ex))return stack}catch(e){if(debug)throw e}try{if(stack=computeStackTraceFromStackProp(ex))return stack}catch(e){if(debug)throw e}try{if(stack=computeStackTraceFromOperaMultiLineMessage(ex))return stack}catch(e){if(debug)throw e}try{if(stack=computeStackTraceByWalkingCallerChain(ex,depth+1))return stack}catch(e){if(debug)throw e}return{mode:"failed"}}var debug=!1,sourceCache={};return computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement,computeStackTrace.guessFunctionName=guessFunctionName,computeStackTrace.gatherContext=gatherContext,computeStackTrace.ofCaller=function(depth){depth=1+(null==depth?0:+depth);try{throw new Error}catch(ex){return computeStackTrace(ex,depth+1)}},computeStackTrace}(),function(){var _helper=function(fnName){var originalFn=window[fnName];window[fnName]=function(){var args=_slice.call(arguments),originalCallback=args[0];return"function"==typeof originalCallback&&(args[0]=TraceKit.wrap(originalCallback)),originalFn.apply?originalFn.apply(this,args):originalFn(args[0],args[1])}};_helper("setTimeout"),_helper("setInterval")}(),TraceKit.remoteFetching||(TraceKit.remoteFetching=!0),TraceKit.collectWindowErrors||(TraceKit.collectWindowErrors=!0),(!TraceKit.linesOfContext||TraceKit.linesOfContext<1)&&(TraceKit.linesOfContext=11),window.TraceKit=TraceKit}(window),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.PointerEventsPolyfill=factory()}(this,function(){"use strict";function PointerMap(){if(USE_MAP){var m=new Map;return m.pointers=POINTERS_FN,m}this.keys=[],this.values=[]}function Installer(add,remove,changed,binder){this.addCallback=add.bind(binder),this.removeCallback=remove.bind(binder),this.changedCallback=changed.bind(binder),MO&&(this.observer=new MO(this.mutationWatcher.bind(this)))}function shadowSelector(v){return"body /shadow-deep/ "+selector(v)}function selector(v){return'[touch-action="'+v+'"]'}function rule(v){return"{ -ms-touch-action: "+v+"; touch-action: "+v+"; touch-action-delay: none; }"}function assertDown(id){if(!_dispatcher.pointermap.has(id))throw new Error("InvalidPointerId")}var USE_MAP=window.Map&&window.Map.prototype.forEach,POINTERS_FN=function(){return this.size};PointerMap.prototype={set:function(inId,inEvent){var i=this.keys.indexOf(inId);i>-1?this.values[i]=inEvent:(this.keys.push(inId),this.values.push(inEvent))},has:function(inId){return this.keys.indexOf(inId)>-1},delete:function(inId){var i=this.keys.indexOf(inId);i>-1&&(this.keys.splice(i,1),this.values.splice(i,1))},get:function(inId){var i=this.keys.indexOf(inId);return this.values[i]},clear:function(){this.keys.length=0,this.values.length=0},forEach:function(callback,thisArg){this.values.forEach(function(v,i){callback.call(thisArg,v,this.keys[i],this)},this)},pointers:function(){return this.keys.length}};var _pointermap=PointerMap,CLONE_PROPS=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],CLONE_DEFAULTS=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],HAS_SVG_INSTANCE="undefined"!=typeof SVGElementInstance,dispatcher={pointermap:new _pointermap,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(name,source){var s=source,newEvents=s.events;newEvents&&(newEvents.forEach(function(e){s[e]&&(this.eventMap[e]=s[e].bind(s))},this),this.eventSources[name]=s,this.eventSourceList.push(s))},register:function(element){for(var es,l=this.eventSourceList.length,i=0;i<l&&(es=this.eventSourceList[i]);i++)es.register.call(es,element)},unregister:function(element){for(var es,l=this.eventSourceList.length,i=0;i<l&&(es=this.eventSourceList[i]);i++)es.unregister.call(es,element)},contains:function(container,contained){return container.contains(contained)},down:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerdown",inEvent)},move:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointermove",inEvent)},up:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerup",inEvent)},enter:function(inEvent){inEvent.bubbles=!1,this.fireEvent("pointerenter",inEvent)},leave:function(inEvent){inEvent.bubbles=!1,this.fireEvent("pointerleave",inEvent)},over:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerover",inEvent)},out:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerout",inEvent)},cancel:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointercancel",inEvent)},leaveOut:function(event){this.out(event),this.contains(event.target,event.relatedTarget)||this.leave(event)},enterOver:function(event){this.over(event),this.contains(event.target,event.relatedTarget)||this.enter(event)},eventHandler:function(inEvent){if(!inEvent._handledByPE){var type=inEvent.type,fn=this.eventMap&&this.eventMap[type];fn&&fn(inEvent),inEvent._handledByPE=!0}},listen:function(target,events){events.forEach(function(e){this.addEvent(target,e)},this)},unlisten:function(target,events){events.forEach(function(e){this.removeEvent(target,e)},this)},addEvent:function(target,eventName){target.addEventListener(eventName,this.boundHandler)},removeEvent:function(target,eventName){target.removeEventListener(eventName,this.boundHandler)},makeEvent:function(inType,inEvent){this.captureInfo[inEvent.pointerId]&&(inEvent.relatedTarget=null);var e=new PointerEvent(inType,inEvent);return inEvent.preventDefault&&(e.preventDefault=inEvent.preventDefault),e._target=e._target||inEvent.target,e},fireEvent:function(inType,inEvent){var e=this.makeEvent(inType,inEvent);return this.dispatchEvent(e)},cloneEvent:function(inEvent){for(var p,eventCopy=Object.create(null),i=0;i<CLONE_PROPS.length;i++)eventCopy[p=CLONE_PROPS[i]]=inEvent[p]||CLONE_DEFAULTS[i],!HAS_SVG_INSTANCE||"target"!==p&&"relatedTarget"!==p||eventCopy[p]instanceof SVGElementInstance&&(eventCopy[p]=eventCopy[p].correspondingUseElement);return inEvent.preventDefault&&(eventCopy.preventDefault=function(){inEvent.preventDefault()}),eventCopy},getTarget:function(inEvent){return this.captureInfo[inEvent.pointerId]||inEvent._target},setCapture:function(inPointerId,inTarget){this.captureInfo[inPointerId]&&this.releaseCapture(inPointerId),this.captureInfo[inPointerId]=inTarget;var e=document.createEvent("Event");e.initEvent("gotpointercapture",!0,!1),e.pointerId=inPointerId,this.implicitRelease=this.releaseCapture.bind(this,inPointerId),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease),e._target=inTarget,this.asyncDispatchEvent(e)},releaseCapture:function(inPointerId){var t=this.captureInfo[inPointerId];if(t){var e=document.createEvent("Event");e.initEvent("lostpointercapture",!0,!1),e.pointerId=inPointerId,this.captureInfo[inPointerId]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease),e._target=t,this.asyncDispatchEvent(e)}},dispatchEvent:function(inEvent){var t=this.getTarget(inEvent);if(t)return t.dispatchEvent(inEvent)},asyncDispatchEvent:function(inEvent){requestAnimationFrame(this.dispatchEvent.bind(this,inEvent))}};dispatcher.boundHandler=dispatcher.eventHandler.bind(dispatcher);var _dispatcher=dispatcher,targeting={shadow:function(inEl){if(inEl)return inEl.shadowRoot||inEl.webkitShadowRoot},canTarget:function(shadow){return shadow&&Boolean(shadow.elementFromPoint)},targetingShadow:function(inEl){var s=this.shadow(inEl);if(this.canTarget(s))return s},olderShadow:function(shadow){var os=shadow.olderShadowRoot;if(!os){var se=shadow.querySelector("shadow");se&&(os=se.olderShadowRoot)}return os},allShadows:function(element){for(var shadows=[],s=this.shadow(element);s;)shadows.push(s),s=this.olderShadow(s);return shadows},searchRoot:function(inRoot,x,y){if(inRoot){var st,sr,t=inRoot.elementFromPoint(x,y);for(sr=this.targetingShadow(t);sr;){if(st=sr.elementFromPoint(x,y)){var ssr=this.targetingShadow(st);return this.searchRoot(ssr,x,y)||st}sr=this.olderShadow(sr)}return t}},owner:function(element){for(var s=element;s.parentNode;)s=s.parentNode;return s.nodeType!==Node.DOCUMENT_NODE&&s.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(s=document),s},findTarget:function(inEvent){var x=inEvent.clientX,y=inEvent.clientY,s=this.owner(inEvent.target);return s.elementFromPoint(x,y)||(s=document),this.searchRoot(s,x,y)}},forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach),map=Array.prototype.map.call.bind(Array.prototype.map),toArray=Array.prototype.slice.call.bind(Array.prototype.slice),filter=Array.prototype.filter.call.bind(Array.prototype.filter),MO=window.MutationObserver||window.WebKitMutationObserver,OBSERVER_INIT={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};Installer.prototype={watchSubtree:function(target){targeting.canTarget(target)&&this.observer.observe(target,OBSERVER_INIT)},enableOnSubtree:function(target){this.watchSubtree(target),target===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(target)},installNewSubtree:function(target){forEach(this.findElements(target),this.addElement,this)},findElements:function(target){return target.querySelectorAll?target.querySelectorAll("[touch-action]"):[]},removeElement:function(el){this.removeCallback(el)},addElement:function(el){this.addCallback(el)},elementChanged:function(el,oldValue){this.changedCallback(el,oldValue)},concatLists:function(accum,list){return accum.concat(toArray(list))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(n){return n.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(inNodes){var tree=map(inNodes,this.findElements,this);return tree.push(filter(inNodes,this.isElement)),tree.reduce(this.concatLists,[])},mutationWatcher:function(mutations){mutations.forEach(this.mutationHandler,this)},mutationHandler:function(m){"childList"===m.type?(this.flattenMutationTree(m.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(m.removedNodes).forEach(this.removeElement,this)):"attributes"===m.type&&this.elementChanged(m.target,m.oldValue)}};var installer=Installer,MOUSE_PROPS=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],MOUSE_DEFAULTS=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],_PointerEvent=function(inType,inDict){inDict=inDict||Object.create(null);var e=document.createEvent("Event");e.initEvent(inType,inDict.bubbles||!1,inDict.cancelable||!1);for(var p,i=2;i<MOUSE_PROPS.length;i++)e[p=MOUSE_PROPS[i]]=inDict[p]||MOUSE_DEFAULTS[i];e.buttons=inDict.buttons||0;var pressure=0;return pressure=inDict.pressure?inDict.pressure:e.buttons?.5:0,e.x=e.clientX,e.y=e.clientY,e.pointerId=inDict.pointerId||0,e.width=inDict.width||0,e.height=inDict.height||0,e.pressure=pressure,e.tiltX=inDict.tiltX||0,e.tiltY=inDict.tiltY||0,e.pointerType=inDict.pointerType||"",e.hwTimestamp=inDict.hwTimestamp||0,e.isPrimary=inDict.isPrimary||!1,e},attrib2css=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],styles="",hasNativePE=window.PointerEvent||window.MSPointerEvent,hasShadowRoot=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,mouse__pointermap=_dispatcher.pointermap,WHICH_TO_BUTTONS=[0,1,4,2],HAS_BUTTONS=!1;try{HAS_BUTTONS=1===new MouseEvent("test",{buttons:1}).buttons}catch(e){}var INSTALLER,mouse={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(target){_dispatcher.listen(target,this.events)},unregister:function(target){_dispatcher.unlisten(target,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(inEvent){for(var t,lts=this.lastTouches,x=inEvent.clientX,y=inEvent.clientY,i=0,l=lts.length;i<l&&(t=lts[i]);i++){var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=25&&dy<=25)return!0}},prepareEvent:function(inEvent){var e=_dispatcher.cloneEvent(inEvent),pd=e.preventDefault;return e.preventDefault=function(){inEvent.preventDefault(),pd()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,HAS_BUTTONS||(e.buttons=WHICH_TO_BUTTONS[e.which]||0),e},mousedown:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){mouse__pointermap.has(this.POINTER_ID)&&this.cancel(inEvent);var e=this.prepareEvent(inEvent);mouse__pointermap.set(this.POINTER_ID,inEvent),_dispatcher.down(e)}},mousemove:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);_dispatcher.move(e)}},mouseup:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var p=mouse__pointermap.get(this.POINTER_ID);if(p&&p.button===inEvent.button){var e=this.prepareEvent(inEvent);_dispatcher.up(e),this.cleanupMouse()}}},mouseover:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);_dispatcher.enterOver(e)}},mouseout:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);_dispatcher.leaveOut(e)}},cancel:function(inEvent){var e=this.prepareEvent(inEvent);_dispatcher.cancel(e),this.cleanupMouse()},cleanupMouse:function(){mouse__pointermap.delete(this.POINTER_ID)}},captureInfo=_dispatcher.captureInfo,findTarget=targeting.findTarget.bind(targeting),allShadows=targeting.allShadows.bind(targeting),touch__pointermap=_dispatcher.pointermap,touchEvents={events:["touchstart","touchmove","touchend","touchcancel"],register:function(target){INSTALLER.enableOnSubtree(target)},unregister:function(target){},elementAdded:function(el){var a=el.getAttribute("touch-action"),st=this.touchActionToScrollType(a);st&&(el._scrollType=st,_dispatcher.listen(el,this.events),allShadows(el).forEach(function(s){s._scrollType=st,_dispatcher.listen(s,this.events)},this))},elementRemoved:function(el){el._scrollType=void 0,_dispatcher.unlisten(el,this.events),allShadows(el).forEach(function(s){s._scrollType=void 0,_dispatcher.unlisten(s,this.events)},this)},elementChanged:function(el,oldValue){var a=el.getAttribute("touch-action"),st=this.touchActionToScrollType(a),oldSt=this.touchActionToScrollType(oldValue);st&&oldSt?(el._scrollType=st,allShadows(el).forEach(function(s){s._scrollType=st},this)):oldSt?this.elementRemoved(el):st&&this.elementAdded(el)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(touchAction){var t=touchAction,st=this.scrollTypes;return"none"===t?"none":t===st.XSCROLLER?"X":t===st.YSCROLLER?"Y":st.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(inTouch){return this.firstTouch===inTouch.identifier},setPrimaryTouch:function(inTouch){(0===touch__pointermap.pointers()||1===touch__pointermap.pointers()&&touch__pointermap.has(1))&&(this.firstTouch=inTouch.identifier,this.firstXY={X:inTouch.clientX,Y:inTouch.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(inPointer){inPointer.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var fn=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(fn,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(type){var ret=0;return"touchstart"!==type&&"touchmove"!==type||(ret=1),ret},touchToPointer:function(inTouch){var cte=this.currentTouchEvent,e=_dispatcher.cloneEvent(inTouch),id=e.pointerId=inTouch.identifier+2;e.target=captureInfo[id]||findTarget(e),e.bubbles=!0,e.cancelable=!0,e.detail=this.clickCount,e.button=0,e.buttons=this.typeToButtons(cte.type),e.width=inTouch.webkitRadiusX||inTouch.radiusX||0,e.height=inTouch.webkitRadiusY||inTouch.radiusY||0,e.pressure=inTouch.webkitForce||inTouch.force||.5,e.isPrimary=this.isPrimaryTouch(inTouch),e.pointerType=this.POINTER_TYPE;var self=this;return e.preventDefault=function(){self.scrolling=!1,self.firstXY=null,cte.preventDefault()},e},processTouches:function(inEvent,inFunction){var tl=inEvent.changedTouches;this.currentTouchEvent=inEvent;for(var t,i=0;i<tl.length;i++)t=tl[i],inFunction.call(this,this.touchToPointer(t))},shouldScroll:function(inEvent){if(this.firstXY){var ret,scrollAxis=inEvent.currentTarget._scrollType;if("none"===scrollAxis)ret=!1;else if("XY"===scrollAxis)ret=!0;else{var t=inEvent.changedTouches[0],a=scrollAxis,oa="Y"===scrollAxis?"X":"Y";ret=Math.abs(t["client"+a]-this.firstXY[a])>=Math.abs(t["client"+oa]-this.firstXY[oa])}return this.firstXY=null,ret}},findTouch:function(inTL,inId){for(var t,i=0,l=inTL.length;i<l&&(t=inTL[i]);i++)if(t.identifier===inId)return!0},vacuumTouches:function(inEvent){var tl=inEvent.touches;if(touch__pointermap.pointers()>=tl.length){var d=[];touch__pointermap.forEach(function(value,key){if(1!==key&&!this.findTouch(tl,key-2)){var p=value.out;d.push(p)}},this),d.forEach(this.cancelOut,this)}},touchstart:function(inEvent){this.vacuumTouches(inEvent),this.setPrimaryTouch(inEvent.changedTouches[0]),this.dedupSynthMouse(inEvent),this.scrolling||(this.clickCount++,this.processTouches(inEvent,this.overDown))},overDown:function(inPointer){touch__pointermap.set(inPointer.pointerId,{target:inPointer.target,out:inPointer,outTarget:inPointer.target}),_dispatcher.over(inPointer),_dispatcher.enter(inPointer),_dispatcher.down(inPointer)},touchmove:function(inEvent){this.scrolling||(this.shouldScroll(inEvent)?(this.scrolling=!0,this.touchcancel(inEvent)):(inEvent.preventDefault(),this.processTouches(inEvent,this.moveOverOut)))},moveOverOut:function(inPointer){var event=inPointer,pointer=touch__pointermap.get(event.pointerId);if(pointer){var outEvent=pointer.out,outTarget=pointer.outTarget;_dispatcher.move(event),outEvent&&outTarget!==event.target&&(outEvent.relatedTarget=event.target,event.relatedTarget=outTarget,outEvent.target=outTarget,event.target?(_dispatcher.leaveOut(outEvent),_dispatcher.enterOver(event)):(event.target=outTarget,event.relatedTarget=null,this.cancelOut(event))),pointer.out=event,pointer.outTarget=event.target}},touchend:function(inEvent){this.dedupSynthMouse(inEvent),this.processTouches(inEvent,this.upOut)},upOut:function(inPointer){this.scrolling||(_dispatcher.up(inPointer),_dispatcher.out(inPointer),_dispatcher.leave(inPointer)),this.cleanUpPointer(inPointer)},touchcancel:function(inEvent){this.processTouches(inEvent,this.cancelOut)},cancelOut:function(inPointer){_dispatcher.cancel(inPointer),_dispatcher.out(inPointer),_dispatcher.leave(inPointer),this.cleanUpPointer(inPointer)},cleanUpPointer:function(inPointer){touch__pointermap.delete(inPointer.pointerId),this.removePrimaryPointer(inPointer)},dedupSynthMouse:function(inEvent){var lts=mouse.lastTouches,t=inEvent.changedTouches[0];if(this.isPrimaryTouch(t)){var lt={x:t.clientX,y:t.clientY};lts.push(lt);var fn=function(lts,lt){var i=lts.indexOf(lt);i>-1&&lts.splice(i,1)}.bind(null,lts,lt);setTimeout(fn,2500)}}};INSTALLER=new installer(touchEvents.elementAdded,touchEvents.elementRemoved,touchEvents.elementChanged,touchEvents);var s,r,touch=touchEvents,ms__pointermap=_dispatcher.pointermap,HAS_BITMAP_TYPE=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,ms={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(target){_dispatcher.listen(target,this.events)},unregister:function(target){_dispatcher.unlisten(target,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(inEvent){var e=inEvent;return HAS_BITMAP_TYPE&&((e=_dispatcher.cloneEvent(inEvent)).pointerType=this.POINTER_TYPES[inEvent.pointerType]),e},cleanup:function(id){ms__pointermap.delete(id)},MSPointerDown:function(inEvent){ms__pointermap.set(inEvent.pointerId,inEvent);var e=this.prepareEvent(inEvent);_dispatcher.down(e)},MSPointerMove:function(inEvent){var e=this.prepareEvent(inEvent);_dispatcher.move(e)},MSPointerUp:function(inEvent){var e=this.prepareEvent(inEvent);_dispatcher.up(e),this.cleanup(inEvent.pointerId)},MSPointerOut:function(inEvent){var e=this.prepareEvent(inEvent);_dispatcher.leaveOut(e)},MSPointerOver:function(inEvent){var e=this.prepareEvent(inEvent);_dispatcher.enterOver(e)},MSPointerCancel:function(inEvent){var e=this.prepareEvent(inEvent);_dispatcher.cancel(e),this.cleanup(inEvent.pointerId)},MSLostPointerCapture:function(inEvent){var e=_dispatcher.makeEvent("lostpointercapture",inEvent);_dispatcher.dispatchEvent(e)},MSGotPointerCapture:function(inEvent){var e=_dispatcher.makeEvent("gotpointercapture",inEvent);_dispatcher.dispatchEvent(e)}};return window.navigator.msPointerEnabled?(s=function(pointerId){assertDown(pointerId),this.msSetPointerCapture(pointerId)},r=function(pointerId){assertDown(pointerId),this.msReleasePointerCapture(pointerId)}):(s=function(pointerId){assertDown(pointerId),_dispatcher.setCapture(pointerId,this)},r=function(pointerId){assertDown(pointerId),_dispatcher.releaseCapture(pointerId,this)}),function(){if(hasNativePE){attrib2css.forEach(function(r){String(r)===r?(styles+=selector(r)+rule(r)+"\n",hasShadowRoot&&(styles+=shadowSelector(r)+rule(r)+"\n")):(styles+=r.selectors.map(selector)+rule(r.rule)+"\n",hasShadowRoot&&(styles+=r.selectors.map(shadowSelector)+rule(r.rule)+"\n"))});var el=document.createElement("style");el.textContent=styles,document.head.appendChild(el)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=_PointerEvent,window.navigator.msPointerEnabled){var tp=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:tp,enumerable:!0}),_dispatcher.registerSource("ms",ms)}else _dispatcher.registerSource("mouse",mouse),void 0!==window.ontouchstart&&_dispatcher.registerSource("touch",touch);_dispatcher.register(document)}}(),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:s},releasePointerCapture:{value:r}}),{dispatcher:_dispatcher,Installer:installer,PointerEvent:_PointerEvent,PointerMap:_pointermap,targetFinding:targeting}}),void 0===YAHOO||!YAHOO)var YAHOO={};YAHOO.namespace=function(){var e,c,f,b=arguments,g=null;for(e=0;e<b.length;e+=1)for(f=(""+b[e]).split("."),g=YAHOO,c="YAHOO"==f[0]?1:0;c<f.length;c+=1)g[f[c]]=g[f[c]]||{},g=g[f[c]];return g},YAHOO.log=function(d,a,c){var b=YAHOO.widget.Logger;return!(!b||!b.log)&&b.log(d,a,c)},YAHOO.register=function(a,f,e){var c,j,h,g,d,k=YAHOO.env.modules;for(k[a]||(k[a]={versions:[],builds:[]}),c=k[a],j=e.version,h=e.build,g=YAHOO.env.listeners,c.name=a,c.version=j,c.build=h,c.versions.push(j),c.builds.push(h),c.mainClass=f,d=0;d<g.length;d+=1)g[d](c);f?(f.VERSION=j,f.BUILD=h):YAHOO.log("mainClass is undefined for module "+a,"warn")},YAHOO.env=YAHOO.env||{modules:[],listeners:[]},YAHOO.env.getVersion=function(a){return YAHOO.env.modules[a]||null},YAHOO.env.parseUA=function(g){var e,f=function(j){var k=0;return parseFloat(j.replace(/\./g,function(){return 1==k++?"":"."}))},i=window,a=i&&i.navigator,d={ie:0,opera:0,gecko:0,webkit:0,safari:0,chrome:0,mobile:null,air:0,phantomjs:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,silk:0,accel:!1,webos:0,caja:a&&a.cajaVersion,secure:!1,os:null,nodejs:0,winjs:!("undefined"==typeof Windows||!Windows.System),touchEnabled:!1},b=g||a&&a.userAgent,h=i&&i.location,c=h&&h.href;return d.userAgent=b,d.secure=c&&0===c.toLowerCase().indexOf("https"),b&&(/windows|win32/i.test(b)?d.os="windows":/macintosh|mac_powerpc/i.test(b)?d.os="macintosh":/android/i.test(b)?d.os="android":/symbos/i.test(b)?d.os="symbos":/linux/i.test(b)?d.os="linux":/rhino/i.test(b)&&(d.os="rhino"),/KHTML/.test(b)&&(d.webkit=1),/IEMobile|XBLWP7/.test(b)&&(d.mobile="windows"),/Fennec/.test(b)&&(d.mobile="gecko"),(e=b.match(/AppleWebKit\/([^\s]*)/))&&e[1]&&(d.webkit=f(e[1]),d.safari=d.webkit,/PhantomJS/.test(b)&&(e=b.match(/PhantomJS\/([^\s]*)/))&&e[1]&&(d.phantomjs=f(e[1])),/ Mobile\//.test(b)||/iPad|iPod|iPhone/.test(b)?(d.mobile="Apple",(e=b.match(/OS ([^\s]*)/))&&e[1]&&(e=f(e[1].replace("_","."))),d.ios=e,d.os="ios",d.ipad=d.ipod=d.iphone=0,(e=b.match(/iPad|iPod|iPhone/))&&e[0]&&(d[e[0].toLowerCase()]=d.ios)):((e=b.match(/NokiaN[^\/]*|webOS\/\d\.\d/))&&(d.mobile=e[0]),/webOS/.test(b)&&(d.mobile="WebOS",(e=b.match(/webOS\/([^\s]*);/))&&e[1]&&(d.webos=f(e[1]))),/ Android/.test(b)&&(/Mobile/.test(b)&&(d.mobile="Android"),(e=b.match(/Android ([^\s]*);/))&&e[1]&&(d.android=f(e[1]))),/Silk/.test(b)&&((e=b.match(/Silk\/([^\s]*)/))&&e[1]&&(d.silk=f(e[1])),d.android||(d.android=2.34,d.os="Android"),/Accelerated=true/.test(b)&&(d.accel=!0))),(e=b.match(/OPR\/(\d+\.\d+)/))&&e[1]?d.opera=f(e[1]):(e=b.match(/(Chrome|CrMo|CriOS)\/([^\s]*)/))&&e[1]&&e[2]?(d.chrome=f(e[2]),d.safari=0,"CrMo"===e[1]&&(d.mobile="chrome")):(e=b.match(/AdobeAIR\/([^\s]*)/))&&(d.air=e[0])),d.webkit||(/Opera/.test(b)?((e=b.match(/Opera[\s\/]([^\s]*)/))&&e[1]&&(d.opera=f(e[1])),(e=b.match(/Version\/([^\s]*)/))&&e[1]&&(d.opera=f(e[1])),/Opera Mobi/.test(b)&&(d.mobile="opera",(e=b.replace("Opera Mobi","").match(/Opera ([^\s]*)/))&&e[1]&&(d.opera=f(e[1]))),(e=b.match(/Opera Mini[^;]*/))&&(d.mobile=e[0])):(e=b.match(/MSIE ([^;]*)|Trident.*; rv:([0-9.]+)/))&&(e[1]||e[2])?d.ie=f(e[1]||e[2]):(e=b.match(/Gecko\/([^\s]*)/))&&(d.gecko=1,(e=b.match(/rv:([^\s\)]*)/))&&e[1]&&(d.gecko=f(e[1]),/Mobile|Tablet/.test(b)&&(d.mobile="ffos"))))),!i||!a||d.chrome&&d.chrome<6||(d.touchEnabled="ontouchstart"in i||"msMaxTouchPoints"in a&&a.msMaxTouchPoints>0),d},YAHOO.env.ua=YAHOO.env.parseUA(),function(){if(YAHOO.namespace("util","widget","example"),"undefined"!=typeof YAHOO_config){var c,b=YAHOO_config.listener,a=YAHOO.env.listeners,d=!0;if(b){for(c=0;c<a.length;c++)if(a[c]==b){d=!1;break}d&&a.push(b)}}}(),YAHOO.lang=YAHOO.lang||{},function(){var f=YAHOO.lang,a=Object.prototype,b=[],g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},d=["toString","valueOf"],e={isArray:function(j){return"[object Array]"===a.toString.apply(j)},isBoolean:function(j){return"boolean"==typeof j},isFunction:function(j){return"function"==typeof j||"[object Function]"===a.toString.apply(j)},isNull:function(j){return null===j},isNumber:function(j){return"number"==typeof j&&isFinite(j)},isObject:function(j){return j&&("object"==typeof j||f.isFunction(j))||!1},isString:function(j){return"string"==typeof j},isUndefined:function(j){return void 0===j},_IEEnumFix:YAHOO.env.ua.ie?function(l,k){var j,n,m;for(j=0;j<d.length;j+=1)m=k[n=d[j]],f.isFunction(m)&&m!=a[n]&&(l[n]=m)}:function(){},escapeHTML:function(j){return j.replace(/[&<>"'\/`]/g,function(k){return g[k]})},extend:function(m,n,l){if(!n||!m)throw new Error("extend failed, please check that all dependencies are included.");var j,k=function(){};if(k.prototype=n.prototype,m.prototype=new k,m.prototype.constructor=m,m.superclass=n.prototype,n.prototype.constructor==a.constructor&&(n.prototype.constructor=n),l){for(j in l)f.hasOwnProperty(l,j)&&(m.prototype[j]=l[j]);f._IEEnumFix(m.prototype,l)}},augmentObject:function(n,m){if(!m||!n)throw new Error("Absorb failed, verify dependencies.");var l,o,j=arguments,k=j[2];if(k&&!0!==k)for(l=2;l<j.length;l+=1)n[j[l]]=m[j[l]];else{for(o in m)!k&&o in n||(n[o]=m[o]);f._IEEnumFix(n,m)}return n},augmentProto:function(m,l){if(!l||!m)throw new Error("Augment failed, verify dependencies.");var k,j=[m.prototype,l.prototype];for(k=2;k<arguments.length;k+=1)j.push(arguments[k]);return f.augmentObject.apply(this,j),m},dump:function(j,p){var l,n,r=[],t="{...}";if(!f.isObject(j))return j+"";if(j instanceof Date||"nodeType"in j&&"tagName"in j)return j;if(f.isFunction(j))return"f(){...}";if(p=f.isNumber(p)?p:3,f.isArray(j)){for(r.push("["),l=0,n=j.length;l<n;l+=1)f.isObject(j[l])?r.push(p>0?f.dump(j[l],p-1):t):r.push(j[l]),r.push(", ");r.length>1&&r.pop(),r.push("]")}else{r.push("{");for(l in j)f.hasOwnProperty(j,l)&&(r.push(l+" => "),f.isObject(j[l])?r.push(p>0?f.dump(j[l],p-1):t):r.push(j[l]),r.push(", "));r.length>1&&r.pop(),r.push("}")}return r.join("")},substitute:function(x,y,E,l){for(var D,C,B,G,t,u,p,n,w,F=[],z=x.length;!((D=x.lastIndexOf("{",z))<0)&&(C=x.indexOf("}",D),!(D+1>C));)u=null,(B=(G=p=x.substring(D+1,C)).indexOf(" "))>-1&&(u=G.substring(B+1),G=G.substring(0,B)),t=y[G],E&&(t=E(G,t,u)),f.isObject(t)?f.isArray(t)?t=f.dump(t,parseInt(u,10)):((n=(u=u||"").indexOf("dump"))>-1&&(u=u.substring(4)),t="[object Object]"===(w=t.toString())||n>-1?f.dump(t,parseInt(u,10)):w):f.isString(t)||f.isNumber(t)||(t="~-"+F.length+"-~",F[F.length]=p),x=x.substring(0,D)+t+x.substring(C+1),!1===l&&(z=D-1);for(D=F.length-1;D>=0;D-=1)x=x.replace(new RegExp("~-"+D+"-~"),"{"+F[D]+"}","g");return x},trim:function(j){try{return j.replace(/^\s+|\s+$/g,"")}catch(k){return j}},merge:function(){var m,n={},k=arguments,j=k.length;for(m=0;m<j;m+=1)f.augmentObject(n,k[m],!0);return n},later:function(t,k,u,n,p){t=t||0,k=k||{};var q,j,l=u,s=n;if(f.isString(u)&&(l=k[u]),!l)throw new TypeError("method undefined");return f.isUndefined(n)||f.isArray(s)||(s=[n]),q=function(){l.apply(k,s||b)},j=p?setInterval(q,t):setTimeout(q,t),{interval:p,cancel:function(){this.interval?clearInterval(j):clearTimeout(j)}}},isValue:function(j){return f.isObject(j)||f.isString(j)||f.isNumber(j)||f.isBoolean(j)}};f.hasOwnProperty=a.hasOwnProperty?function(j,k){return j&&j.hasOwnProperty&&j.hasOwnProperty(k)}:function(j,k){return!f.isUndefined(j[k])&&j.constructor.prototype[k]!==j[k]},e.augmentObject(f,e,!0),YAHOO.util.Lang=f,f.augment=f.augmentProto,YAHOO.augment=f.augmentProto,YAHOO.extend=f.extend}(),YAHOO.register("yahoo",YAHOO,{version:"@VERSION@",build:"@BUILD@"}),function(){YAHOO.env._id_counter=YAHOO.env._id_counter||0;var e=YAHOO.util,k=YAHOO.lang,L=YAHOO.env.ua,a=YAHOO.lang.trim,B={},F={},m=/^t(?:able|d|h)$/i,w=/color$/i,j=window.document,v=j.documentElement,C="ownerDocument",M="defaultView",U="documentElement",S="compatMode",x="parentNode",K="nodeType",c="tagName",V="getComputedStyle",y="currentStyle",l="CSS1Compat",E="class",f="className",i="",b=" ",O="position",u="relative",I="left",N="top",d=L.opera,h=L.webkit,g=L.gecko,s=L.ie;e.Dom={CUSTOM_ATTRIBUTES:v.hasAttribute?{htmlFor:"for",className:E}:{for:"htmlFor",class:f},DOT_ATTRIBUTES:{checked:!0},get:function(aa){var ac,X,ab,Z,W,G,Y=null;if(aa){if("string"==typeof aa||"number"==typeof aa){if(ac=aa+"",aa=j.getElementById(aa),G=aa?aa.attributes:null,aa&&G&&G.id&&G.id.value===ac)return aa;if(aa&&j.all&&(aa=null,(X=j.all[ac])&&X.length))for(Z=0,W=X.length;Z<W;++Z)if(X[Z].id===ac)return X[Z]}else if(e.Element&&aa instanceof e.Element)aa=aa.get("element");else if(!aa.nodeType&&"length"in aa){for(ab=[],Z=0,W=aa.length;Z<W;++Z)ab[ab.length]=e.Dom.get(aa[Z]);aa=ab}Y=aa}return Y},getComputedStyle:function(G,W){return window[V]?G[C][M][V](G,null)[W]:G[y]?e.Dom.IE_ComputedStyle.get(G,W):void 0},getStyle:function(G,W){return e.Dom.batch(G,e.Dom._getStyle,W)},_getStyle:window[V]?function(G,Y){Y="float"===Y?Y="cssFloat":e.Dom._toCamel(Y);var W,X=G.style[Y];return X||(W=G[C][M][V](G,null))&&(X=W[Y]),X}:v[y]?function(G,Y){var X;switch(Y){case"opacity":X=100;try{X=G.filters["DXImageTransform.Microsoft.Alpha"].opacity}catch(Z){try{X=G.filters("alpha").opacity}catch(W){}}return X/100;case"float":Y="styleFloat";default:return Y=e.Dom._toCamel(Y),X=G[y]?G[y][Y]:null,G.style[Y]||X}}:void 0,setStyle:function(G,W,X){e.Dom.batch(G,e.Dom._setStyle,{prop:W,val:X})},_setStyle:!window.getComputedStyle&&j.documentElement.currentStyle?function(W,G){var X=e.Dom._toCamel(G.prop),Y=G.val;if(W)switch(X){case"opacity":""===Y||null===Y||1===Y?W.style.removeAttribute("filter"):k.isString(W.style.filter)&&(W.style.filter="alpha(opacity="+100*Y+")",W[y]&&W[y].hasLayout||(W.style.zoom=1));break;case"float":X="styleFloat";default:W.style[X]=Y}}:function(W,G){var X=e.Dom._toCamel(G.prop),Y=G.val;W&&("float"==X&&(X="cssFloat"),W.style[X]=Y)},getXY:function(G){return e.Dom.batch(G,e.Dom._getXY)},_canPosition:function(G){return"none"!==e.Dom._getStyle(G,"display")&&e.Dom._inDoc(G)},_getXY:function(W){var X,G,Z,ab,ac=Math.round,ad=!1;return e.Dom._canPosition(W)&&(Z=W.getBoundingClientRect(),ab=W[C],X=e.Dom.getDocumentScrollLeft(ab),G=e.Dom.getDocumentScrollTop(ab),ad=[Z[I],Z[N]],(G||X)&&(ad[0]+=X,ad[1]+=G),ad[0]=ac(ad[0]),ad[1]=ac(ad[1])),ad},getX:function(G){return e.Dom.batch(G,function(X){return e.Dom.getXY(X)[0]},e.Dom,!0)},getY:function(G){return e.Dom.batch(G,function(X){return e.Dom.getXY(X)[1]},e.Dom,!0)},setXY:function(G,X,W){e.Dom.batch(G,e.Dom._setXY,{pos:X,noRetry:W})},_setXY:function(G,Z){var ac,X,aa=e.Dom._getStyle(G,O),Y=e.Dom.setStyle,ad=Z.pos,W=Z.noRetry,ab=[parseInt(e.Dom.getComputedStyle(G,I),10),parseInt(e.Dom.getComputedStyle(G,N),10)];if(ac=e.Dom._getXY(G),!ad||!1===ac)return!1;"static"==aa&&Y(G,O,aa=u),isNaN(ab[0])&&(ab[0]=aa==u?0:G.offsetLeft),isNaN(ab[1])&&(ab[1]=aa==u?0:G.offsetTop),null!==ad[0]&&Y(G,I,ad[0]-ac[0]+ab[0]+"px"),null!==ad[1]&&Y(G,N,ad[1]-ac[1]+ab[1]+"px"),W||(X=e.Dom._getXY(G),(null!==ad[0]&&X[0]!=ad[0]||null!==ad[1]&&X[1]!=ad[1])&&e.Dom._setXY(G,{pos:ad,noRetry:!0}))},setX:function(W,G){e.Dom.setXY(W,[G,null])},setY:function(G,W){e.Dom.setXY(G,[null,W])},getRegion:function(G){return e.Dom.batch(G,function(X){var Y=!1;return e.Dom._canPosition(X)&&(Y=e.Region.getRegion(X)),Y},e.Dom,!0)},getClientWidth:function(){return e.Dom.getViewportWidth()},getClientHeight:function(){return e.Dom.getViewportHeight()},getElementsByClassName:function(ab,af,ac,ae,X,ad){if(af=af||"*",!(ac=ac?e.Dom.get(ac):j))return[];for(var W=[],G=ac.getElementsByTagName(af),Z=e.Dom.hasClass,Y=0,aa=G.length;Y<aa;++Y)Z(G[Y],ab)&&(W[W.length]=G[Y]);return ae&&e.Dom.batch(W,ae,X,ad),W},hasClass:function(W,G){return e.Dom.batch(W,e.Dom._hasClass,G)},_hasClass:function(X,W){var Y,G=!1;return X&&W&&((Y=e.Dom._getAttribute(X,f)||i)&&(Y=Y.replace(/\s+/g,b)),G=W.exec?W.test(Y):W&&(b+Y+b).indexOf(b+W+b)>-1),G},addClass:function(W,G){return e.Dom.batch(W,e.Dom._addClass,G)},_addClass:function(X,W){var Y,G=!1;return X&&W&&(Y=e.Dom._getAttribute(X,f)||i,e.Dom._hasClass(X,W)||(e.Dom.setAttribute(X,f,a(Y+b+W)),G=!0)),G},removeClass:function(W,G){return e.Dom.batch(W,e.Dom._removeClass,G)},_removeClass:function(Y,X){var aa,Z,G,W=!1;return Y&&X&&(aa=e.Dom._getAttribute(Y,f)||i,e.Dom.setAttribute(Y,f,aa.replace(e.Dom._getClassRegex(X),i)),aa!==(Z=e.Dom._getAttribute(Y,f))&&(e.Dom.setAttribute(Y,f,a(Z)),W=!0,""===e.Dom._getAttribute(Y,f)&&(G=Y.hasAttribute&&Y.hasAttribute(E)?E:f,Y.removeAttribute(G)))),W},replaceClass:function(X,W,G){return e.Dom.batch(X,e.Dom._replaceClass,{from:W,to:G})},_replaceClass:function(Y,X){var W,ab,aa,Z,G=!1;return Y&&X&&(ab=X.from,(aa=X.to)?ab?ab!==aa&&(Z=e.Dom._getAttribute(Y,f)||i,(W=(b+Z.replace(e.Dom._getClassRegex(ab),b+aa).replace(/\s+/g,b)).split(e.Dom._getClassRegex(aa))).splice(1,0,b+aa),e.Dom.setAttribute(Y,f,a(W.join(i))),G=!0):G=e.Dom._addClass(Y,X.to):G=!1),G},generateId:function(G,X){X=X||"yui-gen";var W=function(Y){if(Y&&Y.id)return Y.id;var Z=X+YAHOO.env._id_counter++;if(Y){if(Y[C]&&Y[C].getElementById(Z))return e.Dom.generateId(Y,Z+X);Y.id=Z}return Z};return e.Dom.batch(G,W,e.Dom,!0)||W.apply(e.Dom,arguments)},isAncestor:function(W,X){W=e.Dom.get(W),X=e.Dom.get(X);var G=!1;return W&&X&&W[K]&&X[K]&&(W.contains&&W!==X?G=W.contains(X):W.compareDocumentPosition&&(G=!!(16&W.compareDocumentPosition(X)))),G},inDocument:function(G,W){return e.Dom._inDoc(e.Dom.get(G),W)},_inDoc:function(W,X){var G=!1;return W&&W[c]&&(X=X||W[C],G=e.Dom.isAncestor(X[U],W)),G},getElementsBy:function(W,af,ab,ad,X,ac,ae){af=af||"*",ab=ab?e.Dom.get(ab):j;var G,aa=ae?null:[];if(ab){for(var Y=0,Z=(G=ab.getElementsByTagName(af)).length;Y<Z;++Y)if(W(G[Y])){if(ae){aa=G[Y];break}aa[aa.length]=G[Y]}ad&&e.Dom.batch(aa,ad,X,ac)}return aa},getElementBy:function(X,G,W){return e.Dom.getElementsBy(X,G,W,null,null,null,!0)},batch:function(X,ab,aa,Z){var Y=[],W=Z?aa:null;if(!(X=X&&(X[c]||X.item)?X:e.Dom.get(X))||!ab)return!1;if(X[c]||void 0===X.length)return ab.call(W,X,aa);for(var G=0;G<X.length;++G)Y[Y.length]=ab.call(W||X[G],X[G],aa);return Y},getDocumentHeight:function(){var W=j[S]!=l||h?j.body.scrollHeight:v.scrollHeight;return Math.max(W,e.Dom.getViewportHeight())},getDocumentWidth:function(){var W=j[S]!=l||h?j.body.scrollWidth:v.scrollWidth;return Math.max(W,e.Dom.getViewportWidth())},getViewportHeight:function(){var G=self.innerHeight,W=j[S];return!W&&!s||d||(G=W==l?v.clientHeight:j.body.clientHeight),G},getViewportWidth:function(){var G=self.innerWidth,W=j[S];return(W||s)&&(G=W==l?v.clientWidth:j.body.clientWidth),G},getAncestorBy:function(G,W){for(;G=G[x];)if(e.Dom._testElement(G,W))return G;return null},getAncestorByClassName:function(W,G){if(!(W=e.Dom.get(W)))return null;return e.Dom.getAncestorBy(W,function(Y){return e.Dom.hasClass(Y,G)})},getAncestorByTagName:function(W,G){if(!(W=e.Dom.get(W)))return null;return e.Dom.getAncestorBy(W,function(Y){return Y[c]&&Y[c].toUpperCase()==G.toUpperCase()})},getPreviousSiblingBy:function(G,W){for(;G;)if(G=G.previousSibling,e.Dom._testElement(G,W))return G;return null},getPreviousSibling:function(G){return(G=e.Dom.get(G))?e.Dom.getPreviousSiblingBy(G):null},getNextSiblingBy:function(G,W){for(;G;)if(G=G.nextSibling,e.Dom._testElement(G,W))return G;return null},getNextSibling:function(G){return(G=e.Dom.get(G))?e.Dom.getNextSiblingBy(G):null},getFirstChildBy:function(G,X){return(e.Dom._testElement(G.firstChild,X)?G.firstChild:null)||e.Dom.getNextSiblingBy(G.firstChild,X)},getFirstChild:function(G,W){return(G=e.Dom.get(G))?e.Dom.getFirstChildBy(G):null},getLastChildBy:function(G,X){return G?(e.Dom._testElement(G.lastChild,X)?G.lastChild:null)||e.Dom.getPreviousSiblingBy(G.lastChild,X):null},getLastChild:function(G){return G=e.Dom.get(G),e.Dom.getLastChildBy(G)},getChildrenBy:function(W,Y){var X=e.Dom.getFirstChildBy(W,Y),G=X?[X]:[];return e.Dom.getNextSiblingBy(X,function(Z){return Y&&!Y(Z)||(G[G.length]=Z),!1}),G},getChildren:function(G){return G=e.Dom.get(G),e.Dom.getChildrenBy(G)},getDocumentScrollLeft:function(G){return G=G||j,Math.max(G[U].scrollLeft,G.body.scrollLeft)},getDocumentScrollTop:function(G){return G=G||j,Math.max(G[U].scrollTop,G.body.scrollTop)},insertBefore:function(W,G){return W=e.Dom.get(W),G=e.Dom.get(G),W&&G&&G[x]?G[x].insertBefore(W,G):null},insertAfter:function(W,G){return W=e.Dom.get(W),G=e.Dom.get(G),W&&G&&G[x]?G.nextSibling?G[x].insertBefore(W,G.nextSibling):G[x].appendChild(W):null},getClientRegion:function(){var X=e.Dom.getDocumentScrollTop(),W=e.Dom.getDocumentScrollLeft(),Y=e.Dom.getViewportWidth()+W,G=e.Dom.getViewportHeight()+X;return new e.Region(X,Y,G,W)},setAttribute:function(W,G,X){e.Dom.batch(W,e.Dom._setAttribute,{attr:G,val:X})},_setAttribute:function(X,W){var G=e.Dom._toCamel(W.attr),Y=W.val;X&&X.setAttribute&&(e.Dom.DOT_ATTRIBUTES[G]&&X.tagName&&"BUTTON"!=X.tagName?X[G]=Y:(G=e.Dom.CUSTOM_ATTRIBUTES[G]||G,X.setAttribute(G,Y)))},getAttribute:function(W,G){return e.Dom.batch(W,e.Dom._getAttribute,G)},_getAttribute:function(W,G){var X;return G=e.Dom.CUSTOM_ATTRIBUTES[G]||G,e.Dom.DOT_ATTRIBUTES[G]?X=W[G]:W&&"getAttribute"in W&&(X=/^(?:href|src)$/.test(G)?W.getAttribute(G,2):W.getAttribute(G)),X},_toCamel:function(W){var X=B;return X[W]||(X[W]=-1===W.indexOf("-")?W:W.replace(/-([a-z])/gi,function(Y,Z){return Z.toUpperCase()}))},_getClassRegex:function(W){var G;return void 0!==W&&(W.exec?G=W:(G=F[W])||(W=(W=W.replace(e.Dom._patterns.CLASS_RE_TOKENS,"\\$1")).replace(/\s+/g,b),G=F[W]=new RegExp("(?:^|\\s)"+W+"(?= |$)","g"))),G},_patterns:{ROOT_TAG:/^body|html$/i,CLASS_RE_TOKENS:/([\.\(\)\^\$\*\+\?\|\[\]\{\}\\])/g},_testElement:function(G,W){return G&&1==G[K]&&(!W||W(G))},_calcBorders:function(X,Y){var W=parseInt(e.Dom[V](X,"borderTopWidth"),10)||0,G=parseInt(e.Dom[V](X,"borderLeftWidth"),10)||0;return g&&m.test(X[c])&&(W=0,G=0),Y[0]+=G,Y[1]+=W,Y}};var r=e.Dom[V];L.opera&&(e.Dom[V]=function(W,G){var X=r(W,G);return w.test(G)&&(X=e.Dom.Color.toRGB(X)),X}),L.webkit&&(e.Dom[V]=function(W,G){var X=r(W,G);return"rgba(0, 0, 0, 0)"===X&&(X="transparent"),X}),L.ie&&L.ie>=8&&(e.Dom.DOT_ATTRIBUTES.type=!0)}(),YAHOO.util.Region=function(d,e,a,c){this.top=d,this.y=d,this[1]=d,this.right=e,this.bottom=a,this.left=c,this.x=c,this[0]=c,this.width=this.right-this.left,this.height=this.bottom-this.top},YAHOO.util.Region.prototype.contains=function(a){return a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom},YAHOO.util.Region.prototype.getArea=function(){return(this.bottom-this.top)*(this.right-this.left)},YAHOO.util.Region.prototype.intersect=function(f){var d=Math.max(this.top,f.top),e=Math.min(this.right,f.right),a=Math.min(this.bottom,f.bottom),c=Math.max(this.left,f.left);return a>=d&&e>=c?new YAHOO.util.Region(d,e,a,c):null},YAHOO.util.Region.prototype.union=function(f){var d=Math.min(this.top,f.top),e=Math.max(this.right,f.right),a=Math.max(this.bottom,f.bottom),c=Math.min(this.left,f.left);return new YAHOO.util.Region(d,e,a,c)},YAHOO.util.Region.prototype.toString=function(){return"Region {top: "+this.top+", right: "+this.right+", bottom: "+this.bottom+", left: "+this.left+", height: "+this.height+", width: "+this.width+"}"},YAHOO.util.Region.getRegion=function(e){var g=YAHOO.util.Dom.getXY(e),d=g[1],f=g[0]+e.offsetWidth,a=g[1]+e.offsetHeight,c=g[0];return new YAHOO.util.Region(d,f,a,c)},YAHOO.util.Point=function(a,b){YAHOO.lang.isArray(a)&&(b=a[1],a=a[0]),YAHOO.util.Point.superclass.constructor.call(this,b,a,b,a)},YAHOO.extend(YAHOO.util.Point,YAHOO.util.Region),function(){var b=YAHOO.util,a="clientTop",f="clientLeft",k="right",i="px",u="opacity",l="auto",d="borderLeftWidth",g="borderTopWidth",p="borderRightWidth",v="borderBottomWidth",h="style",t="currentStyle",r=/^width|height$/,o=/^(\d[.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz|%){1}?/i,m={get:function(x,z){var A=x[t][z];return z===u?b.Dom.getStyle(x,u):!A||A.indexOf&&A.indexOf(i)>-1?A:b.Dom.IE_COMPUTED[z]?b.Dom.IE_COMPUTED[z](x,z):o.test(A)?b.Dom.IE.ComputedStyle.getPixel(x,z):A},getOffset:function(z,E){var D,B=z[t][E],x=E.charAt(0).toUpperCase()+E.substr(1),C="offset"+x,y="pixel"+x,A="";return B==l?(void 0===(D=z[C])&&(A=0),A=D,r.test(E)&&(z[h][E]=D,z[C]>D&&(A=D-(z[C]-D)),z[h][E]=l)):(z[h][y]||z[h][E]||(z[h][E]=B),A=z[h][y]),A+i},getBorderWidth:function(x,z){var y=null;switch(x[t].hasLayout||(x[h].zoom=1),z){case g:y=x[a];break;case v:y=x.offsetHeight-x.clientHeight-x[a];break;case d:y=x[f];break;case p:y=x.offsetWidth-x.clientWidth-x[f]}return y+i},getPixel:function(y,x){var A=null,B=y[t][k],z=y[t][x];return y[h][k]=z,A=y[h].pixelRight,y[h][k]=B,A+i},getMargin:function(y,x){return y[t][x]==l?0+i:b.Dom.IE.ComputedStyle.getPixel(y,x)},getVisibility:function(y,x){for(var z;(z=y[t])&&"inherit"==z[x];)y=y.parentNode;return z?z[x]:"visible"},getColor:function(y,x){return b.Dom.Color.toRGB(y[t][x])||"transparent"},getBorderColor:function(y,x){var z=y[t],A=z[x]||z.color;return b.Dom.Color.toRGB(b.Dom.Color.toHex(A))}},c={};c.top=c.right=c.bottom=c.left=c.width=c.height=m.getOffset,c.color=m.getColor,c[g]=c[p]=c[v]=c[d]=m.getBorderWidth,c.marginTop=c.marginRight=c.marginBottom=c.marginLeft=m.getMargin,c.visibility=m.getVisibility,c.borderColor=c.borderTopColor=c.borderRightColor=c.borderBottomColor=c.borderLeftColor=m.getBorderColor,b.Dom.IE_COMPUTED=c,b.Dom.IE_ComputedStyle=m}(),function(){var a=parseInt,b=RegExp,d=YAHOO.util;d.Dom.Color={KEYWORDS:{black:"000",silver:"c0c0c0",gray:"808080",white:"fff",maroon:"800000",red:"f00",purple:"800080",fuchsia:"f0f",green:"008000",lime:"0f0",olive:"808000",yellow:"ff0",navy:"000080",blue:"00f",teal:"008080",aqua:"0ff"},re_RGB:/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,re_hex:/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,re_hex3:/([0-9A-F])/gi,toRGB:function(e){return d.Dom.Color.re_RGB.test(e)||(e=d.Dom.Color.toHex(e)),d.Dom.Color.re_hex.exec(e)&&(e="rgb("+[a(b.$1,16),a(b.$2,16),a(b.$3,16)].join(", ")+")"),e},toHex:function(f){if(f=d.Dom.Color.KEYWORDS[f]||f,d.Dom.Color.re_RGB.exec(f)){f=[Number(b.$1).toString(16),Number(b.$2).toString(16),Number(b.$3).toString(16)];for(var e=0;e<f.length;e++)f[e].length<2&&(f[e]="0"+f[e]);f=f.join("")}return f.length<6&&(f=f.replace(d.Dom.Color.re_hex3,"$1$1")),"transparent"!==f&&f.indexOf("#")<0&&(f="#"+f),f.toUpperCase()}}}(),YAHOO.register("dom",YAHOO.util.Dom,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.util.CustomEvent=function(d,c,b,a,e){this.type=d,this.scope=c||window,this.silent=b,this.fireOnce=e,this.fired=!1,this.firedWith=null,this.signature=a||YAHOO.util.CustomEvent.LIST,this.subscribers=[],this.silent;var f="_YUICEOnSubscribe";d!==f&&(this.subscribeEvent=new YAHOO.util.CustomEvent(f,this,!0)),this.lastError=null},YAHOO.util.CustomEvent.LIST=0,YAHOO.util.CustomEvent.FLAT=1,YAHOO.util.CustomEvent.prototype={subscribe:function(b,c,d){if(!b)throw new Error("Invalid callback for subscriber to '"+this.type+"'");this.subscribeEvent&&this.subscribeEvent.fire(b,c,d);var a=new YAHOO.util.Subscriber(b,c,d);this.fireOnce&&this.fired?this.notify(a,this.firedWith):this.subscribers.push(a)},unsubscribe:function(d,f){if(!d)return this.unsubscribeAll();for(var e=!1,b=0,a=this.subscribers.length;b<a;++b){var c=this.subscribers[b];c&&c.contains(d,f)&&(this._delete(b),e=!0)}return e},fire:function(){this.lastError=null;var f,a=this.subscribers.length,d=[].slice.call(arguments,0),c=!0;if(this.fireOnce){if(this.fired)return!0;this.firedWith=d}if(this.fired=!0,!a&&this.silent)return!0;this.silent;var e=this.subscribers.slice();for(f=0;f<a;++f){var g=e[f];if(g&&g.fn){if(!1===(c=this.notify(g,d))){this.silent;break}}else!0}return!1!==c},notify:function(g,c){var b,i=null,f=g.getScope(this.scope),a=YAHOO.util.Event.throwErrors;if(this.silent,this.signature==YAHOO.util.CustomEvent.FLAT){c.length>0&&(i=c[0]);try{b=g.fn.call(f,i,g.obj)}catch(h){if(this.lastError=h,a)throw h}}else try{b=g.fn.call(f,this.type,c,g.obj)}catch(d){if(this.lastError=d,a)throw d}return b},unsubscribeAll:function(){var b,a=this.subscribers.length;for(b=a-1;b>-1;b--)this._delete(b);return this.subscribers=[],a},_delete:function(a){var b=this.subscribers[a];b&&(delete b.fn,delete b.obj),this.subscribers.splice(a,1)},toString:function(){return"CustomEvent: '"+this.type+"', context: "+this.scope}},YAHOO.util.Subscriber=function(a,b,c){this.fn=a,this.obj=YAHOO.lang.isUndefined(b)?null:b,this.overrideContext=c},YAHOO.util.Subscriber.prototype.getScope=function(a){return this.overrideContext?!0===this.overrideContext?this.obj:this.overrideContext:a},YAHOO.util.Subscriber.prototype.contains=function(a,b){return b?this.fn==a&&this.obj==b:this.fn==a},YAHOO.util.Subscriber.prototype.toString=function(){return"Subscriber { obj: "+this.obj+", overrideContext: "+(this.overrideContext||"no")+" }"},YAHOO.util.Event||(YAHOO.util.Event=function(){var g=!1,h=[],j=[],a=0,e=[],b=0,c={63232:38,63233:40,63234:37,63235:39,63276:33,63277:34,25:9},d=YAHOO.env.ua.ie,f="focusin",i="focusout";return{POLL_RETRYS:500,POLL_INTERVAL:40,EL:0,TYPE:1,FN:2,WFN:3,UNLOAD_OBJ:3,ADJ_SCOPE:4,OBJ:5,OVERRIDE:6,CAPTURE:7,lastError:null,isSafari:YAHOO.env.ua.webkit,webkit:YAHOO.env.ua.webkit,isIE:d,_interval:null,_dri:null,_specialTypes:{focusin:d?"focusin":"focus",focusout:d?"focusout":"blur"},DOMReady:!1,throwErrors:!1,startInterval:function(){this._interval||(this._interval=YAHOO.lang.later(this.POLL_INTERVAL,this,this._tryPreloadAttach,null,!0))},onAvailable:function(q,m,o,p,n){for(var k=YAHOO.lang.isString(q)?[q]:q,l=0;l<k.length;l+=1)e.push({id:k[l],fn:m,obj:o,overrideContext:p,checkReady:n});a=this.POLL_RETRYS,this.startInterval()},onContentReady:function(n,k,l,m){this.onAvailable(n,k,l,m,!0)},onDOMReady:function(){this.DOMReadyEvent.subscribe.apply(this.DOMReadyEvent,arguments)},_addListener:function(m,k,v,p,t,y){if(!v||!v.call)return!1;if(this._isValidCollection(m)){for(var w=!0,q=0,s=m.length;q<s;++q)w=this.on(m[q],k,v,p,t)&&w;return w}if(YAHOO.lang.isString(m)){var o=this.getEl(m);if(!o)return this.onAvailable(m,function(){YAHOO.util.Event._addListener(m,k,v,p,t,y)}),!0;m=o}if(!m)return!1;if("unload"==k&&p!==this)return j[j.length]=[m,k,v,p,t],!0;var l=m;t&&(l=!0===t?p:t);var n=function(z){return v.call(l,YAHOO.util.Event.getEvent(z,m),p)},x=[m,k,v,n,l,p,t,y],r=h.length;h[r]=x;try{this._simpleAdd(m,k,n,y)}catch(u){return this.lastError=u,this.removeListener(m,k,v),!1}return!0},_getType:function(k){return this._specialTypes[k]||k},addListener:function(m,p,l,n,o){var k=!(p!=f&&p!=i||YAHOO.env.ua.ie);return this._addListener(m,this._getType(p),l,n,o,k)},addFocusListener:function(l,k,m,n){return this.on(l,f,k,m,n)},removeFocusListener:function(l,k){return this.removeListener(l,f,k)},addBlurListener:function(l,k,m,n){return this.on(l,i,k,m,n)},removeBlurListener:function(l,k){return this.removeListener(l,i,k)},removeListener:function(l,k,r){var m,u;if(k=this._getType(k),"string"==typeof l)l=this.getEl(l);else if(this._isValidCollection(l)){var s=!0;for(m=l.length-1;m>-1;m--)s=this.removeListener(l[m],k,r)&&s;return s}if(!r||!r.call)return this.purgeElement(l,!1,k);if("unload"==k){for(m=j.length-1;m>-1;m--)if((u=j[m])&&u[0]==l&&u[1]==k&&u[2]==r)return j.splice(m,1),!0;return!1}var n=null,o=arguments[3];if(void 0===o&&(o=this._getCacheIndex(h,l,k,r)),o>=0&&(n=h[o]),!l||!n)return!1;var t=!0===n[this.CAPTURE];try{this._simpleRemove(l,k,n[this.WFN],t)}catch(q){return this.lastError=q,!1}return delete h[o][this.WFN],delete h[o][this.FN],h.splice(o,1),!0},getTarget:function(m,l){var k=m.target||m.srcElement;return this.resolveTextNode(k)},resolveTextNode:function(l){try{if(l&&3==l.nodeType)return l.parentNode}catch(k){return null}return l},getPageX:function(l){var k=l.pageX;return k||0===k||(k=l.clientX||0,this.isIE&&(k+=this._getScrollLeft())),k},getPageY:function(k){var l=k.pageY;return l||0===l||(l=k.clientY||0,this.isIE&&(l+=this._getScrollTop())),l},getXY:function(k){return[this.getPageX(k),this.getPageY(k)]},getRelatedTarget:function(l){var k=l.relatedTarget;return k||("mouseout"==l.type?k=l.toElement:"mouseover"==l.type&&(k=l.fromElement)),this.resolveTextNode(k)},getTime:function(m){if(!m.time){var l=(new Date).getTime();try{m.time=l}catch(k){return this.lastError=k,l}}return m.time},stopEvent:function(k){this.stopPropagation(k),this.preventDefault(k)},stopPropagation:function(k){k.stopPropagation?k.stopPropagation():k.cancelBubble=!0},preventDefault:function(k){k.preventDefault?k.preventDefault():k.returnValue=!1},getEvent:function(m,k){var l=m||window.event;if(!l)for(var n=this.getEvent.caller;n&&(!(l=n.arguments[0])||Event!=l.constructor);)n=n.caller;return l},getCharCode:function(l){var k=l.keyCode||l.charCode||0;return YAHOO.env.ua.webkit&&k in c&&(k=c[k]),k},_getCacheIndex:function(n,q,r,p){for(var o=0,m=n.length;o<m;o+=1){var k=n[o];if(k&&k[this.FN]==p&&k[this.EL]==q&&k[this.TYPE]==r)return o}return-1},generateId:function(k){var l=k.id;return l||(l="yuievtautoid-"+b,++b,k.id=l),l},_isValidCollection:function(l){try{return l&&"string"!=typeof l&&l.length&&!l.tagName&&!l.alert&&void 0!==l[0]}catch(k){return!1}},elCache:{},getEl:function(k){return"string"==typeof k?document.getElementById(k):k},clearCache:function(){},DOMReadyEvent:new YAHOO.util.CustomEvent("DOMReady",YAHOO,0,0,1),_load:function(l){if(!g){g=!0;var k=YAHOO.util.Event;k._ready(),k._tryPreloadAttach()}},_ready:function(l){var k=YAHOO.util.Event;k.DOMReady||(k.DOMReady=!0,k.DOMReadyEvent.fire(),k._simpleRemove(document,"DOMContentLoaded",k._ready))},_tryPreloadAttach:function(){if(0===e.length)return a=0,void(this._interval&&(this._interval.cancel(),this._interval=null));if(!this.locked)if(!this.isIE||this.DOMReady){this.locked=!0;var q=!g;q||(q=a>0&&e.length>0);var l,k,o,n,p=[],r=function(t,u){var s=t;u.overrideContext&&(s=!0===u.overrideContext?u.obj:u.overrideContext),u.fn.call(s,u.obj)},m=[];for(l=0,k=e.length;l<k;l+=1)(o=e[l])&&((n=this.getEl(o.id))?o.checkReady?(g||n.nextSibling||!q)&&(m.push(o),e[l]=null):(r(n,o),e[l]=null):p.push(o));for(l=0,k=m.length;l<k;l+=1)o=m[l],r(this.getEl(o.id),o);if(a--,q){for(l=e.length-1;l>-1;l--)(o=e[l])&&o.id||e.splice(l,1);this.startInterval()}else this._interval&&(this._interval.cancel(),this._interval=null);this.locked=!1}else this.startInterval()},purgeElement:function(p,q,s){var o,k,n=YAHOO.lang.isString(p)?this.getEl(p):p,r=this.getListeners(n,s);if(r)for(o=r.length-1;o>-1;o--){var m=r[o];this.removeListener(n,m.type,m.fn)}if(q&&n&&n.childNodes)for(o=0,k=n.childNodes.length;o<k;++o)this.purgeElement(n.childNodes[o],q,s)},getListeners:function(n,k){var m,q=[];k?"unload"===k?m=[j]:(k=this._getType(k),m=[h]):m=[h,j];for(var s=YAHOO.lang.isString(n)?this.getEl(n):n,p=0;p<m.length;p+=1){var u=m[p];if(u)for(var r=0,t=u.length;r<t;++r){var o=u[r];!o||o[this.EL]!==s||k&&k!==o[this.TYPE]||q.push({type:o[this.TYPE],fn:o[this.FN],obj:o[this.OBJ],adjust:o[this.OVERRIDE],scope:o[this.ADJ_SCOPE],index:r})}}return q.length?q:null},_unload:function(s){var p,o,n,r,k,m=YAHOO.util.Event,t=j.slice();for(p=0,r=j.length;p<r;++p)if(n=t[p]){try{k=window,n[m.ADJ_SCOPE]&&(k=!0===n[m.ADJ_SCOPE]?n[m.UNLOAD_OBJ]:n[m.ADJ_SCOPE]),n[m.FN].call(k,m.getEvent(s,n[m.EL]),n[m.UNLOAD_OBJ])}catch(w){}t[p]=null}if(n=null,k=null,j=null,h){for(o=h.length-1;o>-1;o--)if(n=h[o])try{m.removeListener(n[m.EL],n[m.TYPE],n[m.FN],o)}catch(v){}n=null}try{m._simpleRemove(window,"unload",m._unload),m._simpleRemove(window,"load",m._load)}catch(u){}},_getScrollLeft:function(){return this._getScroll()[1]},_getScrollTop:function(){return this._getScroll()[0]},_getScroll:function(){var k=document.documentElement,l=document.body;return k&&(k.scrollTop||k.scrollLeft)?[k.scrollTop,k.scrollLeft]:l?[l.scrollTop,l.scrollLeft]:[0,0]},regCE:function(){},_simpleAdd:window.addEventListener?function(m,n,l,k){m.addEventListener(n,l,k)}:window.attachEvent?function(m,n,l,k){m.attachEvent("on"+n,l)}:function(){},_simpleRemove:window.removeEventListener?function(m,n,l,k){m.removeEventListener(n,l,k)}:window.detachEvent?function(l,m,k){l.detachEvent("on"+m,k)}:function(){}}}(),function(){var a=YAHOO.util.Event;if(a.on=a.addListener,a.onFocus=a.addFocusListener,a.onBlur=a.addBlurListener,a.isIE)if(self!==self.top)document.onreadystatechange=function(){"complete"==document.readyState&&(document.onreadystatechange=null,a._ready())};else{YAHOO.util.Event.onDOMReady(YAHOO.util.Event._tryPreloadAttach,YAHOO.util.Event,!0);var b=document.createElement("p");a._dri=setInterval(function(){try{b.doScroll("left"),clearInterval(a._dri),a._dri=null,a._ready(),b=null}catch(c){}},a.POLL_INTERVAL)}else a.webkit&&a.webkit<525?a._dri=setInterval(function(){var c=document.readyState;"loaded"!=c&&"complete"!=c||(clearInterval(a._dri),a._dri=null,a._ready())},a.POLL_INTERVAL):a._simpleAdd(document,"DOMContentLoaded",a._ready);a._simpleAdd(window,"load",a._load),a._simpleAdd(window,"unload",a._unload),a._tryPreloadAttach()}()),YAHOO.util.EventProvider=function(){},YAHOO.util.EventProvider.prototype={__yui_events:null,__yui_subscribers:null,subscribe:function(a,c,f,e){this.__yui_events=this.__yui_events||{};var d=this.__yui_events[a];if(d)d.subscribe(c,f,e);else{this.__yui_subscribers=this.__yui_subscribers||{};var b=this.__yui_subscribers;b[a]||(b[a]=[]),b[a].push({fn:c,obj:f,overrideContext:e})}},unsubscribe:function(c,e,g){this.__yui_events=this.__yui_events||{};var a=this.__yui_events;if(!c){var b=!0;for(var d in a)YAHOO.lang.hasOwnProperty(a,d)&&(b=b&&a[d].unsubscribe(e,g));return b}var f=a[c];return!!f&&f.unsubscribe(e,g)},unsubscribeAll:function(a){return this.unsubscribe(a)},createEvent:function(b,g){this.__yui_events=this.__yui_events||{};var f,e=g||{},d=this.__yui_events;if(d[b]);else{f=new YAHOO.util.CustomEvent(b,e.scope||this,e.silent,YAHOO.util.CustomEvent.FLAT,e.fireOnce),d[b]=f,e.onSubscribeCallback&&f.subscribeEvent.subscribe(e.onSubscribeCallback),this.__yui_subscribers=this.__yui_subscribers||{};var a=this.__yui_subscribers[b];if(a)for(var c=0;c<a.length;++c)f.subscribe(a[c].fn,a[c].obj,a[c].overrideContext)}return d[b]},fireEvent:function(b){this.__yui_events=this.__yui_events||{};var d=this.__yui_events[b];if(!d)return null;for(var a=[],c=1;c<arguments.length;++c)a.push(arguments[c]);return d.fire.apply(d,a)},hasEvent:function(a){return!(!this.__yui_events||!this.__yui_events[a])}},function(){var a=YAHOO.util.Event,c=YAHOO.lang;YAHOO.util.KeyListener=function(d,i,e,f){function h(o,n){if(i.shift||(i.shift=!1),i.alt||(i.alt=!1),i.ctrl||(i.ctrl=!1),o.shiftKey==i.shift&&o.altKey==i.alt&&o.ctrlKey==i.ctrl){var j,l,m=i.keys;if(YAHOO.lang.isArray(m)){for(var k=0;k<m.length;k++)if(j=m[k],l=a.getCharCode(o),j==l){g.fire(l,o);break}}else m==(l=a.getCharCode(o))&&g.fire(l,o)}}f||(f=YAHOO.util.KeyListener.KEYDOWN);var g=new YAHOO.util.CustomEvent("keyPressed");this.enabledEvent=new YAHOO.util.CustomEvent("enabled"),this.disabledEvent=new YAHOO.util.CustomEvent("disabled"),c.isString(d)&&(d=document.getElementById(d)),c.isFunction(e)?g.subscribe(e):g.subscribe(e.fn,e.scope,e.correctScope),this.enable=function(){this.enabled||(a.on(d,f,h),this.enabledEvent.fire(i)),this.enabled=!0},this.disable=function(){this.enabled&&(a.removeListener(d,f,h),this.disabledEvent.fire(i)),this.enabled=!1},this.toString=function(){return"KeyListener ["+i.keys+"] "+d.tagName+(d.id?"["+d.id+"]":"")}};var b=YAHOO.util.KeyListener;b.KEYDOWN="keydown",b.KEYUP="keyup",b.KEY={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38}}(),YAHOO.register("event",YAHOO.util.Event,{version:"@VERSION@",build:"@BUILD@"}),function(){var b=YAHOO.util.Event,g=YAHOO.lang,e=b.addListener,f=b.removeListener,c=b.getListeners,d=[],h={mouseenter:"mouseover",mouseleave:"mouseout"},a=function(n,m,l){var i,k,j=b._getCacheIndex(d,n,m,l);return j>=0&&(i=d[j]),n&&i&&(k=f.call(b,i[0],m,i[3]))&&(delete d[j][2],delete d[j][3],d.splice(j,1)),k};g.augmentObject(b._specialTypes,h),g.augmentObject(b,{_createMouseDelegate:function(i,j,k){return function(q,m){var o,n,p=this,l=b.getRelatedTarget(q);if(p!=l&&!YAHOO.util.Dom.isAncestor(p,l))return o=p,k&&(o=!0===k?j:k),n=[q,j],m&&n.splice(1,0,p,m),i.apply(o,n)}},addListener:function(m,l,k,n,o){var i,j;return h[l]?((i=b._createMouseDelegate(k,n,o)).mouseDelegate=!0,d.push([m,l,k,i]),j=e.call(b,m,l,i)):j=e.apply(b,arguments),j},removeListener:function(l,k,j){return h[k]?a.apply(b,arguments):f.apply(b,arguments)},getListeners:function(p,o){var r,q,k,j,n=[],m="mouseover"===o||"mouseout"===o;if(o&&(m||h[o])){if(r=c.call(b,p,this._getType(o)))for(k=r.length-1;k>-1;k--)q=(j=r[k]).fn.mouseDelegate,(h[o]&&q||m&&!q)&&n.push(j)}else n=c.apply(b,arguments);return n&&n.length?n:null}},!0),b.on=b.addListener}(),YAHOO.register("event-mouseenter",YAHOO.util.Event,{version:"@VERSION@",build:"@BUILD@"}),function(){var A=YAHOO.util.Event,C=YAHOO.lang,B=[],D=function(H,E,F){return!(!H||H===F)&&(YAHOO.util.Selector.test(H,E)?H:D(H.parentNode,E,F))};C.augmentObject(A,{_createDelegate:function(F,E,G,H){return function(I){var Q,K,O,M,J=this,N=A.getTarget(I),L=E,P=9===J.nodeType;if(C.isFunction(E)?Q=E(N):C.isString(E)&&(P||((O=J.id)||(O=A.generateId(J)),L=((M="#"+O+" ")+E).replace(/,/gi,","+M)),YAHOO.util.Selector.test(N,L)?Q=N:YAHOO.util.Selector.test(N,L.replace(/,/gi," *,")+" *")&&(Q=D(N,L,J))),Q)return K=Q,H&&(K=!0===H?G:H),F.call(K,I,Q,J,G)}},delegate:function(F,J,L,G,H,I){var K,M,E=J;if(C.isString(G)&&!YAHOO.util.Selector)return!1;if("mouseenter"==J||"mouseleave"==J){if(!A._createMouseDelegate)return!1;E=A._getType(J),K=A._createMouseDelegate(L,H,I),M=A._createDelegate(function(P,O,N){return K.call(O,P,N)},G,H,I)}else M=A._createDelegate(L,G,H,I);return B.push([F,E,L,M]),A.on(F,E,M)},removeDelegate:function(F,J,I){var G,E,K=J,H=!1;return"mouseenter"!=J&&"mouseleave"!=J||(K=A._getType(J)),(G=A._getCacheIndex(B,F,K,I))>=0&&(E=B[G]),F&&E&&(H=A.removeListener(E[0],E[1],E[3]))&&(delete B[G][2],delete B[G][3],B.splice(G,1)),H}})}(),YAHOO.register("event-delegate",YAHOO.util.Event,{version:"@VERSION@",build:"@BUILD@"});var Y=YAHOO,Y_DOM=YAHOO.util.Dom,EMPTY_ARRAY=[],Y_UA=Y.env.ua,Y_Lang=Y.lang,Y_DOC=document,Y_DOCUMENT_ELEMENT=Y_DOC.documentElement,Y_DOM_inDoc=Y_DOM.inDocument,Y_mix=Y_Lang.augmentObject,Y_guid=Y_DOM.generateId,Y_getDoc=function(a){var b=Y_DOC;return a&&(b=9===a.nodeType?a:a.ownerDocument||a.document||Y_DOC),b},Y_Array=function(g,d){var c,b,h=d||0;try{return Array.prototype.slice.call(g,h)}catch(f){for(b=[],c=g.length;h<c;h++)b.push(g[h]);return b}},Y_DOM_allById=function(f,a){var d,e,b=[],c=[];if((a=a||Y_DOC).querySelectorAll)c=a.querySelectorAll('[id="'+f+'"]');else if(a.all){if((b=a.all(f))&&(b.nodeName&&(b.id===f?(c.push(b),b=EMPTY_ARRAY):b=[b]),b.length))for(d=0;e=b[d++];)(e.id===f||e.attributes&&e.attributes.id&&e.attributes.id.value===f)&&c.push(e)}else c=[Y_getDoc(a).getElementById(f)];return c},COMPARE_DOCUMENT_POSITION="compareDocumentPosition",OWNER_DOCUMENT="ownerDocument",Selector={_foundCache:[],useNative:!0,_compare:"sourceIndex"in Y_DOCUMENT_ELEMENT?function(f,e){var d=f.sourceIndex,c=e.sourceIndex;return d===c?0:d>c?1:-1}:Y_DOCUMENT_ELEMENT[COMPARE_DOCUMENT_POSITION]?function(b,a){return 4&b[COMPARE_DOCUMENT_POSITION](a)?-1:1}:function(e,d){var c,a,b;return e&&d&&((c=e[OWNER_DOCUMENT].createRange()).setStart(e,0),(a=d[OWNER_DOCUMENT].createRange()).setStart(d,0),b=c.compareBoundaryPoints(1,a)),b},_sort:function(a){return a&&(a=Y_Array(a,0,!0)).sort&&a.sort(Selector._compare),a},_deDupe:function(a){var c,d,b=[];for(c=0;d=a[c++];)d._found||(b[b.length]=d,d._found=!0);for(c=0;d=b[c++];)d._found=null,d.removeAttribute("_found");return b},query:function(b,j,k,a){if(j&&"string"==typeof j){if(!(j=Y_DOM.get(j)))return k?null:[]}else j=j||Y_DOC;var g,l,d,f=[],c=Selector.useNative&&Y_DOC.querySelector&&!a,e=[[b,j]],h=c?Selector._nativeQuery:Selector._bruteQuery;if(b&&h){for(a||c&&!j.tagName||(e=Selector._splitQueries(b,j)),d=0;g=e[d++];)l=h(g[0],g[1],k),k||(l=Y_Array(l,0,!0)),l&&(f=f.concat(l));e.length>1&&(f=Selector._sort(Selector._deDupe(f)))}return k?f[0]||null:f},_splitQueries:function(c,f){var e,a,b=c.split(","),d=[],g="";if(f)for(f.tagName&&(f.id=f.id||Y_guid(),g='[id="'+f.id+'"] '),e=0,a=b.length;e<a;++e)c=g+b[e],d.push([c,f]);return d},_nativeQuery:function(a,b,c){if(Y_UA.webkit&&a.indexOf(":checked")>-1&&Selector.pseudos&&Selector.pseudos.checked)return Selector.query(a,b,c,!0);try{return b["querySelector"+(c?"":"All")](a)}catch(d){return Selector.query(a,b,c,!0)}},filter:function(b,a){var d,e,c=[];if(b&&a)for(d=0;e=b[d++];)Selector.test(e,a)&&(c[c.length]=e);return c},test:function(c,d,k){var l,o,h,n,f,e,m,g=!1,b=d.split(","),a=!1;if(c&&c.tagName){for(k||Y_DOM_inDoc(c)||((l=c.parentNode)?k=l:((n=c[OWNER_DOCUMENT].createDocumentFragment()).appendChild(c),k=n,a=!0)),k=k||c[OWNER_DOCUMENT],c.id||(c.id=Y_guid()),f=0;m=b[f++];){for(m+='[id="'+c.id+'"]',h=Selector.query(m,k),e=0;o=h[e++];)if(o===c){g=!0;break}if(g)break}a&&n.removeChild(c)}return g}};YAHOO.util.Selector=Selector;var PARENT_NODE="parentNode",TAG_NAME="tagName",ATTRIBUTES="attributes",COMBINATOR="combinator",PSEUDOS="pseudos",SelectorCSS2={_reRegExpTokens:/([\^\$\?\[\]\*\+\-\.\(\)\|\\])/,SORT_RESULTS:!0,_children:function(e,a){var d,f,g,b=e.children;if(e.children&&a&&e.children.tags)e.children.tags(a);else if(!b&&e[TAG_NAME]||b&&a)for(f=b||e.childNodes,b=[],d=0;g=f[d++];)g.tagName&&(a&&a!==g.tagName||b.push(g));return b||[]},_re:{attr:/(\[[^\]]*\])/g,esc:/\\[:\[\]\(\)#\.\'\>+~"]/gi,pseudos:/(\([^\)]*\))/g},shorthand:{"\\#(-?[_a-z]+[-\\w\\uE000]*)":"[id=$1]","\\.(-?[_a-z]+[-\\w\\uE000]*)":"[className~=$1]"},operators:{"":function(b,a){return!!b.getAttribute(a)},"~=":"(?:^|\\s+){val}(?:\\s+|$)","|=":"^{val}(?:-|$)"},pseudos:{"first-child":function(a){return Selector._children(a[PARENT_NODE])[0]===a}},_bruteQuery:function(f,j,l){var c,b,h,d,g=[],a=[],i=Selector._tokenize(f),e=i[i.length-1];Y_getDoc(j);if(e){if(b=e.id,h=e.className,d=e.tagName||"*",j.getElementsByTagName)a=b&&(j.all||9===j.nodeType||Y_DOM_inDoc(j))?Y_DOM_allById(b,j):h?j.getElementsByClassName(h):j.getElementsByTagName(d);else for(c=j.firstChild;c;)c.tagName&&a.push(c),c=c.nextSilbing||c.firstChild;a.length&&(g=Selector._filterNodes(a,i,l))}return g},_filterNodes:function(l,f,h){var q,d,p,c,g,m,b,u,r=0,s=f.length,k=s-1,e=[],o=l[0],v=o,t=Selector.getters;for(r=0;v=o=l[r++];){k=s-1,g=null;testLoop:for(;v&&v.tagName;){if(c=f[k],b=c.tests,q=b.length)for(;u=b[--q];)if(d=u[1],t[u[0]]?m=t[u[0]](v,u[0]):void 0===(m=v[u[0]])&&v.getAttribute&&(m=v.getAttribute(u[0])),"="===d&&m!==u[2]||"string"!=typeof d&&d.test&&!d.test(m)||!d.test&&"function"==typeof d&&!d(v,u[0],u[2])){if(v=v[g])for(;v&&(!v.tagName||c.tagName&&c.tagName!==v.tagName);)v=v[g];continue testLoop}if(k--,!(p=c.combinator)){if(e.push(o),h)return e;break}for(v=v[g=p.axis];v&&!v.tagName;)v=v[g];p.direct&&(g=null)}}return o=v=null,e},combinators:{" ":{axis:"parentNode"},">":{axis:"parentNode",direct:!0},"+":{axis:"previousSibling",direct:!0}},_parsers:[{name:ATTRIBUTES,re:/^\uE003(-?[a-z]+[\w\-]*)+([~\|\^\$\*!=]=?)?['"]?([^\uE004'"]*)['"]?\uE004/i,fn:function(d,e){var f,c=d[2]||"",a=Selector.operators,b=d[3]?d[3].replace(/\\/g,""):"";if(("id"===d[1]&&"="===c||"className"===d[1]&&Y_DOCUMENT_ELEMENT.getElementsByClassName&&("~="===c||"="===c))&&(e.prefilter=d[1],d[3]=b,e[d[1]]="id"===d[1]?d[3]:b),c in a&&("string"==typeof(f=a[c])&&(d[3]=b.replace(Selector._reRegExpTokens,"\\$1"),f=new RegExp(f.replace("{val}",d[3]))),d[2]=f),!e.last||e.prefilter!==d[1])return d.slice(1)}},{name:TAG_NAME,re:/^((?:-?[_a-z]+[\w-]*)|\*)/i,fn:function(b,c){var a=b[1].toUpperCase();if(c.tagName=a,"*"!==a&&(!c.last||c.prefilter))return[TAG_NAME,"=",a];c.prefilter||(c.prefilter="tagName")}},{name:COMBINATOR,re:/^\s*([>+~]|\s)\s*/,fn:function(a,b){}},{name:PSEUDOS,re:/^:([\-\w]+)(?:\uE005['"]?([^\uE005]*)['"]?\uE006)*/i,fn:function(a,b){var c=Selector[PSEUDOS][a[1]];return!!c&&(a[2]&&(a[2]=a[2].replace(/\\/g,"")),[a[2],c])}}],_getToken:function(a){return{tagName:null,id:null,className:null,attributes:{},combinator:null,tests:[]}},_tokenize:function(c){c=c||"",c=Selector._replaceShorthand(Y_Lang.trim(c));var e,f,d,a,b=Selector._getToken(),g=[],j=!1;outer:do{for(j=!1,d=0;a=Selector._parsers[d++];)if(e=a.re.exec(c)){if(a.name!==COMBINATOR&&(b.selector=c),(c=c.replace(e[0],"")).length||(b.last=!0),Selector._attrFilters[e[1]]&&(e[1]=Selector._attrFilters[e[1]]),!1===(f=a.fn(e,b))){j=!1;break outer}f&&b.tests.push(f),c.length&&a.name!==COMBINATOR||(g.push(b),b=Selector._getToken(b),a.name===COMBINATOR&&(b.combinator=Selector.combinators[e[1]])),j=!0}}while(j&&c.length);return j&&!c.length||(g=[]),g},_replaceShorthand:function(b){var e,h,g,f,a,d=Selector.shorthand,c=b.match(Selector._re.esc);c&&(b=b.replace(Selector._re.esc,"")),e=b.match(Selector._re.attr),h=b.match(Selector._re.pseudos),e&&(b=b.replace(Selector._re.attr,"")),h&&(b=b.replace(Selector._re.pseudos,""));for(g in d)d.hasOwnProperty(g)&&(b=b.replace(new RegExp(g,"gi"),d[g]));if(e)for(f=0,a=e.length;f<a;++f)b=b.replace(/\uE001/,e[f]);if(h)for(f=0,a=h.length;f<a;++f)b=b.replace(/\uE002/,h[f]);if(b=b.replace(/\[/g,""),b=b.replace(/\]/g,""),b=b.replace(/\(/g,""),b=b.replace(/\)/g,""),c)for(f=0,a=c.length;f<a;++f)b=b.replace("",c[f]);return b},_attrFilters:{class:"className",for:"htmlFor"},getters:{href:function(b,a){return Y_DOM.getAttribute(b,a)}}};Y_mix(Selector,SelectorCSS2,!0),Selector.getters.src=Selector.getters.rel=Selector.getters.href,Selector.useNative&&Y_DOC.querySelector&&(Selector.shorthand["\\.([^\\s\\\\(\\[:]*)"]="[class~=$1]"),Selector._reNth=/^(?:([\-]?\d*)(n){1}|(odd|even)$)*([\-+]?\d*)$/,Selector._getNth=function(d,o,q,h){Selector._reNth.test(o);var m=parseInt(RegExp.$1,10),c=RegExp.$2,j=RegExp.$3,k=parseInt(RegExp.$4,10)||0,l=Selector._children(d.parentNode,q);if(j?(m=2,"+",c="n",k="odd"===j?1:0):isNaN(m)&&(m=c?1:0),0===m)return h&&(k=l.length-k+1),l[k-1]===d;if(m<0&&(h=!!h,m=Math.abs(m)),h){for(var e=l.length-k,g=l.length;e>=0;e-=m)if(e<g&&l[e]===d)return!0}else for(var e=k-1,g=l.length;e<g;e+=m)if(e>=0&&l[e]===d)return!0;return!1},Y_mix(Selector.pseudos,{root:function(a){return a===a.ownerDocument.documentElement},"nth-child":function(a,b){return Selector._getNth(a,b)},"nth-last-child":function(a,b){return Selector._getNth(a,b,null,!0)},"nth-of-type":function(a,b){return Selector._getNth(a,b,a.tagName)},"nth-last-of-type":function(a,b){return Selector._getNth(a,b,a.tagName,!0)},"last-child":function(b){var a=Selector._children(b.parentNode);return a[a.length-1]===b},"first-of-type":function(a){return Selector._children(a.parentNode,a.tagName)[0]===a},"last-of-type":function(b){var a=Selector._children(b.parentNode,b.tagName);return a[a.length-1]===b},"only-child":function(b){var a=Selector._children(b.parentNode);return 1===a.length&&a[0]===b},"only-of-type":function(b){var a=Selector._children(b.parentNode,b.tagName);return 1===a.length&&a[0]===b},empty:function(a){return 0===a.childNodes.length},not:function(a,b){return!Selector.test(a,b)},contains:function(a,b){return(a.innerText||a.textContent||"").indexOf(b)>-1},checked:function(a){return!0===a.checked||!0===a.selected},enabled:function(a){return void 0!==a.disabled&&!a.disabled},disabled:function(a){return a.disabled}}),Y_mix(Selector.operators,{"^=":"^{val}","!=":function(b,a,c){return b[a]!==c},"$=":"{val}$","*=":"{val}"}),Selector.combinators["~"]={axis:"previousSibling"},YAHOO.register("selector",YAHOO.util.Selector,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.lang.JSON=function(){function _revive(data,reviver){var walk=function(o,key){var k,v,value=o[key];if(value&&"object"==typeof value)for(k in value)l.hasOwnProperty(value,k)&&(void 0===(v=walk(value,k))?delete value[k]:value[k]=v);return reviver.call(o,key,value)};return"function"==typeof reviver?walk({"":data},""):data}function _char(c){return _CHARS[c]||(_CHARS[c]="\\u"+("0000"+(+c.charCodeAt(0)).toString(16)).slice(-4)),_CHARS[c]}function _prepare(s){return s.replace(_UNICODE_EXCEPTIONS,_char)}function _isValid(str){return l.isString(str)&&_INVALID.test(str.replace(_ESCAPES,"@").replace(_VALUES,"]").replace(_BRACKETS,""))}function _string(s){return'"'+s.replace(_SPECIAL_CHARS,_char)+'"'}function _stringify(h,key,d,w,pstack){var i,len,j,k,v,isArray,a,o="function"==typeof w?w.call(h,key,h[key]):h[key];switch(o instanceof Date?o=l.JSON.dateToString(o):(o instanceof String||o instanceof Boolean||o instanceof Number)&&(o=o.valueOf()),typeof o){case"string":return _string(o);case"number":return isFinite(o)?String(o):"null";case"boolean":return String(o);case"object":if(null===o)return"null";for(i=pstack.length-1;i>=0;--i)if(pstack[i]===o)return"null";if(pstack[pstack.length]=o,a=[],isArray=l.isArray(o),d>0)if(isArray)for(i=o.length-1;i>=0;--i)a[i]=_stringify(o,i,d-1,w,pstack)||"null";else{if(j=0,l.isArray(w))for(i=0,len=w.length;i<len;++i)(v=_stringify(o,k=w[i],d-1,w,pstack))&&(a[j++]=_string(k)+":"+v);else for(k in o)"string"==typeof k&&l.hasOwnProperty(o,k)&&(v=_stringify(o,k,d-1,w,pstack))&&(a[j++]=_string(k)+":"+v);a.sort()}return pstack.pop(),isArray?"["+a.join(",")+"]":"{"+a.join(",")+"}"}}var l=YAHOO.lang,_UNICODE_EXCEPTIONS=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_ESCAPES=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,_VALUES=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_BRACKETS=/(?:^|:|,)(?:\s*\[)+/g,_INVALID=/^[\],:{}\s]*$/,_SPECIAL_CHARS=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_CHARS={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{isValid:function(s){return _isValid(_prepare(s))},parse:function(s,reviver){if(s=_prepare(s),_isValid(s))return _revive(eval("("+s+")"),reviver);throw new SyntaxError("parseJSON")},stringify:function(o,w,d){if(void 0!==o)return l.isArray(w)&&(w=function(a){var v,i,j,len,uniq=[],map={};for(i=0,j=0,len=a.length;i<len;++i)"string"==typeof(v=a[i])&&void 0===map[v]&&(uniq[map[v]=j++]=v);return uniq}(w)),d=d>=0?d:1/0,_stringify({"":o},"",d,w,[])},dateToString:function(d){function _zeroPad(v){return v<10?"0"+v:v}return d.getUTCFullYear()+"-"+_zeroPad(d.getUTCMonth()+1)+"-"+_zeroPad(d.getUTCDate())+"T"+_zeroPad(d.getUTCHours())+":"+_zeroPad(d.getUTCMinutes())+":"+_zeroPad(d.getUTCSeconds())+"Z"},stringToDate:function(str){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z$/.test(str)){var d=new Date;return d.setUTCFullYear(RegExp.$1,(0|RegExp.$2)-1,RegExp.$3),d.setUTCHours(RegExp.$4,RegExp.$5,RegExp.$6),d}return str}}}(),YAHOO.register("json",YAHOO.lang.JSON,{version:"2.7.0",build:"1796"}),YAHOO.util.Connect={_msxml_progid:["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],_http_headers:{},_has_http_headers:!1,_use_default_post_header:!0,_default_post_header:"application/x-www-form-urlencoded; charset=UTF-8",_default_form_header:"application/x-www-form-urlencoded",_use_default_xhr_header:!0,_default_xhr_header:"XMLHttpRequest",_has_default_headers:!0,_isFormSubmit:!1,_default_headers:{},_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,startEvent:new YAHOO.util.CustomEvent("start"),completeEvent:new YAHOO.util.CustomEvent("complete"),successEvent:new YAHOO.util.CustomEvent("success"),failureEvent:new YAHOO.util.CustomEvent("failure"),abortEvent:new YAHOO.util.CustomEvent("abort"),_customEvents:{onStart:["startEvent","start"],onComplete:["completeEvent","complete"],onSuccess:["successEvent","success"],onFailure:["failureEvent","failure"],onUpload:["uploadEvent","upload"],onAbort:["abortEvent","abort"]},setProgId:function(a){this._msxml_progid.unshift(a)},setDefaultPostHeader:function(a){"string"==typeof a?(this._default_post_header=a,this._use_default_post_header=!0):"boolean"==typeof a&&(this._use_default_post_header=a)},setDefaultXhrHeader:function(a){"string"==typeof a?this._default_xhr_header=a:this._use_default_xhr_header=a},setPollingInterval:function(a){"number"==typeof a&&isFinite(a)&&(this._polling_interval=a)},createXhrObject:function(g){var d,a,b;try{a=new XMLHttpRequest,d={conn:a,tId:g,xhr:!0}}catch(c){for(b=0;b<this._msxml_progid.length;++b)try{a=new ActiveXObject(this._msxml_progid[b]),d={conn:a,tId:g,xhr:!0};break}catch(f){}}finally{return d}},getConnectionObject:function(a){var c,d=this._transaction_id;try{a?(c={tId:d},"xdr"===a?(c.conn=this._transport,c.xdr=!0):"upload"===a&&(c.upload=!0)):c=this.createXhrObject(d),c&&this._transaction_id++}catch(b){}return c},asyncRequest:function(h,d,g,a){var f,c,b=g&&g.argument?g.argument:null,e=this;if(this._isFileUpload?c="upload":g&&g.xdr&&(c="xdr"),f=this.getConnectionObject(c)){if(g&&g.customevents&&this.initCustomEvents(f,g),this._isFormSubmit){if(this._isFileUpload)return window.setTimeout(function(){e.uploadFile(f,g,d,a)},10),f;"GET"==h.toUpperCase()?0!==this._sFormData.length&&(d+=(-1==d.indexOf("?")?"?":"&")+this._sFormData):"POST"==h.toUpperCase()&&(a=a?this._sFormData+"&"+a:this._sFormData)}return"GET"==h.toUpperCase()&&g&&!1===g.cache&&(d+=(-1==d.indexOf("?")?"?":"&")+"rnd="+(new Date).valueOf().toString()),this._use_default_xhr_header&&(this._default_headers["X-Requested-With"]||this.initHeader("X-Requested-With",this._default_xhr_header,!0)),"POST"===h.toUpperCase()&&this._use_default_post_header&&!1===this._isFormSubmit&&this.initHeader("Content-Type",this._default_post_header),f.xdr?(this.xdr(f,h,d,g,a),f):(f.conn.open(h,d,!0),(this._has_default_headers||this._has_http_headers)&&this.setHeader(f),this.handleReadyState(f,g),f.conn.send(a||""),!0===this._isFormSubmit&&this.resetFormState(),this.startEvent.fire(f,b),f.startEvent&&f.startEvent.fire(f,b),f)}return null},initCustomEvents:function(a,c){var b;for(b in c.customevents)this._customEvents[b][0]&&(a[this._customEvents[b][0]]=new YAHOO.util.CustomEvent(this._customEvents[b][1],c.scope?c.scope:null),a[this._customEvents[b][0]].subscribe(c.customevents[b]))},handleReadyState:function(c,d){var b=this,a=d&&d.argument?d.argument:null;d&&d.timeout&&(this._timeOut[c.tId]=window.setTimeout(function(){b.abort(c,d,!0)},d.timeout)),this._poll[c.tId]=window.setInterval(function(){c.conn&&4===c.conn.readyState&&(window.clearInterval(b._poll[c.tId]),delete b._poll[c.tId],d&&d.timeout&&(window.clearTimeout(b._timeOut[c.tId]),delete b._timeOut[c.tId]),b.completeEvent.fire(c,a),c.completeEvent&&c.completeEvent.fire(c,a),b.handleTransactionResponse(c,d))},this._polling_interval)},handleTransactionResponse:function(b,j,d){var f,a,h=j&&j.argument?j.argument:null,c=!(!b.r||"xdr:success"!==b.r.statusText),i=!(!b.r||"xdr:failure"!==b.r.statusText),k=d;try{f=void 0!==b.conn.status&&0!==b.conn.status||c?b.conn.status:i&&!k?0:13030}catch(g){f=13030}if(f>=200&&f<300||1223===f||c)a=b.xdr?b.r:this.createResponseObject(b,h),j&&j.success&&(j.scope?j.success.apply(j.scope,[a]):j.success(a)),this.successEvent.fire(a),b.successEvent&&b.successEvent.fire(a);else{switch(f){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:a=this.createExceptionObject(b.tId,h,d||!1),j&&j.failure&&(j.scope?j.failure.apply(j.scope,[a]):j.failure(a));break;default:a=b.xdr?b.response:this.createResponseObject(b,h),j&&j.failure&&(j.scope?j.failure.apply(j.scope,[a]):j.failure(a))}this.failureEvent.fire(a),b.failureEvent&&b.failureEvent.fire(a)}this.releaseObject(b),a=null},createResponseObject:function(a,h){var f,c,g,b,d={},k={};try{for(g=(c=a.conn.getAllResponseHeaders()).split("\n"),f=0;f<g.length;f++)-1!=(b=g[f].indexOf(":"))&&(k[g[f].substring(0,b)]=YAHOO.lang.trim(g[f].substring(b+2)))}catch(j){}return d.tId=a.tId,d.status=1223==a.conn.status?204:a.conn.status,d.statusText=1223==a.conn.status?"No Content":a.conn.statusText,d.getResponseHeader=k,d.getAllResponseHeaders=c,d.responseText=a.conn.responseText,d.responseXML=a.conn.responseXML,h&&(d.argument=h),d},createExceptionObject:function(h,d,a){var e={};return e.tId=h,a?(e.status=-1,e.statusText="transaction aborted"):(e.status=0,e.statusText="communication failure"),d&&(e.argument=d),e},initHeader:function(a,d,c){(c?this._default_headers:this._http_headers)[a]=d,c?this._has_default_headers=!0:this._has_http_headers=!0},setHeader:function(a){var b;if(this._has_default_headers)for(b in this._default_headers)YAHOO.lang.hasOwnProperty(this._default_headers,b)&&a.conn.setRequestHeader(b,this._default_headers[b]);if(this._has_http_headers){for(b in this._http_headers)YAHOO.lang.hasOwnProperty(this._http_headers,b)&&a.conn.setRequestHeader(b,this._http_headers[b]);this._http_headers={},this._has_http_headers=!1}},resetDefaultHeaders:function(){this._default_headers={},this._has_default_headers=!1},abort:function(e,g,a){var d,b=g&&g.argument?g.argument:null;if((e=e||{}).conn)e.xhr?this.isCallInProgress(e)&&(e.conn.abort(),window.clearInterval(this._poll[e.tId]),delete this._poll[e.tId],a&&(window.clearTimeout(this._timeOut[e.tId]),delete this._timeOut[e.tId]),d=!0):e.xdr&&(e.conn.abort(e.tId),d=!0);else if(e.upload){var c="yuiIO"+e.tId,f=document.getElementById(c);f&&(YAHOO.util.Event.removeListener(f,"load"),document.body.removeChild(f),a&&(window.clearTimeout(this._timeOut[e.tId]),delete this._timeOut[e.tId]),d=!0)}else d=!1;return!0===d&&(this.abortEvent.fire(e,b),e.abortEvent&&e.abortEvent.fire(e,b),this.handleTransactionResponse(e,g,!0)),d},isCallInProgress:function(a){return(a=a||{}).xhr&&a.conn?4!==a.conn.readyState&&0!==a.conn.readyState:a.xdr&&a.conn?a.conn.isCallInProgress(a.tId):!0===a.upload&&!!document.getElementById("yuiIO"+a.tId)},releaseObject:function(a){a&&a.conn&&(a.conn=null,a=null)}},function(){function d(i){var j='<object id="YUIConnectionSwf" type="application/x-shockwave-flash" data="'+i+'" width="0" height="0"><param name="movie" value="'+i+'"><param name="allowScriptAccess" value="always"></object>',k=document.createElement("div");document.body.appendChild(k),k.innerHTML=j}function a(j,i){j&&(g.startEvent.fire(j,i.argument),j.startEvent&&j.startEvent.fire(j,i.argument))}var g=YAHOO.util.Connect,h={};g.xdr=function(l,i,j,n,k){h[parseInt(l.tId)]={o:l,c:n},k&&(n.method=i,n.data=k),l.conn.send(j,n,l.tId)},g.swf=d,g.transport=function(i){d(i),g._transport=document.getElementById("YUIConnectionSwf")},g.xdrReadyEvent=new YAHOO.util.CustomEvent("xdrReady"),g.xdrReady=function(){g.xdrReadyEvent.fire()},g.handleXdrResponse=function(j){var k=h[j.tId].o,i=h[j.tId].c;"xdr:start"!==j.statusText?(j.responseText=decodeURI(j.responseText),k.r=j,i.argument&&(k.r.argument=i.argument),this.handleTransactionResponse(k,i,"xdr:abort"===j.statusText),delete h[j.tId]):a(k,i)}}(),function(){var e=YAHOO.util.Connect,g=YAHOO.util.Event,a=!!document.documentMode&&document.documentMode;e._isFileUpload=!1,e._formNode=null,e._sFormData=null,e._submitElementValue=null,e.uploadEvent=new YAHOO.util.CustomEvent("upload"),e._hasSubmitListener=!!g&&(g.addListener(document,"click",function(k){var j=g.getTarget(k),i=j.nodeName.toLowerCase();"input"!==i&&"button"!==i||!j.type||"submit"!=j.type.toLowerCase()||(e._submitElementValue=encodeURIComponent(j.name)+"="+encodeURIComponent(j.value))}),!0),e.setForm=function(w,r,m){var v,l,u,s,z,o,q,n,x,k,t=!1,p=[],y=0;if(this.resetFormState(),"string"==typeof w)v=document.getElementById(w)||document.forms[w];else{if("object"!=typeof w)return;v=w}if(r)return this.createFrame(m||null),this._isFormSubmit=!0,this._isFileUpload=!0,void(this._formNode=v);for(o=0,q=v.elements.length;o<q;++o)if(l=v.elements[o],z=l.disabled,u=l.name,!z&&u)switch(u=encodeURIComponent(u)+"=",s=encodeURIComponent(l.value),l.type){case"select-one":l.selectedIndex>-1&&(k=l.options[l.selectedIndex],p[y++]=u+encodeURIComponent(k.attributes.value&&k.attributes.value.specified?k.value:k.text));break;case"select-multiple":if(l.selectedIndex>-1)for(n=l.selectedIndex,x=l.options.length;n<x;++n)(k=l.options[n]).selected&&(p[y++]=u+encodeURIComponent(k.attributes.value&&k.attributes.value.specified?k.value:k.text));break;case"radio":case"checkbox":l.checked&&(p[y++]=u+s);break;case"file":case void 0:case"reset":case"button":break;case"submit":!1===t&&(this._hasSubmitListener&&this._submitElementValue&&(p[y++]=this._submitElementValue),t=!0);break;default:p[y++]=u+s}return this._isFormSubmit=!0,this._sFormData=p.join("&"),this.initHeader("Content-Type",this._default_form_header),this._sFormData},e.resetFormState=function(){this._isFormSubmit=!1,this._isFileUpload=!1,this._formNode=null,this._sFormData=""},e.createFrame=function(i){var k,j="yuiIO"+this._transaction_id,l=9===a;YAHOO.env.ua.ie&&!l?(k=document.createElement('<iframe id="'+j+'" name="'+j+'" />'),"boolean"==typeof i&&(k.src="javascript:false")):((k=document.createElement("iframe")).id=j,k.name=j),k.style.position="absolute",k.style.top="-1000px",k.style.left="-1000px",document.body.appendChild(k)},e.appendPostData=function(j){var l,n,m=[],k=j.split("&");for(l=0;l<k.length;l++)-1!=(n=k[l].indexOf("="))&&(m[l]=document.createElement("input"),m[l].type="hidden",m[l].name=decodeURIComponent(k[l].substring(0,n)),m[l].value=decodeURIComponent(k[l].substring(n+1)),this._formNode.appendChild(m[l]));return m},e.uploadFile=function(m,y,n,l){var x,s,k,r,j,q,t="yuiIO"+m.tId,u="multipart/form-data",w=document.getElementById(t),p=a>=8,z=this,v=y&&y.argument?y.argument:null;if(j={action:this._formNode.getAttribute("action"),method:this._formNode.getAttribute("method"),target:this._formNode.getAttribute("target")},this._formNode.setAttribute("action",n),this._formNode.setAttribute("method","POST"),this._formNode.setAttribute("target",t),YAHOO.env.ua.ie&&!p?this._formNode.setAttribute("encoding",u):this._formNode.setAttribute("enctype",u),l&&(x=this.appendPostData(l)),this._formNode.submit(),this.startEvent.fire(m,v),m.startEvent&&m.startEvent.fire(m,v),y&&y.timeout&&(this._timeOut[m.tId]=window.setTimeout(function(){z.abort(m,y,!0)},y.timeout)),x&&x.length>0)for(s=0;s<x.length;s++)this._formNode.removeChild(x[s]);for(k in j)YAHOO.lang.hasOwnProperty(j,k)&&(j[k]?this._formNode.setAttribute(k,j[k]):this._formNode.removeAttribute(k));this.resetFormState(),q=function(){var i,A,B;y&&y.timeout&&(window.clearTimeout(z._timeOut[m.tId]),delete z._timeOut[m.tId]),z.completeEvent.fire(m,v),m.completeEvent&&m.completeEvent.fire(m,v),r={tId:m.tId,argument:v};try{i=w.contentWindow.document.getElementsByTagName("body")[0],A=w.contentWindow.document.getElementsByTagName("pre")[0],i&&(B=A?A.textContent?A.textContent:A.innerText:i.textContent?i.textContent:i.innerText),r.responseText=B,r.responseXML=w.contentWindow.document.XMLDocument?w.contentWindow.document.XMLDocument:w.contentWindow.document}catch(o){}y&&y.upload&&(y.scope?y.upload.apply(y.scope,[r]):y.upload(r)),z.uploadEvent.fire(r),m.uploadEvent&&m.uploadEvent.fire(r),g.removeListener(w,"load",q),setTimeout(function(){document.body.removeChild(w),z.releaseObject(m)},100)},g.addListener(w,"load",q)}}(),YAHOO.register("connection",YAHOO.util.Connect,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.util.Get=function(){var q,d,e,m={},k=0,r=0,l=!1,n=YAHOO.env.ua,s=YAHOO.lang,i=function(x,t,y){var v,A=(y||window).document.createElement(x);for(v in t)t.hasOwnProperty(v)&&A.setAttribute(v,t[v]);return A},h=function(u,v,t){var w={id:"yui__dyn_"+r++,type:"text/css",rel:"stylesheet",href:u};return t&&s.augmentObject(w,t),i("link",w,v)},p=function(u,v,t){var w={id:"yui__dyn_"+r++,type:"text/javascript",src:u};return t&&s.augmentObject(w,t),i("script",w,v)},a=function(t,u){return{tId:t.tId,win:t.win,data:t.data,nodes:t.nodes,msg:u,purge:function(){d(this.tId)}}},b=function(t,w){var u=m[w],v=s.isString(t)?u.win.document.getElementById(t):t;return v||q(w,"target node not found: "+t),v},c=function(w){var v,t,u=m[w];if(u.finished=!0,u.aborted)return v="transaction "+w+" was aborted",void q(w,v);u.onSuccess&&(t=u.scope||u.win,u.onSuccess.call(t,a(u)))},o=function(v){var t,u=m[v];u.onTimeout&&(t=u.scope||u,u.onTimeout.call(t,a(u)))},f=function(v,A){var x,y,t,E,z,u=m[v],D=u.win,B=D.document.getElementsByTagName("head")[0];if(u.timer&&u.timer.cancel(),u.aborted)return y="transaction "+v+" was aborted",void q(v,y);if(A?(u.url.shift(),u.varName&&u.varName.shift()):(u.url=s.isString(u.url)?[u.url]:u.url,u.varName&&(u.varName=s.isString(u.varName)?[u.varName]:u.varName)),0!==u.url.length){if(!(t=u.url[0]))return u.url.shift(),f(v);u.timeout&&(u.timer=s.later(u.timeout,u,o,v)),x="script"===u.type?p(t,D,u.attributes):h(t,D,u.attributes),e(u.type,x,v,t,D,u.url.length),u.nodes.push(x),u.insertBefore?(E=b(u.insertBefore,v))&&E.parentNode.insertBefore(x,E):B.appendChild(x),(n.webkit||n.gecko)&&"css"===u.type&&f(v,t)}else"script"===u.type&&n.webkit&&n.webkit<420&&!u.finalpass&&!u.varName?((z=p(null,u.win,u.attributes)).innerHTML='YAHOO.util.Get._finalize("'+v+'");',u.nodes.push(z),B.appendChild(z)):c(v)},j=function(){if(!l){l=!0;var t,u;for(t in m)m.hasOwnProperty(t)&&(u=m[t]).autopurge&&u.finished&&(d(u.tId),delete m[t]);l=!1}},g=function(u,t,v){var w,x="q"+k++;return v=v||{},k%YAHOO.util.Get.PURGE_THRESH==0&&j(),m[x]=s.merge(v,{tId:x,type:u,url:t,finished:!1,aborted:!1,nodes:[]}),w=m[x],w.win=w.win||window,w.scope=w.scope||w.win,w.autopurge="autopurge"in w?w.autopurge:"script"===u,w.attributes=w.attributes||{},w.attributes.charset=v.charset||w.attributes.charset||"utf-8",s.later(0,w,f,x),{tId:x}};return e=function(H,z,x,u,D,E,G){var B,t,I,v,J,A,C,y,F=G||f;n.ie?z.onreadystatechange=function(){"loaded"!==(B=this.readyState)&&"complete"!==B||(z.onreadystatechange=null,F(x,u))}:n.webkit?"script"===H&&(n.webkit>=420?z.addEventListener("load",function(){F(x,u)}):(t=m[x]).varName?(v=YAHOO.util.Get.POLL_FREQ,t.maxattempts=YAHOO.util.Get.TIMEOUT/v,t.attempts=0,t._cache=t.varName[0].split("."),t.timer=s.later(v,t,function(w){for(I=this._cache,A=I.length,J=this.win,C=0;C<A;C+=1)if(!(J=J[I[C]]))return this.attempts++,void(this.attempts++>this.maxattempts&&(y="Over retry limit, giving up",t.timer.cancel(),q(x,y)));t.timer.cancel(),F(x,u)},null,!0)):s.later(YAHOO.util.Get.POLL_FREQ,null,F,[x,u])):z.onload=function(){F(x,u)}},q=function(w,v){var t,u=m[w];u.onFailure&&(t=u.scope||u.win,u.onFailure.call(t,a(u,v)))},d=function(z){if(m[z]){var v,y,w,B,t=m[z],u=t.nodes,x=u.length,A=t.win.document.getElementsByTagName("head")[0];for(t.insertBefore&&(v=b(t.insertBefore,z))&&(A=v.parentNode),y=0;y<x;y+=1){if((w=u[y]).clearAttributes)w.clearAttributes();else for(B in w)w.hasOwnProperty(B)&&delete w[B];A.removeChild(w)}t.nodes=[]}},{POLL_FREQ:10,PURGE_THRESH:20,TIMEOUT:2e3,_finalize:function(t){s.later(0,null,c,t)},abort:function(u){var v=s.isString(u)?u:u.tId,t=m[v];t&&(t.aborted=!0)},script:function(t,u){return g("script",t,u)},css:function(t,u){return g("css",t,u)}}}(),YAHOO.register("get",YAHOO.util.Get,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.namespace("util"),YAHOO.util.Cookie={_createCookieString:function(B,D,C,A){var F=YAHOO.lang,E=encodeURIComponent(B)+"="+(C?encodeURIComponent(D):D);return F.isObject(A)&&(A.expires instanceof Date&&(E+="; expires="+A.expires.toUTCString()),F.isString(A.path)&&""!==A.path&&(E+="; path="+A.path),F.isString(A.domain)&&""!==A.domain&&(E+="; domain="+A.domain),!0===A.secure&&(E+="; secure")),E},_createCookieHashString:function(B){var D=YAHOO.lang;if(!D.isObject(B))throw new TypeError("Cookie._createCookieHashString(): Argument must be an object.");var C=[];for(var A in B)!D.hasOwnProperty(B,A)||D.isFunction(B[A])||D.isUndefined(B[A])||C.push(encodeURIComponent(A)+"="+encodeURIComponent(String(B[A])));return C.join("&")},_parseCookieHash:function(E){var D=E.split("&"),F=null,C={};if(E.length>0)for(var B=0,A=D.length;B<A;B++)F=D[B].split("="),C[decodeURIComponent(F[0])]=decodeURIComponent(F[1]);return C},_parseCookieString:function(J,A){var K={};if(YAHOO.lang.isString(J)&&J.length>0)for(var B=!1===A?function(L){return L}:decodeURIComponent,H=J.split(/;\s/g),I=null,C=null,E=null,D=0,F=H.length;D<F;D++){if((E=H[D].match(/([^=]+)=/i))instanceof Array)try{I=decodeURIComponent(E[1]),C=B(H[D].substring(E[1].length+1))}catch(G){}else I=decodeURIComponent(H[D]),C="";K[I]=C}return K},exists:function(A){if(!YAHOO.lang.isString(A)||""===A)throw new TypeError("Cookie.exists(): Cookie name must be a non-empty string.");return this._parseCookieString(document.cookie,!0).hasOwnProperty(A)},get:function(B,A){var C,E=YAHOO.lang;E.isFunction(A)?(C=A,A={}):E.isObject(A)?C=A.converter:A={};var D=this._parseCookieString(document.cookie,!A.raw);if(!E.isString(B)||""===B)throw new TypeError("Cookie.get(): Cookie name must be a non-empty string.");return E.isUndefined(D[B])?null:E.isFunction(C)?C(D[B]):D[B]},getSub:function(A,C,B){var E=YAHOO.lang,D=this.getSubs(A);if(null!==D){if(!E.isString(C)||""===C)throw new TypeError("Cookie.getSub(): Subcookie name must be a non-empty string.");return E.isUndefined(D[C])?null:E.isFunction(B)?B(D[C]):D[C]}return null},getSubs:function(B){var A=YAHOO.lang.isString;if(!A(B)||""===B)throw new TypeError("Cookie.getSubs(): Cookie name must be a non-empty string.");var C=this._parseCookieString(document.cookie,!1);return A(C[B])?this._parseCookieHash(C[B]):null},remove:function(B,A){if(!YAHOO.lang.isString(B)||""===B)throw new TypeError("Cookie.remove(): Cookie name must be a non-empty string.");return A=YAHOO.lang.merge(A||{},{expires:new Date(0)}),this.set(B,"",A)},removeSub:function(B,E,A){var F=YAHOO.lang;if(A=A||{},!F.isString(B)||""===B)throw new TypeError("Cookie.removeSub(): Cookie name must be a non-empty string.");if(!F.isString(E)||""===E)throw new TypeError("Cookie.removeSub(): Subcookie name must be a non-empty string.");var D=this.getSubs(B);if(F.isObject(D)&&F.hasOwnProperty(D,E)){if(delete D[E],A.removeIfEmpty){for(var C in D)if(F.hasOwnProperty(D,C)&&!F.isFunction(D[C])&&!F.isUndefined(D[C]))return this.setSubs(B,D,A);return this.remove(B,A)}return this.setSubs(B,D,A)}return""},set:function(B,C,A){var E=YAHOO.lang;if(A=A||{},!E.isString(B))throw new TypeError("Cookie.set(): Cookie name must be a string.");if(E.isUndefined(C))throw new TypeError("Cookie.set(): Value cannot be undefined.");var D=this._createCookieString(B,C,!A.raw,A);return document.cookie=D,D},setSub:function(B,D,C,A){var F=YAHOO.lang;if(!F.isString(B)||""===B)throw new TypeError("Cookie.setSub(): Cookie name must be a non-empty string.");if(!F.isString(D)||""===D)throw new TypeError("Cookie.setSub(): Subcookie name must be a non-empty string.");if(F.isUndefined(C))throw new TypeError("Cookie.setSub(): Subcookie value cannot be undefined.");var E=this.getSubs(B);return F.isObject(E)||(E={}),E[D]=C,this.setSubs(B,E,A)},setSubs:function(B,C,A){var E=YAHOO.lang;if(!E.isString(B))throw new TypeError("Cookie.setSubs(): Cookie name must be a string.");if(!E.isObject(C))throw new TypeError("Cookie.setSubs(): Cookie value must be an object.");var D=this._createCookieString(B,this._createCookieHashString(C),!1,A);return document.cookie=D,D}},YAHOO.register("cookie",YAHOO.util.Cookie,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.util.Attribute=function(b,a){a&&(this.owner=a,this.configure(b,!0))},YAHOO.util.Attribute.INVALID_VALUE={},YAHOO.util.Attribute.prototype={name:void 0,value:null,owner:null,readOnly:!1,writeOnce:!1,_initialConfig:null,_written:!1,method:null,setter:null,getter:null,validator:null,getValue:function(){var a=this.value;return this.getter&&(a=this.getter.call(this.owner,this.name,a)),a},setValue:function(f,b){var a=this.owner,c=this.name,g=YAHOO.util.Attribute.INVALID_VALUE,d={type:c,prevValue:this.getValue(),newValue:f};return!(this.readOnly||this.writeOnce&&this._written)&&(!(this.validator&&!this.validator.call(a,f))&&(!(!b&&!1===a.fireBeforeChangeEvent(d))&&((!this.setter||(f=this.setter.call(a,f,this.name))!==g)&&((!this.method||this.method.call(a,f,this.name)!==g)&&(this.value=f,this._written=!0,d.type=c,b||this.owner.fireChangeEvent(d),!0)))))},configure:function(b,c){b=b||{},c&&(this._written=!1),this._initialConfig=this._initialConfig||{};for(var a in b)b.hasOwnProperty(a)&&(this[a]=b[a],c&&(this._initialConfig[a]=b[a]))},resetValue:function(){return this.setValue(this._initialConfig.value)},resetConfig:function(){this.configure(this._initialConfig,!0)},refresh:function(a){this.setValue(this.value,a)}},function(){var a=YAHOO.util.Lang;YAHOO.util.AttributeProvider=function(){},YAHOO.util.AttributeProvider.prototype={_configs:null,get:function(c){this._configs=this._configs||{};var b=this._configs[c];return b&&this._configs.hasOwnProperty(c)?b.getValue():null},set:function(d,e,b){this._configs=this._configs||{};var c=this._configs[d];return!!c&&c.setValue(e,b)},getAttributeKeys:function(){this._configs=this._configs;var b,c=[];for(b in this._configs)a.hasOwnProperty(this._configs,b)&&!a.isUndefined(this._configs[b])&&(c[c.length]=b);return c},setAttributes:function(d,b){for(var c in d)a.hasOwnProperty(d,c)&&this.set(c,d[c],b)},resetValue:function(c,b){return this._configs=this._configs||{},!!this._configs[c]&&(this.set(c,this._configs[c]._initialConfig.value,b),!0)},refresh:function(e,c){this._configs=this._configs||{};for(var f=this._configs,d=0,b=(e=(a.isString(e)?[e]:e)||this.getAttributeKeys()).length;d<b;++d)f.hasOwnProperty(e[d])&&this._configs[e[d]].refresh(c)},register:function(b,c){this.setAttributeConfig(b,c)},getAttributeConfig:function(c){this._configs=this._configs||{};var b=this._configs[c]||{},d={};for(c in b)a.hasOwnProperty(b,c)&&(d[c]=b[c]);return d},setAttributeConfig:function(b,c,d){this._configs=this._configs||{},c=c||{},this._configs[b]?this._configs[b].configure(c,d):(c.name=b,this._configs[b]=this.createAttribute(c))},configureAttribute:function(b,c,d){this.setAttributeConfig(b,c,d)},resetAttributeConfig:function(b){this._configs=this._configs||{},this._configs[b].resetConfig()},subscribe:function(b,c){this._events=this._events||{},b in this._events||(this._events[b]=this.createEvent(b)),YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments)},on:function(){this.subscribe.apply(this,arguments)},addListener:function(){this.subscribe.apply(this,arguments)},fireBeforeChangeEvent:function(c){var b="before";return b+=c.type.charAt(0).toUpperCase()+c.type.substr(1)+"Change",c.type=b,this.fireEvent(c.type,c)},fireChangeEvent:function(b){return b.type+="Change",this.fireEvent(b.type,b)},createAttribute:function(b){return new YAHOO.util.Attribute(b,this)}},YAHOO.augment(YAHOO.util.AttributeProvider,YAHOO.util.EventProvider)}(),function(){var b=YAHOO.util.Dom,d=YAHOO.util.AttributeProvider,c={mouseenter:!0,mouseleave:!0},a=function(e,f){this.init.apply(this,arguments)};a.DOM_EVENTS={click:!0,dblclick:!0,keydown:!0,keypress:!0,keyup:!0,mousedown:!0,mousemove:!0,mouseout:!0,mouseover:!0,mouseup:!0,mouseenter:!0,mouseleave:!0,focus:!0,blur:!0,submit:!0,change:!0},a.prototype={DOM_EVENTS:null,DEFAULT_HTML_SETTER:function(g,e){var f=this.get("element");return f&&(f[e]=g),g},DEFAULT_HTML_GETTER:function(e){var g,f=this.get("element");return f&&(g=f[e]),g},appendChild:function(e){return e=e.get?e.get("element"):e,this.get("element").appendChild(e)},getElementsByTagName:function(e){return this.get("element").getElementsByTagName(e)},hasChildNodes:function(){return this.get("element").hasChildNodes()},insertBefore:function(e,f){return e=e.get?e.get("element"):e,f=f&&f.get?f.get("element"):f,this.get("element").insertBefore(e,f)},removeChild:function(e){return e=e.get?e.get("element"):e,this.get("element").removeChild(e)},replaceChild:function(e,f){return e=e.get?e.get("element"):e,f=f.get?f.get("element"):f,this.get("element").replaceChild(e,f)},initAttributes:function(e){},addListener:function(j,i,k,h){h=h||this;var e=YAHOO.util.Event,g=this.get("element")||this.get("id"),f=this;return!(c[j]&&!e._createMouseDelegate)&&(this._events[j]||(g&&this.DOM_EVENTS[j]&&e.on(g,j,function(m,l){m.srcElement&&!m.target&&(m.target=m.srcElement),(m.toElement&&!m.relatedTarget||m.fromElement&&!m.relatedTarget)&&(m.relatedTarget=e.getRelatedTarget(m)),m.currentTarget||(m.currentTarget=g),f.fireEvent(j,m,l)},k,h),this.createEvent(j,{scope:this})),YAHOO.util.EventProvider.prototype.subscribe.apply(this,arguments))},on:function(){return this.addListener.apply(this,arguments)},subscribe:function(){return this.addListener.apply(this,arguments)},removeListener:function(f,e){return this.unsubscribe.apply(this,arguments)},addClass:function(e){b.addClass(this.get("element"),e)},getElementsByClassName:function(f,e){return b.getElementsByClassName(f,e,this.get("element"))},hasClass:function(e){return b.hasClass(this.get("element"),e)},removeClass:function(e){return b.removeClass(this.get("element"),e)},replaceClass:function(f,e){return b.replaceClass(this.get("element"),f,e)},setStyle:function(f,e){return b.setStyle(this.get("element"),f,e)},getStyle:function(e){return b.getStyle(this.get("element"),e)},fireQueue:function(){for(var f=this._queue,g=0,e=f.length;g<e;++g)this[f[g][0]].apply(this,f[g][1])},appendTo:function(f,g){f=f.get?f.get("element"):b.get(f),this.fireEvent("beforeAppendTo",{type:"beforeAppendTo",target:f}),g=g&&g.get?g.get("element"):b.get(g);var e=this.get("element");return!!e&&(!!f&&(e.parent!=f&&(g?f.insertBefore(e,g):f.appendChild(e)),this.fireEvent("appendTo",{type:"appendTo",target:f}),e))},get:function(e){var g=this._configs||{},f=g.element;return!f||g[e]||YAHOO.lang.isUndefined(f.value[e])||this._setHTMLAttrConfig(e),d.prototype.get.call(this,e)},setAttributes:function(l,h){for(var f={},j=this._configOrder,k=0,e=j.length;k<e;++k)void 0!==l[j[k]]&&(f[j[k]]=!0,this.set(j[k],l[j[k]],h));for(var g in l)l.hasOwnProperty(g)&&!f[g]&&this.set(g,l[g],h)},set:function(f,h,e){var g=this.get("element");return g?(this._configs[f]||YAHOO.lang.isUndefined(g[f])||this._setHTMLAttrConfig(f),d.prototype.set.apply(this,arguments)):(this._queue[this._queue.length]=["set",arguments],void(this._configs[f]&&(this._configs[f].value=h)))},setAttributeConfig:function(e,f,g){this._configOrder.push(e),d.prototype.setAttributeConfig.apply(this,arguments)},createEvent:function(f,e){return this._events[f]=!0,d.prototype.createEvent.apply(this,arguments)},init:function(f,e){this._initElement(f,e)},destroy:function(){var e=this.get("element");YAHOO.util.Event.purgeElement(e,!0),this.unsubscribeAll(),e&&e.parentNode&&e.parentNode.removeChild(e),this._queue=[],this._events={},this._configs={},this._configOrder=[]},_initElement:function(g,f){this._queue=this._queue||[],this._events=this._events||{},this._configs=this._configs||{},this._configOrder=[],(f=f||{}).element=f.element||g||null;var i=!1,e=a.DOM_EVENTS;this.DOM_EVENTS=this.DOM_EVENTS||{};for(var h in e)e.hasOwnProperty(h)&&(this.DOM_EVENTS[h]=e[h]);"string"==typeof f.element&&this._setHTMLAttrConfig("id",{value:f.element}),b.get(f.element)&&(i=!0,this._initHTMLElement(f),this._initContent(f)),YAHOO.util.Event.onAvailable(f.element,function(){i||this._initHTMLElement(f),this.fireEvent("available",{type:"available",target:b.get(f.element)})},this,!0),YAHOO.util.Event.onContentReady(f.element,function(){i||this._initContent(f),this.fireEvent("contentReady",{type:"contentReady",target:b.get(f.element)})},this,!0)},_initHTMLElement:function(e){this.setAttributeConfig("element",{value:b.get(e.element),readOnly:!0})},_initContent:function(e){this.initAttributes(e),this.setAttributes(e,!0),this.fireQueue()},_setHTMLAttrConfig:function(e,g){var f=this.get("element");(g=g||{}).name=e,g.setter=g.setter||this.DEFAULT_HTML_SETTER,g.getter=g.getter||this.DEFAULT_HTML_GETTER,g.value=g.value||f[e],this._configs[e]=new YAHOO.util.Attribute(g,this)}},YAHOO.augment(a,d),YAHOO.util.Element=a}(),YAHOO.register("element",YAHOO.util.Element,{version:"@VERSION@",build:"@BUILD@"}),function(){function F(O,N,R,P){var S,Q;return I.isString(O)&&I.isString(N)&&(L.ie&&L.ie<9?(Q='<input type="'+O+'" name="'+N+'"',P&&(Q+=" checked"),Q+=">",(S=document.createElement(Q)).value=R):((S=document.createElement("input")).name=N,S.type=O,S.value=R,P&&(S.checked=!0))),S}function H(O,V){function W(X){X in V||(U=O.getAttributeNode(X))&&"value"in U&&(V[X]=U.value)}function R(){W("type"),"button"==V.type&&(V.type="push"),"disabled"in V||(V.disabled=O.disabled),W("name"),W("value"),W("title")}var U,P,Q,N=O.nodeName.toUpperCase(),S=this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME;switch(N){case"A":V.type="link",W("href"),W("target");break;case"INPUT":R(),"checked"in V||(V.checked=O.checked);break;case"BUTTON":R(),P=O.parentNode.parentNode,G.hasClass(P,S+"-checked")&&(V.checked=!0),G.hasClass(P,S+"-disabled")&&(V.disabled=!0),O.removeAttribute("value"),O.setAttribute("type","button")}O.removeAttribute("id"),O.removeAttribute("name"),"tabindex"in V||(V.tabindex=O.tabIndex),"label"in V||(Q="INPUT"==N?O.value:O.innerHTML)&&Q.length>0&&(V.label=Q)}function A(P){var O=P.attributes,N=O.srcelement,R=N.nodeName.toUpperCase(),Q=this;if(R==this.NODE_NAME)P.element=N,P.id=N.id,G.getElementsBy(function(S){switch(S.nodeName.toUpperCase()){case"BUTTON":case"A":case"INPUT":H.call(Q,S,O)}},"*",N);else switch(R){case"BUTTON":case"A":case"INPUT":H.call(this,N,O)}}var G=YAHOO.util.Dom,M=YAHOO.util.Event,I=YAHOO.lang,L=YAHOO.env.ua,B=YAHOO.widget.Overlay,J=YAHOO.widget.Menu,D={},K=null,E=null,C=null;YAHOO.widget.Button=function(R,O){!B&&YAHOO.widget.Overlay&&(B=YAHOO.widget.Overlay),!J&&YAHOO.widget.Menu&&(J=YAHOO.widget.Menu);var P,N,Q=YAHOO.widget.Button.superclass.constructor;1!=arguments.length||I.isString(R)||R.nodeName?(P={element:null,attributes:O||{}},I.isString(R)?(N=G.get(R))&&(P.attributes.id||(P.attributes.id=R),P.attributes.srcelement=N,A.call(this,P),P.element||(P.element=this.createButtonElement(P.attributes.type)),Q.call(this,P.element,P.attributes)):R.nodeName&&(P.attributes.id||(R.id?P.attributes.id=R.id:P.attributes.id=G.generateId()),P.attributes.srcelement=R,A.call(this,P),P.element||(P.element=this.createButtonElement(P.attributes.type)),Q.call(this,P.element,P.attributes))):(R.id||(R.id=G.generateId()),Q.call(this,this.createButtonElement(R.type),R))},YAHOO.extend(YAHOO.widget.Button,YAHOO.util.Element,{_button:null,_menu:null,_hiddenFields:null,_onclickAttributeValue:null,_activationKeyPressed:!1,_activationButtonPressed:!1,_hasKeyEventHandlers:!1,_hasMouseEventHandlers:!1,_nOptionRegionX:0,CLASS_NAME_PREFIX:"yui-",NODE_NAME:"SPAN",CHECK_ACTIVATION_KEYS:[32],ACTIVATION_KEYS:[13,32],OPTION_AREA_WIDTH:20,CSS_CLASS_NAME:"button",_setType:function(N){"split"==N&&this.on("option",this._onOption)},_setLabel:function(O){this._button.innerHTML=O;var P,N=L.gecko;N&&N<1.9&&G.inDocument(this.get("element"))&&(P=this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME,this.removeClass(P),I.later(0,this,this.addClass,P))},_setTabIndex:function(N){this._button.tabIndex=N},_setTitle:function(N){"link"!=this.get("type")&&(this._button.title=N)},_setDisabled:function(N){"link"!=this.get("type")&&(N?(this._menu&&this._menu.hide(),this.hasFocus()&&this.blur(),this._button.setAttribute("disabled","disabled"),this.addStateCSSClasses("disabled"),this.removeStateCSSClasses("hover"),this.removeStateCSSClasses("active"),this.removeStateCSSClasses("focus")):(this._button.removeAttribute("disabled"),this.removeStateCSSClasses("disabled")))},_setHref:function(N){"link"==this.get("type")&&(this._button.href=N)},_setTarget:function(N){"link"==this.get("type")&&this._button.setAttribute("target",N)},_setChecked:function(N){var O=this.get("type");"checkbox"!=O&&"radio"!=O||(N?this.addStateCSSClasses("checked"):this.removeStateCSSClasses("checked"))},_setMenu:function(U){function V(){X.render(R.parentNode),this.removeListener("appendTo",V)}function T(){X.cfg.queueProperty("container",R.parentNode),this.removeListener("appendTo",T)}function S(){var Y;X&&(G.addClass(X.element,this.get("menuclassname")),G.addClass(X.element,this.CLASS_NAME_PREFIX+this.get("type")+"-button-menu"),X.showEvent.subscribe(this._onMenuShow,null,this),X.hideEvent.subscribe(this._onMenuHide,null,this),X.renderEvent.subscribe(this._onMenuRender,null,this),J&&X instanceof J?(P&&((Y=this.get("container"))?X.cfg.queueProperty("container",Y):this.on("appendTo",T)),X.cfg.queueProperty("clicktohide",!1),X.keyDownEvent.subscribe(this._onMenuKeyDown,this,!0),X.subscribe("click",this._onMenuClick,this,!0),this.on("selectedMenuItemChange",this._onSelectedMenuItemChange),(Q=X.srcElement)&&"SELECT"==Q.nodeName.toUpperCase()&&(Q.style.display="none",Q.parentNode.removeChild(Q))):B&&X instanceof B&&(K||(K=new YAHOO.widget.OverlayManager),K.register(X)),this._menu=X,W||P||(G.inDocument(R)?X.render(R.parentNode):this.on("appendTo",V)))}var N,X,O,Q,P=this.get("lazyloadmenu"),R=this.get("element"),W=!1;B&&(J&&(N=J.prototype.CSS_CLASS_NAME),U&&J&&U instanceof J?(X=U,W=!0,S.call(this)):B&&U&&U instanceof B?(W=!0,(X=U).cfg.queueProperty("visible",!1),S.call(this)):J&&I.isArray(U)?(X=new J(G.generateId(),{lazyload:P,itemdata:U}),this._menu=X,this.on("appendTo",S)):I.isString(U)?(O=G.get(U))&&(J&&G.hasClass(O,N)||"SELECT"==O.nodeName.toUpperCase()?(X=new J(U,{lazyload:P}),S.call(this)):B&&(X=new B(U,{visible:!1}),S.call(this))):U&&U.nodeName&&(J&&G.hasClass(U,N)||"SELECT"==U.nodeName.toUpperCase()?(X=new J(U,{lazyload:P}),S.call(this)):B&&(U.id||G.generateId(U),X=new B(U,{visible:!1}),S.call(this))))},_setOnClick:function(N){this._onclickAttributeValue&&this._onclickAttributeValue!=N&&(this.removeListener("click",this._onclickAttributeValue.fn),this._onclickAttributeValue=null),!this._onclickAttributeValue&&I.isObject(N)&&I.isFunction(N.fn)&&(this.on("click",N.fn,N.obj,N.scope),this._onclickAttributeValue=N)},_isActivationKey:function(N){var P,S=this.get("type"),O="checkbox"==S||"radio"==S?this.CHECK_ACTIVATION_KEYS:this.ACTIVATION_KEYS,Q=O.length,R=!1;if(Q>0){P=Q-1;do{if(N==O[P]){R=!0;break}}while(P--)}return R},_isSplitButtonOptionKey:function(P){var O=40==M.getCharCode(P),N=function(Q){M.preventDefault(Q),this.removeListener("keypress",N)};return O&&(L.opera&&this.on("keypress",N),M.preventDefault(P)),O},_addListenersToForm:function(){var R,N,Q,P,O,T=this.getForm(),S=YAHOO.widget.Button.onFormKeyPress;if(T&&(M.on(T,"reset",this._onFormReset,null,this),M.on(T,"submit",this._onFormSubmit,null,this),N=this.get("srcelement"),"submit"==this.get("type")||N&&"submit"==N.type)){if(Q=M.getListeners(T,"keypress"),R=!1,Q&&(P=Q.length)>0){O=P-1;do{if(Q[O].fn==S){R=!0;break}}while(O--)}R||M.on(T,"keypress",S)}},_showMenu:function(R){YAHOO.widget.MenuManager&&YAHOO.widget.MenuManager.hideVisible(),K&&K.hideAll();var O,N=this._menu,Q=this.get("menualignment"),P=this.get("focusmenu");this._renderedMenu?(N.cfg.setProperty("context",[this.get("element"),Q[0],Q[1]]),N.cfg.setProperty("preventcontextoverlap",!0),N.cfg.setProperty("constraintoviewport",!0)):(N.cfg.queueProperty("context",[this.get("element"),Q[0],Q[1]]),N.cfg.queueProperty("preventcontextoverlap",!0),N.cfg.queueProperty("constraintoviewport",!0)),this.focus(),J&&N&&N instanceof J?(O=N.focus,N.focus=function(){},this._renderedMenu?(N.cfg.setProperty("minscrollheight",this.get("menuminscrollheight")),N.cfg.setProperty("maxheight",this.get("menumaxheight"))):(N.cfg.queueProperty("minscrollheight",this.get("menuminscrollheight")),N.cfg.queueProperty("maxheight",this.get("menumaxheight"))),N.show(),N.focus=O,N.align(),"mousedown"==R.type&&M.stopPropagation(R),P&&N.focus()):B&&N&&N instanceof B&&(this._renderedMenu||N.render(this.get("element").parentNode),N.show(),N.align())},_hideMenu:function(){var N=this._menu;N&&N.hide()},_onMouseOver:function(O){var N,P,Q=this.get("type");"split"===Q&&(N=this.get("element"),P=G.getX(N)+(N.offsetWidth-this.OPTION_AREA_WIDTH),this._nOptionRegionX=P),this._hasMouseEventHandlers||("split"===Q&&this.on("mousemove",this._onMouseMove),this.on("mouseout",this._onMouseOut),this._hasMouseEventHandlers=!0),this.addStateCSSClasses("hover"),"split"===Q&&M.getPageX(O)>P&&this.addStateCSSClasses("hoveroption"),this._activationButtonPressed&&this.addStateCSSClasses("active"),this._bOptionPressed&&this.addStateCSSClasses("activeoption"),(this._activationButtonPressed||this._bOptionPressed)&&M.removeListener(document,"mouseup",this._onDocumentMouseUp)},_onMouseMove:function(N){var O=this._nOptionRegionX;O&&(M.getPageX(N)>O?this.addStateCSSClasses("hoveroption"):this.removeStateCSSClasses("hoveroption"))},_onMouseOut:function(N){var O=this.get("type");this.removeStateCSSClasses("hover"),"menu"!=O&&this.removeStateCSSClasses("active"),(this._activationButtonPressed||this._bOptionPressed)&&M.on(document,"mouseup",this._onDocumentMouseUp,null,this),"split"===O&&M.getPageX(N)>this._nOptionRegionX&&this.removeStateCSSClasses("hoveroption")},_onDocumentMouseUp:function(P){this._activationButtonPressed=!1,this._bOptionPressed=!1;var N,O,Q=this.get("type");"menu"!=Q&&"split"!=Q||(N=M.getTarget(P))==(O=this._menu.element)||G.isAncestor(O,N)||(this.removeStateCSSClasses("menu"==Q?"active":"activeoption"),this._hideMenu()),M.removeListener(document,"mouseup",this._onDocumentMouseUp)},_onMouseDown:function(P){function N(){this._hideMenu(),this.removeListener("mouseup",N)}var Q,O=!0;return 1==(P.which||P.button)&&(this.hasFocus()||I.later(0,this,this.focus),"split"==(Q=this.get("type"))?M.getPageX(P)>this._nOptionRegionX?(this.fireEvent("option",P),O=!1):(this.addStateCSSClasses("active"),this._activationButtonPressed=!0):"menu"==Q?this.isActive()?(this._hideMenu(),this._activationButtonPressed=!1):(this._showMenu(P),this._activationButtonPressed=!0):(this.addStateCSSClasses("active"),this._activationButtonPressed=!0),"split"!=Q&&"menu"!=Q||(this._hideMenuTimer=I.later(250,this,this.on,["mouseup",N]))),O},_onMouseUp:function(P){this.inMouseDown=!1;var Q=this.get("type"),N=this._hideMenuTimer,O=!0;if(N&&N.cancel(),"checkbox"==Q||"radio"==Q){if(1!=(P.which||P.button))return;this.set("checked",!this.get("checked"))}return this._activationButtonPressed=!1,"menu"!=Q&&this.removeStateCSSClasses("active"),"split"==Q&&M.getPageX(P)>this._nOptionRegionX&&(O=!1),O},_onFocus:function(O){var N;this.addStateCSSClasses("focus"),this._activationKeyPressed&&this.addStateCSSClasses("active"),C=this,this._hasKeyEventHandlers||(N=this._button,M.on(N,"blur",this._onBlur,null,this),M.on(N,"keydown",this._onKeyDown,null,this),M.on(N,"keyup",this._onKeyUp,null,this),this._hasKeyEventHandlers=!0),this.fireEvent("focus",O)},_onBlur:function(N){this.removeStateCSSClasses("focus"),"menu"!=this.get("type")&&this.removeStateCSSClasses("active"),this._activationKeyPressed&&M.on(document,"keyup",this._onDocumentKeyUp,null,this),C=null,this.fireEvent("blur",N)},_onDocumentKeyUp:function(N){this._isActivationKey(M.getCharCode(N))&&(this._activationKeyPressed=!1,M.removeListener(document,"keyup",this._onDocumentKeyUp))},_onKeyDown:function(O){var N=this._menu;"split"==this.get("type")&&this._isSplitButtonOptionKey(O)?this.fireEvent("option",O):this._isActivationKey(M.getCharCode(O))&&("menu"==this.get("type")?this._showMenu(O):(this._activationKeyPressed=!0,this.addStateCSSClasses("active"))),N&&N.cfg.getProperty("visible")&&27==M.getCharCode(O)&&(N.hide(),this.focus())},_onKeyUp:function(N){var O;this._isActivationKey(M.getCharCode(N))&&("checkbox"!=(O=this.get("type"))&&"radio"!=O||this.set("checked",!this.get("checked")),this._activationKeyPressed=!1,"menu"!=this.get("type")&&this.removeStateCSSClasses("active"))},_onClick:function(P){var Q,N,O;switch(this.get("type")){case"submit":!1!==P.returnValue&&this.submitForm();break;case"reset":(Q=this.getForm())&&Q.reset();break;case"split":this._nOptionRegionX>0&&M.getPageX(P)>this._nOptionRegionX?O=!1:(this._hideMenu(),(N=this.get("srcelement"))&&"submit"==N.type&&!1!==P.returnValue&&this.submitForm())}return O},_onDblClick:function(O){var N=!0;return"split"==this.get("type")&&M.getPageX(O)>this._nOptionRegionX&&(N=!1),N},_onAppendTo:function(N){I.later(0,this,this._addListenersToForm)},_onFormReset:function(O){var P=this.get("type"),N=this._menu;"checkbox"!=P&&"radio"!=P||this.resetValue("checked"),J&&N&&N instanceof J&&this.resetValue("selectedMenuItem")},_onFormSubmit:function(N){this.createHiddenFields()},_onDocumentMouseDown:function(R){function N(T){var V,S,U;if(!T)return!0;for(V=0,S=T.length;V<S;V++){if(U=T[V].element,O==U||G.isAncestor(U,O))return!0;if(T[V]&&T[V].getSubmenus&&N(T[V].getSubmenus()))return!0}return!1}var O=M.getTarget(R),Q=this.get("element"),P=this._menu.element;if(O!=Q&&!G.isAncestor(Q,O)&&O!=P&&!G.isAncestor(P,O)){if(this._menu&&this._menu.getSubmenus&&!N(this._menu.getSubmenus()))return;this._hideMenu(),L.ie&&L.ie<9&&O.focus&&O.setActive(),M.removeListener(document,"mousedown",this._onDocumentMouseDown)}},_onOption:function(N){this.hasClass(this.CLASS_NAME_PREFIX+"split-button-activeoption")?(this._hideMenu(),this._bOptionPressed=!1):(this._showMenu(N),this._bOptionPressed=!0)},_onMenuShow:function(N){M.on(document,"mousedown",this._onDocumentMouseDown,null,this);var O="split"==this.get("type")?"activeoption":"active";this.addStateCSSClasses(O)},_onMenuHide:function(N){var O="split"==this.get("type")?"activeoption":"active";this.removeStateCSSClasses(O),"split"==this.get("type")&&(this._bOptionPressed=!1)},_onMenuKeyDown:function(P,O){var N=O[0];27==M.getCharCode(N)&&(this.focus(),"split"==this.get("type")&&(this._bOptionPressed=!1))},_onMenuRender:function(P){var T,O=this.get("element").parentNode,N=this._menu,R=N.element,Q=N.srcElement;O!=R.parentNode&&O.appendChild(R),this._renderedMenu=!0,Q&&"select"===Q.nodeName.toLowerCase()&&Q.value&&(T=N.getItem(Q.selectedIndex),this.set("selectedMenuItem",T,!0),this._onSelectedMenuItemChange({newValue:T}))},_onMenuClick:function(O,N){var P,Q=N[1];Q&&(this.set("selectedMenuItem",Q),(P=this.get("srcelement"))&&"submit"==P.type&&this.submitForm(),this._hideMenu())},_onSelectedMenuItemChange:function(O){var P=O.prevValue,Q=O.newValue,N=this.CLASS_NAME_PREFIX;P&&G.removeClass(P.element,N+"button-selectedmenuitem"),Q&&G.addClass(Q.element,N+"button-selectedmenuitem")},_onLabelClick:function(N){this.focus();var O=this.get("type");"radio"!=O&&"checkbox"!=O||this.set("checked",!this.get("checked"))},createButtonElement:function(N){var P=this.NODE_NAME,O=document.createElement(P);return O.innerHTML="<"+P+' class="first-child">'+("link"==N?"<a></a>":'<button type="button"></button>')+"</"+P+">",O},addStateCSSClasses:function(O){var P=this.get("type"),N=this.CLASS_NAME_PREFIX;I.isString(O)&&("activeoption"!=O&&"hoveroption"!=O&&this.addClass(N+this.CSS_CLASS_NAME+"-"+O),this.addClass(N+P+"-button-"+O))},removeStateCSSClasses:function(O){var P=this.get("type"),N=this.CLASS_NAME_PREFIX;I.isString(O)&&(this.removeClass(N+this.CSS_CLASS_NAME+"-"+O),this.removeClass(N+P+"-button-"+O))},createHiddenFields:function(){this.removeHiddenFields();var Z,O,S,X,Y,T,U,N,R,W,P,V=this.getForm(),Q=!1;return V&&!this.get("disabled")&&(((S="checkbox"==(O=this.get("type"))||"radio"==O)&&this.get("checked")||E==this)&&(Z=F(S?O:"hidden",this.get("name"),this.get("value"),this.get("checked")))&&(S&&(Z.style.display="none"),V.appendChild(Z)),X=this._menu,J&&X&&X instanceof J&&(Y=this.get("selectedMenuItem"),Q=(P=X.srcElement)&&"SELECT"==P.nodeName.toUpperCase(),Y?(U=null===Y.value||""===Y.value?Y.cfg.getProperty("text"):Y.value,T=this.get("name"),Q?W=P.name:T&&(W=T+"_options"),U&&W&&(N=F("hidden",W,U),V.appendChild(N))):Q&&(N=V.appendChild(P))),Z&&N?this._hiddenFields=[Z,N]:!Z&&N?this._hiddenFields=N:Z&&!N&&(this._hiddenFields=Z),R=this._hiddenFields),R},removeHiddenFields:function(){function N(R){G.inDocument(R)&&R.parentNode.removeChild(R)}var O,P,Q=this._hiddenFields;if(Q){if(I.isArray(Q)){if((O=Q.length)>0){P=O-1;do{N(Q[P])}while(P--)}}else N(Q);this._hiddenFields=null}},submitForm:function(){var N,Q=this.getForm(),P=this.get("srcelement"),O=!1;return Q&&(("submit"==this.get("type")||P&&"submit"==P.type)&&(E=this),L.ie&&L.ie<9?O=Q.fireEvent("onsubmit"):((N=document.createEvent("HTMLEvents")).initEvent("submit",!0,!0),O=Q.dispatchEvent(N)),(L.ie||L.webkit)&&O&&Q.submit()),O},init:function(P,d){var U,V="link"==d.type?"a":"button",a=d.srcelement,S=P.getElementsByTagName(V)[0];S||(U=P.getElementsByTagName("input")[0])&&((S=document.createElement("button")).setAttribute("type","button"),U.parentNode.replaceChild(S,U)),this._button=S,YAHOO.widget.Button.superclass.init.call(this,P,d);var T=this.get("id"),Z=T+"-button";S.id=Z;var X,Q;a&&"link"!=this.get("type")&&(X=G.getElementsBy(function(f){return f.htmlFor===T},"label"),I.isArray(X)&&X.length>0&&(Q=X[0])),D[T]=this;var b=this.CLASS_NAME_PREFIX;this.addClass(b+this.CSS_CLASS_NAME),this.addClass(b+this.get("type")+"-button"),M.on(this._button,"focus",this._onFocus,null,this),this.on("mouseover",this._onMouseOver),this.on("mousedown",this._onMouseDown),this.on("mouseup",this._onMouseUp),this.on("click",this._onClick);var R=this.get("onclick");this.set("onclick",null),this.set("onclick",R),this.on("dblclick",this._onDblClick);var O;Q&&(this.get("replaceLabel")?(this.set("label",Q.innerHTML),(O=Q.parentNode).removeChild(Q)):(this.on("appendTo",function(){Q.setAttribute(L.ie?"htmlFor":"for",Z)}),M.on(Q,"click",this._onLabelClick,null,this),this._label=Q)),this.on("appendTo",this._onAppendTo);var N=this.get("container"),Y=this.get("element"),W=G.inDocument(Y);N?(a&&a!=Y&&(O=a.parentNode)&&O.removeChild(a),I.isString(N)?M.onContentReady(N,this.appendTo,N,this):this.on("init",function(){I.later(0,this,this.appendTo,N)})):!W&&a&&a!=Y?(O=a.parentNode)&&(this.fireEvent("beforeAppendTo",{type:"beforeAppendTo",target:O}),O.replaceChild(Y,a),this.fireEvent("appendTo",{type:"appendTo",target:O})):"link"!=this.get("type")&&W&&a&&a==Y&&this._addListenersToForm(),this.fireEvent("init",{type:"init",target:this})},initAttributes:function(O){var N=O||{};YAHOO.widget.Button.superclass.initAttributes.call(this,N),this.setAttributeConfig("type",{value:N.type||"push",validator:I.isString,writeOnce:!0,method:this._setType}),this.setAttributeConfig("label",{value:N.label,validator:I.isString,method:this._setLabel}),this.setAttributeConfig("value",{value:N.value}),this.setAttributeConfig("name",{value:N.name,validator:I.isString}),this.setAttributeConfig("tabindex",{value:N.tabindex,validator:I.isNumber,method:this._setTabIndex}),this.configureAttribute("title",{value:N.title,validator:I.isString,method:this._setTitle}),this.setAttributeConfig("disabled",{value:N.disabled||!1,validator:I.isBoolean,method:this._setDisabled}),this.setAttributeConfig("href",{value:N.href,validator:I.isString,method:this._setHref}),this.setAttributeConfig("target",{value:N.target,validator:I.isString,method:this._setTarget}),this.setAttributeConfig("checked",{value:N.checked||!1,validator:I.isBoolean,method:this._setChecked}),this.setAttributeConfig("container",{value:N.container,writeOnce:!0}),this.setAttributeConfig("srcelement",{value:N.srcelement,writeOnce:!0}),this.setAttributeConfig("menu",{value:null,method:this._setMenu,writeOnce:!0}),this.setAttributeConfig("lazyloadmenu",{value:!1!==N.lazyloadmenu,validator:I.isBoolean,writeOnce:!0}),this.setAttributeConfig("menuclassname",{value:N.menuclassname||this.CLASS_NAME_PREFIX+"button-menu",validator:I.isString,method:this._setMenuClassName,writeOnce:!0}),this.setAttributeConfig("menuminscrollheight",{value:N.menuminscrollheight||90,validator:I.isNumber}),this.setAttributeConfig("menumaxheight",{value:N.menumaxheight||0,validator:I.isNumber}),this.setAttributeConfig("menualignment",{value:N.menualignment||["tl","bl"],validator:I.isArray}),this.setAttributeConfig("selectedMenuItem",{value:null}),this.setAttributeConfig("onclick",{value:N.onclick,method:this._setOnClick}),this.setAttributeConfig("focusmenu",{value:!1!==N.focusmenu,validator:I.isBoolean}),this.setAttributeConfig("replaceLabel",{value:!1,validator:I.isBoolean,writeOnce:!0})},focus:function(){if(!this.get("disabled"))try{this._button.focus()}catch(N){}},blur:function(){if(!this.get("disabled"))try{this._button.blur()}catch(N){}},hasFocus:function(){return C==this},isActive:function(){return this.hasClass(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME+"-active")},getMenu:function(){return this._menu},getForm:function(){var O,N=this._button;return N&&(O=N.form),O},getHiddenFields:function(){return this._hiddenFields},destroy:function(){var O,S,P=this.get("element"),N=this._menu,T=this._label;N&&(K&&K.find(N)&&K.remove(N),N.destroy()),M.purgeElement(P),M.purgeElement(this._button),M.removeListener(document,"mouseup",this._onDocumentMouseUp),M.removeListener(document,"keyup",this._onDocumentKeyUp),M.removeListener(document,"mousedown",this._onDocumentMouseDown),T&&(M.removeListener(T,"click",this._onLabelClick),(O=T.parentNode).removeChild(T));var Q=this.getForm();Q&&(M.removeListener(Q,"reset",this._onFormReset),M.removeListener(Q,"submit",this._onFormSubmit)),this.unsubscribeAll(),(O=P.parentNode)&&O.removeChild(P),delete D[this.get("id")];var R=this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME;S=G.getElementsByClassName(R,this.NODE_NAME,Q),I.isArray(S)&&0===S.length&&M.removeListener(Q,"keypress",YAHOO.widget.Button.onFormKeyPress)},fireEvent:function(O,N){var P=arguments[0];return(!this.DOM_EVENTS[P]||!this.get("disabled"))&&YAHOO.widget.Button.superclass.fireEvent.apply(this,arguments)},toString:function(){return"Button "+this.get("id")}}),YAHOO.widget.Button.onFormKeyPress=function(R){var V,X,O,W,P=M.getTarget(R),S=M.getCharCode(R),Q=P.nodeName&&P.nodeName.toUpperCase(),N=P.type,T=!1;13!=S||("INPUT"!=Q||"text"!=N&&"password"!=N&&"checkbox"!=N&&"radio"!=N&&"file"!=N)&&"SELECT"!=Q||(G.getElementsBy(function(a){var Z,Y;switch(a.nodeName.toUpperCase()){case"INPUT":case"BUTTON":"submit"!=a.type||a.disabled||T||O||(O=a);break;default:(Z=a.id)&&(V=D[Z])&&(T=!0,V.get("disabled")||(Y=V.get("srcelement"),!X&&("submit"==V.get("type")||Y&&"submit"==Y.type)&&(X=V)))}},"*",this),O?O.focus():!O&&X&&(M.preventDefault(R),L.ie?X.get("element").fireEvent("onclick"):((W=document.createEvent("HTMLEvents")).initEvent("click",!0,!0),L.gecko<1.9?X.fireEvent("click",W):X.get("element").dispatchEvent(W))))},YAHOO.widget.Button.addHiddenFieldsToForm=function(N){var S,O,P,R=YAHOO.widget.Button.prototype,T=G.getElementsByClassName(R.CLASS_NAME_PREFIX+R.CSS_CLASS_NAME,"*",N),Q=T.length;if(Q>0)for(P=0;P<Q;P++)(O=T[P].id)&&(S=D[O])&&S.createHiddenFields()},YAHOO.widget.Button.getButton=function(N){return D[N]}}(),function(){var C=YAHOO.util.Dom,B=YAHOO.util.Event,D=YAHOO.lang,A=YAHOO.widget.Button,E={};YAHOO.widget.ButtonGroup=function(J,H){var K,G,F,I=YAHOO.widget.ButtonGroup.superclass.constructor;1!=arguments.length||D.isString(J)||J.nodeName?D.isString(J)?(G=C.get(J))&&G.nodeName.toUpperCase()==this.NODE_NAME&&I.call(this,G,H):(K=J.nodeName.toUpperCase())&&K==this.NODE_NAME&&(J.id||(J.id=C.generateId()),I.call(this,J,H)):(J.id||(F=C.generateId(),J.id=F),I.call(this,this._createGroupElement(),J))},YAHOO.extend(YAHOO.widget.ButtonGroup,YAHOO.util.Element,{_buttons:null,NODE_NAME:"DIV",CLASS_NAME_PREFIX:"yui-",CSS_CLASS_NAME:"buttongroup",_createGroupElement:function(){return document.createElement(this.NODE_NAME)},_setDisabled:function(G){var F,H=this.getCount();if(H>0){F=H-1;do{this._buttons[F].set("disabled",G)}while(F--)}},_onKeyDown:function(K){var G=B.getTarget(K),I=B.getCharCode(K),H=G.parentNode.parentNode.id,J=E[H],F=-1;37==I||38==I?F=0===J.index?this._buttons.length-1:J.index-1:39!=I&&40!=I||(F=J.index===this._buttons.length-1?0:J.index+1),F>-1&&(this.check(F),this.getButton(F).focus())},_onAppendTo:function(H){var F,I=this._buttons,G=I.length;for(F=0;F<G;F++)I[F].appendTo(this.get("element"))},_onButtonCheckedChange:function(G,F){var I=G.newValue,H=this.get("checkedButton");I&&H!=F?(H&&H.set("checked",!1,!0),this.set("checkedButton",F),this.set("value",F.get("value"))):H&&!H.set("checked")&&H.set("checked",!0,!0)},init:function(I,H){this._buttons=[],YAHOO.widget.ButtonGroup.superclass.init.call(this,I,H),this.addClass(this.CLASS_NAME_PREFIX+this.CSS_CLASS_NAME);var K=YAHOO.widget.Button.prototype.CLASS_NAME_PREFIX+"radio-button",J=this.getElementsByClassName(K);J.length>0&&this.addButtons(J),(J=C.getElementsBy(function(L){return"radio"==L.type},"input",this.get("element"))).length>0&&this.addButtons(J),this.on("keydown",this._onKeyDown),this.on("appendTo",this._onAppendTo);var G=this.get("container");G&&(D.isString(G)?B.onContentReady(G,function(){this.appendTo(G)},null,this):this.appendTo(G))},initAttributes:function(G){var F=G||{};YAHOO.widget.ButtonGroup.superclass.initAttributes.call(this,F),this.setAttributeConfig("name",{value:F.name,validator:D.isString}),this.setAttributeConfig("disabled",{value:F.disabled||!1,validator:D.isBoolean,method:this._setDisabled}),this.setAttributeConfig("value",{value:F.value}),this.setAttributeConfig("container",{value:F.container,writeOnce:!0}),this.setAttributeConfig("checkedButton",{value:null})},addButton:function(J){var L,K,G,F,H,I;return J instanceof A&&"radio"==J.get("type")?L=J:D.isString(J)||J.nodeName?L=new A(J,{type:"radio"}):(J.type="radio",L=new A(J)),L&&(F=this._buttons.length,H=L.get("name"),I=this.get("name"),L.index=F,this._buttons[F]=L,E[L.get("id")]=L,H!=I&&L.set("name",I),this.get("disabled")&&L.set("disabled",!0),L.get("checked")&&this.set("checkedButton",L),K=L.get("element"),G=this.get("element"),K.parentNode!=G&&G.appendChild(K),L.on("checkedChange",this._onButtonCheckedChange,L,this)),L},addButtons:function(G){var H,I,J,F;if(D.isArray(G)&&(H=G.length,J=[],H>0))for(F=0;F<H;F++)(I=this.addButton(G[F]))&&(J[J.length]=I);return J},removeButton:function(H){var F,I=this.getButton(H);if(I&&(this._buttons.splice(H,1),delete E[I.get("id")],I.removeListener("checkedChange",this._onButtonCheckedChange),I.destroy(),this._buttons.length>0)){F=this._buttons.length-1;do{this._buttons[F].index=F}while(F--)}},getButton:function(F){return this._buttons[F]},getButtons:function(){return this._buttons},getCount:function(){return this._buttons.length},focus:function(H){var I,G,F;if(D.isNumber(H))(I=this._buttons[H])&&I.focus();else for(G=this.getCount(),F=0;F<G;F++)if(!(I=this._buttons[F]).get("disabled")){I.focus();break}},check:function(F){var G=this.getButton(F);G&&G.set("checked",!0)},destroy:function(){var G,I=this._buttons.length,H=this.get("element"),F=H.parentNode;if(I>0){G=this._buttons.length-1;do{this._buttons[G].destroy()}while(G--)}B.purgeElement(H),F.removeChild(H)},toString:function(){return"ButtonGroup "+this.get("id")}})}(),YAHOO.register("button",YAHOO.widget.Button,{version:"@VERSION@",build:"@BUILD@"}),function(){var b=YAHOO.util,a=function(d,c,e,f){this.init(d,c,e,f)};a.NAME="Anim",a.prototype={toString:function(){var c=this.getEl()||{},d=c.id||c.tagName;return this.constructor.NAME+": "+d},patterns:{noNegatives:/width|height|opacity|padding/i,offsetAttribute:/^((width|height)|(top|left))$/,defaultUnit:/width|height|top$|bottom$|left$|right$/i,offsetUnit:/\d+(em|%|en|ex|pt|in|cm|mm|pc)$/i},doMethod:function(c,e,d){return this.method(this.currentFrame,e,d-e,this.totalFrames)},setAttribute:function(c,f,e){var d=this.getEl();this.patterns.noNegatives.test(c)&&(f=f>0?f:0),c in d&&!("style"in d&&c in d.style)?d[c]=f:b.Dom.setStyle(d,c,f+e)},getAttribute:function(c){var e=this.getEl(),g=b.Dom.getStyle(e,c);if("auto"!==g&&!this.patterns.offsetUnit.test(g))return parseFloat(g);var d=this.patterns.offsetAttribute.exec(c)||[],h=!!d[3],f=!!d[2];return"style"in e?g=f||"absolute"==b.Dom.getStyle(e,"position")&&h?e["offset"+d[0].charAt(0).toUpperCase()+d[0].substr(1)]:0:c in e&&(g=e[c]),g},getDefaultUnit:function(c){return this.patterns.defaultUnit.test(c)?"px":""},setRuntimeAttribute:function(d){var j,e,f=this.attributes;this.runtimeAttributes[d]={};var h=function(i){return void 0!==i};if(!h(f[d].to)&&!h(f[d].by))return!1;if(j=h(f[d].from)?f[d].from:this.getAttribute(d),h(f[d].to))e=f[d].to;else if(h(f[d].by))if(j.constructor==Array){e=[];for(var g=0,c=j.length;g<c;++g)e[g]=j[g]+1*f[d].by[g]}else e=j+1*f[d].by;return this.runtimeAttributes[d].start=j,this.runtimeAttributes[d].end=e,this.runtimeAttributes[d].unit=h(f[d].unit)?f[d].unit:this.getDefaultUnit(d),!0},init:function(f,c,h,i){var d=!1,e=null,g=0;f=b.Dom.get(f),this.attributes=c||{},this.duration=YAHOO.lang.isUndefined(h)?1:h,this.method=i||b.Easing.easeNone,this.useSeconds=!0,this.currentFrame=0,this.totalFrames=b.AnimMgr.fps,this.setEl=function(j){f=b.Dom.get(j)},this.getEl=function(){return f},this.isAnimated=function(){return d},this.getStartTime=function(){return e},this.runtimeAttributes={},this.animate=function(){return!this.isAnimated()&&(this.currentFrame=0,this.totalFrames=this.useSeconds?Math.ceil(b.AnimMgr.fps*this.duration):this.duration,0===this.duration&&this.useSeconds&&(this.totalFrames=1),b.AnimMgr.registerElement(this),!0)},this.stop=function(j){if(!this.isAnimated())return!1;j&&(this.currentFrame=this.totalFrames,this._onTween.fire()),b.AnimMgr.stop(this)},this._handleStart=function(){this.onStart.fire(),this.runtimeAttributes={};for(var j in this.attributes)this.attributes.hasOwnProperty(j)&&this.setRuntimeAttribute(j);d=!0,g=0,e=new Date},this._handleTween=function(){var l={duration:new Date-this.getStartTime(),currentFrame:this.currentFrame};l.toString=function(){return"duration: "+l.duration+", currentFrame: "+l.currentFrame},this.onTween.fire(l);var k=this.runtimeAttributes;for(var j in k)k.hasOwnProperty(j)&&this.setAttribute(j,this.doMethod(j,k[j].start,k[j].end),k[j].unit);this.afterTween.fire(l),g+=1},this._handleComplete=function(){var j=(new Date-e)/1e3,k={duration:j,frames:g,fps:g/j};k.toString=function(){return"duration: "+k.duration+", frames: "+k.frames+", fps: "+k.fps},d=!1,g=0,this.onComplete.fire(k)},this._onStart=new b.CustomEvent("_start",this,!0),this.onStart=new b.CustomEvent("start",this),this.onTween=new b.CustomEvent("tween",this),this.afterTween=new b.CustomEvent("afterTween",this),this._onTween=new b.CustomEvent("_tween",this,!0),this.onComplete=new b.CustomEvent("complete",this),this._onComplete=new b.CustomEvent("_complete",this,!0),this._onStart.subscribe(this._handleStart),this._onTween.subscribe(this._handleTween),this._onComplete.subscribe(this._handleComplete)}},b.Anim=a}(),YAHOO.util.AnimMgr=new function(){var e=null,c=[],g=0;this.fps=1e3,this.delay=20,this.registerElement=function(j){c[c.length]=j,g+=1,j._onStart.fire(),this.start()};var f=[],d=!1,h=function(){var j=f.shift();b.apply(YAHOO.util.AnimMgr,j),f.length&&arguments.callee()},b=function(k,j){return j=j||a(k),!(!k.isAnimated()||-1===j)&&(k._onComplete.fire(),c.splice(j,1),(g-=1)<=0&&this.stop(),!0)};this.unRegister=function(){f.push(arguments),d||(d=!0,h(),d=!1)},this.start=function(){null===e&&(e=setInterval(this.run,this.delay))},this.stop=function(l){if(l)this.unRegister(l);else{clearInterval(e);for(var k=0,j=c.length;k<j;++k)this.unRegister(c[0],0);c=[],e=null,g=0}},this.run=function(){for(var l=0,j=c.length;l<j;++l){var k=c[l];k&&k.isAnimated()&&(k.currentFrame<k.totalFrames||null===k.totalFrames?(k.currentFrame+=1,k.useSeconds&&i(k),k._onTween.fire()):YAHOO.util.AnimMgr.stop(k,l))}};var a=function(l){for(var k=0,j=c.length;k<j;++k)if(c[k]===l)return k;return-1},i=function(k){var n=k.totalFrames,m=k.currentFrame,l=k.currentFrame*k.duration*1e3/k.totalFrames,j=new Date-k.getStartTime(),o=0;(o=j<1e3*k.duration?Math.round((j/l-1)*k.currentFrame):n-(m+1))>0&&isFinite(o)&&(k.currentFrame+o>=n&&(o=n-(m+1)),k.currentFrame+=o)};this._queue=c,this._getIndex=a},YAHOO.util.Bezier=new function(){this.getPosition=function(e,d){for(var f=e.length,c=[],b=0;b<f;++b)c[b]=[e[b][0],e[b][1]];for(var a=1;a<f;++a)for(b=0;b<f-a;++b)c[b][0]=(1-d)*c[b][0]+d*c[parseInt(b+1,10)][0],c[b][1]=(1-d)*c[b][1]+d*c[parseInt(b+1,10)][1];return[c[0][0],c[0][1]]}},function(){var a=function(f,e,g,h){a.superclass.constructor.call(this,f,e,g,h)};a.NAME="ColorAnim",a.DEFAULT_BGCOLOR="#fff";var c=YAHOO.util;YAHOO.extend(a,c.Anim);var d=a.superclass,b=a.prototype;b.patterns.color=/color$/i,b.patterns.rgb=/^rgb\(([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\)$/i,b.patterns.hex=/^#?([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})$/i,b.patterns.hex3=/^#?([0-9A-F]{1})([0-9A-F]{1})([0-9A-F]{1})$/i,b.patterns.transparent=/^transparent|rgba\(0, 0, 0, 0\)$/,b.parseColor=function(e){if(3==e.length)return e;var f=this.patterns.hex.exec(e);return f&&4==f.length?[parseInt(f[1],16),parseInt(f[2],16),parseInt(f[3],16)]:(f=this.patterns.rgb.exec(e))&&4==f.length?[parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10)]:(f=this.patterns.hex3.exec(e))&&4==f.length?[parseInt(f[1]+f[1],16),parseInt(f[2]+f[2],16),parseInt(f[3]+f[3],16)]:null},b.getAttribute=function(e){var g=this.getEl();if(this.patterns.color.test(e)){var i=YAHOO.util.Dom.getStyle(g,e),h=this;if(this.patterns.transparent.test(i)){var f=YAHOO.util.Dom.getAncestorBy(g,function(j){return!h.patterns.transparent.test(i)});i=f?c.Dom.getStyle(f,e):a.DEFAULT_BGCOLOR}}else i=d.getAttribute.call(this,e);return i},b.doMethod=function(f,k,g){var j;if(this.patterns.color.test(f)){j=[];for(var h=0,e=k.length;h<e;++h)j[h]=d.doMethod.call(this,f,k[h],g[h]);j="rgb("+Math.floor(j[0])+","+Math.floor(j[1])+","+Math.floor(j[2])+")"}else j=d.doMethod.call(this,f,k,g);return j},b.setRuntimeAttribute=function(f){if(d.setRuntimeAttribute.call(this,f),this.patterns.color.test(f)){var h=this.attributes,k=this.parseColor(this.runtimeAttributes[f].start),g=this.parseColor(this.runtimeAttributes[f].end);if(void 0===h[f].to&&void 0!==h[f].by){g=this.parseColor(h[f].by);for(var j=0,e=k.length;j<e;++j)g[j]=k[j]+g[j]}this.runtimeAttributes[f].start=k,this.runtimeAttributes[f].end=g}},c.ColorAnim=a}(),YAHOO.util.Easing={easeNone:function(e,a,g,f){return g*e/f+a},easeIn:function(e,a,g,f){return g*(e/=f)*e+a},easeOut:function(e,a,g,f){return-g*(e/=f)*(e-2)+a},easeBoth:function(e,a,g,f){return(e/=f/2)<1?g/2*e*e+a:-g/2*(--e*(e-2)-1)+a},easeInStrong:function(e,a,g,f){return g*(e/=f)*e*e*e+a},easeOutStrong:function(e,a,g,f){return-g*((e=e/f-1)*e*e*e-1)+a},easeBothStrong:function(e,a,g,f){return(e/=f/2)<1?g/2*e*e*e*e+a:-g/2*((e-=2)*e*e*e-2)+a},elasticIn:function(g,e,k,j,f,i){if(0==g)return e;if(1==(g/=j))return e+k;if(i||(i=.3*j),!f||f<Math.abs(k)){f=k;h=i/4}else var h=i/(2*Math.PI)*Math.asin(k/f);return-f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)+e},elasticOut:function(g,e,k,j,f,i){if(0==g)return e;if(1==(g/=j))return e+k;if(i||(i=.3*j),!f||f<Math.abs(k)){f=k;h=i/4}else var h=i/(2*Math.PI)*Math.asin(k/f);return f*Math.pow(2,-10*g)*Math.sin((g*j-h)*(2*Math.PI)/i)+k+e},elasticBoth:function(g,e,k,j,f,i){if(0==g)return e;if(2==(g/=j/2))return e+k;if(i||(i=j*(.3*1.5)),!f||f<Math.abs(k)){f=k;h=i/4}else var h=i/(2*Math.PI)*Math.asin(k/f);return g<1?f*Math.pow(2,10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)*-.5+e:f*Math.pow(2,-10*(g-=1))*Math.sin((g*j-h)*(2*Math.PI)/i)*.5+k+e},backIn:function(e,a,h,g,f){return void 0===f&&(f=1.70158),h*(e/=g)*e*((f+1)*e-f)+a},backOut:function(e,a,h,g,f){return void 0===f&&(f=1.70158),h*((e=e/g-1)*e*((f+1)*e+f)+1)+a},backBoth:function(e,a,h,g,f){return void 0===f&&(f=1.70158),(e/=g/2)<1?h/2*(e*e*((1+(f*=1.525))*e-f))+a:h/2*((e-=2)*e*((1+(f*=1.525))*e+f)+2)+a},bounceIn:function(e,a,g,f){return g-YAHOO.util.Easing.bounceOut(f-e,0,g,f)+a},bounceOut:function(e,a,g,f){return(e/=f)<1/2.75?g*(7.5625*e*e)+a:e<2/2.75?g*(7.5625*(e-=1.5/2.75)*e+.75)+a:e<2.5/2.75?g*(7.5625*(e-=2.25/2.75)*e+.9375)+a:g*(7.5625*(e-=2.625/2.75)*e+.984375)+a},bounceBoth:function(e,a,g,f){return e<f/2?.5*YAHOO.util.Easing.bounceIn(2*e,0,g,f)+a:.5*YAHOO.util.Easing.bounceOut(2*e-f,0,g,f)+.5*g+a}},function(){var a=function(h,g,i,j){h&&a.superclass.constructor.call(this,h,g,i,j)};a.NAME="Motion";var e=YAHOO.util;YAHOO.extend(a,e.ColorAnim);var f=a.superclass,c=a.prototype;c.patterns.points=/^points$/i,c.setAttribute=function(g,i,h){this.patterns.points.test(g)?(h=h||"px",f.setAttribute.call(this,"left",i[0],h),f.setAttribute.call(this,"top",i[1],h)):f.setAttribute.call(this,g,i,h)},c.getAttribute=function(g){if(this.patterns.points.test(g))var h=[f.getAttribute.call(this,"left"),f.getAttribute.call(this,"top")];else h=f.getAttribute.call(this,g);return h},c.doMethod=function(g,k,h){var j=null;if(this.patterns.points.test(g)){var i=this.method(this.currentFrame,0,100,this.totalFrames)/100;j=e.Bezier.getPosition(this.runtimeAttributes[g],i)}else j=f.doMethod.call(this,g,k,h);return j},c.setRuntimeAttribute=function(q){if(this.patterns.points.test(q)){var g,j,n,p,h=this.getEl(),k=this.attributes,m=k.points.control||[];if(m.length>0&&!(m[0]instanceof Array))m=[m];else{var l=[];for(n=0,p=m.length;n<p;++n)l[n]=m[n];m=l}if("static"==e.Dom.getStyle(h,"position")&&e.Dom.setStyle(h,"position","relative"),d(k.points.from)?e.Dom.setXY(h,k.points.from):e.Dom.setXY(h,e.Dom.getXY(h)),g=this.getAttribute("points"),d(k.points.to)){j=b.call(this,k.points.to,g);e.Dom.getXY(this.getEl());for(n=0,p=m.length;n<p;++n)m[n]=b.call(this,m[n],g)}else if(d(k.points.by))for(j=[g[0]+k.points.by[0],g[1]+k.points.by[1]],n=0,p=m.length;n<p;++n)m[n]=[g[0]+m[n][0],g[1]+m[n][1]];this.runtimeAttributes[q]=[g],m.length>0&&(this.runtimeAttributes[q]=this.runtimeAttributes[q].concat(m)),this.runtimeAttributes[q][this.runtimeAttributes[q].length]=j}else f.setRuntimeAttribute.call(this,q)};var b=function(g,i){var h=e.Dom.getXY(this.getEl());return g=[g[0]-h[0]+i[0],g[1]-h[1]+i[1]]},d=function(g){return void 0!==g};e.Motion=a}(),function(){var d=function(f,e,g,h){f&&d.superclass.constructor.call(this,f,e,g,h)};d.NAME="Scroll";var b=YAHOO.util;YAHOO.extend(d,b.ColorAnim);var c=d.superclass,a=d.prototype;a.doMethod=function(e,h,f){return"scroll"==e?[this.method(this.currentFrame,h[0],f[0]-h[0],this.totalFrames),this.method(this.currentFrame,h[1],f[1]-h[1],this.totalFrames)]:c.doMethod.call(this,e,h,f)},a.getAttribute=function(e){var f=this.getEl();return"scroll"==e?[f.scrollLeft,f.scrollTop]:c.getAttribute.call(this,e)},a.setAttribute=function(e,h,g){var f=this.getEl();"scroll"==e?(f.scrollLeft=h[0],f.scrollTop=h[1]):c.setAttribute.call(this,e,h,g)},b.Scroll=d}(),YAHOO.register("animation",YAHOO.util.Anim,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.util.DragDropMgr||(YAHOO.util.DragDropMgr=function(){var a=YAHOO.util.Event,b=YAHOO.util.Dom;return{useShim:!1,_shimActive:!1,_shimState:!1,_debugShim:!1,_createShim:function(){var c=document.createElement("div");c.id="yui-ddm-shim",document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c),c.style.display="none",c.style.backgroundColor="red",c.style.position="absolute",c.style.zIndex="99999",b.setStyle(c,"opacity","0"),this._shim=c,a.on(c,"pointerup",this.handleMouseUp,this,!0),a.on(c,"pointermove",this.handleMouseMove,this,!0),a.on(window,"scroll",this._sizeShim,this,!0)},_sizeShim:function(){if(this._shimActive){var c=this._shim;c.style.height=b.getDocumentHeight()+"px",c.style.width=b.getDocumentWidth()+"px",c.style.top="0",c.style.left="0"}},_activateShim:function(){if(this.useShim){this._shim||this._createShim(),this._shimActive=!0;var c=this._shim,d="0";this._debugShim&&(d=".5"),b.setStyle(c,"opacity",d),this._sizeShim(),c.style.display="block"}},_deactivateShim:function(){this._shim.style.display="none",this._shimActive=!1},_shim:null,ids:{},handleIds:{},dragCurrent:null,dragOvers:{},deltaX:0,deltaY:0,preventDefault:!0,stopPropagation:!0,initialized:!1,locked:!1,interactionInfo:null,init:function(){this.initialized=!0},POINT:0,INTERSECT:1,STRICT_INTERSECT:2,mode:0,_execOnAll:function(e,d){for(var f in this.ids)for(var c in this.ids[f]){var g=this.ids[f][c];this.isTypeOfDD(g)&&g[e].apply(g,d)}},_onLoad:function(){this.init(),a.on(document,"pointerup",this.handleMouseUp,this,!0),a.on(document,"pointermove",this.handleMouseMove,this,!0),a.on(window,"unload",this._onUnload,this,!0),a.on(window,"resize",this._onResize,this,!0)},_onResize:function(c){this._execOnAll("resetConstraints",[])},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},isLocked:function(){return this.locked},locationCache:{},useCache:!0,clickPixelThresh:3,clickTimeThresh:1e3,dragThreshMet:!1,clickTimeout:null,startX:0,startY:0,fromTimeout:!1,regDragDrop:function(d,c){this.initialized||this.init(),this.ids[c]||(this.ids[c]={}),this.ids[c][d.id]=d},removeDDFromGroup:function(e,c){this.ids[c]||(this.ids[c]={});var d=this.ids[c];d&&d[e.id]&&delete d[e.id]},_remove:function(e){for(var d in e.groups)if(d){var c=this.ids[d];c&&c[e.id]&&delete c[e.id]}delete this.handleIds[e.id]},regHandle:function(d,c){this.handleIds[d]||(this.handleIds[d]={}),this.handleIds[d][c]=c},isDragDrop:function(c){return!!this.getDDById(c)},getRelated:function(h,d){var g=[];for(var f in h.groups)for(var e in this.ids[f]){var c=this.ids[f][e];this.isTypeOfDD(c)&&(d&&!c.isTarget||(g[g.length]=c))}return g},isLegalTarget:function(g,f){for(var d=this.getRelated(g,!0),e=0,c=d.length;e<c;++e)if(d[e].id==f.id)return!0;return!1},isTypeOfDD:function(c){return c&&c.__ygDragDrop},isHandle:function(d,c){return this.handleIds[d]&&this.handleIds[d][c]},getDDById:function(d){for(var c in this.ids)if(this.ids[c][d])return this.ids[c][d];return null},handleMouseDown:function(f,d){this.currentTarget=YAHOO.util.Event.getTarget(f),this.dragCurrent=d;var c=d.getEl();this.startX=YAHOO.util.Event.getPageX(f),this.startY=YAHOO.util.Event.getPageY(f),this.deltaX=this.startX-c.offsetLeft,this.deltaY=this.startY-c.offsetTop,this.dragThreshMet=!1,this.clickTimeout=setTimeout(function(){var e=YAHOO.util.DDM;e.startDrag(e.startX,e.startY),e.fromTimeout=!0},this.clickTimeThresh)},startDrag:function(c,e){this.dragCurrent&&this.dragCurrent.useShim&&(this._shimState=this.useShim,this.useShim=!0),this._activateShim(),clearTimeout(this.clickTimeout);var d=this.dragCurrent;d&&d.events.b4StartDrag&&(d.b4StartDrag(c,e),d.fireEvent("b4StartDragEvent",{x:c,y:e})),d&&d.events.startDrag&&(d.startDrag(c,e),d.fireEvent("startDragEvent",{x:c,y:e})),this.dragThreshMet=!0},handleMouseUp:function(c){this.dragCurrent&&(clearTimeout(this.clickTimeout),this.dragThreshMet&&(this.fromTimeout&&(this.fromTimeout=!1,this.handleMouseMove(c)),this.fromTimeout=!1,this.fireEvents(c,!0)),this.stopDrag(c),this.stopEvent(c))},stopEvent:function(c){this.stopPropagation&&YAHOO.util.Event.stopPropagation(c),this.preventDefault&&YAHOO.util.Event.preventDefault(c)},stopDrag:function(f,d){var c=this.dragCurrent;c&&!d&&(this.dragThreshMet&&(c.events.b4EndDrag&&(c.b4EndDrag(f),c.fireEvent("b4EndDragEvent",{e:f})),c.events.endDrag&&(c.endDrag(f),c.fireEvent("endDragEvent",{e:f}))),c.events.mouseUp&&(c.onMouseUp(f),c.fireEvent("mouseUpEvent",{e:f}))),this._shimActive&&(this._deactivateShim(),this.dragCurrent&&this.dragCurrent.useShim&&(this.useShim=this._shimState,this._shimState=!1)),this.dragCurrent=null,this.dragOvers={}},handleMouseMove:function(g){var c=this.dragCurrent;if(c){if(YAHOO.env.ua.ie&&YAHOO.env.ua.ie<9&&!g.button)return this.stopEvent(g),this.handleMouseUp(g);if(g.clientX<0||g.clientY,!this.dragThreshMet){var f=Math.abs(this.startX-YAHOO.util.Event.getPageX(g)),d=Math.abs(this.startY-YAHOO.util.Event.getPageY(g));(f>this.clickPixelThresh||d>this.clickPixelThresh)&&this.startDrag(this.startX,this.startY)}this.dragThreshMet&&(c&&c.events.b4Drag&&(c.b4Drag(g),c.fireEvent("b4DragEvent",{e:g})),c&&c.events.drag&&(c.onDrag(g),c.fireEvent("dragEvent",{e:g})),c&&this.fireEvents(g,!1)),this.stopEvent(g)}},fireEvents:function(A,o){var F=this.dragCurrent;if(F&&!F.isLocked()&&!F.dragOnly){var q=YAHOO.util.Event.getPageX(A),p=YAHOO.util.Event.getPageY(A),s=new YAHOO.util.Point(q,p),m=F.getTargetCoord(s.x,s.y),g=F.getDragEl(),f=["out","over","drop","enter"],z=new YAHOO.util.Region(m.y,m.x+g.offsetWidth,m.y+g.offsetHeight,m.x),k=[],d={},n={},t=[],G={outEvts:[],overEvts:[],dropEvts:[],enterEvts:[]};for(var v in this.dragOvers){var H=this.dragOvers[v];this.isTypeOfDD(H)&&(this.isOverTarget(s,H,this.mode,z)||G.outEvts.push(H),k[v]=!0,delete this.dragOvers[v])}for(var u in F.groups)if("string"==typeof u)for(v in this.ids[u]){var h=this.ids[u][v];this.isTypeOfDD(h)&&(h.isTarget&&!h.isLocked()&&h!=F&&this.isOverTarget(s,h,this.mode,z)&&(d[u]=!0,o?G.dropEvts.push(h):(k[h.id]?G.overEvts.push(h):G.enterEvts.push(h),this.dragOvers[h.id]=h)))}this.interactionInfo={out:G.outEvts,enter:G.enterEvts,over:G.overEvts,drop:G.dropEvts,point:s,draggedRegion:z,sourceRegion:this.locationCache[F.id],validDrop:o};for(var c in d)t.push(c);for(o&&!G.dropEvts.length&&(this.interactionInfo.validDrop=!1,F.events.invalidDrop&&(F.onInvalidDrop(A),F.fireEvent("invalidDropEvent",{e:A}))),v=0;v<f.length;v++){var D=null;if(G[f[v]+"Evts"]&&(D=G[f[v]+"Evts"]),D&&D.length){var j=f[v].charAt(0).toUpperCase()+f[v].substr(1),C="onDrag"+j,l="b4Drag"+j,r="drag"+j+"Event",B="drag"+j;if(this.mode)F.events[l]&&(F[l](A,D,t),n[C]=F.fireEvent(l+"Event",{event:A,info:D,group:t})),F.events[B]&&!1!==n[C]&&(F[C](A,D,t),F.fireEvent(r,{event:A,info:D,group:t}));else for(var E=0,w=D.length;E<w;++E)F.events[l]&&(F[l](A,D[E].id,t[0]),n[C]=F.fireEvent(l+"Event",{event:A,info:D[E].id,group:t[0]})),F.events[B]&&!1!==n[C]&&(F[C](A,D[E].id,t[0]),F.fireEvent(r,{event:A,info:D[E].id,group:t[0]}))}}}},getBestMatch:function(e){var g=null,d=e.length;if(1==d)g=e[0];else for(var f=0;f<d;++f){var c=e[f];if(this.mode==this.INTERSECT&&c.cursorIsOver){g=c;break}(!g||!g.overlap||c.overlap&&g.overlap.getArea()<c.overlap.getArea())&&(g=c)}return g},refreshCache:function(d){var f=d||this.ids;for(var c in f)if("string"==typeof c)for(var e in this.ids[c]){var h=this.ids[c][e];if(this.isTypeOfDD(h)){var j=this.getLocation(h);j?this.locationCache[h.id]=j:delete this.locationCache[h.id]}}},verifyEl:function(d){try{if(d&&d.offsetParent)return!0}catch(f){}return!1},getLocation:function(i){if(!this.isTypeOfDD(i))return null;var m,f,d,o,n,p,c,k,h,g=i.getEl();try{m=YAHOO.util.Dom.getXY(g)}catch(j){}return m?(f=m[0],d=f+g.offsetWidth,o=m[1],n=o+g.offsetHeight,p=o-i.padding[0],c=d+i.padding[1],k=n+i.padding[2],h=f-i.padding[3],new YAHOO.util.Region(p,c,k,h)):null},isOverTarget:function(k,c,e,f){var g=this.locationCache[c.id];if(g&&this.useCache||(g=this.getLocation(c),this.locationCache[c.id]=g),!g)return!1;c.cursorIsOver=g.contains(k);var j=this.dragCurrent;if(!j||!e&&!j.constrainX&&!j.constrainY)return c.cursorIsOver;if(c.overlap=null,!f){var h=j.getTargetCoord(k.x,k.y),d=j.getDragEl();f=new YAHOO.util.Region(h.y,h.x+d.offsetWidth,h.y+d.offsetHeight,h.x)}var i=f.intersect(g);return!!i&&(c.overlap=i,!!e||c.cursorIsOver)},_onUnload:function(d,c){this.unregAll()},unregAll:function(){this.dragCurrent&&(this.stopDrag(),this.dragCurrent=null),this._execOnAll("unreg",[]),this.ids={}},elementCache:{},getElWrapper:function(d){var c=this.elementCache[d];return c&&c.el||(c=this.elementCache[d]=new this.ElementWrapper(YAHOO.util.Dom.get(d))),c},getElement:function(c){return YAHOO.util.Dom.get(c)},getCss:function(d){var c=YAHOO.util.Dom.get(d);return c?c.style:null},ElementWrapper:function(c){this.el=c||null,this.id=this.el&&c.id,this.css=this.el&&c.style},getPosX:function(c){return YAHOO.util.Dom.getX(c)},getPosY:function(c){return YAHOO.util.Dom.getY(c)},swapNode:function(e,c){if(e.swapNode)e.swapNode(c);else{var f=c.parentNode,d=c.nextSibling;d==e?f.insertBefore(e,c):c==e.nextSibling?f.insertBefore(c,e):(e.parentNode.replaceChild(c,e),f.insertBefore(e,d))}},getScroll:function(){var e,c,f=document.documentElement,d=document.body;return f&&(f.scrollTop||f.scrollLeft)?(e=f.scrollTop,c=f.scrollLeft):d&&(e=d.scrollTop,c=d.scrollLeft),{top:e,left:c}},getStyle:function(d,c){return YAHOO.util.Dom.getStyle(d,c)},getScrollTop:function(){return this.getScroll().top},getScrollLeft:function(){return this.getScroll().left},moveToEl:function(c,e){var d=YAHOO.util.Dom.getXY(e);YAHOO.util.Dom.setXY(c,d)},getClientHeight:function(){return YAHOO.util.Dom.getViewportHeight()},getClientWidth:function(){return YAHOO.util.Dom.getViewportWidth()},numericSort:function(d,c){return d-c},_timeoutCount:0,_addListeners:function(){var c=YAHOO.util.DDM;YAHOO.util.Event&&document?c._onLoad():c._timeoutCount>2e3||(setTimeout(c._addListeners,10),document&&document.body&&(c._timeoutCount+=1))},handleWasClicked:function(c,e){if(this.isHandle(e,c.id))return!0;for(var d=c.parentNode;d;){if(this.isHandle(e,d.id))return!0;d=d.parentNode}return!1}}}(),YAHOO.util.DDM=YAHOO.util.DragDropMgr,YAHOO.util.DDM._addListeners()),function(){var a=YAHOO.util.Event,b=YAHOO.util.Dom;YAHOO.util.DragDrop=function(e,c,d){e&&this.init(e,c,d)},YAHOO.util.DragDrop.prototype={events:null,on:function(){this.subscribe.apply(this,arguments)},id:null,config:null,dragElId:null,handleElId:null,invalidHandleTypes:null,invalidHandleIds:null,invalidHandleClasses:null,startPageX:0,startPageY:0,groups:null,locked:!1,lock:function(){this.locked=!0},unlock:function(){this.locked=!1},isTarget:!0,padding:null,dragOnly:!1,useShim:!1,_domRef:null,__ygDragDrop:!0,constrainX:!1,constrainY:!1,minX:0,maxX:0,minY:0,maxY:0,deltaX:0,deltaY:0,maintainOffset:!1,xTicks:null,yTicks:null,primaryButtonOnly:!0,available:!1,hasOuterHandles:!1,cursorIsOver:!1,overlap:null,b4StartDrag:function(c,d){},startDrag:function(c,d){},b4Drag:function(c){},onDrag:function(c){},onDragEnter:function(c,d){},b4DragOver:function(c){},onDragOver:function(c,d){},b4DragOut:function(c){},onDragOut:function(c,d){},b4DragDrop:function(c){},onDragDrop:function(c,d){},onInvalidDrop:function(c){},b4EndDrag:function(c){},endDrag:function(c){},b4MouseDown:function(c){},onMouseDown:function(c){},onMouseUp:function(c){},onAvailable:function(){},getEl:function(){return this._domRef||(this._domRef=b.get(this.id)),this._domRef},getDragEl:function(){return b.get(this.dragElId)},init:function(f,c,d){this.initTarget(f,c,d),a.on(this._domRef||this.id,"pointerdown",this.handleMouseDown,this,!0);for(var e in this.events)this.createEvent(e+"Event")},initTarget:function(e,c,d){this.config=d||{},this.events={},this.DDM=YAHOO.util.DDM,this.groups={},"string"!=typeof e&&(this._domRef=e,e=b.generateId(e)),this.id=e,this.addToGroup(c||"default"),this.handleElId=e,a.onAvailable(e,this.handleOnAvailable,this,!0),this.setDragElId(e),this.invalidHandleTypes={A:"A"},this.invalidHandleIds={},this.invalidHandleClasses=[],this.applyConfig()},applyConfig:function(){if(this.events={mouseDown:!0,b4MouseDown:!0,mouseUp:!0,b4StartDrag:!0,startDrag:!0,b4EndDrag:!0,endDrag:!0,drag:!0,b4Drag:!0,invalidDrop:!0,b4DragOut:!0,dragOut:!0,dragEnter:!0,b4DragOver:!0,dragOver:!0,b4DragDrop:!0,dragDrop:!0},this.config.events)for(var c in this.config.events)!1===this.config.events[c]&&(this.events[c]=!1);this.padding=this.config.padding||[0,0,0,0],this.isTarget=!1!==this.config.isTarget,this.maintainOffset=this.config.maintainOffset,this.primaryButtonOnly=!1!==this.config.primaryButtonOnly,this.dragOnly=!0===this.config.dragOnly,this.useShim=!0===this.config.useShim},handleOnAvailable:function(){this.available=!0,this.resetConstraints(),this.onAvailable()},setPadding:function(e,c,f,d){this.padding=c||0===c?f||0===f?[e,c,f,d]:[e,c,e,c]:[e,e,e,e]},setInitPosition:function(f,e){var g=this.getEl();if(this.DDM.verifyEl(g)){var d=f||0,c=e||0,h=b.getXY(g);this.initPageX=h[0]-d,this.initPageY=h[1]-c,this.lastPageX=h[0],this.lastPageY=h[1],this.setStartPosition(h)}else g&&g.style&&g.style.display},setStartPosition:function(d){var c=d||b.getXY(this.getEl());this.deltaSetXY=null,this.startPageX=c[0],this.startPageY=c[1]},addToGroup:function(c){this.groups[c]=!0,this.DDM.regDragDrop(this,c)},removeFromGroup:function(c){this.groups[c]&&delete this.groups[c],this.DDM.removeDDFromGroup(this,c)},setDragElId:function(c){this.dragElId=c},setHandleElId:function(c){"string"!=typeof c&&(c=b.generateId(c)),this.handleElId=c,this.DDM.regHandle(this.id,c)},setOuterHandleElId:function(c){"string"!=typeof c&&(c=b.generateId(c)),a.on(c,"pointerdown",this.handleMouseDown,this,!0),this.setHandleElId(c),this.hasOuterHandles=!0},unreg:function(){a.removeListener(this.id,"pointerdown",this.handleMouseDown),this._domRef=null,this.DDM._remove(this)},isLocked:function(){return this.DDM.isLocked()||this.locked},handleMouseDown:function(k,j){var d=k.which||k.button;if(!(this.primaryButtonOnly&&d>1||this.isLocked())){var c=this.b4MouseDown(k),g=!0;this.events.b4MouseDown&&(g=this.fireEvent("b4MouseDownEvent",k));var f=this.onMouseDown(k),i=!0;if(this.events.mouseDown&&(i=!1!==f&&this.fireEvent("mouseDownEvent",k)),!1!==c&&!1!==f&&!1!==g&&!1!==i){this.DDM.refreshCache(this.groups);var h=new YAHOO.util.Point(a.getPageX(k),a.getPageY(k));(this.hasOuterHandles||this.DDM.isOverTarget(h,this))&&this.clickValidator(k)&&(this.setStartPosition(),this.DDM.handleMouseDown(k,this),this.DDM.stopEvent(k))}}},clickValidator:function(d){var c=YAHOO.util.Event.getTarget(d);return this.isValidHandleChild(c)&&(this.id==this.handleElId||this.DDM.handleWasClicked(c,this.id))},getTargetCoord:function(e,d){var c=e-this.deltaX,f=d-this.deltaY;return this.constrainX&&(c<this.minX&&(c=this.minX),c>this.maxX&&(c=this.maxX)),this.constrainY&&(f<this.minY&&(f=this.minY),f>this.maxY&&(f=this.maxY)),c=this.getTick(c,this.xTicks),f=this.getTick(f,this.yTicks),{x:c,y:f}},addInvalidHandleType:function(c){var d=c.toUpperCase();this.invalidHandleTypes[d]=d},addInvalidHandleId:function(c){"string"!=typeof c&&(c=b.generateId(c)),this.invalidHandleIds[c]=c},addInvalidHandleClass:function(c){this.invalidHandleClasses.push(c)},removeInvalidHandleType:function(c){var d=c.toUpperCase();delete this.invalidHandleTypes[d]},removeInvalidHandleId:function(c){"string"!=typeof c&&(c=b.generateId(c)),delete this.invalidHandleIds[c]},removeInvalidHandleClass:function(d){for(var e=0,c=this.invalidHandleClasses.length;e<c;++e)this.invalidHandleClasses[e]==d&&delete this.invalidHandleClasses[e]},isValidHandleChild:function(g){var j,f=!0;try{j=g.nodeName.toUpperCase()}catch(h){j=g.nodeName}f=(f=f&&!this.invalidHandleTypes[j])&&!this.invalidHandleIds[g.id];for(var d=0,c=this.invalidHandleClasses.length;f&&d<c;++d)f=!b.hasClass(g,this.invalidHandleClasses[d]);return f},setXTicks:function(f,c){this.xTicks=[],this.xTickSize=c;for(var e={},d=this.initPageX;d>=this.minX;d-=c)e[d]||(this.xTicks[this.xTicks.length]=d,e[d]=!0);for(d=this.initPageX;d<=this.maxX;d+=c)e[d]||(this.xTicks[this.xTicks.length]=d,e[d]=!0);this.xTicks.sort(this.DDM.numericSort)},setYTicks:function(f,c){this.yTicks=[],this.yTickSize=c;for(var e={},d=this.initPageY;d>=this.minY;d-=c)e[d]||(this.yTicks[this.yTicks.length]=d,e[d]=!0);for(d=this.initPageY;d<=this.maxY;d+=c)e[d]||(this.yTicks[this.yTicks.length]=d,e[d]=!0);this.yTicks.sort(this.DDM.numericSort)},setXConstraint:function(e,d,c){this.leftConstraint=parseInt(e,10),this.rightConstraint=parseInt(d,10),this.minX=this.initPageX-this.leftConstraint,this.maxX=this.initPageX+this.rightConstraint,c&&this.setXTicks(this.initPageX,c),this.constrainX=!0},clearConstraints:function(){this.constrainX=!1,this.constrainY=!1,this.clearTicks()},clearTicks:function(){this.xTicks=null,this.yTicks=null,this.xTickSize=0,this.yTickSize=0},setYConstraint:function(c,e,d){this.topConstraint=parseInt(c,10),this.bottomConstraint=parseInt(e,10),this.minY=this.initPageY-this.topConstraint,this.maxY=this.initPageY+this.bottomConstraint,d&&this.setYTicks(this.initPageY,d),this.constrainY=!0},resetConstraints:function(){if(this.initPageX||0===this.initPageX){var d=this.maintainOffset?this.lastPageX-this.initPageX:0,c=this.maintainOffset?this.lastPageY-this.initPageY:0;this.setInitPosition(d,c)}else this.setInitPosition();this.constrainX&&this.setXConstraint(this.leftConstraint,this.rightConstraint,this.xTickSize),this.constrainY&&this.setYConstraint(this.topConstraint,this.bottomConstraint,this.yTickSize)},getTick:function(j,f){if(f){if(f[0]>=j)return f[0];for(var d=0,c=f.length;d<c;++d){var e=d+1;if(f[e]&&f[e]>=j){var h=j-f[d];return f[e]-j>h?f[d]:f[e]}}return f[f.length-1]}return j},toString:function(){return"DragDrop "+this.id}},YAHOO.augment(YAHOO.util.DragDrop,YAHOO.util.EventProvider)}(),YAHOO.util.DD=function(c,a,b){c&&this.init(c,a,b)},YAHOO.extend(YAHOO.util.DD,YAHOO.util.DragDrop,{scroll:!0,autoOffset:function(c,b){var a=c-this.startPageX,d=b-this.startPageY;this.setDelta(a,d)},setDelta:function(b,a){this.deltaX=b,this.deltaY=a},setDragElPos:function(c,b){var a=this.getDragEl();this.alignElWithMouse(a,c,b)},alignElWithMouse:function(c,g,f){var e=this.getTargetCoord(g,f);if(this.deltaSetXY)YAHOO.util.Dom.setStyle(c,"left",e.x+this.deltaSetXY[0]+"px"),YAHOO.util.Dom.setStyle(c,"top",e.y+this.deltaSetXY[1]+"px");else{var h=[e.x,e.y];YAHOO.util.Dom.setXY(c,h);var d=parseInt(YAHOO.util.Dom.getStyle(c,"left"),10),b=parseInt(YAHOO.util.Dom.getStyle(c,"top"),10);this.deltaSetXY=[d-e.x,b-e.y]}this.cachePosition(e.x,e.y);var a=this;setTimeout(function(){a.autoScroll.call(a,e.x,e.y,c.offsetHeight,c.offsetWidth)},0)},cachePosition:function(b,a){if(b)this.lastPageX=b,this.lastPageY=a;else{var c=YAHOO.util.Dom.getXY(this.getEl());this.lastPageX=c[0],this.lastPageY=c[1]}},autoScroll:function(k,j,e,l){if(this.scroll){var m=this.DDM.getClientHeight(),b=this.DDM.getClientWidth(),o=this.DDM.getScrollTop(),d=this.DDM.getScrollLeft(),i=e+j,n=l+k,g=m+o-j-this.deltaY,f=b+d-k-this.deltaX,a=document.all?80:30;i>m&&g<40&&window.scrollTo(d,o+a),j<o&&o>0&&j-o<40&&window.scrollTo(d,o-a),n>b&&f<40&&window.scrollTo(d+a,o),k<d&&d>0&&k-d<40&&window.scrollTo(d-a,o)}},applyConfig:function(){YAHOO.util.DD.superclass.applyConfig.call(this),this.scroll=!1!==this.config.scroll},b4MouseDown:function(a){this.setStartPosition(),this.autoOffset(YAHOO.util.Event.getPageX(a),YAHOO.util.Event.getPageY(a))},b4Drag:function(a){this.setDragElPos(YAHOO.util.Event.getPageX(a),YAHOO.util.Event.getPageY(a))},toString:function(){return"DD "+this.id}}),YAHOO.util.DDProxy=function(c,a,b){c&&(this.init(c,a,b),this.initFrame())},YAHOO.util.DDProxy.dragElId="ygddfdiv",YAHOO.extend(YAHOO.util.DDProxy,YAHOO.util.DD,{resizeFrame:!0,centerFrame:!1,createFrame:function(){var b=this,a=document.body;if(a&&a.firstChild){var f=this.getDragEl(),e=YAHOO.util.Dom;if(!f){(f=document.createElement("div")).id=this.dragElId;var d=f.style;d.position="absolute",d.visibility="hidden",d.cursor="move",d.border="2px solid #aaa",d.zIndex=999,d.height="25px",d.width="25px";var c=document.createElement("div");e.setStyle(c,"height","100%"),e.setStyle(c,"width","100%"),e.setStyle(c,"background-color","#ccc"),e.setStyle(c,"opacity","0"),f.appendChild(c),a.insertBefore(f,a.firstChild)}}else setTimeout(function(){b.createFrame()},50)},initFrame:function(){this.createFrame()},applyConfig:function(){YAHOO.util.DDProxy.superclass.applyConfig.call(this),this.resizeFrame=!1!==this.config.resizeFrame,this.centerFrame=this.config.centerFrame,this.setDragElId(this.config.dragElId||YAHOO.util.DDProxy.dragElId)},showFrame:function(e,d){this.getEl();var a=this.getDragEl(),b=a.style;this._resizeProxy(),this.centerFrame&&this.setDelta(Math.round(parseInt(b.width,10)/2),Math.round(parseInt(b.height,10)/2)),this.setDragElPos(e,d),YAHOO.util.Dom.setStyle(a,"visibility","visible")},_resizeProxy:function(){if(this.resizeFrame){var h=YAHOO.util.Dom,b=this.getEl(),c=this.getDragEl(),g=parseInt(h.getStyle(c,"borderTopWidth"),10),i=parseInt(h.getStyle(c,"borderRightWidth"),10),f=parseInt(h.getStyle(c,"borderBottomWidth"),10),d=parseInt(h.getStyle(c,"borderLeftWidth"),10);isNaN(g)&&(g=0),isNaN(i)&&(i=0),isNaN(f)&&(f=0),isNaN(d)&&(d=0);var e=Math.max(0,b.offsetWidth-i-d),a=Math.max(0,b.offsetHeight-g-f);h.setStyle(c,"width",e+"px"),h.setStyle(c,"height",a+"px")}},b4MouseDown:function(b){this.setStartPosition();var a=YAHOO.util.Event.getPageX(b),c=YAHOO.util.Event.getPageY(b);this.autoOffset(a,c)},b4StartDrag:function(a,b){this.showFrame(a,b)},b4EndDrag:function(a){YAHOO.util.Dom.setStyle(this.getDragEl(),"visibility","hidden")},endDrag:function(d){var c=YAHOO.util.Dom,b=this.getEl(),a=this.getDragEl();c.setStyle(a,"visibility",""),c.setStyle(b,"visibility","hidden"),YAHOO.util.DDM.moveToEl(b,a),c.setStyle(a,"visibility","hidden"),c.setStyle(b,"visibility","")},toString:function(){return"DDProxy "+this.id}}),YAHOO.util.DDTarget=function(c,a,b){c&&this.initTarget(c,a,b)},YAHOO.extend(YAHOO.util.DDTarget,YAHOO.util.DragDrop,{toString:function(){return"DDTarget "+this.id}}),YAHOO.register("dragdrop",YAHOO.util.DragDropMgr,{version:"@VERSION@",build:"@BUILD@"}),function(){YAHOO.util.Config=function(d){d&&this.init(d)};var b=YAHOO.lang,c=YAHOO.util.CustomEvent,a=YAHOO.util.Config;a.CONFIG_CHANGED_EVENT="configChanged",a.BOOLEAN_TYPE="boolean",a.prototype={owner:null,queueInProgress:!1,config:null,initialConfig:null,eventQueue:null,configChangedEvent:null,init:function(d){this.owner=d,this.configChangedEvent=this.createEvent(a.CONFIG_CHANGED_EVENT),this.configChangedEvent.signature=c.LIST,this.queueInProgress=!1,this.config={},this.initialConfig={},this.eventQueue=[]},checkBoolean:function(d){return typeof d==a.BOOLEAN_TYPE},checkNumber:function(d){return!isNaN(d)},fireEvent:function(d,f){var e=this.config[d];e&&e.event&&e.event.fire(f)},addProperty:function(e,d){e=e.toLowerCase(),this.config[e]=d,d.event=this.createEvent(e,{scope:this.owner}),d.event.signature=c.LIST,d.key=e,d.handler&&d.event.subscribe(d.handler,this.owner),this.setProperty(e,d.value,!0),d.suppressEvent||this.queueProperty(e,d.value)},getConfig:function(){var g,e,d={},f=this.config;for(g in f)b.hasOwnProperty(f,g)&&(e=f[g])&&e.event&&(d[g]=e.value);return d},getProperty:function(d){var e=this.config[d.toLowerCase()];return e&&e.event?e.value:void 0},resetProperty:function(d){d=d.toLowerCase();var e=this.config[d];return!(!e||!e.event)&&(d in this.initialConfig?(this.setProperty(d,this.initialConfig[d]),!0):void 0)},setProperty:function(e,g,d){var f;return e=e.toLowerCase(),this.queueInProgress&&!d?(this.queueProperty(e,g),!0):!(!(f=this.config[e])||!f.event||f.validator&&!f.validator(g)||(f.value=g,d||(this.fireEvent(e,g),this.configChangedEvent.fire([e,g])),0))},queueProperty:function(v,r){v=v.toLowerCase();var k,g,h,j,p,t,f,n,o,d,m,w,e,u=this.config[v],l=!1;if(u&&u.event){if(!b.isUndefined(r)&&u.validator&&!u.validator(r))return!1;for(b.isUndefined(r)?r=u.value:u.value=r,l=!1,k=this.eventQueue.length,m=0;m<k;m++)if((g=this.eventQueue[m])&&(h=g[0],j=g[1],h==v)){this.eventQueue[m]=null,this.eventQueue.push([v,b.isUndefined(r)?j:r]),l=!0;break}if(l||b.isUndefined(r)||this.eventQueue.push([v,r]),u.supercedes)for(p=u.supercedes.length,w=0;w<p;w++)for(t=u.supercedes[w],f=this.eventQueue.length,e=0;e<f;e++)if((n=this.eventQueue[e])&&(o=n[0],d=n[1],o==t.toLowerCase())){this.eventQueue.push([o,d]),this.eventQueue[e]=null;break}return!0}return!1},refireEvent:function(d){d=d.toLowerCase();var e=this.config[d];e&&e.event&&!b.isUndefined(e.value)&&(this.queueInProgress?this.queueProperty(d):this.fireEvent(d,e.value))},applyConfig:function(d,g){var f,e;if(g){e={};for(f in d)b.hasOwnProperty(d,f)&&(e[f.toLowerCase()]=d[f]);this.initialConfig=e}for(f in d)b.hasOwnProperty(d,f)&&this.queueProperty(f,d[f])},refresh:function(){var d;for(d in this.config)b.hasOwnProperty(this.config,d)&&this.refireEvent(d)},fireQueue:function(){var e,h,d,g;for(this.queueInProgress=!0,e=0;e<this.eventQueue.length;e++)(h=this.eventQueue[e])&&(d=h[0],g=h[1],this.config[d].value=g,this.eventQueue[e]=null,this.fireEvent(d,g));this.queueInProgress=!1,this.eventQueue=[]},subscribeToConfigEvent:function(d,e,g,h){var f=this.config[d.toLowerCase()];return!(!f||!f.event)&&(a.alreadySubscribed(f.event,e,g)||f.event.subscribe(e,g,h),!0)},unsubscribeFromConfigEvent:function(d,e,g){var f=this.config[d.toLowerCase()];return!(!f||!f.event)&&f.event.unsubscribe(e,g)},toString:function(){var d="Config";return this.owner&&(d+=" ["+this.owner.toString()+"]"),d},outputEventQueue:function(){var g,e,d="",f=this.eventQueue.length;for(e=0;e<f;e++)(g=this.eventQueue[e])&&(d+=g[0]+"="+g[1]+", ");return d},destroy:function(){var d,f,e=this.config;for(d in e)b.hasOwnProperty(e,d)&&((f=e[d]).event.unsubscribeAll(),f.event=null);this.configChangedEvent.unsubscribeAll(),this.configChangedEvent=null,this.owner=null,this.config=null,this.initialConfig=null,this.eventQueue=null}},a.alreadySubscribed=function(e,h,j){var d,g,f=e.subscribers.length;if(f>0){g=f-1;do{if((d=e.subscribers[g])&&d.obj==j&&d.fn==h)return!0}while(g--)}return!1},YAHOO.lang.augmentProto(a,YAHOO.util.EventProvider)}(),function(){function l(){return h||((h=document.createElement("div")).innerHTML='<div class="'+g.CSS_HEADER+'"></div><div class="'+g.CSS_BODY+'"></div><div class="'+g.CSS_FOOTER+'"></div>',p=h.firstChild,o=p.nextSibling,e=o.nextSibling),h}function k(){return p||l(),p.cloneNode(!1)}function b(){return o||l(),o.cloneNode(!1)}function c(){return e||l(),e.cloneNode(!1)}YAHOO.widget.Module=function(r,q){r&&this.init(r,q)};var h,p,o,e,f=YAHOO.util.Dom,d=YAHOO.util.Config,n=YAHOO.util.Event,m=YAHOO.util.CustomEvent,g=YAHOO.widget.Module,i=YAHOO.env.ua,a={BEFORE_INIT:"beforeInit",INIT:"init",APPEND:"append",BEFORE_RENDER:"beforeRender",RENDER:"render",CHANGE_HEADER:"changeHeader",CHANGE_BODY:"changeBody",CHANGE_FOOTER:"changeFooter",CHANGE_CONTENT:"changeContent",DESTROY:"destroy",BEFORE_SHOW:"beforeShow",SHOW:"show",BEFORE_HIDE:"beforeHide",HIDE:"hide"},j={VISIBLE:{key:"visible",value:!0,validator:YAHOO.lang.isBoolean},EFFECT:{key:"effect",suppressEvent:!0,supercedes:["visible"]},MONITOR_RESIZE:{key:"monitorresize",value:!0},APPEND_TO_DOCUMENT_BODY:{key:"appendtodocumentbody",value:!1}};g.IMG_ROOT=null,g.IMG_ROOT_SSL=null,g.CSS_MODULE="yui-module",g.CSS_HEADER="hd",g.CSS_BODY="bd",g.CSS_FOOTER="ft",g.RESIZE_MONITOR_SECURE_URL="javascript:false;",g.RESIZE_MONITOR_BUFFER=1,g.textResizeEvent=new m("textResize"),g.forceDocumentRedraw=function(){var q=document.documentElement;q&&(q.className+=" ",q.className=YAHOO.lang.trim(q.className))},g.prototype={constructor:g,element:null,header:null,body:null,footer:null,id:null,imageRoot:g.IMG_ROOT,initEvents:function(){var q=m.LIST;this.beforeInitEvent=this.createEvent(a.BEFORE_INIT),this.beforeInitEvent.signature=q,this.initEvent=this.createEvent(a.INIT),this.initEvent.signature=q,this.appendEvent=this.createEvent(a.APPEND),this.appendEvent.signature=q,this.beforeRenderEvent=this.createEvent(a.BEFORE_RENDER),this.beforeRenderEvent.signature=q,this.renderEvent=this.createEvent(a.RENDER),this.renderEvent.signature=q,this.changeHeaderEvent=this.createEvent(a.CHANGE_HEADER),this.changeHeaderEvent.signature=q,this.changeBodyEvent=this.createEvent(a.CHANGE_BODY),this.changeBodyEvent.signature=q,this.changeFooterEvent=this.createEvent(a.CHANGE_FOOTER),this.changeFooterEvent.signature=q,this.changeContentEvent=this.createEvent(a.CHANGE_CONTENT),this.changeContentEvent.signature=q,this.destroyEvent=this.createEvent(a.DESTROY),this.destroyEvent.signature=q,this.beforeShowEvent=this.createEvent(a.BEFORE_SHOW),this.beforeShowEvent.signature=q,this.showEvent=this.createEvent(a.SHOW),this.showEvent.signature=q,this.beforeHideEvent=this.createEvent(a.BEFORE_HIDE),this.beforeHideEvent.signature=q,this.hideEvent=this.createEvent(a.HIDE),this.hideEvent.signature=q},platform:function(){var q=navigator.userAgent.toLowerCase();return-1!=q.indexOf("windows")||-1!=q.indexOf("win32")?"windows":-1!=q.indexOf("macintosh")&&"mac"}(),browser:function(){var q=navigator.userAgent.toLowerCase();return-1!=q.indexOf("opera")?"opera":-1!=q.indexOf("msie 7")?"ie7":-1!=q.indexOf("msie")?"ie":-1!=q.indexOf("safari")?"safari":-1!=q.indexOf("gecko")&&"gecko"}(),isSecure:0===window.location.href.toLowerCase().indexOf("https"),initDefaultConfig:function(){this.cfg.addProperty(j.VISIBLE.key,{handler:this.configVisible,value:j.VISIBLE.value,validator:j.VISIBLE.validator}),this.cfg.addProperty(j.EFFECT.key,{handler:this.configEffect,suppressEvent:j.EFFECT.suppressEvent,supercedes:j.EFFECT.supercedes}),this.cfg.addProperty(j.MONITOR_RESIZE.key,{handler:this.configMonitorResize,value:j.MONITOR_RESIZE.value}),this.cfg.addProperty(j.APPEND_TO_DOCUMENT_BODY.key,{value:j.APPEND_TO_DOCUMENT_BODY.value})},init:function(v,u){var s,w;if(this.initEvents(),this.beforeInitEvent.fire(g),this.cfg=new d(this),this.isSecure&&(this.imageRoot=g.IMG_ROOT_SSL),"string"==typeof v&&(s=v,(v=document.getElementById(v))||((v=l().cloneNode(!1)).id=s)),this.id=f.generateId(v),this.element=v,w=this.element.firstChild){var r=!1,q=!1,t=!1;do{1==w.nodeType&&(!r&&f.hasClass(w,g.CSS_HEADER)?(this.header=w,r=!0):!q&&f.hasClass(w,g.CSS_BODY)?(this.body=w,q=!0):!t&&f.hasClass(w,g.CSS_FOOTER)&&(this.footer=w,t=!0))}while(w=w.nextSibling)}this.initDefaultConfig(),f.addClass(this.element,g.CSS_MODULE),u&&this.cfg.applyConfig(u,!0),d.alreadySubscribed(this.renderEvent,this.cfg.fireQueue,this.cfg)||this.renderEvent.subscribe(this.cfg.fireQueue,this.cfg,!0),this.initEvent.fire(g)},initResizeMonitor:function(){if(i.gecko&&"windows"==this.platform){var q=this;setTimeout(function(){q._initResizeMonitor()},0)}else this._initResizeMonitor()},_initResizeMonitor:function(){function w(){g.textResizeEvent.fire()}var q,s,u;if(!i.opera){s=f.get("_yuiResizeMonitor");var v=this._supportsCWResize();if(!s){s=document.createElement("iframe"),this.isSecure&&g.RESIZE_MONITOR_SECURE_URL&&i.ie&&(s.src=g.RESIZE_MONITOR_SECURE_URL),v||(u=["<html><head><script ",'type="text/javascript">',"window.onresize=function(){window.parent.","YAHOO.widget.Module.textResizeEvent.","fire();};<","/script></head>","<body></body></html>"].join(""),s.src="data:text/html;charset=utf-8,"+encodeURIComponent(u)),s.id="_yuiResizeMonitor",s.title="Text Resize Monitor",s.tabIndex=-1,s.setAttribute("role","presentation"),s.style.position="absolute",s.style.visibility="hidden";var r=document.body,t=r.firstChild;t?r.insertBefore(s,t):r.appendChild(s),s.style.backgroundColor="transparent",s.style.borderWidth="0",s.style.width="2em",s.style.height="2em",s.style.left="0",s.style.top=-1*(s.offsetHeight+g.RESIZE_MONITOR_BUFFER)+"px",s.style.visibility="visible",i.webkit&&((q=s.contentWindow.document).open(),q.close())}s&&s.contentWindow&&(g.textResizeEvent.subscribe(this.onDomResize,this,!0),g.textResizeInitialized||(v&&(n.on(s.contentWindow,"resize",w)||n.on(s,"resize",w)),g.textResizeInitialized=!0),this.resizeMonitor=s)}},_supportsCWResize:function(){var q=!0;return i.gecko&&i.gecko<=1.8&&(q=!1),q},onDomResize:function(s,r){var q=-1*(this.resizeMonitor.offsetHeight+g.RESIZE_MONITOR_BUFFER);this.resizeMonitor.style.top=q+"px",this.resizeMonitor.style.left="0"},setHeader:function(r){var q=this.header||(this.header=k());r.nodeName?(q.innerHTML="",q.appendChild(r)):q.innerHTML=r,this._rendered&&this._renderHeader(),this.changeHeaderEvent.fire(r),this.changeContentEvent.fire()},appendToHeader:function(r){(this.header||(this.header=k())).appendChild(r),this.changeHeaderEvent.fire(r),this.changeContentEvent.fire()},setBody:function(r){var q=this.body||(this.body=b());r.nodeName?(q.innerHTML="",q.appendChild(r)):q.innerHTML=r,this._rendered&&this._renderBody(),this.changeBodyEvent.fire(r),this.changeContentEvent.fire()},appendToBody:function(r){(this.body||(this.body=b())).appendChild(r),this.changeBodyEvent.fire(r),this.changeContentEvent.fire()},setFooter:function(r){var q=this.footer||(this.footer=c());r.nodeName?(q.innerHTML="",q.appendChild(r)):q.innerHTML=r,this._rendered&&this._renderFooter(),this.changeFooterEvent.fire(r),this.changeContentEvent.fire()},appendToFooter:function(r){(this.footer||(this.footer=c())).appendChild(r),this.changeFooterEvent.fire(r),this.changeContentEvent.fire()},render:function(s,q){var t=this;if(this.beforeRenderEvent.fire(),q||(q=this.element),s)!function(u){"string"==typeof u&&(u=document.getElementById(u)),u&&(t._addToParent(u,t.element),t.appendEvent.fire())}(s);else if(!f.inDocument(this.element))return!1;return this._renderHeader(q),this._renderBody(q),this._renderFooter(q),this._rendered=!0,this.renderEvent.fire(),!0},_renderHeader:function(q){if(q=q||this.element,this.header&&!f.inDocument(this.header)){var r=q.firstChild;r?q.insertBefore(this.header,r):q.appendChild(this.header)}},_renderBody:function(q){q=q||this.element,this.body&&!f.inDocument(this.body)&&(this.footer&&f.isAncestor(q,this.footer)?q.insertBefore(this.body,this.footer):q.appendChild(this.body))},_renderFooter:function(q){q=q||this.element,this.footer&&!f.inDocument(this.footer)&&q.appendChild(this.footer)},destroy:function(q){var r,s=!q;this.element&&(n.purgeElement(this.element,s),r=this.element.parentNode),r&&r.removeChild(this.element),this.element=null,this.header=null,this.body=null,this.footer=null,g.textResizeEvent.unsubscribe(this.onDomResize,this),this.cfg.destroy(),this.cfg=null,this.destroyEvent.fire()},show:function(){this.cfg.setProperty("visible",!0)},hide:function(){this.cfg.setProperty("visible",!1)},configVisible:function(r,q,s){q[0]?this.beforeShowEvent.fire()&&(f.setStyle(this.element,"display","block"),this.showEvent.fire()):this.beforeHideEvent.fire()&&(f.setStyle(this.element,"display","none"),this.hideEvent.fire())},configEffect:function(r,q,s){this._cachedEffects=this.cacheEffects?this._createEffects(q[0]):null},cacheEffects:!0,_createEffects:function(t){var u,r,s,q=null;if(t)if(t instanceof Array)for(q=[],u=t.length,r=0;r<u;r++)(s=t[r]).effect&&(q[q.length]=s.effect(this,s.duration));else t.effect&&(q=[t.effect(this,t.duration)]);return q},configMonitorResize:function(s,r,t){r[0]?this.initResizeMonitor():(g.textResizeEvent.unsubscribe(this.onDomResize,this,!0),this.resizeMonitor=null)},_addToParent:function(q,r){!this.cfg.getProperty("appendtodocumentbody")&&q===document.body&&q.firstChild?q.insertBefore(r,q.firstChild):q.appendChild(r)},toString:function(){return"Module "+this.id}},YAHOO.lang.augmentProto(g,YAHOO.util.EventProvider)}(),function(){YAHOO.widget.Overlay=function(p,o){YAHOO.widget.Overlay.superclass.constructor.call(this,p,o)};var j,i=YAHOO.lang,m=YAHOO.util.CustomEvent,g=YAHOO.widget.Module,n=YAHOO.util.Event,f=YAHOO.util.Dom,d=YAHOO.util.Config,k=YAHOO.env.ua,b=YAHOO.widget.Overlay,e="unsubscribe",a={BEFORE_MOVE:"beforeMove",MOVE:"move"},l={X:{key:"x",validator:i.isNumber,suppressEvent:!0,supercedes:["iframe"]},Y:{key:"y",validator:i.isNumber,suppressEvent:!0,supercedes:["iframe"]},XY:{key:"xy",suppressEvent:!0,supercedes:["iframe"]},CONTEXT:{key:"context",suppressEvent:!0,supercedes:["iframe"]},FIXED_CENTER:{key:"fixedcenter",value:!1,supercedes:["iframe","visible"]},WIDTH:{key:"width",suppressEvent:!0,supercedes:["context","fixedcenter","iframe"]},HEIGHT:{key:"height",suppressEvent:!0,supercedes:["context","fixedcenter","iframe"]},AUTO_FILL_HEIGHT:{key:"autofillheight",supercedes:["height"],value:"body"},ZINDEX:{key:"zindex",value:null},CONSTRAIN_TO_VIEWPORT:{key:"constraintoviewport",value:!1,validator:i.isBoolean,supercedes:["iframe","x","y","xy"]},IFRAME:{key:"iframe",value:6==k.ie,validator:i.isBoolean,supercedes:["zindex"]},PREVENT_CONTEXT_OVERLAP:{key:"preventcontextoverlap",value:!1,validator:i.isBoolean,supercedes:["constraintoviewport"]}};b.IFRAME_SRC="javascript:false;",b.IFRAME_OFFSET=3,b.VIEWPORT_OFFSET=10,b.TOP_LEFT="tl",b.TOP_RIGHT="tr",b.BOTTOM_LEFT="bl",b.BOTTOM_RIGHT="br",b.PREVENT_OVERLAP_X={tltr:!0,blbr:!0,brbl:!0,trtl:!0},b.PREVENT_OVERLAP_Y={trbr:!0,tlbl:!0,bltl:!0,brtr:!0},b.CSS_OVERLAY="yui-overlay",b.CSS_HIDDEN="yui-overlay-hidden",b.CSS_IFRAME="yui-overlay-iframe",b.STD_MOD_RE=/^\s*?(body|footer|header)\s*?$/i,b.windowScrollEvent=new m("windowScroll"),b.windowResizeEvent=new m("windowResize"),b.windowScrollHandler=function(p){var o=n.getTarget(p);o&&o!==window&&o!==window.document||(k.ie?(window.scrollEnd||(window.scrollEnd=-1),clearTimeout(window.scrollEnd),window.scrollEnd=setTimeout(function(){b.windowScrollEvent.fire()},1)):b.windowScrollEvent.fire())},b.windowResizeHandler=function(o){k.ie?(window.resizeEnd||(window.resizeEnd=-1),clearTimeout(window.resizeEnd),window.resizeEnd=setTimeout(function(){b.windowResizeEvent.fire()},100)):b.windowResizeEvent.fire()},b._initialized=null,null===b._initialized&&(n.on(window,"scroll",b.windowScrollHandler),n.on(window,"resize",b.windowResizeHandler),b._initialized=!0),b._TRIGGER_MAP={windowScroll:b.windowScrollEvent,windowResize:b.windowResizeEvent,textResize:g.textResizeEvent},YAHOO.extend(b,g,{CONTEXT_TRIGGERS:[],init:function(p,o){b.superclass.init.call(this,p),this.beforeInitEvent.fire(b),f.addClass(this.element,b.CSS_OVERLAY),o&&this.cfg.applyConfig(o,!0),"mac"==this.platform&&k.gecko&&(d.alreadySubscribed(this.showEvent,this.showMacGeckoScrollbars,this)||this.showEvent.subscribe(this.showMacGeckoScrollbars,this,!0),d.alreadySubscribed(this.hideEvent,this.hideMacGeckoScrollbars,this)||this.hideEvent.subscribe(this.hideMacGeckoScrollbars,this,!0)),this.initEvent.fire(b)},initEvents:function(){b.superclass.initEvents.call(this);var o=m.LIST;this.beforeMoveEvent=this.createEvent(a.BEFORE_MOVE),this.beforeMoveEvent.signature=o,this.moveEvent=this.createEvent(a.MOVE),this.moveEvent.signature=o},initDefaultConfig:function(){b.superclass.initDefaultConfig.call(this);var o=this.cfg;o.addProperty(l.X.key,{handler:this.configX,validator:l.X.validator,suppressEvent:l.X.suppressEvent,supercedes:l.X.supercedes}),o.addProperty(l.Y.key,{handler:this.configY,validator:l.Y.validator,suppressEvent:l.Y.suppressEvent,supercedes:l.Y.supercedes}),o.addProperty(l.XY.key,{handler:this.configXY,suppressEvent:l.XY.suppressEvent,supercedes:l.XY.supercedes}),o.addProperty(l.CONTEXT.key,{handler:this.configContext,suppressEvent:l.CONTEXT.suppressEvent,supercedes:l.CONTEXT.supercedes}),o.addProperty(l.FIXED_CENTER.key,{handler:this.configFixedCenter,value:l.FIXED_CENTER.value,validator:l.FIXED_CENTER.validator,supercedes:l.FIXED_CENTER.supercedes}),o.addProperty(l.WIDTH.key,{handler:this.configWidth,suppressEvent:l.WIDTH.suppressEvent,supercedes:l.WIDTH.supercedes}),o.addProperty(l.HEIGHT.key,{handler:this.configHeight,suppressEvent:l.HEIGHT.suppressEvent,supercedes:l.HEIGHT.supercedes}),o.addProperty(l.AUTO_FILL_HEIGHT.key,{handler:this.configAutoFillHeight,value:l.AUTO_FILL_HEIGHT.value,validator:this._validateAutoFill,supercedes:l.AUTO_FILL_HEIGHT.supercedes}),o.addProperty(l.ZINDEX.key,{handler:this.configzIndex,value:l.ZINDEX.value}),o.addProperty(l.CONSTRAIN_TO_VIEWPORT.key,{handler:this.configConstrainToViewport,value:l.CONSTRAIN_TO_VIEWPORT.value,validator:l.CONSTRAIN_TO_VIEWPORT.validator,supercedes:l.CONSTRAIN_TO_VIEWPORT.supercedes}),o.addProperty(l.IFRAME.key,{handler:this.configIframe,value:l.IFRAME.value,validator:l.IFRAME.validator,supercedes:l.IFRAME.supercedes}),o.addProperty(l.PREVENT_CONTEXT_OVERLAP.key,{value:l.PREVENT_CONTEXT_OVERLAP.value,validator:l.PREVENT_CONTEXT_OVERLAP.validator,supercedes:l.PREVENT_CONTEXT_OVERLAP.supercedes})},moveTo:function(o,p){this.cfg.setProperty("xy",[o,p])},hideMacGeckoScrollbars:function(){f.replaceClass(this.element,"show-scrollbars","hide-scrollbars")},showMacGeckoScrollbars:function(){f.replaceClass(this.element,"hide-scrollbars","show-scrollbars")},_setDomVisibility:function(o){f.setStyle(this.element,"visibility",o?"visible":"hidden");var p=b.CSS_HIDDEN;o?f.removeClass(this.element,p):f.addClass(this.element,p)},configVisible:function(x,w,t){var q,v,s,r,u,z,p=w[0],B=f.getStyle(this.element,"visibility"),o=this._cachedEffects||this._createEffects(this.cfg.getProperty("effect")),A="mac"==this.platform&&k.gecko,y=d.alreadySubscribed;if("inherit"==B){for(v=this.element.parentNode;9!=v.nodeType&&11!=v.nodeType&&"inherit"==(B=f.getStyle(v,"visibility"));)v=v.parentNode;"inherit"==B&&(B="visible")}if(p)if(A&&this.showMacGeckoScrollbars(),o){if(p&&("visible"!=B||""===B||this._fadingOut)&&this.beforeShowEvent.fire())for(z=o.length,s=0;s<z;s++)q=o[s],0!==s||y(q.animateInCompleteEvent,this.showEvent.fire,this.showEvent)||q.animateInCompleteEvent.subscribe(this.showEvent.fire,this.showEvent,!0),q.animateIn()}else"visible"!=B||""===B?this.beforeShowEvent.fire()&&(this._setDomVisibility(!0),this.cfg.refireEvent("iframe"),this.showEvent.fire()):this._setDomVisibility(!0);else if(A&&this.hideMacGeckoScrollbars(),o)if("visible"==B||this._fadingIn){if(this.beforeHideEvent.fire())for(z=o.length,r=0;r<z;r++)u=o[r],0!==r||y(u.animateOutCompleteEvent,this.hideEvent.fire,this.hideEvent)||u.animateOutCompleteEvent.subscribe(this.hideEvent.fire,this.hideEvent,!0),u.animateOut()}else""===B&&this._setDomVisibility(!1);else"visible"==B||""===B?this.beforeHideEvent.fire()&&(this._setDomVisibility(!1),this.hideEvent.fire()):this._setDomVisibility(!1)},doCenterOnDOMEvent:function(){var o=this.cfg,p=o.getProperty("fixedcenter");o.getProperty("visible")&&p&&("contained"!==p||this.fitsInViewport())&&this.center()},fitsInViewport:function(){var s=b.VIEWPORT_OFFSET,q=this.element,t=q.offsetWidth,r=q.offsetHeight,o=f.getViewportWidth(),p=f.getViewportHeight();return t+s<o&&r+s<p},configFixedCenter:function(s,q,t){var u=q[0],p=d.alreadySubscribed,r=b.windowResizeEvent,o=b.windowScrollEvent;u?(this.center(),p(this.beforeShowEvent,this.center)||this.beforeShowEvent.subscribe(this.center),p(r,this.doCenterOnDOMEvent,this)||r.subscribe(this.doCenterOnDOMEvent,this,!0),p(o,this.doCenterOnDOMEvent,this)||o.subscribe(this.doCenterOnDOMEvent,this,!0)):(this.beforeShowEvent.unsubscribe(this.center),r.unsubscribe(this.doCenterOnDOMEvent,this),o.unsubscribe(this.doCenterOnDOMEvent,this))},configHeight:function(r,p,s){var o=p[0],q=this.element;f.setStyle(q,"height",o),this.cfg.refireEvent("iframe")},configAutoFillHeight:function(t,s,p){var v=s[0],q=this.cfg,u="autofillheight",w="height",r=q.getProperty(u),o=this._autoFillOnHeightChange;q.unsubscribeFromConfigEvent(w,o),g.textResizeEvent.unsubscribe(o),this.changeContentEvent.unsubscribe(o),r&&v!==r&&this[r]&&f.setStyle(this[r],w,""),v&&(v=i.trim(v.toLowerCase()),q.subscribeToConfigEvent(w,o,this[v],this),g.textResizeEvent.subscribe(o,this[v],this),this.changeContentEvent.subscribe(o,this[v],this),q.setProperty(u,v,!0))},configWidth:function(r,o,s){var q=o[0],p=this.element;f.setStyle(p,"width",q),this.cfg.refireEvent("iframe")},configzIndex:function(q,o,r){var s=o[0],p=this.element;s||(s=f.getStyle(p,"zIndex"))&&!isNaN(s)||(s=0),(this.iframe||!0===this.cfg.getProperty("iframe"))&&s<=0&&(s=1),f.setStyle(p,"zIndex",s),this.cfg.setProperty("zIndex",s,!0),this.iframe&&this.stackIframe()},configXY:function(q,p,r){var t=p[0],o=t[0],s=t[1];this.cfg.setProperty("x",o),this.cfg.setProperty("y",s),this.beforeMoveEvent.fire([o,s]),o=this.cfg.getProperty("x"),s=this.cfg.getProperty("y"),this.cfg.refireEvent("iframe"),this.moveEvent.fire([o,s])},configX:function(q,p,r){var o=p[0],s=this.cfg.getProperty("y");this.cfg.setProperty("x",o,!0),this.cfg.setProperty("y",s,!0),this.beforeMoveEvent.fire([o,s]),o=this.cfg.getProperty("x"),s=this.cfg.getProperty("y"),f.setX(this.element,o,!0),this.cfg.setProperty("xy",[o,s],!0),this.cfg.refireEvent("iframe"),this.moveEvent.fire([o,s])},configY:function(q,p,r){var o=this.cfg.getProperty("x"),s=p[0];this.cfg.setProperty("x",o,!0),this.cfg.setProperty("y",s,!0),this.beforeMoveEvent.fire([o,s]),o=this.cfg.getProperty("x"),s=this.cfg.getProperty("y"),f.setY(this.element,s,!0),this.cfg.setProperty("xy",[o,s],!0),this.cfg.refireEvent("iframe"),this.moveEvent.fire([o,s])},showIframe:function(){var o,p=this.iframe;p&&((o=this.element.parentNode)!=p.parentNode&&this._addToParent(o,p),p.style.display="block")},hideIframe:function(){this.iframe&&(this.iframe.style.display="none")},syncIframe:function(){var r,o=this.iframe,q=this.element,s=b.IFRAME_OFFSET,p=2*s;o&&(o.style.width=q.offsetWidth+p+"px",o.style.height=q.offsetHeight+p+"px",r=this.cfg.getProperty("xy"),(!i.isArray(r)||isNaN(r[0])||isNaN(r[1]))&&(this.syncPosition(),r=this.cfg.getProperty("xy")),f.setXY(o,[r[0]-s,r[1]-s]))},stackIframe:function(){if(this.iframe){var o=f.getStyle(this.element,"zIndex");YAHOO.lang.isUndefined(o)||isNaN(o)||f.setStyle(this.iframe,"zIndex",o-1)}},configIframe:function(r,q,s){function t(){var x,v=this.iframe,w=this.element;if(!v){j||(j=document.createElement("iframe"),this.isSecure&&(j.src=b.IFRAME_SRC),k.ie?(j.style.filter="alpha(opacity=0)",j.frameBorder=0):j.style.opacity="0",j.style.position="absolute",j.style.border="none",j.style.margin="0",j.style.padding="0",j.style.display="none",j.tabIndex=-1,j.className=b.CSS_IFRAME),(v=j.cloneNode(!1)).id=this.id+"_f";var u=(x=w.parentNode)||document.body;this._addToParent(u,v),this.iframe=v}this.showIframe(),this.syncIframe(),this.stackIframe(),this._hasIframeEventListeners||(this.showEvent.subscribe(this.showIframe),this.hideEvent.subscribe(this.hideIframe),this.changeContentEvent.subscribe(this.syncIframe),this._hasIframeEventListeners=!0)}function p(){t.call(this),this.beforeShowEvent.unsubscribe(p),this._iframeDeferred=!1}q[0]?this.cfg.getProperty("visible")?t.call(this):this._iframeDeferred||(this.beforeShowEvent.subscribe(p),this._iframeDeferred=!0):(this.hideIframe(),this._hasIframeEventListeners&&(this.showEvent.unsubscribe(this.showIframe),this.hideEvent.unsubscribe(this.hideIframe),this.changeContentEvent.unsubscribe(this.syncIframe),this._hasIframeEventListeners=!1))},_primeXYFromDOM:function(){YAHOO.lang.isUndefined(this.cfg.getProperty("xy"))&&(this.syncPosition(),this.cfg.refireEvent("xy"),this.beforeShowEvent.unsubscribe(this._primeXYFromDOM))},configConstrainToViewport:function(p,o,q){o[0]?(d.alreadySubscribed(this.beforeMoveEvent,this.enforceConstraints,this)||this.beforeMoveEvent.subscribe(this.enforceConstraints,this,!0),d.alreadySubscribed(this.beforeShowEvent,this._primeXYFromDOM)||this.beforeShowEvent.subscribe(this._primeXYFromDOM)):(this.beforeShowEvent.unsubscribe(this._primeXYFromDOM),this.beforeMoveEvent.unsubscribe(this.enforceConstraints,this))},configContext:function(u,t,q){var r,o,v,s,p,x=t[0],w=this.CONTEXT_TRIGGERS;x&&(r=x[0],o=x[1],v=x[2],s=x[3],p=x[4],w&&w.length>0&&(s=(s||[]).concat(w)),r&&("string"==typeof r&&this.cfg.setProperty("context",[document.getElementById(r),o,v,s,p],!0),o&&v&&this.align(o,v,p),this._contextTriggers&&this._processTriggers(this._contextTriggers,e,this._alignOnTrigger),s&&(this._processTriggers(s,"subscribe",this._alignOnTrigger),this._contextTriggers=s)))},_alignOnTrigger:function(p,o){this.align()},_findTriggerCE:function(o){var p=null;return o instanceof m?p=o:b._TRIGGER_MAP[o]&&(p=b._TRIGGER_MAP[o]),p},_processTriggers:function(s,v,r){for(var q,u,p=0,o=s.length;p<o;++p)q=s[p],(u=this._findTriggerCE(q))?u[v](r,this,!0):this[v](q,r)},align:function(p,w,s){function r(z,A){var y=null,x=null;switch(p){case b.TOP_LEFT:y=A,x=z;break;case b.TOP_RIGHT:y=A-q.offsetWidth,x=z;break;case b.BOTTOM_LEFT:y=A,x=z-q.offsetHeight;break;case b.BOTTOM_RIGHT:y=A-q.offsetWidth,x=z-q.offsetHeight}null!==y&&null!==x&&(s&&(y+=s[0],x+=s[1]),t.moveTo(y,x))}var o,q,u,v=this.cfg.getProperty("context"),t=this;if(v&&(o=v[0],q=this.element,t=this,p||(p=v[1]),w||(w=v[2]),!s&&v[4]&&(s=v[4]),q&&o))switch(u=f.getRegion(o),w){case b.TOP_LEFT:r(u.top,u.left);break;case b.TOP_RIGHT:r(u.top,u.right);break;case b.BOTTOM_LEFT:r(u.bottom,u.left);break;case b.BOTTOM_RIGHT:r(u.bottom,u.right)}},enforceConstraints:function(p,o,q){var s=o[0],r=this.getConstrainedXY(s[0],s[1]);this.cfg.setProperty("x",r[0],!0),this.cfg.setProperty("y",r[1],!0),this.cfg.setProperty("xy",r,!0)},_getConstrainedPos:function(y,p){var t=this.element,r=b.VIEWPORT_OFFSET,A="x"==y,z=A?t.offsetWidth:t.offsetHeight,s=A?f.getViewportWidth():f.getViewportHeight(),D=A?f.getDocumentScrollLeft():f.getDocumentScrollTop(),C=A?b.PREVENT_OVERLAP_X:b.PREVENT_OVERLAP_Y,o=this.cfg.getProperty("context"),u=z+r<s,w=this.cfg.getProperty("preventcontextoverlap")&&o&&C[o[1]+o[2]],v=D+r,B=D+s-z-r,q=p;return(p<v||p>B)&&(w?q=this._preventOverlap(y,o[0],z,s,D):u?p<v?q=v:p>B&&(q=B):q=v),q},_preventOverlap:function(y,w,z,u,C){var A="x"==y,t=b.VIEWPORT_OFFSET,s=this,q=(A?f.getX(w):f.getY(w))-C,o=A?w.offsetWidth:w.offsetHeight,p=q-t,r=u-(q+o)-t,D=!1,v=function(){var x;return x=s.cfg.getProperty(y)-C>q?q-z:q+o,s.cfg.setProperty(y,x+C,!0),x},B=function(){var x,E=s.cfg.getProperty(y)-C>q?r:p;return z>E&&(D?v():(v(),D=!0,x=B())),x};return B(),this.cfg.getProperty(y)},getConstrainedX:function(o){return this._getConstrainedPos("x",o)},getConstrainedY:function(o){return this._getConstrainedPos("y",o)},getConstrainedXY:function(o,p){return[this.getConstrainedX(o),this.getConstrainedY(p)]},center:function(){var o,u,r=b.VIEWPORT_OFFSET,s=this.element.offsetWidth,q=this.element.offsetHeight,p=f.getViewportWidth(),t=f.getViewportHeight();o=s<p?p/2-s/2+f.getDocumentScrollLeft():r+f.getDocumentScrollLeft(),u=q<t?t/2-q/2+f.getDocumentScrollTop():r+f.getDocumentScrollTop(),this.cfg.setProperty("xy",[parseInt(o,10),parseInt(u,10)]),this.cfg.refireEvent("iframe"),k.webkit&&this.forceContainerRedraw()},syncPosition:function(){var o=f.getXY(this.element);this.cfg.setProperty("x",o[0],!0),this.cfg.setProperty("y",o[1],!0),this.cfg.setProperty("xy",o,!0)},onDomResize:function(q,p){var o=this;b.superclass.onDomResize.call(this,q,p),setTimeout(function(){o.syncPosition(),o.cfg.refireEvent("iframe"),o.cfg.refireEvent("context")},0)},_getComputedHeight:document.defaultView&&document.defaultView.getComputedStyle?function(p){var o=null;if(p.ownerDocument&&p.ownerDocument.defaultView){var q=p.ownerDocument.defaultView.getComputedStyle(p,"");q&&(o=parseInt(q.height,10))}return i.isNumber(o)?o:null}:function(p){var o=null;return p.style.pixelHeight&&(o=p.style.pixelHeight),i.isNumber(o)?o:null},_validateAutoFillHeight:function(o){return!o||i.isString(o)&&b.STD_MOD_RE.test(o)},_autoFillOnHeightChange:function(r,p,q){var o=this.cfg.getProperty("height");(o&&"auto"!==o||0===o)&&this.fillHeight(q)},_getPreciseHeight:function(p){var o=p.offsetHeight;if(p.getBoundingClientRect){var q=p.getBoundingClientRect();o=q.bottom-q.top}return o},fillHeight:function(r){if(r){for(var v,p=this.innerElement||this.element,o=[this.header,this.body,this.footer],w=0,x=0,t=0,q=!1,u=0,s=o.length;u<s;u++)(v=o[u])&&(r!==v?x+=this._getPreciseHeight(v):q=!0);q&&((k.ie||k.opera)&&f.setStyle(r,"height","0px"),null===(w=this._getComputedHeight(p))&&(f.addClass(p,"yui-override-padding"),w=p.clientHeight,f.removeClass(p,"yui-override-padding")),t=Math.max(w-x,0),f.setStyle(r,"height",t+"px"),r.offsetHeight!=t&&(t=Math.max(t-(r.offsetHeight-t),0)),f.setStyle(r,"height",t+"px"))}},bringToTop:function(){var s=[],r=this.element;f.getElementsBy(function(y){var x=f.hasClass(y,b.CSS_OVERLAY),w=YAHOO.widget.Panel;x&&!f.isAncestor(r,y)&&(w&&f.hasClass(y,w.CSS_PANEL)?s[s.length]=y.parentNode:s[s.length]=y)},"div",document.body),s.sort(function(z,y){var B=f.getStyle(z,"zIndex"),A=f.getStyle(y,"zIndex"),x=!B||isNaN(B)?0:parseInt(B,10),w=!A||isNaN(A)?0:parseInt(A,10);return x>w?-1:x<w?1:0});var u,o=s[0];if(o&&(u=f.getStyle(o,"zIndex"),!isNaN(u))){var t=!1;if(o!=r)t=!0;else if(s.length>1){var p=f.getStyle(s[1],"zIndex");isNaN(p)||u!=p||(t=!0)}t&&this.cfg.setProperty("zindex",parseInt(u,10)+2)}},destroy:function(o){this.iframe&&this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,b.windowResizeEvent.unsubscribe(this.doCenterOnDOMEvent,this),b.windowScrollEvent.unsubscribe(this.doCenterOnDOMEvent,this),g.textResizeEvent.unsubscribe(this._autoFillOnHeightChange),this._contextTriggers&&this._processTriggers(this._contextTriggers,e,this._alignOnTrigger),b.superclass.destroy.call(this,o)},forceContainerRedraw:function(){var o=this;f.addClass(o.element,"yui-force-redraw"),setTimeout(function(){f.removeClass(o.element,"yui-force-redraw")},0)},toString:function(){return"Overlay "+this.id}})}(),function(){YAHOO.widget.OverlayManager=function(g){this.init(g)};var d=YAHOO.widget.Overlay,c=YAHOO.util.Event,e=YAHOO.util.Dom,b=YAHOO.util.Config,f=YAHOO.util.CustomEvent,a=YAHOO.widget.OverlayManager;a.CSS_FOCUSED="focused",a.prototype={constructor:a,overlays:null,initDefaultConfig:function(){this.cfg.addProperty("overlays",{suppressEvent:!0}),this.cfg.addProperty("focusevent",{value:"mousedown"})},init:function(i){this.cfg=new b(this),this.initDefaultConfig(),i&&this.cfg.applyConfig(i,!0),this.cfg.fireQueue();var h=null;this.getActive=function(){return h},this.focus=function(j){var k=this.find(j);k&&k.focus()},this.remove=function(k){var j,m=this.find(k);if(m){h==m&&(h=null);var l=null===m.element&&null===m.cfg;l||(j=e.getStyle(m.element,"zIndex"),m.cfg.setProperty("zIndex",-1e3,!0)),this.overlays.sort(this.compareZIndexDesc),this.overlays=this.overlays.slice(0,this.overlays.length-1),m.hideEvent.unsubscribe(m.blur),m.destroyEvent.unsubscribe(this._onOverlayDestroy,m),m.focusEvent.unsubscribe(this._onOverlayFocusHandler,m),m.blurEvent.unsubscribe(this._onOverlayBlurHandler,m),l||(c.removeListener(m.element,this.cfg.getProperty("focusevent"),this._onOverlayElementFocus),m.cfg.setProperty("zIndex",j,!0),m.cfg.setProperty("manager",null)),m.focusEvent._managed&&(m.focusEvent=null),m.blurEvent._managed&&(m.blurEvent=null),m.focus._managed&&(m.focus=null),m.blur._managed&&(m.blur=null)}},this.blurAll=function(){var j,k=this.overlays.length;if(k>0){j=k-1;do{this.overlays[j].blur()}while(j--)}},this._manageBlur=function(j){var k=!1;return h==j&&(e.removeClass(h.element,a.CSS_FOCUSED),h=null,k=!0),k},this._manageFocus=function(j){var k=!1;return h!=j&&(h&&h.blur(),h=j,this.bringToTop(h),e.addClass(h.element,a.CSS_FOCUSED),k=!0),k};var g=this.cfg.getProperty("overlays");this.overlays||(this.overlays=[]),g&&(this.register(g),this.overlays.sort(this.compareZIndexDesc))},_onOverlayElementFocus:function(i){var g=c.getTarget(i),h=this.close;h&&(g==h||e.isAncestor(h,g))?this.blur():this.focus()},_onOverlayDestroy:function(h,g,i){this.remove(i)},_onOverlayFocusHandler:function(h,g,i){this._manageFocus(i)},_onOverlayBlurHandler:function(h,g,i){this._manageBlur(i)},_bindFocus:function(g){var h=this;g.focusEvent?g.focusEvent.subscribe(h._onOverlayFocusHandler,g,h):(g.focusEvent=g.createEvent("focus"),g.focusEvent.signature=f.LIST,g.focusEvent._managed=!0),g.focus||(c.on(g.element,h.cfg.getProperty("focusevent"),h._onOverlayElementFocus,null,g),g.focus=function(){h._manageFocus(this)&&(this.cfg.getProperty("visible")&&this.focusFirst&&this.focusFirst(),this.focusEvent.fire())},g.focus._managed=!0)},_bindBlur:function(g){var h=this;g.blurEvent?g.blurEvent.subscribe(h._onOverlayBlurHandler,g,h):(g.blurEvent=g.createEvent("blur"),g.blurEvent.signature=f.LIST,g.focusEvent._managed=!0),g.blur||(g.blur=function(){h._manageBlur(this)&&this.blurEvent.fire()},g.blur._managed=!0),g.hideEvent.subscribe(g.blur)},_bindDestroy:function(g){var h=this;g.destroyEvent.subscribe(h._onOverlayDestroy,g,h)},_syncZIndex:function(g){var h=e.getStyle(g.element,"zIndex");isNaN(h)?g.cfg.setProperty("zIndex",0):g.cfg.setProperty("zIndex",parseInt(h,10))},register:function(g){var h,j,k=!1;if(g instanceof d)g.cfg.addProperty("manager",{value:this}),this._bindFocus(g),this._bindBlur(g),this._bindDestroy(g),this._syncZIndex(g),this.overlays.push(g),this.bringToTop(g),k=!0;else if(g instanceof Array)for(h=0,j=g.length;h<j;h++)k=this.register(g[h])||k;return k},bringToTop:function(m){var l,g,j,i=this.find(m);if(i&&((j=this.overlays).sort(this.compareZIndexDesc),g=j[0])){if(l=e.getStyle(g.element,"zIndex"),!isNaN(l)){var k=!1;if(g!==i)k=!0;else if(j.length>1){var h=e.getStyle(j[1].element,"zIndex");isNaN(h)||l!=h||(k=!0)}k&&i.cfg.setProperty("zindex",parseInt(l,10)+2)}j.sort(this.compareZIndexDesc)}},find:function(g){var m,h,l=g instanceof d,j=this.overlays,p=j.length,k=null;if(l||"string"==typeof g)for(h=p-1;h>=0;h--)if(m=j[h],l&&m===g||m.id==g){k=m;break}return k},compareZIndexDesc:function(j,i){var h=j.cfg?j.cfg.getProperty("zIndex"):null,g=i.cfg?i.cfg.getProperty("zIndex"):null;return null===h&&null===g?0:null===h?1:null===g?-1:h>g?-1:h<g?1:0},showAll:function(){var g,h=this.overlays;for(g=h.length-1;g>=0;g--)h[g].show()},hideAll:function(){var g,h=this.overlays;for(g=h.length-1;g>=0;g--)h[g].hide()},toString:function(){return"OverlayManager"}}}(),function(){function k(q,o){var p=this.cfg;p.getProperty("width")==o&&p.setProperty("width",q)}function d(p,o){"_originalWidth"in this&&k.call(this,this._originalWidth,this._forcedWidth);var r,s,q=document.body,u=this.cfg,t=u.getProperty("width");t&&"auto"!=t||!(u.getProperty("container")!=q||u.getProperty("x")>=c.getViewportWidth()||u.getProperty("y")>=c.getViewportHeight())||((s=this.element.cloneNode(!0)).style.visibility="hidden",s.style.top="0px",s.style.left="0px",q.appendChild(s),r=s.offsetWidth+"px",q.removeChild(s),s=null,u.setProperty("width",r),u.refireEvent("xy"),this._originalWidth=t||"",this._forcedWidth=r)}function b(p,o,q){this.render(q)}function l(){n.onDOMReady(b,this.cfg.getProperty("container"),this)}YAHOO.widget.Tooltip=function(p,o){YAHOO.widget.Tooltip.superclass.constructor.call(this,p,o)};var f,e=YAHOO.lang,n=YAHOO.util.Event,m=YAHOO.util.CustomEvent,c=YAHOO.util.Dom,j=YAHOO.widget.Tooltip,h=YAHOO.env.ua,g=h.ie&&(h.ie<=6||"BackCompat"==document.compatMode),i={PREVENT_OVERLAP:{key:"preventoverlap",value:!0,validator:e.isBoolean,supercedes:["x","y","xy"]},SHOW_DELAY:{key:"showdelay",value:200,validator:e.isNumber},AUTO_DISMISS_DELAY:{key:"autodismissdelay",value:5e3,validator:e.isNumber},HIDE_DELAY:{key:"hidedelay",value:250,validator:e.isNumber},TEXT:{key:"text",suppressEvent:!0},CONTAINER:{key:"container"},DISABLED:{key:"disabled",value:!1,suppressEvent:!0},XY_OFFSET:{key:"xyoffset",value:[0,25],suppressEvent:!0}},a={CONTEXT_MOUSE_OVER:"contextMouseOver",CONTEXT_MOUSE_OUT:"contextMouseOut",CONTEXT_TRIGGER:"contextTrigger"};j.CSS_TOOLTIP="yui-tt",YAHOO.extend(j,YAHOO.widget.Overlay,{init:function(p,o){j.superclass.init.call(this,p),this.beforeInitEvent.fire(j),c.addClass(this.element,j.CSS_TOOLTIP),o&&this.cfg.applyConfig(o,!0),this.cfg.queueProperty("visible",!1),this.cfg.queueProperty("constraintoviewport",!0),this.setBody(""),this.subscribe("changeContent",d),this.subscribe("init",l),this.subscribe("render",this.onRender),this.initEvent.fire(j)},initEvents:function(){j.superclass.initEvents.call(this);var o=m.LIST;this.contextMouseOverEvent=this.createEvent(a.CONTEXT_MOUSE_OVER),this.contextMouseOverEvent.signature=o,this.contextMouseOutEvent=this.createEvent(a.CONTEXT_MOUSE_OUT),this.contextMouseOutEvent.signature=o,this.contextTriggerEvent=this.createEvent(a.CONTEXT_TRIGGER),this.contextTriggerEvent.signature=o},initDefaultConfig:function(){j.superclass.initDefaultConfig.call(this),this.cfg.addProperty(i.PREVENT_OVERLAP.key,{value:i.PREVENT_OVERLAP.value,validator:i.PREVENT_OVERLAP.validator,supercedes:i.PREVENT_OVERLAP.supercedes}),this.cfg.addProperty(i.SHOW_DELAY.key,{handler:this.configShowDelay,value:200,validator:i.SHOW_DELAY.validator}),this.cfg.addProperty(i.AUTO_DISMISS_DELAY.key,{handler:this.configAutoDismissDelay,value:i.AUTO_DISMISS_DELAY.value,validator:i.AUTO_DISMISS_DELAY.validator}),this.cfg.addProperty(i.HIDE_DELAY.key,{handler:this.configHideDelay,value:i.HIDE_DELAY.value,validator:i.HIDE_DELAY.validator}),this.cfg.addProperty(i.TEXT.key,{handler:this.configText,suppressEvent:i.TEXT.suppressEvent}),this.cfg.addProperty(i.CONTAINER.key,{handler:this.configContainer,value:document.body}),this.cfg.addProperty(i.DISABLED.key,{handler:this.configContainer,value:i.DISABLED.value,supressEvent:i.DISABLED.suppressEvent}),this.cfg.addProperty(i.XY_OFFSET.key,{value:i.XY_OFFSET.value.concat(),supressEvent:i.XY_OFFSET.suppressEvent})},configText:function(p,o,q){var r=o[0];r&&this.setBody(r)},configContainer:function(q,p,r){var o=p[0];"string"==typeof o&&this.cfg.setProperty("container",document.getElementById(o),!0)},_removeEventListeners:function(){var o,q,p,r=this._context;if(r&&(o=r.length)>0){p=o-1;do{q=r[p],n.removeListener(q,"mouseover",this.onContextMouseOver),n.removeListener(q,"mousemove",this.onContextMouseMove),n.removeListener(q,"mouseout",this.onContextMouseOut)}while(p--)}},configContext:function(t,p,u){var v,o,r,q,s=p[0];if(s&&(s instanceof Array||("string"==typeof s?this.cfg.setProperty("context",[document.getElementById(s)],!0):this.cfg.setProperty("context",[s],!0),s=this.cfg.getProperty("context")),this._removeEventListeners(),this._context=s,(v=this._context)&&(o=v.length)>0)){q=o-1;do{r=v[q],n.on(r,"mouseover",this.onContextMouseOver,this),n.on(r,"mousemove",this.onContextMouseMove,this),n.on(r,"mouseout",this.onContextMouseOut,this)}while(q--)}},onContextMouseMove:function(p,o){o.pageX=n.getPageX(p),o.pageY=n.getPageY(p)},onContextMouseOver:function(q,p){var o=this;o.title&&(p._tempTitle=o.title,o.title=""),!1===p.fireEvent("contextMouseOver",o,q)||p.cfg.getProperty("disabled")||(p.hideProcId&&(clearTimeout(p.hideProcId),p.hideProcId=null),n.on(o,"mousemove",p.onContextMouseMove,p),p.showProcId=p.doShow(q,o))},onContextMouseOut:function(q,p){var o=this;p._tempTitle&&(o.title=p._tempTitle,p._tempTitle=null),p.showProcId&&(clearTimeout(p.showProcId),p.showProcId=null),p.hideProcId&&(clearTimeout(p.hideProcId),p.hideProcId=null),p.fireEvent("contextMouseOut",o,q),p.hideProcId=setTimeout(function(){p.hide()},p.cfg.getProperty("hidedelay"))},doShow:function(r,o){var t=this.cfg.getProperty("xyoffset"),p=t[0],s=t[1],q=this;return h.opera&&o.tagName&&"A"==o.tagName.toUpperCase()&&(s+=12),setTimeout(function(){var u=q.cfg.getProperty("text");q._tempTitle&&(""===u||YAHOO.lang.isUndefined(u)||YAHOO.lang.isNull(u))?q.setBody(q._tempTitle):q.cfg.refireEvent("text"),q.moveTo(q.pageX+p,q.pageY+s),q.cfg.getProperty("preventoverlap")&&q.preventOverlap(q.pageX,q.pageY),n.removeListener(o,"mousemove",q.onContextMouseMove),q.contextTriggerEvent.fire(o),q.show(),q.hideProcId=q.doHide()},this.cfg.getProperty("showdelay"))},doHide:function(){var o=this;return setTimeout(function(){o.hide()},this.cfg.getProperty("autodismissdelay"))},preventOverlap:function(s,r){var o=this.element.offsetHeight,q=new YAHOO.util.Point(s,r),p=c.getRegion(this.element);p.top-=5,p.left-=5,p.right+=5,p.bottom+=5,p.contains(q)&&this.cfg.setProperty("y",r-o-5)},onRender:function(s,r){function t(){var w=this.element,v=this.underlay;v&&(v.style.width=w.offsetWidth+6+"px",v.style.height=w.offsetHeight+1+"px")}function p(){c.addClass(this.underlay,"yui-tt-shadow-visible"),h.ie&&this.forceUnderlayRedraw()}function o(){c.removeClass(this.underlay,"yui-tt-shadow-visible")}function u(){var w,v,y,x=this.underlay;x||(w=this.element,v=YAHOO.widget.Module,h.ie,y=this,f||((f=document.createElement("div")).className="yui-tt-shadow"),x=f.cloneNode(!1),w.appendChild(x),this.underlay=x,this._shadow=this.underlay,p.call(this),this.subscribe("beforeShow",p),this.subscribe("hide",o),g&&(window.setTimeout(function(){t.call(y)},0),this.cfg.subscribeToConfigEvent("width",t),this.cfg.subscribeToConfigEvent("height",t),this.subscribe("changeContent",t),v.textResizeEvent.subscribe(t,this,!0),this.subscribe("destroy",function(){v.textResizeEvent.unsubscribe(t,this)})))}function q(){u.call(this),this.unsubscribe("beforeShow",q)}this.cfg.getProperty("visible")?u.call(this):this.subscribe("beforeShow",q)},forceUnderlayRedraw:function(){var o=this;c.addClass(o.underlay,"yui-force-redraw"),setTimeout(function(){c.removeClass(o.underlay,"yui-force-redraw")},0)},destroy:function(){this._removeEventListeners(),j.superclass.destroy.call(this)},toString:function(){return"Tooltip "+this.id}})}(),function(){function j(v,u){!this.header&&this.cfg.getProperty("draggable")&&this.setHeader("&#160;")}function r(v,u,w){var z=w[0],x=w[1],y=this.cfg;y.getProperty("width")==x&&y.setProperty("width",z),this.unsubscribe("hide",r,w)}function b(v,u){var y,x,w;p&&((x=(y=this.cfg).getProperty("width"))&&"auto"!=x||(w=this.element.offsetWidth+"px",y.setProperty("width",w),this.subscribe("hide",r,[x||"",w])))}YAHOO.widget.Panel=function(v,u){YAHOO.widget.Panel.superclass.constructor.call(this,v,u)};var g,q,c,s=null,e=YAHOO.lang,f=YAHOO.util,a=f.Dom,t=f.Event,m=f.CustomEvent,k=YAHOO.util.KeyListener,i=f.Config,h=YAHOO.widget.Overlay,o=YAHOO.widget.Panel,l=YAHOO.env.ua,p=l.ie&&(l.ie<=6||"BackCompat"==document.compatMode),d={BEFORE_SHOW_MASK:"beforeShowMask",BEFORE_HIDE_MASK:"beforeHideMask",SHOW_MASK:"showMask",HIDE_MASK:"hideMask",DRAG:"drag"},n={CLOSE:{key:"close",value:!0,validator:e.isBoolean,supercedes:["visible"]},DRAGGABLE:{key:"draggable",value:!!f.DD,validator:e.isBoolean,supercedes:["visible"]},DRAG_ONLY:{key:"dragonly",value:!1,validator:e.isBoolean,supercedes:["draggable"]},UNDERLAY:{key:"underlay",value:"shadow",supercedes:["visible"]},MODAL:{key:"modal",value:!1,validator:e.isBoolean,supercedes:["visible","zindex"]},KEY_LISTENERS:{key:"keylisteners",suppressEvent:!0,supercedes:["visible"]},STRINGS:{key:"strings",supercedes:["close"],validator:e.isObject,value:{close:"Close"}}};o.CSS_PANEL="yui-panel",o.CSS_PANEL_CONTAINER="yui-panel-container",o.FOCUSABLE=["a","button","select","textarea","input","iframe"],YAHOO.extend(o,h,{init:function(v,u){o.superclass.init.call(this,v),this.beforeInitEvent.fire(o),a.addClass(this.element,o.CSS_PANEL),this.buildWrapper(),u&&this.cfg.applyConfig(u,!0),this.subscribe("showMask",this._addFocusHandlers),this.subscribe("hideMask",this._removeFocusHandlers),this.subscribe("beforeRender",j),this.subscribe("render",function(){this.setFirstLastFocusable(),this.subscribe("changeContent",this.setFirstLastFocusable)}),this.subscribe("show",this._focusOnShow),this.initEvent.fire(o)},_onElementFocus:function(z){if(s===this){var y=t.getTarget(z),x=document.documentElement,v=y!==x&&y!==window;if(v&&y!==this.element&&y!==this.mask&&!a.isAncestor(this.element,y))try{this._focusFirstModal()}catch(w){try{v&&y!==document.body&&y.blur()}catch(u){}}}},_focusFirstModal:function(){var u=this.firstElement;u?u.focus():this._modalFocus?this._modalFocus.focus():this.innerElement.focus()},_addFocusHandlers:function(v,u){this.firstElement||(l.webkit||l.opera?this._modalFocus||this._createHiddenFocusElement():this.innerElement.tabIndex=0),this._setTabLoop(this.firstElement,this.lastElement),t.onFocus(document.documentElement,this._onElementFocus,this,!0),s=this},_createHiddenFocusElement:function(){var u=document.createElement("button");u.style.height="1px",u.style.width="1px",u.style.position="absolute",u.style.left="-10000em",u.style.opacity=0,u.tabIndex=-1,this.innerElement.appendChild(u),this._modalFocus=u},_removeFocusHandlers:function(v,u){t.removeFocusListener(document.documentElement,this._onElementFocus,this),s==this&&(s=null)},_focusOnShow:function(v,u,w){u&&u[1]&&t.stopEvent(u[1]),this.focusFirst(v,u,w)||this.cfg.getProperty("modal")&&this._focusFirstModal()},focusFirst:function(w,u,z){var v=this.firstElement,y=!1;if(u&&u[1]&&t.stopEvent(u[1]),v)try{v.focus(),y=!0}catch(x){}return y},focusLast:function(w,u,z){var v=this.lastElement,y=!1;if(u&&u[1]&&t.stopEvent(u[1]),v)try{v.focus(),y=!0}catch(x){}return y},_setTabLoop:function(u,v){this.setTabLoop(u,v)},setTabLoop:function(x,z){var v=this.preventBackTab,w=this.preventTabOut,u=this.showEvent,y=this.hideEvent;v&&(v.disable(),u.unsubscribe(v.enable,v),y.unsubscribe(v.disable,v),v=this.preventBackTab=null),w&&(w.disable(),u.unsubscribe(w.enable,w),y.unsubscribe(w.disable,w),w=this.preventTabOut=null),x&&(this.preventBackTab=new k(x,{shift:!0,keys:9},{fn:this.focusLast,scope:this,correctScope:!0}),v=this.preventBackTab,u.subscribe(v.enable,v,!0),y.subscribe(v.disable,v,!0)),z&&(this.preventTabOut=new k(z,{shift:!1,keys:9},{fn:this.focusFirst,scope:this,correctScope:!0}),w=this.preventTabOut,u.subscribe(w.enable,w,!0),y.subscribe(w.disable,w,!0))},getFocusableElements:function(v){v=v||this.innerElement;for(var x={},u=this,w=0;w<o.FOCUSABLE.length;w++)x[o.FOCUSABLE[w]]=!0;return a.getElementsBy(function(y){return u._testIfFocusable(y,x)},null,v)},_testIfFocusable:function(u,v){return!(!u.focus||"hidden"===u.type||u.disabled||!v[u.tagName.toLowerCase()])},setFirstLastFocusable:function(){this.firstElement=null,this.lastElement=null;var u=this.getFocusableElements();this.focusableElements=u,u.length>0&&(this.firstElement=u[0],this.lastElement=u[u.length-1]),this.cfg.getProperty("modal")&&this._setTabLoop(this.firstElement,this.lastElement)},initEvents:function(){o.superclass.initEvents.call(this);var u=m.LIST;this.showMaskEvent=this.createEvent(d.SHOW_MASK),this.showMaskEvent.signature=u,this.beforeShowMaskEvent=this.createEvent(d.BEFORE_SHOW_MASK),this.beforeShowMaskEvent.signature=u,this.hideMaskEvent=this.createEvent(d.HIDE_MASK),this.hideMaskEvent.signature=u,this.beforeHideMaskEvent=this.createEvent(d.BEFORE_HIDE_MASK),this.beforeHideMaskEvent.signature=u,this.dragEvent=this.createEvent(d.DRAG),this.dragEvent.signature=u},initDefaultConfig:function(){o.superclass.initDefaultConfig.call(this),this.cfg.addProperty(n.CLOSE.key,{handler:this.configClose,value:n.CLOSE.value,validator:n.CLOSE.validator,supercedes:n.CLOSE.supercedes}),this.cfg.addProperty(n.DRAGGABLE.key,{handler:this.configDraggable,value:!!f.DD,validator:n.DRAGGABLE.validator,supercedes:n.DRAGGABLE.supercedes}),this.cfg.addProperty(n.DRAG_ONLY.key,{value:n.DRAG_ONLY.value,validator:n.DRAG_ONLY.validator,supercedes:n.DRAG_ONLY.supercedes}),this.cfg.addProperty(n.UNDERLAY.key,{handler:this.configUnderlay,value:n.UNDERLAY.value,supercedes:n.UNDERLAY.supercedes}),this.cfg.addProperty(n.MODAL.key,{handler:this.configModal,value:n.MODAL.value,validator:n.MODAL.validator,supercedes:n.MODAL.supercedes}),this.cfg.addProperty(n.KEY_LISTENERS.key,{handler:this.configKeyListeners,suppressEvent:n.KEY_LISTENERS.suppressEvent,supercedes:n.KEY_LISTENERS.supercedes}),this.cfg.addProperty(n.STRINGS.key,{value:n.STRINGS.value,handler:this.configStrings,validator:n.STRINGS.validator,supercedes:n.STRINGS.supercedes})},configClose:function(y,v,z){var w,A=v[0],x=this.close,u=this.cfg.getProperty("strings");A?x?x.style.display="block":(c||((c=document.createElement("a")).className="container-close",c.href="#"),x=c.cloneNode(!0),(w=this.innerElement.firstChild)?this.innerElement.insertBefore(x,w):this.innerElement.appendChild(x),x.innerHTML=u&&u.close?u.close:"&#160;",t.on(x,"click",this._doClose,this,!0),this.close=x):x&&(x.style.display="none")},_doClose:function(u){t.preventDefault(u),this.hide()},configDraggable:function(v,u,w){if(u[0]){if(!f.DD)return void this.cfg.setProperty("draggable",!1);this.header&&(a.setStyle(this.header,"cursor","move"),this.registerDragDrop()),this.subscribe("beforeShow",b)}else this.dd&&this.dd.unreg(),this.header&&a.setStyle(this.header,"cursor","auto"),this.unsubscribe("beforeShow",b)},configUnderlay:function(D,C,z){function x(){v||(q||((q=document.createElement("div")).className="underlay"),v=q.cloneNode(!1),this.element.appendChild(v),this.underlay=v,p&&(this.sizeUnderlay(),this.cfg.subscribeToConfigEvent("width",this.sizeUnderlay),this.cfg.subscribeToConfigEvent("height",this.sizeUnderlay),this.changeContentEvent.subscribe(this.sizeUnderlay),YAHOO.widget.Module.textResizeEvent.subscribe(this.sizeUnderlay,this,!0)),l.webkit&&l.webkit<420&&this.changeContentEvent.subscribe(this.forceUnderlayRedraw))}function A(){!x.call(this)&&p&&this.sizeUnderlay(),this._underlayDeferred=!1,this.beforeShowEvent.unsubscribe(A)}function y(){this._underlayDeferred&&(this.beforeShowEvent.unsubscribe(A),this._underlayDeferred=!1),v&&(this.cfg.unsubscribeFromConfigEvent("width",this.sizeUnderlay),this.cfg.unsubscribeFromConfigEvent("height",this.sizeUnderlay),this.changeContentEvent.unsubscribe(this.sizeUnderlay),this.changeContentEvent.unsubscribe(this.forceUnderlayRedraw),YAHOO.widget.Module.textResizeEvent.unsubscribe(this.sizeUnderlay,this,!0),this.element.removeChild(v),this.underlay=null)}var B="mac"==this.platform&&l.gecko,E=C[0].toLowerCase(),v=this.underlay,w=this.element;switch(E){case"shadow":a.removeClass(w,"matte"),a.addClass(w,"shadow");break;case"matte":B||y.call(this),a.removeClass(w,"shadow"),a.addClass(w,"matte");break;default:B||y.call(this),a.removeClass(w,"shadow"),a.removeClass(w,"matte")}("shadow"==E||B&&!v)&&(this.cfg.getProperty("visible")?!x.call(this)&&p&&this.sizeUnderlay():this._underlayDeferred||(this.beforeShowEvent.subscribe(A),this._underlayDeferred=!0))},configModal:function(v,u,x){u[0]?this._hasModalityEventListeners||(this.subscribe("beforeShow",this.buildMask),this.subscribe("beforeShow",this.bringToTop),this.subscribe("beforeShow",this.showMask),this.subscribe("hide",this.hideMask),h.windowResizeEvent.subscribe(this.sizeMask,this,!0),this._hasModalityEventListeners=!0):this._hasModalityEventListeners&&(this.cfg.getProperty("visible")&&(this.hideMask(),this.removeMask()),this.unsubscribe("beforeShow",this.buildMask),this.unsubscribe("beforeShow",this.bringToTop),this.unsubscribe("beforeShow",this.showMask),this.unsubscribe("hide",this.hideMask),h.windowResizeEvent.unsubscribe(this.sizeMask,this),this._hasModalityEventListeners=!1)},removeMask:function(){var u,v=this.mask;v&&(this.hideMask(),(u=v.parentNode)&&u.removeChild(v),this.mask=null)},configKeyListeners:function(x,u,A){var z,y,v,w=u[0];if(w)if(w instanceof Array)for(y=w.length,v=0;v<y;v++)z=w[v],i.alreadySubscribed(this.showEvent,z.enable,z)||this.showEvent.subscribe(z.enable,z,!0),i.alreadySubscribed(this.hideEvent,z.disable,z)||(this.hideEvent.subscribe(z.disable,z,!0),this.destroyEvent.subscribe(z.disable,z,!0));else i.alreadySubscribed(this.showEvent,w.enable,w)||this.showEvent.subscribe(w.enable,w,!0),i.alreadySubscribed(this.hideEvent,w.disable,w)||(this.hideEvent.subscribe(w.disable,w,!0),this.destroyEvent.subscribe(w.disable,w,!0))},configStrings:function(v,u,w){var x=e.merge(n.STRINGS.value,u[0]);this.cfg.setProperty(n.STRINGS.key,x,!0)},configHeight:function(x,v,y){var u=v[0],w=this.innerElement;a.setStyle(w,"height",u),this.cfg.refireEvent("iframe")},_autoFillOnHeightChange:function(x,v,w){if(o.superclass._autoFillOnHeightChange.apply(this,arguments),p){var u=this;setTimeout(function(){u.sizeUnderlay()},0)}},configWidth:function(x,u,y){var w=u[0],v=this.innerElement;a.setStyle(v,"width",w),this.cfg.refireEvent("iframe")},configzIndex:function(v,u,x){if(o.superclass.configzIndex.call(this,v,u,x),this.mask||!0===this.cfg.getProperty("modal")){var w=a.getStyle(this.element,"zIndex");w&&!isNaN(w)||(w=0),0===w?this.cfg.setProperty("zIndex",1):this.stackMask()}},buildWrapper:function(){var w=this.element.parentNode,u=this.element,v=document.createElement("div");v.className=o.CSS_PANEL_CONTAINER,v.id=u.id+"_c",w&&w.insertBefore(v,u),v.appendChild(u),this.element=v,this.innerElement=u,a.setStyle(this.innerElement,"visibility","inherit")},sizeUnderlay:function(){var u,v=this.underlay;v&&(u=this.element,v.style.width=u.offsetWidth+"px",v.style.height=u.offsetHeight+"px")},registerDragDrop:function(){var v=this;if(this.header){if(!f.DD)return;var u=!0===this.cfg.getProperty("dragonly");this.dd=new f.DD(this.element.id,this.id,{dragOnly:u}),this.header.id||(this.header.id=this.id+"_h"),this.dd.startDrag=function(){var x,z,w,C,B,A;if(6==YAHOO.env.ua.ie&&a.addClass(v.element,"drag"),v.cfg.getProperty("constraintoviewport")){var y=h.VIEWPORT_OFFSET;x=v.element.offsetHeight,z=v.element.offsetWidth,w=a.getViewportWidth(),C=a.getViewportHeight(),B=a.getDocumentScrollLeft(),A=a.getDocumentScrollTop(),x+y<C?(this.minY=A+y,this.maxY=A+C-x-y):(this.minY=A+y,this.maxY=A+y),z+y<w?(this.minX=B+y,this.maxX=B+w-z-y):(this.minX=B+y,this.maxX=B+y),this.constrainX=!0,this.constrainY=!0}else this.constrainX=!1,this.constrainY=!1;v.dragEvent.fire("startDrag",arguments)},this.dd.onDrag=function(){v.syncPosition(),v.cfg.refireEvent("iframe"),"mac"==this.platform&&YAHOO.env.ua.gecko&&this.showMacGeckoScrollbars(),v.dragEvent.fire("onDrag",arguments)},this.dd.endDrag=function(){6==YAHOO.env.ua.ie&&a.removeClass(v.element,"drag"),v.dragEvent.fire("endDrag",arguments),v.moveEvent.fire(v.cfg.getProperty("xy"))},this.dd.setHandleElId(this.header.id),this.dd.addInvalidHandleType("INPUT"),this.dd.addInvalidHandleType("SELECT"),this.dd.addInvalidHandleType("TEXTAREA")}},buildMask:function(){var u=this.mask;u||(g||((g=document.createElement("div")).className="mask",g.innerHTML="&#160;"),(u=g.cloneNode(!0)).id=this.id+"_mask",document.body.insertBefore(u,document.body.firstChild),this.mask=u,YAHOO.env.ua.gecko&&"mac"==this.platform&&a.addClass(this.mask,"block-scrollbars"),this.stackMask())},hideMask:function(){this.cfg.getProperty("modal")&&this.mask&&this.beforeHideMaskEvent.fire()&&(this.mask.style.display="none",a.removeClass(document.body,"masked"),this.hideMaskEvent.fire())},showMask:function(){this.cfg.getProperty("modal")&&this.mask&&this.beforeShowMaskEvent.fire()&&(a.addClass(document.body,"masked"),this.sizeMask(),this.mask.style.display="block",this.showMaskEvent.fire())},sizeMask:function(){if(this.mask){var v=this.mask,w=a.getViewportWidth(),u=a.getViewportHeight();v.offsetHeight>u&&(v.style.height=u+"px"),v.offsetWidth>w&&(v.style.width=w+"px"),v.style.height=a.getDocumentHeight()+"px",v.style.width=a.getDocumentWidth()+"px"}},stackMask:function(){if(this.mask){var u=a.getStyle(this.element,"zIndex");YAHOO.lang.isUndefined(u)||isNaN(u)||a.setStyle(this.mask,"zIndex",u-1)}},render:function(u){return o.superclass.render.call(this,u,this.innerElement)},_renderHeader:function(u){u=u||this.innerElement,o.superclass._renderHeader.call(this,u)},_renderBody:function(u){u=u||this.innerElement,o.superclass._renderBody.call(this,u)},_renderFooter:function(u){u=u||this.innerElement,o.superclass._renderFooter.call(this,u)},destroy:function(u){h.windowResizeEvent.unsubscribe(this.sizeMask,this),this.removeMask(),this.close&&t.purgeElement(this.close),o.superclass.destroy.call(this,u)},forceUnderlayRedraw:function(){var v=this.underlay;a.addClass(v,"yui-force-redraw"),setTimeout(function(){a.removeClass(v,"yui-force-redraw")},0)},toString:function(){return"Panel "+this.id}})}(),function(){function d(){var k,l,j,m=this._aButtons;if(f.isArray(m)&&(k=m.length)>0){j=k-1;do{l=m[j],YAHOO.widget.Button&&l instanceof YAHOO.widget.Button?l.destroy():"BUTTON"==l.tagName.toUpperCase()&&(b.purgeElement(l),b.purgeElement(l,!1))}while(j--)}}YAHOO.widget.Dialog=function(j,i){YAHOO.widget.Dialog.superclass.constructor.call(this,j,i)};var b=YAHOO.util.Event,g=YAHOO.util.CustomEvent,e=YAHOO.util.Dom,a=YAHOO.widget.Dialog,f=YAHOO.lang,h={BEFORE_SUBMIT:"beforeSubmit",SUBMIT:"submit",MANUAL_SUBMIT:"manualSubmit",ASYNC_SUBMIT:"asyncSubmit",FORM_SUBMIT:"formSubmit",CANCEL:"cancel"},c={POST_METHOD:{key:"postmethod",value:"async"},POST_DATA:{key:"postdata",value:null},BUTTONS:{key:"buttons",value:"none",supercedes:["visible"]},HIDEAFTERSUBMIT:{key:"hideaftersubmit",value:!0}};a.CSS_DIALOG="yui-dialog",YAHOO.extend(a,YAHOO.widget.Panel,{form:null,initDefaultConfig:function(){a.superclass.initDefaultConfig.call(this),this.callback={success:null,failure:null,argument:null},this.cfg.addProperty(c.POST_METHOD.key,{handler:this.configPostMethod,value:c.POST_METHOD.value,validator:function(i){return"form"==i||"async"==i||"none"==i||"manual"==i}}),this.cfg.addProperty(c.POST_DATA.key,{value:c.POST_DATA.value}),this.cfg.addProperty(c.HIDEAFTERSUBMIT.key,{value:c.HIDEAFTERSUBMIT.value}),this.cfg.addProperty(c.BUTTONS.key,{handler:this.configButtons,value:c.BUTTONS.value,supercedes:c.BUTTONS.supercedes})},initEvents:function(){a.superclass.initEvents.call(this);var i=g.LIST;this.beforeSubmitEvent=this.createEvent(h.BEFORE_SUBMIT),this.beforeSubmitEvent.signature=i,this.submitEvent=this.createEvent(h.SUBMIT),this.submitEvent.signature=i,this.manualSubmitEvent=this.createEvent(h.MANUAL_SUBMIT),this.manualSubmitEvent.signature=i,this.asyncSubmitEvent=this.createEvent(h.ASYNC_SUBMIT),this.asyncSubmitEvent.signature=i,this.formSubmitEvent=this.createEvent(h.FORM_SUBMIT),this.formSubmitEvent.signature=i,this.cancelEvent=this.createEvent(h.CANCEL),this.cancelEvent.signature=i},init:function(j,i){a.superclass.init.call(this,j),this.beforeInitEvent.fire(a),e.addClass(this.element,a.CSS_DIALOG),this.cfg.setProperty("visible",!1),i&&this.cfg.applyConfig(i,!0),this.beforeHideEvent.subscribe(this.blurButtons,this,!0),this.subscribe("changeBody",this.registerForm),this.initEvent.fire(a)},doSubmit:function(){var s,n,m,j,q=YAHOO.util.Connect,r=this.form,l=!1,o=!1;switch(this.cfg.getProperty("postmethod")){case"async":if(s=r.elements,(n=s.length)>0){m=n-1;do{if("file"==s[m].type){l=!0;break}}while(m--)}l&&YAHOO.env.ua.ie&&this.isSecure&&(o=!0),j=this._getFormAttributes(r),q.setForm(r,l,o);var k=this.cfg.getProperty("postdata"),p=q.asyncRequest(j.method,j.action,this.callback,k);this.asyncSubmitEvent.fire(p);break;case"form":r.submit(),this.formSubmitEvent.fire();break;case"none":case"manual":this.manualSubmitEvent.fire()}},_getFormAttributes:function(k){var i={method:null,action:null};if(k)if(k.getAttributeNode){var j=k.getAttributeNode("action"),l=k.getAttributeNode("method");j&&(i.action=j.value),l&&(i.method=l.value)}else i.action=k.getAttribute("action"),i.method=k.getAttribute("method");return i.method=(f.isString(i.method)?i.method:"POST").toUpperCase(),i.action=f.isString(i.action)?i.action:"",i},registerForm:function(){var i=this.element.getElementsByTagName("form")[0];if(this.form){if(this.form==i&&e.isAncestor(this.element,this.form))return;b.purgeElement(this.form),this.form=null}i||((i=document.createElement("form")).name="frm_"+this.id,this.body.appendChild(i)),i&&(this.form=i,b.on(i,"submit",this._submitHandler,this,!0))},_submitHandler:function(i){b.stopEvent(i),this.submit(),this.form.blur()},setTabLoop:function(i,j){i=i||this.firstButton,j=j||this.lastButton,a.superclass.setTabLoop.call(this,i,j)},_setTabLoop:function(i,j){i=i||this.firstButton,j=this.lastButton||j,this.setTabLoop(i,j)},setFirstLastFocusable:function(){a.superclass.setFirstLastFocusable.call(this);var k,j,m,n=this.focusableElements;if(this.firstFormElement=null,this.lastFormElement=null,this.form&&n&&n.length>0){for(j=n.length,k=0;k<j;++k)if(m=n[k],this.form===m.form){this.firstFormElement=m;break}for(k=j-1;k>=0;--k)if(m=n[k],this.form===m.form){this.lastFormElement=m;break}}},configClose:function(j,i,k){a.superclass.configClose.apply(this,arguments)},_doClose:function(i){b.preventDefault(i),this.cancel()},configButtons:function(t,s,n){var u,q,k,r,p,j,m,o=YAHOO.widget.Button,v=s[0],l=this.innerElement;if(d.call(this),this._aButtons=null,f.isArray(v)){for((p=document.createElement("span")).className="button-group",r=v.length,this._aButtons=[],this.defaultHtmlButton=null,m=0;m<r;m++)u=v[m],o?((k=new o({label:u.text,type:u.type})).appendTo(p),q=k.get("element"),u.isDefault&&(k.addClass("default"),this.defaultHtmlButton=q),f.isFunction(u.handler)?k.set("onclick",{fn:u.handler,obj:this,scope:this}):f.isObject(u.handler)&&f.isFunction(u.handler.fn)&&k.set("onclick",{fn:u.handler.fn,obj:f.isUndefined(u.handler.obj)?this:u.handler.obj,scope:u.handler.scope||this}),this._aButtons[this._aButtons.length]=k):((q=document.createElement("button")).setAttribute("type","button"),u.isDefault&&(q.className="default",this.defaultHtmlButton=q),q.innerHTML=u.text,f.isFunction(u.handler)?b.on(q,"click",u.handler,this,!0):f.isObject(u.handler)&&f.isFunction(u.handler.fn)&&b.on(q,"click",u.handler.fn,f.isUndefined(u.handler.obj)?this:u.handler.obj,u.handler.scope||this),p.appendChild(q),this._aButtons[this._aButtons.length]=q),u.htmlButton=q,0===m&&(this.firstButton=q),m==r-1&&(this.lastButton=q);this.setFooter(p),j=this.footer,e.inDocument(this.element)&&!e.isAncestor(l,j)&&l.appendChild(j),this.buttonSpan=p}else p=this.buttonSpan,j=this.footer,p&&j&&(j.removeChild(p),this.buttonSpan=null,this.firstButton=null,this.lastButton=null,this.defaultHtmlButton=null);this.changeContentEvent.fire()},getButtons:function(){return this._aButtons||null},focusFirst:function(k,i,n){var j=this.firstFormElement,m=!1;if(i&&i[1]&&(b.stopEvent(i[1]),9===i[0]&&this.firstElement&&(j=this.firstElement)),j)try{j.focus(),m=!0}catch(l){}else m=this.defaultHtmlButton?this.focusDefaultButton():this.focusFirstButton();return m},focusLast:function(k,i,n){var o=this.cfg.getProperty("buttons"),j=this.lastFormElement,m=!1;if(i&&i[1]&&(b.stopEvent(i[1]),9===i[0]&&this.lastElement&&(j=this.lastElement)),o&&f.isArray(o))m=this.focusLastButton();else if(j)try{j.focus(),m=!0}catch(l){}return m},_getButton:function(j){var i=YAHOO.widget.Button;return i&&j&&j.nodeName&&j.id&&(j=i.getButton(j.id)||j),j},focusDefaultButton:function(){var i=this._getButton(this.defaultHtmlButton),k=!1;if(i)try{i.focus(),k=!0}catch(j){}return k},blurButtons:function(){var l,n,k,j,o=this.cfg.getProperty("buttons");if(o&&f.isArray(o)&&(l=o.length)>0){j=l-1;do{if((n=o[j])&&(k=this._getButton(n.htmlButton)))try{k.blur()}catch(m){}}while(j--)}},focusFirstButton:function(){var k,i,m=this.cfg.getProperty("buttons"),l=!1;if(m&&f.isArray(m)&&(k=m[0])&&(i=this._getButton(k.htmlButton)))try{i.focus(),l=!0}catch(j){}return l},focusLastButton:function(){var j,l,i,n=this.cfg.getProperty("buttons"),m=!1;if(n&&f.isArray(n)&&(j=n.length)>0&&(l=n[j-1])&&(i=this._getButton(l.htmlButton)))try{i.focus(),m=!0}catch(k){}return m},configPostMethod:function(j,i,k){this.registerForm()},validate:function(){return!0},submit:function(){return!!this.validate()&&(!!this.beforeSubmitEvent.fire()&&(this.doSubmit(),this.submitEvent.fire(),this.cfg.getProperty("hideaftersubmit")&&this.hide(),!0))},cancel:function(){this.cancelEvent.fire(),this.hide()},getData:function(){var k,t,w,m,u,r,q,x,l,y,B,p,C,o,z,v,A=this.form;if(A)for(t=(k=A.elements).length,w={},z=0;z<t;z++)if(m=k[z].name,u=e.getElementsBy(function(n){var i=n.tagName.toUpperCase();return("INPUT"==i||"TEXTAREA"==i||"SELECT"==i)&&n.name==m},"*",A),(r=u.length)>0)if(1==r)switch(u=u[0],q=u.type,u.tagName.toUpperCase()){case"INPUT":"checkbox"==q?w[m]=u.checked:"radio"!=q&&(w[m]=u.value);break;case"TEXTAREA":w[m]=u.value;break;case"SELECT":for(l=(x=u.options).length,y=[],v=0;v<l;v++)(B=x[v]).selected&&(o=B.attributes.value,y[y.length]=o&&o.specified?B.value:B.text);w[m]=y}else switch(q=u[0].type){case"radio":for(v=0;v<r;v++)if((p=u[v]).checked){w[m]=p.value;break}break;case"checkbox":for(y=[],v=0;v<r;v++)(C=u[v]).checked&&(y[y.length]=C.value);w[m]=y}return w},destroy:function(i){d.call(this),this._aButtons=null;var k,j=this.element.getElementsByTagName("form");j.length>0&&(k=j[0])&&(b.purgeElement(k),k.parentNode&&k.parentNode.removeChild(k),this.form=null),a.superclass.destroy.call(this,i)},toString:function(){return"Dialog "+this.id}})}(),function(){YAHOO.widget.SimpleDialog=function(e,d){YAHOO.widget.SimpleDialog.superclass.constructor.call(this,e,d)};var c=YAHOO.util.Dom,b=YAHOO.widget.SimpleDialog,a={ICON:{key:"icon",value:"none",suppressEvent:!0},TEXT:{key:"text",value:"",suppressEvent:!0,supercedes:["icon"]}};b.ICON_BLOCK="blckicon",b.ICON_ALARM="alrticon",b.ICON_HELP="hlpicon",b.ICON_INFO="infoicon",b.ICON_WARN="warnicon",b.ICON_TIP="tipicon",b.ICON_CSS_CLASSNAME="yui-icon",b.CSS_SIMPLEDIALOG="yui-simple-dialog",YAHOO.extend(b,YAHOO.widget.Dialog,{initDefaultConfig:function(){b.superclass.initDefaultConfig.call(this),this.cfg.addProperty(a.ICON.key,{handler:this.configIcon,value:a.ICON.value,suppressEvent:a.ICON.suppressEvent}),this.cfg.addProperty(a.TEXT.key,{handler:this.configText,value:a.TEXT.value,suppressEvent:a.TEXT.suppressEvent,supercedes:a.TEXT.supercedes})},init:function(e,d){b.superclass.init.call(this,e),this.beforeInitEvent.fire(b),c.addClass(this.element,b.CSS_SIMPLEDIALOG),this.cfg.queueProperty("postmethod","manual"),d&&this.cfg.applyConfig(d,!0),this.beforeRenderEvent.subscribe(function(){this.body||this.setBody("")},this,!0),this.initEvent.fire(b)},registerForm:function(){b.superclass.registerForm.call(this);var d=this.form.ownerDocument.createElement("input");d.type="hidden",d.name=this.id,d.value="",this.form.appendChild(d)},configIcon:function(k,j,h){var l,i,g,d=j[0],e=this.body,f=b.ICON_CSS_CLASSNAME;d&&"none"!=d&&(1===(l=c.getElementsByClassName(f,"*",e)).length&&(g=(i=l[0]).parentNode)&&(g.removeChild(i),i=null),-1==d.indexOf(".")?((i=document.createElement("span")).className=f+" "+d,i.innerHTML="&#160;"):((i=document.createElement("img")).src=this.imageRoot+d,i.className=f),i&&e.insertBefore(i,e.firstChild))},configText:function(e,d,f){var g=d[0];g&&(this.setBody(g),this.cfg.refireEvent("icon"))},toString:function(){return"SimpleDialog "+this.id}})}(),function(){YAHOO.widget.ContainerEffect=function(e,h,g,d,f){f||(f=YAHOO.util.Anim),this.overlay=e,this.attrIn=h,this.attrOut=g,this.targetElement=d||e.element,this.animClass=f};var b=YAHOO.util.Dom,c=YAHOO.util.CustomEvent,a=YAHOO.widget.ContainerEffect;a.FADE=function(d,f){var g=YAHOO.util.Easing,i={attributes:{opacity:{from:0,to:1}},duration:f,method:g.easeIn},e={attributes:{opacity:{to:0}},duration:f,method:g.easeOut},h=new a(d,i,e,d.element);return h.handleUnderlayStart=function(){var k=this.overlay.underlay;k&&YAHOO.env.ua.ie&&k.filters&&k.filters.length>0&&b.addClass(d.element,"yui-effect-fade")},h.handleUnderlayComplete=function(){this.overlay.underlay&&YAHOO.env.ua.ie&&b.removeClass(d.element,"yui-effect-fade")},h.handleStartAnimateIn=function(k,j,l){l.overlay._fadingIn=!0,b.addClass(l.overlay.element,"hide-select"),l.overlay.underlay||l.overlay.cfg.refireEvent("underlay"),l.handleUnderlayStart(),l.overlay._setDomVisibility(!0),b.setStyle(l.overlay.element,"opacity",0)},h.handleCompleteAnimateIn=function(k,j,l){l.overlay._fadingIn=!1,b.removeClass(l.overlay.element,"hide-select"),l.overlay.element.style.filter&&(l.overlay.element.style.filter=null),l.handleUnderlayComplete(),l.overlay.cfg.refireEvent("iframe"),l.animateInCompleteEvent.fire()},h.handleStartAnimateOut=function(k,j,l){l.overlay._fadingOut=!0,b.addClass(l.overlay.element,"hide-select"),l.handleUnderlayStart()},h.handleCompleteAnimateOut=function(k,j,l){l.overlay._fadingOut=!1,b.removeClass(l.overlay.element,"hide-select"),l.overlay.element.style.filter&&(l.overlay.element.style.filter=null),l.overlay._setDomVisibility(!1),b.setStyle(l.overlay.element,"opacity",1),l.handleUnderlayComplete(),l.overlay.cfg.refireEvent("iframe"),l.animateOutCompleteEvent.fire()},h.init(),h},a.SLIDE=function(f,d){var i=YAHOO.util.Easing,l=f.cfg.getProperty("x")||b.getX(f.element),k=f.cfg.getProperty("y")||b.getY(f.element),m=b.getClientWidth(),h=f.element.offsetWidth,j={attributes:{points:{to:[l,k]}},duration:d,method:i.easeIn},e={attributes:{points:{to:[m+25,k]}},duration:d,method:i.easeOut},g=new a(f,j,e,f.element,YAHOO.util.Motion);return g.handleStartAnimateIn=function(o,n,p){p.overlay.element.style.left=-25-h+"px",p.overlay.element.style.top=k+"px"},g.handleTweenAnimateIn=function(q,p,r){var s=b.getXY(r.overlay.element),o=s[0],n=s[1];"hidden"==b.getStyle(r.overlay.element,"visibility")&&o<l&&r.overlay._setDomVisibility(!0),r.overlay.cfg.setProperty("xy",[o,n],!0),r.overlay.cfg.refireEvent("iframe")},g.handleCompleteAnimateIn=function(o,n,p){p.overlay.cfg.setProperty("xy",[l,k],!0),p.startX=l,p.startY=k,p.overlay.cfg.refireEvent("iframe"),p.animateInCompleteEvent.fire()},g.handleStartAnimateOut=function(o,n,r){var p=b.getViewportWidth(),q=b.getXY(r.overlay.element)[1];r.animOut.attributes.points.to=[p+25,q]},g.handleTweenAnimateOut=function(p,o,q){var s=b.getXY(q.overlay.element),n=s[0],r=s[1];q.overlay.cfg.setProperty("xy",[n,r],!0),q.overlay.cfg.refireEvent("iframe")},g.handleCompleteAnimateOut=function(o,n,p){p.overlay._setDomVisibility(!1),p.overlay.cfg.setProperty("xy",[l,k]),p.animateOutCompleteEvent.fire()},g.init(),g},a.prototype={init:function(){this.beforeAnimateInEvent=this.createEvent("beforeAnimateIn"),this.beforeAnimateInEvent.signature=c.LIST,this.beforeAnimateOutEvent=this.createEvent("beforeAnimateOut"),this.beforeAnimateOutEvent.signature=c.LIST,this.animateInCompleteEvent=this.createEvent("animateInComplete"),this.animateInCompleteEvent.signature=c.LIST,this.animateOutCompleteEvent=this.createEvent("animateOutComplete"),this.animateOutCompleteEvent.signature=c.LIST,this.animIn=new this.animClass(this.targetElement,this.attrIn.attributes,this.attrIn.duration,this.attrIn.method),this.animIn.onStart.subscribe(this.handleStartAnimateIn,this),this.animIn.onTween.subscribe(this.handleTweenAnimateIn,this),this.animIn.onComplete.subscribe(this.handleCompleteAnimateIn,this),this.animOut=new this.animClass(this.targetElement,this.attrOut.attributes,this.attrOut.duration,this.attrOut.method),this.animOut.onStart.subscribe(this.handleStartAnimateOut,this),this.animOut.onTween.subscribe(this.handleTweenAnimateOut,this),this.animOut.onComplete.subscribe(this.handleCompleteAnimateOut,this)},animateIn:function(){this._stopAnims(this.lastFrameOnStop),this.beforeAnimateInEvent.fire(),this.animIn.animate()},animateOut:function(){this._stopAnims(this.lastFrameOnStop),this.beforeAnimateOutEvent.fire(),this.animOut.animate()},lastFrameOnStop:!0,_stopAnims:function(d){this.animOut&&this.animOut.isAnimated()&&this.animOut.stop(d),this.animIn&&this.animIn.isAnimated()&&this.animIn.stop(d)},handleStartAnimateIn:function(e,d,f){},handleTweenAnimateIn:function(e,d,f){},handleCompleteAnimateIn:function(e,d,f){},handleStartAnimateOut:function(e,d,f){},handleTweenAnimateOut:function(e,d,f){},handleCompleteAnimateOut:function(e,d,f){},toString:function(){var d="ContainerEffect";return this.overlay&&(d+=" ["+this.overlay.toString()+"]"),d}},YAHOO.lang.augmentProto(a,YAHOO.util.EventProvider)}(),YAHOO.register("container",YAHOO.widget.Module,{version:"@VERSION@",build:"@BUILD@"}),function(){var aa,a,l,c,z,R,S=YAHOO.util.Event,U=YAHOO.util.Dom,al=YAHOO.lang,G=YAHOO.env.ua,e=YAHOO.widget.Panel,I=YAHOO.widget.Tooltip,an=YAHOO.widget.SimpleDialog,g=YAHOO.widget.Module.prototype,aj=g.initDefaultConfig,Y=g._initResizeMonitor,h=YAHOO.widget.Overlay.prototype,L=h.showIframe,O=!1,b=!1,ab={},ad={},ak="role",W="presentation",K="usearia",N="blur",ah="focus",D="visible",Q="dialog",B="describedby",ac="context",k="hidden",A="labelledby",q=function(ao,ap){ao.setAttribute(ak,ap)},s=function(ao,aq,ap){ao.setAttribute("aria-"+aq,ap)};al.augmentObject(g,{_initResizeMonitor:function(){Y.call(this);var ao=this.resizeMonitor;ao&&(q(ao,W),s(ao,k,!0),ao.tabIndex=-1)},configUseARIA:function(ap,ao){},configDescribedBy:function(aq,ap){var ao=ap[0];this.cfg.getProperty(K)&&ao&&s(this.element,B,ao)},configLabelledBy:function(aq,ap){var ao=ap[0];this.cfg.getProperty(K)&&ao&&s(this.element,A,ao)},initDefaultConfig:function(){this.cfg.addProperty(K,{handler:this.configUseARIA,value:G.gecko&&G.gecko>=1.9||G.ie&&G.ie>=8,validator:al.isBoolean}),this.cfg.addProperty(A,{handler:this.configLabelledBy,validator:al.isString}),this.cfg.addProperty(B,{handler:this.configDescribedBy,validator:al.isString}),aj.call(this)}},"initDefaultConfig","configUseARIA","configLabelledBy","configDescribedBy","_initResizeMonitor"),h.showIframe=function(){L.call(this);var ao=this.iframe;this.cfg.getProperty(K)&&ao&&!ao.getAttribute(ak)&&(q(ao,W),ao.tabIndex=-1)};var i=function(ap){27===S.getCharCode(ap)&&(this.cancel?this.cancel():this.hide())},p=function(ao){this.fireEvent(ah,ao)},af=function(ao){this.fireEvent(N,ao)},ai=function(aq,ap){var ao=ap[0];R._manageFocus(this)&&this.cfg.getProperty(D)&&this.focusFirst&&(ao||this.focusFirst())},d=function(aq,ap){var ao=ap[0];R._manageBlur(this)&&!ao&&this.fireEvent(N)},F=function(aq,ao,ap){if(this.blur(),ap&&ap.focus)try{ap.focus()}catch(ar){}this.unsubscribe(aq,F,ap)},r=function(){var ao=!0===this.cfg.getProperty("modal")?"hideMask":"beforeHide";this.subscribe(ao,F,z)},f=function(){s(this.innerElement,k,!this.cfg.getProperty(D))},u=function(){U.getElementsByClassName("container-close","a",this.element,function(ao){ao.removeAttribute("href"),q(ao,"button"),ao.tabIndex=0})},Z=function(ap,ao){ao[0]&&u.call(this)};e&&(aa=e.prototype,a=aa.initDefaultConfig,al.augmentObject(aa,{hasFocus:function(){return R&&this===R.getActive()},configUseARIA:function(aq,ap){ap[0]&&(R||(R=new YAHOO.widget.OverlayManager),R.register(this),this.focus=function(){this.hasFocus()||this.fireEvent(ah)},this.blur=function(){this.hasFocus()&&this.fireEvent(N)},S.onFocus(this.element,p,null,this),S.onBlur(this.element,af,null,this),this.subscribe(ah,ai),this.subscribe(N,d),S.on(this.element,"keydown",i,null,this),this.subscribe("beforeShow",r),f.call(this),this.cfg.subscribeToConfigEvent(D,f),this.cfg.subscribeToConfigEvent("close",Z),O||(S.onFocus(document,function(ar){z=S.getTarget(ar)}),O=!0))},configDescribedBy:function(aq,ap){var ao=ap[0];this.cfg.getProperty(K)&&ao&&s(this.innerElement,B,ao)},configLabelledBy:function(aq,ap){var ao=ap[0];this.cfg.getProperty(K)&&ao&&s(this.innerElement,A,ao)},configRole:function(au,ar){var aq,ap,ao,at=ar[0];if(at){switch(at){case"alertdialog":(aq=this.body)&&(ao=aq.id||U.generateId(aq),this.cfg.setProperty(B,ao));break;case Q:(ap=this.header)&&(ao=ap.id||U.generateId(ap),this.cfg.setProperty(A,ao))}q(this.innerElement,at),u.call(this)}},initDefaultConfig:function(){a.call(this),this.cfg.addProperty(ak,{handler:this.configRole,value:Q,validator:al.isString})}},"initDefaultConfig","configRole","configUseARIA","configLabelledBy","configDescribedBy","hasFocus")),an&&(l=an.prototype,c=l.configIcon,l.configIcon=function(ap,ao,at){c.apply(this,arguments);var aq,au=ao[0],ar=an.ICON_CSS_CLASSNAME;au&&"none"!=au&&(aq=U.getElementsByClassName(ar,"*",this.body))&&q(aq[0],W)});var m=function(aq){var ap,ao=S.getTarget(aq),ar=ad[ao.id];ar&&(ap=U.getXY(ao),ar.cfg.setProperty("xy",[ap[0],ap[1]+ao.offsetHeight+5]),ar.show())},J=function(ap){var ao=S.getTarget(ap),aq=ad[ao.id];aq&&aq.cfg.getProperty(D)&&aq.hide()},T=function(ap){var ao=ap.id;ad[ao]===this&&(delete ad[ao],ap.removeAttribute(B))},E=function(){var ap=this.element?this.element.id:this.id,ao=ab[ap];U.batch(ao,T,this,!0),ab[ap]=null},M=function(ap){var ao=ap.id||U.generateId(ap);ad[ao]=this,s(ap,B,this.element.id)},C=function(){var ao=this.cfg.getProperty(ac);U.batch(ao,M,this,!0),ab[this.element.id]=ao},P=function(aq,ao){E.call(this),ao[0]&&C.call(this)},ae=function(){s(this.body,k,!this.cfg.getProperty(D))};I&&(I.prototype.configUseARIA=function(aq,ap){ap[0]&&(q(this.body,"tooltip"),this.cfg.subscribeToConfigEvent(ac,P),ae.call(this),this.cfg.subscribeToConfigEvent(D,ae),this.subscribe("destroy",E),b||(S.onFocus(document,m),S.onBlur(document,J),b=!0))})}(),YAHOO.register("containerariaplugin",YAHOO.widget.Module,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.util.UserAction={simulateKeyEvent:function(f,j,e,c,l,b,a,k,h,n,m){if(!(f=YAHOO.util.Dom.get(f)))throw new Error("simulateKeyEvent(): Invalid target.");if(!YAHOO.lang.isString(j))throw new Error("simulateKeyEvent(): Event type must be a string.");switch(j=j.toLowerCase()){case"keyup":case"keydown":case"keypress":break;case"textevent":j="keypress";break;default:throw new Error("simulateKeyEvent(): Event type '"+j+"' not supported.")}YAHOO.lang.isBoolean(e)||(e=!0),YAHOO.lang.isBoolean(c)||(c=!0),YAHOO.lang.isObject(l)||(l=window),YAHOO.lang.isBoolean(b)||(b=!1),YAHOO.lang.isBoolean(a)||(a=!1),YAHOO.lang.isBoolean(k)||(k=!1),YAHOO.lang.isBoolean(h)||(h=!1),YAHOO.lang.isNumber(n)||(n=0),YAHOO.lang.isNumber(m)||(m=0);var i=null;if(YAHOO.lang.isFunction(document.createEvent)){try{(i=document.createEvent("KeyEvents")).initKeyEvent(j,e,c,l,b,a,k,h,n,m)}catch(g){try{i=document.createEvent("Events")}catch(d){i=document.createEvent("UIEvents")}finally{i.initEvent(j,e,c),i.view=l,i.altKey=a,i.ctrlKey=b,i.shiftKey=k,i.metaKey=h,i.keyCode=n,i.charCode=m}}f.dispatchEvent(i)}else{if(!YAHOO.lang.isObject(document.createEventObject))throw new Error("simulateKeyEvent(): No event simulation framework present.");(i=document.createEventObject()).bubbles=e,i.cancelable=c,i.view=l,i.ctrlKey=b,i.altKey=a,i.shiftKey=k,i.metaKey=h,i.keyCode=m>0?m:n,f.fireEvent("on"+j,i)}},simulateMouseEvent:function(k,p,h,e,q,j,g,f,d,b,c,a,o,m,i,l){if(!(k=YAHOO.util.Dom.get(k)))throw new Error("simulateMouseEvent(): Invalid target.");if(l=l||null,!YAHOO.lang.isString(p))throw new Error("simulateMouseEvent(): Event type must be a string.");switch(p=p.toLowerCase()){case"mouseover":case"mouseout":case"mousedown":case"mouseup":case"click":case"dblclick":case"mousemove":break;default:throw new Error("simulateMouseEvent(): Event type '"+p+"' not supported.")}YAHOO.lang.isBoolean(h)||(h=!0),YAHOO.lang.isBoolean(e)||(e="mousemove"!=p),YAHOO.lang.isObject(q)||(q=window),YAHOO.lang.isNumber(j)||(j=1),YAHOO.lang.isNumber(g)||(g=0),YAHOO.lang.isNumber(f)||(f=0),YAHOO.lang.isNumber(d)||(d=0),YAHOO.lang.isNumber(b)||(b=0),YAHOO.lang.isBoolean(c)||(c=!1),YAHOO.lang.isBoolean(a)||(a=!1),YAHOO.lang.isBoolean(o)||(o=!1),YAHOO.lang.isBoolean(m)||(m=!1),YAHOO.lang.isNumber(i)||(i=0);var n=null;if(YAHOO.lang.isFunction(document.createEvent))(n=document.createEvent("MouseEvents")).initMouseEvent?n.initMouseEvent(p,h,e,q,j,g,f,d,b,c,a,o,m,i,l):((n=document.createEvent("UIEvents")).initEvent(p,h,e),n.view=q,n.detail=j,n.screenX=g,n.screenY=f,n.clientX=d,n.clientY=b,n.ctrlKey=c,n.altKey=a,n.metaKey=m,n.shiftKey=o,n.button=i,n.relatedTarget=l),l&&!n.relatedTarget&&("mouseout"==p?n.toElement=l:"mouseover"==p&&(n.fromElement=l)),k.dispatchEvent(n);else{if(!YAHOO.lang.isObject(document.createEventObject))throw new Error("simulateMouseEvent(): No event simulation framework present.");switch(n=document.createEventObject(),n.bubbles=h,n.cancelable=e,n.view=q,n.detail=j,n.screenX=g,n.screenY=f,n.clientX=d,n.clientY=b,n.ctrlKey=c,n.altKey=a,n.metaKey=m,n.shiftKey=o,i){case 0:n.button=1;break;case 1:n.button=4;break;case 2:break;default:n.button=0}n.relatedTarget=l,k.fireEvent("on"+p,n)}},fireMouseEvent:function(c,b,a){a=a||{},this.simulateMouseEvent(c,b,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget)},click:function(b,a){this.fireMouseEvent(b,"click",a)},dblclick:function(b,a){this.fireMouseEvent(b,"dblclick",a)},mousedown:function(b,a){this.fireMouseEvent(b,"mousedown",a)},mousemove:function(b,a){this.fireMouseEvent(b,"mousemove",a)},mouseout:function(b,a){this.fireMouseEvent(b,"mouseout",a)},mouseover:function(b,a){this.fireMouseEvent(b,"mouseover",a)},mouseup:function(b,a){this.fireMouseEvent(b,"mouseup",a)},fireKeyEvent:function(b,c,a){a=a||{},this.simulateKeyEvent(c,b,a.bubbles,a.cancelable,a.view,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode)},keydown:function(b,a){this.fireKeyEvent("keydown",b,a)},keypress:function(b,a){this.fireKeyEvent("keypress",b,a)},keyup:function(b,a){this.fireKeyEvent("keyup",b,a)}},YAHOO.register("event-simulate",YAHOO.util.UserAction,{version:"@VERSION@",build:"@BUILD@"}),function(){var k=YAHOO.env.ua,c=YAHOO.util.Dom,z=YAHOO.util.Event,h=YAHOO.lang,t="DIV",p="hd",m="bd",o="ft",x="LI",a="disabled",u="mousedown",b="keydown",n="keyup",i="keypress",l="clicktohide",s="position",q="dynamic",y="showdelay",j="selected",e="visible";YAHOO.widget.MenuManager=function(){function B(R){var P,Q;if(R&&R.tagName)switch(R.tagName.toUpperCase()){case t:P=R.parentNode,Q=(c.hasClass(R,p)||c.hasClass(R,m)||c.hasClass(R,o))&&P&&P.tagName&&P.tagName.toUpperCase()==t?P:R;break;case x:Q=R;break;default:(P=R.parentNode)&&(Q=B(P))}return Q}function E(W,T){var X,R,S,Z,Y,P=z.getTarget(T),Q=B(P),U=!0;if(Q&&((R=Q.tagName.toUpperCase())==x?(S=Q.id)&&H[S]&&(Y=(Z=H[S]).parent):R==t&&Q.id&&(Y=D[Q.id])),Y)X=C[W],"click"==W&&k.gecko&&"mac"!=Y.platform&&T.button>0&&(U=!1),U&&Z&&!Z.cfg.getProperty(a)&&Z[X].fire(T),U&&Y[X].fire(T,Z);else if(W==u)for(var V in O)h.hasOwnProperty(O,V)&&(!(Y=O[V]).cfg.getProperty(l)||Y instanceof YAHOO.widget.MenuBar||Y.cfg.getProperty(s)!=q?(Y.cfg.getProperty(y)>0&&Y._cancelShowDelay(),Y.activeItem&&(Y.activeItem.blur(),Y.activeItem.cfg.setProperty(j,!1),Y.activeItem=null)):(Y.hide(),k.ie&&P.focus&&k.ie<9&&P.setActive()))}function N(Q,P,R){D[R.id]&&this.removeMenu(R)}function K(Q,P){var R=P[1];R&&(I=R)}function F(Q,P){I=null}function A(R,Q){var P=Q[0],S=this.id;P?O[S]=this:O[S]&&delete O[S]}function J(Q,P){M(this)}function M(Q){var P=Q.id;P&&H[P]&&(I==Q&&(I=null),delete H[P],Q.destroyEvent.unsubscribe(J))}function G(Q,P){var R,S=P[0];S instanceof YAHOO.widget.MenuItem&&(R=S.id,H[R]||(H[R]=S,S.destroyEvent.subscribe(J)))}var L=!1,D={},O={},H={},C={click:"clickEvent",mousedown:"mouseDownEvent",mouseup:"mouseUpEvent",mouseover:"mouseOverEvent",mouseout:"mouseOutEvent",keydown:"keyDownEvent",keyup:"keyUpEvent",keypress:"keyPressEvent",focus:"focusEvent",focusin:"focusEvent",blur:"blurEvent",focusout:"blurEvent"},I=null;return{addMenu:function(Q){var P;Q instanceof YAHOO.widget.Menu&&Q.id&&!D[Q.id]&&(D[Q.id]=Q,L||(P=document,z.on(P,"pointerover",E.bind(this,"mouseover")),z.on(P,"pointerout",E.bind(this,"mouseout")),z.on(P,"pointerdown",E.bind(this,u)),z.on(P,"pointerup",E.bind(this,"mouseup")),z.on(P,"pointerdown",E.bind(this,"click")),z.on(P,b,E.bind(this,b)),z.on(P,n,E.bind(this,n)),z.on(P,i,E.bind(this,i)),z.onFocus(P,E.bind(this,"focus")),z.onBlur(P,E.bind(this,"blur")),L=!0),Q.cfg.subscribeToConfigEvent(e,A),Q.destroyEvent.subscribe(N,Q,this),Q.itemAddedEvent.subscribe(G),Q.focusEvent.subscribe(K),Q.blurEvent.subscribe(F))},removeMenu:function(S){var Q,P,R;if(S&&(Q=S.id)in D&&D[Q]==S){if((P=S.getItems())&&P.length>0){R=P.length-1;do{M(P[R])}while(R--)}delete D[Q],Q in O&&O[Q]==S&&delete O[Q],S.cfg&&S.cfg.unsubscribeFromConfigEvent(e,A),S.destroyEvent.unsubscribe(N,S),S.itemAddedEvent.unsubscribe(G),S.focusEvent.unsubscribe(K),S.blurEvent.unsubscribe(F)}},hideVisible:function(){var P;for(var Q in O)h.hasOwnProperty(O,Q)&&((P=O[Q])instanceof YAHOO.widget.MenuBar||P.cfg.getProperty(s)!=q||P.hide())},getVisible:function(){return O},getMenus:function(){return D},getMenu:function(Q){var P;return Q in D&&(P=D[Q]),P},getMenuItem:function(Q){var P;return Q in H&&(P=H[Q]),P},getMenuItemGroup:function(T){var P,V,U,R,S,Q=c.get(T);if(Q&&Q.tagName&&"UL"==Q.tagName.toUpperCase()&&(V=Q.firstChild)){P=[];do{(R=V.id)&&(U=this.getMenuItem(R))&&(P[P.length]=U)}while(V=V.nextSibling);P.length>0&&(S=P)}return S},getFocusedMenuItem:function(){return I},getFocusedMenu:function(){var P;return I&&(P=I.parent.getRoot()),P},toString:function(){return"MenuManager"}}}()}(),function(){function aB(a6){aE=aa.getTarget(a6)}var am=YAHOO.lang,g="DIV",ah="SELECT",r="y",aj="first-of-type",aI="disabled",Y="selected",aU="groupindex",I="index",o="submenu",aV="visible",ay="hidedelay",aD="position",ad="dynamic",c="static",aO=ad+","+c,av="maxheight",t="topscrollbar",X="bottomscrollbar",p=t+"_"+aI,e=X+"_"+aI,B="mousemove",aW="showdelay",C="submenuhidedelay",af="iframe",W="constraintoviewport",a5="preventcontextoverlap",ao="submenualignment",z="autosubmenudisplay",ac="clicktohide",G="container",J="scrollincrement",aK="minscrollheight",a3="classname",aH="shadow",aS="keepopen",P="context",U="",aL="mousedown",aF="keydown",aP="height",u="width",aq="px",ae="monitorresize",ax="display",aw="block",j="visibility",Z="absolute",L="yui-menu-body-scrolled",aJ="mouseover",h="mouseout",ar="itemAdded",S="yui-menu-shadow",ag=S+"-visible";YAHOO.widget.Menu=function(a7,a6){a6&&(this.parent=a6.parent,this.lazyLoad=a6.lazyLoad||a6.lazyload,this.itemData=a6.itemData||a6.itemdata),YAHOO.widget.Menu.superclass.constructor.call(this,a7,a6)};var aQ,aE,F=YAHOO.util.Dom,aa=YAHOO.util.Event,aX=YAHOO.widget.Module,ab=YAHOO.widget.Overlay,R=YAHOO.widget.Menu,a4=YAHOO.widget.MenuManager,f=YAHOO.util.CustomEvent,aT=YAHOO.env.ua,au=!1,aC=[["mouseOverEvent",aJ],["mouseOutEvent",h],["mouseDownEvent",aL],["mouseUpEvent","mouseup"],["clickEvent","click"],["keyPressEvent","keypress"],["keyDownEvent",aF],["keyUpEvent","keyup"],["focusEvent","focus"],["blurEvent","blur"],["itemAddedEvent",ar],["itemRemovedEvent","itemRemoved"]],aA={key:aV,value:!1,validator:am.isBoolean},ap={key:W,value:!0,validator:am.isBoolean,supercedes:[af,"x",r,"xy"]},ai={key:a5,value:!0,validator:am.isBoolean,supercedes:[W]},s={key:aD,value:ad,validator:function(a7){var a6=!1;return am.isString(a7)&&(a6=-1!=aO.indexOf(a7.toLowerCase())),a6},supercedes:[aV,af]},a={key:ao,value:["tl","tr"]},T={key:z,value:!0,validator:am.isBoolean,suppressEvent:!0},y={key:aW,value:250,validator:am.isNumber,suppressEvent:!0},Q={key:ay,value:0,validator:am.isNumber,suppressEvent:!0},V={key:C,value:250,validator:am.isNumber,suppressEvent:!0},O={key:ac,value:!0,validator:am.isBoolean,suppressEvent:!0},an={key:G,suppressEvent:!0},aG={key:J,value:1,validator:am.isNumber,supercedes:[av],suppressEvent:!0},n={key:aK,value:90,validator:am.isNumber,supercedes:[av],suppressEvent:!0},x={key:av,value:0,validator:am.isNumber,supercedes:[af],suppressEvent:!0},w={key:a3,value:null,validator:am.isString,suppressEvent:!0},A={key:aI,value:!1,validator:am.isBoolean,suppressEvent:!0},i={key:aH,value:!0,validator:am.isBoolean,suppressEvent:!0,supercedes:[aV]},aM={key:aS,value:!1,validator:am.isBoolean};YAHOO.lang.extend(R,ab,{CSS_CLASS_NAME:"yuimenu",ITEM_TYPE:null,GROUP_TITLE_TAG_NAME:"h6",OFF_SCREEN_POSITION:"-999em",_useHideDelay:!1,_bHandledMouseOverEvent:!1,_bHandledMouseOutEvent:!1,_aGroupTitleElements:null,_aItemGroups:null,_aListElements:null,_nCurrentMouseX:0,_bStopMouseEventHandlers:!1,_sClassName:null,lazyLoad:!1,itemData:null,activeItem:null,parent:null,srcElement:null,init:function(a8,a7){this._aItemGroups=[],this._aListElements=[],this._aGroupTitleElements=[],this.ITEM_TYPE||(this.ITEM_TYPE=YAHOO.widget.MenuItem);var a6;if(am.isString(a8)?a6=F.get(a8):a8.tagName&&(a6=a8),a6&&a6.tagName)switch(a6.tagName.toUpperCase()){case g:this.srcElement=a6,a6.id||a6.setAttribute("id",F.generateId()),R.superclass.init.call(this,a6),this.beforeInitEvent.fire(R);break;case ah:this.srcElement=a6,R.superclass.init.call(this,F.generateId()),this.beforeInitEvent.fire(R)}else R.superclass.init.call(this,a8),this.beforeInitEvent.fire(R);this.element&&(F.addClass(this.element,this.CSS_CLASS_NAME),this.initEvent.subscribe(this._onInit),this.beforeRenderEvent.subscribe(this._onBeforeRender),this.renderEvent.subscribe(this._onRender),this.beforeShowEvent.subscribe(this._onBeforeShow),this.hideEvent.subscribe(this._onHide),this.showEvent.subscribe(this._onShow),this.beforeHideEvent.subscribe(this._onBeforeHide),this.mouseOverEvent.subscribe(this._onMouseOver),this.mouseOutEvent.subscribe(this._onMouseOut),this.clickEvent.subscribe(this._onClick),this.keyDownEvent.subscribe(this._onKeyDown),this.keyPressEvent.subscribe(this._onKeyPress),this.blurEvent.subscribe(this._onBlur),au||(aa.onFocus(document,aB),au=!0),(aT.gecko&&aT.gecko<1.9||aT.webkit&&aT.webkit<523)&&this.cfg.subscribeToConfigEvent(r,this._onYChange),a7&&this.cfg.applyConfig(a7,!0),a4.addMenu(this),this.initEvent.fire(R))},_initSubTree:function(){var a6,a9,bc,bd,bb,ba,a8,a7=this.srcElement;if(a7){if((a6=a7.tagName&&a7.tagName.toUpperCase())==g&&(bd=this.body.firstChild)){a9=0,bc=this.GROUP_TITLE_TAG_NAME.toUpperCase();do{if(bd&&bd.tagName)switch(bd.tagName.toUpperCase()){case bc:this._aGroupTitleElements[a9]=bd;break;case"UL":this._aListElements[a9]=bd,this._aItemGroups[a9]=[],a9++}}while(bd=bd.nextSibling);this._aListElements[0]&&F.addClass(this._aListElements[0],aj)}if(bd=null,a6)switch(a6){case g:if(bb=this._aListElements,(ba=bb.length)>0){a8=ba-1;do{if(bd=bb[a8].firstChild)do{bd&&bd.tagName&&"LI"==bd.tagName.toUpperCase()&&this.addItem(new this.ITEM_TYPE(bd,{parent:this}),a8)}while(bd=bd.nextSibling)}while(a8--)}break;case ah:bd=a7.firstChild;do{if(bd&&bd.tagName)switch(bd.tagName.toUpperCase()){case"OPTGROUP":case"OPTION":this.addItem(new this.ITEM_TYPE(bd,{parent:this}))}}while(bd=bd.nextSibling)}}},_getFirstEnabledItem:function(){for(var a9,a8,a6=this.getItems(),ba=a6.length,a7=0;a7<ba;a7++)if((a9=a6[a7])&&!a9.cfg.getProperty(aI)&&"none"!=a9.element.style.display){a8=a9;break}return a8},_addItemToGroup:function(bb,bc,bg){function a6(bi,bj){return bi[bj]||a6(bi,bj+1)}var be,bh,a9,bf,ba,a7,a8,bd;return bc instanceof this.ITEM_TYPE?(be=bc).parent=this:am.isString(bc)?be=new this.ITEM_TYPE(bc,{parent:this}):am.isObject(bc)&&(bc.parent=this,be=new this.ITEM_TYPE(bc.text,bc)),be&&(be.cfg.getProperty(Y)&&(this.activeItem=be),bh=am.isNumber(bb)?bb:0,(a9=this._getItemGroup(bh))||(a9=this._createItemGroup(bh)),am.isNumber(bg)?(ba=bg>=a9.length,a9[bg]?a9.splice(bg,0,be):a9[bg]=be,(bf=a9[bg])&&(!ba||bf.element.parentNode&&11!=bf.element.parentNode.nodeType?!(a7=a6(a9,bg+1))||bf.element.parentNode&&11!=bf.element.parentNode.nodeType||this._aListElements[bh].insertBefore(bf.element,a7.element):this._aListElements[bh].appendChild(bf.element),bf.parent=this,this._subscribeToItemEvents(bf),this._configureSubmenu(bf),this._updateItemProperties(bh),this.itemAddedEvent.fire(bf),this.changeContentEvent.fire(),bd=bf)):(a9[a8=a9.length]=be,(bf=a9[a8])&&(F.isAncestor(this._aListElements[bh],bf.element)||this._aListElements[bh].appendChild(bf.element),bf.element.setAttribute(aU,bh),bf.element.setAttribute(I,a8),bf.parent=this,bf.index=a8,bf.groupIndex=bh,this._subscribeToItemEvents(bf),this._configureSubmenu(bf),0===a8&&F.addClass(bf.element,aj),this.itemAddedEvent.fire(bf),this.changeContentEvent.fire(),bd=bf))),bd},_removeItemFromGroupByIndex:function(a9,a7){var bb,a6,a8=am.isNumber(a9)?a9:0,ba=this._getItemGroup(a8);return ba&&(bb=ba.splice(a7,1)[0])&&(this._updateItemProperties(a8),0===ba.length&&((a6=this._aListElements[a8])&&a6.parentNode&&a6.parentNode.removeChild(a6),this._aItemGroups.splice(a8,1),this._aListElements.splice(a8,1),(a6=this._aListElements[0])&&F.addClass(a6,aj)),this.itemRemovedEvent.fire(bb),this.changeContentEvent.fire()),bb},_removeItemFromGroupByValue:function(a9,a6){var bc,ba,a8,a7,bb=this._getItemGroup(a9);if(bb&&(bc=bb.length,ba=-1,bc>0)){a7=bc-1;do{if(bb[a7]==a6){ba=a7;break}}while(a7--);ba>-1&&(a8=this._removeItemFromGroupByIndex(a9,ba))}return a8},_updateItemProperties:function(a7){var ba,a9,a6,a8=this._getItemGroup(a7),bb=a8.length;if(bb>0){a6=bb-1;do{(ba=a8[a6])&&(a9=ba.element,ba.index=a6,ba.groupIndex=a7,a9.setAttribute(aU,a7),a9.setAttribute(I,a6),F.removeClass(a9,aj))}while(a6--);a9&&F.addClass(a9,aj)}},_createItemGroup:function(a8){var a6,a7;return this._aItemGroups[a8]||(this._aItemGroups[a8]=[],a6=document.createElement("ul"),this._aListElements[a8]=a6,a7=this._aItemGroups[a8]),a7},_getItemGroup:function(a8){var a7,a6=am.isNumber(a8)?a8:0,a9=this._aItemGroups;return a6 in a9&&(a7=a9[a6]),a7},_configureSubmenu:function(a6){var a7=a6.cfg.getProperty(o);a7&&(this.cfg.configChangedEvent.subscribe(this._onParentMenuConfigChange,a7,!0),this.renderEvent.subscribe(this._onParentMenuRender,a7,!0))},_subscribeToItemEvents:function(a6){a6.destroyEvent.subscribe(this._onMenuItemDestroy,a6,this),a6.cfg.configChangedEvent.subscribe(this._onMenuItemConfigChange,a6,this)},_onVisibleChange:function(a8,a7){a7[0]?F.addClass(this.element,aV):F.removeClass(this.element,aV)},_cancelHideDelay:function(){var a6=this.getRoot()._hideDelayTimer;a6&&a6.cancel()},_execHideDelay:function(){this._cancelHideDelay();var a6=this.getRoot();a6._hideDelayTimer=am.later(a6.cfg.getProperty(ay),this,function(){a6.activeItem&&(a6.hasFocus()&&a6.activeItem.focus(),a6.clearActiveItem()),a6!=this||this instanceof YAHOO.widget.MenuBar||this.cfg.getProperty(aD)!=ad||this.hide()})},_cancelShowDelay:function(){var a6=this.getRoot()._showDelayTimer;a6&&a6.cancel()},_execSubmenuHideDelay:function(a8,a7,a6){a8._submenuHideDelayTimer=am.later(50,this,function(){this._nCurrentMouseX>a7+10?a8._submenuHideDelayTimer=am.later(a6,a8,function(){this.hide()}):a8.hide()})},_disableScrollHeader:function(){this._bHeaderDisabled||(F.addClass(this.header,p),this._bHeaderDisabled=!0)},_disableScrollFooter:function(){this._bFooterDisabled||(F.addClass(this.footer,e),this._bFooterDisabled=!0)},_enableScrollHeader:function(){this._bHeaderDisabled&&(F.removeClass(this.header,p),this._bHeaderDisabled=!1)},_enableScrollFooter:function(){this._bFooterDisabled&&(F.removeClass(this.footer,e),this._bFooterDisabled=!1)},_onMouseOver:function(bi,bb){var a7,be,a8,bd,bc,bj=bb[0],bf=bb[1],a6=aa.getTarget(bj),ba=this.getRoot(),bh=this._submenuHideDelayTimer;this._bStopMouseEventHandlers||(this._bHandledMouseOverEvent||a6!=this.element&&!F.isAncestor(this.element,a6)||(this._useHideDelay&&this._cancelHideDelay(),this._nCurrentMouseX=0,aa.on(this.element,B,this._onMouseMove,this,!0),bf&&F.isAncestor(bf.element,aa.getRelatedTarget(bj))||this.clearActiveItem(),this.parent&&bh&&(bh.cancel(),this.parent.cfg.setProperty(Y,!0),(a7=this.parent.parent)._bHandledMouseOutEvent=!0,a7._bHandledMouseOverEvent=!1),this._bHandledMouseOverEvent=!0,this._bHandledMouseOutEvent=!1),!bf||bf.handledMouseOverEvent||bf.cfg.getProperty(aI)||a6!=bf.element&&!F.isAncestor(bf.element,a6)||((be=this.cfg.getProperty(aW)>0)&&this._cancelShowDelay(),(a8=this.activeItem)&&a8.cfg.setProperty(Y,!1),(bd=bf.cfg).setProperty(Y,!0),(this.hasFocus()||ba._hasFocus)&&(bf.focus(),ba._hasFocus=!1),this.cfg.getProperty(z)&&(bc=bd.getProperty(o))&&(be?ba._showDelayTimer=am.later(ba.cfg.getProperty(aW),bc,function(){this.parent.cfg.getProperty(Y)&&this.show()}):bc.show()),bf.handledMouseOverEvent=!0,bf.handledMouseOutEvent=!1))},_onMouseOut:function(be,a8){var ba,a6,a7,bf=a8[0],bc=a8[1],a9=aa.getRelatedTarget(bf),bd=!1;this._bStopMouseEventHandlers||(bc&&!bc.cfg.getProperty(aI)&&((ba=bc.cfg.getProperty(o))&&(a9==ba.element||F.isAncestor(ba.element,a9))&&(bd=!0),bc.handledMouseOutEvent||(a9==bc.element||F.isAncestor(bc.element,a9))&&!bd||(bd||(bc.cfg.setProperty(Y,!1),ba&&(a6=this.cfg.getProperty(C),a7=this.cfg.getProperty(aW),!(this instanceof YAHOO.widget.MenuBar)&&a6>0&&a6>=a7?this._execSubmenuHideDelay(ba,aa.getPageX(bf),a6):ba.hide())),bc.handledMouseOutEvent=!0,bc.handledMouseOverEvent=!1)),this._bHandledMouseOutEvent||(this._didMouseLeave(a9)||bd)&&(this._useHideDelay&&this._execHideDelay(),aa.removeListener(this.element,B,this._onMouseMove),this._nCurrentMouseX=aa.getPageX(bf),this._bHandledMouseOutEvent=!0,this._bHandledMouseOverEvent=!1))},_didMouseLeave:function(a6){return a6===this._shadow||a6!=this.element&&!F.isAncestor(this.element,a6)},_onMouseMove:function(a7,a6){this._bStopMouseEventHandlers||(this._nCurrentMouseX=aa.getPageX(a7))},_onClick:function(bh,a8){var ba,bf,a7,a6,bb,bd,bg,bi=a8[0],bc=a8[1],be=!1,a9=function(){(a7=this.getRoot())instanceof YAHOO.widget.MenuBar||a7.cfg.getProperty(aD)==c?a7.clearActiveItem():a7.hide()};bc&&(bc.cfg.getProperty(aI)?(aa.preventDefault(bi),a9.call(this)):(ba=bc.cfg.getProperty(o),(bb=bc.cfg.getProperty("url"))&&(bd=bb.indexOf("#"),bg=bb.length,-1!=bd&&((bg=(bb=bb.substr(bd,bg)).length)>1?(a6=bb.substr(1,bg),(bf=YAHOO.widget.MenuManager.getMenu(a6))&&(be=this.getRoot()===bf.getRoot())):1===bg&&(be=!0))),be&&!bc.cfg.getProperty("target")&&(aa.preventDefault(bi),aT.webkit?bc.focus():bc.focusEvent.fire()),ba||this.cfg.getProperty(aS)||a9.call(this)))},_stopMouseEventHandlers:function(){this._bStopMouseEventHandlers=!0,am.later(10,this,function(){this._bStopMouseEventHandlers=!1})},_onKeyDown:function(bk,be){var bd,bi,a7,ba,bl,a6,bo,a9,bj,a8,bf,bn,bb,bc,bh=be[0],bg=be[1];if(this._useHideDelay&&this._cancelHideDelay(),bg&&!bg.cfg.getProperty(aI))switch(bi=bg.cfg,a7=this.parent,bh.keyCode){case 38:case 40:(bl=38==bh.keyCode?bg.getPreviousEnabledSibling():bg.getNextEnabledSibling())&&(this.clearActiveItem(),bl.cfg.setProperty(Y,!0),bl.focus(),(this.cfg.getProperty(av)>0||F.hasClass(this.body,L))&&(bo=(a6=this.body).scrollTop,a9=a6.offsetHeight,a8=(bj=this.getItems()).length-1,bf=bl.element.offsetTop,40==bh.keyCode?(bf>=a9+bo?a6.scrollTop=bf-a9:bf<=bo&&(a6.scrollTop=0),bl==bj[a8]&&(a6.scrollTop=bl.element.offsetTop)):(bf<=bo?a6.scrollTop=bf-bl.element.offsetHeight:bf>=bo+a9&&(a6.scrollTop=bf),bl==bj[0]&&(a6.scrollTop=0)),bo=a6.scrollTop,bn=a6.scrollHeight-a6.offsetHeight,0===bo?(this._disableScrollHeader(),this._enableScrollFooter()):bo==bn?(this._enableScrollHeader(),this._disableScrollFooter()):(this._enableScrollHeader(),this._enableScrollFooter()))),aa.preventDefault(bh),this._stopMouseEventHandlers();break;case 39:(bd=bi.getProperty(o))?(bi.getProperty(Y)||bi.setProperty(Y,!0),bd.show(),bd.setInitialFocus(),bd.setInitialSelection()):(ba=this.getRoot())instanceof YAHOO.widget.MenuBar&&(bl=ba.activeItem.getNextEnabledSibling())&&(ba.clearActiveItem(),bl.cfg.setProperty(Y,!0),(bd=bl.cfg.getProperty(o))?(bd.show(),bd.setInitialFocus()):bl.focus()),aa.preventDefault(bh),this._stopMouseEventHandlers();break;case 37:a7&&((bb=a7.parent)instanceof YAHOO.widget.MenuBar?(bl=bb.activeItem.getPreviousEnabledSibling())&&(bb.clearActiveItem(),bl.cfg.setProperty(Y,!0),(bd=bl.cfg.getProperty(o))?(bd.show(),bd.setInitialFocus()):bl.focus()):(this.hide(),a7.focus())),aa.preventDefault(bh),this._stopMouseEventHandlers()}if(27==bh.keyCode){if(this.cfg.getProperty(aD)==ad){if(this.hide(),this.parent)this.parent.focus();else if((bc=this._focusedElement)&&bc.focus)try{bc.focus()}catch(bm){}}else this.activeItem&&((bd=this.activeItem.cfg.getProperty(o))&&bd.cfg.getProperty(aV)?(bd.hide(),this.activeItem.focus()):(this.activeItem.blur(),this.activeItem.cfg.setProperty(Y,!1)));aa.preventDefault(bh)}},_onKeyPress:function(a8,a7){var a6=a7[0];40!=a6.keyCode&&38!=a6.keyCode||aa.preventDefault(a6)},_onBlur:function(a7,a6){this._hasFocus&&(this._hasFocus=!1)},_onYChange:function(a7,a6){var bb,a8,ba,a9=this.parent;a9&&(bb=a9.parent.body.scrollTop)>0&&(ba=this.cfg.getProperty(r)-bb,F.setY(this.element,ba),(a8=this.iframe)&&F.setY(a8,ba),this.cfg.setProperty(r,ba,!0))},_onScrollTargetMouseOver:function(bc,bf){var be=this._bodyScrollTimer;be&&be.cancel(),this._cancelHideDelay();var a6,a7,a8=aa.getTarget(bc),ba=this.body,a9=this.cfg.getProperty(J);F.hasClass(a8,"hd")?a7=function(){var bg=ba.scrollTop;bg>0?(ba.scrollTop=bg-a9,this._enableScrollFooter()):(ba.scrollTop=0,this._bodyScrollTimer.cancel(),this._disableScrollHeader())}:(a6=ba.scrollHeight-ba.offsetHeight,a7=function(){var bg=ba.scrollTop;bg<a6?(ba.scrollTop=bg+a9,this._enableScrollHeader()):(ba.scrollTop=a6,this._bodyScrollTimer.cancel(),this._disableScrollFooter())}),this._bodyScrollTimer=am.later(10,this,a7,null,!0)},_onScrollTargetMouseOut:function(a8,a6){var a7=this._bodyScrollTimer;a7&&a7.cancel(),this._cancelHideDelay()},_onInit:function(a7,a6){this.cfg.subscribeToConfigEvent(aV,this._onVisibleChange);var a8=!this.parent,a9=this.lazyLoad;(a8&&!a9||a8&&(this.cfg.getProperty(aV)||this.cfg.getProperty(aD)==c)||!a8&&!a9)&&0===this.getItemGroups().length?(this.srcElement&&this._initSubTree(),this.itemData&&this.addItems(this.itemData)):a9&&this.cfg.fireQueue()},_onBeforeRender:function(a9,a8){var a6,bb,ba=this.element,bd=this._aListElements.length,a7=!0,bc=0;if(bd>0)do{(a6=this._aListElements[bc])&&(a7&&(F.addClass(a6,aj),a7=!1),F.isAncestor(ba,a6)||this.appendToBody(a6),(bb=this._aGroupTitleElements[bc])&&(F.isAncestor(ba,bb)||a6.parentNode.insertBefore(bb,a6),F.addClass(a6,"hastitle"))),bc++}while(bc<bd)},_onRender:function(a7,a6){this.cfg.getProperty(aD)==ad&&(this.cfg.getProperty(aV)||this.positionOffScreen())},_onBeforeShow:function(a8,a7){var ba,bd,a9,bb=this.cfg.getProperty(G);if(this.lazyLoad&&0===this.getItemGroups().length){if(this.srcElement&&this._initSubTree(),this.itemData)if(this.parent&&this.parent.parent&&this.parent.parent.srcElement&&this.parent.parent.srcElement.tagName.toUpperCase()==ah)for(ba=this.itemData.length,bd=0;bd<ba;bd++)this.itemData[bd].tagName&&this.addItem(new this.ITEM_TYPE(this.itemData[bd]));else this.addItems(this.itemData);(a9=this.srcElement)?a9.tagName.toUpperCase()==ah?F.inDocument(a9)?this.render(a9.parentNode):this.render(bb):this.render():this.parent?this.render(this.parent.element):this.render(bb)}var a6,bc=this.parent;bc||this.cfg.getProperty(aD)!=ad||this.cfg.refireEvent("xy"),bc&&(a6=bc.parent.cfg.getProperty(ao),this.cfg.setProperty(P,[bc.element,a6[0],a6[1]]),this.align())},getConstrainedY:function(bi){var bs,bv,be,bk,bl,bf,a8,bt=this,bp=bt.cfg.getProperty(P),bw=bt.cfg.getProperty(av),bh={trbr:!0,tlbl:!0,bltl:!0,brtr:!0},bb=bp&&bh[bp[1]+bp[2]],bd=bt.element,bx=bd.offsetHeight,br=ab.VIEWPORT_OFFSET,bm=F.getViewportHeight(),bq=F.getDocumentScrollTop(),bn=bt.cfg.getProperty(aK)+br<bm,bg=!1,bj=bq+br,ba=bq+bm-bx-br,a6=bi,bc=function(){var by;return by=bt.cfg.getProperty(r)-bq>bk?bk-bx:bk+bl,bt.cfg.setProperty(r,by+bq,!0),by},a9=function(){return bt.cfg.getProperty(r)-bq>bk?a8-br:bf-br},bo=function(){var by;by=bt.cfg.getProperty(r)-bq>bk?bk+bl:bk-bd.offsetHeight,bt.cfg.setProperty(r,by+bq,!0)},a7=function(){bt._setScrollHeight(this.cfg.getProperty(av)),bt.hideEvent.unsubscribe(a7)},bu=function(){var bA,bz,bB=a9(),by=bt.getItems().length>0;return bx>bB?(bA=by?bt.cfg.getProperty(aK):bx,bs=bB>bA&&by?bB:bw,bt._setScrollHeight(bs),bt.hideEvent.subscribe(a7),bo(),bB<bA&&(bg?bc():(bc(),bg=!0,bz=bu()))):bs&&bs!==bw&&(bt._setScrollHeight(bw),bt.hideEvent.subscribe(a7),bo()),bz};return(bi<bj||bi>ba)&&(bn?bt.cfg.getProperty(a5)&&bb?(be=bp[0],bl=be.offsetHeight,bk=F.getY(be)-bq,bf=bk,a8=bm-(bk+bl),bu(),a6=bt.cfg.getProperty(r)):!(bt instanceof YAHOO.widget.MenuBar)&&bx>=bm?(bv=bm-2*br)>bt.cfg.getProperty(aK)&&(bt._setScrollHeight(bv),bt.hideEvent.subscribe(a7),bo(),a6=bt.cfg.getProperty(r)):bi<bj?a6=bj:bi>ba&&(a6=ba):a6=br+bq),a6},_onHide:function(a7,a6){this.cfg.getProperty(aD)===ad&&this.positionOffScreen()},_onShow:function(be,bc){function ba(bg){var bf;(bg.type==aL||bg.type==aF&&27==bg.keyCode)&&((bf=aa.getTarget(bg))==a8.element&&F.isAncestor(a8.element,bf)||(a8.cfg.setProperty(z,!1),aa.removeListener(document,aL,ba),aa.removeListener(document,aF,ba)))}function bd(bg,bf,bh){this.cfg.setProperty(u,U),this.hideEvent.unsubscribe(bd,bh)}var a8,a9,bb,a7,a6=this.parent;a6&&(!(a8=a6.parent).cfg.getProperty(z)&&(a8 instanceof YAHOO.widget.MenuBar||a8.cfg.getProperty(aD)==c)&&(a8.cfg.setProperty(z,!0),aa.on(document,aL,ba),aa.on(document,aF,ba)),this.cfg.getProperty("x")<a8.cfg.getProperty("x")&&aT.gecko&&aT.gecko<1.9&&!this.cfg.getProperty(u)&&(bb=(a9=this.element).offsetWidth,a9.style.width=bb+aq,a7=bb-(a9.offsetWidth-bb)+aq,this.cfg.setProperty(u,a7),this.hideEvent.subscribe(bd,a7))),this===this.getRoot()&&this.cfg.getProperty(aD)===ad&&(this._focusedElement=aE,this.focus())},_onBeforeHide:function(a8,a7){var bb,a9,a6=this.activeItem,ba=this.getRoot();a6&&((bb=a6.cfg).setProperty(Y,!1),(a9=bb.getProperty(o))&&a9.hide()),aT.ie&&this.cfg.getProperty(aD)===ad&&this.parent&&(ba._hasFocus=this.hasFocus()),ba==this&&ba.blur()},_onParentMenuConfigChange:function(a7,a6,ba){var a8=a6[0][0],a9=a6[0][1];switch(a8){case af:case W:case ay:case aW:case C:case ac:case"effect":case a3:case J:case av:case aK:case ae:case aH:case a5:case aS:ba.cfg.setProperty(a8,a9);break;case ao:this.parent.parent instanceof YAHOO.widget.MenuBar||ba.cfg.setProperty(a8,a9)}},_onParentMenuRender:function(a7,a6,bc){var bb,a9=bc.parent.parent,a8=a9.cfg,ba={constraintoviewport:a8.getProperty(W),xy:[0,0],clicktohide:a8.getProperty(ac),effect:a8.getProperty("effect"),showdelay:a8.getProperty(aW),hidedelay:a8.getProperty(ay),submenuhidedelay:a8.getProperty(C),classname:a8.getProperty(a3),scrollincrement:a8.getProperty(J),maxheight:a8.getProperty(av),minscrollheight:a8.getProperty(aK),iframe:a8.getProperty(af),shadow:a8.getProperty(aH),preventcontextoverlap:a8.getProperty(a5),monitorresize:a8.getProperty(ae),keepopen:a8.getProperty(aS)};a9 instanceof YAHOO.widget.MenuBar||(ba[ao]=a8.getProperty(ao)),bc.cfg.applyConfig(ba),this.lazyLoad||(bb=this.parent.element,this.element.parentNode==bb?this.render():this.render(bb))},_onMenuItemDestroy:function(a8,a7,a6){this._removeItemFromGroupByValue(a6.groupIndex,a6)},_onMenuItemConfigChange:function(a8,a7,a6){var ba=a7[0][0],bb=a7[0][1];switch(ba){case Y:!0===bb&&(this.activeItem=a6);break;case o:a7[0][1]&&this._configureSubmenu(a6)}},configVisible:function(a8,a7,a9){var a6,ba;this.cfg.getProperty(aD)==ad?R.superclass.configVisible.call(this,a8,a7,a9):(a6=a7[0],ba=F.getStyle(this.element,ax),F.setStyle(this.element,j,aV),a6?ba!=aw&&(this.beforeShowEvent.fire(),F.setStyle(this.element,ax,aw),this.showEvent.fire()):ba==aw&&(this.beforeHideEvent.fire(),F.setStyle(this.element,ax,"none"),this.hideEvent.fire()))},configPosition:function(a8,a7,bb){var a6,ba=this.element,a9=a7[0]==c?c:Z,bc=this.cfg;F.setStyle(ba,aD,a9),a9==c?(F.setStyle(ba,ax,aw),bc.setProperty(aV,!0)):F.setStyle(ba,j,"hidden"),a9==Z&&((a6=bc.getProperty("zindex"))&&0!==a6||bc.setProperty("zindex",1))},configIframe:function(a7,a6,a8){this.cfg.getProperty(aD)==ad&&R.superclass.configIframe.call(this,a7,a6,a8)},configHideDelay:function(a7,a6,a8){var a9=a6[0];this._useHideDelay=a9>0},configContainer:function(a7,a6,a9){var a8=a6[0];am.isString(a8)&&this.cfg.setProperty(G,F.get(a8),!0)},_clearSetWidthFlag:function(){this._widthSetForScroll=!1,this.cfg.unsubscribeFromConfigEvent(u,this._clearSetWidthFlag)},_subscribeScrollHandlers:function(a7,a6){var a9=this._onScrollTargetMouseOver,a8=this._onScrollTargetMouseOut;aa.on(a7,aJ,a9,this,!0),aa.on(a7,h,a8,this,!0),aa.on(a6,aJ,a9,this,!0),aa.on(a6,h,a8,this,!0)},_unsubscribeScrollHandlers:function(a7,a6){var a9=this._onScrollTargetMouseOver,a8=this._onScrollTargetMouseOut;aa.removeListener(a7,aJ,a9),aa.removeListener(a7,h,a8),aa.removeListener(a6,aJ,a9),aa.removeListener(a6,h,a8)},_setScrollHeight:function(bg){var a9,ba,bf,a7,a6,be,bb,a8,bd=bg,bc=!1,bh=!1;this.getItems().length>0&&(a9=this.element,ba=this.body,bf=this.header,a7=this.footer,a6=this.cfg.getProperty(aK),bd>0&&bd<a6&&(bd=a6),F.setStyle(ba,aP,U),F.removeClass(ba,L),ba.scrollTop=0,bh=aT.gecko&&aT.gecko<1.9||aT.ie,bd>0&&bh&&!this.cfg.getProperty(u)&&(bb=a9.offsetWidth,a9.style.width=bb+aq,a8=bb-(a9.offsetWidth-bb)+aq,this.cfg.unsubscribeFromConfigEvent(u,this._clearSetWidthFlag),this.cfg.setProperty(u,a8),this._widthSetForScroll=!0,this.cfg.subscribeToConfigEvent(u,this._clearSetWidthFlag)),bd>0&&!bf&&!a7&&(this.setHeader("&#32;"),this.setFooter("&#32;"),bf=this.header,a7=this.footer,F.addClass(bf,t),F.addClass(a7,X),a9.insertBefore(bf,ba),a9.appendChild(a7)),be=bd,bf&&a7&&(be-=bf.offsetHeight+a7.offsetHeight),be>0&&ba.offsetHeight>bd?(F.addClass(ba,L),F.setStyle(ba,aP,be+aq),this._hasScrollEventHandlers||(this._subscribeScrollHandlers(bf,a7),this._hasScrollEventHandlers=!0),this._disableScrollHeader(),this._enableScrollFooter(),bc=!0):bf&&a7&&(this._widthSetForScroll&&(this._widthSetForScroll=!1,this.cfg.unsubscribeFromConfigEvent(u,this._clearSetWidthFlag),this.cfg.setProperty(u,U)),this._enableScrollHeader(),this._enableScrollFooter(),this._hasScrollEventHandlers&&(this._unsubscribeScrollHandlers(bf,a7),this._hasScrollEventHandlers=!1),a9.removeChild(bf),a9.removeChild(a7),this.header=null,this.footer=null,bc=!0),bc&&(this.cfg.refireEvent(af),this.cfg.refireEvent(aH)))},_setMaxHeight:function(a7,a6,a8){this._setScrollHeight(a8),this.renderEvent.unsubscribe(this._setMaxHeight)},configMaxHeight:function(a7,a6,a8){var a9=a6[0];this.lazyLoad&&!this.body&&a9>0?this.renderEvent.subscribe(this._setMaxHeight,a9,this):this._setScrollHeight(a9)},configClassName:function(a8,a7,a9){var a6=a7[0];this._sClassName&&F.removeClass(this.element,this._sClassName),F.addClass(this.element,a6),this._sClassName=a6},_onItemAdded:function(a7,a6){var a8=a6[0];a8&&a8.cfg.setProperty(aI,!0)},configDisabled:function(a8,a7,bb){var bc,a9,ba=a7[0],a6=this.getItems();if(am.isArray(a6)){if((bc=a6.length)>0){a9=bc-1;do{a6[a9].cfg.setProperty(aI,ba)}while(a9--)}ba?(this.clearActiveItem(!0),F.addClass(this.element,aI),this.itemAddedEvent.subscribe(this._onItemAdded)):(F.removeClass(this.element,aI),this.itemAddedEvent.unsubscribe(this._onItemAdded))}},_sizeShadow:function(){var a7=this.element,a6=this._shadow;a6&&a7&&(a6.style.width&&a6.style.height&&(a6.style.width=U,a6.style.height=U),a6.style.width=a7.offsetWidth+6+aq,a6.style.height=a7.offsetHeight+1+aq)},_replaceShadow:function(){this.element.appendChild(this._shadow)},_addShadowVisibleClass:function(){F.addClass(this._shadow,ag)},_removeShadowVisibleClass:function(){F.removeClass(this._shadow,ag)},_removeShadow:function(){var a6=this._shadow&&this._shadow.parentNode;a6&&a6.removeChild(this._shadow),this.beforeShowEvent.unsubscribe(this._addShadowVisibleClass),this.beforeHideEvent.unsubscribe(this._removeShadowVisibleClass),this.cfg.unsubscribeFromConfigEvent(u,this._sizeShadow),this.cfg.unsubscribeFromConfigEvent(aP,this._sizeShadow),this.cfg.unsubscribeFromConfigEvent(av,this._sizeShadow),this.cfg.unsubscribeFromConfigEvent(av,this._replaceShadow),this.changeContentEvent.unsubscribe(this._sizeShadow),aX.textResizeEvent.unsubscribe(this._sizeShadow)},_createShadow:function(){var a6,a7=this._shadow;a7||(a6=this.element,aQ||((aQ=document.createElement("div")).className="yui-menu-shadow yui-menu-shadow-visible"),a7=aQ.cloneNode(!1),a6.appendChild(a7),this._shadow=a7,this.beforeShowEvent.subscribe(this._addShadowVisibleClass),this.beforeHideEvent.subscribe(this._removeShadowVisibleClass),aT.ie&&(am.later(0,this,function(){this._sizeShadow(),this.syncIframe()}),this.cfg.subscribeToConfigEvent(u,this._sizeShadow),this.cfg.subscribeToConfigEvent(aP,this._sizeShadow),this.cfg.subscribeToConfigEvent(av,this._sizeShadow),this.changeContentEvent.subscribe(this._sizeShadow),aX.textResizeEvent.subscribe(this._sizeShadow,this,!0),this.destroyEvent.subscribe(function(){aX.textResizeEvent.unsubscribe(this._sizeShadow,this)})),this.cfg.subscribeToConfigEvent(av,this._replaceShadow))},_shadowBeforeShow:function(){this._shadow?(this._replaceShadow(),aT.ie&&this._sizeShadow()):this._createShadow(),this.beforeShowEvent.unsubscribe(this._shadowBeforeShow)},configShadow:function(a7,a6,a8){var a9=a6[0];a9&&this.cfg.getProperty(aD)==ad?this.cfg.getProperty(aV)?this._shadow?(this._replaceShadow(),aT.ie&&this._sizeShadow()):this._createShadow():this.beforeShowEvent.subscribe(this._shadowBeforeShow):a9||(this.beforeShowEvent.unsubscribe(this._shadowBeforeShow),this._removeShadow())},initEvents:function(){R.superclass.initEvents.call(this);var a8,a6,a7=aC.length-1;do{a8=aC[a7],(a6=this.createEvent(a8[1])).signature=f.LIST,this[a8[0]]=a6}while(a7--)},positionOffScreen:function(){var a7=this.iframe,a8=this.element,a6=this.OFF_SCREEN_POSITION;a8.style.top=U,a8.style.left=U,a7&&(a7.style.top=a6,a7.style.left=a6)},getRoot:function(){var a7,a8=this.parent;return a8&&(a7=a8.parent)?a7.getRoot():this},toString:function(){var a7="Menu",a6=this.id;return a6&&(a7+=" "+a6),a7},setItemGroupTitle:function(bb,ba){var a9,a8,a7,a6;if(am.isString(bb)&&bb.length>0){a9=am.isNumber(ba)?ba:0,(a8=this._aGroupTitleElements[a9])?a8.innerHTML=bb:((a8=document.createElement(this.GROUP_TITLE_TAG_NAME)).innerHTML=bb,this._aGroupTitleElements[a9]=a8),a7=this._aGroupTitleElements.length-1;do{this._aGroupTitleElements[a7]&&(F.removeClass(this._aGroupTitleElements[a7],aj),a6=a7)}while(a7--);null!==a6&&F.addClass(this._aGroupTitleElements[a6],aj),this.changeContentEvent.fire()}},addItem:function(a6,a7){return this._addItemToGroup(a7,a6)},addItems:function(ba,a9){var bc,a6,bb,a7,a8;if(am.isArray(ba)){for(bc=ba.length,a6=[],a7=0;a7<bc;a7++)(bb=ba[a7])&&(am.isArray(bb)?a6[a6.length]=this.addItems(bb,a7):a6[a6.length]=this._addItemToGroup(a9,bb));a6.length&&(a8=a6)}return a8},insertItem:function(a6,a7,a8){return this._addItemToGroup(a8,a6,a7)},removeItem:function(a6,a8){var a9,a7;return am.isUndefined(a6)||(a6 instanceof YAHOO.widget.MenuItem?a9=this._removeItemFromGroupByValue(a8,a6):am.isNumber(a6)&&(a9=this._removeItemFromGroupByIndex(a8,a6)),a9&&(a9.destroy(),a7=a9)),a7},getItems:function(){var a8,a9=this._aItemGroups,a6=[];return am.isArray(a9)&&(a8=1==a9.length?a9[0]:Array.prototype.concat.apply(a6,a9)),a8},getItemGroups:function(){return this._aItemGroups},getItem:function(a7,a8){var a9,a6;return am.isNumber(a7)&&(a9=this._getItemGroup(a8))&&(a6=a9[a7]),a6},getSubmenus:function(){var a6,a8,ba,a9,a7=this.getItems(),bb=a7.length;if(bb>0)for(a6=[],a9=0;a9<bb;a9++)(ba=a7[a9])&&(a8=ba.cfg.getProperty(o))&&(a6[a6.length]=a8);return a6},clearContent:function(){var bd,bc,bb,ba=this.getItems(),a7=ba.length,a8=this.element,a9=this.body,be=this.header,a6=this.footer;if(a7>0){bb=a7-1;do{(bd=ba[bb])&&((bc=bd.cfg.getProperty(o))&&(this.cfg.configChangedEvent.unsubscribe(this._onParentMenuConfigChange,bc),this.renderEvent.unsubscribe(this._onParentMenuRender,bc)),this.removeItem(bd,bd.groupIndex))}while(bb--)}be&&(aa.purgeElement(be),a8.removeChild(be)),a6&&(aa.purgeElement(a6),a8.removeChild(a6)),a9&&(aa.purgeElement(a9),a9.innerHTML=U),this.activeItem=null,this._aItemGroups=[],this._aListElements=[],this._aGroupTitleElements=[],this.cfg.setProperty(u,null)},destroy:function(a6){this.clearContent(),this._aItemGroups=null,this._aListElements=null,this._aGroupTitleElements=null,R.superclass.destroy.call(this,a6)},setInitialFocus:function(){var a6=this._getFirstEnabledItem();a6&&a6.focus()},setInitialSelection:function(){var a6=this._getFirstEnabledItem();a6&&a6.cfg.setProperty(Y,!0)},clearActiveItem:function(a8){this.cfg.getProperty(aW)>0&&this._cancelShowDelay();var a9,a7,a6=this.activeItem;a6&&(a9=a6.cfg,a8&&(a6.blur(),this.getRoot()._hasFocus=!0),a9.setProperty(Y,!1),(a7=a9.getProperty(o))&&a7.hide(),this.activeItem=null)},focus:function(){this.hasFocus()||this.setInitialFocus()},blur:function(){var a6;this.hasFocus()&&(a6=a4.getFocusedMenuItem())&&a6.blur()},hasFocus:function(){return a4.getFocusedMenu()==this.getRoot()},_doItemSubmenuSubscribe:function(a7,a6,a9){var a8=a6[0].cfg.getProperty(o);a8&&a8.subscribe.apply(a8,a9)},_doSubmenuSubscribe:function(a7,a6,a9){var a8=this.cfg.getProperty(o);a8&&a8.subscribe.apply(a8,a9)},subscribe:function(){R.superclass.subscribe.apply(this,arguments),R.superclass.subscribe.call(this,ar,this._doItemSubmenuSubscribe,arguments);var ba,a9,a7,a8,a6=this.getItems();if(a6&&(ba=a6.length)>0){a8=ba-1;do{(a7=(a9=a6[a8]).cfg.getProperty(o))?a7.subscribe.apply(a7,arguments):a9.cfg.subscribeToConfigEvent(o,this._doSubmenuSubscribe,arguments)}while(a8--)}},unsubscribe:function(){R.superclass.unsubscribe.apply(this,arguments),R.superclass.unsubscribe.call(this,ar,this._doItemSubmenuSubscribe,arguments);var ba,a9,a7,a8,a6=this.getItems();if(a6&&(ba=a6.length)>0){a8=ba-1;do{(a7=(a9=a6[a8]).cfg.getProperty(o))?a7.unsubscribe.apply(a7,arguments):a9.cfg.unsubscribeFromConfigEvent(o,this._doSubmenuSubscribe,arguments)}while(a8--)}},initDefaultConfig:function(){R.superclass.initDefaultConfig.call(this);var a6=this.cfg;a6.addProperty(aA.key,{handler:this.configVisible,value:aA.value,validator:aA.validator}),a6.addProperty(ap.key,{handler:this.configConstrainToViewport,value:ap.value,validator:ap.validator,supercedes:ap.supercedes}),a6.addProperty(ai.key,{value:ai.value,validator:ai.validator,supercedes:ai.supercedes}),a6.addProperty(s.key,{handler:this.configPosition,value:s.value,validator:s.validator,supercedes:s.supercedes}),a6.addProperty(a.key,{value:a.value,suppressEvent:a.suppressEvent}),a6.addProperty(T.key,{value:T.value,validator:T.validator,suppressEvent:T.suppressEvent}),a6.addProperty(y.key,{value:y.value,validator:y.validator,suppressEvent:y.suppressEvent}),a6.addProperty(Q.key,{handler:this.configHideDelay,value:Q.value,validator:Q.validator,suppressEvent:Q.suppressEvent}),a6.addProperty(V.key,{value:V.value,validator:V.validator,suppressEvent:V.suppressEvent}),a6.addProperty(O.key,{value:O.value,validator:O.validator,suppressEvent:O.suppressEvent}),a6.addProperty(an.key,{handler:this.configContainer,value:document.body,suppressEvent:an.suppressEvent}),a6.addProperty(aG.key,{value:aG.value,validator:aG.validator,supercedes:aG.supercedes,suppressEvent:aG.suppressEvent}),a6.addProperty(n.key,{value:n.value,validator:n.validator,supercedes:n.supercedes,suppressEvent:n.suppressEvent}),a6.addProperty(x.key,{handler:this.configMaxHeight,value:x.value,validator:x.validator,suppressEvent:x.suppressEvent,supercedes:x.supercedes}),a6.addProperty(w.key,{handler:this.configClassName,value:w.value,validator:w.validator,supercedes:w.supercedes}),a6.addProperty(A.key,{handler:this.configDisabled,value:A.value,validator:A.validator,suppressEvent:A.suppressEvent}),a6.addProperty(i.key,{handler:this.configShadow,value:i.value,validator:i.validator}),a6.addProperty(aM.key,{value:aM.value,validator:aM.validator})}})}(),function(){YAHOO.widget.MenuItem=function(at,ar){at&&(ar&&(this.parent=ar.parent,this.value=ar.value,this.id=ar.id),this.init(at,ar))};var X=YAHOO.util.Dom,J=YAHOO.widget.Module,ab=YAHOO.widget.Menu,C=YAHOO.widget.MenuItem,ak=YAHOO.util.CustomEvent,K=YAHOO.env.ua,aq=YAHOO.lang,al="text",o="#",l="helptext",N="url",ah="target",a="emphasis",n="strongemphasis",B="checked",W="submenu",h="disabled",b="selected",p="hassubmenu",u="checked-disabled",ai="hassubmenu-disabled",ad="hassubmenu-selected",t="checked-selected",Q="onclick",I="OPTION",ae="href",i="</em>",T="none",v="visible",aa="click",d="show",m="hide",P=[["mouseOverEvent","mouseover"],["mouseOutEvent","mouseout"],["mouseDownEvent","mousedown"],["mouseUpEvent","mouseup"],["clickEvent",aa],["keyPressEvent","keypress"],["keyDownEvent","keydown"],["keyUpEvent","keyup"],["focusEvent","focus"],["blurEvent","blur"],["destroyEvent","destroy"]],O={key:al,value:"",validator:aq.isString,suppressEvent:!0},S={key:l,supercedes:[al],suppressEvent:!0},g={key:N,value:o,suppressEvent:!0},ao={key:ah,suppressEvent:!0},ap={key:a,value:!1,validator:aq.isBoolean,suppressEvent:!0,supercedes:[al]},D={key:n,value:!1,validator:aq.isBoolean,suppressEvent:!0,supercedes:[al]},L={key:B,value:!1,validator:aq.isBoolean,suppressEvent:!0,supercedes:[h,b]},f={key:W,suppressEvent:!0,supercedes:[h,b]},am={key:h,value:!1,validator:aq.isBoolean,suppressEvent:!0,supercedes:[al,b]},F={key:b,value:!1,validator:aq.isBoolean,suppressEvent:!0},U={key:Q,suppressEvent:!0},ac={key:"classname",value:null,validator:aq.isString,suppressEvent:!0},Z={key:"keylistener",value:null,suppressEvent:!0},c=null,E={},z=function(av,au){var ar=E[av];ar||(E[av]={},ar=E[av]);var at=ar[au];return at||(at=av+"-"+au,ar[au]=at),at},G=function(ar){X.addClass(this.element,z(this.CSS_CLASS_NAME,ar)),X.addClass(this._oAnchor,z(this.CSS_LABEL_CLASS_NAME,ar))},r=function(ar){X.removeClass(this.element,z(this.CSS_CLASS_NAME,ar)),X.removeClass(this._oAnchor,z(this.CSS_LABEL_CLASS_NAME,ar))};C.prototype={CSS_CLASS_NAME:"yuimenuitem",CSS_LABEL_CLASS_NAME:"yuimenuitemlabel",SUBMENU_TYPE:null,_oAnchor:null,_oHelpTextEM:null,_oSubmenu:null,_oOnclickAttributeValue:null,_sClassName:null,constructor:C,index:null,groupIndex:null,parent:null,element:null,srcElement:null,value:null,browser:J.prototype.browser,id:null,init:function(ar,aC){this.SUBMENU_TYPE||(this.SUBMENU_TYPE=ab),this.cfg=new YAHOO.util.Config(this),this.initDefaultConfig();var au,aB,aA,at,aw,av,ax,ay=this.cfg,az=o;if(aq.isString(ar))this._createRootNodeStructure(),ay.queueProperty(al,ar);else if(ar&&ar.tagName)switch(ar.tagName.toUpperCase()){case I:this._createRootNodeStructure(),ay.queueProperty(al,ar.text),ay.queueProperty(h,ar.disabled),this.value=ar.value,this.srcElement=ar;break;case"OPTGROUP":this._createRootNodeStructure(),ay.queueProperty(al,ar.label),ay.queueProperty(h,ar.disabled),this.srcElement=ar,this._initSubTree();break;case"LI":(aA=X.getFirstChild(ar))&&(az=aA.getAttribute(ae,2),at=aA.getAttribute(ah),aw=aA.innerHTML),this.srcElement=ar,this.element=ar,this._oAnchor=aA,ay.setProperty(al,aw,!0),ay.setProperty(N,az,!0),ay.setProperty(ah,at,!0),this._initSubTree()}if(this.element){(av=(this.srcElement||this.element).id)||(av=this.id||X.generateId(),this.element.id=av),this.id=av,X.addClass(this.element,this.CSS_CLASS_NAME),X.addClass(this._oAnchor,this.CSS_LABEL_CLASS_NAME),ax=P.length-1;do{aB=P[ax],(au=this.createEvent(aB[1])).signature=ak.LIST,this[aB[0]]=au}while(ax--);aC&&ay.applyConfig(aC),ay.fireQueue()}},_createRootNodeStructure:function(){var ar,at;c||((c=document.createElement("li")).innerHTML='<a href="#" touch-action="none"></a>'),(ar=c.cloneNode(!0)).className=this.CSS_CLASS_NAME,(at=ar.firstChild).className=this.CSS_LABEL_CLASS_NAME,this.element=ar,this._oAnchor=at},_initSubTree:function(){var aw,av,at,ar,ax,ay=this.srcElement,au=this.cfg;if(ay.childNodes.length>0)if(this.parent.lazyLoad&&this.parent.srcElement&&"SELECT"==this.parent.srcElement.tagName.toUpperCase())au.setProperty(W,{id:X.generateId(),itemdata:ay.childNodes});else{aw=ay.firstChild,av=[];do{if(aw&&aw.tagName)switch(aw.tagName.toUpperCase()){case"DIV":au.setProperty(W,aw);break;case I:av[av.length]=aw}}while(aw=aw.nextSibling);if((at=av.length)>0)for(ar=new this.SUBMENU_TYPE(X.generateId()),au.setProperty(W,ar),ax=0;ax<at;ax++)ar.addItem(new ar.ITEM_TYPE(av[ax]))}},configText:function(aB,au,aw){var at=au[0],av=this.cfg,az=this._oAnchor,ar=av.getProperty(l),aA="",ax="",ay="";at&&(ar&&(aA='<em class="helptext">'+ar+i),av.getProperty(a)&&(ax="<em>",ay=i),av.getProperty(n)&&(ax="<strong>",ay="</strong>"),az.innerHTML=ax+at+ay+aA)},configHelpText:function(au,at,ar){this.cfg.refireEvent(al)},configURL:function(au,at,ar){var aw=at[0];aw||(aw=o);var av=this._oAnchor;K.opera&&av.removeAttribute(ae),av.setAttribute(ae,aw)},configTarget:function(av,au,at){var ar=au[0],aw=this._oAnchor;ar&&ar.length>0?aw.setAttribute(ah,ar):aw.removeAttribute(ah)},configEmphasis:function(au,at,ar){var aw=at[0],av=this.cfg;aw&&av.getProperty(n)&&av.setProperty(n,!1),av.refireEvent(al)},configStrongEmphasis:function(av,au,at){var ar=au[0],aw=this.cfg;ar&&aw.getProperty(a)&&aw.setProperty(a,!1),aw.refireEvent(al)},configChecked:function(au,at,ar){var aw=at[0],av=this.cfg;aw?G.call(this,B):r.call(this,B),av.refireEvent(al),av.getProperty(h)&&av.refireEvent(h),av.getProperty(b)&&av.refireEvent(b)},configDisabled:function(au,at,ar){var aw=at[0],ax=this.cfg,av=ax.getProperty(W),ay=ax.getProperty(B);aw?(ax.getProperty(b)&&ax.setProperty(b,!1),G.call(this,h),av&&G.call(this,ai),ay&&G.call(this,u)):(r.call(this,h),av&&r.call(this,ai),ay&&r.call(this,u))},configSelected:function(au,at,ar){var ay=this.cfg,ax=this._oAnchor,aw=at[0],az=ay.getProperty(B),av=ay.getProperty(W);K.opera&&ax.blur(),aw&&!ay.getProperty(h)?(G.call(this,b),av&&G.call(this,ad),az&&G.call(this,t)):(r.call(this,b),av&&r.call(this,ad),az&&r.call(this,t)),this.hasFocus()&&K.opera&&ax.focus()},_onSubmenuBeforeHide:function(av,au){function at(){aw._oAnchor.blur(),ar.beforeHideEvent.unsubscribe(at)}var ar,aw=this.parent;aw.hasFocus()&&(ar=aw.parent).beforeHideEvent.subscribe(at)},configSubmenu:function(az,au,ax){var ay,aA,ar,aw=au[0],av=this.cfg,at=this.parent&&this.parent.lazyLoad;aw?(aw instanceof ab?((ay=aw).parent=this,ay.lazyLoad=at):aq.isObject(aw)&&aw.id&&!aw.nodeType?(aA=aw.id,(ar=aw).lazyload=at,ar.parent=this,ay=new this.SUBMENU_TYPE(aA,ar),av.setProperty(W,ay,!0)):(ay=new this.SUBMENU_TYPE(aw,{lazyload:at,parent:this}),av.setProperty(W,ay,!0)),ay&&(ay.cfg.setProperty("preventcontextoverlap",!0),G.call(this,p),av.getProperty(N)===o&&av.setProperty(N,o+ay.id),this._oSubmenu=ay,K.opera&&ay.beforeHideEvent.subscribe(this._onSubmenuBeforeHide))):(r.call(this,p),this._oSubmenu&&this._oSubmenu.destroy()),av.getProperty(h)&&av.refireEvent(h),av.getProperty(b)&&av.refireEvent(b)},configOnClick:function(au,at,ar){var av=at[0];this._oOnclickAttributeValue&&this._oOnclickAttributeValue!=av&&(this.clickEvent.unsubscribe(this._oOnclickAttributeValue.fn,this._oOnclickAttributeValue.obj),this._oOnclickAttributeValue=null),!this._oOnclickAttributeValue&&aq.isObject(av)&&aq.isFunction(av.fn)&&(this.clickEvent.subscribe(av.fn,"obj"in av?av.obj:this,"scope"in av?av.scope:null),this._oOnclickAttributeValue=av)},configClassName:function(av,au,at){var ar=au[0];this._sClassName&&X.removeClass(this.element,this._sClassName),X.addClass(this.element,ar),this._sClassName=ar},_dispatchClickEvent:function(){var ar,at=this;at.cfg.getProperty(h)||(ar=X.getFirstChild(at.element),this._dispatchDOMClick(ar))},_dispatchDOMClick:function(at){var ar;K.ie&&K.ie<9?at.fireEvent(Q):(K.gecko&&K.gecko>=1.9||K.opera||K.webkit?(ar=document.createEvent("HTMLEvents")).initEvent(aa,!0,!0):(ar=document.createEvent("MouseEvents")).initMouseEvent(aa,!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),at.dispatchEvent(ar))},_createKeyListener:function(av,au,ax){var aw=this,at=aw.parent,ar=new YAHOO.util.KeyListener(at.element.ownerDocument,ax,{fn:aw._dispatchClickEvent,scope:aw,correctScope:!0});at.cfg.getProperty(v)&&ar.enable(),at.subscribe(d,ar.enable,null,ar),at.subscribe(m,ar.disable,null,ar),aw._keyListener=ar,at.unsubscribe(d,aw._createKeyListener,ax)},configKeyListener:function(au,at){var aw=at[0],av=this,ar=av.parent;av._keyData&&(ar.unsubscribe(d,av._createKeyListener,av._keyData),av._keyData=null),av._keyListener&&(ar.unsubscribe(d,av._keyListener.enable),ar.unsubscribe(m,av._keyListener.disable),av._keyListener.disable(),av._keyListener=null),aw&&(av._keyData=aw,ar.subscribe(d,av._createKeyListener,aw,av))},initDefaultConfig:function(){var ar=this.cfg;ar.addProperty(O.key,{handler:this.configText,value:O.value,validator:O.validator,suppressEvent:O.suppressEvent}),ar.addProperty(S.key,{handler:this.configHelpText,supercedes:S.supercedes,suppressEvent:S.suppressEvent}),ar.addProperty(g.key,{handler:this.configURL,value:g.value,suppressEvent:g.suppressEvent}),ar.addProperty(ao.key,{handler:this.configTarget,suppressEvent:ao.suppressEvent}),ar.addProperty(ap.key,{handler:this.configEmphasis,value:ap.value,validator:ap.validator,suppressEvent:ap.suppressEvent,supercedes:ap.supercedes}),ar.addProperty(D.key,{handler:this.configStrongEmphasis,value:D.value,validator:D.validator,suppressEvent:D.suppressEvent,supercedes:D.supercedes}),ar.addProperty(L.key,{handler:this.configChecked,value:L.value,validator:L.validator,suppressEvent:L.suppressEvent,supercedes:L.supercedes}),ar.addProperty(am.key,{handler:this.configDisabled,value:am.value,validator:am.validator,suppressEvent:am.suppressEvent}),ar.addProperty(F.key,{handler:this.configSelected,value:F.value,validator:F.validator,suppressEvent:F.suppressEvent}),ar.addProperty(f.key,{handler:this.configSubmenu,supercedes:f.supercedes,suppressEvent:f.suppressEvent}),ar.addProperty(U.key,{handler:this.configOnClick,suppressEvent:U.suppressEvent}),ar.addProperty(ac.key,{handler:this.configClassName,value:ac.value,validator:ac.validator,suppressEvent:ac.suppressEvent}),ar.addProperty(Z.key,{handler:this.configKeyListener,value:Z.value,suppressEvent:Z.suppressEvent})},getNextSibling:function(){var au,ax,ar=function(ay){return"ul"===ay.nodeName.toLowerCase()},aw=this.element,av=X.getNextSibling(aw);return av||(au=aw.parentNode,ax=X.getNextSiblingBy(au,ar)||X.getFirstChildBy(au.parentNode,ar),av=X.getFirstChild(ax)),YAHOO.widget.MenuManager.getMenuItem(av.id)},getNextEnabledSibling:function(){var ar=this.getNextSibling();return ar.cfg.getProperty(h)||ar.element.style.display==T?ar.getNextEnabledSibling():ar},getPreviousSibling:function(){var au,ax,ar=function(ay){return"ul"===ay.nodeName.toLowerCase()},aw=this.element,av=X.getPreviousSibling(aw);return av||(au=aw.parentNode,ax=X.getPreviousSiblingBy(au,ar)||X.getLastChildBy(au.parentNode,ar),av=X.getLastChild(ax)),YAHOO.widget.MenuManager.getMenuItem(av.id)},getPreviousEnabledSibling:function(){var ar=this.getPreviousSibling();return ar.cfg.getProperty(h)||ar.element.style.display==T?ar.getPreviousEnabledSibling():ar},focus:function(){var av=this.parent,au=this._oAnchor,ar=av.activeItem;!this.cfg.getProperty(h)&&av&&av.cfg.getProperty(v)&&this.element.style.display!=T&&aq.later(0,this,function(){try{K.ie&&!document.hasFocus()||(ar&&ar.blurEvent.fire(),au.focus(),this.focusEvent.fire())}catch(aw){}})},blur:function(){var ar=this.parent;!this.cfg.getProperty(h)&&ar&&ar.cfg.getProperty(v)&&aq.later(0,this,function(){try{this._oAnchor.blur(),this.blurEvent.fire()}catch(at){}},0)},hasFocus:function(){return YAHOO.widget.MenuManager.getFocusedMenuItem()==this},destroy:function(){var at,ar,av,au=this.element;if(au){(at=this.cfg.getProperty(W))&&at.destroy(),(ar=au.parentNode)&&(ar.removeChild(au),this.destroyEvent.fire()),av=P.length-1;do{this[P[av][0]].unsubscribeAll()}while(av--);this.cfg.configChangedEvent.unsubscribeAll()}},toString:function(){var at="MenuItem",ar=this.id;return ar&&(at+=" "+ar),at}},aq.augmentProto(C,YAHOO.util.EventProvider)}(),function(){function d(l,k,m){this.cfg.setProperty(b,m),this.beforeShowEvent.unsubscribe(d,m)}var b="xy",c="mousedown";YAHOO.widget.ContextMenu=function(l,k){YAHOO.widget.ContextMenu.superclass.constructor.call(this,l,k)};var i=YAHOO.util.Event,e=YAHOO.env.ua,g=YAHOO.widget.ContextMenu,a={TRIGGER_CONTEXT_MENU:"triggerContextMenu",CONTEXT_MENU:e.opera?c:"contextmenu",CLICK:"click"},h={key:"trigger",suppressEvent:!0};YAHOO.lang.extend(g,YAHOO.widget.Menu,{_oTrigger:null,_bCancelled:!1,contextEventTarget:null,triggerContextMenuEvent:null,init:function(l,k){g.superclass.init.call(this,l),this.beforeInitEvent.fire(g),k&&this.cfg.applyConfig(k,!0),this.initEvent.fire(g)},initEvents:function(){g.superclass.initEvents.call(this),this.triggerContextMenuEvent=this.createEvent(a.TRIGGER_CONTEXT_MENU),this.triggerContextMenuEvent.signature=YAHOO.util.CustomEvent.LIST},cancel:function(){this._bCancelled=!0},_removeEventHandlers:function(){var k=this._oTrigger;k&&(i.removeListener(k,a.CONTEXT_MENU,this._onTriggerContextMenu),e.opera&&i.removeListener(k,a.CLICK,this._onTriggerClick))},_onTriggerClick:function(l,k){l.ctrlKey&&i.stopEvent(l)},_onTriggerContextMenu:function(m,k){var l;(m.type!=c||m.ctrlKey)&&(this.contextEventTarget=i.getTarget(m),this.triggerContextMenuEvent.fire(m),this._bCancelled||(i.stopEvent(m),YAHOO.widget.MenuManager.hideVisible(),l=i.getXY(m),YAHOO.util.Dom.inDocument(this.element)?this.cfg.setProperty(b,l):this.beforeShowEvent.subscribe(d,l),this.show()),this._bCancelled=!1)},toString:function(){var l="ContextMenu",k=this.id;return k&&(l+=" "+k),l},initDefaultConfig:function(){g.superclass.initDefaultConfig.call(this),this.cfg.addProperty(h.key,{handler:this.configTrigger,suppressEvent:h.suppressEvent})},destroy:function(k){this._removeEventHandlers(),g.superclass.destroy.call(this,k)},configTrigger:function(l,k,n){var m=k[0];m?(this._oTrigger&&this._removeEventHandlers(),this._oTrigger=m,i.on(m,a.CONTEXT_MENU,this._onTriggerContextMenu,this,!0),e.opera&&i.on(m,a.CLICK,this._onTriggerClick,this,!0)):this._removeEventHandlers()}})}(),YAHOO.widget.ContextMenuItem=YAHOO.widget.MenuItem,function(){var d=YAHOO.lang,n="static",m="dynamic,"+n,a="disabled",f="selected",b="autosubmenudisplay",g="submenu",c="visible",h="submenutoggleregion";YAHOO.widget.MenuBar=function(t,s){YAHOO.widget.MenuBar.superclass.constructor.call(this,t,s)};var r=YAHOO.util.Event,l=YAHOO.widget.MenuBar,k={key:"position",value:n,validator:function(t){var s=!1;return d.isString(t)&&(s=-1!=m.indexOf(t.toLowerCase())),s},supercedes:[c]},e={key:"submenualignment",value:["tl","bl"]},j={key:b,value:!1,validator:d.isBoolean,suppressEvent:!0},i={key:h,value:!1,validator:d.isBoolean};d.extend(l,YAHOO.widget.Menu,{init:function(t,s){this.ITEM_TYPE||(this.ITEM_TYPE=YAHOO.widget.MenuBarItem),l.superclass.init.call(this,t),this.beforeInitEvent.fire(l),s&&this.cfg.applyConfig(s,!0),this.initEvent.fire(l)},CSS_CLASS_NAME:"yuimenubar",SUBMENU_TOGGLE_REGION_WIDTH:20,_onKeyDown:function(u,t,y){var w,x,v,s=t[0],z=t[1];if(z&&!z.cfg.getProperty(a))switch(x=z.cfg,s.keyCode){case 37:case 39:z!=this.activeItem||x.getProperty(f)?(v=37==s.keyCode?z.getPreviousEnabledSibling():z.getNextEnabledSibling())&&(this.clearActiveItem(),v.cfg.setProperty(f,!0),(w=v.cfg.getProperty(g))?(w.show(),w.setInitialFocus()):v.focus()):x.setProperty(f,!0),r.preventDefault(s);break;case 40:this.activeItem!=z&&(this.clearActiveItem(),x.setProperty(f,!0),z.focus()),(w=x.getProperty(g))&&(w.cfg.getProperty(c)?(w.setInitialSelection(),w.setInitialFocus()):(w.show(),w.setInitialFocus())),r.preventDefault(s)}27==s.keyCode&&this.activeItem&&((w=this.activeItem.cfg.getProperty(g))&&w.cfg.getProperty(c)?(w.hide(),this.activeItem.focus()):(this.activeItem.cfg.setProperty(f,!1),this.activeItem.blur()),r.preventDefault(s))},_onClick:function(E,y,B){l.superclass._onClick.call(this,E,y,B);var s,F,w,z,A,v,D=y[1],t=!0,x=function(){A.cfg.getProperty(c)?A.hide():A.show()};return D&&!D.cfg.getProperty(a)&&(F=y[0],r.getTarget(F),w=this.activeItem,z=this.cfg,w&&w!=D&&this.clearActiveItem(),D.cfg.setProperty(f,!0),(A=D.cfg.getProperty(g))&&(s=D.element,v=YAHOO.util.Dom.getX(s)+(s.offsetWidth-this.SUBMENU_TOGGLE_REGION_WIDTH),z.getProperty(h)?r.getPageX(F)>v&&(x(),r.preventDefault(F),t=!1):x())),t},configSubmenuToggle:function(u,t){t[0]&&this.cfg.setProperty(b,!1)},toString:function(){var t="MenuBar",s=this.id;return s&&(t+=" "+s),t},initDefaultConfig:function(){l.superclass.initDefaultConfig.call(this);var s=this.cfg;s.addProperty(k.key,{handler:this.configPosition,value:k.value,validator:k.validator,supercedes:k.supercedes}),s.addProperty(e.key,{value:e.value,suppressEvent:e.suppressEvent}),s.addProperty(j.key,{value:j.value,validator:j.validator,suppressEvent:j.suppressEvent}),s.addProperty(i.key,{value:i.value,validator:i.validator,handler:this.configSubmenuToggle})}})}(),YAHOO.widget.MenuBarItem=function(b,a){YAHOO.widget.MenuBarItem.superclass.constructor.call(this,b,a)},YAHOO.lang.extend(YAHOO.widget.MenuBarItem,YAHOO.widget.MenuItem,{init:function(b,a){this.SUBMENU_TYPE||(this.SUBMENU_TYPE=YAHOO.widget.Menu),YAHOO.widget.MenuBarItem.superclass.init.call(this,b);var c=this.cfg;a&&c.applyConfig(a,!0),c.fireQueue()},CSS_CLASS_NAME:"yuimenubaritem",CSS_LABEL_CLASS_NAME:"yuimenubaritemlabel",toString:function(){var a="MenuBarItem";return this.cfg&&this.cfg.getProperty("text")&&(a+=": "+this.cfg.getProperty("text")),a}}),YAHOO.register("menu",YAHOO.widget.Menu,{version:"@VERSION@",build:"@BUILD@"}),function(){var g,b=YAHOO.util.Event,c=YAHOO.util.Dom,k=YAHOO.lang,T=YAHOO.env.ua,Q=YAHOO.widget.ContextMenu,J="aria-",O="haspopup",d="presentation",a="submenu",S="trigger",M="visible",H=function(l,m){l.setAttribute("role",m)},I=function(l,n,m){l.setAttribute(J+n,m)},Z=function(l){1===l.nodeType&&I(l,O,!0)},K=function(l){1===l.nodeType&&l.removeAttribute(J+O)},F=function(m){var l=b.getTarget(m);c.isAncestor(this.element,l)?(g&&(g.tabIndex=-1),(g=l).tabIndex=0):g&&this.getItems().length>0&&(g.tabIndex=-1,(g=c.getFirstChild(this.getItem(0).element)).tabIndex=0)},i=function(p,n){var m=n[0],q=n[1],l=b.getTarget(m),o=b.getCharCode(m);q&&13===o&&(T.ie&&T.ie<10?l.fireEvent("onclick"):((m=document.createEvent("HTMLEvents")).initEvent("click",!0,!0),l.dispatchEvent(m)))},V=function(n,m){m[0]&&Z(c.getFirstChild(this.element))},P=function(n){var l=n.element;H(l.parentNode,d),H(l,d);var m=c.getFirstChild(l);H(m,"menuitem"),m.tabIndex=-1,m.removeAttribute("href"),n.cfg.getProperty(a)?Z(m):n.cfg.subscribeToConfigEvent(a,V)},Y=function(m,l){P(l[0])},N=function(){I(this.element,"hidden",!this.cfg.getProperty(M))};YAHOO.widget.Menu.prototype.configUseARIA=function(s,r){var m,q,u,o,p,t=r[0],l=this.parent,n=this.element,v=this instanceof YAHOO.widget.MenuBar?"menubar":"menu";if(t){if(H(n,v),l&&(o=c.generateId(c.getFirstChild(l.element)),I(n,"labelledby",o)),m=this.getItems(),(q=m.length)>0){p=q-1;do{u=m[p],P(u),p-=1}while(p>-1);this.getRoot()===this&&((g=c.getFirstChild(this.getItem(0).element)).tabIndex=0)}this===this.getRoot()&&b.onFocus(document,F,null,this),this.subscribe("itemAdded",Y),this.subscribe("keypress",i),this.cfg.subscribeToConfigEvent(M,N)}};var X={},h=function(){var n,m=this.element.id,l=this.cfg.getProperty(S),o=X[m];o&&(k.isString(o)?(n=c.get(o))&&K(n):1===o.nodeType?K(o):o.length&&c.batch(o,K)),l&&(k.isString(l)?(n=c.get(l))&&Z(n):1===l.nodeType?Z(l):l.length&&c.batch(l,Z),X[m]=l)};Q.prototype.configUseARIA=function(m,l){Q.superclass.configUseARIA.apply(this,arguments),h.call(this),this.cfg.subscribeToConfigEvent(S,h)}}(),YAHOO.register("menuariaplugin",YAHOO.widget.Menu,{version:"@VERSION@",build:"@BUILD@"}),YAHOO.register("menuariaplugin",YAHOO.widget.Menu,{version:"@VERSION@",build:"@BUILD@"}),function(){var b=YAHOO.util,c=b.Dom,i=b.Event,g=window.document,k="active",d="activeIndex",f="activeTab",e="disabled",a="contentEl",h="element",j=function(m,l){l=l||{},1!=arguments.length||YAHOO.lang.isString(m)||m.nodeName||(m=(l=m).element||null),m||l.element||(m=this._createTabViewElement(l)),j.superclass.constructor.call(this,m,l)};YAHOO.extend(j,b.Element,{CLASSNAME:"yui-navset",TAB_PARENT_CLASSNAME:"yui-nav",CONTENT_PARENT_CLASSNAME:"yui-content",_tabParent:null,_contentParent:null,addTab:function(n,o){var r,p=this.get("tabs"),s=this._tabParent,q=this._contentParent,l=n.get(h),m=n.get(a),t=this.get(d);if(!p)return this._queue[this._queue.length]=["addTab",arguments],!1;r=this.getTab(o),o=void 0===o?p.length:o,p.splice(o,0,n),r?(s.insertBefore(l,r.get(h)),m&&q.appendChild(m)):(s.appendChild(l),m&&q.appendChild(m)),n.get(k)?(this.set(f,n,!0),this.set("activeIndex",o,!0)):(n.set("contentVisible",!1,!0),o<=t&&this.set(d,t+1,!0)),this._initTabEvents(n)},_initTabEvents:function(l){l.addListener(l.get("activationEvent"),l._onActivate,this,l),l.addListener("activationEventChange",l._onActivationEventChange,this,l)},_removeTabEvents:function(l){l.removeListener(l.get("activationEvent"),l._onActivate,this,l),l.removeListener("activationEventChange",l._onActivationEventChange,this,l)},DOMEventHandler:function(q){var n,m,r=i.getTarget(q),t=this._tabParent,s=this.get("tabs");if(c.isAncestor(t,r)){for(var o=0,p=s.length;o<p;o++)if(m=s[o].get(h),s[o].get(a),r==m||c.isAncestor(m,r)){n=s[o];break}n&&n.fireEvent(q.type,q)}},getTab:function(l){return this.get("tabs")[l]},getTabIndex:function(p){for(var m=null,o=this.get("tabs"),n=0,l=o.length;n<l;++n)if(p==o[n]){m=n;break}return m},removeTab:function(o){var n=this.get("tabs").length,l=this.get(d),m=this.getTabIndex(o);o===this.get(f)?n>1?m+1===n?this.set(d,m-1):this.set(d,m+1):this.set(f,null):m<l&&this.set(d,l-1,!0),this._removeTabEvents(o),this._tabParent.removeChild(o.get(h)),this._contentParent.removeChild(o.get(a)),this._configs.tabs.value.splice(m,1),o.fireEvent("remove",{type:"remove",tabview:this})},toString:function(){return"TabView "+(this.get("id")||this.get("tagName"))},contentTransition:function(m,l){m&&m.set("contentVisible",!0),l&&l.set("contentVisible",!1)},initAttributes:function(l){j.superclass.initAttributes.call(this,l),l.orientation||(l.orientation="top");this.get(h);this.hasClass(this.CLASSNAME)||this.addClass(this.CLASSNAME),this.setAttributeConfig("tabs",{value:[],readOnly:!0}),this._tabParent=this.getElementsByClassName(this.TAB_PARENT_CLASSNAME,"ul")[0]||this._createTabParent(),this._contentParent=this.getElementsByClassName(this.CONTENT_PARENT_CLASSNAME,"div")[0]||this._createContentParent(),this.setAttributeConfig("orientation",{value:l.orientation,method:function(o){var p=this.get("orientation");this.addClass("yui-navset-"+o),p!=o&&this.removeClass("yui-navset-"+p),"bottom"===o&&this.appendChild(this._tabParent)}}),this.setAttributeConfig(d,{value:l.activeIndex,validator:function(q){var p,o=!0;return q&&(p=this.getTab(q))&&p.get(e)&&(o=!1),o}}),this.setAttributeConfig(f,{value:l[f],method:function(p){var o=this.get(f);p&&p.set(k,!0),o&&o!==p&&o.set(k,!1),o&&p!==o?this.contentTransition(p,o):p&&p.set("contentVisible",!0)},validator:function(p){var o=!0;return p&&p.get(e)&&(o=!1),o}}),this.on("activeTabChange",this._onActiveTabChange),this.on("activeIndexChange",this._onActiveIndexChange),this._tabParent&&this._initTabs(),this.DOM_EVENTS.submit=!1,this.DOM_EVENTS.focus=!1,this.DOM_EVENTS.blur=!1,this.DOM_EVENTS.change=!1;for(var m in this.DOM_EVENTS)YAHOO.lang.hasOwnProperty(this.DOM_EVENTS,m)&&this.addListener.call(this,m,this.DOMEventHandler)},deselectTab:function(l){this.getTab(l)===this.get(f)&&this.set(f,null)},selectTab:function(l){this.set(f,this.getTab(l))},_onActiveTabChange:function(n){var l=this.get(d),m=this.getTabIndex(n.newValue);l!==m&&(this.set(d,m)||this.set(f,n.prevValue))},_onActiveIndexChange:function(l){l.newValue!==this.getTabIndex(this.get(f))&&(this.set(f,this.getTab(l.newValue))||this.set(d,l.prevValue))},_initTabs:function(){for(var r,m,s,q=c.getChildren(this._tabParent),o=c.getChildren(this._contentParent),n=this.get(d),p=0,l=q.length;p<l;++p)m={},o[p]&&(m.contentEl=o[p]),r=new YAHOO.widget.Tab(q[p],m),this.addTab(r),r.hasClass(r.ACTIVE_CLASSNAME)&&(s=r);void 0!=n?this.set(f,this.getTab(n)):(this._configs[f].value=s,this._configs[d].value=this.getTabIndex(s))},_createTabViewElement:function(l){var m=g.createElement("div");return this.CLASSNAME&&(m.className=this.CLASSNAME),m},_createTabParent:function(l){var m=g.createElement("ul");return this.TAB_PARENT_CLASSNAME&&(m.className=this.TAB_PARENT_CLASSNAME),this.get(h).appendChild(m),m},_createContentParent:function(l){var m=g.createElement("div");return this.CONTENT_PARENT_CLASSNAME&&(m.className=this.CONTENT_PARENT_CLASSNAME),this.get(h).appendChild(m),m}}),YAHOO.widget.TabView=j}(),function(){var d=YAHOO.util,i=d.Dom,l=YAHOO.lang,m="activeTab",j="label",g="labelEl",q="content",c="contentEl",p="cacheData",b="dataSrc",h="dataLoaded",a="dataTimeout",n="loadMethod",f="postData",k="disabled",e=function(s,r){r=r||{},1!=arguments.length||l.isString(s)||s.nodeName||(s=(r=s).element),s||r.element||(s=this._createTabElement(r)),this.loadHandler={success:function(t){this.set(q,t.responseText)},failure:function(t){}},e.superclass.constructor.call(this,s,r),this.DOM_EVENTS={}};YAHOO.extend(e,YAHOO.util.Element,{LABEL_TAGNAME:"em",ACTIVE_CLASSNAME:"selected",HIDDEN_CLASSNAME:"yui-hidden",ACTIVE_TITLE:"active",DISABLED_CLASSNAME:k,LOADING_CLASSNAME:"loading",dataConnection:null,loadHandler:null,_loading:!1,toString:function(){var r=this.get("element");return"Tab "+(r.id||r.tagName)},initAttributes:function(r){r=r||{},e.superclass.initAttributes.call(this,r),this.setAttributeConfig("activationEvent",{value:r.activationEvent||"click"}),this.setAttributeConfig(g,{value:r[g]||this._getLabelEl(),method:function(s){s=i.get(s);var t=this.get(g);if(t){if(t==s)return!1;t.parentNode.replaceChild(s,t),this.set(j,s.innerHTML)}}}),this.setAttributeConfig(j,{value:r.label||this._getLabel(),method:function(t){var s=this.get(g);s||this.set(g,this._createLabelEl()),s.innerHTML=t}}),this.setAttributeConfig(c,{value:r[c]||document.createElement("div"),method:function(s){s=i.get(s);var t=this.get(c);if(t){if(t===s)return!1;this.get("selected")||i.addClass(s,this.HIDDEN_CLASSNAME),t.parentNode.replaceChild(s,t),this.set(q,s.innerHTML)}}}),this.setAttributeConfig(q,{value:r[q]||this.get(c).innerHTML,method:function(s){this.get(c).innerHTML=s}}),this.setAttributeConfig(b,{value:r.dataSrc}),this.setAttributeConfig(p,{value:r.cacheData||!1,validator:l.isBoolean}),this.setAttributeConfig(n,{value:r.loadMethod||"GET",validator:l.isString}),this.setAttributeConfig(h,{value:!1,validator:l.isBoolean,writeOnce:!0}),this.setAttributeConfig(a,{value:r.dataTimeout||null,validator:l.isNumber}),this.setAttributeConfig(f,{value:r.postData||null}),this.setAttributeConfig("active",{value:r.active||this.hasClass(this.ACTIVE_CLASSNAME),method:function(s){!0===s?(this.addClass(this.ACTIVE_CLASSNAME),this.set("title",this.ACTIVE_TITLE)):(this.removeClass(this.ACTIVE_CLASSNAME),this.set("title",""))},validator:function(s){return l.isBoolean(s)&&!this.get(k)}}),this.setAttributeConfig(k,{value:r.disabled||this.hasClass(this.DISABLED_CLASSNAME),method:function(s){!0===s?this.addClass(this.DISABLED_CLASSNAME):this.removeClass(this.DISABLED_CLASSNAME)},validator:l.isBoolean}),this.setAttributeConfig("href",{value:r.href||this.getElementsByTagName("a")[0].getAttribute("href",2)||"#",method:function(s){this.getElementsByTagName("a")[0].href=s},validator:l.isString}),this.setAttributeConfig("contentVisible",{value:r.contentVisible,method:function(s){s?(i.removeClass(this.get(c),this.HIDDEN_CLASSNAME),this.get(b)&&(this._loading||this.get(h)&&this.get(p)||this._dataConnect())):i.addClass(this.get(c),this.HIDDEN_CLASSNAME)},validator:l.isBoolean})},_dataConnect:function(){if(!d.Connect)return!1;i.addClass(this.get(c).parentNode,this.LOADING_CLASSNAME),this._loading=!0,this.dataConnection=d.Connect.asyncRequest(this.get(n),this.get(b),{success:function(r){this.loadHandler.success.call(this,r),this.set(h,!0),this.dataConnection=null,i.removeClass(this.get(c).parentNode,this.LOADING_CLASSNAME),this._loading=!1},failure:function(r){this.loadHandler.failure.call(this,r),this.dataConnection=null,i.removeClass(this.get(c).parentNode,this.LOADING_CLASSNAME),this._loading=!1},scope:this,timeout:this.get(a)},this.get(f))},_createTabElement:function(r){var v=document.createElement("li"),s=document.createElement("a"),u=r.label||null,t=r.labelEl||null;return s.href=r.href||"#",v.appendChild(s),t?u||(u=this._getLabel()):t=this._createLabelEl(),s.appendChild(t),v},_getLabelEl:function(){return this.getElementsByTagName(this.LABEL_TAGNAME)[0]},_createLabelEl:function(){return document.createElement(this.LABEL_TAGNAME)},_getLabel:function(){var r=this.get(g);if(r)return r.innerHTML},_onActivate:function(u,t){var s=this,r=!1;d.Event.preventDefault(u),s===t.get(m)&&(r=!0),t.set(m,s,r)},_onActivationEventChange:function(s){var r=this;s.prevValue!=s.newValue&&(r.removeListener(s.prevValue,r._onActivate),r.addListener(s.newValue,r._onActivate,this,r))}}),YAHOO.widget.Tab=e}(),YAHOO.register("tabview",YAHOO.widget.TabView,{version:"@VERSION@",build:"@BUILD@"}),function(){function C(G,E,F,H){C.ANIM_AVAIL=!YAHOO.lang.isUndefined(YAHOO.util.Anim),G&&(this.init(G,E,!0),this.initSlider(H),this.initThumb(F))}var B=YAHOO.util.Dom.getXY,A=YAHOO.util.Event,D=Array.prototype.slice;YAHOO.lang.augmentObject(C,{getHorizSlider:function(F,G,I,H,E){return new C(F,F,new YAHOO.widget.SliderThumb(G,F,I,H,0,0,E),"horiz")},getVertSlider:function(G,H,E,I,F){return new C(G,G,new YAHOO.widget.SliderThumb(H,G,0,0,E,I,F),"vert")},getSliderRegion:function(G,H,J,I,E,K,F){return new C(G,G,new YAHOO.widget.SliderThumb(H,G,J,I,E,K,F),"region")},SOURCE_UI_EVENT:1,SOURCE_SET_VALUE:2,SOURCE_KEY_EVENT:3,ANIM_AVAIL:!1},!0),YAHOO.extend(C,YAHOO.util.DragDrop,{_mouseDown:!1,dragOnly:!0,initSlider:function(E){this.type=E,this.createEvent("change",this),this.createEvent("slideStart",this),this.createEvent("slideEnd",this),this.isTarget=!1,this.animate=C.ANIM_AVAIL,this.backgroundEnabled=!0,this.tickPause=40,this.enableKeys=!0,this.keyIncrement=20,this.moveComplete=!0,this.animationDuration=.2,this.SOURCE_UI_EVENT=1,this.SOURCE_SET_VALUE=2,this.valueChangeSource=0,this._silent=!1,this.lastOffset=[0,0]},initThumb:function(F){var E=this;this.thumb=F,F.cacheBetweenDrags=!0,F._isHoriz&&F.xTicks&&F.xTicks.length?this.tickPause=Math.round(360/F.xTicks.length):F.yTicks&&F.yTicks.length&&(this.tickPause=Math.round(360/F.yTicks.length)),F.onAvailable=function(){return E.setStartSliderState()},F.onMouseDown=function(){return E._mouseDown=!0,E.focus()},F.startDrag=function(){E._slideStart()},F.onDrag=function(){E.fireEvents(!0)},F.onMouseUp=function(){E.thumbMouseUp()}},onAvailable:function(){this._bindKeyEvents()},_bindKeyEvents:function(){A.on(this.id,"keydown",this.handleKeyDown,this,!0),A.on(this.id,"keypress",this.handleKeyPress,this,!0)},handleKeyPress:function(F){if(this.enableKeys)switch(A.getCharCode(F)){case 37:case 38:case 39:case 40:case 36:case 35:A.preventDefault(F)}},handleKeyDown:function(J){if(this.enableKeys){var G=A.getCharCode(J),F=this.thumb,H=this.getXValue(),E=this.getYValue(),I=!0;switch(G){case 37:H-=this.keyIncrement;break;case 38:E-=this.keyIncrement;break;case 39:H+=this.keyIncrement;break;case 40:E+=this.keyIncrement;break;case 36:H=F.leftConstraint,E=F.topConstraint;break;case 35:H=F.rightConstraint,E=F.bottomConstraint;break;default:I=!1}I&&(F._isRegion?this._setRegionValue(C.SOURCE_KEY_EVENT,H,E,!0):this._setValue(C.SOURCE_KEY_EVENT,F._isHoriz?H:E,!0),A.stopEvent(J))}},setStartSliderState:function(){this.setThumbCenterPoint(),this.baselinePos=B(this.getEl()),this.thumb.startOffset=this.thumb.getOffsetFromParent(this.baselinePos),this.thumb._isRegion?this.deferredSetRegionValue?(this._setRegionValue.apply(this,this.deferredSetRegionValue),this.deferredSetRegionValue=null):this.setRegionValue(0,0,!0,!0,!0):this.deferredSetValue?(this._setValue.apply(this,this.deferredSetValue),this.deferredSetValue=null):this.setValue(0,!0,!0,!0)},setThumbCenterPoint:function(){var E=this.thumb.getEl();E&&(this.thumbCenterPoint={x:parseInt(E.offsetWidth/2,10),y:parseInt(E.offsetHeight/2,10)})},lock:function(){this.thumb.lock(),this.locked=!0},unlock:function(){this.thumb.unlock(),this.locked=!1},thumbMouseUp:function(){this._mouseDown=!1,this.isLocked()||this.endMove()},onMouseUp:function(){this._mouseDown=!1,this.backgroundEnabled&&!this.isLocked()&&this.endMove()},getThumb:function(){return this.thumb},focus:function(){this.valueChangeSource=C.SOURCE_UI_EVENT;var E=this.getEl();if(E.focus)try{E.focus()}catch(F){}return this.verifyOffset(),!this.isLocked()},onChange:function(E,F){},onSlideStart:function(){},onSlideEnd:function(){},getValue:function(){return this.thumb.getValue()},getXValue:function(){return this.thumb.getXValue()},getYValue:function(){return this.thumb.getYValue()},setValue:function(){var E=D.call(arguments);return E.unshift(C.SOURCE_SET_VALUE),this._setValue.apply(this,E)},_setValue:function(I,L,G,H,E){var K,J,F=this.thumb;return F.available?!(this.isLocked()&&!H)&&(!isNaN(L)&&(!F._isRegion&&(this._silent=E,this.valueChangeSource=I||C.SOURCE_SET_VALUE,F.lastOffset=[L,L],this.verifyOffset(),this._slideStart(),F._isHoriz?(K=F.initPageX+L+this.thumbCenterPoint.x,this.moveThumb(K,F.initPageY,G)):(J=F.initPageY+L+this.thumbCenterPoint.y,this.moveThumb(F.initPageX,J,G)),!0))):(this.deferredSetValue=arguments,!1)},setRegionValue:function(){var E=D.call(arguments);return E.unshift(C.SOURCE_SET_VALUE),this._setRegionValue.apply(this,E)},_setRegionValue:function(F,J,H,I,G,K){var E,M,L=this.thumb;return L.available?!(this.isLocked()&&!G)&&(!isNaN(J)&&(!!L._isRegion&&(this._silent=K,this.valueChangeSource=F||C.SOURCE_SET_VALUE,L.lastOffset=[J,H],this.verifyOffset(),this._slideStart(),E=L.initPageX+J+this.thumbCenterPoint.x,M=L.initPageY+H+this.thumbCenterPoint.y,this.moveThumb(E,M,I),!0))):(this.deferredSetRegionValue=arguments,!1)},verifyOffset:function(){var F=B(this.getEl()),E=this.thumb;return this.thumbCenterPoint&&this.thumbCenterPoint.x||this.setThumbCenterPoint(),!F||F[0]==this.baselinePos[0]&&F[1]==this.baselinePos[1]||(this.setInitPosition(),this.baselinePos=F,E.initPageX=this.initPageX+E.startOffset[0],E.initPageY=this.initPageY+E.startOffset[1],E.deltaSetXY=null,this.resetThumbConstraints(),!1)},moveThumb:function(K,J,I,G){var F,E,H,L=this.thumb,M=this;L.available&&(L.setDelta(this.thumbCenterPoint.x,this.thumbCenterPoint.y),E=L.getTargetCoord(K,J),F=[Math.round(E.x),Math.round(E.y)],this.animate&&L._graduated&&!I?(this.lock(),this.curCoord=B(this.thumb.getEl()),this.curCoord=[Math.round(this.curCoord[0]),Math.round(this.curCoord[1])],setTimeout(function(){M.moveOneTick(F)},this.tickPause)):this.animate&&C.ANIM_AVAIL&&!I?(this.lock(),(H=new YAHOO.util.Motion(L.id,{points:{to:F}},this.animationDuration,YAHOO.util.Easing.easeOut)).onComplete.subscribe(function(){M.unlock(),M._mouseDown||M.endMove()}),H.animate()):(L.setDragElPos(K,J),G||this._mouseDown||this.endMove()))},_slideStart:function(){this._sliding||(this._silent||(this.onSlideStart(),this.fireEvent("slideStart")),this._sliding=!0,this.moveComplete=!1)},_slideEnd:function(){if(this._sliding){var E=this._silent;this._sliding=!1,this.moveComplete=!0,this._silent=!1,E||(this.onSlideEnd(),this.fireEvent("slideEnd"))}},moveOneTick:function(F){var E,J,H=this.thumb,G=this,I=null;H._isRegion?(E=null!==(I=this._getNextX(this.curCoord,F))?I[0]:this.curCoord[0],J=null!==(I=this._getNextY(this.curCoord,F))?I[1]:this.curCoord[1],I=E!==this.curCoord[0]||J!==this.curCoord[1]?[E,J]:null):I=H._isHoriz?this._getNextX(this.curCoord,F):this._getNextY(this.curCoord,F),I?(this.curCoord=I,this.thumb.alignElWithMouse(H.getEl(),I[0]+this.thumbCenterPoint.x,I[1]+this.thumbCenterPoint.y),I[0]!=F[0]||I[1]!=F[1]?setTimeout(function(){G.moveOneTick(F)},this.tickPause):(this.unlock(),this._mouseDown||this.endMove())):(this.unlock(),this._mouseDown||this.endMove())},_getNextX:function(E,F){var J,H=this.thumb,G=[],I=null;return E[0]>F[0]?(J=H.tickSize-this.thumbCenterPoint.x,I=[(G=H.getTargetCoord(E[0]-J,E[1])).x,G.y]):E[0]<F[0]&&(J=H.tickSize+this.thumbCenterPoint.x,I=[(G=H.getTargetCoord(E[0]+J,E[1])).x,G.y]),I},_getNextY:function(E,F){var J,H=this.thumb,G=[],I=null;return E[1]>F[1]?(J=H.tickSize-this.thumbCenterPoint.y,I=[(G=H.getTargetCoord(E[0],E[1]-J)).x,G.y]):E[1]<F[1]&&(J=H.tickSize+this.thumbCenterPoint.y,I=[(G=H.getTargetCoord(E[0],E[1]+J)).x,G.y]),I},b4MouseDown:function(E){if(!this.backgroundEnabled)return!1;this.thumb.autoOffset(),this.baselinePos=[]},onMouseDown:function(F){if(!this.backgroundEnabled||this.isLocked())return!1;this._mouseDown=!0;var E=A.getPageX(F),G=A.getPageY(F);this.focus(),this._slideStart(),this.moveThumb(E,G)},onDrag:function(F){if(this.backgroundEnabled&&!this.isLocked()){var E=A.getPageX(F),G=A.getPageY(F);this.moveThumb(E,G,!0,!0),this.fireEvents()}},endMove:function(){this.unlock(),this.fireEvents(),this._slideEnd()},resetThumbConstraints:function(){var E=this.thumb;E.setXConstraint(E.leftConstraint,E.rightConstraint,E.xTickSize),E.setYConstraint(E.topConstraint,E.bottomConstraint,E.xTickSize)},fireEvents:function(G){var I,H,E,F=this.thumb;G||F.cachePosition(),this.isLocked()||(F._isRegion?(I=F.getXValue(),H=F.getYValue(),I==this.previousX&&H==this.previousY||this._silent||(this.onChange(I,H),this.fireEvent("change",{x:I,y:H})),this.previousX=I,this.previousY=H):((E=F.getValue())!=this.previousVal&&(this._silent||(this.onChange(E),this.fireEvent("change",E))),this.previousVal=E))},toString:function(){return"Slider ("+this.type+") "+this.id}}),YAHOO.lang.augmentProto(C,YAHOO.util.EventProvider),YAHOO.widget.Slider=C}(),YAHOO.widget.SliderThumb=function(G,B,E,D,A,F,C){G&&(YAHOO.widget.SliderThumb.superclass.constructor.call(this,G,B),this.parentElId=B),this.isTarget=!1,this.tickSize=C,this.maintainOffset=!0,this.initSlider(E,D,A,F,C),this.scroll=!1},YAHOO.extend(YAHOO.widget.SliderThumb,YAHOO.util.DD,{startOffset:null,dragOnly:!0,_isHoriz:!1,_prevVal:0,_graduated:!1,getOffsetFromParent0:function(C){var A=YAHOO.util.Dom.getXY(this.getEl()),B=C||YAHOO.util.Dom.getXY(this.parentElId);return[A[0]-B[0],A[1]-B[1]]},getOffsetFromParent:function(H){var E,I,F,B,K,D,C,J,G,A=this.getEl();return this.deltaOffset?(J=parseInt(YAHOO.util.Dom.getStyle(A,"left"),10),G=parseInt(YAHOO.util.Dom.getStyle(A,"top"),10),E=[J+this.deltaOffset[0],G+this.deltaOffset[1]]):(I=YAHOO.util.Dom.getXY(A),F=H||YAHOO.util.Dom.getXY(this.parentElId),E=[I[0]-F[0],I[1]-F[1]],B=parseInt(YAHOO.util.Dom.getStyle(A,"left"),10),K=parseInt(YAHOO.util.Dom.getStyle(A,"top"),10),D=B-E[0],C=K-E[1],isNaN(D)||isNaN(C)||(this.deltaOffset=[D,C])),E},initSlider:function(D,C,A,E,B){this.initLeft=D,this.initRight=C,this.initUp=A,this.initDown=E,this.setXConstraint(D,C,B),this.setYConstraint(A,E,B),B&&B>1&&(this._graduated=!0),this._isHoriz=D||C,this._isVert=A||E,this._isRegion=this._isHoriz&&this._isVert},clearTicks:function(){YAHOO.widget.SliderThumb.superclass.clearTicks.call(this),this.tickSize=0,this._graduated=!1},getValue:function(){return this._isHoriz?this.getXValue():this.getYValue()},getXValue:function(){if(!this.available)return 0;var A=this.getOffsetFromParent();return YAHOO.lang.isNumber(A[0])?(this.lastOffset=A,A[0]-this.startOffset[0]):this.lastOffset[0]-this.startOffset[0]},getYValue:function(){if(!this.available)return 0;var A=this.getOffsetFromParent();return YAHOO.lang.isNumber(A[1])?(this.lastOffset=A,A[1]-this.startOffset[1]):this.lastOffset[1]-this.startOffset[1]},toString:function(){return"SliderThumb "+this.id},onChange:function(A,B){}}),function(){function C(I,F,H,D){var E,K,G=this,J={min:!1,max:!1};this.minSlider=I,this.maxSlider=F,this.activeSlider=I,this.isHoriz=I.thumb._isHoriz,E=this.minSlider.thumb.onMouseDown,K=this.maxSlider.thumb.onMouseDown,this.minSlider.thumb.onMouseDown=function(){G.activeSlider=G.minSlider,E.apply(this,arguments)},this.maxSlider.thumb.onMouseDown=function(){G.activeSlider=G.maxSlider,K.apply(this,arguments)},this.minSlider.thumb.onAvailable=function(){I.setStartSliderState(),J.min=!0,J.max&&G.fireEvent("ready",G)},this.maxSlider.thumb.onAvailable=function(){F.setStartSliderState(),J.max=!0,J.min&&G.fireEvent("ready",G)},I.onMouseDown=F.onMouseDown=function(L){return this.backgroundEnabled&&G._handleMouseDown(L)},I.onDrag=F.onDrag=function(L){G._handleDrag(L)},I.onMouseUp=F.onMouseUp=function(L){G._handleMouseUp(L)},I._bindKeyEvents=function(){G._bindKeyEvents(this)},F._bindKeyEvents=function(){},I.subscribe("change",this._handleMinChange,I,this),I.subscribe("slideStart",this._handleSlideStart,I,this),I.subscribe("slideEnd",this._handleSlideEnd,I,this),F.subscribe("change",this._handleMaxChange,F,this),F.subscribe("slideStart",this._handleSlideStart,F,this),F.subscribe("slideEnd",this._handleSlideEnd,F,this),this.createEvent("ready",this),this.createEvent("change",this),this.createEvent("slideStart",this),this.createEvent("slideEnd",this),(D=YAHOO.lang.isArray(D)?D:[0,H])[0]=Math.min(Math.max(0|parseInt(D[0],10),0),H),D[1]=Math.max(Math.min(0|parseInt(D[1],10),H),0),D[0]>D[1]&&D.splice(0,2,D[1],D[0]),this.minVal=D[0],this.maxVal=D[1],this.minSlider.setValue(this.minVal,!0,!0,!0),this.maxSlider.setValue(this.maxVal,!0,!0,!0)}var A=YAHOO.util.Event,B=YAHOO.widget;C.prototype={minVal:-1,maxVal:-1,minRange:0,_handleSlideStart:function(E,D){this.fireEvent("slideStart",D)},_handleSlideEnd:function(E,D){this.fireEvent("slideEnd",D)},_handleDrag:function(D){B.Slider.prototype.onDrag.call(this.activeSlider,D)},_handleMinChange:function(){this.activeSlider=this.minSlider,this.updateValue()},_handleMaxChange:function(){this.activeSlider=this.maxSlider,this.updateValue()},_bindKeyEvents:function(D){A.on(D.id,"keydown",this._handleKeyDown,this,!0),A.on(D.id,"keypress",this._handleKeyPress,this,!0)},_handleKeyDown:function(D){this.activeSlider.handleKeyDown.apply(this.activeSlider,arguments)},_handleKeyPress:function(D){this.activeSlider.handleKeyPress.apply(this.activeSlider,arguments)},setValues:function(H,K,I,E,J){var F=this.minSlider,M=this.maxSlider,D=F.thumb,L=M.thumb,N=this,G={min:!1,max:!1};D._isHoriz?(D.setXConstraint(D.leftConstraint,L.rightConstraint,D.tickSize),L.setXConstraint(D.leftConstraint,L.rightConstraint,L.tickSize)):(D.setYConstraint(D.topConstraint,L.bottomConstraint,D.tickSize),L.setYConstraint(D.topConstraint,L.bottomConstraint,L.tickSize)),this._oneTimeCallback(F,"slideEnd",function(){G.min=!0,G.max&&(N.updateValue(J),setTimeout(function(){N._cleanEvent(F,"slideEnd"),N._cleanEvent(M,"slideEnd")},0))}),this._oneTimeCallback(M,"slideEnd",function(){G.max=!0,G.min&&(N.updateValue(J),setTimeout(function(){N._cleanEvent(F,"slideEnd"),N._cleanEvent(M,"slideEnd")},0))}),F.setValue(H,I,E,!1),M.setValue(K,I,E,!1)},setMinValue:function(F,H,I,E){var G=this.minSlider,D=this;this.activeSlider=G,D=this,this._oneTimeCallback(G,"slideEnd",function(){D.updateValue(E),setTimeout(function(){D._cleanEvent(G,"slideEnd")},0)}),G.setValue(F,H,I)},setMaxValue:function(D,H,I,F){var G=this.maxSlider,E=this;this.activeSlider=G,this._oneTimeCallback(G,"slideEnd",function(){E.updateValue(F),setTimeout(function(){E._cleanEvent(G,"slideEnd")},0)}),G.setValue(D,H,I)},updateValue:function(J){var D,M,H,I,L,G,E=this.minSlider.getValue(),K=this.maxSlider.getValue(),F=!1;E==this.minVal&&K==this.maxVal||(F=!0,D=this.minSlider.thumb,M=this.maxSlider.thumb,H=this.isHoriz?"x":"y",G=this.minSlider.thumbCenterPoint[H]+this.maxSlider.thumbCenterPoint[H],I=Math.max(K-G-this.minRange,0),L=Math.min(-E-G-this.minRange,0),this.isHoriz?(I=Math.min(I,M.rightConstraint),D.setXConstraint(D.leftConstraint,I,D.tickSize),M.setXConstraint(L,M.rightConstraint,M.tickSize)):(I=Math.min(I,M.bottomConstraint),D.setYConstraint(D.leftConstraint,I,D.tickSize),M.setYConstraint(L,M.bottomConstraint,M.tickSize))),this.minVal=E,this.maxVal=K,F&&!J&&this.fireEvent("change",this)},selectActiveSlider:function(H){var I,E=this.minSlider,D=this.maxSlider,J=E.isLocked()||!E.backgroundEnabled,G=D.isLocked()||!E.backgroundEnabled,F=YAHOO.util.Event;J||G?this.activeSlider=J?D:E:(I=this.isHoriz?F.getPageX(H)-E.thumb.initPageX-E.thumbCenterPoint.x:F.getPageY(H)-E.thumb.initPageY-E.thumbCenterPoint.y,this.activeSlider=2*I>D.getValue()+E.getValue()?D:E)},_handleMouseDown:function(D){return!(D._handled||this.minSlider._sliding||this.maxSlider._sliding)&&(D._handled=!0,this.selectActiveSlider(D),B.Slider.prototype.onMouseDown.call(this.activeSlider,D))},_handleMouseUp:function(D){B.Slider.prototype.onMouseUp.apply(this.activeSlider,arguments)},_oneTimeCallback:function(G,D,F){var E=function(){G.unsubscribe(D,E),F.apply({},arguments)};G.subscribe(D,E)},_cleanEvent:function(K,E){var J,I,D,G,H,F;if(K.__yui_events&&K.events[E]){for(I=K.__yui_events.length;I>=0;--I)if(K.__yui_events[I].type===E){J=K.__yui_events[I];break}if(J){for(F=[],G=0,I=0,D=(H=J.subscribers).length;I<D;++I)H[I]&&(F[G++]=H[I]);J.subscribers=F}}}},YAHOO.lang.augmentProto(C,YAHOO.util.EventProvider),B.Slider.getHorizDualSlider=function(H,J,K,G,F,D){var I=new B.SliderThumb(J,H,0,G,0,0,F),E=new B.SliderThumb(K,H,0,G,0,0,F);return new C(new B.Slider(H,H,I,"horiz"),new B.Slider(H,H,E,"horiz"),G,D)},B.Slider.getVertDualSlider=function(H,J,K,G,F,D){var I=new B.SliderThumb(J,H,0,0,0,G,F),E=new B.SliderThumb(K,H,0,0,0,G,F);return new B.DualSlider(new B.Slider(H,H,I,"vert"),new B.Slider(H,H,E,"vert"),G,D)},YAHOO.widget.DualSlider=C}(),YAHOO.register("slider",YAHOO.widget.Slider,{version:"@VERSION@",build:"@BUILD@"}),function(){var E=YAHOO.util.Dom,A=YAHOO.util.Event,C=YAHOO.lang,B=function(F,D){var G={element:F,attributes:D||{}};B.superclass.constructor.call(this,G.element,G.attributes)};B._instances={},B.getResizeById=function(D){return!!B._instances[D]&&B._instances[D]},YAHOO.extend(B,YAHOO.util.Element,{CSS_RESIZE:"yui-resize",CSS_DRAG:"yui-draggable",CSS_HOVER:"yui-resize-hover",CSS_PROXY:"yui-resize-proxy",CSS_WRAP:"yui-resize-wrap",CSS_KNOB:"yui-resize-knob",CSS_HIDDEN:"yui-resize-hidden",CSS_HANDLE:"yui-resize-handle",CSS_STATUS:"yui-resize-status",CSS_GHOST:"yui-resize-ghost",CSS_RESIZING:"yui-resize-resizing",_resizeEvent:null,dd:null,browser:YAHOO.env.ua,_locked:null,_positioned:null,_dds:null,_wrap:null,_proxy:null,_handles:null,_currentHandle:null,_currentDD:null,_cache:null,_active:null,_createProxy:function(){this.get("proxy")?(this._proxy=document.createElement("div"),this._proxy.className=this.CSS_PROXY,this._proxy.style.height=this.get("element").clientHeight+"px",this._proxy.style.width=this.get("element").clientWidth+"px",this._wrap.parentNode.appendChild(this._proxy)):this.set("animate",!1)},_createWrap:function(){if(this._positioned=!1,!1===this.get("wrap"))switch(this.get("element").tagName.toLowerCase()){case"img":case"textarea":case"input":case"iframe":case"select":this.set("wrap",!0)}if(!0===this.get("wrap")){this._wrap=document.createElement("div"),this._wrap.id=this.get("element").id+"_wrap",this._wrap.className=this.CSS_WRAP,"textarea"==this.get("element").tagName.toLowerCase()&&E.addClass(this._wrap,"yui-resize-textarea"),E.setStyle(this._wrap,"width",this.get("width")+"px"),E.setStyle(this._wrap,"height",this.get("height")+"px"),E.setStyle(this._wrap,"z-index",this.getStyle("z-index")),this.setStyle("z-index",0);var F=E.getStyle(this.get("element"),"position");E.setStyle(this._wrap,"position","static"==F?"relative":F),E.setStyle(this._wrap,"top",E.getStyle(this.get("element"),"top")),E.setStyle(this._wrap,"left",E.getStyle(this.get("element"),"left")),"absolute"==E.getStyle(this.get("element"),"position")&&(this._positioned=!0,E.setStyle(this.get("element"),"position","relative"),E.setStyle(this.get("element"),"top","0"),E.setStyle(this.get("element"),"left","0")),this.get("element").parentNode.replaceChild(this._wrap,this.get("element")),this._wrap.appendChild(this.get("element"))}else this._wrap=this.get("element"),"absolute"==E.getStyle(this._wrap,"position")&&(this._positioned=!0);this.get("draggable")&&this._setupDragDrop(),this.get("hover")&&E.addClass(this._wrap,this.CSS_HOVER),this.get("knobHandles")&&E.addClass(this._wrap,this.CSS_KNOB),this.get("hiddenHandles")&&E.addClass(this._wrap,this.CSS_HIDDEN),E.addClass(this._wrap,this.CSS_RESIZE)},_setupDragDrop:function(){E.addClass(this._wrap,this.CSS_DRAG),this.dd=new YAHOO.util.DD(this._wrap,this.get("id")+"-resize",{dragOnly:!0,useShim:this.get("useShim")}),this.dd.on("dragEvent",function(){this.fireEvent("dragEvent",arguments)},this,!0)},_createHandles:function(){this._handles={},this._dds={};for(var G=this.get("handles"),F=0;F<G.length;F++){this._handles[G[F]]=document.createElement("div"),this._handles[G[F]].id=E.generateId(this._handles[G[F]]),this._handles[G[F]].className=this.CSS_HANDLE+" "+this.CSS_HANDLE+"-"+G[F];var D=document.createElement("div");D.className=this.CSS_HANDLE+"-inner-"+G[F],this._handles[G[F]].appendChild(D),this._wrap.appendChild(this._handles[G[F]]),A.on(this._handles[G[F]],"mouseover",this._handleMouseOver,this,!0),A.on(this._handles[G[F]],"mouseout",this._handleMouseOut,this,!0),this._dds[G[F]]=new YAHOO.util.DragDrop(this._handles[G[F]],this.get("id")+"-handle-"+G,{useShim:this.get("useShim")}),this._dds[G[F]].setPadding(15,15,15,15),this._dds[G[F]].on("startDragEvent",this._handleStartDrag,this._dds[G[F]],this),this._dds[G[F]].on("mouseDownEvent",this._handleMouseDown,this._dds[G[F]],this)}this._status=document.createElement("span"),this._status.className=this.CSS_STATUS,document.body.insertBefore(this._status,document.body.firstChild)},_ieSelectFix:function(){return!1},_ieSelectBack:null,_setAutoRatio:function(D){this.get("autoRatio")&&(D&&D.shiftKey?this.set("ratio",!0):this.set("ratio",this._configs.ratio._initialConfig.value))},_handleMouseDown:function(D){if(this._locked)return!1;"absolute"==E.getStyle(this._wrap,"position")&&(this._positioned=!0),D&&this._setAutoRatio(D),this.browser.ie&&(this._ieSelectBack=document.body.onselectstart,document.body.onselectstart=this._ieSelectFix)},_handleMouseOver:function(G){if(this._locked)return!1;E.removeClass(this._wrap,this.CSS_RESIZE),this.get("hover")&&E.removeClass(this._wrap,this.CSS_HOVER);var D=A.getTarget(G);if(E.hasClass(D,this.CSS_HANDLE)||(D=D.parentNode),E.hasClass(D,this.CSS_HANDLE)&&!this._active){E.addClass(D,this.CSS_HANDLE+"-active");for(var F in this._handles)if(C.hasOwnProperty(this._handles,F)&&this._handles[F]==D){E.addClass(D,this.CSS_HANDLE+"-"+F+"-active");break}}E.addClass(this._wrap,this.CSS_RESIZE)},_handleMouseOut:function(G){E.removeClass(this._wrap,this.CSS_RESIZE),this.get("hover")&&!this._active&&E.addClass(this._wrap,this.CSS_HOVER);var D=A.getTarget(G);if(E.hasClass(D,this.CSS_HANDLE)||(D=D.parentNode),E.hasClass(D,this.CSS_HANDLE)&&!this._active){E.removeClass(D,this.CSS_HANDLE+"-active");for(var F in this._handles)if(C.hasOwnProperty(this._handles,F)&&this._handles[F]==D){E.removeClass(D,this.CSS_HANDLE+"-"+F+"-active");break}}E.addClass(this._wrap,this.CSS_RESIZE)},_handleStartDrag:function(G,F){var D=F.getDragEl();if(E.hasClass(D,this.CSS_HANDLE)){"absolute"==E.getStyle(this._wrap,"position")&&(this._positioned=!0),this._active=!0,this._currentDD=F,this._proxy&&(this._proxy.style.visibility="visible",this._proxy.style.zIndex="1000",this._proxy.style.height=this.get("element").clientHeight+"px",this._proxy.style.width=this.get("element").clientWidth+"px");for(var H in this._handles)if(C.hasOwnProperty(this._handles,H)&&this._handles[H]==D){this._currentHandle=H;var I="_handle_for_"+H;E.addClass(D,this.CSS_HANDLE+"-"+H+"-active"),F.on("dragEvent",this[I],this,!0),F.on("mouseUpEvent",this._handleMouseUp,this,!0);break}if(E.addClass(D,this.CSS_HANDLE+"-active"),this.get("proxy")){var J=E.getXY(this.get("element"));E.setXY(this._proxy,J),this.get("ghost")&&this.addClass(this.CSS_GHOST)}E.addClass(this._wrap,this.CSS_RESIZING),this._setCache(),this._updateStatus(this._cache.height,this._cache.width,this._cache.top,this._cache.left),this.fireEvent("startResize",{type:"startresize",target:this})}},_setCache:function(){this._cache.xy=E.getXY(this._wrap),E.setXY(this._wrap,this._cache.xy),this._cache.height=this.get("clientHeight"),this._cache.width=this.get("clientWidth"),this._cache.start.height=this._cache.height,this._cache.start.width=this._cache.width,this._cache.start.top=this._cache.xy[1],this._cache.start.left=this._cache.xy[0],this._cache.top=this._cache.xy[1],this._cache.left=this._cache.xy[0],this.set("height",this._cache.height,!0),this.set("width",this._cache.width,!0)},_handleMouseUp:function(F){this._active=!1;var G="_handle_for_"+this._currentHandle;this._currentDD.unsubscribe("dragEvent",this[G],this,!0),this._currentDD.unsubscribe("mouseUpEvent",this._handleMouseUp,this,!0),this._proxy&&(this._proxy.style.visibility="hidden",this._proxy.style.zIndex="-1",this.get("setSize")?this.resize(F,this._cache.height,this._cache.width,this._cache.top,this._cache.left,!0):this.fireEvent("resize",{ev:"resize",target:this,height:this._cache.height,width:this._cache.width,top:this._cache.top,left:this._cache.left}),this.get("ghost")&&this.removeClass(this.CSS_GHOST)),this.get("hover")&&E.addClass(this._wrap,this.CSS_HOVER),this._status&&E.setStyle(this._status,"display","none"),this.browser.ie&&(document.body.onselectstart=this._ieSelectBack),this.browser.ie&&E.removeClass(this._wrap,this.CSS_RESIZE);for(var D in this._handles)C.hasOwnProperty(this._handles,D)&&E.removeClass(this._handles[D],this.CSS_HANDLE+"-active");this.get("hover")&&!this._active&&E.addClass(this._wrap,this.CSS_HOVER),E.removeClass(this._wrap,this.CSS_RESIZING),E.removeClass(this._handles[this._currentHandle],this.CSS_HANDLE+"-"+this._currentHandle+"-active"),E.removeClass(this._handles[this._currentHandle],this.CSS_HANDLE+"-active"),this.browser.ie&&E.addClass(this._wrap,this.CSS_RESIZE),this._resizeEvent=null,this._currentHandle=null,this.get("animate")||(this.set("height",this._cache.height,!0),this.set("width",this._cache.width,!0)),this.fireEvent("endResize",{ev:"endResize",target:this,height:this._cache.height,width:this._cache.width,top:this._cache.top,left:this._cache.left})},_setRatio:function(K,N,Q,I){var O=K,G=N;if(this.get("ratio")){this._cache.height,this._cache.width;var F=parseInt(this.get("height"),10),L=parseInt(this.get("width"),10),M=this.get("maxHeight"),R=this.get("minHeight");this.get("maxWidth"),this.get("minWidth");switch(this._currentHandle){case"l":K=F*(N/L),N=L*((K=Math.min(Math.max(R,K),M))/F),Q=this._cache.start.top- -(F-K)/2,I=this._cache.start.left- -(L-N);break;case"r":K=F*(N/L),N=L*((K=Math.min(Math.max(R,K),M))/F),Q=this._cache.start.top- -(F-K)/2;break;case"t":K=F*((N=L*(K/F))/L),I=this._cache.start.left- -(L-N)/2,Q=this._cache.start.top- -(F-K);break;case"b":K=F*((N=L*(K/F))/L),I=this._cache.start.left- -(L-N)/2;break;case"bl":N=L*((K=F*(N/L))/F),I=this._cache.start.left- -(L-N);break;case"br":N=L*((K=F*(N/L))/F);break;case"tl":N=L*((K=F*(N/L))/F),I=this._cache.start.left- -(L-N),Q=this._cache.start.top- -(F-K);break;case"tr":N=L*((K=F*(N/L))/F),I=this._cache.start.left,Q=this._cache.start.top- -(F-K)}O=this._checkHeight(K),G=this._checkWidth(N),O==K&&G==N||(Q=0,I=0,O!=K&&(G=this._cache.width),G!=N&&(O=this._cache.height))}return[O,G,Q,I]},_updateStatus:function(K,G,J,F){if(this._resizeEvent&&!C.isString(this._resizeEvent)){K=0===K?this._cache.start.height:K,G=0===G?this._cache.start.width:G;var I=parseInt(this.get("height"),10),D=parseInt(this.get("width"),10);isNaN(I)&&(I=parseInt(K,10)),isNaN(D)&&(D=parseInt(G,10));var L=parseInt(K,10)-I,H=parseInt(G,10)-D;this._cache.offsetHeight=L,this._cache.offsetWidth=H,this.get("status")&&(E.setStyle(this._status,"display","inline"),this._status.innerHTML="<strong>"+parseInt(K,10)+" x "+parseInt(G,10)+"</strong><em>"+(L>0?"+":"")+L+" x "+(H>0?"+":"")+H+"</em>",E.setXY(this._status,[A.getPageX(this._resizeEvent)+12,A.getPageY(this._resizeEvent)+12]))}},lock:function(D){return this._locked=!0,D&&this.dd&&(E.removeClass(this._wrap,"yui-draggable"),this.dd.lock()),this},unlock:function(D){return this._locked=!1,D&&this.dd&&(E.addClass(this._wrap,"yui-draggable"),this.dd.unlock()),this},isLocked:function(){return this._locked},reset:function(){return this.resize(null,this._cache.start.height,this._cache.start.width,this._cache.start.top,this._cache.start.left,!0),this},resize:function(M,J,P,Q,H,F,K){if(this._locked)return!1;this._resizeEvent=M;var G=this._wrap,I=this.get("animate"),O=!0;this._proxy&&!F&&(G=this._proxy,I=!1),this._setAutoRatio(M),this._positioned&&this._proxy&&(Q=this._cache.top-Q,H=this._cache.left-H);var L=this._setRatio(J,P,Q,H);if(J=parseInt(L[0],10),P=parseInt(L[1],10),Q=parseInt(L[2],10),H=parseInt(L[3],10),0==Q&&(Q=E.getY(G)),0==H&&(H=E.getX(G)),this._positioned&&(this._proxy&&F?I?(Q=this._proxy.style.top,H=this._proxy.style.left):(G.style.top=this._proxy.style.top,G.style.left=this._proxy.style.left):(this.get("ratio")||this._proxy||(Q=this._cache.top+-Q,H=this._cache.left+-H),Q&&(this.get("minY")&&Q<this.get("minY")&&(Q=this.get("minY")),this.get("maxY")&&Q>this.get("maxY")&&(Q=this.get("maxY"))),H&&(this.get("minX")&&H<this.get("minX")&&(H=this.get("minX")),this.get("maxX")&&H+P>this.get("maxX")&&(H=this.get("maxX")-P)))),!K&&!1===this.fireEvent("beforeResize",{ev:"beforeResize",target:this,height:J,width:P,top:Q,left:H}))return!1;if(this._updateStatus(J,P,Q,H),this._positioned&&(this._proxy&&F||(Q&&(E.setY(G,Q),this._cache.top=Q),H&&(E.setX(G,H),this._cache.left=H))),J&&(I||(O=!0,this._proxy&&F&&(this.get("setSize")||(O=!1)),O&&(G.style.height=J+"px"),(this._proxy&&F||!this._proxy)&&this._wrap!=this.get("element")&&(this.get("element").style.height=J+"px")),this._cache.height=J),P&&(this._cache.width=P,I||(O=!0,this._proxy&&F&&(this.get("setSize")||(O=!1)),O&&(G.style.width=P+"px"),(this._proxy&&F||!this._proxy)&&this._wrap!=this.get("element")&&(this.get("element").style.width=P+"px"))),I){if(YAHOO.util.Anim){var D=new YAHOO.util.Anim(G,{height:{to:this._cache.height},width:{to:this._cache.width}},this.get("animateDuration"),this.get("animateEasing"));this._positioned&&(Q&&(D.attributes.top={to:parseInt(Q,10)}),H&&(D.attributes.left={to:parseInt(H,10)})),this._wrap!=this.get("element")&&D.onTween.subscribe(function(){this.get("element").style.height=G.style.height,this.get("element").style.width=G.style.width},this,!0),D.onComplete.subscribe(function(){this.set("height",J),this.set("width",P),this.fireEvent("resize",{ev:"resize",target:this,height:J,width:P,top:Q,left:H})},this,!0),D.animate()}}else this._proxy&&!F?this.fireEvent("proxyResize",{ev:"proxyresize",target:this,height:J,width:P,top:Q,left:H}):this.fireEvent("resize",{ev:"resize",target:this,height:J,width:P,top:Q,left:H});return this},_handle_for_br:function(F){var G=this._setWidth(F.e),D=this._setHeight(F.e);this.resize(F.e,D,G,0,0)},_handle_for_bl:function(G){var H=this._setWidth(G.e,!0),F=this._setHeight(G.e),D=H-this._cache.width;this.resize(G.e,F,H,0,D)},_handle_for_tl:function(G){var I=this._setWidth(G.e,!0),F=this._setHeight(G.e,!0),H=F-this._cache.height,D=I-this._cache.width;this.resize(G.e,F,I,H,D)},_handle_for_tr:function(F){var H=this._setWidth(F.e),D=this._setHeight(F.e,!0),G=D-this._cache.height;this.resize(F.e,D,H,G,0)},_handle_for_r:function(D){this._dds.r.setYConstraint(0,0);var F=this._setWidth(D.e);this.resize(D.e,0,F,0,0)},_handle_for_l:function(F){this._dds.l.setYConstraint(0,0);var G=this._setWidth(F.e,!0),D=G-this._cache.width;this.resize(F.e,0,G,0,D)},_handle_for_b:function(F){this._dds.b.setXConstraint(0,0);var D=this._setHeight(F.e);this.resize(F.e,D,0,0,0)},_handle_for_t:function(F){this._dds.t.setXConstraint(0,0);var D=this._setHeight(F.e,!0),G=D-this._cache.height;this.resize(F.e,D,0,G,0)},_setWidth:function(H,J){var I=this._cache.xy[0],D=(this._cache.width,A.getPageX(H)),F=D-I;return J&&(F=I-D+parseInt(this.get("width"),10)),F=this._snapTick(F,this.get("xTicks")),F=this._checkWidth(F)},_checkWidth:function(D){return this.get("minWidth")&&D<=this.get("minWidth")&&(D=this.get("minWidth")),this.get("maxWidth")&&D>=this.get("maxWidth")&&(D=this.get("maxWidth")),D},_checkHeight:function(D){return this.get("minHeight")&&D<=this.get("minHeight")&&(D=this.get("minHeight")),this.get("maxHeight")&&D>=this.get("maxHeight")&&(D=this.get("maxHeight")),D},_setHeight:function(G,I){var H=this._cache.xy[1],J=(this._cache.height,A.getPageY(G)),D=J-H;return I&&(D=H-J+parseInt(this.get("height"),10)),D=this._snapTick(D,this.get("yTicks")),D=this._checkHeight(D)},_snapTick:function(G,F){if(!G||!F)return G;var H=G,D=G%F;return D>0&&(H=D>F/2?G+(F-D):G-D),H},init:function(H,F){this._locked=!1,this._cache={xy:[],height:0,width:0,top:0,left:0,offsetHeight:0,offsetWidth:0,start:{height:0,width:0,top:0,left:0}},B.superclass.init.call(this,H,F),this.set("setSize",this.get("setSize")),F.height?this.set("height",parseInt(F.height,10)):"auto"==this.getStyle("height")&&this.set("height",parseInt(this.get("element").offsetHeight,10)),F.width?this.set("width",parseInt(F.width,10)):"auto"==this.getStyle("width")&&this.set("width",parseInt(this.get("element").offsetWidth,10));var I=H;C.isString(I)||(I=E.generateId(I)),B._instances[I]=this,this._active=!1,this._createWrap(),this._createProxy(),this._createHandles()},getProxyEl:function(){return this._proxy},getWrapEl:function(){return this._wrap},getStatusEl:function(){return this._status},getActiveHandleEl:function(){return this._handles[this._currentHandle]},isActive:function(){return!!this._active},initAttributes:function(D){B.superclass.initAttributes.call(this,D),this.setAttributeConfig("useShim",{value:!0===D.useShim,validator:YAHOO.lang.isBoolean,method:function(F){for(var G in this._dds)C.hasOwnProperty(this._dds,G)&&(this._dds[G].useShim=F);this.dd&&(this.dd.useShim=F)}}),this.setAttributeConfig("setSize",{value:!1!==D.setSize,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("wrap",{writeOnce:!0,validator:YAHOO.lang.isBoolean,value:D.wrap||!1}),this.setAttributeConfig("handles",{writeOnce:!0,value:D.handles||["r","b","br"],validator:function(F){C.isString(F)&&"all"==F.toLowerCase()&&(F=["t","b","r","l","bl","br","tl","tr"]),C.isArray(F)||(F=(F=F.replace(/, /g,",")).split(",")),this._configs.handles.value=F}}),this.setAttributeConfig("width",{value:D.width||parseInt(this.getStyle("width"),10),validator:YAHOO.lang.isNumber,method:function(F){(F=parseInt(F,10))>0&&(this.get("setSize")&&this.setStyle("width",F+"px"),this._cache.width=F,this._configs.width.value=F)}}),this.setAttributeConfig("height",{value:D.height||parseInt(this.getStyle("height"),10),validator:YAHOO.lang.isNumber,method:function(F){(F=parseInt(F,10))>0&&(this.get("setSize")&&this.setStyle("height",F+"px"),this._cache.height=F,this._configs.height.value=F)}}),this.setAttributeConfig("minWidth",{value:D.minWidth||15,validator:YAHOO.lang.isNumber}),this.setAttributeConfig("minHeight",{value:D.minHeight||15,validator:YAHOO.lang.isNumber}),this.setAttributeConfig("maxWidth",{value:D.maxWidth||1e4,validator:YAHOO.lang.isNumber}),this.setAttributeConfig("maxHeight",{value:D.maxHeight||1e4,validator:YAHOO.lang.isNumber}),this.setAttributeConfig("minY",{value:D.minY||!1}),this.setAttributeConfig("minX",{value:D.minX||!1}),this.setAttributeConfig("maxY",{value:D.maxY||!1}),this.setAttributeConfig("maxX",{value:D.maxX||!1}),this.setAttributeConfig("animate",{value:D.animate||!1,validator:function(G){var F=!0;return YAHOO.util.Anim||(F=!1),F}}),this.setAttributeConfig("animateEasing",{value:D.animateEasing||function(){var F=!1;return YAHOO.util.Easing&&YAHOO.util.Easing.easeOut&&(F=YAHOO.util.Easing.easeOut),F}()}),this.setAttributeConfig("animateDuration",{value:D.animateDuration||.5}),this.setAttributeConfig("proxy",{value:D.proxy||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("ratio",{value:D.ratio||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("ghost",{value:D.ghost||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("draggable",{value:D.draggable||!1,validator:YAHOO.lang.isBoolean,method:function(F){F&&this._wrap&&!this.dd?this._setupDragDrop():this.dd&&(F?(E.addClass(this._wrap,this.CSS_DRAG),this.dd.DDM.regDragDrop(this.dd,"default")):(E.removeClass(this._wrap,this.CSS_DRAG),this.dd.unreg()))}}),this.setAttributeConfig("hover",{value:D.hover||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("hiddenHandles",{value:D.hiddenHandles||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("knobHandles",{value:D.knobHandles||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("xTicks",{value:D.xTicks||!1}),this.setAttributeConfig("yTicks",{value:D.yTicks||!1}),this.setAttributeConfig("status",{value:D.status||!1,validator:YAHOO.lang.isBoolean}),this.setAttributeConfig("autoRatio",{value:D.autoRatio||!1,validator:YAHOO.lang.isBoolean})},destroy:function(){for(var F in this._handles)C.hasOwnProperty(this._handles,F)&&(A.purgeElement(this._handles[F]),this._handles[F].parentNode.removeChild(this._handles[F]));this._proxy&&this._proxy.parentNode.removeChild(this._proxy),this._status&&this._status.parentNode.removeChild(this._status),this.dd&&(this.dd.unreg(),E.removeClass(this._wrap,this.CSS_DRAG)),this._wrap!=this.get("element")&&(this.setStyle("position",this._positioned?"absolute":"relative"),this.setStyle("top",E.getStyle(this._wrap,"top")),this.setStyle("left",E.getStyle(this._wrap,"left")),this._wrap.parentNode.replaceChild(this.get("element"),this._wrap)),this.removeClass(this.CSS_RESIZE),delete YAHOO.util.Resize._instances[this.get("id")];for(var D in this)C.hasOwnProperty(this,D)&&(this[D]=null,delete this[D])},toString:function(){return this.get?"Resize (#"+this.get("id")+")":"Resize Utility"}}),YAHOO.util.Resize=B}(),YAHOO.register("resize",YAHOO.util.Resize,{version:"2.9.0",build:"2800"}),function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function r(a){var b=a.length,c=m.type(a);return"function"!==c&&!m.isWindow(a)&&(!(1!==a.nodeType||!b)||("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a))}function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}function D(a,b){do{a=a[b]}while(a&&1!==a.nodeType);return a}function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if("string"==typeof(c=a.getAttribute(d))){try{c="true"===c||"false"!==c&&("null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c)}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?null==(f=g[b])&&(f=g[m.camelCase(b)]):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}function ab(){return!0}function bb(){return!1}function cb(){try{return y.activeElement}catch(a){}}function db(a){var b=eb.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function ub(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ub(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function vb(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wb(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xb(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function yb(a){var b=pb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function zb(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Ab(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Bb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xb(b).text=a.text,yb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function Eb(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fb(a){var b=y,c=Db[a];return c||("none"!==(c=Eb(a,b))&&c||(Cb=(Cb||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),(b=(Cb[0].contentWindow||Cb[0].contentDocument).document).write(),b.close(),c=Eb(a,b),Cb.detach()),Db[a]=c),c}function Lb(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}function Ub(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Tb.length;e--;)if((b=Tb[e]+c)in a)return b;return d}function Vb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)(d=a[g]).style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fb(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)(d=a[g]).style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wb(a,b,c){var d=Pb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Yb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ib(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if((0>(e=Jb(a,b,f))||null==e)&&(e=a.style[b]),Hb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xb(a,b,c||(g?"border":"content"),d,f)+"px"}function Zb(a,b,c,d,e){return new Zb.prototype.init(a,b,c,d,e)}function fc(){return setTimeout(function(){$b=void 0}),$b=m.now()}function gc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hc(a,b,c){for(var d,e=(ec[b]||[]).concat(ec["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function jc(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=m.cssHooks[d])&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kc(a,b,c){var d,e,f=0,g=dc.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$b||fc(),c=Math.max(0,j.startTime+j.duration-b),f=1-(c/j.duration||0),g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$b||fc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jc(k,j.opts.specialEasing);g>f;f++)if(d=dc[f].call(j,a,k,j.opts))return d;return m.map(k,hc,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function Lc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))for(;d=f[e++];)"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mc(a,b,c,d){function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}var e={},f=a===Ic;return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nc(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Oc(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(!(g=j[i+" "+f]||j["* "+f]))for(e in j)if((h=e.split(" "))[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a.throws)b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function Vc(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rc.test(a)?d(a,e):Vc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vc(a+"["+e+"]",b[e],c,d)}function Zc(){try{return new a.XMLHttpRequest}catch(b){}}function $c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function dd(a){return m.isWindow(a)?a:9===a.nodeType&&(a.defaultView||a.parentWindow)}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.1",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var e=0,f=a.length,g=r(a);if(c){if(g)for(;f>e&&!1!==b.apply(a[e],c);e++);else for(e in a)if(!1===b.apply(a[e],c))break}else if(g)for(;f>e&&!1!==b.call(a[e],e,a[e]);e++);else for(e in a)if(!1===b.call(a[e],e,a[e]))break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if(c!==c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var e=[],f=0,g=a.length,h=!c;g>f;f++)!b(a[f],f)!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,i=[];if(r(a))for(;g>f;f++)null!=(d=b(a[f],f,c))&&i.push(d);else for(f in a)null!=(d=b(a[f],f,c))&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});var s=function(a){function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(p&&!e){if(f=_.exec(a))if(j=f[1]){if(9===k){if(!(h=b.getElementById(j))||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return I.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return I.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){for(o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;l--;)o[l]=s+qb(o[l]);w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x)try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}var a=[];return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){for(var c=a.split("|"),e=a.length;e--;)d.attrHandle[c[e]]=b}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}function pb(){}function qb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function sb(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++)fb(a,b[d],c);return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=ub(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++)if(c=d.relative[a[i].type])m=[rb(sb(m),c)];else{if((c=d.filter[a[i].type].apply(null,a[i].matches))[u]){for(e=++i;f>e&&!d.relative[a[e].type];e++);return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){for(m=0;o=a[m++];)if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){for(m=0;o=b[m++];)o(r,s,g,h);if(f){if(p>0)for(;q--;)r[q]||s[q]||(s[q]=G.call(i));s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d||(1&(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0;if(f===g)return kb(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)i.unshift(c);for(;h[d]===i[d];)d++;return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){for(;b=a[f++];)b===a[f]&&(e=d.push(f));for(;e--;)a.splice(d[e],1)}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else for(;b=a[d++];)c+=e(b);return c},(d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(n=(j=(k=q[u]||(q[u]={}))[a]||[])[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[u]||(l[u]={}))[a]=[w,m]),l!==b)););return(m-=e)===d||m%d==0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return(c=c.toLowerCase())===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}}).pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=function(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}(b);return pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=d.preFilter;h;){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fb.error(a):z(a,i).slice(0)},h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){for(b||(b=g(a)),c=b.length;c--;)(f=wb(b[c]))[u]?d.push(f):e.push(f);(f=A(a,xb(e,d))).selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if((j=o[0]=o[0].slice(0)).length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(!(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0]))return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}for(i=X.needsContext.test(a)?0:j.length;i--&&(k=j[i],!d.relative[l=k.type]);)if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),!(a=f.length&&qb(j)))return I.apply(e,f),e;break}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(!(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a))||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if((d=y.getElementById(c[2]))&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?void 0!==x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))}).prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){for(var d=[],e=a[b];e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c));)1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};m.Callbacks=function(a){var b,c,d,e,f,g,h=[],i=!(a="string"==typeof a?F[a]||G(a):m.extend({},a)).once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(!1===h[f].apply(l[0],l[1])&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){for(var d;(d=m.inArray(c,h,d))>-1;)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var i,j,k,b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}};if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(!0===a?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,!0!==a&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}}),m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var L,K="undefined";for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;(c=y.getElementsByTagName("body")[0])&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return(1===c||9===c)&&(!b||!0!==b&&a.getAttribute("classid")===b)};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return!!(a=a.nodeType?m.cache[a[m.expando]]:a[m.expando])&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){for(c=g.length;c--;)g[c]&&0===(d=g[c].name).indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d]));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b);"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,function(){m.dequeue(a,b)},f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)(c=m._data(f[g],a+"queueHooks"))&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=!1===d.attributes[c].expando);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){for(c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),h=(b=(b||"").match(E)||[""]).length;h--;)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&!1!==j.setup.call(a,d,p,k)||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){for(j=(b=(b||"").match(E)||[""]).length;j--;)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){for(l=m.event.special[o]||{},n=k[o=(d?l.delegateType:l.bindType)||o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;f--;)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&!1!==l.teardown.call(a,p,r.handle)||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||!1!==k.trigger.apply(d,c))){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}for(n=0;(h=o[n++])&&!b.isPropagationStopped();)b.type=n>1?i:k.bindType||p,(f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"))&&f.apply(h,c),(f=g&&h[g])&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),!1===b.result&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||!1===k._default.apply(o.pop(),c))&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){(l=d[g])&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,a)){for(h=m.event.handlers.call(this,a,j),b=0;(f=h[b++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,g=0;(e=f.handlers[g++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,void 0!==(c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i))&&!1===(a.result=c)&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(!0!==i.disabled||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==cb()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===cb()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?ab:bb):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:bb,isPropagationStopped:bb,isImmediatePropagationStopped:bb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ab,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ab,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ab,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return!m.nodeName(this,"form")&&void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return!m.nodeName(this,"form")&&void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),!1===d)d=bb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(!1===b||"function"==typeof b)&&(c=b,b=void 0),!1===c&&(c=bb),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});var eb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fb=/ jQuery\d+="(?:null|\d+)"/g,gb=new RegExp("<(?:"+eb+")[\\s/>]","i"),hb=/^\s+/,ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,jb=/<([\w:]+)/,kb=/<tbody/i,lb=/<|&#?\w+;/,mb=/<(?:script|style|link)/i,nb=/checked\s*(?:[^=]|=\s*.checked.)/i,ob=/^$|\/(?:java|ecma)script/i,pb=/^true\/(.*)/,qb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,rb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},tb=db(y).appendChild(y.createElement("div"));rb.optgroup=rb.option,rb.tbody=rb.tfoot=rb.colgroup=rb.caption=rb.thead,rb.th=rb.td,m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!gb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(tb.innerHTML=a.outerHTML,tb.removeChild(f=tb.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ub(f),h=ub(a),g=0;null!=(e=h[g]);++g)d[g]&&Bb(e,d[g]);if(b)if(c)for(h=h||ub(a),d=d||ub(f),g=0;null!=(e=h[g]);g++)Ab(e,d[g]);else Ab(a,f);return(d=ub(f,"script")).length>0&&zb(d,!i&&ub(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=db(b),p=[],q=0;n>q;q++)if((f=a[q])||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(lb.test(f)){for(h=h||o.appendChild(b.createElement("div")),i=(jb.exec(f)||["",""])[1].toLowerCase(),l=rb[i]||rb._default,h.innerHTML=l[1]+f.replace(ib,"<$1></$2>")+l[2],e=l[0];e--;)h=h.lastChild;if(!k.leadingWhitespace&&hb.test(f)&&p.push(b.createTextNode(hb.exec(f)[0])),!k.tbody)for(e=(f="table"!==i||kb.test(f)?"<table>"!==l[1]||kb.test(f)?0:h:h.firstChild)&&f.childNodes.length;e--;)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(m.merge(p,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));for(h&&o.removeChild(h),k.appendChecked||m.grep(ub(p,"input"),vb),q=0;f=p[q++];)if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ub(o.appendChild(f),"script"),g&&zb(h),c))for(e=0;f=h[e++];)ob.test(f.type||"")&&c.push(f);return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||wb(this,a).appendChild(a)})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ub(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&zb(ub(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&m.cleanData(ub(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fb,""):void 0;if(!("string"!=typeof a||mb.test(a)||!k.htmlSerialize&&gb.test(a)||!k.leadingWhitespace&&hb.test(a)||rb[(jb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ib,"<$1></$2>");try{for(;d>c;c++)1===(b=this[c]||{}).nodeType&&(m.cleanData(ub(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ub(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&nb.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(f=(g=m.map(ub(i,"script"),xb)).length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ub(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,yb),j=0;f>j;j++)d=g[j],ob.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qb,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Cb,Db={};!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return(c=y.getElementsByTagName("body")[0])&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Ib,Jb,Gb=/^margin/,Hb=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Kb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ib=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Hb.test(g)&&Gb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ib=function(a){return a.currentStyle},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),null==(g=c?c[b]:void 0)&&h&&h[b]&&(g=h[b]),Hb.test(g)&&!Kb.test(b)&&(d=h.left,e=a.runtimeStyle,(f=e&&e.left)&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"}),function(){function i(){var b,c,d,i;(c=y.getElementsByTagName("body")[0])&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",(g=0===i[0].offsetHeight)&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}var b,c,d,e,f,g,h;(b=y.createElement("div")).innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",(c=(d=b.getElementsByTagName("a")[0])&&d.style)&&(c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}}))}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Mb=/alpha\([^)]*\)/i,Nb=/opacity\s*=\s*([^)]*)/,Ob=/^(none|table(?!-c[ea]).+)/,Pb=new RegExp("^("+S+")(.*)$","i"),Qb=new RegExp("^([+-])=("+S+")","i"),Rb={position:"absolute",visibility:"hidden",display:"block"},Sb={letterSpacing:"0",fontWeight:"400"},Tb=["Webkit","O","Moz","ms"];m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Jb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ub(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if("string"===(f=typeof c)&&(e=Qb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ub(a.style,h)),(g=m.cssHooks[b]||m.cssHooks[h])&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Jb(a,b,d)),"normal"===f&&b in Sb&&(f=Sb[b]),""===c||c?(e=parseFloat(f),!0===c||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Ob.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Rb,function(){return Yb(a,b,d)}):Yb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ib(a);return Wb(0,c,d?Xb(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Nb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Mb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Mb.test(f)?f.replace(Mb,e):f+" "+e)}}),m.cssHooks.marginRight=Lb(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Jb,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Gb.test(a)||(m.cssHooks[a+b].set=Wb)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ib(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Vb(this,!0)},hide:function(){return Vb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}}),m.Tween=Zb,Zb.prototype={constructor:Zb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")},cur:function(){var a=Zb.propHooks[this.prop];return a&&a.get?a.get(this):Zb.propHooks._default.get(this)},run:function(a){var b,c=Zb.propHooks[this.prop];return this.pos=b=this.options.duration?m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Zb.propHooks._default.set(this),this}},Zb.prototype.init.prototype=Zb.prototype,Zb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""))&&"auto"!==b?b:0:a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Zb.propHooks.scrollTop=Zb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Zb.prototype.init,m.fx.step={};var $b,_b,ac=/^(?:toggle|show|hide)$/,bc=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cc=/queueHooks$/,dc=[function(a,b,c){var d,e,f,g,h,i,j,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(null==(h=m._queueHooks(a,"fx")).unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===("none"===(j=m.css(a,"display"))?m._data(a,"olddisplay")||Fb(a.nodeName):j)&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fb(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ac.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fb(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hc(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}],ec={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bc.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bc.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do{h=h||".5",g/=h,m.style(c.elem,a,g+f)}while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};m.Animation=m.extend(kc,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ec[c]=ec[c]||[],ec[c].unshift(b)},prefilter:function(a,b){b?dc.unshift(a):dc.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||!0===d.queue)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kc(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gc(b,!0),a,d,e)}}),m.each({slideDown:gc("show"),slideUp:gc("hide"),slideToggle:gc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($b=m.now();c<b.length;c++)(a=b[c])()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$b=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_b||(_b=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_b),_b=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;(b=y.createElement("div")).setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],e=(c=y.createElement("select")).appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,(a=y.createElement("input")).setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lc=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(null==(e=d?a.call(this,c,m(this).val()):a)?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),(b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()])&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:"string"==typeof(c=e.value)?c.replace(lc,""):null==c?"":c:void 0}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(!(!(c=d[i]).selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=m.makeArray(b),g=e.length;g--;)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mc,nc,oc=m.expr.attrHandle,pc=/^(?:checked|selected)$/i,qc=k.getSetAttribute,rc=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nc:mc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:null==(e=m.find.attr(a,b))?void 0:e:null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)for(;c=f[e++];)d=m.propFix[c]||c,m.expr.match.bool.test(c)?rc&&qc||!pc.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qc?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nc={set:function(a,b,c){return!1===b?m.removeAttr(a,c):rc&&qc||!pc.test(c)?a.setAttribute(!qc&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=oc[b]||m.find.attr;oc[b]=rc&&qc||!pc.test(b)?function(a,b,d){var e,f;return d||(f=oc[b],oc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,oc[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rc&&qc||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mc&&mc.set(a,b,c)}}),qc||(mc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},oc.id=oc.name=oc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mc.set},m.attrHooks.contenteditable={set:function(a,b,c){mc.set(a,""!==b&&b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sc=/^(?:input|select|textarea|button|object)$/i,tc=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{for:"htmlFor",class:"className"},prop:function(a,b,c){var d,e,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return(1!==g||!m.isXMLDoc(a))&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sc.test(a.nodeName)||tc.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var uc=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=m(this),f=a.match(E)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||!1===a?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(uc," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vc=m.now(),wc=/\?/,xc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yc,zc,Ac=/#.*$/,Bc=/([?&])_=[^&]*/,Cc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Dc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ec=/^(?:GET|HEAD)$/,Fc=/^\/\//,Gc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hc={},Ic={},Jc="*/".concat("*");try{zc=location.href}catch(Kc){(zc=y.createElement("a")).href="",zc=zc.href}yc=Gc.exec(zc.toLowerCase())||[],m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zc,type:"GET",isLocal:Dc.test(yc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nc(Nc(a,m.ajaxSettings),b):Nc(m.ajaxSettings,a)},ajaxPrefilter:Lc(Hc),ajaxTransport:Lc(Ic),ajax:function(a,b){function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Oc(k,v,c)),u=Pc(k,u,v,j),j?(k.ifModified&&((w=v.getResponseHeader("Last-Modified"))&&(m.lastModified[e]=w),(w=v.getResponseHeader("etag"))&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j)for(j={};b=Cc.exec(f);)j[b[1].toLowerCase()]=b[2];b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zc)+"").replace(Ac,"").replace(Fc,yc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yc[1]&&c[2]===yc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yc[3]||("http:"===yc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mc(Hc,k,b,v),2===t)return v;(h=k.global)&&0==m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Ec.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wc.test(e)?"&":"?")+k.data,delete k.data),!1===k.cache&&(k.url=Bc.test(e)?e.replace(Bc,"$1_="+vc++):e+(wc.test(e)?"&":"?")+"_="+vc++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&!1!==k.contentType||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(!1===k.beforeSend.call(l,v,k)||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mc(Ic,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qc=/%20/g,Rc=/\[\]$/,Sc=/\r?\n/g,Tc=/^(?:submit|button|image|reset|file)$/i,Uc=/^(?:input|select|textarea|keygen)/i;m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vc(c,a[c],b,e);return d.join("&").replace(Qc,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Uc.test(this.nodeName)&&!Tc.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sc,"\r\n")}}):{name:b.name,value:c.replace(Sc,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zc()||$c()}:Zc;var Wc=0,Xc={},Yc=m.ajaxSettings.xhr();a.ActiveXObject&&m(a).on("unload",function(){for(var a in Xc)Xc[a](void 0,!0)}),k.cors=!!Yc&&"withCredentials"in Yc,(Yc=k.ajax=!!Yc)&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xc[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}}),m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){(b=y.createElement("script")).async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _c=[],ad=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_c.pop()||m.expando+"_"+vc++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(ad.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ad.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ad,"$1"+e):!1!==b.jsonp&&(b.url+=(wc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_c.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bd=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bd)return bd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cd=a.document.documentElement;m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;return f?(b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dd(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d):void 0},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||cd;a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position");)a=a.offsetParent;return a||cd})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dd(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=Lb(k.pixelPosition,function(a,c){return c?(c=Jb(a,b),Hb.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(!0===d||!0===e?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ed=a.jQuery,fd=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fd),b&&a.jQuery===m&&(a.jQuery=ed),m},typeof b===K&&(a.jQuery=a.$=m),m}),function(g,h){function G(F,G){function W(b){return c.preferFlash&&v&&!c.ignoreFlash&&c.flash[b]!==h&&c.flash[b]}function r(b){return function(c){var d=this._s;return d&&d._a?b.call(this,c):null}}this.setupOptions={url:F||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.movieID="sm2-container",this.id=G||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20140901",this.altURL=this.movieURL=this.version=null,this.enabled=this.swfLoaded=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.didFlashBlock=this.muted=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={},this.html5={usingFlash:null},this.flash={},this.ignoreFlash=this.html5Only=!1;var Ja,X,la,Ma,ma,n,O,w,oa,Y,pa,D,H,I,Na,qa,ra,Z,sa,$,ta,E,ua,P,va,aa,J,Oa,wa,Pa,xa,Qa,R,za,K,ba,ca,q,Ra,Sa,Ta,ea,U,Va,fa,V,z,ga,Ba,Wa,s,Ca,v,Da,Xa,B,ha,c=this,Ka=null,k=null,t=navigator.userAgent,La=g.location.href.toString(),p=document,x=[],M=!1,N=!1,m=!1,y=!1,na=!1,Q=null,ya=null,S=!1,Aa=!1,da=0,T=null,Ua=[],u=null,fb=Array.prototype.slice,A=!1,Ya=0,ia=t.match(/(ipad|iphone|ipod)/i),Za=t.match(/android/i),C=t.match(/msie/i),gb=t.match(/webkit/i),ja=t.match(/safari/i)&&!t.match(/chrome/i),Ea=t.match(/opera/i),Fa=t.match(/(mobile|pre\/|xoom)/i)||ia||Za,$a=!La.match(/usehtml5audio/i)&&!La.match(/sm2\-ignorebadua/i)&&ja&&!t.match(/silk/i)&&t.match(/OS X 10_6_([3-7])/i),Ga=p.hasFocus!==h?p.hasFocus():null,ka=ja&&(p.hasFocus===h||!p.hasFocus()),ab=!ka,bb=/(mp3|mp4|mpa|m4a|m4b)/i,Ha=p.location?p.location.protocol.match(/http/i):null,cb=Ha?"":"http://",db=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,eb="mpeg4 aac flv mov mp4 m4v f4v m4a m4b mp4v 3gp 3g2".split(" "),hb=RegExp("\\.("+eb.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!Ha;var Ia;try{Ia=Audio!==h&&(Ea&&opera!==h&&10>opera.version()?new Audio(null):new Audio).canPlayType!==h}catch(ib){Ia=!1}this.hasHTML5=Ia,this.setup=function(b){var e=!c.url;return b!==h&&m&&u&&c.ok(),oa(b),b&&(e&&P&&b.url!==h&&c.beginDelayedInit(),!P&&b.url!==h&&"complete"===p.readyState&&setTimeout(E,1)),c},this.supported=this.ok=function(){return u?m&&!y:c.useHTML5Audio&&c.hasHTML5},this.getMovie=function(b){return X(b)||p[b]||g[b]},this.createSound=function(b,e){function d(){return a=ba(a),c.sounds[a.id]=new Ja(a),c.soundIDs.push(a.id),c.sounds[a.id]}var a,f=null;if(!m||!c.ok())return!1;if(e!==h&&(b={id:b,url:e}),a=w(b),a.url=ea(a.url),void 0===a.id&&(a.id=c.setupOptions.idPrefix+Ya++),q(a.id,!0))return c.sounds[a.id];if(fa(a))(f=d())._setup_html5(a);else{if(c.html5Only||c.html5.usingFlash&&a.url&&a.url.match(/data\:/i))return d();8<n&&null===a.isMovieStar&&(a.isMovieStar=!(!a.serverURL&&!(a.type&&a.type.match(db)||a.url&&a.url.match(hb)))),a=ca(a,void 0),f=d(),8===n?k._createSound(a.id,a.loops||1,a.usePolicyFile):(k._createSound(a.id,a.url,a.usePeakData,a.useWaveformData,a.useEQData,a.isMovieStar,!!a.isMovieStar&&a.bufferTime,a.loops||1,a.serverURL,a.duration||null,a.autoPlay,!0,a.autoLoad,a.usePolicyFile),a.serverURL||(f.connected=!0,a.onconnect&&a.onconnect.apply(f))),!a.serverURL&&(a.autoLoad||a.autoPlay)&&f.load(a)}return!a.serverURL&&a.autoPlay&&f.play(),f},this.destroySound=function(b,e){if(!q(b))return!1;var a,d=c.sounds[b];for(d._iO={},d.stop(),d.unload(),a=0;a<c.soundIDs.length;a++)if(c.soundIDs[a]===b){c.soundIDs.splice(a,1);break}return e||d.destruct(!0),delete c.sounds[b],!0},this.load=function(b,e){return!!q(b)&&c.sounds[b].load(e)},this.unload=function(b){return!!q(b)&&c.sounds[b].unload()},this.onposition=this.onPosition=function(b,e,d,a){return!!q(b)&&c.sounds[b].onposition(e,d,a)},this.clearOnPosition=function(b,e,d){return!!q(b)&&c.sounds[b].clearOnPosition(e,d)},this.start=this.play=function(b,e){var d=null,a=e&&!(e instanceof Object);if(!m||!c.ok())return!1;if(q(b,a))a&&(e={url:e});else{if(!a)return!1;a&&(e={url:e}),e&&e.url&&(e.id=b,d=c.createSound(e).play())}return null===d&&(d=c.sounds[b].play(e)),d},this.setPosition=function(b,e){return!!q(b)&&c.sounds[b].setPosition(e)},this.stop=function(b){return!!q(b)&&c.sounds[b].stop()},this.stopAll=function(){for(var b in c.sounds)c.sounds.hasOwnProperty(b)&&c.sounds[b].stop()},this.pause=function(b){return!!q(b)&&c.sounds[b].pause()},this.pauseAll=function(){var b;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].pause()},this.resume=function(b){return!!q(b)&&c.sounds[b].resume()},this.resumeAll=function(){var b;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].resume()},this.togglePause=function(b){return!!q(b)&&c.sounds[b].togglePause()},this.setPan=function(b,e){return!!q(b)&&c.sounds[b].setPan(e)},this.setVolume=function(b,e){return!!q(b)&&c.sounds[b].setVolume(e)},this.mute=function(b){var e=0;if(b instanceof String&&(b=null),b)return!!q(b)&&c.sounds[b].mute();for(e=c.soundIDs.length-1;0<=e;e--)c.sounds[c.soundIDs[e]].mute();return c.muted=!0},this.muteAll=function(){c.mute()},this.unmute=function(b){if(b instanceof String&&(b=null),b)return!!q(b)&&c.sounds[b].unmute();for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].unmute();return c.muted=!1,!0},this.unmuteAll=function(){c.unmute()},this.toggleMute=function(b){return!!q(b)&&c.sounds[b].toggleMute()},this.getMemoryUse=function(){var b=0;return k&&8!==n&&(b=parseInt(k._getMemoryUse(),10)),b},this.disable=function(b){var e;if(b===h&&(b=!1),y)return!1;for(y=!0,e=c.soundIDs.length-1;0<=e;e--)Pa(c.sounds[c.soundIDs[e]]);return O(b),s.remove(g,"load",H),!0},this.canPlayMIME=function(b){var e;return c.hasHTML5&&(e=V({type:b})),!e&&u&&(e=b&&c.ok()?!!(8<n&&b.match(db)||b.match(c.mimePattern)):null),e},this.canPlayURL=function(b){var e;return c.hasHTML5&&(e=V({url:b})),!e&&u&&(e=b&&c.ok()?!!b.match(c.filePattern):null),e},this.canPlayLink=function(b){return!(b.type===h||!b.type||!c.canPlayMIME(b.type))||c.canPlayURL(b.href)},this.getSoundById=function(b,e){return b?c.sounds[b]:null},this.onready=function(b,c){if("function"!=typeof b)throw R("needFunction","onready");return c||(c=g),pa("onready",b,c),D(),!0},this.ontimeout=function(b,c){if("function"!=typeof b)throw R("needFunction","ontimeout");return c||(c=g),pa("ontimeout",b,c),D({type:"ontimeout"}),!0},this._wD=this._writeDebug=function(b,c){return!0},this._debug=function(){},this.reboot=function(b,e){var d,a,f;for(d=c.soundIDs.length-1;0<=d;d--)c.sounds[c.soundIDs[d]].destruct();if(k)try{C&&(ya=k.innerHTML),Q=k.parentNode.removeChild(k)}catch(h){}if(ya=Q=u=k=null,c.enabled=P=m=S=Aa=M=N=y=A=c.swfLoaded=!1,c.soundIDs=[],c.sounds={},Ya=0,b)x=[];else for(d in x)if(x.hasOwnProperty(d))for(a=0,f=x[d].length;a<f;a++)x[d][a].fired=!1;return c.html5={usingFlash:null},c.flash={},c.html5Only=!1,c.ignoreFlash=!1,g.setTimeout(function(){ta(),e||c.beginDelayedInit()},20),c},this.reset=function(){return c.reboot(!0,!0)},this.getMoviePercent=function(){return k&&"PercentLoaded"in k?k.PercentLoaded():null},this.beginDelayedInit=function(){na=!0,E(),setTimeout(function(){return!Aa&&(aa(),$(),Aa=!0)},20),I()},this.destruct=function(){c.disable(!0)},Ja=function(b){var e,d,f,l,L,g,p,r,x,y,z,a=this,t=!1,m=[],u=0,v=null;d=e=null,this.sID=this.id=b.id,this.url=b.url,this._iO=this.instanceOptions=this.options=w(b),this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,z=!this.url,this.id3={},this._debug=function(){},this.load=function(b){var d;if(b!==h?a._iO=w(b,a.options):(b=a.options,a._iO=b,v&&v!==a.url&&(a._iO.url=a.url,a.url=null)),a._iO.url||(a._iO.url=a.url),a._iO.url=ea(a._iO.url),!(d=a.instanceOptions=a._iO).url&&!a.url)return a;if(d.url===a.url&&0!==a.readyState&&2!==a.readyState)return 3===a.readyState&&d.onload&&ha(a,function(){d.onload.apply(a,[!!a.duration])}),a;if(a.loaded=!1,a.readyState=1,a.playState=0,a.id3={},fa(d))a._setup_html5(d)._called_load||(a._html5_canplay=!1,a.url!==d.url&&(a._a.src=d.url,a.setPosition(0)),a._a.autobuffer="auto",a._a.preload="auto",a._a._called_load=!0);else{if(c.html5Only||a._iO.url&&a._iO.url.match(/data\:/i))return a;try{a.isHTML5=!1,a._iO=ca(ba(d)),a._iO.autoPlay&&(a._iO.position||a._iO.from)&&(a._iO.autoPlay=!1),d=a._iO,8===n?k._load(a.id,d.url,d.stream,d.autoPlay,d.usePolicyFile):k._load(a.id,d.url,!!d.stream,!!d.autoPlay,d.loops||1,!!d.autoLoad,d.usePolicyFile)}catch(f){J({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return a.url=d.url,a},this.unload=function(){return 0!==a.readyState&&(a.isHTML5?(g(),a._a&&(a._a.pause(),v=ga(a._a))):8===n?k._unload(a.id,"about:blank"):k._unload(a.id),f()),a},this.destruct=function(b){a.isHTML5?(g(),a._a&&(a._a.pause(),ga(a._a),A||L(),a._a._s=null,a._a=null)):(a._iO.onfailure=null,k._destroySound(a.id)),b||c.destroySound(a.id,!0)},this.start=this.play=function(b,e){var d,f,l,g,L;if(f=!0,f=null,e=e===h||e,b||(b={}),a.url&&(a._iO.url=a.url),a._iO=w(a._iO,a.options),a._iO=w(b,a._iO),a._iO.url=ea(a._iO.url),a.instanceOptions=a._iO,!a.isHTML5&&a._iO.serverURL&&!a.connected)return a.getAutoPlay()||a.setAutoPlay(!0),a;if(fa(a._iO)&&(a._setup_html5(a._iO),p()),1===a.playState&&!a.paused&&((d=a._iO.multiShot)||(a.isHTML5&&a.setPosition(a._iO.position),f=a)),null!==f)return f;if(b.url&&b.url!==a.url&&(a.readyState||a.isHTML5||8!==n||!z?a.load(a._iO):z=!1),a.loaded||(0===a.readyState?(a.isHTML5||c.html5Only?a.isHTML5?a.load(a._iO):f=a:(a._iO.autoPlay=!0,a.load(a._iO)),a.instanceOptions=a._iO):2===a.readyState&&(f=a)),null!==f)return f;if(!a.isHTML5&&9===n&&0<a.position&&a.position===a.duration&&(b.position=0),a.paused&&0<=a.position&&(!a._iO.serverURL||0<a.position))a.resume();else{if(a._iO=w(b,a._iO),(!a.isHTML5&&null!==a._iO.position&&0<a._iO.position||null!==a._iO.from&&0<a._iO.from||null!==a._iO.to)&&0===a.instanceCount&&0===a.playState&&!a._iO.serverURL){if(d=function(){a._iO=w(b,a._iO),a.play(a._iO)},a.isHTML5&&!a._html5_canplay?(a.load({_oncanplay:d}),f=!1):a.isHTML5||a.loaded||a.readyState&&2===a.readyState||(a.load({onload:d}),f=!1),null!==f)return f;a._iO=y()}(!a.instanceCount||a._iO.multiShotEvents||a.isHTML5&&a._iO.multiShot&&!A||!a.isHTML5&&8<n&&!a.getAutoPlay())&&a.instanceCount++,a._iO.onposition&&0===a.playState&&r(a),a.playState=1,a.paused=!1,a.position=a._iO.position===h||isNaN(a._iO.position)?0:a._iO.position,a.isHTML5||(a._iO=ca(ba(a._iO))),a._iO.onplay&&e&&(a._iO.onplay.apply(a),t=!0),a.setVolume(a._iO.volume,!0),a.setPan(a._iO.pan,!0),a.isHTML5?2>a.instanceCount?(p(),f=a._setup_html5(),a.setPosition(a._iO.position),f.play()):(l=new Audio(a._iO.url),g=function(){s.remove(l,"ended",g),a._onfinish(a),ga(l),l=null},L=function(){s.remove(l,"canplay",L);try{l.currentTime=a._iO.position/1e3}catch(b){}l.play()},s.add(l,"ended",g),void 0!==a._iO.volume&&(l.volume=Math.max(0,Math.min(1,a._iO.volume/100))),a.muted&&(l.muted=!0),a._iO.position?s.add(l,"canplay",L):l.play()):(f=k._start(a.id,a._iO.loops||1,9===n?a.position:a.position/1e3,a._iO.multiShot||!1),9===n&&!f&&a._iO.onplayerror&&a._iO.onplayerror.apply(a))}return a},this.stop=function(b){var c=a._iO;return 1===a.playState&&(a._onbufferchange(0),a._resetOnPosition(0),a.paused=!1,a.isHTML5||(a.playState=0),x(),c.to&&a.clearOnPosition(c.to),a.isHTML5?a._a&&(b=a.position,a.setPosition(0),a.position=b,a._a.pause(),a.playState=0,a._onTimer(),g()):(k._stop(a.id,b),c.serverURL&&a.unload()),a.instanceCount=0,a._iO={},c.onstop&&c.onstop.apply(a)),a},this.setAutoPlay=function(b){a._iO.autoPlay=b,a.isHTML5||(k._setAutoPlay(a.id,b),b&&!a.instanceCount&&1===a.readyState&&a.instanceCount++)},this.getAutoPlay=function(){return a._iO.autoPlay},this.setPosition=function(b){b===h&&(b=0);var c=a.isHTML5?Math.max(b,0):Math.min(a.duration||a._iO.duration,Math.max(b,0));if(a.position=c,b=a.position/1e3,a._resetOnPosition(a.position),a._iO.position=c,a.isHTML5){if(a._a){if(a._html5_canplay){if(a._a.currentTime!==b)try{a._a.currentTime=b,(0===a.playState||a.paused)&&a._a.pause()}catch(e){}}else if(b)return a;a.paused&&a._onTimer(!0)}}else b=9===n?a.position:b,a.readyState&&2!==a.readyState&&k._setPosition(a.id,b,a.paused||!a.playState,a._iO.multiShot);return a},this.pause=function(b){return a.paused||0===a.playState&&1!==a.readyState?a:(a.paused=!0,a.isHTML5?(a._setup_html5().pause(),g()):(b||b===h)&&k._pause(a.id,a._iO.multiShot),a._iO.onpause&&a._iO.onpause.apply(a),a)},this.resume=function(){var b=a._iO;return a.paused?(a.paused=!1,a.playState=1,a.isHTML5?(a._setup_html5().play(),p()):(b.isMovieStar&&!b.serverURL&&a.setPosition(a.position),k._pause(a.id,b.multiShot)),!t&&b.onplay?(b.onplay.apply(a),t=!0):b.onresume&&b.onresume.apply(a),a):a},this.togglePause=function(){return 0===a.playState?(a.play({position:9!==n||a.isHTML5?a.position/1e3:a.position}),a):(a.paused?a.resume():a.pause(),a)},this.setPan=function(b,c){return b===h&&(b=0),c===h&&(c=!1),a.isHTML5||k._setPan(a.id,b),a._iO.pan=b,c||(a.pan=b,a.options.pan=b),a},this.setVolume=function(b,e){return b===h&&(b=100),e===h&&(e=!1),a.isHTML5?a._a&&(c.muted&&!a.muted&&(a.muted=!0,a._a.muted=!0),a._a.volume=Math.max(0,Math.min(1,b/100))):k._setVolume(a.id,c.muted&&!a.muted||a.muted?0:b),a._iO.volume=b,e||(a.volume=b,a.options.volume=b),a},this.mute=function(){return a.muted=!0,a.isHTML5?a._a&&(a._a.muted=!0):k._setVolume(a.id,0),a},this.unmute=function(){a.muted=!1;var b=a._iO.volume!==h;return a.isHTML5?a._a&&(a._a.muted=!1):k._setVolume(a.id,b?a._iO.volume:a.options.volume),a},this.toggleMute=function(){return a.muted?a.unmute():a.mute()},this.onposition=this.onPosition=function(b,c,e){return m.push({position:parseInt(b,10),method:c,scope:e!==h?e:a,fired:!1}),a},this.clearOnPosition=function(a,b){var c;if(a=parseInt(a,10),isNaN(a))return!1;for(c=0;c<m.length;c++)a!==m[c].position||b&&b!==m[c].method||(m[c].fired&&u--,m.splice(c,1))},this._processOnPosition=function(){var b,c;if(!(b=m.length)||!a.playState||u>=b)return!1;for(b-=1;0<=b;b--)!(c=m[b]).fired&&a.position>=c.position&&(c.fired=!0,u++,c.method.apply(c.scope,[c.position]));return!0},this._resetOnPosition=function(a){var b,c;if(!(b=m.length))return!1;for(b-=1;0<=b;b--)(c=m[b]).fired&&a<=c.position&&(c.fired=!1,u--);return!0},y=function(){var d,f,b=a._iO,c=b.from,e=b.to;return f=function(){a.clearOnPosition(e,f),a.stop()},d=function(){null===e||isNaN(e)||a.onPosition(e,f)},null!==c&&!isNaN(c)&&(b.position=c,b.multiShot=!1,d()),b},r=function(){var b,c=a._iO.onposition;if(c)for(b in c)c.hasOwnProperty(b)&&a.onPosition(parseInt(b,10),c[b])},x=function(){var b,c=a._iO.onposition;if(c)for(b in c)c.hasOwnProperty(b)&&a.clearOnPosition(parseInt(b,10))},p=function(){a.isHTML5&&Ra(a)},g=function(){a.isHTML5&&Sa(a)},(f=function(b){b||(m=[],u=0),t=!1,a._hasTimer=null,a._a=null,a._html5_canplay=!1,a.bytesLoaded=null,a.bytesTotal=null,a.duration=a._iO&&a._iO.duration?a._iO.duration:null,a.durationEstimate=null,a.buffered=[],a.eqData=[],a.eqData.left=[],a.eqData.right=[],a.failures=0,a.isBuffering=!1,a.instanceOptions={},a.instanceCount=0,a.loaded=!1,a.metadata={},a.readyState=0,a.muted=!1,a.paused=!1,a.peakData={left:0,right:0},a.waveformData={left:[],right:[]},a.playState=0,a.position=null,a.id3={}})(),this._onTimer=function(b){var c,f=!1,l={};if(a._hasTimer||b)return a._a&&(b||(0<a.playState||1===a.readyState)&&!a.paused)&&((c=a._get_html5_duration())!==e&&(e=c,a.duration=c,f=!0),a.durationEstimate=a.duration,(c=1e3*a._a.currentTime||0)!==d&&(d=c,f=!0),(f||b)&&a._whileplaying(c,l,l,l,l)),f},this._get_html5_duration=function(){var b=a._iO;return(b=a._a&&a._a.duration?1e3*a._a.duration:b&&b.duration?b.duration:null)&&!isNaN(b)&&1/0!==b?b:null},this._apply_loop=function(a,b){a.loop=1<b?"loop":""},this._setup_html5=function(b){b=w(a._iO,b);var d,c=A?Ka:a._a,e=decodeURI(b.url);if(A?e===decodeURI(Ca)&&(d=!0):e===decodeURI(v)&&(d=!0),c){if(c._s)if(A)c._s&&c._s.playState&&!d&&c._s.stop();else if(!A&&e===decodeURI(v))return a._apply_loop(c,b.loops),c;d||(v&&f(!1),c.src=b.url,Ca=v=a.url=b.url,c._called_load=!1)}else b.autoLoad||b.autoPlay?(a._a=new Audio(b.url),a._a.load()):a._a=Ea&&10>opera.version()?new Audio(null):new Audio,c=a._a,c._called_load=!1,A&&(Ka=c);return a.isHTML5=!0,a._a=c,c._s=a,l(),a._apply_loop(c,b.loops),b.autoLoad||b.autoPlay?a.load():(c.autobuffer=!1,c.preload="auto"),c},l=function(){if(a._a._added_events)return!1;var b;a._a._added_events=!0;for(b in B)B.hasOwnProperty(b)&&a._a&&a._a.addEventListener(b,B[b],!1);return!0},L=function(){var b;a._a._added_events=!1;for(b in B)B.hasOwnProperty(b)&&a._a&&a._a.removeEventListener(b,B[b],!1)},this._onload=function(b){var c=!!b||!a.isHTML5&&8===n&&a.duration;return a.loaded=c,a.readyState=c?3:2,a._onbufferchange(0),a._iO.onload&&ha(a,function(){a._iO.onload.apply(a,[c])}),!0},this._onbufferchange=function(b){return!(0===a.playState||b&&a.isBuffering||!b&&!a.isBuffering)&&(a.isBuffering=1===b,a._iO.onbufferchange&&a._iO.onbufferchange.apply(a,[b]),!0)},this._onsuspend=function(){return a._iO.onsuspend&&a._iO.onsuspend.apply(a),!0},this._onfailure=function(b,c,e){a.failures++,a._iO.onfailure&&1===a.failures&&a._iO.onfailure(b,c,e)},this._onwarning=function(b,c,e){a._iO.onwarning&&a._iO.onwarning(b,c,e)},this._onfinish=function(){var b=a._iO.onfinish;a._onbufferchange(0),a._resetOnPosition(0),a.instanceCount&&(a.instanceCount--,a.instanceCount||(x(),a.playState=0,a.paused=!1,a.instanceCount=0,a.instanceOptions={},a._iO={},g(),a.isHTML5&&(a.position=0)),(!a.instanceCount||a._iO.multiShotEvents)&&b&&ha(a,function(){b.apply(a)}))},this._whileloading=function(b,c,e,d){var f=a._iO;a.bytesLoaded=b,a.bytesTotal=c,a.duration=Math.floor(e),a.bufferLength=d,a.durationEstimate=a.isHTML5||f.isMovieStar?a.duration:f.duration?a.duration>f.duration?a.duration:f.duration:parseInt(a.bytesTotal/a.bytesLoaded*a.duration,10),a.isHTML5||(a.buffered=[{start:0,end:a.duration}]),(3!==a.readyState||a.isHTML5)&&f.whileloading&&f.whileloading.apply(a)},this._whileplaying=function(b,c,e,d,f){var l=a._iO;return!isNaN(b)&&null!==b&&(a.position=Math.max(0,b),a._processOnPosition(),!a.isHTML5&&8<n&&(l.usePeakData&&c!==h&&c&&(a.peakData={left:c.leftPeak,right:c.rightPeak}),l.useWaveformData&&e!==h&&e&&(a.waveformData={left:e.split(","),right:d.split(",")}),l.useEQData&&f!==h&&f&&f.leftEQ&&(b=f.leftEQ.split(","),a.eqData=b,a.eqData.left=b,f.rightEQ!==h&&f.rightEQ&&(a.eqData.right=f.rightEQ.split(",")))),1===a.playState&&(!a.isHTML5&&8===n&&!a.position&&a.isBuffering&&a._onbufferchange(0),l.whileplaying&&l.whileplaying.apply(a)),!0)},this._oncaptiondata=function(b){a.captiondata=b,a._iO.oncaptiondata&&a._iO.oncaptiondata.apply(a,[b])},this._onmetadata=function(b,c){var d,f,e={};for(d=0,f=b.length;d<f;d++)e[b[d]]=c[d];a.metadata=e,console.log("updated metadata",a.metadata),a._iO.onmetadata&&a._iO.onmetadata.call(a,a.metadata)},this._onid3=function(b,c){var d,f,e=[];for(d=0,f=b.length;d<f;d++)e[b[d]]=c[d];a.id3=w(a.id3,e),a._iO.onid3&&a._iO.onid3.apply(a)},this._onconnect=function(b){b=1===b,(a.connected=b)&&(a.failures=0,q(a.id)&&(a.getAutoPlay()?a.play(h,a.getAutoPlay()):a._iO.autoLoad&&a.load()),a._iO.onconnect&&a._iO.onconnect.apply(a,[b]))},this._ondataerror=function(b){0<a.playState&&a._iO.ondataerror&&a._iO.ondataerror.apply(a)}},va=function(){return p.body||p.getElementsByTagName("div")[0]},X=function(b){return p.getElementById(b)},w=function(b,e){var a,f,d=b||{};a=e===h?c.defaultOptions:e;for(f in a)a.hasOwnProperty(f)&&d[f]===h&&(d[f]="object"!=typeof a[f]||null===a[f]?a[f]:w(d[f],a[f]));return d},ha=function(b,c){b.isHTML5||8!==n?c():g.setTimeout(c,0)},Y={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1},oa=function(b,e){var d,a=!0,f=e!==h,l=c.setupOptions;for(d in b)if(b.hasOwnProperty(d))if("object"!=typeof b[d]||null===b[d]||b[d]instanceof Array||b[d]instanceof RegExp)f&&Y[e]!==h?c[e][d]=b[d]:l[d]!==h?(c.setupOptions[d]=b[d],c[d]=b[d]):Y[d]===h?a=!1:c[d]instanceof Function?c[d].apply(c,b[d]instanceof Array?b[d]:[b[d]]):c[d]=b[d];else{if(Y[d]!==h)return oa(b[d],d);a=!1}return a},s=function(){function b(a){var b=(a=fb.call(a)).length;return d?(a[1]="on"+a[1],3<b&&a.pop()):3===b&&a.push(!1),a}function c(b,e){var h=b.shift(),g=[a[e]];d?h[g](b[0],b[1]):h[g].apply(h,b)}var d=g.attachEvent,a={add:d?"attachEvent":"addEventListener",remove:d?"detachEvent":"removeEventListener"};return{add:function(){c(b(arguments),"add")},remove:function(){c(b(arguments),"remove")}}}(),B={abort:r(function(){}),canplay:r(function(){var c,b=this._s;if(b._html5_canplay)return!0;if(b._html5_canplay=!0,b._onbufferchange(0),c=b._iO.position===h||isNaN(b._iO.position)?null:b._iO.position/1e3,this.currentTime!==c)try{this.currentTime=c}catch(d){}b._iO._oncanplay&&b._iO._oncanplay()}),canplaythrough:r(function(){var b=this._s;b.loaded||(b._onbufferchange(0),b._whileloading(b.bytesLoaded,b.bytesTotal,b._get_html5_duration()),b._onload(!0))}),durationchange:r(function(){var c,b=this._s;c=b._get_html5_duration(),!isNaN(c)&&c!==b.duration&&(b.durationEstimate=b.duration=c)}),ended:r(function(){this._s._onfinish()}),error:r(function(){this._s._onload(!1)}),loadeddata:r(function(){var b=this._s;!b._loaded&&!ja&&(b.duration=b._get_html5_duration())}),loadedmetadata:r(function(){}),loadstart:r(function(){this._s._onbufferchange(1)}),play:r(function(){this._s._onbufferchange(0)}),playing:r(function(){this._s._onbufferchange(0)}),progress:r(function(b){var d,a,c=this._s,f=0,f=b.target.buffered;d=b.loaded||0;var l=b.total||1;if(c.buffered=[],f&&f.length){for(d=0,a=f.length;d<a;d++)c.buffered.push({start:1e3*f.start(d),end:1e3*f.end(d)});f=1e3*(f.end(0)-f.start(0)),d=Math.min(1,f/(1e3*b.target.duration))}isNaN(d)||(c._whileloading(d,l,c._get_html5_duration()),d&&l&&d===l&&B.canplaythrough.call(this,b))}),ratechange:r(function(){}),suspend:r(function(b){var c=this._s;B.progress.call(this,b),c._onsuspend()}),stalled:r(function(){}),timeupdate:r(function(){this._s._onTimer()}),waiting:r(function(){this._s._onbufferchange(1)})},fa=function(b){return!(!b||!(b.type||b.url||b.serverURL))&&(!(b.serverURL||b.type&&W(b.type))&&(b.type?V({type:b.type}):V({url:b.url})||c.html5Only||b.url.match(/data\:/i)))},ga=function(b){var e;return b&&(e=ja?"about:blank":c.html5.canPlayType("audio/wav")?"data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==":"about:blank",b.src=e,void 0!==b._called_unload&&(b._called_load=!1)),A&&(Ca=null),e},V=function(b){if(!c.useHTML5Audio||!c.hasHTML5)return!1;var e=b.url||null;b=b.type||null;var a,d=c.audioFormats;if(b&&c.html5[b]!==h)return c.html5[b]&&!W(b);if(!z){z=[];for(a in d)d.hasOwnProperty(a)&&(z.push(a),d[a].related&&(z=z.concat(d[a].related)));z=RegExp("\\.("+z.join("|")+")(\\?.*)?$","i")}return(a=e?e.toLowerCase().match(z):null)&&a.length?a=a[1]:b&&(e=b.indexOf(";"),a=(-1!==e?b.substr(0,e):b).substr(6)),a&&c.html5[a]!==h?e=c.html5[a]&&!W(a):(b="audio/"+a,e=c.html5.canPlayType({type:b}),e=(c.html5[a]=e)&&c.html5[b]&&!W(b)),e},Wa=function(){function b(a){var b,d=b=!1;if(!e||"function"!=typeof e.canPlayType)return b;if(a instanceof Array){for(g=0,b=a.length;g<b;g++)(c.html5[a[g]]||e.canPlayType(a[g]).match(c.html5Test))&&(d=!0,c.html5[a[g]]=!0,c.flash[a[g]]=!!a[g].match(bb));b=d}else a=!(!e||"function"!=typeof e.canPlayType)&&e.canPlayType(a),b=!(!a||!a.match(c.html5Test));return b}if(!c.useHTML5Audio||!c.hasHTML5)return u=c.html5.usingFlash=!0,!1;var d,a,l,g,e=Audio!==h?Ea&&10>opera.version()?new Audio(null):new Audio:null,f={};l=c.audioFormats;for(d in l)if(l.hasOwnProperty(d)&&(a="audio/"+d,f[d]=b(l[d].type),f[a]=f[d],d.match(bb)?(c.flash[d]=!0,c.flash[a]=!0):(c.flash[d]=!1,c.flash[a]=!1),l[d]&&l[d].related))for(g=l[d].related.length-1;0<=g;g--)f["audio/"+l[d].related[g]]=f[d],c.html5[l[d].related[g]]=f[d],c.flash[l[d].related[g]]=f[d];return f.canPlayType=e?b:null,c.html5=w(c.html5,f),c.html5.usingFlash=Va(),u=c.html5.usingFlash,!0},sa={},R=function(){},ba=function(b){return 8===n&&1<b.loops&&b.stream&&(b.stream=!1),b},ca=function(b,c){return b&&!b.usePolicyFile&&(b.onid3||b.usePeakData||b.useWaveformData||b.useEQData)&&(b.usePolicyFile=!0),b},la=function(){return!1},Pa=function(b){for(var c in b)b.hasOwnProperty(c)&&"function"==typeof b[c]&&(b[c]=la)},xa=function(b){b===h&&(b=!1),(y||b)&&c.disable(b)},Qa=function(b){if(b)if(b.match(/\.swf(\?.*)?$/i)){if(b.substr(b.toLowerCase().lastIndexOf(".swf?")+4))return b}else b.lastIndexOf("/")!==b.length-1&&(b+="/");return b=(b&&-1!==b.lastIndexOf("/")?b.substr(0,b.lastIndexOf("/")+1):"./")+c.movieURL,c.noSWFCache&&(b+="?ts="+(new Date).getTime()),b},ra=function(){8!==(n=parseInt(c.flashVersion,10))&&9!==n&&(c.flashVersion=n=8);var b=c.debugMode||c.debugFlash?"_debug.swf":".swf";c.useHTML5Audio&&!c.html5Only&&c.audioFormats.mp4.required&&9>n&&(c.flashVersion=n=9),c.version=c.versionNumber+(c.html5Only?" (HTML5-only mode)":9===n?" (AS3/Flash 9)":" (AS2/Flash 8)"),8<n?(c.defaultOptions=w(c.defaultOptions,c.flash9Options),c.features.buffering=!0,c.defaultOptions=w(c.defaultOptions,c.movieStarOptions),c.filePatterns.flash9=RegExp("\\.(mp3|"+eb.join("|")+")(\\?.*)?$","i"),c.features.movieStar=!0):c.features.movieStar=!1,c.filePattern=c.filePatterns[8!==n?"flash9":"flash8"],c.movieURL=(8===n?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",b),c.features.peakData=c.features.waveformData=c.features.eqData=8<n},Oa=function(b,c){if(!k)return!1;k._setPolling(b,c)},wa=function(){},q=this.getSoundById,K=function(){var b=[];return c.debugMode&&b.push("sm2_debug"),c.debugFlash&&b.push("flash_debug"),c.useHighPerformance&&b.push("high_performance"),b.join(" ")},za=function(){R("fbHandler");var b=c.getMoviePercent(),e={type:"FLASHBLOCK"};if(c.html5Only)return!1;c.ok()?c.oMC&&(c.oMC.className=[K(),"movieContainer","swf_loaded"+(c.didFlashBlock?" swf_unblocked":"")].join(" ")):(u&&(c.oMC.className=K()+" movieContainer "+(null===b?"swf_timedout":"swf_error")),c.didFlashBlock=!0,D({type:"ontimeout",ignoreInit:!0,error:e}),J(e))},pa=function(b,c,d){x[b]===h&&(x[b]=[]),x[b].push({method:c,scope:d||null,fired:!1})},D=function(b){if(b||(b={type:c.ok()?"onready":"ontimeout"}),!m&&b&&!b.ignoreInit||"ontimeout"===b.type&&(c.ok()||y&&!b.ignoreInit))return!1;var f,e={success:b&&b.ignoreInit?c.ok():!y},d=b&&b.type?x[b.type]||[]:[],a=[],e=[e],g=u&&!c.ok();for(b.error&&(e[0].error=b.error),b=0,f=d.length;b<f;b++)!0!==d[b].fired&&a.push(d[b]);if(a.length)for(b=0,f=a.length;b<f;b++)a[b].scope?a[b].method.apply(a[b].scope,e):a[b].method.apply(this,e),g||(a[b].fired=!0);return!0},H=function(){g.setTimeout(function(){c.useFlashBlock&&za(),D(),"function"==typeof c.onload&&c.onload.apply(g),c.waitForWindowLoad&&s.add(g,"load",H)},1)},Da=function(){if(v!==h)return v;var a,b=!1,c=navigator,d=c.plugins,f=g.ActiveXObject;if(d&&d.length)(c=c.mimeTypes)&&c["application/x-shockwave-flash"]&&c["application/x-shockwave-flash"].enabledPlugin&&c["application/x-shockwave-flash"].enabledPlugin.description&&(b=!0);else if(f!==h&&!t.match(/MSAppHost/i)){try{a=new f("ShockwaveFlash.ShockwaveFlash")}catch(l){a=null}b=!!a}return v=b},Va=function(){var b,e,d=c.audioFormats;if(ia&&t.match(/os (1|2|3_0|3_1)\s/i)?(c.hasHTML5=!1,c.html5Only=!0,c.oMC&&(c.oMC.style.display="none")):!c.useHTML5Audio||c.html5&&c.html5.canPlayType||(c.hasHTML5=!1),c.useHTML5Audio&&c.hasHTML5)for(e in U=!0,d)d.hasOwnProperty(e)&&d[e].required&&(c.html5.canPlayType(d[e].type)?c.preferFlash&&(c.flash[e]||c.flash[d[e].type])&&(b=!0):(U=!1,b=!0));return c.ignoreFlash&&(b=!1,U=!0),c.html5Only=c.hasHTML5&&c.useHTML5Audio&&!b,!c.html5Only},ea=function(b){var e,d,a=0;if(b instanceof Array){for(e=0,d=b.length;e<d;e++)if(b[e]instanceof Object){if(c.canPlayMIME(b[e].type)){a=e;break}}else if(c.canPlayURL(b[e])){a=e;break}b[a].url&&(b[a]=b[a].url),b=b[a]}return b},Ra=function(b){b._hasTimer||(b._hasTimer=!0,!Fa&&c.html5PollingInterval&&(null===T&&0===da&&(T=setInterval(Ta,c.html5PollingInterval)),da++))},Sa=function(b){b._hasTimer&&(b._hasTimer=!1,!Fa&&c.html5PollingInterval&&da--)},Ta=function(){var b;if(null!==T&&!da)return clearInterval(T),T=null,!1;for(b=c.soundIDs.length-1;0<=b;b--)c.sounds[c.soundIDs[b]].isHTML5&&c.sounds[c.soundIDs[b]]._hasTimer&&c.sounds[c.soundIDs[b]]._onTimer()},J=function(b){b=b!==h?b:{},"function"==typeof c.onerror&&c.onerror.apply(g,[{type:b.type!==h?b.type:null}]),b.fatal!==h&&b.fatal&&c.disable()},Xa=function(){if(!$a||!Da())return!1;var e,d,b=c.audioFormats;for(d in b)if(b.hasOwnProperty(d)&&("mp3"===d||"mp4"===d)&&(c.html5[d]=!1,b[d]&&b[d].related))for(e=b[d].related.length-1;0<=e;e--)c.html5[b[d].related[e]]=!1},this._setSandboxType=function(b){},this._externalInterfaceOK=function(b){if(c.swfLoaded)return!1;c.swfLoaded=!0,ka=!1,$a&&Xa(),setTimeout(ma,C?100:1)},aa=function(b,e){function d(a,b){return'<param name="'+a+'" value="'+b+'" />'}if(M&&N)return!1;if(c.html5Only)return ra(),c.oMC=X(c.movieID),ma(),N=M=!0,!1;var m,r,q,a=e||c.url,f=c.altURL||a,g=va(),k=K(),n=null,n=(n=p.getElementsByTagName("html")[0])&&n.dir&&n.dir.match(/rtl/i);if(b=b===h?c.id:b,ra(),c.url=Qa(Ha?a:f),e=c.url,c.wmode=!c.wmode&&c.useHighPerformance?"transparent":c.wmode,null!==c.wmode&&(t.match(/msie 8/i)||!C&&!c.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(Ua.push(sa.spcWmode),c.wmode=null),g={name:b,id:b,src:e,quality:"high",allowScriptAccess:c.allowScriptAccess,bgcolor:c.bgColor,pluginspage:cb+"www.macromedia.com/go/getflashplayer",title:"JS/Flash audio component (SoundManager 2)",type:"application/x-shockwave-flash",wmode:c.wmode,hasPriority:"true"},c.debugFlash&&(g.FlashVars="debug=1"),c.wmode||delete g.wmode,C)a=p.createElement("div"),r=['<object id="'+b+'" data="'+e+'" type="'+g.type+'" title="'+g.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+cb+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',d("movie",e),d("AllowScriptAccess",c.allowScriptAccess),d("quality",g.quality),c.wmode?d("wmode",c.wmode):"",d("bgcolor",c.bgColor),d("hasPriority","true"),c.debugFlash?d("FlashVars",g.FlashVars):"","</object>"].join("");else for(m in a=p.createElement("embed"),g)g.hasOwnProperty(m)&&a.setAttribute(m,g[m]);if(wa(),k=K(),g=va())if(c.oMC=X(c.movieID)||p.createElement("div"),c.oMC.id)q=c.oMC.className,c.oMC.className=(q?q+" ":"movieContainer")+(k?" "+k:""),c.oMC.appendChild(a),C&&(m=c.oMC.appendChild(p.createElement("div")),m.className="sm2-object-box",m.innerHTML=r),N=!0;else{if(c.oMC.id=c.movieID,c.oMC.className="movieContainer "+k,m=k=null,c.useFlashBlock||(c.useHighPerformance?k={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(k={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},n&&(k.left=Math.abs(parseInt(k.left,10))+"px"))),gb&&(c.oMC.style.zIndex=1e4),!c.debugFlash)for(q in k)k.hasOwnProperty(q)&&(c.oMC.style[q]=k[q]);try{C||c.oMC.appendChild(a),g.appendChild(c.oMC),C&&(m=c.oMC.appendChild(p.createElement("div")),m.className="sm2-object-box",m.innerHTML=r),N=!0}catch(s){throw Error(R("domError")+" \n"+s.toString())}}return M=!0},$=function(){return c.html5Only?(aa(),!1):!(k||!c.url)&&((k=c.getMovie(c.id))||(Q?(C?c.oMC.innerHTML=ya:c.oMC.appendChild(Q),Q=null,M=!0):aa(c.id,c.url),k=c.getMovie(c.id)),"function"==typeof c.oninitmovie&&setTimeout(c.oninitmovie,1),!0)},I=function(){setTimeout(Na,1e3)},qa=function(){g.setTimeout(function(){c.setup({preferFlash:!1}).reboot(),c.didFlashBlock=!0,c.beginDelayedInit()},1)},Na=function(){var b,e=!1;return!(!c.url||S)&&(S=!0,s.remove(g,"load",I),!(v&&ka&&!Ga)&&(m||0<(b=c.getMoviePercent())&&100>b&&(e=!0),void setTimeout(function(){if(b=c.getMoviePercent(),e)return S=!1,g.setTimeout(I,1),!1;!m&&ab&&(null===b?c.useFlashBlock||0===c.flashLoadTimeout?c.useFlashBlock&&za():!c.useFlashBlock&&U?qa():D({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}}):0!==c.flashLoadTimeout&&(!c.useFlashBlock&&U?qa():xa(!0)))},c.flashLoadTimeout)))},Z=function(){return Ga||!ka?(s.remove(g,"focus",Z),!0):(Ga=ab=!0,S=!1,I(),s.remove(g,"focus",Z),!0)},O=function(b){if(m)return!1;if(c.html5Only)return m=!0,H(),!0;var d,e=!0;return c.useFlashBlock&&c.flashLoadTimeout&&!c.getMoviePercent()||(m=!0),d={type:!v&&u?"NO_FLASH":"INIT_TIMEOUT"},(y||b)&&(c.useFlashBlock&&c.oMC&&(c.oMC.className=K()+" "+(null===c.getMoviePercent()?"swf_timedout":"swf_error")),D({type:"ontimeout",error:d,ignoreInit:!0}),J(d),e=!1),y||(c.waitForWindowLoad&&!na?s.add(g,"load",H):H()),e},Ma=function(){var b,e=c.setupOptions;for(b in e)e.hasOwnProperty(b)&&(c[b]===h?c[b]=e[b]:c[b]!==e[b]&&(c.setupOptions[b]=c[b]))},ma=function(){if(m)return!1;if(c.html5Only)return m||(s.remove(g,"load",c.beginDelayedInit),c.enabled=!0,O()),!0;$();try{k._externalInterfaceTest(!1),Oa(!0,c.flashPollingInterval||(c.useHighPerformance?10:50)),c.debugMode||k._disableDebug(),c.enabled=!0,c.html5Only||s.add(g,"unload",la)}catch(b){return J({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),xa(!0),O(),!1}return O(),s.remove(g,"load",c.beginDelayedInit),!0},E=function(){return!P&&(P=!0,Ma(),wa(),!v&&c.hasHTML5&&c.setup({useHTML5Audio:!0,preferFlash:!1}),Wa(),!v&&u&&(Ua.push(sa.needFlash),c.setup({flashLoadTimeout:1})),p.removeEventListener&&p.removeEventListener("DOMContentLoaded",E,!1),$(),!0)},Ba=function(){return"complete"===p.readyState&&(E(),p.detachEvent("onreadystatechange",Ba)),!0},ua=function(){na=!0,E(),s.remove(g,"load",ua)},(ta=function(){Fa&&(c.setupOptions.useHTML5Audio=!0,c.setupOptions.preferFlash=!1,ia||Za&&!t.match(/android\s2\.3/i))&&(ia&&(c.ignoreFlash=!0),A=!0)})(),Da(),s.add(g,"focus",Z),s.add(g,"load",I),s.add(g,"load",ua),p.addEventListener?p.addEventListener("DOMContentLoaded",E,!1):p.attachEvent?p.attachEvent("onreadystatechange",Ba):J({type:"NO_DOM2_EVENTS",fatal:!0})}if(!g||!g.document)throw Error("SoundManager requires a browser with window and document objects.");var F=null;void 0!==g.SM2_DEFER&&SM2_DEFER||(F=new G),"object"==typeof module&&module&&"object"==typeof module.exports?(g.soundManager=F,module.exports.SoundManager=G,module.exports.soundManager=F):"function"==typeof define&&define.amd?define("SoundManager",[],function(){return{SoundManager:G,soundManager:F}}):(g.SoundManager=G,g.soundManager=F)}(window);var FlashDetect=new function(){var self=this;self.installed=!1,self.raw="",self.major=-1,self.minor=-1,self.revision=-1,self.revisionStr="";var activeXDetectRules=[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(obj){return getActiveXVersion(obj)}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(obj){var version="6,0,21";try{obj.AllowScriptAccess="always",version=getActiveXVersion(obj)}catch(err){}return version}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(obj){return getActiveXVersion(obj)}}],getActiveXVersion=function(activeXObj){var version=-1;try{version=activeXObj.GetVariable("$version")}catch(err){}return version},getActiveXObject=function(name){var obj=-1;try{obj=new ActiveXObject(name)}catch(err){obj={activeXError:!0}}return obj},parseActiveXVersion=function(str){var versionArray=str.split(",");return{raw:str,major:parseInt(versionArray[0].split(" ")[1],10),minor:parseInt(versionArray[1],10),revision:parseInt(versionArray[2],10),revisionStr:versionArray[2]}},parseStandardVersion=function(str){var descParts=str.split(/ +/),majorMinor=descParts[2].split(/\./),revisionStr=descParts[3];return{raw:str,major:parseInt(majorMinor[0],10),minor:parseInt(majorMinor[1],10),revisionStr:revisionStr,revision:parseRevisionStrToInt(revisionStr)}},parseRevisionStrToInt=function(str){return parseInt(str.replace(/[a-zA-Z]/g,""),10)||self.revision};self.majorAtLeast=function(version){return self.major>=version},self.minorAtLeast=function(version){return self.minor>=version},self.revisionAtLeast=function(version){return self.revision>=version},self.versionAtLeast=function(major){var properties=[self.major,self.minor,self.revision],len=Math.min(properties.length,arguments.length);for(i=0;i<len;i++){if(properties[i]>=arguments[i]){if(i+1<len&&properties[i]==arguments[i])continue;return!0}return!1}},self.FlashDetect=function(){if(navigator.plugins&&navigator.plugins.length>0){var type="application/x-shockwave-flash",mimeTypes=navigator.mimeTypes;if(mimeTypes&&mimeTypes[type]&&mimeTypes[type].enabledPlugin&&mimeTypes[type].enabledPlugin.description){var version=mimeTypes[type].enabledPlugin.description,versionObj=parseStandardVersion(version);self.raw=versionObj.raw,self.major=versionObj.major,self.minor=versionObj.minor,self.revisionStr=versionObj.revisionStr,self.revision=versionObj.revision,self.installed=!0}}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var version=-1,i=0;i<activeXDetectRules.length&&-1==version;i++){var obj=getActiveXObject(activeXDetectRules[i].name);if(!obj.activeXError&&(self.installed=!0,-1!=(version=activeXDetectRules[i].version(obj)))){versionObj=parseActiveXVersion(version);self.raw=versionObj.raw,self.major=versionObj.major,self.minor=versionObj.minor,self.revision=versionObj.revision,self.revisionStr=versionObj.revisionStr}}}()};FlashDetect.JS_RELEASE="1.0.4",function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==N||!(n!=C||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=C||!e[t])}function n(e,t){return typeof e[t]!=E}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function o(e){return e&&O(e,T)&&D(e,w)}function i(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=E&&e(console,"log")&&console.log(t)}function s(e,t){b&&t?alert(e):a(e)}function c(e){I.initialized=!0,I.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,I.config.alertOnFail)}function f(e){return e.message||e.description||String(e)}function u(){if(b&&!I.initialized){var t,n=!1,r=!1;e(document,"createRange")&&(t=document.createRange(),O(t,y)&&D(t,S)&&(n=!0));var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void c("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(r=!0)),!n&&!r)return void c("Neither Range nor TextRange are available");I.initialized=!0,I.features={implementsDomRange:n,implementsTextRange:r};var d;for(var l in x)(d=x[l])instanceof p&&d.init(d,I);for(var h=0,g=M.length;g>h;++h)try{M[h](I)}catch(m){a("Rangy init listener threw an exception. Continuing. Detail: "+f(m))}}}function l(e,t,n){n&&(e+=" in module "+n.name),I.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function h(e,t,n,r){e[t]=function(){return l(t,n,r),e[n].apply(e,P.toArray(arguments))}}function p(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n){var r=new p(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(I,t),t.supported=!0}catch(r){a("Module '"+e+"' failed to load: "+f(r)),r.stack&&a(r.stack)}}});return x[e]=r,r}function R(){}var C="object",N="function",E="undefined",S=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],y=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],w=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],T=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],O=r(e),_=r(t),D=r(n),A=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;r>n;++n)t(e[n],n)},x={},b=typeof window!=E&&typeof document!=E,P={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:O,areHostObjects:_,areHostProperties:D,isTextRange:o,getBody:i,forEach:A},I={version:"1.3.0",initialized:!1,isBrowser:b,supported:!0,util:P,features:{},modules:x,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==E||rangyAutoInitialize}};I.fail=c,I.warn=function(e){s("Rangy warning: "+e,I.config.alertOnWarn)};var B;!{}.hasOwnProperty?c("hasOwnProperty not supported"):(P.extend=B=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&B(r,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},P.createOptions=function(e,t){var n={};return B(n,t),e&&B(n,e),n}),b||c("Rangy can only run in a browser"),function(){var e;if(b){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){for(var t=[],n=0,r=e.length;r>n;++n)t[n]=e[n];return t}),P.toArray=e}();var H;b&&(e(document,"addEventListener")?H=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?H=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),P.addListener=H);var M=[];P.deprecationNotice=l,P.createAliasForDeprecatedMethod=h,I.init=u,I.addInitListener=function(e){I.initialized?e(I):M.push(e)};var k=[];I.addShimListener=function(e){k.push(e)},b&&(I.shim=I.createMissingNativeApi=function(e){e=e||window,u();for(var t=0,n=k.length;n>t;++t)k[t](e)},h(I,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;o>r;++r){if(t=n[r],!((e=x[t])&&e instanceof p))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){I.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){I.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},I.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=m(e,n,t);I.initialized&&I.supported&&r.init()},I.createCoreModule=function(e,t,n){m(e,t,n)},I.RangePrototype=R,I.rangePrototype=new R,I.selectionPrototype=new function(){},I.createCoreModule("DomUtil",[],function(e,t){function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function a(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(M(r,n))return n;return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function d(e,t,n){for(var r,o=n?e:e.parentNode;o;){if((r=o.parentNode)===t)return o;o=r}return null}function f(e){var t=e.nodeType;return 3==t||4==t||8==t}function l(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=b)return e.ownerDocument;if(typeof e.document!=b)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=g(e);if(typeof n.defaultView!=b)return n.defaultView;if(typeof n.parentWindow!=b)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=b)return e.contentDocument;if(typeof e.contentWindow!=b)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){return e&&P.isHostMethod(e,"setTimeout")&&P.isHostObject(e,"document")}function S(e){try{return e.parentNode,!1}catch(n){return!0}}function y(e){if(!e)return"[No node]";if(k&&S(e))return"[Broken node]";if(f(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function _(e){this.root=e,this._next=e}function A(e,t){this.node=e,this.offset=t}function x(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var b="undefined",P=e.util,I=P.getBody;P.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),P.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var B=document.createElement("div");P.areHostMethods(B,["insertBefore","appendChild","cloneNode"]||!P.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),P.isHostProperty(B,"innerHTML")||t.fail("Element is missing innerHTML property");var H=document.createTextNode("test");P.areHostMethods(H,["splitText","deleteData","insertData","appendData","cloneNode"]||!P.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"])||!P.areHostProperties(H,["data"]))||t.fail("Incomplete Text Node implementation");var M=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},k=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",k=S(n),e.features.crashyTextNodes=k}();var L;typeof window.getComputedStyle!=b?L=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=b?L=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},A.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+y(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},(x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24}).toString=function(){return this.message},e.dom={arrayContains:M,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==b||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:o,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:function(e,t){return s(e,t,!0)},getClosestAncestorIn:d,isCharacterDataNode:f,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:l,splitDataNode:function(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),l(r,e),n)for(var i,a=0;i=n[a++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;return r},getDocument:g,getWindow:p,getIframeWindow:function(e){if(typeof e.contentWindow!=b)return e.contentWindow;if(typeof e.contentDocument!=b)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:m,getBody:I,isWindow:v,getContentDocument:function(e,t,n){var r;if(e?P.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):v(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,n,r,i){var s,c,f,u,l;if(e==r)return n===i?0:i>n?-1:1;if(s=d(r,e,!0))return n<=o(s)?-1:1;if(s=d(e,r,!0))return o(s)<i?-1:1;if(!(c=a(e,r)))throw new Error("comparePoints error: nodes have no common ancestor");if(f=e===c?c:d(e,c,!0),u=r===c?c:d(r,c,!0),f===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=c.firstChild;l;){if(l===f)return-1;if(l===u)return 1;l=l.nextSibling}},isBrokenNode:S,inspectNode:y,getComputedStyleProperty:L,createTestElement:function(e,t,n){var r=I(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var i=r.firstChild;return i?r.insertBefore(o,i):r.appendChild(o),o},removeNode:function(e){return e.parentNode.removeChild(e)},fragmentFromNodeChildren:function(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new _(e)},DomPosition:A},e.DOMException=x}),I.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(F(e,t.startContainer)||F(e,t.endContainer))}function n(e){return e.document||j(e.startContainer)}function r(e){return Q(e.startContainer)}function o(e){return new M(e.parentNode,W(e))}function i(e){return new M(e.parentNode,W(e)+1)}function a(e,t,n){var r=11==e.nodeType?e.firstChild:e;return L(t)?n==t.length?B.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:U(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function s(e,t,r){if(w(e),w(t),n(t)!=n(e))throw new k("WRONG_DOCUMENT_ERR");var o=z(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=z(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?0>=o&&i>=0:0>o&&i>0}function c(e){for(var t,r,o,i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(o=e.getSubtreeIterator(),r.appendChild(c(o)),o.detach()),10==r.nodeType)throw new k("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function d(e,t,n){var r,o;n=n||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(a=e.getSubtreeIterator(),d(a,t,n),a.detach(),n.stop)return}else for(r=B.createIterator(i);o=r.next();)if(!1===t(o))return void(n.stop=!0)}function f(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),f(t),t.detach()):e.remove()}function u(e){for(var t,r,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(u(r)),r.detach()):e.remove(),10==t.nodeType)throw new k("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function l(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var a=[];return d(new g(e,!1),function(t){if(!(o&&!r.test(t.nodeType)||i&&!n(t))){var s=e.startContainer;if(t!=s||!L(s)||e.startOffset!=s.length){var c=e.endContainer;t==c&&L(c)&&0==e.endOffset||a.push(t)}}}),a}function h(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+B.inspectNode(e.startContainer)+":"+e.startOffset+", "+B.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&L(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||L(this.sc)?V(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||L(this.ec)?V(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function p(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,Y(e,r))return o;o=o.parentNode}return null}}function m(e,t){if(rt(e,t))throw new k("INVALID_NODE_TYPE_ERR")}function R(e,t){if(!Y(t,e.nodeType))throw new k("INVALID_NODE_TYPE_ERR")}function v(e,t){if(0>t||t>(L(e)?e.length:e.childNodes.length))throw new k("INDEX_SIZE_ERR")}function C(e,t){if(tt(e,!0)!==tt(t,!0))throw new k("WRONG_DOCUMENT_ERR")}function N(e){if(nt(e,!0))throw new k("NO_MODIFICATION_ALLOWED_ERR")}function E(e,t){if(!e)throw new k(t)}function S(e,t){return t<=(L(e)?e.length:e.childNodes.length)}function y(e){return!!e.startContainer&&!!e.endContainer&&!(G&&(B.isBrokenNode(e.startContainer)||B.isBrokenNode(e.endContainer)))&&Q(e.startContainer)==Q(e.endContainer)&&S(e.startContainer,e.startOffset)&&S(e.endContainer,e.endOffset)}function w(e){if(!y(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function T(e,t){w(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;L(o)&&i>0&&i<o.length&&U(o,i,t),L(n)&&r>0&&r<n.length&&(n=U(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=W(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function O(e){w(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function _(e){e.START_TO_START=dt,e.START_TO_END=ft,e.END_TO_END=ut,e.END_TO_START=lt,e.NODE_BEFORE=ht,e.NODE_AFTER=gt,e.NODE_BEFORE_AND_AFTER=pt,e.NODE_INSIDE=mt}function D(e){_(e),_(e.prototype)}function A(e,t){return function(){w(this);var n,r,o=this.startContainer,a=this.startOffset,s=this.commonAncestorContainer,c=new g(this,!0);o!==s&&(n=V(o,s,!0),r=i(n),o=r.node,a=r.offset),d(c,N),c.reset();var f=e(c);return c.detach(),t(this,o,a,o,a),f}}function x(n,r){function a(e,t){return function(n){R(n,Z),R(Q(n),$);var r=(e?o:i)(n);(t?s:c)(this,r.node,r.offset)}}function s(e,t,n){var o=e.endContainer,i=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((Q(t)!=Q(o)||1==z(t,n,o,i))&&(o=t,i=n),r(e,t,n,o,i))}function c(e,t,n){var o=e.startContainer,i=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((Q(t)!=Q(o)||-1==z(t,n,o,i))&&(o=t,i=n),r(e,o,i,t,n))}var d=function(){};d.prototype=e.rangePrototype,n.prototype=new d,H.extend(n.prototype,{setStart:function(e,t){m(e,!0),v(e,t),s(this,e,t)},setEnd:function(e,t){m(e,!0),v(e,t),c(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,i=n;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}r(this,t,n,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){w(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){m(e,!0),r(this,e,0,e,q(e))},selectNode:function(e){m(e,!1),R(e,Z);var t=o(e),n=i(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:A(u,r),deleteContents:A(f,r),canSurroundContents:function(){w(this),N(this.startContainer),N(this.endContainer);var e=new g(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},splitBoundaries:function(){T(this)},splitBoundariesPreservingPositions:function(e){T(this,e)},normalizeBoundaries:function(){w(this);var e,t=this.startContainer,n=this.startOffset,o=this.endContainer,i=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,i=e.length,e.appendData(t.data),X(t))},s=function(e){var r=e.previousSibling;if(r&&r.nodeType==e.nodeType){t=e;var a=e.length;if(n=r.length,e.insertData(0,r.data),X(r),t==o)i+=n,o=t;else if(o==e.parentNode){var s=W(e);i==s?(o=e,i=a):i>s&&i--}}},c=!0;if(L(o))i==o.length?a(o):0==i&&(e=o.previousSibling)&&e.nodeType==o.nodeType&&(i=e.length,t==o&&(c=!1),e.appendData(o.data),X(o),o=e);else{if(i>0){var d=o.childNodes[i-1];d&&L(d)&&a(d)}c=!this.collapsed}if(c){if(L(t))0==n?s(t):n==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(o==e&&(o=t,i+=t.length),t.appendData(e.data),X(e));else if(n<t.childNodes.length){var f=t.childNodes[n];f&&L(f)&&s(f)}}else t=o,n=i;r(this,t,n,o,i)},collapseToPoint:function(e,t){m(e,!0),v(e,t),this.setStartAndEnd(e,t)}}),D(n)}function b(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:B.getCommonAncestor(e.startContainer,e.endContainer)}function P(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=B.getDocument(t),b(e)}function I(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,b(this)}var B=e.dom,H=e.util,M=B.DomPosition,k=e.DOMException,L=B.isCharacterDataNode,W=B.getNodeIndex,F=B.isOrIsAncestorOf,j=B.getDocument,z=B.comparePoints,U=B.splitDataNode,V=B.getClosestAncestorIn,q=B.getNodeLength,Y=B.arrayContains,Q=B.getRootContainer,G=e.features.crashyTextNodes,X=B.removeNode;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,L(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!L(n)||n!==this.sc&&n!==this.ec?n.parentNode&&X(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){return t(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new I(n(this.range));var t=this._current,r=t,o=0,i=t,a=q(t);F(t,this.sc)&&(r=this.sc,o=this.so),F(t,this.ec)&&(i=this.ec,a=this.eo),P(e,r,o,i,a)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Z=[1,3,4,5,7,8,10],$=[2,9,11],J=[5,6,10,12],K=[1,3,4,5,7,8,10,11],et=[1,3,4,5,7,8],tt=p([9,11]),nt=p(J),rt=p([6,10,12]),ot=document.createElement("style"),it=!1;try{ot.innerHTML="<b>x</b>",it=3==ot.firstChild.nodeType}catch(at){}e.features.htmlParsingConforms=it;var st=it?function(e){var t=this.startContainer,n=j(t);if(!t)throw new k("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:L(t)&&(r=B.parentElement(t)),r=null===r||"HTML"==r.nodeName&&B.isHtmlNamespace(j(r).documentElement)&&B.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,B.fragmentFromNodeChildren(r)}:function(e){var r=n(this).createElement("body");return r.innerHTML=e,B.fragmentFromNodeChildren(r)},ct=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],dt=0,ft=1,ut=2,lt=3,ht=0,gt=1,pt=2,mt=3;H.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){w(this),C(this.startContainer,t.startContainer);var n,r,o,i,a=e==lt||e==dt?"start":"end",s=e==ft||e==dt?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],z(n,r,o,i)},insertNode:function(e){if(w(this),R(e,K),N(this.startContainer),F(e,this.startContainer))throw new k("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){w(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&L(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),(t=n(this).createDocumentFragment()).appendChild(e),t;var r=new g(this,!0);return e=c(r),r.detach(),e},canSurroundContents:function(){w(this),N(this.startContainer),N(this.endContainer);var e=new g(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(R(e,et),!this.canSurroundContents())throw new k("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){w(this);for(var e,t=new I(n(this)),r=ct.length;r--;)e=ct[r],t[e]=this[e];return t},toString:function(){w(this);var e=this.startContainer;if(e===this.endContainer&&L(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new g(this,!0);return d(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){w(this);var t=e.parentNode,n=W(e);if(!t)throw new k("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>r?o>0?pt:ht:o>0?gt:mt},comparePoint:function(e,t){return w(this),E(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)<0?-1:z(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:st,toHtml:function(){return O(this)},intersectsNode:function(e,t){if(w(this),Q(e)!=r(this))return!1;var n=e.parentNode,o=W(e);if(!n)return!0;var i=z(n,o,this.endContainer,this.endOffset),a=z(n,o+1,this.startContainer,this.startOffset);return t?0>=i&&a>=0:0>i&&a>0},isPointInRange:function(e,t){return w(this),E(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),z(e,t,this.startContainer,this.startOffset)>=0&&z(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return s(this,e,!1)},intersectsOrTouchesRange:function(e){return s(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=z(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=z(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==z(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==z(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new k("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==mt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,q(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return w(this),l(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=n(this),o=e.createRange(r);t=t||B.getBody(r),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,d=!1;!d&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),d=!0),n=o;else for(a=r.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return I.rangesEqual(this,e)},isValid:function(){return y(this)},inspect:function(){return h(this)},detach:function(){}}),x(I,P),H.extend(I,{rangeProperties:ct,RangeIterator:g,copyComparisonConstants:D,createPrototypeRange:x,inspect:h,toHtml:O,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=I}),I.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,c=o.getBody,d=o.getContentDocument,f=o.isCharacterDataNode;if(e.features.implementsDomRange&&function(){function r(e){for(var t,n=l.length;n--;)t=l[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}var f,u,l=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},s.createPrototypeRange(n,function(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}),(f=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),r(this)},f.cloneContents=function(){return this.nativeRange.cloneContents()},f.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},f.collapse=function(e){this.nativeRange.collapse(e),r(this)},f.cloneRange=function(){return new n(this.nativeRange.cloneRange())},f.refresh=function(){r(this)},f.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");c(document).appendChild(h);var g=document.createRange();g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),f.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},f.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},u=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(p){f.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},f.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},u=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}f.setStartBefore=u("setStartBefore","setEndBefore"),f.setStartAfter=u("setStartAfter","setEndAfter"),f.setEndBefore=u("setEndBefore","setStartBefore"),f.setEndAfter=u("setEndAfter","setStartAfter"),f.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var m=document.createRange();m.selectNodeContents(h),m.setEnd(h,4),m.setStart(h,2),f.compareBoundaryPoints=-1==g.compareBoundaryPoints(g.START_TO_END,m)&&1==g.compareBoundaryPoints(g.END_TO_START,m)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var R=document.createElement("div");R.innerHTML="123";var v=R.firstChild,C=c(document);C.appendChild(R),g.setStart(v,1),g.setEnd(v,2),g.deleteContents(),"13"==v.data&&(f.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},f.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),C.removeChild(R),C=null,i.isHostMethod(g,"createContextualFragment")&&(f.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(h),f.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return(e=d(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();(n=e.duplicate()).collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},l=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(o.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var d=new a(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var u=o.getDocument(c).createElement("span");u.parentNode&&o.removeNode(u);for(var l,h,g,p,m,R=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==c?i.nodeIndex:0,C=c.childNodes.length,N=C,E=N;E==C?c.appendChild(u):c.insertBefore(u,c.childNodes[E]),s.moveToElementText(u),0!=(l=s.compareEndPoints(R,e))&&v!=N;){if(-1==l){if(N==v+1)break;v=E}else N=N==v+1?v:E;E=Math.floor((v+N)/2),c.removeChild(u)}if(m=u.nextSibling,-1==l&&m&&f(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(m.data)){var y=s.duplicate(),w=y.text.replace(/\r\n/g,"\r").length;for(S=y.moveStart("character",w);-1==(l=y.compareEndPoints("StartToEnd",y));)S++,y.moveStart("character",1)}else S=s.text.length;p=new a(m,S)}else h=(r||!n)&&u.previousSibling,g=(r||n)&&u.nextSibling,p=g&&f(g)?new a(g,0):h&&f(h)?new a(h,h.data.length):new a(c,o.getNodeIndex(u));return o.removeNode(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},g=function(e,t){var n,r,i,a,s=e.offset,d=o.getDocument(e.node),u=c(d).createTextRange(),l=f(e.node);return l?(n=e.node,r=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,r=e.node),i=d.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),u.moveToElementText(i),u.collapse(!t),r.removeChild(i),l&&u[t?"moveStart":"moveEnd"]("character",s),u};(r=function(e){this.textRange=e,this.refresh()}).prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r=u(this.textRange);l(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(n=h(this.textRange,r,!0,!1),e=n.boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r);var p=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=p,r.prototype.toTextRange=function(){return p(this)},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var m=Function("return this;")();void 0===m.Range&&(m.Range=r),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},i.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),i.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),I.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(D.isWindow(e))return e;if(e instanceof R)return e.win;var r=D.getContentDocument(e,t,n);return D.getWindow(r)}return window}function i(e){return r(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==D.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function c(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function d(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function f(t){var n;return t instanceof b?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof P?n=t.nativeRange:H.implementsDomRange&&t instanceof D.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!D.isAncestorOf(e[0],e[t]))return!1;return!0}function l(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&void 0!==e.text}function g(e,t){var n=new P(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){if(t._ranges.length=0,"None"==t.docSelection.type)d(t);else{var n=t.docSelection.createRange();if(h(n))g(t,n);else{t.rangeCount=n.length;for(var r,o=k(n.item(0)),i=0;i<t.rangeCount;++i)(r=e.createRange(o)).selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var r=e.docSelection.createRange(),o=l(n),i=k(r.item(0)),a=L(i).createControlRange(),s=0,c=r.length;c>s;++s)a.add(r.item(s));try{a.add(o)}catch(d){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),p(e)}function R(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function v(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function C(e,t){for(var n,r,o=tt.length;o--;)if(n=tt[o],r=n.selection,"deleteAll"==t)v(r);else if(n.win==e)return"delete"==t?(tt.splice(o,1),!0):r;return"deleteAll"==t&&(tt.length=0),null}function N(e,n){for(var r,o=k(n[0].startContainer),i=L(o).createControlRange(),a=0,s=n.length;s>a;++a){r=l(n[a]);try{i.add(r)}catch(c){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),p(e)}function E(e,t){if(e.win.document!=k(t))throw new I("WRONG_DOCUMENT_ERR")}function S(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0))["set"+(t?"Start":"End")](n,r):(o=e.createRange(this.win.document)).setStartAndEnd(n,r),this.setSingleRange(o,this.isBackward())}}function y(e){var t=[],n=new B(e.anchorNode,e.anchorOffset),r=new B(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;a>i;++i)t[i]=b.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var w,T,O="boolean",_="number",D=e.dom,A=e.util,x=A.isHostMethod,b=e.DomRange,P=e.WrappedRange,I=e.DOMException,B=D.DomPosition,H=e.features,M="Control",k=D.getDocument,L=D.getBody,W=b.rangesEqual,F=x(window,"getSelection"),j=A.isHostObject(document,"selection");H.implementsWinGetSelection=F,H.implementsDocSelection=j;var z=j&&(!F||e.config.preferTextRange);if(z)w=i,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||k(n.createRange().parentElement())==t};else{if(!F)return t.fail("Neither document.selection or window.getSelection() detected."),!1;w=function(e){return r(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}}e.getNativeSelection=w;var U=w();if(!U)return t.fail("Native selection was null (possibly issue 138?)"),!1;var V=e.createNativeRange(document),q=L(document),Y=A.areHostProperties(U,["anchorNode","focusNode","anchorOffset","focusOffset"]);H.selectionHasAnchorAndFocus=Y;var Q=x(U,"extend");H.selectionHasExtend=Q;var G=typeof U.rangeCount==_;H.selectionHasRangeCount=G;var X=!1,Z=!0,$=Q?function(t,n){var r=b.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(f(o)),t.extend(n.startContainer,n.startOffset)}:null;A.areHostMethods(U,["addRange","getRangeAt","removeAllRanges"])&&typeof U.rangeCount==_&&H.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],i=a(t),s=0;n>s;++s)o[s]=t.getRangeAt(s);var c=D.createTestElement(document,"",!1),d=c.appendChild(document.createTextNode("")),f=document.createRange();if(f.setStart(d,1),f.collapse(!0),t.removeAllRanges(),t.addRange(f),Z=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)X=!1;else{var l=f.cloneRange();f.setStart(d,0),l.setEnd(d,3),l.setStart(d,2),t.addRange(f),t.addRange(l),X=2==t.rangeCount}}for(D.removeNode(c),t.removeAllRanges(),s=0;n>s;++s)0==s&&i?$?$(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),H.selectionSupportsMultipleRanges=X,H.collapsedNonEditableSelectionsSupported=Z;var J,K=!1;q&&x(q,"createControlRange")&&(J=q.createControlRange(),A.areHostProperties(J,["item","add"])&&(K=!0)),H.implementsControlRange=K,T=Y?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed};var et;x(U,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:Y&&(et=function(t){var n=k(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),R.prototype=e.selectionPrototype;var tt=[],nt=function(e){if(e&&e instanceof R)return e.refresh(),e;var t=C(e=r(e,"getNativeSelection")),n=w(e),o=j?i(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new R(n,o,e),tt.push({win:e,selection:t})),t};e.getSelection=nt,A.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var rt=R.prototype;if(!z&&Y&&A.areHostMethods(U,["removeAllRanges","addRange"])){rt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),d(this)};var ot=function(e,t){$(e.nativeSelection,t),e.refresh()};rt.addRange=G?function(t,r){if(K&&j&&this.docSelection.type==M)m(this,t);else if(n(r)&&Q)ot(this,t);else{var o;X?o=this.rangeCount:(this.removeAllRanges(),o=0);var i=f(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var c=et(this.nativeSelection,this.rangeCount-1);c&&!W(c,t)&&(t=new P(c))}this._ranges[this.rangeCount-1]=t,s(this,t,st(this.nativeSelection)),this.isCollapsed=T(this)}else this.refresh()}}:function(e,t){n(t)&&Q?ot(this,e):(this.nativeSelection.addRange(f(e)),this.refresh())},rt.setRanges=function(e){if(K&&j&&e.length>1)N(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(x(U,"empty")&&x(V,"select")&&K&&z))return t.fail("No means of selecting a Range or TextRange was found"),!1;rt.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=k(this.anchorNode);else if(this.docSelection.type==M){var t=this.docSelection.createRange();t.length&&(e=k(t.item(0)))}e&&(L(e).createTextRange().select(),this.docSelection.empty())}}catch(r){}d(this)},rt.addRange=function(t){this.docSelection.type==M?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},rt.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?N(this,e):t&&this.addRange(e[0])}}rt.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var it;if(z)it=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=L(t.win.document).createTextRange()).collapse(!0),t.docSelection.type==M?p(t):h(n)?g(t,n):d(t)};else if(x(U,"getRangeAt")&&typeof U.rangeCount==_)it=function(t){if(K&&j&&t.docSelection.type==M)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],st(t.nativeSelection)),t.isCollapsed=T(t)}else d(t)};else{if(!Y||typeof U.isCollapsed!=O||typeof V.collapsed!=O||!H.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;it=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=et(n,0),e._ranges=[t],e.rangeCount=1,c(e),e.isCollapsed=T(e)):d(e)}}rt.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(it(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!W(t[o],this._ranges[o]))return!0;return!1}};var at=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;o>r;++r)W(t,n[r])||e.addRange(n[r]);e.rangeCount||d(e)};rt.removeRange=K&&j?function(e){if(this.docSelection.type==M){for(var n=this.docSelection.createRange(),r=l(e),o=k(n.item(0)),i=L(o).createControlRange(),a=!1,s=0,c=n.length;c>s;++s)n.item(s)!==r||a?i.add(n.item(s)):a=!0;i.select(),p(this)}else at(this,e)}:function(e){at(this,e)};var st;!z&&Y&&H.implementsDomRange?(st=a,rt.isBackward=function(){return st(this)}):st=rt.isBackward=function(){return!1},rt.isBackwards=rt.isBackward,rt.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},rt.collapse=function(t,n){E(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},rt.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},rt.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},rt.selectAllChildren=function(t){E(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},rt.deleteFromDocument=function(){if(K&&j&&this.docSelection.type==M){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),D.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;o>r;++r)n[r].deleteContents();this.addRange(n[o-1])}}},rt.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},rt.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},rt.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},rt.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},rt.setStart=S(!0),rt.setEnd=S(!1),e.rangePrototype.select=function(e){nt(this.getDocument()).setSingleRange(this,e)},rt.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},rt.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},rt.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},rt.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)(r=e.createRange(this.win)).moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},rt.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},rt.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},rt.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(b.toHtml(t))}),e.join("")},H.implementsTextRange&&(rt.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(h(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),rt.getName=function(){return"WrappedSelection"},rt.inspect=function(){return y(this)},rt.detach=function(){C(this.win,"delete"),v(this)},R.detachAll=function(){C(null,"deleteAll")},R.inspect=y,R.isDirectionBackward=n,e.Selection=R,e.selectionPrototype=rt,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return nt(e)}),e=null})});var L=!1,W=function(){L||(L=!0,!I.initialized&&I.config.autoInitialize&&u())};return b&&("complete"==document.readyState?W():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",W,!1),H(window,"load",W))),I},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))return!1;return!0}function s(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function r(e,t){return!!e&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e)}function o(e,t){return"object"==typeof e.classList?e.classList.contains(t):r("string"==typeof e.className?e.className:e.getAttribute("class"),t)}function a(e,t){if("object"==typeof e.classList)e.classList.add(t);else{var n="string"==typeof e.className,s=n?e.className:e.getAttribute("class");s?r(s,t)||(s+=" "+t):s=t,n?e.className=s:e.setAttribute("class",s)}}function l(e){return"string"==typeof e.className?e.className:e.getAttribute("class")}function u(e){return e&&e.split(/\s+/).sort().join(" ")}function f(e){return u(l(e))}function c(e,t){return f(e)==f(t)}function p(e,t){for(var n=t.split(/\s+/),r=0,i=n.length;i>r;++r)if(!o(e,s(n[r])))return!1;return!0}function d(e){var t=e.parentNode;return t&&1==t.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}function h(e,t,n,s,r){var i=e.node,o=e.offset,a=i,l=o;i==s&&o>r&&++l,i!=t||o!=n&&o!=n+1||(a=s,l+=r-n),i==t&&o>n+1&&--l,e.node=a,e.offset=l}function m(e,t,n){e.node==t&&e.offset>n&&--e.offset}function g(e,t,n,s){-1==n&&(n=t.childNodes.length);var r=e.parentNode,i=$.getNodeIndex(e);U(s,function(e){h(e,r,i,t,n)}),t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function N(e,t){var n=e.parentNode,s=$.getNodeIndex(e);U(t,function(e){m(e,n,s)}),$.removeNode(e)}function v(e,t,n,s,r){for(var i,o=[];i=e.firstChild;)g(i,t,n++,r),o.push(i);return s&&N(e,r),o}function y(e,t){return v(e,e.parentNode,$.getNodeIndex(e),!0,t)}function C(e,t){var n=e.cloneRange();n.selectNodeContents(t);var s=n.intersection(e);return""!=(s?s.toString():"")}function T(e){for(var t,n=e.getNodes([3]),s=0;(t=n[s])&&!C(e,t);)++s;for(var r=n.length-1;(t=n[r])&&!C(e,t);)--r;return n.slice(s,r+1)}function E(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,s,r,i=0,o=e.attributes.length;o>i;++i)if(n=e.attributes[i],"class"!=(r=n.name)){if(s=t.attributes.getNamedItem(r),null===n!=(null===s))return!1;if(n.specified!=s.specified)return!1;if(n.specified&&n.nodeValue!==s.nodeValue)return!1}return!0}function b(e,t){for(var n,s=0,r=e.attributes.length;r>s;++s)if(n=e.attributes[s].name,(!t||!B(t,n))&&e.attributes[s].specified&&"class"!=n)return!0;return!1}function A(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||G(e)&&!G(e.parentNode))}function S(e){return(G(e)||1!=e.nodeType&&G(e.parentNode))&&!A(e)}function x(e){return e&&1==e.nodeType&&!J.test(F(e,"display"))}function R(e){if(0==e.data.length)return!0;if(K.test(e.data))return!1;switch(F(e.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return x(e.previousSibling)||x(e.nextSibling)}function P(e){var t,n,s=[];for(t=0;n=e[t++];)s.push(new z(n.startContainer,n.startOffset),new z(n.endContainer,n.endOffset));return s}function w(e,t){for(var n,s,r,i=0,o=e.length;o>i;++i)n=e[i],s=t[2*i],r=t[2*i+1],n.setStartAndEnd(s.node,s.offset,r.node,r.offset)}function O(e,t){return $.isCharacterDataNode(e)?0==t?!!e.previousSibling:t!=e.length||!!e.nextSibling:t>0&&t<e.childNodes.length}function I(e,n,s,r){var i,o,a=0==s;if($.isAncestorOf(n,e))return e;if($.isCharacterDataNode(n)){var l=$.getNodeIndex(n);if(0==s)s=l;else{if(s!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+s+" in "+n.data);s=l+1}n=n.parentNode}if(O(n,s)){i=n.cloneNode(!1),o=n.parentNode,i.id&&i.removeAttribute("id");for(var u,f=0;u=n.childNodes[s];)g(u,i,f++,r);return g(i,o,$.getNodeIndex(n)+1,r),n==e?i:I(e,o,$.getNodeIndex(i),r)}if(e!=n){i=n.parentNode;var c=$.getNodeIndex(n);return a||c++,I(e,i,c,r)}return e}function W(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&c(e,t)&&E(e,t)&&"inline"==F(e,"display")&&"inline"==F(t,"display")}function L(e){var t=e?"nextSibling":"previousSibling";return function(n,s){var r=n.parentNode,i=n[t];if(i){if(i&&3==i.nodeType)return i}else if(s&&(i=r[t])&&1==i.nodeType&&W(r,i)){var o=i[e?"firstChild":"lastChild"];if(o&&3==o.nodeType)return o}return null}}function M(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function H(e,t,r){var i,o,a,l,f=this;f.cssClass=f.className=e;var c=null,p={};if("object"==typeof t&&null!==t){for(void 0!==t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),r=t.tagNames,c=t.elementProperties,p=t.elementAttributes,o=0;l=Y[o++];)t.hasOwnProperty(l)&&(f[l]=t[l]);i=t.normalize}else i=t;f.normalize=void 0===i||i,f.attrExceptions=[];var d=document.createElement(f.elementTagName);f.elementProperties=f.copyPropertiesToElement(c,d,!0),n(p,function(e,t){f.attrExceptions.push(e),p[e]=""+t}),f.elementAttributes=p,f.elementSortedClassName=f.elementProperties.hasOwnProperty("className")?u(f.elementProperties.className+" "+e):e,f.applyToAnyTagName=!1;var h=typeof r;if("string"==h)"*"==r?f.applyToAnyTagName=!0:f.tagNames=s(r.toLowerCase()).split(/\s*,\s*/);else if("object"==h&&"number"==typeof r.length)for(f.tagNames=[],o=0,a=r.length;a>o;++o)"*"==r[o]?f.applyToAnyTagName=!0:f.tagNames.push(r[o].toLowerCase());else f.tagNames=[f.elementTagName]}var $=e.dom,z=$.DomPosition,B=$.arrayContains,D=e.util,U=D.forEach,k=D.isHostMethod(document,"createElementNS"),q=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if("object"==typeof t.classList)t.classList.remove(n);else{var s="string"==typeof t.className,r=s?t.className:t.getAttribute("class");r=r.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e),s?t.className=r:t.setAttribute("class",r)}}}(),F=$.getComputedStyleProperty,G="boolean"==typeof document.createElement("div").isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!(!e||1!=e.nodeType||"false"==e.contentEditable)&&("true"==e.contentEditable||G(e.parentNode))},J=/^inline(-block|-table)?$/i,K=/[^\r\n\t\f \u200B]/,Q=L(!1),X=L(!0);M.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){var s,r=$.getNodeIndex(n),i=[],o=0;U(t,function(t,a){s=t.parentNode,a>0&&(s.removeChild(t),s.hasChildNodes()||$.removeNode(s),e&&U(e,function(e){e.node==t&&(e.node=n,e.offset+=o),e.node==s&&e.offset>r&&(--e.offset,e.offset==r+1&&len-1>a&&(e.node=n,e.offset=o))})),i[a]=t.data,o+=t.data.length}),n.data=i.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return U(this.textNodes,function(t,n){e[n]="'"+t.data+"'"}),"[Merge("+e.join(",")+")]"}};var Y=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],Z={};H.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var s,r,i,o,l,f,c={};for(var p in e)if(e.hasOwnProperty(p))if(o=e[p],l=t[p],"className"==p)a(t,o),a(t,this.className),t[p]=u(t[p]),n&&(c[p]=o);else if("style"==p){r=l,n&&(c[p]=i={});for(s in e[p])e[p].hasOwnProperty(s)&&(r[s]=o[s],n&&(i[s]=r[s]));this.attrExceptions.push(p)}else t[p]=o,n&&(c[p]=t[p],f=Z.hasOwnProperty(p)?Z[p]:p,this.attrExceptions.push(f));return n?c:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return B(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&o(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||S(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&R(e)},postApply:function(e,t,n,s){var r,o,a=e[0],l=e[e.length-1],u=[],f=a,c=l,p=0,d=l.length;U(e,function(e){(o=Q(e,!s))?(r||(r=new M(o),u.push(r)),r.textNodes.push(e),e===a&&(f=r.textNodes[0],p=f.length),e===l&&(c=r.textNodes[0],d=r.getLength())):r=null});var h=X(l,!s);if(h&&(r||(r=new M(l),u.push(r)),r.textNodes.push(h)),u.length){for(i=0,len=u.length;len>i;++i)u[i].doMerge(n);t.setStartAndEnd(f,p,c,d)}},createContainer:function(e){var t,n=$.getDocument(e),s=k&&!$.isHtmlNamespace(e)&&(t=e.namespaceURI)?n.createElementNS(e.namespaceURI,this.elementTagName):n.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,s,!1),this.copyAttributesToElement(this.elementAttributes,s),a(s,this.className),this.onElementCreate&&this.onElementCreate(s,this),s},elementHasProperties:function(e,t){var s=this;return n(t,function(t,n){if("className"==t)return p(e,n);if("object"==typeof n){if(!s.elementHasProperties(e[t],n))return!1}else if(e[t]!==n)return!1})},elementHasAttributes:function(e,t){return n(t,function(t,n){return e.getAttribute(t)===n&&void 0})},applyToTextNode:function(e){if(d(e)){var t=e.parentNode;if(1==t.childNodes.length&&this.useExistingElements&&this.appliesToElement(t)&&this.elementHasProperties(t,this.elementProperties)&&this.elementHasAttributes(t,this.elementAttributes))a(t,this.className);else{var n=e.parentNode,s=this.createContainer(n);n.insertBefore(s,e),s.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&f(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!b(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),s=[e],r=P(s);U(n,function(e){N(e,r)}),w(s,r)},undoToTextNode:function(e,t,n,s){if(!t.containsNode(n)){var r=t.cloneRange();r.selectNode(n),r.isPointInRange(t.endContainer,t.endOffset)&&(I(n,t.endContainer,t.endOffset,s),t.setEndAfter(n)),r.isPointInRange(t.startContainer,t.startOffset)&&(n=I(n,t.startContainer,t.startOffset,s))}this.isRemovable(n)?y(n,s):q(n,this.className)},splitAncestorWithClass:function(e,t,n){var s=this.getSelfOrAncestorWithClass(e);s&&I(s,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?y(e,t):q(e,this.className)},applyToRange:function(e,t){var n=this,s=P((t=t||[])||[]);e.splitBoundariesPreservingPositions(s),n.removeEmptyElements&&n.removeEmptyContainers(e);var r=T(e);if(r.length){U(r,function(e){n.isIgnorableWhiteSpaceNode(e)||n.getSelfOrAncestorWithClass(e)||!n.isModifiable(e)||n.applyToTextNode(e,s)});var i=r[r.length-1];e.setStartAndEnd(r[0],0,i,i.length),n.normalize&&n.postApply(r,e,s,!1),w(t,s)}var o=n.getEmptyElements(e);U(o,function(e){a(e,n.className)})},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n=this,s=P(t=t||[]);e.splitBoundariesPreservingPositions(s),n.removeEmptyElements&&n.removeEmptyContainers(e,s);var r,i,o=T(e),a=o[o.length-1];if(o.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,s),n.splitAncestorWithClass(e.startContainer,e.startOffset,s);for(var l=0,u=o.length;u>l;++l)r=o[l],(i=n.getSelfOrAncestorWithClass(r))&&n.isModifiable(r)&&n.undoToAncestor(i,s);e.setStartAndEnd(o[0],0,a,a.length),n.normalize&&n.postApply(o,e,s,!0),w(t,s)}var f=n.getEmptyElements(e);U(f,function(e){q(e,n.className)})},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),s=e.getSelection(t).getAllRanges();this.undoToRanges(s),n.setRanges(s)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,s=0;n=t[s++];)if(!this.isIgnorableWhiteSpaceNode(n)&&C(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var s=n.getSelfOrAncestorWithClass(e);s&&!B(t,s)&&t.push(s)}),t},detach:function(){}},H.util={hasClass:o,addClass:a,removeClass:q,getClass:l,hasSameClasses:c,hasAllClasses:p,replaceWithOwnChildren:y,elementsHaveSameNonClassAttributes:E,elementHasNonClassAttributes:b,splitNodeAt:I,isEditableElement:G,isEditingHost:A,isEditable:S},e.CssClassApplier=e.ClassApplier=H,e.createClassApplier=function(e,t,n){return new H(e,t,n)},D.createAliasForDeprecatedMethod(e,"createCssClassApplier","createClassApplier",t)}),e},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("Highlighter",["ClassApplier"],function(e){function t(e,t){return e.characterRange.start-t.characterRange.start}function n(e,t){return t?e.getElementById(t):l(e)}function r(e,t){this.type=e,this.converterCreator=t}function i(e,t){f[e]=new r(e,t)}function a(e){var t=f[e];if(t instanceof r)return t.create();throw new Error("Highlighter type '"+e+"' is not valid")}function s(e,t){this.start=e,this.end=t}function h(e,t,n,r,i,a){i?(this.id=i,d=Math.max(d,i+1)):this.id=d++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=r,this.containerElementId=a||null,this.applied=!1}function o(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=a(t)}var c=e.dom,g=c.arrayContains,l=c.getBody,u=e.util.createOptions,p=e.util.forEach,d=1,f={};r.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},e.registerHighlighterType=i,s.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},isContiguousWith:function(e){return this.start==e.end||this.end==e.start},union:function(e){return new s(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new s(Math.max(this.start,e.start),Math.min(this.end,e.end))},getComplements:function(e){var t=[];if(this.start>=e.start){if(this.end<=e.end)return[];t.push(new s(e.end,this.end))}else t.push(new s(this.start,Math.min(this.end,e.start))),this.end>e.end&&t.push(new s(e.end,this.end));return t},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},s.fromCharacterRange=function(e){return new s(e.start,e.end)};var R={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new s(n.start,n.end)},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.moveToBookmark({start:n.start,end:n.end,containerNode:r}),i},serializeSelection:function(e,t){for(var n=e.getAllRanges(),i=[],a=1==n.length&&e.isBackward(),s=0,h=n.length;h>s;++s)i[s]={characterRange:this.rangeToCharacterRange(n[s],t),backward:a};return i},restoreSelection:function(e,t,n){e.removeAllRanges();for(var r,i,s=e.win.document,h=0,o=t.length;o>h;++h)i=t[h],i.characterRange,r=this.characterRangeToRange(s,i.characterRange,n),e.addRange(r,i.backward)}};i("textContent",function(){return R}),i("TextRange",function(){var t;return function(){if(!t){var n=e.modules.TextRange;if(!n)throw new Error("TextRange module is missing.");if(!n.supported)throw new Error("TextRange module is present but not supported.");t={rangeToCharacterRange:function(e,t){return s.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.selectCharacters(r,n.start,n.end),i},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return t}}()),h.prototype={getContainerElement:function(){return n(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},o.prototype={addClassApplier:function(e){this.classAppliers[e.className]=e},getHighlightForElement:function(e){for(var t=this.highlights,n=0,r=t.length;r>n;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t,n=0,r=this.highlights.length;r>n;++n)t=this.highlights[n],g(e,t)&&(t.unapply(),this.highlights.splice(n--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){var t=[],n=this.highlights;return p(e,function(e){p(n,function(n){e.intersectsRange(n.getRange())&&!g(t,n)&&t.push(n)})}),t},highlightCharacterRanges:function(t,n,r){var i,a,o,R,v,m,c=this.highlights,g=this.converter,l=this.doc,d=[],f=t?this.classAppliers[t]:null,C=(r=u(r,{containerElementId:null,exclusive:!0})).containerElementId,w=r.exclusive;C&&(R=this.doc.getElementById(C))&&((v=e.createRange(this.doc)).selectNodeContents(R),m=new s(0,v.toString().length));var y,E,T,x,A,H;for(i=0,a=n.length;a>i;++i)if(y=n[i],A=[],m&&(y=y.intersection(m)),y.start!=y.end){for(o=0;o<c.length;++o)T=!1,C==c[o].containerElementId&&(E=c[o].characterRange,x=f==c[o].classApplier,H=!x&&w,(E.intersects(y)||E.isContiguousWith(y))&&(x||H)&&(H&&p(E.getComplements(y),function(e){A.push(new h(l,e,c[o].classApplier,g,null,C))}),T=!0,x&&(y=E.union(y)))),T?(d.push(c[o]),c[o]=new h(l,E.union(y),f,g,null,C)):A.push(c[o]);f&&A.push(new h(l,y,f,g,null,C)),this.highlights=c=A}p(d,function(e){e.unapply()});var I=[];return p(c,function(e){e.applied||(e.apply(),I.push(e))}),I},highlightRanges:function(t,n,r){var s,i=[],a=this.converter,h=(r=u(r,{containerElement:null,exclusive:!0})).containerElement,o=h?h.id:null;return h&&(s=e.createRange(h)).selectNodeContents(h),p(n,function(e){var t=h?s.intersection(e):e;i.push(a.rangeToCharacterRange(t,h||l(e.getDocument())))}),this.highlightCharacterRanges(t,i,{containerElementId:o,exclusive:r.exclusive})},highlightSelection:function(t,r){var i=this.converter,a=!!t&&this.classAppliers[t],h=(r=u(r,{containerElementId:null,exclusive:!0})).containerElementId,o=r.exclusive,c=r.selection||e.getSelection(this.doc),l=n(c.win.document,h);if(!a&&!1!==t)throw new Error("No class applier found for class '"+t+"'");var d=i.serializeSelection(c,l),f=[];p(d,function(e){f.push(s.fromCharacterRange(e.characterRange))});var R=this.highlightCharacterRanges(t,f,{containerElementId:h,exclusive:o});return i.restoreSelection(c,d,l),R},unhighlightSelection:function(t){t=t||e.getSelection(this.doc);var n=this.getIntersectingHighlights(t.getAllRanges());return this.removeHighlights(n),t.removeAllRanges(),n},getHighlightsInSelection:function(t){return t=t||e.getSelection(this.doc),this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(e){return this.getHighlightsInSelection(e).length>0},serialize:function(e){var n,r,i,s,h=this,o=h.highlights;return o.sort(t),e=u(e,{serializeHighlightText:!1,type:h.converter.type}),n=e.type,(i=n!=h.converter.type)&&(s=a(n)),r=["type:"+n],p(o,function(t){var n,a=t.characterRange;i&&(n=t.getContainerElement(),a=s.rangeToCharacterRange(h.converter.characterRangeToRange(h.doc,a,n),n));var o=[a.start,a.end,t.id,t.classApplier.className,t.containerElementId];e.serializeHighlightText&&o.push(t.getText()),r.push(o.join("$"))}),r.join("|")},deserialize:function(e){var t,r,i,o=e.split("|"),c=[],g=o[0],l=!1;if(!g||!(t=/^type:(\w+)$/.exec(g)))throw new Error("Serialized highlights are invalid.");(r=t[1])!=this.converter.type&&(i=a(r),l=!0),o.shift();for(var u,p,d,f,R,v,m=o.length;m-- >0;){if(v=o[m].split("$"),d=new s(+v[0],+v[1]),f=v[4]||null,l&&(R=n(this.doc,f),d=this.converter.rangeToCharacterRange(i.characterRangeToRange(this.doc,d,R),R)),!(u=this.classAppliers[v[3]]))throw new Error("No class applier found for class '"+v[3]+"'");(p=new h(this.doc,d,u,this.converter,parseInt(v[2]),f)).apply(),c.push(p)}this.highlights=c}},e.Highlighter=o,e.createHighlighter=function(e,t){return new o(e,t)}}),e},this),function(a){"use strict";if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports&&"object"==typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var b="undefined"!=typeof window?window:self,c=b.Q;b.Q=a(),b.Q.noConflict=function(){return b.Q=c,this}}}(function(){"use strict";function a(a){return function(){return W.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===ca(a)||a instanceof S}function d(a,b){if(P&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(da)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+da+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===R&&d>=T&&ia>=d}function i(){if(P)try{throw new Error}catch(a){var b=a.stack.split("\n"),d=g(b[0].indexOf("@")>0?b[1]:b[2]);if(!d)return;return R=d[0],d[1]}}function k(a){return a instanceof o?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,Y(c,function(b,c){k.nextTick(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=_(l.prototype),f=_(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=X(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):k.nextTick(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&P)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||Y(d,function(b,c){k.nextTick(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=_(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return a instanceof o}function s(a){return b(a)&&"function"==typeof a.then}function w(){ea.length=0,fa.length=0,ha||(ha=!0)}function x(a,b){ha&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==Z(fa,a)&&(process.emit("unhandledRejection",b,a),ga.push(a))}),fa.push(a),b&&void 0!==b.stack?ea.push(b.stack):ea.push("(no stack) "+b))}function y(a){if(ha){var b=Z(fa,a);-1!==b&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var c=Z(ga,a);-1!==c&&(process.emit("rejectionHandled",ea[b],a),ga.splice(c,1))}),fa.splice(b,1),ea.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},delete:function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return ba(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return k.nextTick(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function D(a,b,c){return k(a).spread(b,c)}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return Y(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0==--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){if(0===a.length)return k.resolve();var b=k.defer(),c=0;return Y(a,function(d,e,f){var j=a[f];c++,p(j,function(a){b.resolve(a)},function(){0==--c&&b.reject(new Error("Can't get fulfillment value from any promise, all promises were rejected."))},function(a){b.notify({index:f,value:a})})},void 0),b.promise}function L(a){return p(a,function(a){return a=$(a,k),p(J($(a,function(a){return p(a,U,U)})),function(){return a})})}var P=!1;try{throw new Error}catch(Q){P=!!Q.stack}var R,S,T=i(),U=function(){},V=function(){function a(){for(var a,d;c.next;)c=c.next,a=c.task,c.task=void 0,(d=c.domain)&&(c.domain=void 0,d.enter()),b(a,d);for(;h.length;)a=h.pop(),b(a);e=!1}function b(b,c){try{b()}catch(d){if(g)throw c&&c.exit(),setTimeout(a,0),c&&c.enter(),d;setTimeout(function(){throw d},0)}c&&c.exit()}var c={task:void 0,next:null},d=c,e=!1,f=void 0,g=!1,h=[];if(V=function(a){d=d.next={task:a,domain:g&&process.domain,next:null},e||(e=!0,f())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)g=!0,f=function(){process.nextTick(a)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var i=new MessageChannel;i.port1.onmessage=function(){f=j,i.port1.onmessage=a,a()};var j=function(){i.port2.postMessage(0)};f=function(){setTimeout(a,0),j()}}else f=function(){setTimeout(a,0)};return V.runAfter=function(a){h.push(a),e||(e=!0,f())},V}(),W=Function.call,X=a(Array.prototype.slice),Y=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Z=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),$=a(Array.prototype.map||function(a,b){var c=this,d=[];return Y(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),_=Object.create||function(a){function b(){}return b.prototype=a,new b},aa=a(Object.prototype.hasOwnProperty),ba=Object.keys||function(a){var b=[];for(var c in a)aa(a,c)&&b.push(c);return b},ca=a(Object.prototype.toString);S="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var da="From previous event:";k.resolve=k,k.nextTick=V,k.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(X(arguments,1)):a.resolve(c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return k.nextTick(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.tap=function(a,b){return k(a).tap(b)},o.prototype.tap=function(a){return a=k(a),this.then(function(b){return a.fcall(b).thenResolve(b)})},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=function(a){return r(a)&&"pending"===a.inspect().state},o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=function(a){return!r(a)||"fulfilled"===a.inspect().state},o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=function(a){return r(a)&&"rejected"===a.inspect().state},o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ea=[],fa=[],ga=[],ha=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return ea.slice()},k.stopUnhandledRejectionTracking=function(){w(),ha=!1},w(),k.reject=z,k.fulfill=A,k.master=function(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})},k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=function(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}},k.spawn=function(a){k.done(k.async(a)())},k.return=function(a){throw new S(a)},k.promised=function(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}},k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return k.nextTick(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k.delete=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype.delete=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,X(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,X(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k.try=k.fcall=function(a){return k(a).dispatch("apply",[void 0,X(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,X(arguments)])},k.fbind=function(a){var b=k(a),c=X(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(X(arguments))])}},o.prototype.fbind=function(){var a=this,b=X(arguments);return function(){return a.dispatch("apply",[this,b.concat(X(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.any=K,o.prototype.any=function(){return K(this)},k.allResolved=function(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}(L,"allResolved","allSettled"),o.prototype.allResolved=function(){return L(this)},k.allSettled=function(a){return k(a).allSettled()},o.prototype.allSettled=function(){return this.then(function(a){return J($(a,function(a){function b(){return a.inspect()}return(a=k(a)).then(b,b)}))})},k.fail=k.catch=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype.catch=function(a){return this.then(void 0,a)},k.progress=function(a,b){return k(a).then(void 0,void 0,b)},o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k.finally=function(a,b){return k(a).finally(b)},o.prototype.fin=o.prototype.finally=function(a){if(!a||"function"!=typeof a.apply)throw new Error("Can't apply finally callback");return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){k.nextTick(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=X(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=X(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=X(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=X(arguments,1);return function(){var c=b.concat(X(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=X(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=X(arguments,2);return function(){var e=c.concat(X(arguments)),f=l();return e.push(f.makeNodeResolver()),k(function(){return a.apply(b,arguments)}).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=X(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=X(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=X(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=X(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=function(a,b){return k(a).nodeify(b)},o.prototype.nodeify=function(a){return a?void this.then(function(b){k.nextTick(function(){a(null,b)})},function(b){k.nextTick(function(){a(b)})}):this},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var ia=i();return k});var YUE=YAHOO.util.Event,YUD=YAHOO.util.Dom,YUC=YAHOO.util.Connect,YCE=YAHOO.util.CustomEvent,YLang=YAHOO.util.Lang;"object"!=typeof window.console&&(window.console={log:function(){},error:function(){},warn:function(){},info:function(){},dir:function(){}});var Util={};!function(Util){function LogEvent(message){this.message=message,this.date=new Date}var logs=[];LogEvent.prototype.toString=function(){return"* "+Util.Date.formatTime(this.date)+" - "+this.message},Util.log=function(msg){var logEvent=new LogEvent(msg);return logs.push(logEvent),logs.length>500&&(logs=logs.slice(1)),"function"==typeof console.log&&console.log(logEvent.toString()),logEvent},Util.logInfo=function(msg){"function"==typeof console.info&&console.info(msg)},Util.logError=function(msg){"function"==typeof console.error&&console.error(msg)},Util.dir=function(msg){"function"==typeof console.dir&&console.dir(msg)},Util.getDebugLog=function(){return logs.join("\n")},Util.queueWork=function(fn,context){return context=context||window,YAHOO.lang.later(0,context,fn)}}(Util),Util.Asserts={},Util.Asserts.assert=function(condition,opt_message){if(!condition){var message="Assertion failed";throw opt_message&&(message+=": "+opt_message),new Error(message)}return condition},Util.Assert={},function(Assert){function formatMessage(customMessage,defaultMessage){return YAHOO.lang.isString(customMessage)&&customMessage.length>0?YAHOO.lang.substitute(customMessage,{message:defaultMessage}):defaultMessage}var errorProps=["description","fileName","lineNumber","message","name","number","stack"],AssertionError=function(message){for(var tmp=Error.prototype.constructor.apply(this,arguments),idx=0;idx<errorProps.length;idx++)this[errorProps[idx]]=tmp[errorProps[idx]]};(AssertionError.prototype=new Error).getMessage=function(){return this.message},AssertionError.prototype.toString=function(){return this.name+": "+this.getMessage()};var ComparisonFailure=function(message,expected,actual){AssertionError.call(this,message),this.expected=expected,this.actual=actual,this.name="ComparisonFailure"};YAHOO.lang.extend(ComparisonFailure,AssertionError),ComparisonFailure.prototype.getMessage=function(){return this.message+"\nExpected: "+this.expected+" ("+typeof this.expected+")\nActual:"+this.actual+" ("+typeof this.actual+")"};var UnexpectedValue=function(message,unexpected){AssertionError.call(this,message),this.unexpected=unexpected,this.name="UnexpectedValue"};YAHOO.lang.extend(UnexpectedValue,AssertionError),UnexpectedValue.prototype.getMessage=function(){return this.message+"\nUnexpected: "+this.unexpected+" ("+typeof this.unexpected+") "};YAHOO.lang.extend(function(message){AssertionError.call(this,message||"This test should fail but didn't."),this.name="ShouldFail"},AssertionError);YAHOO.lang.extend(function(message){AssertionError.call(this,message||"This test should have thrown an error but didn't."),this.name="ShouldError"},AssertionError);YAHOO.lang.extend(function(cause){AssertionError.call(this,"Unexpected error: "+cause.message),this.cause=cause,this.name="UnexpectedError",this.stack=cause.stack},AssertionError),Assert.fail=function(message){throw new AssertionError(formatMessage(message,"Test force-failed."))},Assert.areEqual=function(expected,actual,message){if(expected!=actual)throw new ComparisonFailure(formatMessage(message,"Values should be equal."),expected,actual)},Assert.areNotEqual=function(unexpected,actual,message){if(unexpected==actual)throw new UnexpectedValue(formatMessage(message,"Values should not be equal."),unexpected)},Assert.areNotSame=function(unexpected,actual,message){if(unexpected===actual)throw UnexpectedValue(formatMessage(message,"Values should not be the same."),unexpected)},Assert.areSame=function(expected,actual,message){if(expected!==actual)throw new ComparisonFailure(formatMessage(message,"Values should be the same."),expected,actual)},Assert.isFalse=function(actual,message){if(!1!==actual)throw new ComparisonFailure(formatMessage(message,"Value should be false."),!1,actual)},Assert.isTrue=function(actual,message){if(!0!==actual)throw new ComparisonFailure(formatMessage(message,"Value should be true."),!0,actual)},Assert.isNaN=function(actual,message){if(!isNaN(actual))throw new ComparisonFailure(formatMessage(message,"Value should be NaN."),NaN,actual)},Assert.isNotNaN=function(actual,message){if(isNaN(actual))throw new UnexpectedValue(formatMessage(message,"Values should not be NaN."),NaN)},Assert.isNotNull=function(actual,message){if(YAHOO.lang.isNull(actual))throw new UnexpectedValue(formatMessage(message,"Values should not be null."),null)},Assert.isNotUndefined=function(actual,message){if(YAHOO.lang.isUndefined(actual))throw new UnexpectedValue(formatMessage(message,"Value should not be undefined."),void 0)},Assert.isNull=function(actual,message){if(!YAHOO.lang.isNull(actual))throw new ComparisonFailure(formatMessage(message,"Value should be null."),null,actual)},Assert.isUndefined=function(actual,message){if(!YAHOO.lang.isUndefined(actual))throw new ComparisonFailure(formatMessage(message,"Value should be undefined."),void 0,actual)},Assert.isArray=function(actual,message){if(!YAHOO.lang.isArray(actual))throw new UnexpectedValue(formatMessage(message,"Value should be an array."),actual)},Assert.isBoolean=function(actual,message){if(!YAHOO.lang.isBoolean(actual))throw new UnexpectedValue(formatMessage(message,"Value should be a Boolean."),actual)},Assert.isFunction=function(actual,message){if(!YAHOO.lang.isFunction(actual))throw new UnexpectedValue(formatMessage(message,"Value should be a function."),actual)},Assert.isInstanceOf=function(expected,actual,message){if(!(actual instanceof expected))throw new ComparisonFailure(formatMessage(message,"Value isn't an instance of expected type."),expected,actual)},Assert.isNumber=function(actual,message){if(!YAHOO.lang.isNumber(actual))throw new UnexpectedValue(formatMessage(message,"Value should be a number."),actual)},Assert.isObject=function(actual,message){if(!YAHOO.lang.isObject(actual))throw new UnexpectedValue(formatMessage(message,"Value should be an object."),actual)},Assert.isString=function(actual,message){if(!YAHOO.lang.isString(actual))throw new UnexpectedValue(formatMessage(message,"Value should be a string."),actual)},Assert.isElement=function(actual,message){if(!Util.Dom.isElement(actual))throw new UnexpectedValue(formatMessage(message,"Value should be an HTMLElement."),actual)},Assert.isTypeOf=function(expected,actual,message){if(typeof actual!=expected)throw new ComparisonFailure(formatMessage(message,"Value should be of type "+expected+"."),expected,typeof actual)}}(Util.Assert),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound}),Util.Function={},Util.Function.bind=function(func,scope){var args=[];scope=YAHOO.lang.isValue(scope)?scope:null;for(var i=2,i_max=arguments.length;i<i_max;i++)args.push(arguments[i]);return function(){for(var cl_args=args.slice(),i=0,i_max=arguments.length;i<i_max;i++)cl_args.push(arguments[i]);return null===scope?func.apply(this,cl_args):func.apply(scope,cl_args)}},Util.bind=Util.Function.bind,function(Util){var O=Object.create?function(obj){return Object.create(obj)}:function(){function F(){}return function(obj){return F.prototype=obj,new F}}();O.keys=function(object){if(Object.keys)return Object.keys(object);var keys=[];for(var key in object)object.hasOwnProperty(key)&&keys.push(key);return keys},O.getKeys=O.keys,O.values=function(object){var values=[];for(var key in object)object.hasOwnProperty(key)&&values.push(object[key]);return values},O.getValues=O.values,O.isEmpty=function(object){for(var key in object)if(object.hasOwnProperty(key))return!1;return!0},O.remove=function(obj,key){var rv;return(rv=key in obj)&&delete obj[key],rv},O.clear=function(obj){Object.keys(obj).forEach(function(key){delete obj[key]})},O.clone=function(obj){if(null==obj||"object"!=typeof obj)return obj;var newObj={};for(var prop in obj)!function(prop){"function"==typeof obj[prop]?newObj[prop]=function(){obj[prop]()}:newObj[prop]=obj[prop]}(prop);return newObj},O.isFrozen=function(obj){return!!Object.isFrozen&&Object.isFrozen(obj)},O.freeze=Object.freeze?function(obj){return Object.freeze(obj)}:function(obj){return obj},O.deepFreeze=Object.freeze?function(obj){var prop,propKey;Object.freeze(obj);for(propKey in obj)prop=obj[propKey],obj.hasOwnProperty(propKey)&&prop instanceof Object&&!O.isFrozen(prop)&&O.deepFreeze(prop);return obj}:function(obj){return obj},Util.Object=O}(Util),function(O){function owns(obj,key){return!!obj&&hasOwn.call(obj,key)}var hasOwn=Object.prototype.hasOwnProperty;O.each=function(obj,fn,thisObj,proto){var key;for(key in obj)(proto||owns(obj,key))&&fn.call(thisObj||window,obj[key],key,obj)},O.mix=function(receiver,supplier,overwrite,whitelist,mode,merge){var alwaysOverwrite,exists,from,i,key,len,to;if(!receiver||!supplier)return receiver||{};if(mode){if(2===mode&&O.mix(receiver.prototype,supplier.prototype,overwrite,whitelist,0,merge),from=1===mode||3===mode?supplier.prototype:supplier,to=1===mode||4===mode?receiver.prototype:receiver,!from||!to)return receiver}else from=supplier,to=receiver;if(alwaysOverwrite=overwrite&&!merge,whitelist)for(i=0,len=whitelist.length;i<len;++i)key=whitelist[i],hasOwn.call(from,key)&&(exists=!alwaysOverwrite&&key in to,merge&&exists&&isObject(to[key],!0)&&isObject(from[key],!0)?O.mix(to[key],from[key],overwrite,null,0,merge):!overwrite&&exists||(to[key]=from[key]));else for(key in from)hasOwn.call(from,key)&&(exists=!alwaysOverwrite&&key in to,merge&&exists&&isObject(to[key],!0)&&isObject(from[key],!0)?O.mix(to[key],from[key],overwrite,null,0,merge):!overwrite&&exists||(to[key]=from[key]));return receiver}}(Util.Object),function(JSON){"object"!=typeof JSON&&"object"==typeof YAHOO&&((JSON={}).stringify=YAHOO.lang.JSON.stringify,JSON.parse=YAHOO.lang.JSON.parse)}(window.JSON,window.YAHOO),Util.Number=function(){},Util.Number.parse=function(str){return parseInt(str,10)},Util.Number.limit=function(num,min,max){return Math.min(max,Math.max(min,num))},Util.Number.from=function(item){var number=parseFloat(item);return isFinite(number)?number:null},Util.String=function(){},Util.String.equals=function(str1,str2,options){return options=options||{},"string"==typeof str1&&"string"==typeof str2&&(options.trim&&(str1=str1.trim(),str2=str2.trim()),options.ignoreCase&&(options.useLocale?(str1=str1.toLocaleLowerCase(),str2=str2.toLocaleLowerCase()):(str1=str1.toLowerCase(),str2=str2.toLowerCase())),str1===str2)},Util.String.startsWith=function(str,prefix){return str&&0===str.indexOf(prefix)},Util.String.endsWith=function(str,suffix){return str&&str.match(suffix+"$")==suffix},Util.String.contains=function(str,search){return str&&search&&-1!==str.indexOf(search)},Util.String.isHttpProtocol=function(str){return Util.String.startsWith(str,"http:")||Util.String.startsWith(str,"https:")},Util.String.format=function(){for(var str=arguments[0],i=0;i<arguments.length-1;i++){var reg=new RegExp("\\{"+i+"\\}","gm");str=str.replace(reg,arguments[i+1])}return str},Util.String.getUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},Util.String.isNullOrEmpty=function(str){return null==str||(!YAHOO.lang.isString(str)||0===str.length)},Util.String.isNullOrWhiteSpace=function(str){return!!Util.String.isNullOrEmpty(str)||0===(str=YAHOO.lang.trim(str)).length},Util.String.capitalize=function(str){return str.charAt(0).toUpperCase()+str.slice(1)},Util.String._HASHCODE_MAX=4294967296,Util.String.hashCode=function(str){for(var hash=0,len=str.length,i=0;i<len;++i)hash=31*hash+str.charCodeAt(i),hash%=Util.String._HASHCODE_MAX;return hash},Util.HashCombiner=function(){this._hash=17},Util.HashCombiner.prototype.get=function(){return this._hash},Util.HashCombiner.prototype.add=function(str){this._hash=31*this._hash+Util.String.hashCode(str.toString()),this._hash%=Util.String._HASHCODE_MAX},String.prototype.startsWith||(String.prototype.startsWith=function(s){return 0===this.indexOf(s)}),function(Util){function SB(value){this._arr=[],value&&this.append(value)}SB.prototype.append=function(value){this._arr.push(value)},SB.prototype.appendLine=function(value){value&&this.append(value),this.append("\n")},SB.prototype.appendFormat=function(){var str=Util.String.format.apply(this,arguments);this.append(str)},SB.prototype.appendSub=function(str,obj){str=YAHOO.lang.substitute(str,obj),this.append(str)},SB.prototype.toString=function(separator){return separator=separator||"",this._arr.join(separator)},Util.StringBuilder=SB}(Util),function(Util){function xPad(x,pad,r){for(void 0===r&&(r=10);parseInt(x,10)<r&&r>1;r/=10)x=pad.toString()+x;return x.toString()}Util.Date={},Util.Date.formatTime=function(d){var hour=d.getHours()%12;return(hour=xPad(0===hour?12:hour,0))+":"+xPad(d.getMinutes(),0)+":"+xPad(d.getSeconds(),0)+"."+xPad(d.getMilliseconds(),0)},Util.Date.now=Date.now||function(){return+new Date},Util.Date.xPad=xPad}(Util),Util.Converters={},Util.Converters.parseBoolean=function(value){return YAHOO.util.Lang.isNull(value)?null:YAHOO.util.Lang.isBoolean(value)?value:YAHOO.util.Lang.isString(value)?"true"===value.toLowerCase():null},Util.Converters.parseInt=function(value){return YAHOO.util.Lang.isNull(value)?null:YAHOO.util.Lang.isNumber(value)?value:YAHOO.util.Lang.isString(value)?1*value:null},function(Util){var A={},Native=Array.prototype;A.isArray=function(arg){return Array.isArray?Array.isArray(arg):"[object Array]"===Object.prototype.toString.call(arg)},A.each=function(a,f,o){Native.forEach.call(a||[],f,o)},A.map=function(a,f,o){return Native.map.call(a,f,o)},A.filter=function(a,f,o){return Native.filter.call(a,f,o)},A.reject=function(a,f,o){return A.filter(a,function(item,i,a){return!f.call(o,item,i,a)})},A.reduce=function(a,init,f,o){return Native.reduce.call(a,function(init,item,i,a){return f.call(o,init,item,i,a)},init)},A.every=function(a,f,o){return Native.every.call(a,f,o)},A.some=function(a,f,o){return Native.some.call(a,f,o)},A.find=function(list,predicate,thisArg){if(null==list)throw new TypeError("array is null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");if(list.find)return list.find(predicate,thisArg);for(var len=list.length,i=0;i<len;i++)if(predicate.call(thisArg,list[i],i,list))return list[i]},A.findWhere=function(list,predicate,thisArg){if(null==list)throw new TypeError("array is null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");for(var len=list.length,i=0;i<len;i++){var value=predicate.call(thisArg,list[i],i,list);if(value)return value}},A.findIndex=function(list,predicate,thisArg){if(null==list)throw new TypeError("array is null or undefined");if("function"!=typeof predicate)throw new TypeError("predicate must be a function");if(list.findIndex)return list.findIndex(predicate,thisArg);for(var len=list.length,i=0;i<len;i++)if(predicate.call(thisArg,list[i],i,list))return i;return-1},A.concat=function(var_args){return Native.concat.apply(Native,arguments)},A.splice=function(arr,index,howMany,var_args){return Util.Asserts.assert(null!=arr.length),Native.splice.apply(arr,A.slice(arguments,1))},A.slice=function(arr,start,opt_end){return Util.Asserts.assert(null!=arr.length),arguments.length<=2?Native.slice.call(arr,start):Native.slice.call(arr,start,opt_end)},A.contains=function(arr,obj){return arr.indexOf(obj)>=0},A.clone=function(arr){return arr.slice(0)},A.removeAt=function(arr,i){return 1==Array.prototype.splice.call(arr,i,1).length},A.remove=function(arr,obj){var rv,i=arr.indexOf(obj);return(rv=i>=0)&&A.removeAt(arr,i),rv},A.clear=function(arr){if(!A.isArray(arr))for(var i=arr.length-1;i>=0;i--)delete arr[i];arr.length=0},A.isEmpty=function(arr){return 0==arr.length},A.insertAt=function(arr,obj,opt_i){A.splice(arr,opt_i,0,obj)},A.insertBefore=function(arr,obj,target){var idx=arr.indexOf(obj);return-1!=idx&&(0==idx?arr.unshift(target):A.insertAt(arr,target,idx),!0)},A.insertAfter=function(arr,obj,target){var idx=arr.indexOf(obj);return-1!=idx&&(idx==arr.length-1?arr.push(target):A.insertAt(arr,target,idx+1),!0)},A.partition=function(a,f,o){var results={matches:[],rejects:[]};return A.each(a,function(item,index){(f.call(o,item,index,a)?results.matches:results.rejects).push(item)}),results},A.zip=function(a,a2){var results=[];return A.each(a,function(item,index){results.push([item,a2[index]])}),results},A.unique=function(a,sort){sort=sort||!1;var uniqueList=a.slice(),i=0,n=-1,item=null;if(sort){for(;i<uniqueList.length;)uniqueList[i]===item?(n=-1==n?i:n,i+=1):-1!==n?(uniqueList.splice(n,i-n),i=n,n=-1):(item=uniqueList[i],i+=1);return uniqueList}for(;i<uniqueList.length;){for(item=uniqueList[i];(n=uniqueList.lastIndexOf(item))!==i;)uniqueList.splice(n,1);i+=1}return uniqueList},A.uniqueStrings=function(list){var i,bucket={},l=list.length,uniqueList=[];for(i=0;i<l;i++)null!=list[i]&&0!=list[i].length&&(bucket[list[i]]=null);for(key in bucket)uniqueList.push(key);return uniqueList},A.first=function(arr,defaultValue){var value=arr&&arr[0];return null!=value?value:void 0!==defaultValue?defaultValue:null},A.last=function(arr,defaultValue){var value=arr&&arr[arr.length-1];return null!=value?value:void 0!==defaultValue?defaultValue:null},A.pick=function(values){for(var i=0,l=values.length;i<l;i++)if(null!=values[i])return values[i];return null},A.peek=function(array){return array[array.length-1]},A.flatten=function(a){var i,len,val,result=[];if(!a)return result;for(i=0,len=a.length;i<len;++i)val=a[i],A.isArray(val)?result.push.apply(result,A.flatten(val)):result.push(val);return result},A.mapFlatten=function(a,f,o){return A.flatten(A.map(a,f,o))},A.defaultCompare=function(a,b){return a>b?1:a<b?-1:0},A.numericSort=function(a,b){return a-b},A.sort=function(arr,opt_compareFn){null!=arr.length&&Array.prototype.sort.call(arr,opt_compareFn||A.defaultCompare)},A.stableSort=function(arr,opt_compareFn){for(i=0;i<arr.length;i++)arr[i]={index:i,value:arr[i]};var valueCompareFn=opt_compareFn||A.defaultCompare;A.sort(arr,function(obj1,obj2){return valueCompareFn(obj1.value,obj2.value)||obj1.index-obj2.index});for(var i=0;i<arr.length;i++)arr[i]=arr[i].value},A.shuffle=function(arr){for(var temporaryValue,randomIndex,currentIndex=arr.length;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),temporaryValue=arr[currentIndex-=1],arr[currentIndex]=arr[randomIndex],arr[randomIndex]=temporaryValue;return arr},A.transform=function(arr,fn,accumulator){return accumulator=accumulator||[],fn&&arr.forEach(fn.bind(this,accumulator)),accumulator},Util.Array=A}(Util),Util.Structs={},Util.Structs.Stack=function(){this._arr=[]},Util.Structs.Stack.prototype.push=function(element){this._arr.push(element)},Util.Structs.Stack.prototype.pop=function(){return this._arr.pop()},Util.Structs.Stack.prototype.peek=function(){return this._arr[this._arr.length-1]},Util.Structs.Queue=function(){this._elements=[]},Util.Structs.Queue.prototype._head=0,Util.Structs.Queue.prototype._tail=0,Util.Structs.Queue.prototype.enqueue=function(element){this._elements[this._tail++]=element},Util.Structs.Queue.prototype.dequeue=function(){if(this._head!=this._tail){var result=this._elements[this._head];return delete this._elements[this._head],this._head++,result}},Util.Structs.Queue.prototype.peek=function(){if(this._head!=this._tail)return this._elements[this._head]},Util.Structs.Queue.prototype.getCount=function(){return this._tail-this._head},Util.Structs.Queue.prototype.isEmpty=function(){return this._tail-this._head==0},Util.Structs.Queue.prototype.clear=function(){this._elements.length=0,this._head=0,this._tail=0},Util.Structs.Queue.prototype.contains=function(obj){return Util.Array.contains(this._elements,obj)},Util.Structs.Queue.prototype.remove=function(obj){var index=this._elements.indexOf(obj);return!(index<0)&&(index==this._head?this.dequeue():(Util.Array.removeAt(this._elements,index),this._tail--),!0)},Util.Structs.Queue.prototype.getValues=function(){return this._elements.slice(this._head,this._tail)},Util.Structs.Map=function(opt_map,var_args){this._count=0,this._version=0,this._map={},this._keys=[];var argLength=arguments.length;if(argLength>1){if(argLength%2)throw Error("Uneven number of arguments");for(var i=0;i<argLength;i+=2)this.set(arguments[i],arguments[i+1])}else opt_map&&this.addAll(opt_map)},Util.Structs.Map.prototype.getCount=function(){return this._count},Util.Structs.Map.prototype.getValues=function(){this._cleanupKeysArray();for(var rv=[],i=0;i<this._keys.length;i++){var key=this._keys[i];rv.push(this._map[key])}return rv},Util.Structs.Map.prototype.getKeys=function(){return this._cleanupKeysArray(),this._keys.concat()},Util.Structs.Map.prototype.containsKey=function(key){return Util.Structs.Map._hasKey(this._map,key)},Util.Structs.Map.prototype.containsValue=function(val){for(var i=0;i<this._keys.length;i++){var key=this._keys[i];if(Util.Structs.Map._hasKey(this._map,key)&&this._map[key]==val)return!0}return!1},Util.Structs.Map.prototype.equals=function(otherMap,opt_equalityFn){if(this===otherMap)return!0;if(this._count!=otherMap.getCount())return!1;var equalityFn=opt_equalityFn||Util.Structs.Map.defaultEquals;this._cleanupKeysArray();for(var key,i=0;key=this._keys[i];i++)if(!equalityFn(this.get(key),otherMap.get(key)))return!1;return!0},Util.Structs.Map.defaultEquals=function(a,b){return a===b},Util.Structs.Map.prototype.isEmpty=function(){return 0==this._count},Util.Structs.Map.prototype.clear=function(){this._map={},this._keys.length=0,this._count=0,this._version=0},Util.Structs.Map.prototype.remove=function(key){return!!Util.Structs.Map._hasKey(this._map,key)&&(delete this._map[key],this._count--,this._version++,this._keys.length>2*this._count&&this._cleanupKeysArray(),!0)},Util.Structs.Map.prototype._cleanupKeysArray=function(){if(this._count!=this._keys.length){for(var srcIndex=0,destIndex=0;srcIndex<this._keys.length;){key=this._keys[srcIndex];Util.Structs.Map._hasKey(this._map,key)&&(this._keys[destIndex++]=key),srcIndex++}this._keys.length=destIndex}if(this._count!=this._keys.length){for(var seen={},srcIndex=0,destIndex=0;srcIndex<this._keys.length;){var key=this._keys[srcIndex];Util.Structs.Map._hasKey(seen,key)||(this._keys[destIndex++]=key,seen[key]=1),srcIndex++}this._keys.length=destIndex}},Util.Structs.Map.prototype.get=function(key,opt_val){return Util.Structs.Map._hasKey(this._map,key)?this._map[key]:opt_val},Util.Structs.Map.prototype.set=function(key,value){Util.Structs.Map._hasKey(this._map,key)||(this._count++,this._keys.push(key),this._version++),this._map[key]=value},Util.Structs.Map.prototype.addAll=function(map){var keys,values;map instanceof Util.Structs.Map?(keys=map.getKeys(),values=map.getValues()):(keys=Util.Object.getKeys(map),values=Util.Object.getValues(map));for(var i=0;i<keys.length;i++)this.set(keys[i],values[i])},Util.Structs.Map.prototype.clone=function(){return new Util.Structs.Map(this)},Util.Structs.Map._hasKey=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},function(Util){function Iterator(ref,options){if(!(this instanceof Iterator))return new Iterator(ref,options);this.options={pit:!1,limits:!1,chains:!1},YAHOO.lang.isObject(options)&&YAHOO.lang.augmentObject(this.options,options,!0),this._ref=ref,this.ref=function(){return this._ref},this._key=null,this.setKey=function(key){return this._key=key},this.jump=function(key){return key=this.setKey(this.valid(key)),this.options.chains?this:this.current(key)},this.key=function(){var key=this.valid(this._key);return this.setKey(key)};var min,max;with(this.options)min=Util.Array.pick([this.options.min,0]),max=Util.Array.pick([this.options.max,ref.length-1])}Iterator.prototype.jumpTo=function(obj){var idx=this.ref().indexOf(obj);return idx>=0?this.jump(idx):null},Iterator.prototype.valid=function(){var length=this.ref().length,key=arguments.length>0?Util.Number.from(arguments[0]):this.key();if(null===key||0===length)return null;if(key<0&&(key=this.ref().length+key),key<0||key>length-1)return null;return key},Iterator.prototype.reset=function(){var range=this.range(1),key=range.length?range[0]:null;return this.jump(key)},Iterator.prototype.rewind=function(){return this.jump(null)},Iterator.prototype.end=function(){var range=this.range(1),key=range.length?range.pop():null;return this.jump(key),this.current(key)},Iterator.prototype.next=function(){return this.slide(1)},Iterator.prototype.prev=function(){return this.slide(-1)},Iterator.prototype.current=function(key){return null===(key=void 0===key?this.key():this.valid(key))?null:this.ref()[key]},Iterator.prototype.slide=function(offset,from){offset=parseInt(offset);var range=this.range(1),key=Util.Array.pick([Util.Number.from(from),this.key()]),limit=this.options.limits,pit=this.options.pit;if(!range.length||null===offset||limit&&null===key&&offset<0)return this.jump(null);if(0===offset)return this.current();pit&&range.unshift(null);var max=range.length-1;null===key?(key=pit?1:0,limit?(offset--,key=pit?1:0):offset<0?(offset++,key=max):offset--):key=range.indexOf(key),!pit&&!limit&&Math.abs(offset)>=range.length&&(offset%=range.length);var more=(key+=offset)>max,less=key<0;return(more||less)&&(pit&&limit?key=null:more?key=limit?max:key-max-1:less&&(key=limit?0:key+max+1)),this.jump(range[key])},Iterator.prototype.range=function(){var array=this.ref(),length=array.length-1,keys=Util.Object.keys(array),pub=!arguments[0];return length<0?[]:pub?array:Util.Array.map(keys,function(item){return parseInt(item)})},Util.Iterator=Iterator}(Util),function(Util){function _getTextContent(node,buf,normalizeWhitespace){if(node.nodeName in TAGS_TO_IGNORE);else if(node.nodeType==NODE_TYPE.TEXT)normalizeWhitespace?buf.push(String(node.nodeValue).replace(/(\r\n|\r|\n)/g,"")):buf.push(node.nodeValue);else if(node.nodeName in PREDEFINED_TAG_VALUES)buf.push(PREDEFINED_TAG_VALUES[node.nodeName]);else for(var child=node.firstChild;child;)_getTextContent(child,buf,normalizeWhitespace),child=child.nextSibling}var D={};D.get=function(el){return"string"==typeof el?document.getElementById(el):el};var DocClass=window.HTMLDocument||window.Document;D.isDocument=function(obj){return obj instanceof DocClass||"[object HTMLDocument]"==Object.prototype.toString.call(obj)},D.getWindow=function(doc){return doc?doc.defaultView||doc.parentWindow:null},D.getFrameContentDocument=function(frame){return frame?YAHOO.env.ua.webkit?frame.document||frame.contentWindow.document:frame.contentDocument||frame.contentWindow.document:null},D.getFrameContentWindow=function(frame){return frame?frame.contentWindow||this.getWindow(this.getFrameContentDocument(frame)):null},D.getOwnerDocument=function(node){return node.nodeType==NODE_TYPE.DOCUMENT?node:node.ownerDocument||node.document},D.getOwnerWindow=function(node){var doc=D.getOwnerDocument(node);return doc?D.getWindow(doc):null},D.copyCSSFrame=function(frameID){var frame=YUD.get(frameID);return null!=frame&&""!=frame.src&&(null!=frame.contentDocument&&null!=frame.contentDocument.body&&(frame.contentDocument.body.className=document.body.className,!0))},D.isVisible=function(node){if(!(node=YUD.get(node)))return!1;for(;node&&"body"!=node.nodeName.toLowerCase()&&"none"!=YUD.getStyle(node,"display")&&"hidden"!=YUD.getStyle(node,"visibility");)node=node.parentNode;return!(!node||"body"!=node.nodeName.toLowerCase())},D.getFocusableElements=function(root){root=root||this.innerElement;for(var focusableTags=["a","button","select","textarea","input","iframe"],focusable={},i=0;i<focusableTags.length;i++)focusable[focusableTags[i]]=!0;return YUD.getElementsBy(function(el){return!(!el.focus||"hidden"===el.type||el.disabled||!focusable[el.tagName.toLowerCase()])},null,root)},D.isFormElement=function(el){return 3==el.nodeType&&(el=el.parentNode)," button textarea input select option ".indexOf(" "+el.tagName.toLowerCase()+" ")>=0},D.focus=function(obj){if(!obj||"function"!=typeof obj.focus)return!1;try{obj.focus()}catch(ex){return!1}return!0},D.blur=function(obj){if(!obj||"function"!=typeof obj.blur)return!1;try{obj.blur()}catch(ex){return!1}return!0},D.focusWindow=function(delay){YAHOO.lang.isNumber(delay)?setTimeout(function(){D.focus(window)},delay):D.focus(window)},D.getAncestor=function(needle,haystacks){if(null==needle||null==haystacks)return!1;var isMatch=function(element){for(var i=0;i<haystacks.length;i++)if(haystacks[i]==element)return!0;return!1};if(isMatch(needle))return needle;var element=null;try{element=YUD.getAncestorBy(needle,function(ancestor){return isMatch(ancestor)})}catch(ex){}return element},D.isNode=function(o){return"function"==typeof Node?o instanceof Node:o&&"object"==typeof o&&"number"==typeof o.nodeType&&"string"==typeof o.nodeName},D.isElement=function(o){return"function"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&1===o.nodeType&&"string"==typeof o.nodeName};var TEXT_TYPES={text:1,password:1};D.isTextInput=function(el){if(!el)return!1;if(el.tagName&&"textarea"==el.tagName.toLowerCase())return!0;if(el.tagName&&"input"==el.tagName.toLowerCase()&&TEXT_TYPES[el.type])return!0;if(""==el.contentEditable||"true"==el.contentEditable)return!0;if(el.isContentEditable)return!0;var doc=D.getOwnerDocument(el);if(doc){if("on"==doc.designMode)return!0;if("true"==YUD.getAttribute(doc.body,"data-tds-textinput"))return!0}return!1},D.isImgLoaded=function(img){return!!img.complete&&(void 0===img.naturalWidth||0!=img.naturalWidth)};var NODE_TYPE=D.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};D.removeNode=function(node){return node&&node.parentNode?node.parentNode.removeChild(node):null},D.removeChildren=function(node){for(var child;child=node.firstChild;)node.removeChild(child)};var DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder",maxlength:"maxLength",type:"type"};D.setProperties=function(element,properties){for(key in properties){var val=properties[key];"style"==key?element.style.cssText=val:"class"==key?element.className=val:"for"==key?element.htmlFor=val:0==key.lastIndexOf("aria-",0)?element.setAttribute(key,val):key in DIRECT_ATTRIBUTE_MAP?element.setAttribute(DIRECT_ATTRIBUTE_MAP[key],val):element[key]=val}},D.setTextContent=function(element,text){if("textContent"in element)element.textContent=text;else if(element.firstChild&&element.firstChild.nodeType==NODE_TYPE.TEXT){for(;element.lastChild!=element.firstChild;)element.removeChild(element.lastChild);element.firstChild.data=text}else{D.removeChildren(element);var doc=D.getOwnerDocument(element);element.appendChild(doc.createTextNode(text))}},D.setOuterHTML=function(el,html,doc){function setHTML(el,html,doc){var n,tp;for((tp=doc.createElement("body")).innerHTML=html,n=tp.lastChild;n;)YUD.insertAfter(n.cloneNode(!0),el),n=n.previousSibling;D.removeNode(el)}if(!(el=YAHOO.util.Dom.get(el))||1!=el.nodeType)return null;if(doc=doc||el.ownerDocument||document,YAHOO.env.ua.ie)try{el.outerHTML=html}catch(ex){setHTML(el,html,doc)}else setHTML(el,html,doc);return el};var TAGS_TO_IGNORE={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1},PREDEFINED_TAG_VALUES={IMG:" ",BR:"\n"};D.getTextContent=function(node){var textContent;if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9&&"innerText"in node)textContent=node.innerText.replace(/(\r\n|\r|\n)/g,"\n");else{var buf=[];_getTextContent(node,buf,!0),textContent=buf.join("")}return textContent=textContent.replace(/ \xAD /g," ").replace(/\xAD/g,""),YAHOO.env.ua.ie||(textContent=textContent.replace(/ +/g," "))," "!=textContent&&(textContent=textContent.replace(/^\s*/,"")),textContent},D.contains=function(parent,descendant){if(parent.contains&&descendant.nodeType==NODE_TYPE.ELEMENT)return parent==descendant||parent.contains(descendant);if(void 0!==parent.compareDocumentPosition)return parent==descendant||Boolean(16&parent.compareDocumentPosition(descendant));for(;descendant&&parent!=descendant;)descendant=descendant.parentNode;return descendant==parent},D.compareNodeOrder=function(node1,node2){return node1==node2?0:D.isNode(node1)&&D.isNode(node2)?2&node1.compareDocumentPosition(node2)?1:-1:0},D.sort=function(arr){Util.Array.sort(arr,D.compareNodeOrder)},D.toggleClass=function(node,className,force){(void 0!==force?force:!YUD.hasClass(node,className))?YUD.addClass(node,className):YUD.removeClass(node,className)},D.getElementByClassName=function(className,tag,root,apply,o,overrides){var elements=YUD.getElementsByClassName(className,tag,root,apply,o,overrides);return elements.length>0?elements[0]:null},D.getSelectionRange=function(win){var selection=(win=win||window).getSelection(),range=null;if(selection&&selection.rangeCount>0)try{range=selection.getRangeAt(0)}catch(ex){}return range},D.getElementRegions=function(el){var regions=[];if(el.getClientRects)for(var clientRects=el.getClientRects(),i=0,ii=clientRects.length;i<ii;i++){var clientRect=clientRects[i],region=new YAHOO.util.Region(clientRect.top,clientRect.right,clientRect.bottom,clientRect.left);regions.push(region)}else{var targetPos=YAHOO.util.Dom.getXY(el),top=targetPos[1],left=targetPos[0],bottom=top+el.offsetHeight,right=left+el.offsetWidth,region=new YAHOO.util.Region(top,right,bottom,left);regions.push(region)}return regions},D.createElementFromHtml=function(html){var div=document.createElement("div");return div.innerHTML=html,YUD.getFirstChild(div)},D.batch=function(nodes,method,scope){for(var count=nodes.length,i=0;i<count;i++){var node=nodes[i];"object"==typeof scope?method.call(scope,node):method(node)}},D.queryTags=function(name,context){return(context=context||document).getElementsByTagName(name)},D.queryTag=function(name,context){var results=D.queryTags(name,context);return results.length>0?results[0]:null},D.queryTagsBatch=function(name,context,method,scope){var results=D.queryTags(name,context);return D.batch(results,method,scope)},D.getElementsByTagName=function(name,context){var collection=(context=context||document).getElementsByTagName(name);return Util.Array.slice(collection)},D.getElementByTagName=function(name,context){var list=D.getElementsByTagName(name,context);return list.length>0?list[0]:null},D.batchElementsByTagName=function(name,context,method,scope){var list=D.getElementsByTagName(name,context);return D.batch(list,method,scope)},D.querySelectorAll=function(selector,context){var nodeList=(context=context||document).querySelectorAll(selector);return Util.Array.slice(nodeList)},D.querySelector=function(selector,context){return(context=context||document).querySelector(selector)},D.batchQuerySelector=function(selector,context,method,scope){var results=D.querySelectorAll(selector,context);return D.batch(results,method,scope)},D.querySelectorBatch=D.batchQuerySelector,D.stopAllEvents=function(el,type){YUE.on(el,type,YUE.stopEvent,YUE,!0)},D.stopDragEvents=function(el){el=el||window,D.stopAllEvents(el,"dragstart"),D.stopAllEvents(el,"draggesture")},D.stopDropEvents=function(el){el=el||window,D.stopAllEvents(el,"drop")},D.renameTag=function(el,tag){var replacementEl=el.ownerDocument.createElement(tag);$.each(el.attributes,function(idx,attrib){replacementEl.setAttributeNode(attrib.cloneNode(!0))});var $el=$(el),$replacement=$(replacementEl),contents=$el.children().clone(!0);return $replacement.append(contents),$replacement.data($el.data()),$el.replaceWith($replacement),replacementEl},Util.Dom=D}(window.Util),function(D){function processChild(child){if(L.isNull(child)||L.isUndefined(child))return null;if(L.isArray(child)){for(var r,fn=arguments.callee,l=[],i=0;i<child.length;i++)if(r=fn.call(this,child[i]),L.isArray(r))for(var j=0;j<r.length;j++)l.push(r[j]);else l.push(r);return l}return L.isString(child)||L.isNumber(child)?document.createTextNode(child):L.isFunction(child)?arguments.callee.call(this,child.call(this)):child}function __replaceWord(w){return w.substr(1,2).toUpperCase()}function processStyleName(k){return k.replace(/\-\w/,__replaceWord)}function processAttr(k,v){if("style"==k&&L.isObject(v)){var d={};for(var sk in v)L.isValue(v[sk])&&(d[processStyleName(sk)]=v[sk]);return d}return!L.isString(v)&&L.isValue(v)?v.toString():L.isFunction(v)?arguments.callee.call(this,k,v()):v}function createDom(tag,attrs){if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9&&L.isObject(attrs)&&(attrs.name||attrs.type)){var tagNameArr=["<",tag];attrs.name&&tagNameArr.push(' name="',attrs.name,'"'),attrs.type&&(tagNameArr.push(' type="',attrs.type,'"'),delete(attrs=L.merge(attrs)).type),tagNameArr.push(">"),tag=tagNameArr.join("")}var el=document.createElement(tag);if(L.isObject(attrs))for(var key in attrs)if(L.hasOwnProperty(attrs,key)){var attr=processAttr.call(this,key,attrs[key]);if("style"===key)if(L.isObject(attr))for(var sk in attr)L.hasOwnProperty(attr,sk)&&YUD.setStyle(el,sk,attr[sk]);else el.style.cssText=attr;else"class"===key?el.className=attr:YUD.setAttribute(el,key,attr)}for(var children=[],i=2;i<arguments.length;i++)children.push(arguments[i]);for(i=0;i<children.length;i++){var child=processChild.call(this,children[i]);if(!L.isNull(child))if(L.isArray(child))for(var j=0;j<child.length;j++)el.appendChild(child[j]);else el.appendChild(child)}return el}function makeTag(t){var tag_name=t.toUpperCase();return tag_cache.hasOwnProperty(tag_name)?tag_cache[tag_name]:Util.Function.bind(createDom,null,t)}var L=YAHOO.lang,HTML={};HTML.createDom=createDom;var tag_cache={};HTML.makeTag=makeTag;for(var tag,tags=["a","button","br","canvas","dd","div","dl","dt","em","fieldset","form","h1","h2","h3","h4","h5","h6","hr","img","input","label","legend","li","ol","optgroup","option","p","pre","select","span","strong","table","tbody","td","textarea","tfoot","th","thead","tr","tt","ul"],i=0,i_max=tags.length;i<i_max;i++)HTML[(tag=tags[i]).toUpperCase()]=makeTag(tag);D.Builder=HTML,window.HTML=HTML}(Util.Dom),Util.Style={},Util.Style._getCascadedStyle=function(element,style){return element.currentStyle?element.currentStyle[style]:null},Util.Style._ieBorderWidthKeywords={thin:2,medium:4,thick:6},Util.Style._getIePixelValue=function(element,value,name,pixelName){if(/^\d+px?$/.test(value))return parseInt(value,10);var oldStyleValue=element.style[name],oldRuntimeValue=element.runtimeStyle[name];element.runtimeStyle[name]=element.currentStyle[name],element.style[name]=value;var pixelValue=element.style[pixelName];return element.style[name]=oldStyleValue,element.runtimeStyle[name]=oldRuntimeValue,pixelValue},Util.Style._getIePixelBorder=function(element,prop){if("none"==Util.Style._getCascadedStyle(element,prop+"Style"))return 0;var width=Util.Style._getCascadedStyle(element,prop+"Width");return width in Util.Style._ieBorderWidthKeywords?Util.Style._ieBorderWidthKeywords[width]:Util.Style._getIePixelValue(element,width,"left","pixelLeft")},Util.Style.getBorderBox=function(element){if(YAHOO.env.ua.ie){var left=Util.Style._getIePixelBorder(element,"borderLeft"),right=Util.Style._getIePixelBorder(element,"borderRight"),top=Util.Style._getIePixelBorder(element,"borderTop"),bottom=Util.Style._getIePixelBorder(element,"borderBottom");return new YAHOO.util.Region(top,right,bottom,left)}var left=YUD.getComputedStyle(element,"borderLeftWidth"),right=YUD.getComputedStyle(element,"borderRightWidth"),top=YUD.getComputedStyle(element,"borderTopWidth"),bottom=YUD.getComputedStyle(element,"borderBottomWidth");return new YAHOO.util.Region(parseFloat(top),parseFloat(right),parseFloat(bottom),parseFloat(left))},Util.Style.getPageOffset=function(element){var region=YUD.getRegion(element);return{x:region.left,y:region.top}},Util.Style.scrollIntoContainerView=function(element,container,opt_center){var elementPos=Util.Style.getPageOffset(element),containerPos=Util.Style.getPageOffset(container),containerBorder=Util.Style.getBorderBox(container),relX=elementPos.x-containerPos.x-containerBorder.left,relY=elementPos.y-containerPos.y-containerBorder.top,spaceX=container.clientWidth-element.offsetWidth,spaceY=container.clientHeight-element.offsetHeight;opt_center?(container.scrollLeft+=relX-spaceX/2,container.scrollTop+=relY-spaceY/2):(container.scrollLeft+=Math.min(relX,Math.max(relX-spaceX,0)),container.scrollTop+=Math.min(relY,Math.max(relY-spaceY,0)))},Util.Style.setStyles=function(element,stylesString){YAHOO.env.ua.ie?element.cssText=stylesString:element[YAHOO.env.ua.webkit?"innerText":"innerHTML"]=stylesString},Util.Style.installStyles=function(doc,stylesString){var styleSheet=null;if(YAHOO.env.ua.ie)styleSheet=doc.createStyleSheet(),Util.Style.setStyles(styleSheet,stylesString);else{var head=doc.getElementsByTagName("head")[0];styleSheet=doc.createElement("style"),Util.Style.setStyles(styleSheet,stylesString),head.appendChild(styleSheet)}return styleSheet},Util.Promise={},function(P,Q){Q.stopUnhandledRejectionTracking(),P.defer=Q.defer,P.isPromise=Q.isPromise,P.when=Q.when}(Util.Promise,Q),function(Util){function addEventListener(type,el,listener,useCapture){return el.addEventListener(type,listener,useCapture),{destroy:function(){el.removeEventListener(type,listener,useCapture)}}}var E={};E.hasModifier=function(ev){return ev.ctrlKey||ev.altKey||ev.metaKey},E.inTextInput=function(ev){var target=YAHOO.util.Event.getTarget(ev);return Util.Dom.isTextInput(target)},E.Mouse="ontouchstart"in window?{start:"touchstart",end:"touchend",move:"touchmove",click:"click",enter:"touchenter",leave:"touchleave",touchScreen:!0}:{start:"mousedown",end:"mouseup",move:"mousemove",click:"click",enter:"mouseenter",leave:"mouseleave",touchScreen:!1},E.normalize=function(evt){if("ontouchstart"in window&&evt.changedTouches)for(var touches=evt.changedTouches,i=0,ii=touches.length;i<ii;i++)if(touches[i].target==evt.target){var oldevt=evt;(evt=touches[i]).preventDefault=function(){return oldevt.preventDefault()},evt.stopPropagation=function(){return oldevt.stopPropagation()};break}return evt},E.on=function(type,el,listener,useCapture){if(!(el=Util.Dom.get(el)))throw new Error("Element not found");return useCapture=useCapture||!1,addEventListener(type,el,listener,useCapture)};var EventMap={start:"pointerdown",move:"pointermove",end:"pointerend"};E.addTouchMouse=function(name,el,listener){var type=EventMap[name];if(!type)throw new Error("Unknown event name: "+name);return E.on(type,el,listener)},Util.Event=E}(Util),Util=window.Util||{},Util.Event=Util.Event||{},function(UE){function Subscriber(fn,overrideContext,fireOnce){this.fn=fn,this.overrideContext=overrideContext,this.fireOnce=fireOnce}function CE(context,fireOnce){this.scope=context||window,this.fireOnce=fireOnce,this.fired=!1,this.firedWith=null,this.subscribers=[],this.lastError=null}Subscriber.prototype.getScope=function(defaultScope){return this.overrideContext?this.overrideContext:defaultScope},Subscriber.prototype.contains=function(fn){return this.fn==fn},CE.prototype.subscribe=function(fn,overrideContext,fireOnce){if(!fn)throw new Error("Invalid callback for subscriber");var sub=new Subscriber(fn,overrideContext,fireOnce);this.fireOnce&&this.fired?this.notify(sub,this.firedWith):this.subscribers.push(sub)},CE.prototype.unsubscribe=function(fn){if(!fn)return!1;for(var found=!1,i=0,len=this.subscribers.length;i<len;++i){var sub=this.subscribers[i];sub&&sub.contains(fn)&&(this._delete(i),found=!0)}return found},CE.prototype.fire=function(){this.lastError=null;var i,len=this.subscribers.length,args=[].slice.call(arguments,0),ret=!0;if(this.fireOnce){if(this.fired)return!0;this.firedWith=args}if(this.fired=!0,!len)return!0;var subs=this.subscribers.slice();for(i=0;i<len;++i){var sub=subs[i];if(sub&&sub.fn&&(ret=this.notify(sub,args),sub.fireOnce&&this.unsubscribe(sub.fn),!1===ret))break}return!1!==ret},CE.prototype.notify=function(sub,args){var scope=sub.getScope(this.scope);return sub.fn.apply(scope,args)},CE.prototype.unsubscribeAll=function(){var i,l=this.subscribers.length;for(i=l-1;i>-1;i--)this._delete(i);return this.subscribers=[],l},CE.prototype._delete=function(index){var sub=this.subscribers[index];sub&&delete sub.fn,this.subscribers.splice(index,1)},UE.Custom=CE}(Util.Event),function(UE){function augment(obj){var events=new Emitter(obj);return obj.on=function(name,fn){return events.on(name,fn)},obj.once=function(name,fn){return events.once(name,fn)},obj.fire=function(name){var args=Array.prototype.slice.call(arguments,0);return events.fire.apply(events,args)},obj.fireArgs=function(name,args){return events.fire.apply(events,name,args)},obj.removeListener=function(name,fn){return events.removeListener(name,fn)},obj.removeAllListeners=function(){return events.removeAllListeners()},events}function Emitter(context){if(!(this instanceof Emitter))return augment(context);this.scope=context||window,this._events={},this._subscribers={}}Emitter.prototype.addListener=function(p_type,p_fn,overrideContext,fireOnce){overrideContext=overrideContext||this.scope;var ce=this._events[p_type];if(ce)ce.subscribe(p_fn,overrideContext,fireOnce);else{var subs=this._subscribers;subs[p_type]||(subs[p_type]=[]),subs[p_type].push({fn:p_fn,overrideContext:overrideContext,fireOnce:fireOnce})}},Emitter.prototype.on=Emitter.prototype.addListener,Emitter.prototype.once=function(p_type,p_fn,overrideContext){this.addListener(p_type,p_fn,overrideContext,!0)},Emitter.prototype.removeListener=function(p_type,p_fn){if(!p_type)return!1;var ce=this._events[p_type];return ce?ce.unsubscribe(p_fn):!!this._subscribers[p_type]&&(delete this._subscribers[p_type],!0)},Emitter.prototype.removeAllListeners=function(p_type,p_fn){var evts=this._events,subs=this._subscribers;if(p_type)return this.removeListener(p_type,p_fn);var ret=!1;for(p_type in evts)YAHOO.lang.hasOwnProperty(evts,p_type)&&evts[p_type].unsubscribe(p_fn)&&(ret=!0);if(!ret)for(p_type in subs)if(YAHOO.lang.hasOwnProperty(subs,p_type))if(p_fn)subs[p_type];else delete subs[p_type];return ret},Emitter.prototype.create=function(p_type,p_config){var opts=p_config||{},events=this._events,ce=events[p_type];if(!ce){ce=new UE.Custom(opts.scope||this.scope,opts.fireOnce),events[p_type]=ce;var qs=this._subscribers[p_type];if(qs)for(var i=0;i<qs.length;++i)ce.subscribe(qs[i].fn,qs[i].overrideContext,qs[i].fireOnce)}return ce},Emitter.prototype.fire=function(p_type){var ce=this._events[p_type];ce||(ce=this.create(p_type));var args=Array.prototype.slice.call(arguments,1);return ce.fire.apply(ce,args)},Emitter.prototype.fireArgs=function(p_type,args){var ce=this._events[p_type];return ce||(ce=this.create(p_type)),ce.fire.apply(ce,args)},Emitter.prototype.has=function(type){return!!this._events[type]},UE.Emitter=Emitter}(Util.Event),function(Util){function EM(context){this._context=context||null,this._events=new YAHOO.util.EventProvider}EM.prototype.subscribe=function(name,func,overrideContext){return!!YAHOO.lang.isString(name)&&(!!YAHOO.lang.isFunction(func)&&(this._events.hasEvent(name)||(this._context?this._events.createEvent(name,{scope:this._context}):this._events.createEvent(name)),this._events.subscribe(name,function(args){return args?func.apply(this,args):func.call(this)},null,overrideContext||this._context),!0))},EM.prototype.on=EM.prototype.subscribe,EM.prototype.unsubscribe=function(name,func){return this._events.unsubscribe(name,func)},EM.prototype.fireArgs=function(name,args){return this._events.fireEvent(name,args)},EM.prototype.fire=function(name){var args=Array.prototype.slice.call(arguments,1);return this.fireArgs(name,args)},Util.EventManager=EM}(Util),Util.Delay=function(listener,interval,scope){this._listener=listener,this._interval=interval||0,this._scope=scope},Util.Delay.prototype._timer=null,Util.Delay.prototype.start=function(opt_interval){this.stop(),this._timer=YAHOO.lang.later(opt_interval||this._interval,this,this._doAction)},Util.Delay.prototype.stop=function(){this.isActive()&&this._timer.cancel(),this._timer=null},Util.Delay.prototype.fire=function(){this.stop(),this._doAction()},Util.Delay.prototype.fireIfActive=function(){this.isActive()&&this.fire()},Util.Delay.prototype.isActive=function(){return null!=this._timer},Util.Delay.prototype._doAction=function(){this._timer=null,this._listener&&this._listener.call(this._scope)},Util.ConditionalDelay=function(listener,scope){this._listener=listener,this._scope=scope,this._delay=new Util.Delay(this._onTick,0,this),this.onSuccess=new YAHOO.util.CustomEvent("onSuccess",this._scope,!1,YAHOO.util.CustomEvent.FLAT),this.onFailure=new YAHOO.util.CustomEvent("onFailure",this._scope,!1,YAHOO.util.CustomEvent.FLAT)},Util.ConditionalDelay.prototype._interval=0,Util.ConditionalDelay.prototype._runUntil=0,Util.ConditionalDelay.prototype._isDone=!1,Util.ConditionalDelay.prototype.start=function(interval,timeout){this.stop(),this._isDone=!1,timeout=timeout||0,this._interval=Math.max(interval||0,0),this._runUntil=timeout<0?-1:Util.Date.now()+timeout,this._delay.start(timeout<0?this._interval:Math.min(this._interval,timeout))},Util.ConditionalDelay.prototype.stop=function(){this._delay.stop()},Util.ConditionalDelay.prototype.isActive=function(){return this._delay.isActive()},Util.ConditionalDelay.prototype.isDone=function(){return this._isDone},Util.ConditionalDelay.prototype._onTick=function(){if(this._listener.call(this._scope))this._isDone=!0,this.onSuccess.fire();else if(this._runUntil<0)this._delay.start(this._interval);else{var timeLeft=this._runUntil-Util.Date.now();timeLeft<=0?this.onFailure.fire():this._delay.start(Math.min(this._interval,timeLeft))}},Util.TaskWorkflow=function(globalContext){var _tasks=[],_callback=null,_executer=function(){var _stopped=!1;return{wait:function(){_stopped=!0},resume:function(result){var task;_stopped=!1,_tasks.length>0?(result=(task=_tasks.shift()).func.apply(task.context,[_executer,result,task.obj]),_stopped||_executer.resume(result)):_callback&&_callback.func&&_callback.func.apply(_callback.context,[_callback.obj])},cancel:function(){_stopped=!0,_tasks=[],_callback=null}}}();this.add=function(func,obj,overrideContext){if(!YAHOO.lang.isFunction(func))throw"expected function but was "+typeof func;var context=globalContext;return overrideContext&&(context=!0===overrideContext?obj:overrideContext),_tasks.push({func:func,context:context,obj:obj}),this},this.start=function(func,context,obj){_callback={func:func,context:context=context||globalContext,obj:obj},_executer.resume()}},Util.TaskWorkflow.process=function(){for(var taskQueue=new Util.TaskWorkflow,i=0;i<arguments.length;i++)taskQueue.add(arguments[i]);taskQueue.start()},Util.XhrManager=function(){function Request(id,url,opt_method,opt_content,opt_callback,opt_scope,opt_timeout,opt_maxRetries,opt_args){this._id=id,this._url=url,this._method=YAHOO.lang.isString(opt_method)?opt_method:"GET",this._content=opt_content||null,this._callback=YAHOO.lang.isFunction(opt_callback)?opt_callback:null,this._scope=YAHOO.lang.isObject(opt_scope)?opt_scope:null,this._timeout=YAHOO.lang.isNumber(opt_timeout)?opt_timeout:null,this._maxRetries=YAHOO.lang.isNumber(opt_maxRetries)?opt_maxRetries:0,this._args=opt_args,this._attemptCount=0,this._completed=!1,this._succeeded=!1,this._aborted=!1,this._transaction=null,this._response=null}function Xhr(opt_timeoutInterval,opt_maxRetries,opt_scope){this._timeoutInterval=opt_timeoutInterval,this._maxRetries=YAHOO.lang.isNumber(opt_maxRetries)?Math.max(0,opt_maxRetries):0,this._requests=new Util.Structs.Map,this._scope=opt_scope,this.Events=new Util.EventManager(this)}return Request.prototype.getId=function(){return this._id},Request.prototype.getUrl=function(){return this._url},Request.prototype.setUrl=function(url){this._url=url},Request.prototype.getMethod=function(){return this._method},Request.prototype.setMethod=function(method){this._method=method},Request.prototype.getContent=function(){return this._content},Request.prototype.setContent=function(content){this._content=content},Request.prototype.getCallback=function(){return this._callback},Request.prototype.setCallback=function(callback){this._callback=callback},Request.prototype.getScope=function(){return this._scope},Request.prototype.setScope=function(scope){this._scope=scope},Request.prototype.getTimeout=function(){return this._timeout},Request.prototype.setTimeout=function(timeout){this._timeout=timeout},Request.prototype.clearTimeout=function(){this._timeout=null},Request.prototype.getMaxRetries=function(){return this._maxRetries},Request.prototype.setMaxRetries=function(retries){this._maxRetries=retries},Request.prototype.getArgs=function(){return this._args},Request.prototype.setArgs=function(args){this._args=args},Request.prototype.getAttemptCount=function(){return this._attemptCount},Request.prototype.increaseAttemptCount=function(){this._attemptCount++},Request.prototype.resetAttemptCount=function(){this._attemptCount=0},Request.prototype.hasReachedMaxRetries=function(){return this._attemptCount>this._maxRetries},Request.prototype.setCompleted=function(complete){this._completed=complete},Request.prototype.isCompleted=function(){return this._completed},Request.prototype.setAborted=function(abort){this._aborted=abort},Request.prototype.isAborted=function(){return this._aborted},Request.prototype.setTransaction=function(tid){this._transaction=tid},Request.prototype.getTransaction=function(){return this._transaction},Request.prototype.setResponse=function(xhrObj){this._response=xhrObj},Request.prototype.getResponse=function(){return this._response},Request.prototype.setSuccess=function(success){this._succeeded=success},Request.prototype.isSuccess=function(){return this._succeeded},Request.prototype.getContentType=function(){var contentType=null,xhrObj=this.getResponse();return xhrObj&&xhrObj.getResponseHeader&&(contentType=xhrObj.getResponseHeader["Content-Type"]),YAHOO.lang.isString(contentType)?contentType:""},Request.prototype.getResponseText=function(){if(this.isCompleted()){var response=this.getResponse();if(response)return response.responseText||null}return null},Request.prototype.getResponseJson=function(){var contentType=this.getContentType(),text=this.getResponseText();return null!=text&&text.length>0&&-1!=contentType.indexOf("application/json")?Util.XhrManager.parseJson(text):null},Request.prototype.getResponseXml=function(){var contentType=this.getContentType(),response=this.getResponse();return this.isCompleted()&&-1!=contentType.indexOf("text/xml")&&response?response.responseXML||null:null},Request.prototype.allowRetry=function(){var response=this.getResponse();return!!response&&(""==response.getAllResponseHeaders||(0==response.status||-1==response.status))},Xhr.prototype.inProgress=function(id){return this._requests.containsKey(id)},Xhr.prototype.getOutstandingCount=function(){return this._requests.getCount()},Xhr.prototype.createRequest=function(id,url,opt_method,opt_content,opt_callback,opt_scope,opt_timeout,opt_maxRetries){return new Request(id,url,opt_method,opt_content,opt_callback,opt_scope||this._scope,YAHOO.lang.isNumber(opt_timeout)?opt_timeout:this._timeoutInterval,YAHOO.lang.isNumber(opt_maxRetries)?opt_maxRetries:this._maxRetries)},Xhr.prototype.send=function(id,url,opt_method,opt_content,opt_callback,opt_scope,opt_timeout,opt_maxRetries){var request=this.createRequest(id,url,opt_method,opt_content,opt_callback,opt_scope,opt_timeout,opt_maxRetries);return this.sendRequest(request),request},Xhr.prototype.sendRequest=function(request){var id=request.getId();if(this.inProgress(id))throw Error("XhrManager ID in use");request.resetAttemptCount(),request.setCompleted(!1),request.setAborted(!1),this.Events.fire("onRequest",request),this._requests.set(id,request),this._retry(id)},Xhr.prototype._retry=function(id){function processResponse(xhrObj,success){request.setResponse(xhrObj),success&&(success=""!=xhrObj.getAllResponseHeaders),request.setSuccess(success),success?xhr.Events.fire("onSuccess",request):xhr.Events.fire("onFailure",request),!success&&request.allowRetry()?xhr._retry(id):xhr._complete(id)}var request=this._requests.get(id);if(!request)return!1;if(request.isCompleted()||request.hasReachedMaxRetries())return this._complete(id),!1;var xhr=this,callbackYUI={success:function(xhrObj){processResponse(xhrObj,!0)},failure:function(xhrObj){processResponse(xhrObj,!1)}};request.getTimeout()&&(callbackYUI.timeout=request.getTimeout());var transaction=YAHOO.util.Connect.asyncRequest(request.getMethod(),request.getUrl(),callbackYUI,request.getContent());return request.setTransaction(transaction),request.increaseAttemptCount(),this.Events.fire("onSent",request),!0},Xhr.prototype._complete=function(id){var request=this._requests.get(id);if(null!=request&&(this._requests.remove(id),request.setCompleted(!0),!1!==this.Events.fire("onComplete",request))){var callback=request.getCallback(),scope=request.getScope();YAHOO.lang.isFunction(callback)&&(YAHOO.lang.isObject(scope)?callback.apply(scope,[request]):callback(request))}},Xhr.prototype.abort=function(id){var request=this._requests.get(id);if(!request)return!1;request.setAborted(!0),this._requests.remove(id);var transaction=request.getTransaction();return transaction&&YAHOO.util.Connect.abort(transaction),this.Events.fire("onAbort",request),!0},Xhr.prototype.abortAll=function(){var requestIds=this._requests.getKeys();Util.Array.each(requestIds,function(id){this.abort(id)})},Xhr.parseJson=function(text){var reISO=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/,reMsAjax=/^\/Date\((d|-|.*)\)[\/|\\]$/;return YAHOO.lang.JSON.parse(text,function(key,value){if("string"==typeof value){var a=reISO.exec(value);if(a)return new Date(Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6]));if(a=reMsAjax.exec(value)){var b=a[1].split(/[-+,.]/);return new Date(b[0]?+b[0]:0-+b[1])}}return value})},Xhr}(),function(Util){function getOSXMajorMinorVersion(){var matches=navigator.userAgent.match(/Mac OS X (\d+)\.(\d+)/),version={major:0,minor:0};return matches&&(version.major=+matches[1]||1/0,version.minor=+matches[2]||1/0),version}var MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i,SUPPORT_TOUCH="ontouchstart"in window,SUPPORT_ONLY_TOUCH=SUPPORT_TOUCH&&MOBILE_REGEX.test(navigator.userAgent),Browser={};Browser.isWindows=function(){return-1!=navigator.platform.indexOf("Windows")||-1!=navigator.platform.indexOf("Win32")||-1!=navigator.platform.indexOf("Win64")},Browser.isLinux=function(){return-1!=navigator.platform.indexOf("X11")||-1!=navigator.platform.indexOf("Linux")||-1!=navigator.platform.indexOf("BSD")},Browser.isMac=function(){return-1!=navigator.platform.indexOf("Macintosh")||-1!=navigator.platform.indexOf("MacPPC")||-1!=navigator.platform.indexOf("MacIntel")},Browser.getWindowsNTVersion=function(){var value,matches=navigator.userAgent.match(/Windows NT (\d+\.\d+)/);return matches&&matches[1]&&(value=parseFloat(matches[1])),value||0},Browser.getOSXVersion=function(){var value,matches=navigator.userAgent.match(/Mac OS X (\d+\.\d+)/);return matches&&matches[1]&&(value=parseFloat(matches[1])),value||0},Browser.osxVersionIsAtLeast=function(minMajor,minMinor){var version=getOSXMajorMinorVersion();return minMajor<version.major||minMajor===version.major&&minMinor<=version.minor},Browser.osxVersionIsAtMost=function(maxMajor,maxMinor){var version=getOSXMajorMinorVersion();return maxMajor>version.major||maxMajor===version.major&&maxMinor>=version.minor},Browser.isMacPPC=function(){return-1!=navigator.userAgent.indexOf("PPC Mac")},Browser.getFirefoxVersion=function(){if(YAHOO.env.ua.gecko>0)switch(YAHOO.env.ua.gecko){case 1.7:return 1;case 1.8:return 1.5;case 1.81:return 2;case 1.9:return 3;case 1.91:return 3.5;case 1.92:return 3.6;case 1.93:return 3.7;case 2:return 4;default:return YAHOO.env.ua.gecko}return 0},Browser.isFirefox=function(){return Browser.getFirefoxVersion()>0},Browser.isIE=function(){return YAHOO.env.ua.ie>0},Browser.getIEDocMode=function(){return document.documentMode?document.documentMode:0},Browser.isChrome=function(){return YAHOO.env.ua.chrome>0},Browser.isChromeOS=function(){return window.navigator.userAgent.indexOf("CrOS")>-1},Browser.getChromeVersion=function(){return YAHOO.env.ua.chrome},Browser.isMobile=function(){return null!=YAHOO.env.ua.mobile||YAHOO.env.ua.ios>0||YAHOO.env.ua.android>0},Browser.isIOS=function(){return Browser.getIOSVersion()>0},Browser.getIOSVersion=function(){return YAHOO.env.ua.ios},Browser.isAndroid=function(){return YAHOO.env.ua.android>0},Browser.isCertified=function(){return"object"==typeof window.browser},Browser.isTouchDevice=function(){return SUPPORT_TOUCH},Browser.isOnlyTouchDevice=function(){return SUPPORT_ONLY_TOUCH},Browser.supportsSVG=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},Browser.supportsAudioOGG=function(){return!Browser.isIOS()&&!Browser.isAndroid()&&!(!Browser.isChrome()&&!Browser.isFirefox())},Browser.supportsMathML=function(){return(!Browser.isSecure()||!YAHOO.env.ua.android&&!YAHOO.env.ua.ios)&&(Util.Browser.getFirefoxVersion()>0?Util.Browser.getFirefoxVersion()>=4:!(YAHOO.env.ua.chrome>0)&&YAHOO.env.ua.webkit>=534)},Browser.supportsModifierKeys=function(){return!Browser.isIOS()},Browser.isSecure=function(){var clientSideCheck=-1!=navigator.userAgent.indexOf("AIRSecureBrowser")||-1!=navigator.userAgent.indexOf("AIRMobile"),serverSideCheck="object"==typeof TDS&&"object"==typeof TDS.BrowserInfo&&TDS.BrowserInfo.isSecure,extensionCheck=!!window.AIRSecureBrowserExtension,chromeAppCheck=YUD.hasClass(document.body,"browser_airsecurebrowser");return clientSideCheck||serverSideCheck||extensionCheck||chromeAppCheck||Browser.isCertified()},Browser.getSecureVersion=function(){var numberfy=function(s){var c=0;return parseFloat(s.replace(/\./g,function(){return 1==c++?"":"."}))},ua=navigator.userAgent,ma=ua.match(/AIRSecureBrowser\/([^\s\)]*)/);return ma&&ma[1]?numberfy(ma[1]):(ma=ua.match(/AIRMobile[SecureBrowser]*\/([^\s\)]*)/))&&ma[1]?numberfy(ma[1]):0},Browser.getFlashVersion=function(){return parseFloat(FlashDetect.major+"."+FlashDetect.minor)},Browser.resolveUrl=function(url,root){url=url||"",root=root||document,url=(url=url.replace(/&amp;/g,"&")).split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var el=root.createElement("div");return el.innerHTML='<a href="'+url+'">x</a>',el.firstChild.href},Browser.requestFullScreen=function(elem){elem||(elem=document.body),elem.webkitRequestFullScreen&&(YUD.addClass(elem,"fullScreenMode"),elem.webkitRequestFullScreen(),elem.addEventListener("webkitfullscreenchange",function(){document.webkitIsFullScreen||(YUD.removeClass(elem,"fullScreenMode"),removeEventListener(this))}))},Util.Browser=Browser}(Util),function(Browser){function parseFeature(str){var data=str.split("(");return{name:data[0],version:data[1]?1*data[1].replace(")",""):0}}function parseFeatures(str){for(var features=[],groups=str.split("|"),i=0;i<groups.length;i++)features.push(parseFeature(groups[i]));return features}function checkSupported(feature){return!!lookup[feature.name]&&lookup[feature.name](feature)}var lookup={};Util.Browser.Feature={add:function(name,fn){lookup[name]=fn},supports:function(data){var features;if(YAHOO.lang.isString(data))features=parseFeatures(data);else{if(!YAHOO.lang.isArray(data))throw new Error("Invalid data provided for checking supported features.");features=data}for(var supported=[],unsupported=[],i=0;i<features.length;i++){var feature=features[i];YAHOO.lang.isString(feature)&&(feature={name:feature,version:0}),checkSupported(feature)?supported.push(feature.name):unsupported.push(feature.name)}return{supported:supported,unsupported:unsupported}}}}(),function(Feature){Feature.add("Flash",function(feature){return Util.Browser.getFlashVersion()>=feature.version}),Feature.add("SVG",function(feature){return Util.Browser.supportsSVG()}),Feature.add("Audio",function(feature){return soundManager.canPlayMIME("audio/ogg")||soundManager.canPlayMIME("audio/m4a")}),Feature.add("Recorder",function(feature){return null!=TDS.SecureBrowser.getRecorder()})}(Util.Browser.Feature),Util.Browser.createCookie=function(name,value,days){var expires;if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()}else expires="";document.cookie=name+"="+value+expires+"; path=/"},Util.Browser.readCookie=function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null},Util.Browser.readSubCookie=function(name,subName){for(var cookie=this.readCookie(name),subCookies=decodeURIComponent(cookie).split("&"),i=0;i<subCookies.length;i++){var pair=subCookies[i].split("=");if(decodeURIComponent(pair[0])==subName)return decodeURIComponent(pair[1])}},Util.Browser.eraseCookie=function(name){this.createCookie(name,"",-1)},Util.Browser.clearCookies=function(){for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++){var cookieName=cookies[i].split("=")[0];Util.Browser.eraseCookie(cookieName)}},Util.Browser._getJREVersion=function(runApplet,codebase){if(!(navigator.mimeTypes&&navigator.mimeTypes["application/x-java-applet"]?navigator.mimeTypes["application/x-java-applet"].enabledPlugin:0))return-2;for(var version=0,i=1;i<7;i++)if(navigator.mimeTypes["application/x-java-applet;version=1."+i]){version="1."+i;for(var j=1;j<4;j++)navigator.mimeTypes["application/x-java-applet;version=1."+i+"."+j]&&(version="1."+i+"."+j)}if(runApplet){if(!function(){var applet=document.getElementById("DetectPluginApplet");if(null==applet){var container=document.createElement("div");container.style.visibility="hidden",container.innerHTML='<applet id="DetectPluginApplet" name="DetectPluginApplet" code="DetectPluginApplet.class" codebase="'+codebase+'"></applet>';try{document.body.appendChild(container)}catch(ex){return!1}}if(null==(applet=document.getElementById("DetectPluginApplet")))return!1;try{version=applet.getJREVersion()}catch(ex){return!1}return!0}()&&Util.Browser.isWindows())return-3}return parseFloat(version)},Util.Browser.getJREVersion=function(runApplet,codebase){codebase=codebase||"../Shared/Applets/Utilities/";try{return this._getJREVersion(runApplet,codebase)}catch(e){return-1}},Util.Browser.getJREVersionAsync=function(callback){var success=callback.success||function(){},failure=callback.failure||function(){},timeout=callback.timeout||6e4,codebase=callback.codebase||"../Shared/Applets/Utilities/";if(!(navigator.mimeTypes&&navigator.mimeTypes["application/x-java-applet"]?navigator.mimeTypes["application/x-java-applet"].enabledPlugin:0))return failure(-2),!1;var getPluginVersion=function(){for(var version=-1,i=1;i<7;i++)if(navigator.mimeTypes["application/x-java-applet;version=1."+i]){version="1."+i;for(var j=1;j<4;j++)navigator.mimeTypes["application/x-java-applet;version=1."+i+"."+j]&&(version="1."+i+"."+j)}return parseFloat(version)},getJREVersion=function(){var version=-1,applet=document.getElementById("DetectPluginApplet");if(null==applet){var container=document.createElement("div");container.style.visibility="hidden",container.innerHTML='<applet id="DetectPluginApplet" name="DetectPluginApplet" code="DetectPluginApplet.class" codebase="'+codebase+'"></applet>';try{document.body.appendChild(container)}catch(ex){return version}}if(null==(applet=document.getElementById("DetectPluginApplet")))return version;try{version=applet.getJREVersion()}catch(ex){return version}return parseFloat(version)},jreVersion=-1,pollCondition=function(){return(jreVersion=getJREVersion())>-1},pollSuccess=function(){success({applet:jreVersion,plugin:getPluginVersion()})},pollStart=function(){var conditionalDelay=new Util.ConditionalDelay(pollCondition);conditionalDelay.onSuccess.subscribe(function(){pollSuccess()}),conditionalDelay.onFailure.subscribe(function(){failure(-3)}),conditionalDelay.start(250,timeout)};return setTimeout(function(){pollCondition()?pollSuccess():pollStart()},0),!0},Util.QueryString={},Util.QueryString.reload=function(obj){var currentUrl=window.location.href,currentQS=window.location.search,newQS="?"+Util.QueryString.stringify(obj);currentQS.length>0?currentUrl=currentUrl.replace(currentQS,newQS):currentUrl+=newQS,window.location=currentUrl},function(){var QueryString={},stack=[],L=YAHOO.lang;QueryString.escape=encodeURIComponent,QueryString.stringify=function(obj,c,name){var begin,end,i,l,n,s,sep=c&&c.sep?c.sep:"&",eq=c&&c.eq?c.eq:"=",aK=!(!c||!c.arrayKey)&&c.arrayKey;if(L.isNull(obj)||L.isUndefined(obj)||L.isFunction(obj))return name?QueryString.escape(name)+eq:"";if((L.isBoolean(obj)||"[object Boolean]"===Object.prototype.toString.call(obj))&&(obj=obj.toString()),L.isNumber(obj)||L.isString(obj))return QueryString.escape(name)+eq+QueryString.escape(obj);if(L.isArray(obj)){for(s=[],name=aK?name+"[]":name,l=obj.length,i=0;i<l;i++)s.push(QueryString.stringify(obj[i],c,name));return s.join(sep)}for(i=stack.length-1;i>=0;--i)if(stack[i]===obj)throw new Error("QueryString.stringify. Cyclical reference");stack.push(obj),s=[],begin=name?name+"[":"",end=name?"]":"";for(i in obj)obj.hasOwnProperty(i)&&(n=begin+i+end,s.push(QueryString.stringify(obj[i],c,n)));return stack.pop(),!(s=s.join(sep))&&name?name+"=":s};var pieceParser=function(eq){return function parsePiece(key,val){var sliced,numVal,head,tail,ret;return 2!==arguments.length?(key=key.split(eq),parsePiece(QueryString.unescape(key.shift()),QueryString.unescape(key.join(eq)))):(key=key.replace(/^\s+|\s+$/g,""),L.isString(val)&&(val=val.replace(/^\s+|\s+$/g,""),isNaN(val)||val===(numVal=+val).toString(10)&&(val=numVal)),(sliced=/(.*)\[([^\]]*)\]$/.exec(key))?(tail=sliced[2],head=sliced[1],tail?(ret={},ret[tail]=val,parsePiece(head,ret)):parsePiece(head,[val])):(ret={},key&&(ret[key]=val),ret))}},mergeParams=function(params,addition){return params?L.isArray(params)?params.concat(addition):L.isObject(params)&&L.isObject(addition)?mergeObjects(params,addition):[params].concat(addition):addition},mergeObjects=function(params,addition){for(var i in addition)i&&addition.hasOwnProperty(i)&&(params[i]=mergeParams(params[i],addition[i]));return params};QueryString.parse=function(qs,sep,eq){return null==qs&&(qs=window.location.search.substring(1)),null==qs||0==qs.length?{}:Util.Array.reduce(Util.Array.map(qs.split(sep||"&"),pieceParser(eq||"=")),{},mergeParams)},QueryString.unescape=function(s){return decodeURIComponent(s.replace(/\+/g," "))},Util.QueryString=QueryString}(),function(YAHOO){function getElDoc(element){return 9===element.nodeType?element:element.ownerDocument||element.document||document}function docScrollX(node,doc){var dv=(doc=doc||node?getElDoc(node):document).defaultView,pageOffset=dv?dv.pageXOffset:0;return Math.max(doc.documentElement.scrollLeft,doc.body.scrollLeft,pageOffset)}function docScrollY(node,doc){var dv=(doc=doc||node?getElDoc(node):document).defaultView,pageOffset=dv?dv.pageYOffset:0;return Math.max(doc.documentElement.scrollTop,doc.body.scrollTop,pageOffset)}function getScrollLeft(node){return"scrollLeft"in node?node.scrollLeft:docScrollX(node)}function getScrollTop(node){return"scrollTop"in node?node.scrollTop:docScrollY(node)}var DD=YAHOO.util.DD,DDM=YAHOO.util.DragDropMgr;DD.prototype.setScrollBuffer=function(value){this._scrollBuffer=value},DD.prototype.getScrollBuffer=function(){return this._scrollBuffer||20},DD.prototype.setScrollDelay=function(value){this._scrollDelay=value},DD.prototype.getScrollDelay=function(){return this._scrollDelay||150},DD.prototype.setScrollDirection=function(horizontal,vertical){this._scrollHorizontal=horizontal,this._scrollVertical=vertical},DD.prototype.isScrollHorizontal=function(){return this._scrollHorizontal||!1},DD.prototype.isScrollVertical=function(){return this._scrollVertical||!1},DD.prototype.isWindowScroll=function(){return null==this._parentScroll||this._parentScroll==window},DD.prototype.getParentScroll=function(){return this._parentScroll||window},DD.prototype.setParentScroll=function(element){this._parentScroll=element},DD.prototype._getVPRegion=function(){var el=this.getParentScroll(),b=this.getScrollBuffer(),ws=this.isWindowScroll(),xy=ws?[]:YUD.getXY(el),width=ws?YUD.getViewportWidth():el.offsetWidth,height=ws?YUD.getViewportHeight():el.offsetHeight,top=ws?getScrollTop(el):xy[1],left=ws?getScrollLeft(el):xy[0];return{top:top+b,right:width+left-b,bottom:height+top-b,left:left+b}},DD.prototype._initScroll=function(){var scrollDelay=this.getScrollDelay();this._cancelScroll(),this._scrollTimer=YAHOO.lang.later(scrollDelay,this,this._checkWinScroll,[!0],!0)},DD.prototype._cancelScroll=function(){this._scrollTimer&&(this._scrollTimer.cancel(),delete this._scrollTimer)},DD.prototype._checkWinScroll=function(move){if(this==DDM.dragCurrent){var dragEl=this.getDragEl(),dragHeight=dragEl.offsetHeight,dragWidth=dragEl.offsetWidth,dragXY=YUD.getXY(dragEl),dragBottom=dragXY[1]+dragHeight,dragTop=dragXY[1],dragRight=dragXY[0]+dragWidth,dragLeft=dragXY[0],parentRegion=this._getVPRegion(),parentEl=this.getParentScroll(),parentScrollTop=getScrollTop(parentEl),parentScrollLeft=getScrollLeft(parentEl),ws=this.isWindowScroll(),scroll=!1,b=this.getScrollBuffer(),nt=dragTop,nl=dragLeft,st=parentScrollTop,sl=parentScrollLeft;this.isScrollHorizontal()&&(dragLeft<=parentRegion.left&&(scroll=!0,nl=dragXY[0]-(ws?b:0),sl=parentScrollLeft-b),dragRight>=parentRegion.right&&(scroll=!0,nl=dragXY[0]+(ws?b:0),sl=parentScrollLeft+b)),this.isScrollVertical()&&(dragBottom>=parentRegion.bottom&&(scroll=!0,nt=dragXY[1]+(ws?b:0),st=parentScrollTop+b),dragTop<=parentRegion.top&&(scroll=!0,nt=dragXY[1]-(ws?b:0),st=parentScrollTop-b)),st<0&&(st=0,nt=dragXY[1]),sl<0&&(sl=0,nl=dragXY[0]),nt<0&&(nt=dragXY[1]),nl<0&&(nl=dragXY[0]),move?(this.alignElWithMouse(dragEl,nl,nt),parentEl==window?parentEl.scrollTo(sl,st):(parentEl.scrollTop=st,parentEl.scrollLeft=sl),st||sl||this._cancelScroll()):scroll?this._initScroll():this._cancelScroll()}else this._cancelScroll()},DD.prototype.autoScroll=function(x,y,h,w){},DD.prototype.b4Drag=function(e){this.setDragElPos(YAHOO.util.Event.getPageX(e),YAHOO.util.Event.getPageY(e)),this.scroll&&(this._scrollTimer&&this._cancelScroll(),this._checkWinScroll())}}(YAHOO),function(YAHOO){function createHeader(){if(!m_oHeaderTemplate){var m_oModuleTemplate=document.createElement("div");m_oModuleTemplate.innerHTML='<h2 class="'+YAHOO.widget.Module.CSS_HEADER+'"></h2>',m_oHeaderTemplate=m_oModuleTemplate.firstChild}return m_oHeaderTemplate.cloneNode(!1)}var m_oHeaderTemplate;YAHOO.widget.Module.prototype.setHeader=function(headerContent){var oHeader=this.header||(this.header=createHeader());headerContent.nodeName?(oHeader.innerHTML="",oHeader.appendChild(headerContent)):oHeader.innerHTML=headerContent,this._rendered&&this._renderHeader(),this.changeHeaderEvent.fire(headerContent),this.changeContentEvent.fire()}}(YAHOO),window.YAHOO.widget.ContextMenu.prototype.focus=function(){this.hasFocus()||this.cfg.getProperty("suppressInitialFocus")||(this.setInitialFocus(),this.setInitialSelection())};var Mozilla={};Mozilla.SecurityPrivilege={Unavailable:0,Disabled:1,Available:2},Mozilla.UniversalConnect={Unknown:0,Denied:1,Allowed:2},Mozilla._universalConnect=Mozilla.UniversalConnect.Unknown,Mozilla._lastException=null,Mozilla.allowPrivileged=function(){try{if(Mozilla.enableComponents())return Mozilla.SecurityPrivilege.Available}catch(ex){if(Mozilla._lastException=ex,-1!=("string"==typeof ex?ex:ex.message).indexOf("Permission denied"))return Mozilla.SecurityPrivilege.Disabled}return Mozilla.SecurityPrivilege.Unavailable},Mozilla.execPrivileged=function(callback,browserMinVersion,browserMaxVersion){if(Mozilla._universalConnect==Mozilla.UniversalConnect.Denied)return!1;if(Mozilla._universalConnect==Mozilla.UniversalConnect.Unknown&&Mozilla.allowPrivileged()==Mozilla.SecurityPrivilege.Unavailable)return Mozilla._universalConnect=Mozilla.UniversalConnect.Denied,!1;var minBrowser=YAHOO.lang.isNumber(browserMinVersion)?browserMinVersion:-1,maxBrowser=YAHOO.lang.isNumber(browserMaxVersion)?browserMaxVersion:-1;return!(minBrowser>0&&Util.Browser.getFirefoxVersion()<=minBrowser||maxBrowser>0&&Util.Browser.getFirefoxVersion()>=maxBrowser)&&(Mozilla._universalConnect=Mozilla.UniversalConnect.Allowed,"function"==typeof callback&&callback(),!0)},Mozilla.enableComponents=function(){if(void 0!==Mozilla._components)return Mozilla._components;var components=null;if(window.SecureBrowser&&"object"==typeof SecureBrowser.Components)components=window.Components=SecureBrowser.Components;else if(window.netscape&&netscape.security&&netscape.security.PrivilegeManager)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),components=Components}catch(e){}return Mozilla._components=components,null!==components},Mozilla.getPreference=function(name){var value;return Mozilla.execPrivileged(function(){value=Mozilla.preference(name)}),value},Mozilla.setPreference=function(name,value,browserMinVersion,browserMaxVersion){var success=!1;return Mozilla.execPrivileged(function(){Mozilla.preference(name,value),success=!0},browserMinVersion,browserMaxVersion),success},Mozilla.enableCaretMode=function(enable){return Mozilla.execPrivileged(function(){void 0===enable&&(enable=!Mozilla.getPreference("accessibility.browsewithcaret")),Mozilla.setPreference("accessibility.warn_on_browsewithcaret",!1),Mozilla.setPreference("accessibility.browsewithcaret",enable)})&&enable},Mozilla.inCaretMode=function(){return Mozilla.getPreference("accessibility.browsewithcaret")},Mozilla.enableTabFocus=function(){return Mozilla.setPreference("accessibility.tabfocus",7)},Mozilla.preference=function(name,value){if("object"==typeof navigator&&"function"==typeof navigator.preference)return navigator.preference(name,value);var rv;if("object"!=typeof Components||"object"!=typeof Components.classes)return rv;var prefBranch=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefService).getBranch("");if(YAHOO.lang.isUndefined(value))switch(prefBranch.getPrefType(name)){case prefBranch.PREF_STRING:rv=prefBranch.getCharPref(name);break;case prefBranch.PREF_INT:rv=prefBranch.getIntPref(name);break;case prefBranch.PREF_BOOL:rv=prefBranch.getBoolPref(name);break;default:return null}else YAHOO.lang.isString(value)?rv=prefBranch.setCharPref(name,value):YAHOO.lang.isNumber(value)?rv=prefBranch.setIntPref(name,value):YAHOO.lang.isBoolean(value)?rv=prefBranch.setBoolPref(name,value):YAHOO.lang.isNull(value)&&(rv=prefBranch.deleteBranch(name));return rv},Mozilla.enableScreenshots=function(){var processEnable1=Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);if(null==processEnable1)return!1;var processEnable2=Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);if(null==processEnable2)return!1;var fileEnable1=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(null==fileEnable1)return!1;var fileEnable2=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(null==fileEnable2)return!1;try{fileEnable1.initWithPath("/usr/bin/defaults")}catch(err){return!1}try{fileEnable2.initWithPath("/usr/bin/killall")}catch(err){return!1}try{processEnable1.init(fileEnable1)}catch(err){return!1}var args=[];args.push("write"),args.push("com.apple.screencapture"),args.push("location"),args.push("~/Desktop");try{processEnable1.run(!0,args,args.length)}catch(err){return!1}try{processEnable2.init(fileEnable2)}catch(err){return!1}(args=[]).push("SystemUIServer");try{processEnable2.run(!0,args,args.length)}catch(err){return!1}return!0},Mozilla.disableScreenshots=function(){var processDisable1=Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);if(null==processDisable1)return!1;var processDisable2=Components.classes["@mozilla.org/process/util;1"].createInstance(Components.interfaces.nsIProcess);if(null==processDisable2)return!1;var fileDisable1=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(null==fileDisable1)return!1;var fileDisable2=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(null==fileDisable2)return!1;try{fileDisable1.initWithPath("/usr/bin/defaults")}catch(err){return!1}try{fileDisable2.initWithPath("/usr/bin/killall")}catch(err){return!1}try{processDisable1.init(fileDisable1)}catch(err){return!1}var args=[];args.push("write"),args.push("com.apple.screencapture"),args.push("location"),args.push("/tmp");try{processDisable1.run(!0,args,args.length)}catch(err){return!1}try{processDisable2.init(fileDisable2)}catch(err){return!1}(args=[]).push("SystemUIServer");try{processDisable2.run(!0,args,args.length)}catch(err){return!1}return!0},Mozilla.fullscreen=function(){console.log("Mozilla.fullscreen is obsolete. Please remove calls to it.")},Mozilla.moveWindowTo=function(x,y){console.log("Mozilla.moveWindowTo is obsolete. Please remove calls to it.")},Mozilla.resizeWindowTo=function(width,height){console.log("Mozilla.resizeWindowTo is obsolete. Please remove calls to it.")},Util.Statistics={MACHEP:1.1102230246251565e-16,MAXLOG:709.782712893384,MINLOG:-745.1332191019412,MAXGAM:171.6243769563027,SQTPI:2.5066282746310007,SQRTH:.7071067811865476,LOGPI:1.1447298858494002},Util.Statistics.poisson=function(k,x){return k<0||x<0?0:Util.Statistics.igamc(k+1,x)},Util.Statistics.poissonc=function(k,x){return k<0||x<0?0:Util.Statistics.igam(k+1,x)},Util.Statistics.igamc=function(a,x){var ans,ax,c,yc,r,t,y,z,pk,pkm1,pkm2,qk,qkm1,qkm2,biginv=2.220446049250313e-16;if(x<=0||a<=0)return 1;if(x<1||x<a)return 1-Util.Statistics.igam(a,x);if((ax=a*Math.log(x)-x-Util.Statistics.lgamma(a))<-Util.Statistics.MAXLOG)return 0;ax=Math.exp(ax),c=0,pkm2=1,qkm2=x,ans=(pkm1=x+1)/(qkm1=(z=x+(y=1-a)+1)*x);do{pk=pkm1*(z+=2)-pkm2*(yc=(y+=1)*(c+=1)),0!=(qk=qkm1*z-qkm2*yc)?(r=pk/qk,t=Math.abs((ans-r)/r),ans=r):t=1,pkm2=pkm1,pkm1=pk,qkm2=qkm1,qkm1=qk,Math.abs(pk)>4503599627370496&&(pkm2*=biginv,pkm1*=biginv,qkm2*=biginv,qkm1*=biginv)}while(t>Util.Statistics.MACHEP);return ans*ax},Util.Statistics.lgamma=function(x){var p,q,w,z,A=[.0008116141674705085,-.0005950619042843014,.0007936503404577169,-.002777777777300997,.08333333333333319],B=[-1378.2515256912086,-38801.631513463784,-331612.9927388712,-1162370.974927623,-1721737.0082083966,-853555.6642457654],C=[-351.81570143652345,-17064.210665188115,-220528.59055385445,-1139334.4436798252,-2532523.0717758294,-2018891.4143353277];if(x<-34){if(q=-x,w=Util.Statistics.lgamma(q),(p=Math.floor(q))==q)throw new Error("lgam: Overflow");if((z=q-p)>.5&&(z=(p+=1)-q),0==(z=q*Math.sin(Math.PI*z)))throw new Error("lgamma: Overflow");return z=Util.Statistics.LOGPI-Math.log(z)-w}if(x<13){for(z=1;x>=3;)z*=x-=1;for(;x<2;){if(0==x)throw new Error("lgamma: Overflow");z/=x,x+=1}return z<0&&(z=-z),2==x?Math.log(z):(x-=2,p=x*Util.Statistics.polevl(x,B,5)/Util.Statistics.p1evl(x,C,6),Math.log(z)+p)}if(x>2.556348e305)throw new Error("lgamma: Overflow");return q=(x-.5)*Math.log(x)-x+.9189385332046728,x>1e8?q:(p=1/(x*x),q+=x>=1e3?((.0007936507936507937*p-.002777777777777778)*p+.08333333333333333)/x:Util.Statistics.polevl(p,A,4)/x)},Util.Statistics.igam=function(a,x){var ans,ax,c,r;if(x<=0||a<=0)return 0;if(x>1&&x>a)return 1-Util.Statistics.igamc(a,x);if((ax=a*Math.log(x)-x-Util.Statistics.lgamma(a))<-Util.Statistics.MAXLOG)return 0;ax=Math.exp(ax),r=a,c=1,ans=1;do{ans+=c*=x/(r+=1)}while(c/ans>Util.Statistics.MACHEP);return ans*ax/a},Util.Statistics.polevl=function(x,coef,N){var ans;ans=coef[0];for(var i=1;i<=N;i++)ans=ans*x+coef[i];return ans},Util.Statistics.p1evl=function(x,coef,N){var ans;ans=x+coef[0];for(var i=1;i<N;i++)ans=ans*x+coef[i];return ans},Util.Network={},Util.Network.BandWidthTester=function(config){this.sizeOfRequestinBytes="number"==typeof config.requestSizeinKiloBytes?1024*config.requestSizeinKiloBytes:1,this.iterCount="number"==typeof config.numIterations?config.numIterations:1,this.callBack="function"==typeof config.callBack?config.callBack:null,this.url="string"==typeof config.url?config.url:"Pages/API/Diagnostics.axd?size="+this.sizeOfRequestinBytes,this.alternateGETPOST="boolean"==typeof config.alternateGETPOST&&config.alternateGETPOST,this.latencyOffsetinms="number"==typeof config.latencyOffsetinms?config.latencyOffsetinms:0,this.downloadurl="string"==typeof config.downloadurl?config.downloadurl:this.url,this.sizeOfDownloadRequestinBytes=this.sizeOfRequestinBytes,this.sizeOfUploadRequestinBytes=1e6,this.uploadurl="string"==typeof config.uploadurl?config.uploadurl:"Pages/API/Diagnostics.axd?size="+this.sizeOfUploadRequestinBytes,this.generateUploadData="boolean"==typeof config.generateUploadData&&config.generateUploadData,this.callBackScope="object"==typeof config.callBackScope?config.callBackScope:this,this._currentStartTime=void 0,this._currentMode="GET",this._currenData=null,this._modeStats=[],this._modeStats.GET={iterations:0,successful:0,aveLineSpeed:0,aveTransactionTime:0,minDelay:-1,maxDelay:-1,minLineSpeed:-1,maxLineSpeed:-1,rawResults:[]},this._modeStats.POST={iterations:0,successful:0,aveLineSpeed:0,aveTransactionTime:0,minDelay:-1,maxDelay:-1,minLineSpeed:-1,maxLineSpeed:-1,rawResults:[]},this._YUIcallBack={success:this._success,failure:this._failure,cache:!1,scope:this}},Util.Network.BandWidthTester.prototype.run=function(){if(this._modeStats[this._currentMode].iterations>this.iterCount)null!=this.callBack&&this.callBack.call(this.callBackScope,this._modeStats);else{if(this.generateUploadData||null==this._currenData){for(var tmpArray=[],i=0;i<this.sizeOfUploadRequestinBytes;i++)tmpArray.push("a");this._currenData=tmpArray.join("")}this._currentStartTime=(new Date).getTime(),"GET"==this._currentMode?YAHOO.util.Connect.asyncRequest("GET",this.downloadurl,this._YUIcallBack,null):null!=this._currenData&&this._currenData.length>=this.sizeOfUploadRequestinBytes?YAHOO.util.Connect.asyncRequest("POST",this.uploadurl,this._YUIcallBack,this._currenData):this._checkPoint(-1)}},Util.Network.BandWidthTester.prototype._checkPoint=function(lineSpeed,transactionTime){var statsData=this._modeStats[this._currentMode];statsData.iterations++,lineSpeed>0&&(statsData.successful++,statsData.aveLineSpeed=(statsData.aveLineSpeed*(statsData.iterations-1)+lineSpeed)/statsData.iterations,statsData.aveTransactionTime=(statsData.aveTransactionTime*(statsData.iterations-1)+transactionTime)/statsData.iterations,(statsData.minLineSpeed<0||statsData.minLineSpeed>lineSpeed)&&(statsData.minLineSpeed=lineSpeed),(statsData.maxLineSpeed<0||statsData.maxLineSpeed<lineSpeed)&&(statsData.maxLineSpeed=lineSpeed),"number"==typeof transactionTime&&((statsData.minDelay<0||statsData.minDelay>transactionTime)&&(statsData.minDelay=transactionTime),(statsData.maxDelay<0||statsData.maxDelay<transactionTime)&&(statsData.maxDelay=transactionTime))),statsData.rawResults.push(lineSpeed),(this.alternateGETPOST||statsData.iterations>this.iterCount)&&(this._currentMode="GET"==this._currentMode?"POST":"GET"),(statsData=this._modeStats[this._currentMode]).iterations>=this.iterCount?this.callBack&&"function"==typeof this.callBack&&this.callBack.call(this.callBackScope,this._modeStats):this.run()},Util.Network.BandWidthTester.prototype._success=function(o){var millitime=(new Date).getTime()-this._currentStartTime+this.latencyOffsetinms,downloadtimeinSecs=millitime/1e3,linespeed=0;"GET"==this._currentMode?linespeed=this.sizeOfDownloadRequestinBytes/1e3/downloadtimeinSecs:"POST"==this._currentMode&&(linespeed=this.sizeOfUploadRequestinBytes/1e3/downloadtimeinSecs),this.generateUploadData||(this._currenData=o.responseText),this._checkPoint(linespeed,millitime)},Util.Network.BandWidthTester.prototype._failure=function(o){this._checkPoint(-1)},Util.Network.CapacityCalculator=function(config){this._veryLow=.999,this._moderate=.85,this._high=.6,this._risk="Unknown",this._probability=0,this._recommendedNumber=-1},Util.Network.CapacityCalculator.prototype.GetRisk=function(){return this._risk},Util.Network.CapacityCalculator.prototype.GetRecommendedStudentCount=function(){return this._recommendedNumber},Util.Network.CapacityCalculator.prototype.ProbabilityWithinCapacity=function(goodput,itemsize,students,responseTime){var maxItems=this._MaxItemsPerSecond(goodput,itemsize);switch(this._probability=this._ProbabilityWithinCapacity_1(students,responseTime,maxItems),this._risk=this._CalculateRisk(students),this._risk){case"High":case"NearCertain":this._recommendedNumber=this._RecommendNumber(students,responseTime,maxItems)}return this._probability},Util.Network.CapacityCalculator.prototype._MaxItemsPerSecond=function(goodput,itemSize){return 1e3*goodput/itemSize},Util.Network.CapacityCalculator.prototype._ProbabilityWithinCapacity_1=function(students,responseTime,maxItems){var max1=Math.floor(maxItems);return max1>0?this._ProbabilityWithinCapacityPerSecond_1(students,responseTime,max1):this._ProbabilityBelowEquilibrium(students,responseTime,maxItems)},Util.Network.CapacityCalculator.prototype._ProbabilityWithinCapacityPerSecond_1=function(students,respTime,maxItems){return Util.Statistics.poisson(maxItems,students/respTime)},Util.Network.CapacityCalculator.prototype._ProbabilityBelowEquilibrium=function(students,responseTime,maxItems){var meanResponses=1/maxItems*students/responseTime;return Util.Statistics.poisson(1,meanResponses)},Util.Network.CapacityCalculator.prototype._CalculateRisk=function(students){return-1==this._probability&&(this._risk="Unknown"),1==students?this._risk="Moderate":this._probability<this._high?this._risk="NearCertain":this._probability<this._moderate?this._risk="High":this._probability<this._veryLow?this._risk="Moderate":this._risk="VeryLow",this._risk},Util.Network.CapacityCalculator.prototype._RecommendNumber=function(students,responseTime,maxItems){for(var step=Math.ceil(.25*students),p=this._ProbabilityWithinCapacity_1(students,responseTime,maxItems),dir=-1;p>this._veryLow||p<this._moderate;)-1!=dir&&(step=Math.max(1,Math.round(.5*step))),students=Math.max(1,students+dir*step),(p=this._ProbabilityWithinCapacity_1(students,responseTime,maxItems))>this._veryLow?dir=1:p<this._moderate&&(dir=-1);return this._recommendedNumber=students,this._recommendedNumber},Util.Network.AppletBandWidthTester={bandwidthTestApplet:null,sectionDiagnosticsObject:null,currentRunConfig:null,run:function(testConfig){Util.Network.AppletBandWidthTester.bandwidthTestApplet.setDebugMode(testConfig.debugMode),Util.Network.AppletBandWidthTester.bandwidthTestApplet.setPacketSize(testConfig.bufferSize),Util.Network.AppletBandWidthTester.bandwidthTestApplet.setTotalNumberOfSimultaneousConnections(testConfig.numberOfSimultaneousConnections),Util.Network.AppletBandWidthTester.currentRunConfig=testConfig;var wereTestsStarted=Util.Network.AppletBandWidthTester.bandwidthTestApplet.asynchronousNetworkAction(1,testConfig.applicationURL);if(!wereTestsStarted){var callbackFn=Util.Network.AppletBandWidthTester.currentRunConfig.onFailureCallbackFn,callbackContext=Util.Network.AppletBandWidthTester.currentRunConfig.owner;callbackFn.call(callbackContext,"TESTS_ALREADYRUNNING","Bandwidth tests already running.")}return wereTestsStarted}},Util.Network.AppletBandWidthTester.init=function(diagnosticsSectionObject){var appletConfig={id:"BandwidthTestApplet",codebase:window.javaFolder+"AIRBandwidthTester/",code:"air/org/AIRBandwidthTest/NetworkApplet.class",archive:"AIRBandwidthTestApplet.jar",callback:"bandwidthTestAppletEventHandler"};return Util.Network.AppletBandWidthTester.sectionDiagnosticsObject=diagnosticsSectionObject,Util.Frame.injectApplet("BandwidthTestApplet",appletConfig),!0},Util.Workflow=function(){this._activities=new Util.Structs.Map,this._transitions=new Util.Structs.Map,this._activeActivity=null,this._transitionActivity=null,this.Events=new Util.EventManager},Util.Workflow.Approval={Denied:0,Approved:1,Pending:2},Util.Workflow.prototype._isActivity=function(activity){return activity&&activity instanceof Util.Workflow.Activity},Util.Workflow.prototype.getActivity=function(id){return this._isActivity(id)?id:this._activities.get(id)},Util.Workflow.prototype.addActivity=function(activity){if(!this._isActivity(activity))throw"expected activity object but was "+typeof to;var self=this;activity.Events.subscribe("onRequest",function(action,data){try{self._requestTransition(activity,action,data)}catch(ex){TDS.Diagnostics.report(ex)}}),activity.Events.subscribe("onReady",function(data){try{self._finishTransition(activity,data)}catch(ex){TDS.Diagnostics.report(ex)}});var id=activity.getId();this._activities.set(id,activity)},Util.Workflow.prototype.getTransition=function(from,action){var id=from+"_"+action;return this._transitions.get(id)},Util.Workflow.prototype.addTransition=function(from,action,to){var id=from+"_"+action;this._transitions.set(id,{from:from,to:to})},Util.Workflow.prototype._requestTransition=function(fromActivity,action,data){fromActivity=this.getActivity(fromActivity);var transition=this.getTransition(fromActivity,action);if(transition){var toActivity=transition.to;YAHOO.lang.isFunction(toActivity)&&(toActivity=toActivity(data)),(toActivity=this.getActivity(toActivity))&&(YAHOO.lang.isFunction(toActivity.requestApproval)?this._approveTransition(toActivity,data):this._beginTransition(toActivity,data))}},Util.Workflow.prototype._approveTransition=function(activity,data){activity._approvedAction=null;var activityApproval=Util.Workflow.Approval.Approved,requestApproval=activity.requestApproval(data);YAHOO.lang.isNumber(requestApproval)&&(activityApproval=requestApproval),activityApproval==Util.Workflow.Approval.Approved?this._beginTransition(activity,data):activityApproval==Util.Workflow.Approval.Pending&&(activity._approvedAction=Util.bind(this._beginTransition,this,activity,data))},Util.Workflow.prototype._beginTransition=function(activity,data){if(this._activeActivity==activity)throw"cannot transition to activity ("+activity+") because it is already active";if(null!=this._transitionActivity)throw"cannot begin transition activity ("+activity+") because there is a current one ("+this._transitionActivity+") in progress";this._transitionActivity=activity,this.Events.fire("onRequest",activity),activity.hasVisited()||(YAHOO.lang.isFunction(activity.init)&&activity.init(),activity.markVisited());var wait=!1;YAHOO.lang.isFunction(activity.load)&&(wait=activity.load(data)),!0!==wait&&this._finishTransition(activity)},Util.Workflow.prototype._finishTransition=function(activity,data){if(null==this._transitionActivity)throw"cannot finalize transition activity ("+activity+") because it is not in progress";this.Events.fire("onReady",activity,data);this._activeActivity&&(this.Events.fire("onLeave",this._activeActivity),YAHOO.lang.isFunction(this._activeActivity.leave)&&this._activeActivity.leave(),this._activeActivity),this._activeActivity=activity,this.Events.fire("onEnter",this._activeActivity,data),YAHOO.lang.isFunction(this._activeActivity.enter)&&this._activeActivity.enter(data),this._transitionActivity=null},Util.Workflow.prototype.start=function(id){var activity=this.getActivity(id);try{this._beginTransition(activity)}catch(ex){TDS.Diagnostics.report(ex)}},Util.Workflow.Activity=function(id){if(!YAHOO.lang.isString(id))throw new Error("Activity must have a valid ID");this.Events=new Util.EventManager(this),this.request=function(action,data){this.Events.fire("onRequest",action,data)},this.requestApproved=function(){YAHOO.lang.isFunction(this._approvedAction)&&this._approvedAction()},this.ready=function(data){this.Events.fire("onReady",data)},this.getId=function(){return id},this.toString=function(){return this.getId()},this._visited=!1,this.markVisited=function(){this._visited=!0},this.hasVisited=function(){return this._visited}},Util.Workflow.extendActivity=function(activityClass){YAHOO.lang.extend(activityClass,Util.Workflow.Activity)},Util.Xml={},Util.Xml.getNodeText=function(node){return node?node.text?node.text:node.textContent?node.textContent:null:null},Util.Xml.escapeHTMLEncode=function(str){if(null==str)return"";var div=document.createElement("div"),text=document.createTextNode(str);return div.appendChild(text),div.innerHTML},Util.Xml.getAttribute=function(node,name){return node.getAttribute(name)},Util.Xml.getAttributeBool=function(node,name){return Util.Converters.parseBoolean(node.getAttribute(name))},Util.Xml.getAttributeInt=function(node,name){return Util.Converters.parseInt(node.getAttribute(name))},Util.Xml.getCData=function(node,name){var nodeText=Util.Dom.queryTag(name,node);return null!=nodeText?Util.Xml.getNodeText(nodeText):null},Util.Xml.MAX_XML_SIZE_KB=2048,Util.Xml.MAX_ELEMENT_DEPTH=256,Util.Xml.createDocument=function(opt_rootTagName,opt_namespaceUri){if(opt_namespaceUri&&!opt_rootTagName)throw Error("Can't create document with namespace and no root tag");if(document.implementation&&document.implementation.createDocument)return document.implementation.createDocument(opt_namespaceUri||"",opt_rootTagName||"",null);if("undefined"!=typeof ActiveXObject){var doc=Util.Xml._createMsXmlDocument();if(doc)return opt_rootTagName&&doc.appendChild(doc.createNode(Util.Dom.NodeType.ELEMENT,opt_rootTagName,opt_namespaceUri||"")),doc}throw Error("Your browser does not support creating new documents")},Util.Xml.parseFromString=function(text,type){type=type||"text/xml";var xmlDoc;window.DOMParser?xmlDoc=(new window.DOMParser).parseFromString(text,type):(xmlDoc=Util.Xml._createMsXmlDocument()).loadXML(text);var errorMsg=null;if(xmlDoc.parseError&&0!=xmlDoc.parseError.errorCode)errorMsg="XML Parsing Error: "+xmlDoc.parseError.reason+" at line "+xmlDoc.parseError.line+" at position "+xmlDoc.parseError.linepos;else if(xmlDoc.documentElement){"parsererror"==xmlDoc.documentElement.nodeName&&(errorMsg=xmlDoc.documentElement.childNodes[0].nodeValue);var errors=xmlDoc.getElementsByTagName("parsererror");errors.length>0&&(errorMsg=errors[0].textContent)}else errorMsg="XML Parsing Error";if(errorMsg)throw new Error(errorMsg);return xmlDoc},Util.Xml.serializeToString=function(node){if("undefined"!=typeof XMLSerializer)return(new XMLSerializer).serializeToString(node);if(node.xml)return node.xml;throw Error("Your browser does not support serializing XML documents")},Util.Xml._createMsXmlDocument=function(){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.async=!1,doc.resolveExternals=!1,doc.validateOnParse=!1;try{doc.setProperty("ProhibitDTD",!0),doc.setProperty("MaxXMLSize",Util.Dom.MAX_XML_SIZE_KB),doc.setProperty("MaxElementDepth",Util.Dom.MAX_ELEMENT_DEPTH)}catch(e){}return doc},Util.Xml.innerHTML=function(node){var str=Util.Xml.serializeToString(node);return $(str).html()},Util.Frame={},Util.Frame.DOCTYPE_HTML32='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">',Util.Frame.DOCTYPE_HTML4_TRANSITIONAL='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',Util.Frame.DOCTYPE_HTML4_STRICT='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',Util.Frame.DOCTYPE_XHTML1_TRANSITIONAL='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',Util.Frame.DOCTYPE_XHTML1_STRICT='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',Util.Frame.DOCTYPE_XHTML11='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">',Util.Frame.DOCTYPE_MATHML='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"',Util.Frame.DOCTYPE_HTML5="<!DOCTYPE html>",Util.Frame.createElement=function(id){var frame;return YAHOO.env.ua.ie>0&&Util.Browser.getIEDocMode()<9?frame=document.createElement('<iframe id="'+id+'" name="'+id+'">'):((frame=document.createElement("iframe")).setAttribute("id",id),frame.setAttribute("name",id)),frame},Util.Frame.create=function(id,parent){var iframe=Util.Frame.createElement(id);YAHOO.util.Dom.addClass(iframe,"contentFrame"),iframe.onLoading=new YAHOO.util.CustomEvent("loading",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.onLoaded=new YAHOO.util.CustomEvent("loaded",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.onAborted=new YAHOO.util.CustomEvent("aborted",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.onBeforeShow=new YAHOO.util.CustomEvent("beforeShow",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.onShow=new YAHOO.util.CustomEvent("show",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.onBeforeHide=new YAHOO.util.CustomEvent("beforeHide",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.onHide=new YAHOO.util.CustomEvent("hide",iframe,!1,YAHOO.util.CustomEvent.FLAT),iframe.timestamps={createDate:new Date,attemptDate:null,loadDate:null,showDate:null,hideDate:null,abortDate:null},iframe.durationCounters={loadTime:0,visitTime:0},iframe.counters={attemptCount:0,loadCount:0,showCount:0,hideCount:0,abortCount:0},iframe.debug=function(){Util.dir(iframe.timestamps),Util.dir(iframe.durationCounters),Util.dir(iframe.counters)};var config={name:id,border:"0"};for(var i in config)YAHOO.lang.hasOwnProperty(config,i)&&iframe.setAttribute(i,config[i]);return YAHOO.env.ua.ie?iframe.src="javascript:false;":iframe.src="javascript:;",parent.appendChild(iframe),this.addEnhancements(iframe),iframe},Util.Frame.getFrames=function(doc){var frames="iframe"==doc.tagName.toLowerCase()?[doc]:[],$nestedFrame=$(doc).find("iframe");return $nestedFrame.length>0&&$nestedFrame.each(function(){frames.concat(Util.Frame.getFrames($nestedFrame.contents()))}),frames},Util.Frame.addEnhancements=function(iframe){var enhancements={abortTimer:null,loadState:0,getDebugID:function(){return this.id.replace("iframe_","")},_loadInit:function(timeout){if(1==this.loadState)return!1;this.loadState=1;var successCallback=function(){null!=this.abortTimer&&this.abortTimer.cancel(),YUE.removeListener(this,"load",successCallback),-1!=this.loadState&&(this.counters.loadCount++,this.timestamps.loadDate=new Date,this.durationCounters.loadTime=this.timestamps.loadDate-this.timestamps.attemptDate,this.loadState=2,this.onLoaded.fire(this))};return YUE.addListener(this,"load",successCallback),this.onLoading.fire(this),null!=timeout&&timeout>=0&&(this.abortTimer=YAHOO.lang.later(timeout,this,function(){YUE.removeListener(this,"load",successCallback),2!=this.loadState&&(this.abort(),this.counters.abortCount++,this.timestamps.abortDate=new Date,this.loadState=-1,this.onAborted.fire(this))})),this.counters.attemptCount++,this.timestamps.attemptDate=new Date,!0},abort:function(){try{this.getWindow().stop()}catch(ex){}},load:function(url,timeout){if(!this._loadInit(timeout))return!1;Util.log("iframe "+this.getDebugID()+": formPost = "+url);var frameRequests=document.getElementById("frameRequests");null==frameRequests&&((frameRequests=document.createElement("div")).id="frameRequests",document.body.appendChild(frameRequests),YUD.setStyle(frameRequests,"display","none"));var form=document.createElement("form");return frameRequests.appendChild(form),form.enctype=form.encoding="multipart/form-data",form.setAttribute("action",url),form.setAttribute("method","POST"),form.setAttribute("target",this.id),form.submit(),!0},loadHtml:function(html,timeout){if(!this._loadInit(timeout))return!1;var doc=this.getDocument();return doc.open(),doc.write(html),doc.close(),!0},isShowing:function(){return"IFRAME"==this.tagName&&"IFRAME"==this.nodeName||Util.log("iframe: show error this is not a iframe"),!YAHOO.util.Dom.hasClass(this,"contentFrameHide")},forceRedraw:function(){var body=this.getBody();YUD.addClass(body,"forceRedraw"),setTimeout(function(){YUD.removeClass(body,"forceRedraw")},1)},show:function(){return this.isShowing()?(Util.log("iframe: Trying to show a page that is currently showing."),!1):!1!==this.onBeforeShow.fire(this)&&(this.timestamps.showDate=new Date,this.counters.showCount++,YAHOO.util.Dom.removeClass(this,"contentFrameHide"),this.onShow.fire(this),this.forceRedraw(),!0)},hide:function(){return this.isShowing()?!1!==this.onBeforeHide.fire(this)&&(this.timestamps.hideDate=new Date,this.counters.hideCount++,this.durationCounters.visitTime+=this.timestamps.hideDate-this.timestamps.showDate,YAHOO.util.Dom.addClass(this,"contentFrameHide"),this.onHide.fire(this),!0):(Util.log("iframe: Trying to hide a page that is currently hidden."),!1)},getWindow:function(){return window[this.id]},getDocument:function(){var doc=null;try{iframe.contentDocument?doc=iframe.contentDocument:iframe.contentWindow?doc=iframe.contentWindow.document:iframe.document&&(doc=iframe.document)}catch(ex){}return doc},getBody:function(){return this.getDocument().body},havePermission:function(){try{return this.getDocument(),!0}catch(e){return!1}}};Util.Object.mix(iframe,enhancements)},Util.Frame.BLANK_SOURCE='javascript:""',Util.Frame.STYLES_="border:0;vertical-align:bottom;",Util.Frame.createBlank=function(opt_styles){return Util.Dom.Builder.createDom("iframe",{frameborder:0,style:Util.Frame.STYLES_+(opt_styles||""),src:Util.Frame.BLANK_SOURCE})},Util.Frame.writeContent=function(iframe,content){var doc=Util.Dom.getFrameContentDocument(iframe);doc.open(),doc.write(content),doc.close()},Util.Frame.createWithContent=function(parentElement,opt_headContents,opt_bodyContents,opt_styles,opt_quirks){var contentBuf=[];opt_quirks||contentBuf.push("<!DOCTYPE html>"),contentBuf.push("<html><head>",opt_headContents,"</head><body>",opt_bodyContents,"</body></html>");var iframe=Util.Frame.createBlank(opt_styles);return parentElement.appendChild(iframe),Util.Frame.writeContent(iframe,contentBuf.join("")),iframe},Util.Frame.createHidden=function(id){var frame=Util.Frame.createElement(id);frame.setAttribute("border","0"),frame.setAttribute("frameBorder","0"),frame.setAttribute("width","0"),frame.setAttribute("marginWidth","0"),frame.setAttribute("height","0"),frame.setAttribute("marginHeight","0"),frame.setAttribute("leftMargin","0"),frame.setAttribute("topMargin","0"),frame.setAttribute("allowTransparency","false");return frame.setAttribute("style","width:0px; height:0px; border: 0px; visibility: hidden; display:block;"),frame.src=YAHOO.env.ua.ie?"javascript:false;":"javascript:;",frame},Util.Frame.injectApplet=function(id,config){var frame=Util.Frame.createHidden(id);document.body.appendChild(frame);var script_events='<script type="text/javascript">function tdsFireEvent(id, name, event, data, sequenceNumber, logSeqNumber) { setTimeout(function() { if (typeof(parent.{callback}) != "function") return; parent.{callback}(document.getElementById(id), event, data, sequenceNumber, logSeqNumber); }, 0); }<\/script>',appletHtml='<applet id="{id}" name="{id}" archive="{archive}" codebase="{codebase}" code="{code}" mayscript="true" scriptable="true"><param value="{id}" name="id"/></applet>',frameHtml='<html><head><script type="text/javascript">function getCookies() { return document.cookie; }<\/script>'+(script_events=YAHOO.lang.substitute(script_events,config))+"</head><body>"+(appletHtml=YAHOO.lang.substitute(appletHtml,config))+"</body></html>",frameDoc=frame.contentDocument?frame.contentDocument:frame.contentWindow?frame.contentWindow.document:frame.document;return frameDoc.open(),frameDoc.write(frameHtml),frameDoc.close(),frameDoc.getElementById(config.id)},Util.Frame.injectEmbed=function(id,type){var frame=Util.Frame.createHidden(id);document.body.appendChild(frame);var embedHtml='<embed type="{type}"></embed>',frameHtml="<html><head></head><body>"+(embedHtml=YAHOO.lang.substitute(embedHtml,{type:type}))+"</body></html>",frameDoc=frame.contentDocument?frame.contentDocument:frame.contentWindow?frame.contentWindow.document:frame.document;return frameDoc.open(),frameDoc.write(frameHtml),frameDoc.close(),frameDoc.getElementsByTagName("embed")[0]},Util.Frame.createHtml=function(bodyHtml,options){options=options||{};var html=[];YAHOO.lang.isObject(options.docType)||(options.docType=Util.Frame.DOCTYPE_XHTML1_TRANSITIONAL),html.push(options.docType),html.push('<html xmlns="http://www.w3.org/1999/xhtml">'),html.push("<head>"),html.push('<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />'),YAHOO.lang.isObject(options.baseURI)||(options.baseURI=document.baseURI||document.URL);var frameURI=options.baseURI.replace(/[^/]*$/,"");return html.push('<base href="'+frameURI+'" />'),YAHOO.lang.isArray(options.scripts)&&Util.Array.each(options.scripts,function(script){html.push('<script type="text/javascript" src="'+script+'"><\/script>')}),YAHOO.lang.isArray(options.styles)&&Util.Array.each(options.styles,function(style){html.push('<link type="text/css" rel="stylesheet" href="'+style+'" />')}),html.push("</head>"),YAHOO.lang.isString(options.callbackName)?html.push('<body onload="setTimeout(function() { parent.'+options.callbackName+'(this); }, 0);"'):html.push("<body>"),YAHOO.lang.isString(bodyHtml)&&html.push(bodyHtml),html.push("</body></html>"),html.join("")},Util.Frame.loadInBackground=function(src,parent){var iframe=$("<iframe>").attr({src:src,style:"display:none;"}),deferred=Util.Promise.defer();return iframe.load(function(){deferred.resolve(iframe)}),iframe.appendTo(parent||document.body),deferred.promise},function(Util){function serialize(value){return JSON.stringify(value)}function deserialize(value){if("string"==typeof value)try{return JSON.parse(value)}catch(ex){return value||void 0}}var Storage=function(api){this._api=api};Storage.prototype.length=function(){return this._api.length},Storage.prototype.remove=function(key){this._api.removeItem(key)},Storage.prototype.setString=function(key,value){this._api.setItem(key,value)},Storage.prototype.set=function(key,value){void 0===value?this.remove(key):this.setString(key,serialize(value))},Storage.prototype.getString=function(key){try{return this._api.getItem(key)}catch(ex){return}},Storage.prototype.get=function(key){var json=this.getString(key);if(void 0!==json&&null!==json)try{return deserialize(json)}catch(ex){throw new Error('Invalid data for the key "'+key+'"')}},Storage.prototype._key=function(index){return this._api.key(index)},Storage.prototype.keys=function(filter){for(var keys=[],i=0,len=this.length();i<len;i++){var key=this._key(i);key&&("function"!=typeof filter||filter(key))&&keys.push(key)}return keys},Storage.prototype.clear=function(){this._api.clear?this._api.clear():this.keys().forEach(function(key){this.remove(key)}.bind(this))},Util.Storage=new Storage(sessionStorage)}(Util),window.Util=window.Util||{},Util.XDM=function($){function postRequest(requestName){var req=new Request(requestName);return req.targetWindow=this.targetWindow||defaults.targetWindow,req.targetOrigin=this.targetOrigin||defaults.targetOrigin,req.data=[].slice.call(arguments,1),req.send(),req}function messageHandler(evt){try{var data=XDM.deserialize(evt.data)}catch(ex){return void console.log("XDM: error parsing json data")}if("request"===data.type){console.log("MESSAGE REQUEST: ",data);var response=new Response(data);response.targetWindow=evt.source,response.targetOrigin="null"===evt.origin?defaults.targetOrigin:evt.origin,response.send()}else"response"===data.type&&(console.log("MESSAGE RESPONSE: ",data),data.success?requests[data.id].resolve(data.data):requests[data.id].reject(new XDM.Error(data.data)),delete requests[data.id])}function Request(name){this.init.apply(this,[].slice.call(arguments))}function Response(req){this.init(req)}var defaults={targetWindow:window,targetOrigin:"*",sourceOrigin:!1},id=0,requests={},listeners={},XDM=function(targetWindow,targetOrigin){return targetWindow=targetWindow||window,$.extend(XDM.bind(),{targetWindow:targetWindow,targetOrigin:targetOrigin,post:postRequest})};return XDM.useJQuery=function(jQuery){$=jQuery},XDM.serialize=function(value){return JSON.stringify(value)},XDM.deserialize=function(value){return JSON.parse(value)},XDM.suppressException=!1,XDM.init=function(thisWindow){return(thisWindow=thisWindow||window).addEventListener&&thisWindow.addEventListener("message",messageHandler,!0),XDM},XDM.addListener=function(name,callback){listeners[name]=callback},XDM.removeListener=function(name){delete listeners[name]},XDM.removeListeners=function(){Object.keys(listeners).forEach(function(key){XDM.removeListener(key)})},Request.prototype.init=function(name){$.extend(this,$.Deferred()),this.id=++id,this.name=name,this.data=[].slice.call(arguments),this.type="request",requests[id]=this},Request.prototype.send=function(){this.targetWindow=this.targetWindow||defaults.targetWindow,this.targetOrigin=this.targetOrigin||defaults.targetOrigin,this.targetWindow.postMessage(XDM.serialize(this),this.targetOrigin)},Request.prototype.toJSON=function(){return{id:this.id,name:this.name,type:this.type,data:this.data}},Request.create=function(obj){return $.extend(new Request,obj)},Response.prototype.init=function(req){this.id=req.id,this.name=req.name,this.type="response";try{var request=Request.create(req),listener=listeners[req.name];if(!listener)throw new Error("Could not find the listener '"+req.name+"'");this.data=listener.apply(this,request.data),this.success=!0}catch(error){this.data=new XDM.Error(error),this.success=!1}},Response.prototype.send=function(){function postMessage(value){request.data=value,request.targetWindow.postMessage(XDM.serialize(request),request.targetOrigin)}this.targetWindow=this.targetWindow||defaults.targetWindow,this.targetOrigin=this.targetOrigin||defaults.targetOrigin;var request=this;if($.when(this.data).then(function(value){postMessage(value)},function(error){request.success=!1,error instanceof Error&&(error=new XDM.Error(error)),postMessage(error)}),!XDM.suppressException&&!this.success)throw this.data.error},Response.prototype.toJSON=function(){return{id:this.id,name:this.name,type:this.type,data:this.data,success:this.success}},XDM.Error=function(error){this.error=error,$.extend(this,error),this.name=error.name,this.message=error.message,this.number=error.number,this.description=error.description,this.fileName=error.fileName,this.lineNumber=error.lineNumber,this.stack=error.stack,this.toString=function(){return this.message}},XDM}(window.$),function(Util){function Slider(id,min,max){this._id=id,this._min=min,this._max=max,this._element=null,this._instance=null,this._value=this._min,this._tickSize=0,this.onStart=new Util.Event.Custom(this),this.onChange=new Util.Event.Custom(this),this.onEnd=new Util.Event.Custom(this)}Slider.prototype.getId=function(){return this._id},Slider.prototype.getEl=function(){return this._element},Slider.prototype.getValue=function(fromUserInterface){return fromUserInterface?this._instance.getValue()/this._tickSize+this._min:this._value},Slider.prototype._setValue=function(realValue){return realValue=Math.min(realValue,this._max),realValue=Math.max(realValue,this._min),this._value=realValue,realValue},Slider.prototype.setValue=function(realValue){realValue=this._setValue(realValue),this._instance&&this._instance.setValue((realValue-this._min)*this._tickSize,!0)},Slider.prototype.increment=function(){this.setValue(this.getValue()+this._tickSize)},Slider.prototype.decrement=function(){this.setValue(this.getValue()-this._tickSize)},Slider.prototype.render=function(sliderWidth,thumbWidth){var maxThumbPos=(sliderWidth=sliderWidth||195)-(thumbWidth=thumbWidth||23),container=document.createElement("div");container.className="slide_controls_slider yui-h-slider",container.style.width=sliderWidth+"px";var bgSlider=document.createElement("div");bgSlider.id="slider_bg_"+this._id,bgSlider.className="slide_controls_slider_bg",bgSlider.style.width=sliderWidth+"px",bgSlider.setAttribute("tabindex",0),bgSlider.setAttribute("touch-action","none"),container.appendChild(bgSlider);var timelineContainer=document.createElement("div");timelineContainer.id="slider_timeline_"+this._id,timelineContainer.className="slide_controls_slider_timeline",timelineContainer.style.width=sliderWidth-thumbWidth+"px",timelineContainer.style.marginLeft=.5*thumbWidth+"px",timelineContainer.style.marginRight=.5*thumbWidth+"px",container.appendChild(timelineContainer);var thumbSlider=document.createElement("span");thumbSlider.id="slider_image_"+this._id,thumbSlider.className="slide_controls_img",thumbSlider.style.position="absolute",thumbSlider.setAttribute("touch-action","none"),bgSlider.appendChild(thumbSlider),this._element=container,this._tickSize=maxThumbPos/(this._max-this._min),this._instance=YAHOO.widget.Slider.getHorizSlider(bgSlider,thumbSlider,0,maxThumbPos,this._tickSize),this._instance.keyIncrement=this._tickSize,this._instance.animate=!1,this._instance.getThumb().setXTicks=function(iStartX,iTickSize){this.xTicks=[],this.xTickSize=iTickSize;for(var tickCount=(Math.max(this.maxX,this.minX)-Math.min(this.maxX,this.minX))/iTickSize,i=0,x=this.minX;i<tickCount;++i,x+=iTickSize)this.xTicks[this.xTicks.length]=x;this.xTicks[this.xTicks.length]=this.maxX};var isDragging=!1,sliderBeginMove=function(){if(!isDragging){var fromUserInterface=1===this._instance.valueChangeSource;this.onStart.fire(this.getValue(fromUserInterface),fromUserInterface),isDragging=!0}}.bind(this);this._instance.thumb.subscribe("mouseDownEvent",sliderBeginMove),this._instance.subscribe("slideStart",sliderBeginMove);var sliderMoved=function(event){var fromUserInterface=1===this._instance.valueChangeSource,value=this.getValue(fromUserInterface);value=this._setValue(value),event.fire(value,fromUserInterface)}.bind(this);return this._instance.subscribe("change",function(){sliderMoved(this.onChange)}.bind(this)),this._instance.subscribe("slideEnd",function(){sliderMoved(this.onEnd),isDragging=!1}.bind(this)),container},Slider.create=function(id,min,max,width){var slider=new Slider(id,min,max);return slider.render(width),slider},Util.Slider=Slider}(Util),function(Util){var workerFactory={};if(Util.Browser.isSecure()&&Util.Browser.getSecureVersion()>=7){var workerBody=["(function () {","    function handleImportScriptCommand(event) {","        var command = event.data.command,","            scriptUrl = event.data.scriptUrl;","","        if (command === 'bootstrap-workerfactory' && scriptUrl) {","            console.log('bootstrapping worker with url \"' + scriptUrl + '\"');","","            importScripts(scriptUrl);","            self.removeEventListener('message', handleImportScriptCommand);","        }","    }","","    self.addEventListener('message', handleImportScriptCommand);","})();"].join("\n"),blob=new Blob([workerBody],{type:"text/javascript"}),url=URL.createObjectURL(blob),workerPool=[],initialPoolSize=1;!function(){for(;initialPoolSize--;){var worker=new Worker(url);workerPool.push(worker)}}(),workerFactory.create=function(scriptUrl){var worker=workerPool.shift();return worker.postMessage({command:"bootstrap-workerfactory",scriptUrl:scriptUrl}),worker}}else workerFactory.create=function(scriptUrl){return new Worker(scriptUrl)};Object.freeze(workerFactory),Util.workerFactory=workerFactory}(Util),"object"!=typeof Summit&&(Summit={}),"object"!=typeof Summit.SecureBrowser&&(Summit.SecureBrowser={}),Summit.SecureBrowser.Mobile=function(){var AIRMobile={CMD_RECORD_AUDIO:"cmdRecordAudioSample",CMD_INITIALIZE:"cmdInitialize",CMD_GET_PROCESSES:"cmdGetNativeProcesses",CMD_CHECK_GUIDED_ACCESS:"cmdCheckGuidedAccess",CMD_ENABLE_GUIDED_ACCESS:"cmdEnableGuidedAccess",CMD_CHECK_TTS:"cmdCheckTTS",CMD_JAVASCRIPT_LOG:"cmdJavascriptLog",CMD_SET_DEFAULT_URL:"cmdSetDefaultURL",CMD_CHECK_ORIENTATION:"cmdCheckOrientation",CMD_LOCK_ORIENTATION:"cmdLockOrientation",CMD_SPEAK_TEXT:"cmdSpeakText",CMD_STOP_SPEAKING:"cmdStopSpeaking",CMD_PAUSE_SPEAKING:"cmdPauseSpeaking",CMD_RESUME_SPEAKING:"cmdResumeSpeaking",CMD_CHECK_SPEAK_STATUS:"cmdCheckSpeakStatus",CMD_TTS_SETPITCH:"cmdSetPitch",CMD_TTS_SETRATE:"cmdSetRate",CMD_TTS_SETVOLUME:"cmdSetVolume",CMD_EXIT_APPLICATION:"cmdExitApplication",CMD_RESTART_APPLICATION:"cmdRestartApplication",CMD_SET_MIC_MUTE:"cmdSetMicMuted",CMD_CLEAR_WEB_CACHE:"cmdRequestClearWebCache",CMD_CLEAR_WEB_COOKIES:"cmdRequestClearCookies",CMD_GET_MAC_ADDRESS:"cmdRequestGetMACAddress",CMD_GET_IP_ADDRESS_LIST:"cmdRequestGetIPAddressList",CMD_GET_START_TIME:"cmdRequestGetStartTime",EVENT_CONNECTIVITY_CHANGED:"airMobile_connectivity_changed",EVENT_DEFAULT_URL_CHANGED:"airMobile_default_url_changed",EVENT_DEVICE_READY:"airMobile_device_ready",EVENT_ENTER_BACKGROUND:"airMobile_enter_background",EVENT_RETURN_FROM_BACKGROUND:"airMobile_return_from_background",EVENT_GUIDED_ACCESS_CHANGED:"airMobile_guided_access_changed",EVENT_RUNNING_PROCESSES_CHANGED:"airMobile_running_process_changed",EVENT_TTS_CHANGED:"airMobile_tts_changed",EVENT_TTS_SYNCHRONIZED:"airMobile_tts_synchronized",EVENT_ORIENTATION_CHANGED:"airMobile_orientation_changed",EVENT_KEYBOARD_CHANGED:"airMobile_keyboard_changed",EVENT_MIC_MUTE_CHANGED:"airMobile_mic_mute_changed",EVENT_MINI_APP_DETECTED:"airMobile_mini_app_detected",EVENT_CLIPBOARD_CHANGED:"airMobile_clipboard_changed",EVENT_TEXT_SELECTED:"airMobile_text_selected",callbacks:{},device:{isReady:!1,apiVersion:-1,defaultURL:"Unknown",rootAccess:!1,model:"Unknown",manufacturer:"Unknown",operatingSystem:"Unknown",operatingSystemVersion:"Unknown",connectivityStatus:"Unknown",guidedAccessEnabled:!1,textToSpeechEnabled:!1,ttsEngineStatus:"unavailable",runningProcesses:[],installedPackages:[],screenResolution:"Unknown",orientation:"Unknown",lockedOrientation:"none",keyboard:"unknown",micMuted:!1,ipAddress:"unknown",macAddress:"unknown",startTime:"unknown",ttsVoices:"unknown",ttsPitch:0,ttsRate:0,ttsVolume:0,screenShotsEnabled:function(){var isIOS,isAndroid;return isIOS="iphone os"==this.operatingSystem.toLowerCase(),isAndroid=!isIOS,isIOS?!this.guidedAccessEnabled:!isAndroid},supportsFeature:function(_feature){var isIOS,isAndroid;return isIOS="iphone os"==this.operatingSystem.toLowerCase(),isAndroid="android"==this.operatingSystem.toLowerCase(),"guided_access"==_feature?isIOS:"text_to_speech"==_feature?isIOS||isAndroid:"running_processes"==_feature?isIOS||isAndroid:"installed_packages"==_feature?isAndroid:"mic_mute"==_feature?isAndroid:"tts_engine"==_feature?isAndroid||isIOS:"exit"==_feature&&isAndroid},formattedDeviceInfo:function(){var isiOS="iphone os"==this.operatingSystem.toLowerCase();return"Device: "+this.model+", OS: "+this.operatingSystem+", Version: "+this.operatingSystemVersion+(isiOS?", Jailbroken: ":", Rooted: ")+(this.rootAccess?"Yes":"No")+", Resolution: "+this.screenResolution}},checkGuidedAccessStatus:function(_identifier,_callback){return this.sendCommand(this.CMD_CHECK_GUIDED_ACCESS,_identifier,_callback)},enableGuidedAccess:function(toEnable,_identifier,_callback){_identifier=null==_identifier?this.UUID():_identifier,this.callbacks[_identifier]=_callback;var params={identifier:_identifier,enable:toEnable?"true":"false"};this.sendToApp(this.CMD_ENABLE_GUIDED_ACCESS,JSON.stringify(params,null,!0))},checkRunningProcesses:function(_identifier,_callback){return this.sendCommand(this.CMD_GET_PROCESSES,_identifier,_callback)},checkTextToSpeechStatus:function(_identifier,_callback){return this.sendCommand(this.CMD_CHECK_TTS,_identifier,_callback)},checkOrientation:function(_identifier,_callback){return this.sendCommand(this.CMD_CHECK_ORIENTATION,_identifier,_callback)},requestOrientationLock:function(_orientation,_identifier,_callback){_identifier=null==_identifier?this.UUID():_identifier,this.callbacks[_identifier]=_callback;var params={identifier:_identifier,orientation:_orientation};return this.sendToApp(this.CMD_LOCK_ORIENTATION,JSON.stringify(params,null,!0)),_identifier},recordAudio:function(_duration,_identifier,_callback){_identifier=null==_identifier?this.UUID():_identifier,this.callbacks[_identifier]=_callback;var params={identifier:_identifier,duration:_duration};return this.sendToApp(this.CMD_RECORD_AUDIO,JSON.stringify(params,null,!0)),_identifier},setDefaultURL:function(_urlString,_identifier,_callback){var params=null;return null!=_callback?(_identifier=null==_identifier?this.UUID():_identifier,this.callbacks[_identifier]=_callback,params={identifier:_identifier,url:_urlString}):params={url:_urlString},this.sendToApp(this.CMD_SET_DEFAULT_URL,JSON.stringify(params,null,!0)),_identifier},exitApplication:function(_identifier,_callback){return this.sendCommand(this.CMD_EXIT_APPLICATION,_identifier,_callback)},restartApplication:function(_identifier,_callback){return this.sendCommand(this.CMD_RESTART_APPLICATION,_identifier,_callback)},setMicMute:function(_muted,_identifier,_callback){var params=null;return null!=_callback&&(_identifier=null==_identifier?this.UUID():_identifier,this.callbacks[_identifier]=_callback,params={identifier:_identifier,muted:_muted}),this.sendToApp(this.CMD_SET_MIC_MUTE,JSON.stringify(params,null,!0)),_identifier},ntvOnMicMuteChanged:function(_parameters){var results,changed;return results=JSON.parse(_parameters,null),changed=!1,this.device.micMuted!=results.muted&&(changed=!0,this.device.micMuted=results.muted),this.executeCallback(results),1==changed&&this.dispatchEvent(this.EVENT_MIC_MUTE_CHANGED),this.device.micMuted},ntvOnRecordingComplete:function(_parameters){var results=JSON.parse(_parameters,null);return this.executeCallback(results),"Audio Received"},ntvOnConnectivityChanged:function(_parameters){var results=JSON.parse(_parameters,null);return results.status&&results.status!=this.device.connectivityStatus&&(this.device.connectivityStatus=results.status,this.dispatchEvent(this.EVENT_CONNECTIVITY_CHANGED)),this.device.connectivityStatus},ntvOnDeviceReady:function(_parameters){var results=JSON.parse(_parameters,null);return this.device.isReady=!0,this.device.apiVersion=null!=results.apiVersion?results.apiVersion:-1,this.device.model=results.model,this.device.manufacturer=results.manufacturer,this.device.operatingSystem=results.operatingSystem,this.device.operatingSystemVersion=results.operatingSystemVersion,this.device.runningProcesses=results.runningProcesses,this.device.installedPackages=results.installedPackages,this.device.rootAccess=results.rootAccess,this.device.connectivityStatus=results.connectivity,this.device.defaultURL=results.defaultURL,this.device.textToSpeechEnabled=results.textToSpeech,this.device.guidedAccessEnabled=results.guidedAccess,this.device.screenResolution=results.screenResolution,this.device.orientation=results.orientation,this.device.lockedOrientation=results.lockedOrientation,this.device.ttsEngineStatus=results.ttsEngineStatus,this.device.keyboard=results.keyboard,this.device.micMuted=results.muted,this.device.ipAddress=results.ipAddress,this.device.startTime=results.startTime,this.device.macAddress=results.macAddress,this.device.ttsVoices=results.availableTTSLanguages,null!=results.ttsSettings&&(this.device.ttsPitch=results.ttsSettings.pitch,this.device.ttsRate=results.ttsSettings.rate,this.device.ttsVolume=results.ttsSettings.volume),this.dispatchEvent(this.EVENT_DEVICE_READY),"OK"},ntvOnRequestNotSupported:function(_parameters){var response=JSON.parse(_parameters,null);null==response.errorMessage&&(response.errorMessage="Platform does not support feature"),this.executeCallback(response)},ntvOnGuidedAccessEnabled:function(_parameters){var results,changed;return results=JSON.parse(_parameters,null),changed=results.enabled!=this.device.guidedAccessEnabled,this.device.guidedAccessEnabled=results.enabled,this.executeCallback(results),1==changed&&this.dispatchEvent(this.EVENT_GUIDED_ACCESS_CHANGED),this.device.guidedAccessEnabled},ntvOnEnableGuidedAccessReceived:function(_parameters){var results;null!=(results=JSON.parse(_parameters,null)).enabled&&(this.device.guidedAccessEnabled=results.enabled),this.executeCallback(results)},ntvOnTextToSpeechEnabled:function(_parameters){var results,changed;return results=JSON.parse(_parameters,null),0==(changed=this.device.textToSpeechEnabled!=results.enabled)&&(changed=this.device.ttsEngineStatus!=results.ttsEngineStatus),this.device.textToSpeechEnabled=results.enabled,null!=results.ttsEngineStatus&&(this.device.ttsEngineStatus=results.ttsEngineStatus),this.executeCallback(results),1==changed&&this.dispatchEvent(this.EVENT_TTS_CHANGED),this.device.textToSpeechEnabled},ntvOnTTSSynchronized:function(_parameters){var results=JSON.parse(_parameters,null);null!=results&&this.dispatchMessageEvent(this.EVENT_TTS_SYNCHRONIZED,results)},ntvOnRunningProcessesUpdated:function(_parameters){var results,processes,added,removed;return results=JSON.parse(_parameters,null),processes=results.runningProcesses,added=diffArr(processes,this.device.runningProcesses),removed=diffArr(this.device.runningProcesses,processes),this.device.runningProcesses=processes,this.executeCallback(results),(added.length>0||removed.length>0)&&this.dispatchEvent(this.EVENT_RUNNING_PROCESSES_CHANGED),added.length>0},ntvApplicationEnterBackground:function(){return this.dispatchEvent(this.EVENT_ENTER_BACKGROUND),"OK"},ntvApplicationReturnFromBackground:function(){return this.dispatchEvent(this.EVENT_RETURN_FROM_BACKGROUND),"OK"},ntvOnSetDefaultURL:function(_parameters){var results,changed;return results=JSON.parse(_parameters,null),changed=!1,results.url&&(changed=results.url!=AIRMobile.device.defaultURL,AIRMobile.device.defaultURL=results.url),this.executeCallback(results),changed&&this.dispatchEvent(this.EVENT_DEFAULT_URL_CHANGED),this.device.defaultURL},ntvMiniAppLaunched:function(){return this.dispatchEvent(this.EVENT_MINI_APP_DETECTED),"OK"},ntvOnOrientationChanged:function(_parameters){var results,changed;return results=JSON.parse(_parameters,null),changed=!1,results.orientation&&(changed=results.orientation!=AIRMobile.device.orientation,AIRMobile.device.orientation=results.orientation),this.executeCallback(results),changed&&this.dispatchEvent(this.EVENT_ORIENTATION_CHANGED),this.device.orientation},ntvOnOrientationLockChanged:function(_parameters){var results,orientationChanged;return results=JSON.parse(_parameters,null),orientationChanged=!1,results.lockedOrientation&&(AIRMobile.device.lockedOrientation=results.lockedOrientation),results.orientation&&(orientationChanged=results.orientation!=AIRMobile.device.orientation,AIRMobile.device.orientation=results.orientation),this.executeCallback(results),orientationChanged&&this.dispatchEvent(this.EVENT_ORIENTATION_CHANGED),this.device.lockedOrientation},ntvOnKeyboardChanged:function(_parameters){var results=JSON.parse(_parameters,null);return results.keyboard&&(this.device.keyboard=results.keyboard),this.dispatchEvent(this.EVENT_KEYBOARD_CHANGED),results.keyboard},ntvOnClipboardContentsChanged:function(_parameters){var results=JSON.parse(_parameters,null);return this.dispatchMessageEvent(this.EVENT_CLIPBOARD_CHANGED,results.contents)},ntvOnTextSelected:function(_parameters){return this.dispatchEvent(this.EVENT_TEXT_SELECTED)},dispatchEvent:function(_eventName){var result,event;return result=!1,_eventName&&_eventName.length>0&&((event=document.createEvent("Event")).initEvent(_eventName,!0,!0),document.dispatchEvent(event),result=!0),result},dispatchMessageEvent:function(_eventName,_message){var result,origin,event;return result=!1,_eventName&&_eventName.length>0&&(origin=window.location.protocol+"//"+window.location.host,(event=document.createEvent("MessageEvent")).initMessageEvent(_eventName,!0,!0,_message,origin,12,window,null),document.dispatchEvent(event),result=!0),result},executeCallback:function(_responseObject){var callback,result;return callback=this.callbacks[_responseObject.identifier],result=!1,null!=callback?(callback(_responseObject),delete this.callbacks[_responseObject.identifier],result=!0):null!=_responseObject.identifier&&console.warn("No callback for identifier: "+_responseObject.identifier),result},log:function(_parameters){this.sendToApp(this.CMD_JAVASCRIPT_LOG,_parameters)},sendToApp:function(_key,_value){var iframe=document.createElement("IFRAME");iframe.setAttribute("src",_key+":##airMobile_msgsnd##"+_value),document.documentElement.appendChild(iframe),iframe.parentNode.removeChild(iframe),iframe=null},sendCommand:function(_command,_identifier,_callback){var params=null;return null!=_callback&&(_identifier=null==_identifier?this.UUID():_identifier,this.callbacks[_identifier]=_callback,params={identifier:_identifier}),this.sendToApp(_command,JSON.stringify(params,null,!0)),_identifier},UUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},listen:function(evnt,elem,func){if(elem.addEventListener)elem.addEventListener(evnt,func,!1);else if(elem.attachEvent)return elem.attachEvent("on"+evnt,func)},initialize:function(){var params={version:"2.0"};this.sendToApp(this.CMD_INITIALIZE,JSON.stringify(params,null,!0))},security:{isEnvironmentSecure:function(){return!!(!("iphone os"==AIRMobile.device.operatingSystem.toLowerCase())||!AIRMobile.device.screenShotsEnabled()&&AIRMobile.device.guidedAccessEnabled)},enableLockdown:function(){},clearCache:function(){AIRMobile.sendCommand(AIRMobile.CMD_CLEAR_WEB_CACHE,null,null)},clearCookies:function(){AIRMobile.sendCommand(AIRMobile.CMD_CLEAR_WEB_COOKIES,null,null)},getMACAddress:function(){return AIRMobile.device.macAddress},getIPAddressList:function(){return AIRMobile.device.ipAddress},getProcessList:function(){return AIRMobile.device.runningProcesses},close:function(_restart){_restart?AIRMobile.restartApplication(null,null):AIRMobile.exitApplication(null,null)},getStartTime:function(){return AIRMobile.device.startTime},getDeviceInfo:function(){var deviceInfo;return deviceInfo="Manufacturer="+AIRMobile.device.manufacturer,deviceInfo+="|HWVer="+AIRMobile.device.model,deviceInfo+="|SWVer="+AIRMobile.device.operatingSystemVersion}},tts:{speak:function(_textToSpeak,_options,_callback){var params=null,_identifier=null;return null!=_callback&&(_identifier=AIRMobile.UUID(),AIRMobile.callbacks[_identifier]=_callback,params={identifier:_identifier,textToSpeak:_textToSpeak},null!=_options&&(params.options=_options)),"iphone os"==AIRMobile.device.operatingSystem.toLowerCase()?AIRMobile.sendToApp(AIRMobile.CMD_SPEAK_TEXT,encodeURIComponent(JSON.stringify(params,null,!0))):AIRMobile.sendToApp(AIRMobile.CMD_SPEAK_TEXT,JSON.stringify(params,null,!0)),_identifier},stop:function(_identifier,_callback){return AIRMobile.sendCommand(AIRMobile.CMD_STOP_SPEAKING,_identifier,_callback)},getStatus:function(){return AIRMobile.device.ttsEngineStatus},pause:function(){return AIRMobile.sendCommand(AIRMobile.CMD_PAUSE_SPEAKING,null,null)},resume:function(){return AIRMobile.sendCommand(AIRMobile.CMD_RESUME_SPEAKING,null,null)},getVoices:function(){return AIRMobile.device.ttsVoices},getPitch:function(){return AIRMobile.device.ttsPitch},setPitch:function(pitch){AIRMobile.device.ttsPitch=pitch;var params={pitch:pitch};AIRMobile.sendToApp(AIRMobile.CMD_TTS_SETPITCH,JSON.stringify(params,null,!0))},getRate:function(){return AIRMobile.device.ttsRate},setRate:function(rate){AIRMobile.device.ttsRate=rate;var params={rate:rate};AIRMobile.sendToApp(AIRMobile.CMD_TTS_SETRATE,JSON.stringify(params,null,!0))},getVolume:function(){return AIRMobile.device.ttsVolume},setVolume:function(volume){AIRMobile.device.ttsVolume=volume;var params={volume:volume};AIRMobile.sendToApp(AIRMobile.CMD_TTS_SETVOLUME,JSON.stringify(params,null,!0))}}};AIRMobile.listen("load",window,function(){AIRMobile.initialize()}),AIRMobile.recorder={EVENT_INITIALIZING:"INITIALIZING",EVENT_READY:"READY",EVENT_ERROR:"ERROR",EVENT_START:"START",EVENT_INPROGRESS:"INPROGRESS",EVENT_END:"END",EVENT_PLAYBACK_START:"PLAYBACK_START",EVENT_PLAYBACK_END:"PLAYBACK_END",EVENT_PLAYBACK_PAUSED:"PLAYBACK_PAUSED",EVENT_PLAYBACK_RESUMED:"PLAYBACK_RESUMED",EVENT_PLAYBACK_STOPPED:"PLAYBACK_STOPPED",EVENT_PLAYBACK_ERROR:"PLAYBACK_ERROR",STATUS_IDLE:"IDLE",STATUS_ACTIVE:"ACTIVE",STATUS_INITIALIZING:"INITIALIZING",STATUS_ERROR:"ERROR",STATUS_STOPPING:"STOPPING",PLAYBACK_STATE_IDLE:"IDLE",PLAYBACK_STATE_PLAYING:"PLAYING",PLAYBACK_STATE_PAUSED:"PAUSED",CMD_INITIALIZE_RECORDER:"cmdInitializeRecorder",CMD_END_AUDIO_CAPTURE:"cmdEndAudioCapture",CMD_START_AUDIO_CAPTURE:"cmdStartAudioCapture",CMD_PLAY_AUDIO:"cmdPlaybackAudio",CMD_STOP_PLAYBACK:"cmdStopAudioPlayback",CMD_PAUSE_PLAYBACK:"cmdPauseAudioPlayback",CMD_RESUME_PLAYBACK:"cmdResumeAudioPlayback",CMD_REQUEST_AUDIO_FILE_LIST:"cmdRequestAudioFileList",CMD_REQUEST_AUDIO_FILE:"cmdRequestAudioFile",CMD_CLEAR_AUDIO_CACHE:"cmdRequestClearAudioCache",status:"unknown",playbackStatus:"IDLE",capabilities:null,initialize:function(_eventListener){this.status=this.STATUS_INITIALIZING,AIRMobile.listen(AIRMobile.recorder.EVENT_INITIALIZING,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_READY,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_ERROR,document,_eventListener),AIRMobile.dispatchEvent(this.EVENT_INITIALIZING);var params={identifier:AIRMobile.UUID()};return AIRMobile.sendToApp(AIRMobile.recorder.CMD_INITIALIZE_RECORDER,JSON.stringify(params,null,!0)),params.identifier},getStatus:function(){return this.status},getCapabilities:function(){if("unknown"==this.status)throw new Error("Recorder not initialized");return this.capabilities},startCapture:function(_options,_eventListener){if(this.status!=AIRMobile.recorder.STATUS_IDLE)throw new Error("Invalid state for recording");var errorMessage=this.errorMessageForOptions(_options);if(null!=errorMessage)throw new Error(errorMessage);return _options.identifier=AIRMobile.UUID(),_options.filename||(_options.filename=_options.identifier),AIRMobile.listen(this.EVENT_START,document,_eventListener),AIRMobile.listen(this.EVENT_END,document,_eventListener),AIRMobile.listen(this.EVENT_INPROGRESS,document,_eventListener),AIRMobile.listen(this.EVENT_ERROR,document,_eventListener),this.status=this.STATUS_ACTIVE,AIRMobile.dispatchEvent(this.EVENT_START),AIRMobile.sendToApp(AIRMobile.recorder.CMD_START_AUDIO_CAPTURE,JSON.stringify(_options,null,!0)),_options.identifier},stopCapture:function(){var params={identifier:AIRMobile.UUID()};if(this.status!=AIRMobile.recorder.STATUS_ACTIVE)throw new Error("Recorder not recording");return AIRMobile.sendToApp(AIRMobile.recorder.CMD_END_AUDIO_CAPTURE,JSON.stringify(params,null,!0)),params.identifier},play:function(_audioData,_eventListener){"filename"==_audioData.type&&null==_audioData.data&&(_audioData.data=_audioData.filename);var params={identifier:AIRMobile.UUID(),audioInfo:_audioData};if(this.playbackStatus==this.PLAYBACK_STATE_IDLE)return AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_START,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_END,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_PAUSED,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_RESUMED,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_STOPPED,document,_eventListener),AIRMobile.listen(AIRMobile.recorder.EVENT_PLAYBACK_ERROR,document,_eventListener),AIRMobile.sendToApp(this.CMD_PLAY_AUDIO,JSON.stringify(params,null,!0)),params.identifier;throw new Error("Audio is already playing")},stopPlay:function(){var params={identifier:AIRMobile.UUID()};if(this.playbackStatus!=this.PLAYBACK_STATE_PLAYING&&this.playbackStatus!=this.PLAYBACK_STATE_PAUSED)throw AIRMobile.sendToApp(this.CMD_STOP_PLAYBACK,JSON.stringify(params,null,!0)),new Error("Playback has not begun");AIRMobile.sendToApp(this.CMD_STOP_PLAYBACK,JSON.stringify(params,null,!0))},pausePlay:function(){var params={identifier:AIRMobile.UUID()};if(this.playbackStatus!=this.PLAYBACK_STATE_PLAYING)throw new Error("Playback has not begun");AIRMobile.sendToApp(this.CMD_PAUSE_PLAYBACK,JSON.stringify(params,null,!0))},resumePlay:function(){var params={identifier:AIRMobile.UUID()};if(this.playbackStatus!=this.PLAYBACK_STATE_PAUSED)throw new Error("Playback is not paused");AIRMobile.sendToApp(this.CMD_RESUME_PLAYBACK,JSON.stringify(params,null,!0))},retrieveAudioFile:function(_fileIdentifier,_callback){var identifier,params;null!=_callback&&(identifier=AIRMobile.UUID(),AIRMobile.callbacks[identifier]=_callback,params={identifier:identifier,filename:_fileIdentifier}),AIRMobile.sendToApp(this.CMD_REQUEST_AUDIO_FILE,JSON.stringify(params,null,!0))},clearAudioFileCache:function(_callback){var identifier,params;null!=_callback&&(identifier=AIRMobile.UUID(),AIRMobile.callbacks[identifier]=_callback,params={identifier:identifier}),AIRMobile.sendToApp(this.CMD_CLEAR_AUDIO_CACHE,JSON.stringify(params,null,!0))},retrieveAudioFileList:function(_callback){var identifier,params;null!=_callback&&(identifier=AIRMobile.UUID(),AIRMobile.callbacks[identifier]=_callback,params={identifier:identifier}),AIRMobile.sendToApp(this.CMD_REQUEST_AUDIO_FILE_LIST,JSON.stringify(params,null,!0))},errorMessageForOptions:function(_options){var deviceID,device;return!0,deviceID=_options.captureDevice,AIRMobile.recorder.getCapabilities(),this.isValidDevice(deviceID)?(device=this.getDevice(deviceID),this.isValidOption(device.channelCounts,_options.channelCount)?this.isValidOption(device.sampleRates,_options.sampleRate)?this.isValidOption(device.sampleSizes,_options.sampleSize)?this.isValidOption(device.formats,_options.encodingFormat)?null:"Invalid format for device":"Invalid sample size for device":"Invalid sample rate for device":"Invalid channel count for device"):"The recording device specified does not exist."+deviceID},getDevice:function(_deviceID){var device,capabilities,dev;device=null,capabilities=AIRMobile.recorder.getCapabilities();for(var i=0;i<capabilities.supportedInputDevices.length;i++)(dev=capabilities.supportedInputDevices[i]).id==_deviceID&&(device=dev);return device},isValidDevice:function(_deviceID){var valid,capabilities;if(valid=!1,null!=_deviceID){capabilities=AIRMobile.recorder.getCapabilities();for(var i=0;i<capabilities.supportedInputDevices.length;i++)capabilities.supportedInputDevices[i].id==_deviceID&&(valid=!0)}return valid},isValidOption:function(_options,_selection){for(var found=!1,i=0;i<_options.length;i++)_options[i]==_selection&&(found=!0);return found}},AIRMobile.ntvOnPlaybackStateChanged=function(_parameters){var results=JSON.parse(_parameters,null);"playing"==results.playbackState?(AIRMobile.recorder.playbackStatus=AIRMobile.recorder.PLAYBACK_STATE_PLAYING,AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_START)):"stopped"==results.playbackState?(AIRMobile.recorder.playbackStatus=AIRMobile.recorder.PLAYBACK_STATE_IDLE,AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_STOPPED)):"paused"==results.playbackState?(AIRMobile.recorder.playbackStatus=AIRMobile.recorder.PLAYBACK_STATE_PAUSED,AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_PAUSED)):"resumed"==results.playbackState?(AIRMobile.recorder.playbackStatus=AIRMobile.recorder.PLAYBACK_STATE_PLAYING,AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_RESUMED)):"end"==results.playbackState?(AIRMobile.recorder.playbackStatus=AIRMobile.recorder.PLAYBACK_STATE_IDLE,AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_END)):"error"==results.playbackState&&(AIRMobile.recorder.playbackStatus=AIRMobile.recorder.PLAYBACK_STATE_IDLE,AIRMobile.dispatchEvent(AIRMobile.recorder.EVENT_PLAYBACK_ERROR))},AIRMobile.ntvOnRecorderInitialized=function(_parameters){var results=JSON.parse(_parameters,null),message=null;null==results.state&&(results.state=AIRMobile.recorder.EVENT_ERROR),results.state==AIRMobile.recorder.EVENT_ERROR?message=null!=results.message?results.message:"An error occured initializing the recorder":results.state==AIRMobile.recorder.EVENT_READY&&(AIRMobile.recorder.capabilities=results.capabilities,AIRMobile.recorder.status=this.recorder.STATUS_IDLE),null!=message?this.dispatchMessageEvent(results.state,message):this.dispatchEvent(results.state)},AIRMobile.ntvOnRecorderUpdate=function(_parameters){var results=JSON.parse(_parameters,null);if(results.updateType==AIRMobile.recorder.EVENT_START?AIRMobile.recorder.status=AIRMobile.recorder.STATUS_ACTIVE:results.updateType==AIRMobile.recorder.EVENT_INPROGRESS?AIRMobile.recorder.status=AIRMobile.recorder.STATUS_ACTIVE:results.updateType==AIRMobile.recorder.EVENT_END?AIRMobile.recorder.status=AIRMobile.recorder.STATUS_IDLE:results.updateType==AIRMobile.recorder.EVENT_ERROR&&(AIRMobile.recorder.status=AIRMobile.recorder.STATUS_ERROR),results.updateType==AIRMobile.recorder.EVENT_END){var messageData=JSON.stringify(results.data,null,!0);AIRMobile.dispatchMessageEvent(results.updateType,messageData)}else AIRMobile.dispatchEvent(results.updateType)},AIRMobile.ntvOnAudioFileDataRetrieved=function(_parameters){var results=JSON.parse(_parameters,null);AIRMobile.executeCallback(results)},AIRMobile.ntvOnAudioFileListRetrieved=function(_parameters){var results=JSON.parse(_parameters,null);AIRMobile.executeCallback(results)};var console={log:function(log){setTimeout(function(){AIRMobile.log(JSON.stringify({type:"info",value:log},null,!0))},100)},error:function(log){setTimeout(function(){AIRMobile.log(JSON.stringify({type:"error",value:log},null,!0))},100)},warn:function(log){setTimeout(function(){AIRMobile.log(JSON.stringify({type:"warn",value:log},null,!0))},100)},debug:function(log){setTimeout(function(){AIRMobile.log(JSON.stringify({type:"debug",value:log},null,!0))},100)},info:function(log){setTimeout(function(){AIRMobile.log(JSON.stringify({type:"info",value:log},null,!0))},100)}},diffArr=function(a,b){return a.filter(function(i){return!(b.indexOf(i)>-1)})};window.AIRMobile=AIRMobile,this.getNativeBrowser=function(){return AIRMobile}},function(){-1!=navigator.userAgent.indexOf("AmplifyKiosk")&&(window.browser={security:new function(){this.enableLockDown=function(enabled){window.JavaBrowserSecurity.enableLockDown(enabled)},this.isEnvironmentSecure=function(){return window.JavaBrowserSecurity.isEnvironmentSecure()},this.clearCache=function(){window.JavaBrowserSecurity.clearCache()},this.clearCookies=function(){window.JavaBrowserSecurity.clearCookies()},this.emptyClipBoard=function(){window.JavaBrowserSecurity.emptyClipBoard()},this.close=function(restart){window.JavaBrowserSecurity.close(restart)},this.getDeviceInfo=function(){return JSON.parse(window.JavaBrowserSecurity.getDeviceInfo())},this.getProcessList=function(){return JSON.parse(window.JavaBrowserSecurity.getProcessList())}},tts:new function(){this.progressCallback=function(status,msg){console.log("BrowserTts status: "+status+" "+(msg||"")),void 0!==this.callback&&this.callback(status,msg)},this.speak=function(text,options,callback){this.callback=callback;try{window.JavaBrowserTTS.speak(text,options?JSON.stringify(options):null)}catch(err){this.progressCallback(browser.tts.getStatus(),err)}},this.stop=function(){window.JavaBrowserTTS.stop()},this.pause=function(){window.JavaBrowserTTS.pause()},this.resume=function(){window.JavaBrowserTTS.resume()},this.getStatus=function(){try{return window.JavaBrowserTTS.getStatus()}catch(err){console.log(err)}},this.getVoices=function(){return JSON.parse(window.JavaBrowserTTS.getVoices())}},recorder:new function(){this.progressCallback=function(status,msg){console.log("BrowserRecorder status: "+status+" "+(msg||"")),void 0!==this.callback&&this.callback(status,msg)},this.initialize=function(callback){this.callback=callback;try{window.JavaBrowserRecorder.initialize()}catch(err){this.progressCallback(browser.recorder.getStatus(),err)}},this.getStatus=function(){return window.JavaBrowserRecorder.getStatus()},this.startCapture=function(options,callback){this.callback=callback;try{window.JavaBrowserRecorder.startCapture(options?JSON.stringify(options):null)}catch(err){this.progressCallback(browser.recorder.getStatus(),err)}},this.stopCapture=function(){var filePath=window.JavaBrowserRecorder.stopCapture();return this.progressCallback(browser.recorder.getStatus(),filePath),filePath},this.getCapabilities=function(){return window.JavaBrowserRecorder.getCapabilities()},this.retrieveAudio=function(){return window.JavaBrowserRecorder.retrieveAudio()},this.pausePlayback=function(){window.JavaBrowserRecorder.pausePlayback()},this.resumePlayback=function(){window.JavaBrowserRecorder.resumePlayback()},this.stopPlayback=function(){window.JavaBrowserRecorder.stopPlayback()},this.playback=function(b64audio,callback){this.callback=callback;try{window.JavaBrowserRecorder.playback(b64audio)}catch(err){this.progressCallback(browser.recorder.getStatus(),err)}}}})}(),TDS=window.TDS||{},TDS.SecureBrowser=TDS.SecureBrowser||{},function(SB){var sbImpl=null,sbRecImpl=null;SB.initialize=function(){if(Util.Browser.isSecure()?sbImpl=Util.Browser.isCertified()?new TDS.SecureBrowser.Certified:Util.Browser.isIOS()?new TDS.SecureBrowser.Mobile.iOS:Util.Browser.isAndroid()?new TDS.SecureBrowser.Mobile.Android:Util.Browser.isChrome()?new TDS.SecureBrowser.Chrome:new TDS.SecureBrowser.Firefox:Util.Browser.isChrome()&&(sbImpl=new TDS.SecureBrowser.Chrome),null==sbImpl&&(sbImpl=new TDS.SecureBrowser.Base),Util.Browser.isSecure()&&(Util.Browser.isIOS()||Util.Browser.isAndroid())&&(sbRecImpl=new TDS.SecureBrowser.Mobile.Recorder),Util.Browser.isSecure()&&Util.Browser.isCertified()&&(sbRecImpl=new TDS.SecureBrowser.Certified.Recorder),navigator.plugins)for(var i=0;i<navigator.plugins.length;i++){var plugin=navigator.plugins[i];if(plugin.name&&(0==plugin.name.indexOf("AIR Audio")||"libaudiorecorder.so"==plugin.name||"libnpAIRAudio.so"==plugin.name)){sbRecImpl=new TDS.SecureBrowser.Firefox.Recorder;break}}sbImpl.initialize()},SB.getImplementation=function(){return sbImpl},SB.getRecorder=function(){return sbRecImpl}}(TDS.SecureBrowser),TDS=window.TDS||{},TDS.SecureBrowser=TDS.SecureBrowser||{},function(SB){function Base(){this.Events={onSecurityBreach:new YAHOO.util.CustomEvent("onSecurityBreach",this,!1,YAHOO.util.CustomEvent.FLAT),onSetVolume:new YAHOO.util.CustomEvent("onSetVolume",this,!1,YAHOO.util.CustomEvent.FLAT)},Util.Event.Emitter(this),YUE.on(window,"beforeunload",function(){this.fire("dispose"),this.dispose()}.bind(this))}Base.prototype.initialize=function(){},Base.prototype.dispose=function(){},Base.prototype.canEnvironmentBeSecured=function(){return{canSecure:!0,messageKey:null}},Base.prototype.isEnvironmentSecure=function(){return{secure:!0,messageKey:null}},Base.prototype.clearCache=function(){return!1},Base.prototype.clearCookies=function(){return!1},Base.prototype.clearHistory=function(){this.clearCache(),this.clearCookies()},Base.prototype.emptyClipBoard=function(){return!1},Base.prototype.getMACAddress=function(){return null},Base.prototype.getIPAddressList=function(bypassCache){return[]},Base.prototype.getIPAddress=function(bypassCache){var addressList=this.getIPAddressList();return null!=addressList&&addressList.length>0?addressList[0]:null},Base.prototype.loadProcessList=function(){return!1},Base.prototype.getProcessList=function(){return[]},Base.prototype.getForbiddenApps=function(){var currentForbiddenApps=[];if("object"!=typeof TDS||"object"!=typeof TDS.Config||"object"!=typeof TDS.Config.forbiddenApps||null==TDS.Config.forbiddenApps)return currentForbiddenApps;var processList=this.getProcessList();return processList&&Util.Array.each(processList,function(currentProcess){var processName=currentProcess,parentProcessName="";if(currentProcess.indexOf("|")>-1){var processInfoArray=currentProcess.split("|");processName=processInfoArray[0],parentProcessName=processInfoArray[1]}var matchingApp=Util.Array.find(TDS.Config.forbiddenApps,function(forbiddenApp){if(Util.String.equals(forbiddenApp.name,processName,{trim:!0,ignoreCase:!0})){if(Util.String.isNullOrEmpty(parentProcessName)||Util.String.isNullOrEmpty(forbiddenApp.exemptions))return!0;var exemptionList=forbiddenApp.exemptions.split(",");return null==Util.Array.find(exemptionList,function(exemption){return parentProcessName.indexOf(exemption)>-1})}});null!=matchingApp&&currentForbiddenApps.push(matchingApp)}),currentForbiddenApps},Base.prototype.fixFocus=function(){return!1},Base.prototype.close=function(){return"function"==typeof TDS.logout&&TDS.logout(),!1},Base.prototype.getAppStartTime=function(){return null!=window.sessionStorage.getItem("appStartTime")?Date.parse(window.sessionStorage.getItem("appStartTime")):null},Base.prototype.setAppStartTime=function(timestamp,forceSet){(forceSet||null==this.getAppStartTime())&&window.sessionStorage.setItem("appStartTime",timestamp)},Base.prototype.getRunTime=function(){return null},Base.prototype.enableLockDown=function(lockDown){return!1},Base.prototype.mute=function(){return!1},Base.prototype.unmute=function(){return!1},Base.prototype.isMuted=function(){return!1},Base.prototype.enablePermissiveMode=function(enabled){},Base.prototype.isPermissiveModeEnabled=function(){return!1},Base.prototype.enableChromeMode=function(enabled){},Base.prototype.getVolume=function(){return-1},Base.prototype.setVolume=function(percent){return!1},Base.prototype.HKEY_CURRENT_USER=2147483649,Base.prototype.HKEY_LOCAL_MACHINE=2147483650,Base.prototype.readRegistryValue=function(hkey,key,name){return null},SB.Base=Base}(TDS.SecureBrowser),function(SB){function Firefox(){Firefox.superclass.constructor.call(this),this.runtime=null,this._ignoringBreachEvents=null}function parseRegistryValue(wrk,value){switch(wrk.getValueType(value)){case wrk.TYPE_STRING:return wrk.readStringValue(value);case wrk.TYPE_BINARY:return wrk.readBinaryValue(value);case wrk.TYPE_INT:return wrk.readIntValue(value);case wrk.TYPE_INT64:return wrk.readInt64Value(value)}return null}function readRegistryValue(hkey,key,valueName){var value=null,registry=Components.classes["@mozilla.org/windows-registry-key;1"].createInstance(Components.interfaces.nsIWindowsRegKey);return registry.open(hkey,key,registry.ACCESS_READ),registry.hasValue(valueName)&&(value=parseRegistryValue(registry,valueName)),registry.close(),value}function writeRegistryValuebyType(wrk,valueName,type,value){switch(type){case"string":wrk.writeStringValue(valueName,value);break;case"binary":wrk.writeBinaryValue(valueName,value);break;case"int":wrk.writeIntValue(valueName,value);break;case"int64":wrk.writeInt64Value(valueName,value)}}function writeRegistryValue(hkey,key,valueName,type,value){var registry=Components.classes["@mozilla.org/windows-registry-key;1"].createInstance(Components.interfaces.nsIWindowsRegKey);registry.open(hkey,key,registry.ACCESS_WRITE),writeRegistryValuebyType(registry,valueName,type,value),registry.close()}function removeRegistryValue(hkey,key,valueName){var registry=Components.classes["@mozilla.org/windows-registry-key;1"].createInstance(Components.interfaces.nsIWindowsRegKey);registry.open(hkey,key,registry.ACCESS_ALL),registry.hasValue(valueName)&&registry.removeValue(valueName),registry.close()}YAHOO.lang.extend(Firefox,TDS.SecureBrowser.Base),Firefox.prototype.initialize=function(){try{if(Mozilla.execPrivileged(function(){var sbClass=Components.classes["@mozilla.org/securebrowser;1"];sbClass&&(this.runtime=sbClass.createInstance(Components.interfaces.mozISecureBrowser))}.bind(this))||console.log("SB runtime component failed to load"),!this.runtime)return;this.enableSecurityBreachDetection()}catch(ex){}},Firefox.prototype.dispose=function(){console.log("Disposing SB runtime..."),null!=this.runtime&&(delete this.runtime,this.runtime=null),this.disableSecurityBreachDetection()},Firefox.prototype.disableDevToolWindow=function(){Components.utils.import("resource://gre/modules/Services.jsm"),Services.wm.getMostRecentWindow("navigator:browser").gDevToolsBrowser=null},Firefox.prototype._hasAPI=function(){return"undefined"!=typeof SecureBrowser},Firefox.prototype._hasRuntime=function(){return null!=this.runtime},Firefox.prototype.clearCache=function(){try{if(this._hasAPI())return SecureBrowser.clearCache(),!0}catch(ex){}return!1},Firefox.prototype.clearCookies=function(){try{if(this._hasAPI())return SecureBrowser.clearCookies(),!0}catch(ex){}return!1},Firefox.prototype.emptyClipBoard=function(){try{if(this._hasAPI())return SecureBrowser.emptyClipBoard(),!0}catch(ex){}return!1},Firefox.prototype.getMACAddress=function(){var mac=null;try{this._hasRuntime()&&(mac=this.runtime.getMACAddress()).toUpperCase()}catch(e){}return mac},Firefox.prototype._getIPAddressList=function(bypassCache){if(!this._hasRuntime())return null;YAHOO.util.Lang.isBoolean(bypassCache)||(bypassCache=!1);for(var dnsService=Components.classes["@mozilla.org/network/dns-service;1"].getService(Components.interfaces.nsIDNSService),record=dnsService.resolve(dnsService.myHostName,bypassCache),addressList=[];record.hasMore();){var address=record.getNextAddrAsString();addressList.push(address)}return addressList},Firefox.prototype.getIPAddressList=function(bypassCache){var addressList=null;try{addressList=this._getIPAddressList(bypassCache)}catch(ex){}return addressList},Firefox.prototype.getProcessList=function(allowDups){var processList=[];if(this._hasRuntime())try{if(processList=this.runtime.getRunningProcessList().split(","),"string"==typeof this.runtime.services){var serviceString=this.runtime.services;if(!Util.String.isNullOrEmpty(serviceString)){var serviceList=serviceString.split(",");serviceList=serviceList.map(function(service){return service+"|unavailable"}),processList=processList.concat(serviceList)}}}catch(e){}for(var i=0;i<processList.length;i++)processList[i]=YAHOO.lang.trim(processList[i]).toLowerCase();return processList=!0===allowDups?processList:Util.Array.unique(processList)},Firefox.prototype.getEnvironment=function(name){if(Util.Browser.isWindows()&&null!=name){var environment=Components.classes["@mozilla.org/process/environment;1"].getService(Components.interfaces.nsIEnvironment);if(environment.exists(name))return environment.get(name)}return null},Firefox.prototype.killProcess=function(processName){if(Util.Browser.getSecureVersion()>=8&&this._hasRuntime())try{processName&&this.runtime.killProcess(processName)}catch(e){}},Firefox.prototype.startProcess=function(processName){if(Util.Browser.getSecureVersion()>=8&&this._hasRuntime())try{processName&&this.runtime.startProcess(processName)}catch(e){}},Firefox.prototype.fixFocus=function(){this._ignoringBreachEvents&&clearTimeout(this._ignoringBreachEvents),this._ignoringBreachEvents=setTimeout(function(){this._ignoringBreachEvents=null,Util.log("Resuming breach detection")}.bind(this),1e3),Util.log("Suspending breach detection");try{Mozilla.enableComponents();var hiddenWindowRef=Components.classes["@mozilla.org/appshell/window-mediator;1"].getService(Components.interfaces.nsIWindowMediator).getMostRecentWindow("navigator:browser").openDialog("chrome://bmakiosk/content/hiddenWindow.xul","hidden","alwaysLowered=yes,titlebar=no");return setTimeout(function(){null!=hiddenWindowRef&&hiddenWindowRef.close(),hiddenWindowRef=null},1),Util.log("SecureBrowser: Fixed focus success"),!0}catch(ex){Util.log("SecureBrowser: Fixed focus failed - "+ex)}return!1},Firefox.prototype.close=function(){Util.Browser.isMac()&&Util.Browser.osxVersionIsAtLeast(10,8)&&Util.Browser.getSecureVersion()<=6.2&&(Mozilla.enableScreenshots()?Util.log("Screenshots are enabled."):Util.log("Screenshots are not enabled."));try{if(Util.Browser.isWindows()&&this.restoreKeyboardLayoutSettings(),this.canKillProcess()){var systemRoot=this.getEnvironment("SYSTEMROOT");null!=systemRoot&&this.startProcess(systemRoot+"\\explorer.exe")}$(window).trigger("beforeunload"),setTimeout(function(){SecureBrowser.CloseWindow()},1e3)}catch(ex){}},Firefox.prototype.getAppStartTime=function(){try{var startTimePref=Mozilla.getPreference("bmakiosk.startup.timestamp");if(null!=startTimePref)return Date.parse(startTimePref)}catch(e){}return null!=window.sessionStorage.getItem("appStartTime")?Date.parse(window.sessionStorage.getItem("appStartTime")):null},Firefox.prototype.canKillProcess=function(){return Util.Browser.isWindows()&&Util.Browser.getWindowsNTVersion()>=6.2&&Util.Browser.getSecureVersion()>=8},Firefox.prototype.enableLockDown=function(lockDown){try{lockDown&&(this.disableKeyboardLayoutChanges(),this._hasRuntime()&&this.canKillProcess()&&this.killProcess("explorer.exe"))}catch(ex){console.error(ex)}},Firefox.prototype._hasNativeMute=function(){return Util.Browser.getWindowsNTVersion()>=6&&"boolean"==typeof this.runtime.systemMute},Firefox.prototype._setRuntimeVolume=function(volume){this.runtime.systemVolume=volume,this.Events.onSetVolume.fire()},Firefox.prototype.mute=function(){try{if(this._hasRuntime()){if(this._hasNativeMute())return console.log("mute native"),this.runtime.systemMute=!0,!0;if(null!=this.runtime.systemVolume)return console.log("mute volume"),Util.Storage.set("tds-mutedVolume",this.runtime.systemVolume),this._setRuntimeVolume(0),!0}}catch(ex){console.error(ex)}return!1},Firefox.prototype.unmute=function(){try{if(this._hasRuntime()){if(this._hasNativeMute())return console.log("unmute native"),this.runtime.systemMute=!1,!0;if(0===this.runtime.systemVolume){var mutedVolume=Util.Storage.get("tds-mutedVolume");if(mutedVolume)return console.log("unmute volume: "+mutedVolume),this._setRuntimeVolume(mutedVolume),!0}}}catch(ex){console.error(ex)}return!1},Firefox.prototype.isMuted=function(){try{if(this._hasRuntime())return this._hasNativeMute()?!0===this.runtime.systemMute:0===this.runtime.systemVolume}catch(ex){console.error(ex)}return!1},Firefox.prototype.getVolume=function(checkMute){try{if(this._hasRuntime())return checkMute&&this.isMuted()?0:10*this.runtime.systemVolume}catch(ex){console.error(ex)}return-1},Firefox.prototype.setVolume=function(percent,checkMute){try{if(this._hasRuntime()){var level=Math.round(percent/10);return console.log("set volume: "+level),this._setRuntimeVolume(level),checkMute&&percent>0&&this.isMuted()&&this.unmute(),!0}}catch(ex){console.error(ex)}return!1},Firefox.prototype.enablePermissiveMode=function(enabled){var changed=!1;try{if(this._hasRuntime()&&"boolean"==typeof this.runtime.permissive&&(this.runtime.permissive=enabled,changed=!0,this.canKillProcess()))if(enabled){var systemRoot=this.getEnvironment("SYSTEMROOT");null!=systemRoot&&this.startProcess(systemRoot+"\\explorer.exe")}else this.killProcess("explorer.exe")}catch(ex){}if(changed&&Util.Browser.isMac()){var availWidth=screen.availWidth,availHeight=screen.availHeight;Mozilla.resizeWindowTo(availWidth,availHeight)}return changed},Firefox.prototype.isPermissiveModeEnabled=function(){try{if(this._hasRuntime()&&"boolean"==typeof this.runtime.permissive)return this.runtime.permissive}catch(ex){return!1}return!1},Firefox.prototype.enableChromeMode=function(enabled){try{if("object"==typeof SecureBrowser&&"function"==typeof SecureBrowser.showChrome)return SecureBrowser.showChrome(enabled),!0}catch(ex){}return!1},Firefox.prototype.enableSecurityBreachDetection=function(){var self=this,observer={QueryInterface:function(iid){if(iid.equals(Components.interfaces.nsISupports)||iid.equals(Components.interfaces.nsIObserver))return this;throw Components.results.NS_ERROR_NO_INTERFACE},observe:function(subject,topic,data){if("sb-security-breach"==topic&&!self._ignoringBreachEvents){Util.log("Security breach detected!");var notification={type:"sb-security-breach",message:"Event from SB"};self.Events.onSecurityBreach.fire(notification)}}};try{Mozilla.enableComponents(),Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService).addObserver(observer,"sb-security-breach",!1),Util.log("Listening for sb-security-breach events")}catch(e){Util.log(e.message)}},Firefox.prototype.disableSecurityBreachDetection=function(){try{Mozilla.enableComponents();for(var os=Components.classes["@mozilla.org/observer-service;1"].getService(Components.interfaces.nsIObserverService),observers=os.enumerateObservers("sb-security-breach");observers.hasMoreElements();)os.removeObserver(observers.getNext(),"sb-security-breach");Util.log("Removing all observers for sb-security-breach events")}catch(e){Util.log(e.message)}},Firefox.prototype.disableKeyboardLayoutChanges=function(){if(null==Mozilla.getPreference("windows.previouslanguagehotkeyvalue")){var languageHotKeyValue=this.readRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Language Hotkey");null!=languageHotKeyValue&&"3"==languageHotKeyValue||this.writeRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Language Hotkey","string","3"),null==languageHotKeyValue?Mozilla.setPreference("windows.previouslanguagehotkeyvalue",""):Mozilla.setPreference("windows.previouslanguagehotkeyvalue",languageHotKeyValue)}if(null==Mozilla.getPreference("windows.previouslayouthotkeyvalue")){var layoutHotKeyValue=this.readRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Layout Hotkey");null!=layoutHotKeyValue&&"3"==layoutHotKeyValue||this.writeRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Layout Hotkey","string","3"),null==layoutHotKeyValue?Mozilla.setPreference("windows.previouslayouthotkeyvalue",""):Mozilla.setPreference("windows.previouslayouthotkeyvalue",layoutHotKeyValue)}},Firefox.prototype.restoreKeyboardLayoutSettings=function(){""==Mozilla.getPreference("windows.previouslanguagehotkeyvalue")?this.removeRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Language Hotkey"):"3"!=Mozilla.getPreference("windows.previouslanguagehotkeyvalue")&&this.writeRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Language Hotkey","string",Mozilla.getPreference("windows.previouslanguagehotkeyvalue")),Mozilla.setPreference("windows.previouslanguagehotkeyvalue",null),""==Mozilla.getPreference("windows.previouslayouthotkeyvalue")?this.removeRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Layout Hotkey"):"3"!=Mozilla.getPreference("windows.previouslayouthotkeyvalue")&&this.writeRegistryValue(Util.SecureBrowser.HKEY_CURRENT_USER,"Keyboard Layout\\toggle","Layout Hotkey","string",Mozilla.getPreference("windows.previouslayouthotkeyvalue")),Mozilla.setPreference("windows.previouslayouthotkeyvalue",null)},Firefox.prototype.readRegistryValue=function(hkey,key,valueName){var value=null;return Mozilla.execPrivileged(function(){try{value=readRegistryValue(hkey,key,valueName)}catch(ex){}}),value},Firefox.prototype.writeRegistryValue=function(hkey,key,valueName,type,value){Mozilla.execPrivileged(function(){try{writeRegistryValue(hkey,key,valueName,type,value)}catch(ex){}})},Firefox.prototype.removeRegistryValue=function(hkey,key,valueName){Mozilla.execPrivileged(function(){try{removeRegistryValue(hkey,key,valueName)}catch(ex){}})},SB.Firefox=Firefox}(TDS.SecureBrowser),function(SB){function Certified(){Certified.superclass.constructor.call(this)}YAHOO.lang.extend(Certified,TDS.SecureBrowser.Base),Certified.prototype._hasAPI=function(){return void 0!==window.browser},Certified.prototype.clearCache=function(){try{if(this._hasAPI())return browser.security.clearCache(),!0}catch(ex){}return!1},Certified.prototype.clearCookies=function(){try{if(this._hasAPI())return browser.security.clearCookies(),!0}catch(ex){}return!1},Certified.prototype.emptyClipBoard=function(){try{if(this._hasAPI())return browser.security.emptyClipBoard(),!0}catch(ex){}return!1},Certified.prototype.getMACAddress=function(){var mac=null;try{this._hasAPI()&&(alert("try"),(mac=browser.security.getMACAddress()).toUpperCase())}catch(e){alert("catch")}return mac},Certified.prototype.getIPAddressList=function(){var addressList=[];try{this._hasAPI()&&(addressList=browser.security.getIPAddressList())}catch(ex){}return addressList},Certified.prototype.getProcessList=function(){var processList=[];try{this._hasAPI()&&(processList=browser.security.getProcessList())}catch(ex){}for(var i=0;i<processList.length;i++)processList[i]=YAHOO.lang.trim(processList[i]).toLowerCase();return processList=Util.Array.unique(processList)},Certified.prototype.close=function(restart){try{if(this._hasAPI())return browser.security.closeWindow(restart),!0}catch(ex){}return!1},Certified.prototype.getAppStartTime=function(){try{if(this._hasAPI())return browser.security.getStartTime(),!0}catch(ex){}return!1},Certified.prototype.enableLockDown=function(lockDown){try{if(this._hasAPI())return browser.security.enableLockDown(lockDown),!0}catch(ex){}return!1},Certified.prototype.isEnvironmentSecure=function(){try{if(this._hasAPI())return{secure:browser.security.isEnvironmentSecure(),messageKey:null}}catch(ex){}return!1},Certified.prototype.getDeviceInfo=function(){try{if(this._hasAPI())return browser.security.getDeviceInfo(),!0}catch(ex){}return!1},SB.Certified=Certified}(TDS.SecureBrowser),function(SB){function Chrome(){Chrome.superclass.constructor.call(this)}YAHOO.lang.extend(Chrome,TDS.SecureBrowser.Base),Chrome.prototype.initialize=function(){TDS.AppWindow=window;var bootstrap=function(event){event.data.type&&"CHROME RESPONSE"==event.data.type&&"APP WELCOME"==event.data.command&&(TDS.AppWindow=event.source,window.removeEventListener(bootstrap))};window.addEventListener("message",bootstrap,!0)},Chrome.prototype.enableLockDown=function(lockDown){TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"UI FULLSCREEN",params:{enable:lockDown,interval:500}},"*")},Chrome.prototype.close=function(){return TDS.AppWindow.postMessage({type:"CHROME COMMAND",command:"APP CLOSE",params:{}},"*"),"function"==typeof TDS.logout&&TDS.logout(),!1},SB.Chrome=Chrome}(TDS.SecureBrowser),TDS.SecureBrowser.Mobile=TDS.SecureBrowser.Mobile||{},TDS.SecureBrowser.Mobile.Android=function(){TDS.SecureBrowser.Mobile.Android.superclass.constructor.call(this),this._config={pausedSinceLaunch:!1,keyboardChanged:!1,clipboardChanged:!1},this._airMobile=(new Summit.SecureBrowser.Mobile).getNativeBrowser(),this._airMobile.initialize(),this._textSelected={rangyValue:null}},YAHOO.lang.extend(TDS.SecureBrowser.Mobile.Android,TDS.SecureBrowser.Base),TDS.SecureBrowser.Mobile.Android.prototype.initialize=function(){var sb=this._airMobile,config=this._config,textSelected=this._textSelected;sb.listen(sb.EVENT_DEVICE_READY,window.document,function(){sb.listen(sb.EVENT_RETURN_FROM_BACKGROUND,window.document,function(){config.pausedSinceLaunch=!0}),"com.air.mobilebrowser/.softkeyboard.SoftKeyboard"!=sb.device.keyboard&&(config.keyboardChanged=!0),sb.listen(sb.EVENT_KEYBOARD_CHANGED,window.document,function(){config.keyboardChanged=!0}),sb.listen(sb.EVENT_CLIPBOARD_CHANGED,window.document,function(){config.clipboardChanged=!0}),sb.listen(sb.EVENT_MINI_APP_DETECTED,window.document,function(){config.pausedSinceLaunch=!0})}),sb.listen(sb.EVENT_TEXT_SELECTED,window.document,function(){textSelected.rangyValue=window.rangy.getSelection(document)})},TDS.SecureBrowser.Mobile.Android.prototype.isEnvironmentSecure=function(){return{secure:!this._config.pausedSinceLaunch&&!this._config.keyboardChanged&&!this._config.clipboardChanged,messageKey:null}},TDS.SecureBrowser.Mobile.Android.prototype.getSelectedText=function(){return this._textSelected.rangyValue},TDS.SecureBrowser.Mobile.Android.prototype.getRunTime=function(){return this._airMobile},TDS.SecureBrowser.Mobile=TDS.SecureBrowser.Mobile||{},TDS.SecureBrowser.Mobile.iOS=function(){TDS.SecureBrowser.Mobile.iOS.superclass.constructor.call(this),this._guidedAccessMode=localStorage.getItem("ios-guidedaccessstatus"),null==this._guidedAccessMode&&(this._guidedAccessMode="unknown"),this._processes=[],this._backgroundThreshold=5,this._airMobile=(new Summit.SecureBrowser.Mobile).getNativeBrowser(),this._airMobile.initialize()},YAHOO.lang.extend(TDS.SecureBrowser.Mobile.iOS,TDS.SecureBrowser.Base),TDS.SecureBrowser.Mobile.iOS.prototype.loadProcessList=function(){this.setProcessList()},TDS.SecureBrowser.Mobile.iOS.prototype.getProcessList=function(){return this.setProcessList(),this._processes},TDS.SecureBrowser.Mobile.iOS.prototype.setBackgroundThreshold=function(value){this._backgroundThreshold=value},TDS.SecureBrowser.Mobile.iOS.prototype.initialize=function(){var secBrowser=this._airMobile,guidedAccessMode=this._guidedAccessMode,backgroundThreshold=this._backgroundThreshold,startTimeBackground=null,hasBeenBackgrounded=!1;this.getHasBeenBackgrounded=function(){return hasBeenBackgrounded},this.setProcessList=function(){this._processes=secBrowser.device.runningProcesses};var isLockedDown=!0;this.isSystemLockedDown=function(){return isLockedDown};var isAutonomousGuidedAccessEnabled;this.checkAutonomousGuidedAccess=function(){return void 0===isAutonomousGuidedAccessEnabled&&(isAutonomousGuidedAccessEnabled=Util.Browser.getIOSVersion()>=7.1&&TDS.getAppSetting("sb.iosAutonomousGuidedAccessAllowed",!1)),isAutonomousGuidedAccessEnabled},this.getGuidedAccessMode=function(){return guidedAccessMode},this.setLockDown=function(lockdown){isLockedDown=lockdown,lockdown?isAutonomousGuidedAccessEnabled&&"disabled"==guidedAccessMode&&secBrowser.enableGuidedAccess(lockdown,null,function(enableResults){enableResults.didSucceed&&(guidedAccessMode="enabled",localStorage.setItem("ios-guidedaccessstatus","enabled"))}):(hasBeenBackgrounded=!1,this.checkAutonomousGuidedAccess()&&"enabled"==guidedAccessMode&&secBrowser.enableGuidedAccess(lockdown,null,function(enableResults){enableResults.didSucceed&&(guidedAccessMode="disabled",localStorage.setItem("ios-guidedaccessstatus","disabled"))}))},secBrowser.checkGuidedAccessStatus(null,function(results){guidedAccessMode=results.enabled?"enabled":"disabled",localStorage.setItem("ios-guidedaccessstatus",guidedAccessMode),Util.log("access mode recorded is .. "+guidedAccessMode)}),secBrowser.listen(secBrowser.EVENT_GUIDED_ACCESS_CHANGED,document,function(){guidedAccessMode=secBrowser.device.guidedAccessEnabled?"enabled":"disabled",localStorage.setItem("ios-guidedaccessstatus",guidedAccessMode),Util.log("access mode now is changed to ... "+guidedAccessMode)}),secBrowser.listen(secBrowser.EVENT_ENTER_BACKGROUND,document,function(){isLockedDown&&(startTimeBackground=(new Date).getTime()),Util.log("the browser has been pushed to the background")}),secBrowser.listen(secBrowser.EVENT_RETURN_FROM_BACKGROUND,document,function(){isLockedDown&&null!=startTimeBackground&&((new Date).getTime()-startTimeBackground>1e3*backgroundThreshold&&(hasBeenBackgrounded=!0),startTimeBackground=null),Util.log("the browser has been put to the background")})},TDS.SecureBrowser.Mobile.iOS.prototype.enableLockDown=function(lockDown){this.setLockDown(lockDown)},TDS.SecureBrowser.Mobile.iOS.prototype.canEnvironmentBeSecured=function(){var result={canSecure:!0,messageKey:null};if("enabled"==this.getGuidedAccessMode()){result.messageKey="LoginShell.Alert.EnvironmentSecureiOSVolumeControl";TDS.Dialog.showWarning(result.messageKey,"Warning: You cannot adjust the volume of your iPad during the test. If you need to adjust the volume, please turn off Guided Access. Adjust the volume using the volume control buttons on the iPad, and then activate Guided Access.  If you need help, please ask your proctor.")}else this.checkAutonomousGuidedAccess()||(result.canSecure=!1,result.messageKey="LoginShell.Alert.EnvironmentInsecureiOSVolumeControl");return result},TDS.SecureBrowser.Mobile.iOS.prototype.isEnvironmentSecure=function(){return{secure:"enabled"==this.getGuidedAccessMode()&&!this.getHasBeenBackgrounded(),messageKey:null}},TDS.SecureBrowser.Mobile.iOS.prototype.getRunTime=function(){return this._airMobile},function(SB){var Event={DEVICE_INITIALIZING:"INITIALIZING",DEVICE_READY:"READY",DEVICE_ERROR:"ERROR",CAPTURE_START:"START",CAPTURE_INPROGRESS:"INPROGRESS",CAPTURE_END:"END",PLAYBACK_START:"PLAYBACK_START",PLAYBACK_END:"PLAYBACK_END",PLAYBACK_PAUSED:"PLAYBACK_PAUSED",PLAYBACK_RESUMED:"PLAYBACK_RESUMED",PLAYBACK_STOPPED:"PLAYBACK_STOPPED",PLAYBACK_ERROR:"PLAYBACK_ERROR",STATUS_IDLE:"IDLE",STATUS_ACTIVE:"ACTIVE",STATUS_INITIALIZING:"INITIALIZING",STATUS_ERROR:"ERROR",STATUS_STOPPING:"STOPPING"},Recorder=function(){};Recorder.Event=Event,Recorder.prototype.initialize=function(eventListener){},Recorder.prototype.getStatus=function(){return"UNKNOWN"},Recorder.prototype.getCapabilities=function(){return null},Recorder.prototype.getDefaultOptions=function(){return{}},Recorder.prototype.startCapture=function(options,eventListener){},Recorder.prototype.stopCapture=function(){},Recorder.prototype.play=function(audioData,eventListener){},Recorder.prototype.stopPlay=function(){},Recorder.prototype.pausePlay=function(){},Recorder.prototype.resumePlay=function(){},Recorder.prototype.loadAudioFile=function(fileIdentifier,callback){},Recorder.prototype.retrieveAudioFileList=function(fileIdentifier,callback){},Recorder.prototype.retrieveAudioFile=function(fileIdentifier,callback){},Recorder.prototype.clearAudioFileCache=function(callback){},Recorder.prototype.getLogs=function(){return[]},SB.Base.Recorder=Recorder}(TDS.SecureBrowser),function(SB){function addLog(msg){var log={timestamp:new Date,message:msg};logs.push(log)}function isPPC(){return Util.Browser.getSecureVersion()>=5.6&&Util.Browser.getSecureVersion()<=5.9}function getEventType(type){switch(type){case"AUDIOERROR":return Event.DEVICE_ERROR;case"PLAYSTART":return Event.PLAYBACK_START;case"PLAYSTOP":return Event.PLAYBACK_STOPPED;case"PLAYPAUSED":return Event.PLAYBACK_PAUSED;case"PLAYRESUMED":return Event.PLAYBACK_RESUMED;default:return type}}function getAudioFileList(){var listValue=Util.Storage.get("recorder-list");return listValue||[]}function getAudioFile(filename){return Util.Storage.get("recorder-data-"+filename)}function setAudioFile(fileIdentifier,obj){var list=getAudioFileList();list.push(fileIdentifier),Util.Storage.set("recorder-list",list),Util.String.contains(obj.data,'"filename"')||(obj.data=obj.data.replace('"qualityIndicator"','"filename" : "'+fileIdentifier+'",\n"qualityIndicator"')),obj.data=obj.data.replace(/\n/g,""),Util.Storage.setString("recorder-data-"+fileIdentifier,obj.data)}function startRecordTimer(duration){recordTimer=YAHOO.lang.later(1e3*duration,this,checkRecordTimer)}function stopRecordTimer(){recordTimer&&(recordTimer.cancel(),recordTimer=null)}function checkRecordTimer(){recordTimer=null,"ACTIVE"==api.getStatus()&&api.stopCapture()}function processEvent(evt){if("AUDIOERROR"==evt.type){var status=api.getStatus();if(addLog("Error: '"+evt.detail+"' ("+status+")"),"ERRORSTAT"!=status)return void console.warn("SB Recorder Warn: '"+evt.detail+"'");console.error("SB Recorder Error: '"+evt.detail+"'")}else"INPROGRESS"!=evt.type&&(console.log("SB Recorder Event: '"+evt.type+"'"),addLog("Event: '"+evt.type+"'"));var obj={type:getEventType(evt.type),data:evt.detail||null};"function"==typeof currentListener&&function(eventListener){setTimeout(function(){eventListener(obj)},0)}(currentListener),"END"==obj.type&&(stopRecordTimer(),setAudioFile(currentFile,obj))}function addListeners(doc){if(isPPC())for(i=0;i<eventNames.length;i++)observerService.addObserver(AudioRecorderObserver,eventNames[i],!1);else for(var i=0;i<eventNames.length;i++)YUE.addListener(doc,eventNames[i],processEvent,this,!0)}function removeListeners(doc){if(isPPC())for(i=0;i<eventNames.length;i++)observerService.removeObserver(AudioRecorderObserver,eventNames[i]);else for(var i=0;i<eventNames.length;i++)YUE.removeListener(doc,eventNames[i],processEvent,this,!0)}function createAPI(){addLog("API: Creating");var embed=Util.Frame.injectEmbed("recorderFrame","application/airaudio");if(isPPC()){var embedDoc=Util.Dom.getOwnerDocument(embed),embedWin=Util.Dom.getWindow(embedDoc),embedComponents=embedWin.Components;observerService=embedComponents.classes["@mozilla.org/observer-service;1"].getService(embedComponents.interfaces.nsIObserverService),embedWin.AudioRecorderObserverService=observerService}return addListeners(Util.Dom.getOwnerDocument(embed)),addLog("API: Created"),embed}function removeAPI(){addLog("API: Removing");try{api.clean()}catch(ex){console.error(ex)}var apiDoc=Util.Dom.getOwnerDocument(api),apiWin=Util.Dom.getWindow(apiDoc);removeListeners(apiDoc),Util.Dom.removeNode(api),apiWin.frameElement&&Util.Dom.removeNode(apiWin.frameElement),api=null,addLog("API: Removed")}function Recorder(){Recorder.superclass.constructor.call(this)}var logs=[],Event=SB.Base.Recorder.Event,api=null,currentListener=null,currentFile=null,observerService=null,recordTimer=null,eventNames=["INITIALIZING","READY","AUDIOERROR","START","INPROGRESS","END","PLAYSTART","PLAYSTOP","PLAYPAUSED","PLAYRESUMED"],AudioRecorderObserver={observe:function(subject,topic,data){var obj={type:topic};"END"==topic&&(obj={type:topic,data:"",detail:data}),processEvent(obj)}};YAHOO.lang.extend(Recorder,TDS.SecureBrowser.Base.Recorder),Recorder.prototype.getNative=function(){return api},Recorder.prototype.dispose=function(){removeAPI()},Recorder.prototype.getLogs=function(){return logs},Recorder.prototype.initialize=function(eventListener){var delay=0;if(api){delay=500;try{var status=api.getStatus();"ACTIVE"==status?api.stopCapture():"PLAYING"==status&&api.stopPlay()}catch(ex){console.error(ex)}}currentListener=eventListener,setTimeout(function(){api&&removeAPI(),setTimeout(function(){addLog("API: Initialize"),(api=createAPI())&&api.initialize?api.initialize():console.error("Could not call initialize on the recorder API.")},delay)},delay)},Recorder.prototype.getCapabilities=function(){var str=api.getCapabilities();return str&&str.length>0?(addLog("API: Capabilities: "+str),JSON.parse(str)):null},Recorder.prototype.getStatus=function(){return api.getStatus()},Recorder.prototype.startCapture=function(options,eventListener){currentListener=eventListener,currentFile=options.filename?options.filename:Util.String.getUUID()+"."+options.encodingFormat.toLowerCase(),options.captureLimit&&(options.captureLimit.size?(options.captureLimit.type="size",options.captureLimit.limit=options.captureLimit.size):options.captureLimit.duration&&(options.captureLimit.type="time",options.captureLimit.limit=99999));var optionsStr=JSON.stringify(options);addLog("Action: Start Capture '"+currentFile+"' ("+optionsStr+")"),api.startCapture(optionsStr,eventListener),options.captureLimit&&options.captureLimit.duration>0&&startRecordTimer(options.captureLimit.duration)},Recorder.prototype.stopCapture=function(){addLog("Action: Stop Capture"),api.stopCapture()},Recorder.prototype.play=function(audioData,eventListener){if(currentListener=eventListener,"filename"==audioData.type){var audioFile=getAudioFile(audioData.filename);if(null==audioFile)throw new Error("Could not find audio file: "+audioData.filename);audioData.data=audioFile.base64}addLog("Action: Play '"+audioData.filename+"'"),api.play(JSON.stringify(audioData))},Recorder.prototype.stopPlay=function(){addLog("Action: Stop Play"),api.stopPlay()},Recorder.prototype.pausePlay=function(){addLog("Action: Pause Play"),api.pausePlay()},Recorder.prototype.resumePlay=function(){addLog("Action: Resume Play"),api.resumePlay()},Recorder.prototype.loadAudioFile=function(fileIdentifier,base64,eventListener){setAudioFile(fileIdentifier,{data:'{ "base64": "'+base64+'" }'}),eventListener&&setTimeout(function(){eventListener()},0)},Recorder.prototype.retrieveAudioFileList=function(eventListener){var list=getAudioFileList();return eventListener?(setTimeout(function(){eventListener(list)},0),!0):list},Recorder.prototype.retrieveAudioFile=function(fileIdentifier,eventListener){var data=getAudioFile(fileIdentifier);return eventListener?(setTimeout(function(){eventListener(data)},0),!0):data},Recorder.prototype.clearAudioFileCache=function(eventListener){for(var list=getAudioFileList(),i=0;i<list.length;i++)Util.Storage.remove("recorder-data-"+list[i]);Util.Storage.remove("recorder-list"),eventListener&&setTimeout(function(){eventListener()},0)},SB.Firefox.Recorder=Recorder,YUE.on(window,"beforeunload",function(){if(api&&"function"==typeof api.clean){if(Util.Browser.isMacPPC()&&"ACTIVE"==api.getStatus()){api.stopCapture();var lastFileId=getAudioFileList().pop();if(lastFileId){var audioData={type:"filename",filename:lastFileId};Recorder.prototype.play(audioData),Recorder.prototype.stopPlay()}}api.clean()}})}(TDS.SecureBrowser),function(SB){function Recorder(){Recorder.superclass.constructor.call(this);var SBEvent=TDS.SecureBrowser.Base.Recorder.Event;SBEvent.DEVICE_READY="IDLE",SBEvent.CAPTURE_START=SBEvent.CAPTURE_INPROGRESS,SBEvent.CAPTURE_END="IDLE",SBEvent.PLAYBACK_STOPPED="IDLE"}YAHOO.lang.extend(Recorder,TDS.SecureBrowser.Base.Recorder),Recorder.prototype.initialize=function(eventListener){browser.recorder.initialize(function(event){eventListener({type:event})})},Recorder.prototype.getCapabilities=function(){var str=window.browser.recorder.getCapabilities();return str&&str.length>0?JSON.parse(JSON.stringify(eval("("+str+")"))):null},Recorder.prototype.getDefaultOptions=function(){var devices=this.getCapabilities().supportedInputDevices;if(null==devices||0==devices.length)throw new Error("There are no supported input devices.");var device=devices[0],channelCount=device.channelCounts,sampleRate=device.sampleRates[0],sampleSize=device.sampleSizes[0],encodingFormat=device.formats[0];return{captureDevice:device.id,sampleRate:sampleRate,channelCount:channelCount,sampleSize:sampleSize,encodingFormat:encodingFormat,qualityIndicator:!1,progressFrequency:{size:30,time:2},captureLimit:{duration:30,size:50}}},Recorder.prototype.getStatus=function(){return window.browser.recorder.getStatus()},Recorder.prototype.startCapture=function(options,eventListener){options=YAHOO.lang.augmentObject(this.getDefaultOptions(),options||{}),window.browser.recorder.startCapture(options,function(event){eventListener({type:event})})},Recorder.prototype.stopCapture=function(){window.browser.recorder.stopCapture()},Recorder.prototype.play=function(audioData,eventListener){var b64audio=browser.recorder.retrieveAudio();browser.recorder.playback(b64audio,function(event){eventListener({type:event})})},Recorder.prototype.stopPlay=function(){window.browser.recorder.stopPlayback()},Recorder.prototype.pausePlay=function(){window.browser.recorder.pausePlayback()},Recorder.prototype.resumePlay=function(){window.browser.recorder.resumePlayback()},Recorder.prototype.retrieveAudioFileList=function(callback){if(!callback)throw new Error("This recorder does not support sync api call.");window.browser.recorder.retrieveAudioFileList(function(event){callback(event.files)})},Recorder.prototype.retrieveAudioFile=function(fileIdentifier,callback){if(!callback)throw new Error("This recorder does not supportsync api call.");window.browser.recorder.retrieveAudio(function(event){callback(event.audioInfo)})},SB.Certified.Recorder=Recorder}(TDS.SecureBrowser),function(SB){function Recorder(){Recorder.superclass.constructor.call(this)}YAHOO.lang.extend(Recorder,TDS.SecureBrowser.Base.Recorder),Recorder.prototype.initialize=function(eventListener){AIRMobile.recorder.initialize(eventListener)},Recorder.prototype.getCapabilities=function(){return AIRMobile.recorder.getCapabilities(event)},Recorder.prototype.getDefaultOptions=function(){return{}},Recorder.prototype.getStatus=function(){return AIRMobile.recorder.getStatus()},Recorder.prototype.startCapture=function(options,eventListener){options=YAHOO.lang.augmentObject(this.getDefaultOptions(),options||{}),AIRMobile.recorder.startCapture(options,eventListener)},Recorder.prototype.stopCapture=function(){AIRMobile.recorder.stopCapture()},Recorder.prototype.play=function(audioData,eventListener){AIRMobile.recorder.play(audioData,eventListener)},Recorder.prototype.stopPlay=function(){AIRMobile.recorder.stopPlay()},Recorder.prototype.pausePlay=function(){AIRMobile.recorder.pausePlay()},Recorder.prototype.resumePlay=function(){AIRMobile.recorder.resumePlay()},Recorder.prototype.retrieveAudioFileList=function(callback){if(!callback)throw new Error("This recorder does not support sync api call.");AIRMobile.recorder.retrieveAudioFileList(function(event){callback(event.files)})},Recorder.prototype.retrieveAudioFile=function(fileIdentifier,callback){if(!callback)throw new Error("This recorder does not support sync api call.");AIRMobile.recorder.retrieveAudioFile(function(event){callback(event.audioInfo)})},Recorder.prototype.clearAudioFileCache=function(callback){AIRMobile.recorder.clearAudioFileCache(callback)},SB.Mobile.Recorder=Recorder}(TDS.SecureBrowser),TDS.SecureBrowser.Validators=function(){function run(){var exemptions=[],validatorExemptionsAppSetting=TDS.getAppSetting("sb.validatorExemptions");validatorExemptionsAppSetting&&""!=validatorExemptionsAppSetting&&(exemptions=validatorExemptionsAppSetting.split(","));var validators=list.filter(function(validator){return!Util.Array.contains(exemptions,validator.name)&&validator.isSupported()});return Util.Array.partition(validators,function(validator){return validator.validate()})}var list=[];return{register:function(validator){list.push(validator)},getValidators:function(){return list},validate:function(){return run().rejects.map(function(validator){return validator.message})}}}(),TDS.SecureBrowser.Validators.register({name:"vmware",isSupported:function(){return Util.Browser.isSecure()&&Util.Browser.isWindows()},validate:function(){var SB=Util.SecureBrowser,systemManufacturer=SB.readRegistryValue(SB.HKEY_LOCAL_MACHINE,"HARDWARE\\DESCRIPTION\\System\\BIOS","SystemManufacturer");return!systemManufacturer||-1==systemManufacturer.indexOf("VMware")||"Teradici_POiCP"==SB.readRegistryValue(SB.HKEY_CURRENT_USER,"Volatile Environment","ViewClient_Type")},message:"Browser.Denied.VMwareUncertified"}),TDS.SecureBrowser.Validators.register({name:"expose",isSupported:function(){return Util.Browser.isSecure()&&Util.Browser.isMac()&&Util.Browser.osxVersionIsAtMost(10,6)},validate:function(){return!0!==Mozilla.getPreference("bmakiosk.expose.enabled")},message:"Browser.Denied.ExposeEnabled"}),TDS.SecureBrowser.Validators.register({name:"spaces",isSupported:function(){return Util.Browser.isSecure()&&Util.Browser.isMac()},validate:function(){return!0!==Mozilla.getPreference("bmakiosk.spaces.enabled")},message:"Browser.Denied.SpacesEnabled"}),TDS.SecureBrowser.initialize(),Util.SecureBrowser=TDS.SecureBrowser.getImplementation(),function(SB,Mozilla){Util.SecureBrowser.fixUserAgent=function(){var ua=navigator.userAgent;if(-1!=ua.indexOf("AIRSecureBrowser/5.5")&&-1==ua.indexOf("Firefox/3.6.28"))Mozilla.setPreference("general.useragent.extra.kiosk","5.5 Firefox/3.6.28");else if(-1!=ua.indexOf("AIRSecureBrowser/5.6")&&-1==ua.indexOf("Firefox/3.6.28"))Mozilla.setPreference("general.useragent.extra.kiosk","5.6 Firefox/3.6.28");else if(-1!=ua.indexOf("AIRSecureBrowser/8.0")&&-1!=ua.indexOf("Windows NT 6.3")){var windowsNTMajorVersionRegistryKeyValue=Util.SecureBrowser.readRegistryValue(Util.SecureBrowser.HKEY_LOCAL_MACHINE,"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion","CurrentMajorVersionNumber"),windowsNTMinorVersionRegistryKeyValue=Util.SecureBrowser.readRegistryValue(Util.SecureBrowser.HKEY_LOCAL_MACHINE,"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion","CurrentMinorVersionNumber");null!=windowsNTMajorVersionRegistryKeyValue&&null!=windowsNTMinorVersionRegistryKeyValue&&10==parseFloat(windowsNTMajorVersionRegistryKeyValue)+parseFloat(windowsNTMinorVersionRegistryKeyValue)/10&&(ua=ua.replace(new RegExp("Windows NT 6.3","g"),"Windows NT 10.0"),Mozilla.setPreference("general.useragent.override",ua))}}}(0,Mozilla);var ResourceLoader=function(){this._status=ResourceLoader.Status.NEW,this._events=new YAHOO.util.EventProvider;for(var key in ResourceLoader.Status)this._events.createEvent(ResourceLoader.Status[key],{scope:this})};ResourceLoader.Status={NEW:"NEW",LOADING:"LOADING",COMPLETE:"COMPLETE",ERROR:"ERROR",ABORT:"ABORT"},ResourceLoader.extend=function(subclass){YAHOO.lang.extend(subclass,ResourceLoader)},ResourceLoader.prototype.getStatus=function(){return this._status},ResourceLoader.prototype.setStatus=function(status){this._status=status,this._events.fireEvent(status)},ResourceLoader.prototype.setStatusAsync=function(status){YAHOO.lang.later(0,this,this.setStatus,status)},ResourceLoader.prototype.subscribe=function(status,callback,overrideContext){this._events.subscribe(status,callback,null,overrideContext||this)},ResourceLoader.prototype.load=function(){},ResourceLoader.prototype.abort=function(){},ResourceLoader.Collection=function(){ResourceLoader.Collection.superclass.constructor.call(this),this._loaders=[]},ResourceLoader.extend(ResourceLoader.Collection),ResourceLoader.Collection.prototype.hasLoaders=function(){return this._loaders.length>0},ResourceLoader.Collection.prototype.getLoaders=function(){return this._loaders},ResourceLoader.Collection.prototype.add=function(loader){if(!(loader instanceof ResourceLoader))throw new Error("You can only add a loader instance to a loader collection.");this._loaders.push(loader)},ResourceLoader.Collection.prototype.load=function(){this.setStatus(ResourceLoader.Status.LOADING);for(var i=0;i<this._loaders.length;i++){var loader=this._loaders[i];loader.subscribe(ResourceLoader.Status.COMPLETE,this._checkFinished,this),loader.subscribe(ResourceLoader.Status.ERROR,this._checkFinished,this),loader.subscribe(ResourceLoader.Status.ABORT,this._checkFinished,this),loader.load()}this._checkFinished()},ResourceLoader.Collection.prototype._checkFinished=function(){for(var completed=0,i=0;i<this._loaders.length;i++){var status=this._loaders[i].getStatus();if(status==ResourceLoader.Status.NEW||status==ResourceLoader.Status.LOADING)return;status==ResourceLoader.Status.COMPLETE&&completed++}this._loaders.length==completed?this.setStatusAsync(ResourceLoader.Status.COMPLETE):this.setStatusAsync(ResourceLoader.Status.ERROR)},ResourceLoader.Dependency=function(parentLoader,childLoader){ResourceLoader.Dependency.superclass.constructor.call(this),this._parentLoader=parentLoader,this._childLoader=childLoader},ResourceLoader.extend(ResourceLoader.Dependency),ResourceLoader.Dependency.prototype.load=function(){this.setStatus(ResourceLoader.Status.LOADING);var eventMapper=function(fromLoader,toLoader,status){fromLoader.subscribe(status,function(){toLoader.setStatus(status)},toLoader)};eventMapper(this._parentLoader,this,ResourceLoader.Status.ERROR),eventMapper(this._parentLoader,this,ResourceLoader.Status.ABORT),this._parentLoader.subscribe(ResourceLoader.Status.COMPLETE,function(){this._childLoader.load()},this),eventMapper(this._childLoader,this,ResourceLoader.Status.ERROR),eventMapper(this._childLoader,this,ResourceLoader.Status.ABORT),eventMapper(this._childLoader,this,ResourceLoader.Status.COMPLETE),this._parentLoader.load()},ResourceLoader.Conditional=function(listener,interval,timeout){ResourceLoader.Conditional.superclass.constructor.call(this),this._conditionalDelay=new Util.ConditionalDelay(listener,this),this._interval=interval,this._timeout=timeout},ResourceLoader.extend(ResourceLoader.Conditional),ResourceLoader.Conditional.prototype.load=function(){this.setStatus(ResourceLoader.Status.LOADING),this._conditionalDelay.onSuccess.subscribe(function(){this.setStatus(ResourceLoader.Status.COMPLETE)}),this._conditionalDelay.onFailure.subscribe(function(){this.setStatus(ResourceLoader.Status.ERROR)}),this._conditionalDelay.start(this._interval,this._timeout)},ResourceLoader.Image=function(src,timeoutInterval,retriesMax){ResourceLoader.Image.superclass.constructor.call(this),YAHOO.lang.isString(src)?(this._img=new Image,this._src=src):(this._img=src,this._src=this._img.src),this._timeoutInterval=timeoutInterval||0,this._timeoutObj=null,this._retriesMax=retriesMax||0,this._retries=0},ResourceLoader.extend(ResourceLoader.Image),ResourceLoader.Image.prototype.getElement=function(){return this._img},ResourceLoader.Image.prototype.load=function(){return""==this._img.id&&(this._img.id=YAHOO.util.Dom.generateId()),this._attachEvents(),""==this._img.src&&(this._img.src=this._src),this.setStatus(ResourceLoader.Status.LOADING),this._startTimer(),!0},ResourceLoader.Image.prototype._onEvent=function(evt){setTimeout(this._processEvent.bind(this,evt),0)},ResourceLoader.Image.prototype._processEvent=function(evt){this._stopTimer();var eventType=evt.type;if("readystatechange"==eventType){if("complete"!=this._img.readyState)return;eventType="load"}void 0===this._img.naturalWidth&&("load"==eventType?(this._img.naturalWidth=this._img.width,this._img.naturalHeight=this._img.height):(this._img.naturalWidth=0,this._img.naturalHeight=0)),this._removeEvents(),"load"==eventType?this.setStatus(ResourceLoader.Status.COMPLETE):this.setStatus(ResourceLoader.Status.ERROR)},ResourceLoader.Image.prototype._attachEvents=function(){var loadEvent=YAHOO.env.ua.ie&&YAHOO.env.ua.ie<11?"readystatechange":"load";YUE.addListener(this._img,loadEvent,this._onEvent,this,!0),YUE.addListener(this._img,"abort",this._onEvent,this,!0),YUE.addListener(this._img,"error",this._onEvent,this,!0)},ResourceLoader.Image.prototype._removeEvents=function(){var loadEvent=YAHOO.env.ua.ie&&YAHOO.env.ua.ie<11?"readystatechange":"load";YUE.removeListener(this._img,loadEvent,this._onEvent),YUE.removeListener(this._img,"abort",this._onEvent),YUE.removeListener(this._img,"error",this._onEvent)},ResourceLoader.Image.prototype._startTimer=function(){this._stopTimer(),this._timeoutInterval>0&&(this._timeoutObj=YAHOO.lang.later(this._timeoutInterval,this,this._onTimeout))},ResourceLoader.Image.prototype._stopTimer=function(){null!=this._timeoutObj&&(this._timeoutObj.cancel(),this._timeoutObj=null)},ResourceLoader.Image.prototype._onTimeout=function(){this.getStatus()==ResourceLoader.Status.LOADING&&(this._retries<this._retriesMax?this._retry():(this._removeEvents(),this.setStatus(ResourceLoader.Status.ABORT)))},ResourceLoader.Image.prototype._retry=function(){this._retries++,this._img.src=this._src,this._startTimer()},ResourceLoader.ImageCollection=function(){ResourceLoader.ImageCollection.superclass.constructor.call(this)},YAHOO.lang.extend(ResourceLoader.ImageCollection,ResourceLoader.Collection),ResourceLoader.ImageCollection.prototype.addImage=function(url){this.add(new ResourceLoader.Image(url))},ResourceLoader.ImageCollection.prototype.getImage=function(url){for(var imageLoaders=this.getLoaders(),i=0;i<imageLoaders.length;i++){var image=imageLoaders[i].getElement();if(image.src==url)return image}return null},ResourceLoader.ImageCollection.prototype.getErrors=function(){for(var imageErrors=[],imageLoaders=this.getLoaders(),i=0;i<imageLoaders.length;i++){var imageLoader=imageLoaders[i];imageLoader.getStatus()!=ResourceLoader.Status.COMPLETE&&imageErrors.push(imageLoader.getElement())}return imageErrors},ResourceLoader.ImageCollection.prototype.load=function(callbackSuccess,callbackFailure){YAHOO.lang.isFunction(callbackSuccess)&&this.subscribe(ResourceLoader.Status.COMPLETE,callbackSuccess,this),YAHOO.lang.isFunction(callbackFailure)&&(this.subscribe(ResourceLoader.Status.ERROR,callbackFailure,this),this.subscribe(ResourceLoader.Status.ABORT,callbackFailure,this)),ResourceLoader.ImageCollection.superclass.load.call(this)},ResourceLoader.Binary=function(url,timeoutInterval,retriesMax){ResourceLoader.Binary.superclass.constructor.call(this),this._url=url,this._active=!1,this._inSend=!1,this._inOpen=!1,this._inAbort=!1,this._timeoutInterval=timeoutInterval||0,this._timeoutObj=null,this._retriesMax=retriesMax||0,this._retries=0,this._xhr=null,this._response=null},ResourceLoader.extend(ResourceLoader.Binary),ResourceLoader.Binary.prototype.getResponse=function(){return this._response},ResourceLoader.Binary.prototype.load=function(){return this._send(),this.setStatus(ResourceLoader.Status.LOADING),!0},ResourceLoader.Binary.prototype._ieProgId=null,ResourceLoader.Binary.prototype._getProgId=function(){if(!this._ieProgId&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var ACTIVE_X_IDENTS=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<ACTIVE_X_IDENTS.length;i++){var candidate=ACTIVE_X_IDENTS[i];try{return new ActiveXObject(candidate),this._ieProgId=candidate,candidate}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return this._ieProgId},ResourceLoader.Binary.prototype._createInstance=function(){var progId=this._getProgId();return progId?new ActiveXObject(progId):new XMLHttpRequest},ResourceLoader.Binary.prototype._send=function(){if(this._xhr)throw Error("Xhr Object is active with another request");this._active=!0,this._xhr=this._createInstance(),this._xhr.onreadystatechange=Util.bind(this._onReadyStateChange,this),this._inOpen=!0,this._xhr.open("GET",this._url,!0),this._inOpen=!1,this._xhr.setRequestHeader("X-TDS-Loader","binary"),this._timeoutObj&&this._timeoutObj.cancel(),this._timeoutInterval>0&&(this._timeoutObj=YAHOO.lang.later(this._timeoutInterval,this,this._timeout)),this._inSend=!0,this._xhr.send(null),this._inSend=!1},ResourceLoader.Binary.prototype._timeout=function(){if(this._xhr){var allowRetry=this._retries<this._retriesMax;this._abort(allowRetry),allowRetry&&(this._retries++,this._send())}},ResourceLoader.Binary.prototype._abort=function(preventEvent){this._xhr&&this._active&&(this._active=!1,this._inAbort=!0,this._xhr.abort(),this._inAbort=!1,preventEvent||this.setStatus(ResourceLoader.Status.ABORT),this._cleanUpXhr())},ResourceLoader.Binary.prototype._onReadyStateChange=function(){if(this._active&&4==this._xhr.readyState)if(this._inSend)YAHOO.lang.later(0,this._onReadyStateChange,this);else{this._active=!1;var httpStatus=this._xhr.status,httpHeaders=this._xhr.getAllResponseHeaders();if((httpStatus>=200&&httpStatus<300||1223===httpStatus)&&""!=httpHeaders){var response={};this._response=response,response.status=httpStatus,response.contentLength=this._xhr.getResponseHeader("Content-Length"),response.contentType=this._xhr.getResponseHeader("Content-Type"),response.content="unknown"==typeof this._xhr.responseBody?this._xhr.responseBody:this._xhr.responseText,this.setStatus(ResourceLoader.Status.COMPLETE)}else this.setStatus(ResourceLoader.Status.ERROR);this._cleanUpXhr()}},ResourceLoader.Binary.prototype._cleanUpXhr=function(){if(this._xhr){var xhr=this._xhr;this._xhr=null,this._timeoutObj&&(this._timeoutObj.cancel(),this._timeoutObj=null);try{xhr.onreadystatechange=function(){}}catch(e){}}},ResourceLoader.Script=function(url,win,timeout){ResourceLoader.Script.superclass.constructor.call(this),this._url=url,this._win=win,this._timeout=timeout||0,this._id=null},ResourceLoader.extend(ResourceLoader.Script),ResourceLoader.Script.prototype.load=function(){this.setStatus(ResourceLoader.Status.LOADING);var config={onSuccess:function(){this.setStatus(ResourceLoader.Status.COMPLETE)},onFailure:function(){this.setStatus(ResourceLoader.Status.ERROR)},onTimeout:function(){this.setStatus(ResourceLoader.Status.ABORT)},scope:this};null!=this._win&&(config.win=this._win),this._timeout>0&&(config.timeout=this._timeout),this._id=YAHOO.util.Get.script(this._url,config)},ResourceLoader.Script.prototype.abort=function(){YAHOO.util.Get.abort(this._id)},ResourceLoader.Xhr=function(url,opt_method,opt_content,opt_timeout,opt_maxRetries){ResourceLoader.Xhr.superclass.constructor.call(this),this._manager=new Util.XhrManager(0,0,!0),this._request=this._manager.createRequest(url,url,opt_method,opt_content,this._onCompleted,this,opt_timeout,opt_maxRetries)},ResourceLoader.extend(ResourceLoader.Xhr),ResourceLoader.Xhr.prototype.load=function(){this.setStatus(ResourceLoader.Status.LOADING),this._manager.sendRequest(this._request)},ResourceLoader.Xhr.prototype._onCompleted=function(){this._request.isSuccess()?this.setStatus(ResourceLoader.Status.COMPLETE):this.setStatus(ResourceLoader.Status.ERROR)},function(RL){function RLP(promise){this.promise=promise,RLP.superclass.constructor.call(this)}var Status=RL.Status;RL.extend(RLP),RLP.prototype.load=function(){return this.getStatus()==Status.NEW&&(this.setStatus(Status.LOADING),this.promise.done(function(){this.setStatus(Status.COMPLETE)}.bind(this),function(error){this.setStatus(Status.ERROR)}.bind(this)),!0)},RL.Promise=RLP}(window.ResourceLoader),function(){function getDisplayMessage(translation){if(null==translation)return"";var clientMessage=translation.getClientMessage();return YAHOO.lang.isString(clientMessage)?clientMessage:translation.getParentMessage().getDefaultMessage()}function format(text,params){if(null==params)return text;for(var i=0,l=params.length;i<l;++i){var reg=new RegExp("\\{"+i+"\\}","g");text=text.replace(reg,params[i])}return text}function get(defaultMessage,params){var translation=null;if(null!=TDS.messages&&(translation=TDS.messages.findTranslation(defaultMessage)),null==translation)return defaultMessage;var text=getDisplayMessage(translation);return params&&(text=format(text,params)),text}function getAlt(key,alt){var message=get(key);return message==key&&YAHOO.lang.isString(alt)?alt:message}var regex=/\#(\S+)\#/g;window.Messages={set:function(key,text,language){language=language||"ENU";var messageContext=TDS.messages.getContext("");messageContext||(messageContext=TDS.messages.addContext(""));var message=messageContext.getMessage(key);message||(message=messageContext.addMessage(0,key));var translations=message.getTranslations(),currentTranslation=Util.Array.find(translations,function(translation){return translation.getLanguage()==language});return currentTranslation?currentTranslation._clientMessage=text:message.addTranslation(text,language,null,null),message},get:get,getAlt:getAlt,has:function(key){return key!=get(key)},parse:function(text){return text.replace(regex,function(match,key){return getAlt(key,match)})},format:format}}(),Messages.setContent=function(node,key){node.setAttribute("i18n-content",key),Util.Dom.setTextContent(node,Messages.get(key))},Messages.setHTMLContent=function(node,key){node.setAttribute("i18n-content",key),node.innerHTML=Messages.get(key)},function(){function getDisplayMessage(translation,params){if(null==translation)return"";var clientMessage=translation.getClientMessage(),messageID=translation.getParentMessage().getMessageId();return null!=clientMessage&&clientMessage.length>0?(params&&(clientMessage=Messages.format(clientMessage,params)),clientMessage+" [Message Code: "+messageID+"]"):translation.getParentMessage().getDefaultMessage()+" [Message Code: "+messageID+"]"}function get(defaultMessage,params){var translation=null;return null!=TDS.messages&&(translation=TDS.messages.findTranslation(defaultMessage)),null==translation?defaultMessage:getDisplayMessage(translation,params)}window.ErrorCodes={get:get,getAlt:function(key,alt){var message=get(key);return message==key&&alt?alt:message}}}(),void 0===TDS&&(TDS={}),TDS.Messages={},TDS.Messages.MessageTranslation=function(message,clientMessage,languageCode,subject,gradeCode){this._message=message,this._clientMessage=clientMessage,this._languageCode=languageCode||null,this._subject=subject||null,this._gradeCode=gradeCode||null},TDS.Messages.MessageTranslation.prototype.getParentMessage=function(){return this._message},TDS.Messages.MessageTranslation.prototype.getClientMessage=function(){return this._clientMessage},TDS.Messages.MessageTranslation.prototype.getLanguage=function(){return this._languageCode},TDS.Messages.MessageTranslation.prototype.getSubject=function(){return this._subject},TDS.Messages.MessageTranslation.prototype.getGrade=function(){return this._gradeCode},TDS.Messages.Message=function(context,messageId,defaultMessage){this._context=context,this._messageId=messageId,this._defaultMessage=defaultMessage,this._translationList=[],this._translation3D=null},TDS.Messages.Message.prototype.getParentContext=function(){return this._context},TDS.Messages.Message.prototype.getMessageId=function(){return this._messageId},TDS.Messages.Message.prototype.getDefaultMessage=function(){return this._defaultMessage},TDS.Messages.Message.prototype.getTranslations=function(){return this._translationList},TDS.Messages.Message.prototype.addTranslation=function(clientMessage,languageCode,gradeCode,subject){var translation=new TDS.Messages.MessageTranslation(this,clientMessage,languageCode,gradeCode,subject);return this._translationList.push(translation),translation},TDS.Messages.Message.prototype.initTranslationIndex=function(translation3D){this._translation3D=translation3D},TDS.Messages.Message.prototype.setTranslationIndex=function(messageIndex,translationIndex){var langIdx=messageIndex.getLanguageIndex(),subjectIdx=messageIndex.getSubjectIndex(),gradeIdx=messageIndex.getGradeIndex();this._translation3D[langIdx][subjectIdx][gradeIdx]=translationIndex},TDS.Messages.Message.prototype.getTranslationByIndex=function(messageIndex){messageIndex.getLanguageIndex(),messageIndex.getSubjectIndex();var gradeIdx=messageIndex.getGradeIndex(),index=this._translation3D[gradeIdx];return YAHOO.lang.isNumber(index)||(index=0),this._translationList[index]},TDS.Messages.Message.prototype.getTranslationByLang=function(languageCode){var translations=this.getTranslations(),translation=Util.Array.find(translations,function(translation){return translation.getLanguage()==languageCode});return null!=translation?translation:null==translation&&translations.length>0?translations[0]:null},TDS.Messages.Message.prototype.toString=function(){return this.getDefaultMessage()},TDS.Messages.MessageContext=function(contextName){this._name=contextName,this._messagesLookup=new Util.Structs.Map},TDS.Messages.MessageContext.prototype.getName=function(){return this._name},TDS.Messages.MessageContext.prototype.addMessage=function(messageId,defaultMessage){var message=new TDS.Messages.Message(this,messageId,defaultMessage);return this._messagesLookup.set(defaultMessage,message),message},TDS.Messages.MessageContext.prototype.getMessages=function(){return this._messagesLookup.getValues()},TDS.Messages.MessageContext.prototype.getMessage=function(defaultMessage){return this._messagesLookup.get(defaultMessage)},TDS.Messages.MessageContext.prototype.toString=function(){return this.getName()},TDS.Messages.MessageSystem=function(){this._languages=[],this._messageIndexer=new TDS.Messages.MessageIndexer,this._messageContexts=new Util.Structs.Map},TDS.Messages.MessageSystem.prototype.hasLanguage=function(language){return-1!=this._languages.indexOf(language)},TDS.Messages.MessageSystem.prototype._getLanguage=function(){return"ENU"},TDS.Messages.MessageSystem.prototype.getIndexer=function(){return this._messageIndexer},TDS.Messages.MessageSystem.prototype.addContext=function(context){var messageContext=new TDS.Messages.MessageContext(context);return this._messageContexts.set(context,messageContext),messageContext},TDS.Messages.MessageSystem.prototype.getContexts=function(){return this._messageContexts.getValues()},TDS.Messages.MessageSystem.prototype.getContext=function(context){return this._messageContexts.get(context)},TDS.Messages.MessageSystem.prototype.getTranslation=function(context,defaultMessage,languageCode,subject,gradeCode){var messageContext=this.getContext(context);if(null!=messageContext){var message=messageContext.getMessage(defaultMessage);if(null!=message)return message.getTranslationByLang(languageCode)}return null},TDS.Messages.MessageSystem.prototype.findTranslation=function(defaultMessage){for(var translation=null,language=this._getLanguage(),contexts=this.getContexts(),i=0;i<contexts.length;i++){var context=contexts[i];if(null!=(translation=this.getTranslation(context.getName(),defaultMessage,language,null,null)))break}return translation},TDS.Messages.MessageSystem.prototype.getTextByContext=function(context,defaultMessage){var language=this._getLanguage(),translation=this.getTranslation(context,defaultMessage,language,null,null);return translation?translation.getClientMessage():defaultMessage},TDS.Messages.MessageSystem.prototype.getTemplateData=function(){var language=this._getLanguage(),templateData={};return Util.Array.each(this.getContexts(),function(messageContext){Util.Array.each(messageContext.getMessages(),function(message){var translation=message.getTranslationByLang(language);templateData[message.getDefaultMessage()]=translation.getClientMessage()})}),templateData},TDS.Messages.MessageIndex=function(langIdx,subjectIdx,gradeIdx){this._langIdx=langIdx,this._subjectIdx=subjectIdx,this._gradeIdx=gradeIdx},TDS.Messages.MessageIndex.prototype.getLanguageIndex=function(){return this._langIdx},TDS.Messages.MessageIndex.prototype.getSubjectIndex=function(){return this._subjectIdx},TDS.Messages.MessageIndex.prototype.getGradeIndex=function(){return this._gradeIdx},TDS.Messages.MessageIndexer=function(){this._languageDictionary=new Util.Structs.Map,this._subjectDictionary=new Util.Structs.Map,this._gradeDictionary=new Util.Structs.Map,this.init()},TDS.Messages.MessageIndexer.prototype.init=function(){this._languageDictionary.clear(),this._subjectDictionary.clear(),this._gradeDictionary.clear(),this._languageDictionary.set("ENU",0),this._subjectDictionary.set("DefaultSubject",0),this._gradeDictionary.set("DefaultGrade",0)},TDS.Messages.MessageIndexer.prototype.addLanguage=function(language){return YAHOO.lang.isString(language)?this._languageDictionary.containsKey(language)?this._languageDictionary.get(language):(this._languageDictionary.set(language,this._languageDictionary.getCount()),this._languageDictionary.getCount()-1):0},TDS.Messages.MessageIndexer.prototype.addSubject=function(subject){return YAHOO.lang.isString(subject)?this._subjectDictionary.containsKey(subject)?this._subjectDictionary.get(subject):(this._subjectDictionary.set(subject,this._subjectDictionary.getCount()),this._subjectDictionary.getCount()-1):0},TDS.Messages.MessageIndexer.prototype.addGrade=function(grade){return YAHOO.lang.isString(grade)?this._gradeDictionary.containsKey(grade)?this._gradeDictionary.get(grade):(this._gradeDictionary.set(grade,this._gradeDictionary.getCount()),this._gradeDictionary.getCount()-1):0},TDS.Messages.MessageIndexer.prototype.createIndexer3D=function(){var i1=this._languageDictionary.getCount()>0?this._languageDictionary.getCount():1,i2=this._subjectDictionary.getCount()>0?this._subjectDictionary.getCount():1,i3=this._gradeDictionary.getCount()>0?this._gradeDictionary.getCount():1;return Util.Array.createMultiDimArray(i1,i2,i3)},TDS.Messages.MessageIndexer.prototype.getLanguageIndex=function(language){return YAHOO.lang.isString(language)&&0!=this._languageDictionary.getCount()&&this._languageDictionary.containsKey(language)?this._languageDictionary.get(language):0},TDS.Messages.MessageIndexer.prototype.getSubjectIndex=function(subject){return YAHOO.lang.isString(subject)&&0!=this._subjectDictionary.getCount()&&this._subjectDictionary.containsKey(subject)?this._subjectDictionary.get(subject):0},TDS.Messages.MessageIndexer.prototype.getGradeIndex=function(grade){return YAHOO.lang.isString(grade)&&0!=this._gradeDictionary.getCount()&&this._gradeDictionary.containsKey(grade)?this._gradeDictionary.get(grade):0},TDS.Messages.MessageIndexer.prototype.get=function(language,subject,grade){var langIdx=this.getLanguageIndex(language),subjectIdx=this.getSubjectIndex(subject),gradeIdx=this.getGradeIndex(grade);return new TDS.Messages.MessageIndex(langIdx,subjectIdx,gradeIdx)},TDS.Messages.MessageLoader=function(messageSystem){this._messageSystem=messageSystem||new TDS.Messages.MessageSystem},TDS.Messages.MessageLoader.prototype.getMessageSystem=function(){return this._messageSystem},TDS.Messages.MessageLoader.prototype.load=function(json){null==json.c_l||this._messageSystem.hasLanguage(json.c_l)||this._messageSystem._languages.push(json.c_l),Util.Array.each(json.c_a,this.loadContext,this)},TDS.Messages.MessageLoader.prototype.loadContext=function(jsonContext){if(null!=jsonContext){var messageContext=this._messageSystem.getContext(jsonContext.c);null==messageContext&&(messageContext=this._messageSystem.addContext(jsonContext.c)),Util.Array.each(jsonContext.m_a,function(jsonMessage){var message=messageContext.getMessage(jsonMessage.m);null==message&&(message=messageContext.addMessage(jsonMessage.id,jsonMessage.m)),Util.Array.each(jsonMessage.t_a,function(jsonTranslation){message.addTranslation(jsonTranslation.t,jsonTranslation.l,jsonTranslation.s,jsonTranslation.g)})})}},TDS.Messages.MessageLoader.prototype.buildIndex=function(){var messageIndexer=this._messageSystem.getIndexer();Util.Array.each(this._messageSystem.getContexts(),function(messageContext){Util.Array.each(messageContext.getMessages(),function(message){Util.Array.each(message.getTranslations(),function(translation){messageIndexer.addLanguage(translation.getLanguage()),messageIndexer.addSubject(translation.getSubject()),messageIndexer.addGrade(translation.getGrade())})})}),Util.Array.each(this._messageSystem.getContexts(),function(messageContext){Util.Array.each(messageContext.getMessages(),function(message){message.initTranslationIndex(messageIndexer.createIndexer3D());var translationIndex=0;Util.Array.each(message.getTranslations(),function(translation){var messageIndex=messageIndexer.get(translation.getLanguage(),translation.getSubject(),translation.getGrade());message.setTranslationIndex(messageIndex,translationIndex),translationIndex++})})})},TDS.Messages.Template=function(){function process(node,dictionary){for(var element,elements=YAHOO.util.Selector.query(selector,node),i=0;element=elements[i];i++)for(var j=0;j<attributeNames.length;j++){var name=attributeNames[j],attribute=element.getAttribute(name);null!=attribute&&handlers[name](element,attribute,dictionary)}}var hasText=function(element){var text=Util.Dom.getTextContent(element);return null!=text&&(text=YAHOO.lang.trim(text)).length>0},handlers={"i18n-content":function(element,key,dictionary){var replacement=dictionary[key];YAHOO.lang.isString(replacement)?element.innerHTML=replacement:hasText(element)||(element.innerHTML=key)},"i18n-text":function(element,key,dictionary){var replacement=dictionary[key];YAHOO.lang.isString(replacement)?Util.Dom.setTextContent(element,replacement):hasText(element)||Util.Dom.setTextContent(element,key)},"i18n-button":function(element,key,dictionary){var replacement=dictionary[key];YAHOO.lang.isString(replacement)?(replacement=(replacement=replacement.replace("<span>","")).replace("</span>",""),Util.Dom.setTextContent(element,replacement)):hasText(element)||Util.Dom.setTextContent(element,key)},"i18n-options":function(element,key,dictionary){dictionary[key].forEach(function(values){var option="string"==typeof values?new Option(values):new Option(values[1],values[0]);element.appendChild(option)})},"i18n-values":function(element,attributeAndKeys,dictionary){for(var parts=attributeAndKeys.replace(/\s/g,"").split(/;/),j=0;j<parts.length;j++){var attributeAndKeyPair=parts[j].match(/^([^:]+):(.+)$/);if(attributeAndKeyPair){var propName=attributeAndKeyPair[1],propExpr=attributeAndKeyPair[2];if(propExpr in dictionary){var value=dictionary[propExpr];if("."==propName.charAt(0)){for(var path=propName.slice(1).split("."),targetObject=element;targetObject&&path.length>1;)targetObject=targetObject[path.shift()];targetObject&&(targetObject[path]=value,"innerHTML"==path&&process(element,dictionary))}else element.setAttribute(propName,value)}else Util.log('i18n-values: Missing value for "'+propExpr+'"')}}}},attributeNames=Util.Object.keys(handlers),selector="["+attributeNames.join("],[")+"]";return{process:process}}(),TDS.Messages.Template.processLanguage=function(node){var templateData=TDS.messages.getTemplateData();TDS.Messages.Template.process(node||document,templateData)};var Accommodations=function(){function Accs(id,label){this._position=null,this._id=null,this._DOMId=null,this._label=null,this._types=[],this._typeLookup=new Util.Structs.Map,this._valuesLookup=new Util.Structs.Map,this._toolDependencies=[],this.setId(id||null),this.setLabel(label||null),Util.Event.Emitter(this)}Accs.DOM_ID="data-accs-id",Accs.create=function(json){var accommodations=new Accs;return accommodations.importJson(json),accommodations};var AccsProto=Accs.prototype;return AccsProto.getPosition=function(){return this._position},AccsProto.setPosition=function(position){this._position=position},AccsProto.getId=function(){return this._id},AccsProto.setId=function(id){id?(this._id=id,this._DOMId=id.replace(/\s+/g,"-")):this._id||(this._id="default")},AccsProto.getDomId=function(){return this._DOMId},AccsProto.getLabel=function(){return this._label},AccsProto.setLabel=function(label){this._label=label},AccsProto.createType=function(name,label,isVisible,isSelectable,allowChange,studentControl,dependsOn){if("string"!=typeof name)throw Error("Cannot create acc type because the name is not a valid string.");var accType=this.getType(name);return accType||(accType=new Accs.Type(this,name,label,isVisible,isSelectable,allowChange,studentControl,dependsOn),this._types.push(accType),this._typeLookup.set(name,accType),this.fire("createType",accType)),accType},AccsProto.createTypeFromObject=function(obj){if(obj instanceof Accs.Type){var dependsOnType=obj.getDependsOnTool(),dependsOnTypeName=null==dependsOnType?null:dependsOnType.getName();return this.createType(obj.getName(),obj.getLabel(),obj.isVisible(),obj.isSelectable(),obj.allowChange(),obj.allowStudentControl(),dependsOnTypeName)}return this.createType(obj.name,obj.label,obj.isVisible,obj.isSelectable,obj.allowChange,obj.studentControl,obj.dependsOn)},AccsProto.getTypes=function(){return this._types.slice(0)},AccsProto.hasType=function(typeName){return this._typeLookup.containsKey(typeName)},AccsProto.getType=function(typeName){return this._typeLookup.get(typeName)},AccsProto.removeType=function(name){var accType=this.getType(name);accType&&accType.destroy()},AccsProto.hasValue=function(valueCode){return this._valuesLookup.containsKey(valueCode)},AccsProto.getValue=function(valueCode){return this._valuesLookup.get(valueCode)},AccsProto.isAnyVisible=function(){return this.getTypes().some(function(accType){return accType.isVisible()})},AccsProto.findCode=function(typeName,valueCode,requireSelected){var accType=this.getType(typeName);return accType?Util.Array.find(accType.getValues(),function(accValue){if(requireSelected&&!0!==accValue.isSelected())return!1;if(valueCode==accValue.getCode())return!0;for(var splitCodes=accValue.getCodes(),i=0;i<splitCodes.length;i++)if(valueCode==splitCodes[i])return!0;return!1}):null},AccsProto.getValues=function(includeAll){return this._valuesLookup.getValues().filter(function(accValue){return includeAll||accValue.isActive()})},AccsProto.getSelected=function(){return this.getValues().filter(function(accValue){return accValue.isSelected()})},AccsProto.selectCodes=function(typeName,codes){if("string"==typeof codes&&(codes=[codes]),!$.isArray(codes))return[];var accType=this.getType(typeName),valuesToSelect=$.map(codes,function(code){return this.getValue(code)}.bind(this));return accType&&accType.getValues().forEach(function(accValue){-1==valuesToSelect.indexOf(accValue)&&accValue.deselect()}),valuesToSelect.forEach(function(accValue){accValue.select()}),valuesToSelect},AccsProto.selectDefaults=function(){function selectDefaultCodes(accType){var accValue=accType.getDefault();accValue&&this.selectCodes(accType.getName(),[accValue.getCode()])}var accTypes=this.getTypes(),accPartition=Util.Array.partition(accTypes,function(accType){return!accType.getDependsOnTool()});accPartition.matches.forEach(selectDefaultCodes.bind(this)),accPartition.rejects.forEach(selectDefaultCodes.bind(this))},AccsProto.clearDependencies=function(){Util.Array.clear(this._toolDependencies),this.getTypes().forEach(function(accType){accType.clearDependsOnTool()})},AccsProto.selectAll=function(){this.clearDependencies(),this.getTypes().forEach(function(accType){this.selectCodes(accType.getName(),accType.getCodes())}.bind(this))},AccsProto.getSelectedEncoded=function(){return this.getSelected().map(function(accValue){var name=accValue.getParentType().getName(),code=encodeURIComponent(accValue.getCode());return encodeURIComponent(name+"="+code)}).join("&")},AccsProto.getSelectedDelimited=function(encode,delimiter){return this.getSelected().map(function(accValue){var code=accValue.getCode();return encode&&(code=encodeURIComponent(code)),code}).join(delimiter||";")},AccsProto.getSelectedJson=function(){return this.getTypes().map(function(accType){return{type:accType.getName(),codes:accType.getCodes(!0)}}).filter(function(obj){return obj.codes.length})},AccsProto.clone=function(){var accommodations=new Accs,jsonTypes=this.exportJson();return accommodations.importJson(jsonTypes),accommodations},AccsProto.unionWith=function(other){other.getTypes().forEach(function(otherType){var unionType=this.createTypeFromObject(otherType);otherType.getValues().forEach(function(otherValue){unionType.createValueFromObject(otherValue)})}.bind(this))},AccsProto.replaceWith=function(other){other.getTypes().forEach(function(otherType){var replaceType=this.getType(otherType.getName());replaceType&&replaceType.destroy(),replaceType=this.createTypeFromObject(otherType),otherType.getValues().forEach(function(otherValue){replaceType.createValueFromObject(otherValue)})}.bind(this))},AccsProto.applyCSS=function(el){var accsId=this.getId(),codes=$.map(this.getValues(),function(accValue){if(accValue.isSelected())return accValue.getCodes()}).join(" ");$(el).addClass(codes).attr(Accs.DOM_ID,accsId),console.log("ACCS APPLY CSS: "+accsId)},AccsProto.removeCSS=function(el){var accsId=this.getId(),codes=$.map(this.getValues(),function(accValue){return accValue.getCodes()}).join(" ");$(el).removeClass(codes).attr(Accs.DOM_ID,""),console.log("ACCS REMOVE CSS: "+accsId)},AccsProto.createProps=function(){return new Accs.Properties(this)},AccsProto.getDependencies=function(){return this._toolDependencies},AccsProto.addDependency=function(ifType,ifValue,thenType,thenValue,isDefault){var dependency=new Accs.Dependency(this,ifType,ifValue,thenType,thenValue,isDefault);return dependency.ifType()&&dependency.ifValue()&&dependency.thenType()&&dependency.thenValue()?(this._toolDependencies.push(dependency),dependency):null},AccsProto.removeDependency=function(dep){return Util.Array.remove(this._toolDependencies,dep)},AccsProto.clear=function(){Util.Array.clone(this._toolDependencies).forEach(function(dep){dep.destroy()}),Util.Array.clear(this._toolDependencies),Util.Array.clone(this._types).forEach(function(accType){accType.destroy()}),Util.Array.clear(this._types),this._typeLookup.clear(),this._valuesLookup.clear()},AccsProto.destroy=function(){this.clear(),this._id=null,this._label=null},Accs}();Accommodations.Type=function(){var AccType=function(parentAccommodations,name,label,isVisible,isSelectable,allowChange,studentControl,dependsOn){this.getParentAccommodations=function(){return parentAccommodations},this.getName=function(){return name},this.getLabel=function(){if("object"==typeof TDS&&null!=TDS.messages){var text=TDS.messages.getTextByContext("AccType",name);if(text!=name)return text}return label||name},this.isVisible=function(){return!!isVisible&&this.getValues().length>0},this.isSelectable=function(){return!0===isSelectable},this.allowChange=function(){return!0===allowChange},this.allowStudentControl=function(){return!0===studentControl},this._dependsOnTypeName=dependsOn,this._values=[];var id=parentAccommodations.getDomId()+"-"+name.replace(/\s+/g,"").toLowerCase();this.getControlId=function(){return"accs-control-"+id},this.getId=function(){return"accs-type-"+id},this.clear=function(){Util.Array.clone(this._values).forEach(function(accValue){accValue.destroy()}),Util.Array.clear(this._values)},this.destroy=function(){this.clear();var self=this;parentAccommodations.getDependencies().filter(function(dep){return dep.ifType()==self||dep.thenType()==self}).forEach(function(dep){parentAccommodations.removeDependency(dep)}),parentAccommodations._typeLookup.remove(name),Util.Array.remove(parentAccommodations._types,this),parentAccommodations=null,name=null,label=null,this._dependsOnTypeName=null}},AccTypeProto=AccType.prototype;return AccTypeProto.createValue=function(code,name,label,isDefault,allowCombine){if("string"!=typeof code)throw Error("Cannot create acc value because the code is not a valid string.");var accValue=this.getParentAccommodations().getValue(code);return accValue||(accValue=new Accommodations.Value(this,code,name,label,isDefault,allowCombine),this._values.push(accValue),this.getParentAccommodations()._valuesLookup.set(code,accValue),this.getParentAccommodations().fire("createValue",accValue)),accValue},AccTypeProto.createValueFromObject=function(obj){var accValue;return obj instanceof Accommodations.Value?(accValue=this.createValue(obj.getCode(),obj.getName(),obj.getLabel(),obj.isDefault(),obj.allowCombine()))._selected=obj._selected:(accValue=this.createValue(obj.code,obj.name,obj.label,obj.isDefault,obj.allowCombine))._selected=obj.selected,accValue},AccTypeProto.removeValue=function(code){var accValue=this.getParentAccommodations().getValue(code);accValue&&(this.getParentAccommodations().fire("removeValue",accValue),accValue.deselect(),accValue.destroy())},AccTypeProto.getValues=function(includeAll){return this._values.filter(function(accValue){return includeAll||accValue.isActive()})},AccTypeProto.getCodes=function(requireSelected){return this.getValues().filter(function(accValue){return!requireSelected||accValue.isSelected()}).map(function(accValue){return accValue.getCode()})},AccTypeProto.getDefault=function(){var defaultValue=Util.Array.find(this.getValues(),function(accValue){var dependencyRule=accValue.getDependencyRule();return dependencyRule?dependencyRule.isDefault():accValue.isDefault()});return defaultValue||this.getValues()[0]},AccTypeProto.getSelected=function(){return this.getValues().filter(function(accValue){return accValue.isSelected()})},AccTypeProto.isSelected=function(code){return this.getValues().some(function(accValue){return!0===accValue.isSelected()&&(code===accValue.getCode()||accValue.getCodes().some(function(splitCode){return code===splitCode}))})},AccTypeProto.deselectAll=function(){this.getValues().forEach(function(accValue){accValue.deselect()})},AccTypeProto.isMultiSelect=function(){return this.getValues().some(function(accValue){return accValue.allowCombine()})},AccTypeProto.isBoolSelect=function(){var values=this.getValues();if(2!=values.length)return!1;var value1=values[0].getName(),value2=values[1].getName();return"False"==value1&&"True"==value2||"True"==value1&&"False"==value2},AccTypeProto.hashCode=function(){var hashString=this.getCodes().join("|");return Util.String.hashCode(hashString)},AccTypeProto.toString=function(){return this.getName()},AccTypeProto.setDependsOnTool=function(name){this._dependsOnTypeName=name},AccTypeProto.getDependsOnTool=function(){return"string"==typeof this._dependsOnTypeName?this.getParentAccommodations().getType(this._dependsOnTypeName):null},AccTypeProto.clearDependsOnTool=function(){this._dependsOnTypeName=null},AccTypeProto.getDependentTypes=function(){var dependentTypes=[];return this.getParentAccommodations().getTypes().forEach(function(accType){accType.getDependsOnTool()===this&&-1==dependentTypes.indexOf(accType)&&dependentTypes.push(accType)}.bind(this)),dependentTypes},AccType}(),Accommodations.Value=function(){var AccValue=function(parentType,code,name,label,isDefault,allowCombine){this.getParentType=function(){return parentType},this.getCode=function(){return code},this.setCode=function(str){code=str},this.getCodes=function(){return code&&code.split("&")||[]},this.getName=function(){return name},this.setName=function(str){name=str},this.allowCombine=function(){return!0===allowCombine},this.setCombinable=function(value){allowCombine=!!value},this.getLabel=function(){if("object"==typeof TDS&&null!=TDS.messages){var text=TDS.messages.getTextByContext("AccValue",code);if(text!=code)return text}return label||name},this.setLabel=function(str){label=str},this._isDefault=isDefault,this._selected=!1,this.destroy=function(){var self=this;parentType.getParentAccommodations().getDependencies().filter(function(dep){return dep.ifValue()==self||dep.thenValue()==self}).forEach(function(dep){parentType.getParentAccommodations().removeDependency(dep)}),parentType.getParentAccommodations()._valuesLookup.remove(code),Util.Array.remove(parentType._values,this),parentType=null,code=null,label=null},this.toString=function(){return code}},AccValueProto=AccValue.prototype;return AccValueProto.setDefault=function(isDefault){this._isDefault=!!isDefault},AccValueProto.isDefault=function(){return this._isDefault},AccValueProto.isSelected=function(){return this._selected},AccValueProto.select=function(){if(this._selected)return!1;if(!this.isActive())return!1;var parentType=this.getParentType();return this.allowCombine()||parentType.getSelected().forEach(function(selectedValue){selectedValue.deselect()}),this._selected=!0,parentType.getDependentTypes().forEach(function(dependentType){dependentType.getValues(!0).forEach(function(dependentValue){dependentValue.deselect()});var dependentDefaultValue=dependentType.getDefault();dependentDefaultValue&&dependentDefaultValue.select()}),parentType.getParentAccommodations().fire("selectValue",this),!0},AccValueProto.deselect=function(){return!!this._selected&&(this._selected=!1,this.getParentType().getParentAccommodations().fire("deselectValue",this),!0)},AccValueProto.getDependencyRule=function(){var parentType=this.getParentType();if(!parentType)return null;var dependancyType=parentType.getDependsOnTool();if(!dependancyType)return null;var accs=parentType.getParentAccommodations();return Util.Array.find(accs.getDependencies(),function(dependency){var accIfType=dependency.ifType();if(accIfType&&accIfType==dependancyType){var accIfValue=dependency.ifValue();if(accIfValue&&accIfValue.isSelected())return dependency.thenValue()==this}return!1},this)},AccValueProto.isActive=function(){return null==this.getParentType().getDependsOnTool()||null!=this.getDependencyRule()},AccValueProto.restrict=function(restrictType,byValue,isDefault){var thisType=this.getParentType(),accs=thisType.getParentAccommodations(),restrictTypeObj=accs.getType(restrictType),restrictValueObj=accs.getValue(byValue);restrictTypeObj&&restrictTypeObj.setDependsOnTool(thisType.getName()),isDefault=isDefault||restrictValueObj&&restrictValueObj.isDefault(),accs.addDependency(thisType.getName(),this.getCode(),restrictType,byValue,isDefault)},AccValueProto.depends=function(dependType,onValue,isDefault){var thisType=this.getParentType(),accs=thisType.getParentAccommodations();thisType.setDependsOnTool(dependType),isDefault=isDefault||this.isDefault(),accs.addDependency(dependType,onValue,thisType.getName(),this.getCode(),isDefault)},AccValue}(),Accommodations.Dependency=function(){return function(parentAccommodations,ifTypeName,ifValueCode,thenTypeName,thenValueCode,thenIsDefault){this.ifType=function(){return parentAccommodations.getType(ifTypeName)},this.ifValue=function(){return parentAccommodations.getValue(ifValueCode)},this.thenType=function(){return parentAccommodations.getType(thenTypeName)},this.thenValue=function(){return parentAccommodations.getValue(thenValueCode)},this.isDefault=function(){return!0===thenIsDefault},this.destroy=function(){parentAccommodations=null,ifTypeName=null,ifValueCode=null,thenTypeName=null,thenValueCode=null}}}(),function(Accs){Accs.prototype.importJsonArray=function(accTypes){if($.isArray(accTypes))for(var i=0;i<accTypes.length;i++)for(var jsonType=accTypes[i],accType=this.createTypeFromObject(jsonType),jsonvalues=jsonType.values,j=0;j<jsonvalues.length;j++){var jsonValue=jsonvalues[j];accType.createValueFromObject(jsonValue)}},Accs.prototype.importJson=function(accJson){if(accJson&&(this.setPosition(accJson.position),this.setId(accJson.id),this.setLabel(accJson.label),this.importJsonArray(accJson.types),$.isArray(accJson.dependencies)))for(var i=0;i<accJson.dependencies.length;i++){var jsonDependency=accJson.dependencies[i];this.addDependency(jsonDependency.ifType,jsonDependency.ifValue,jsonDependency.thenType,jsonDependency.thenValue,jsonDependency.isDefault)}},Accs.prototype.exportJson=function(){var json={};return json.position=this.getPosition(),json.id=this.getId(),json.label=this.getLabel(),json.types=[],json.dependencies=[],this.getTypes().forEach(function(accType){var accValues=accType.getValues();if(0!=accValues.length){var dependsOnType=accType.getDependsOnTool(),dependsOnTypeName=null==dependsOnType?null:dependsOnType.getName(),jsonType={name:accType.getName(),label:accType.getLabel(),isVisible:accType.isVisible(),isSelectable:accType.isSelectable(),allowChange:accType.allowChange(),studentControl:accType.allowStudentControl(),dependsOn:dependsOnTypeName};json.types.push(jsonType),jsonType.values=[],accValues.forEach(function(accValue){var jsonValue={code:accValue.getCode(),name:accValue.getName(),label:accValue.getLabel(),isDefault:accValue==accType.getDefault(),allowCombine:accValue.allowCombine(),selected:accValue._selected};jsonType.values.push(jsonValue)})}}),this.getDependencies().forEach(function(dependency){var jsonDependency={ifType:dependency.ifType().getName(),ifValue:dependency.ifValue().getCode(),thenType:dependency.thenType().getName(),thenValue:dependency.thenValue().getCode(),isDefault:dependency.isDefault()};json.dependencies.push(jsonDependency)}),json}}(window.Accommodations),function(Accs){function Props(accommodations){this._accommodations=accommodations}var PropsProto=Props.prototype;PropsProto.getSelectedValue=function(typeName){if(null==this._accommodations)return null;var accType=this._accommodations.getType(typeName);if(null!=accType){var selectedValues=accType.getSelected();if(selectedValues.length>0)return selectedValues[0]}return null},PropsProto.getSelectedCode=function(type){var selectedValue=this.getSelectedValue(type);return selectedValue?selectedValue.getCode():null},PropsProto.isSelected=function(type,code){return null!=this._accommodations&&null!=this._accommodations.findCode(type,code,!0)},PropsProto.existsAndNotEquals=function(type,code){var selectedCode=this.getSelectedCode(type);return null!=selectedCode&&selectedCode!=code},PropsProto.getLanguage=function(){var language=this.getSelectedCode("Language");return language||"ENU"},PropsProto.getLanguages=function(selectedOnly){var accType=this._accommodations.getType("Language");return null!=accType?accType.getCodes(selectedOnly):["ENU"]},PropsProto.hasBraille=function(){if(this.isSelected("Braille","TDS_Braille1"))return!0;var language=this.getLanguage();return Util.String.endsWith(language,"-Braille")||this.existsAndNotEquals("Braille Type","TDS_BT0")},PropsProto.getBrailleType=function(){return this.getSelectedCode("Braille Type")},PropsProto.getCalculator=function(){return this.getSelectedCode("Calculator")},PropsProto.getColorChoice=function(){return this.getSelectedCode("Color Choices")},PropsProto.getFormula=function(){return this.getSelectedCode("Formula")},PropsProto.getFontSize=function(){return this.getSelectedCode("Font Size")},PropsProto.getFontType=function(){return this.getSelectedCode("Font Type")},PropsProto.hasGuideForRevision=function(){return this.isSelected("Guide for Revision","TDS_GfR1")},PropsProto.hasHighlighting=function(){return this.isSelected("Highlight","TDS_Highlight1")},PropsProto.hasMarkForReview=function(){return this.isSelected("Mark for Review","TDS_MfR1")},PropsProto.hasPrintItem=function(){return this.isSelected("Print on Request","TDS_PoD_Item")},PropsProto.hasPrintStimulus=function(){return this.isSelected("Print on Request","TDS_PoD_Stim")},PropsProto.hasEmbossItem=function(){return this.isSelected("Emboss","TDS_Emboss_Item")},PropsProto.hasEmbossStimulus=function(){return this.isSelected("Emboss","TDS_Emboss_Stim")},PropsProto.getPrintSize=function(){return this.getSelectedCode("Print Size")},PropsProto.getPeriodicTable=function(){return this.getSelectedCode("Periodic Table")},PropsProto.hasStrikethrough=function(){return this.isSelected("Strikethrough","TDS_ST1")},PropsProto.hasTutorial=function(){return this.isSelected("Tutorial","TDS_T1")},PropsProto.hasASIVoiceGuidance=function(){return this.isSelected("Scaffolding Voice Guidance","TDS_ASIGuide1")},PropsProto.hasTTSInstruction=function(){return this.isSelected("TTS","TDS_TTS_Inst")},PropsProto.hasTTSItem=function(){return this.isSelected("TTS","TDS_TTS_Item")},PropsProto.hasTTSStimulus=function(){return this.isSelected("TTS","TDS_TTS_Stim")},PropsProto.hasTTS=function(){return this.existsAndNotEquals("TTS","TDS_TTS0")},PropsProto.hasTTSPausing=function(){return this.isSelected("TTS Pausing","TDS_TTSPause1")},PropsProto.hasCalculator=function(){return this.existsAndNotEquals("Calculator","TDS_Calc0")},PropsProto.hasColorChoice=function(){return this.existsAndNotEquals("Color Choices","TDS_CC0")},PropsProto.hasFormula=function(){return this.existsAndNotEquals("Formula","TDS_F0")},PropsProto.hasPeriodicTable=function(){return this.existsAndNotEquals("Periodic Table","TDS_PT0")},PropsProto.hasStudentComments=function(){return this.existsAndNotEquals("Student Comments","TDS_SC0")},PropsProto.getStudentComments=function(){return this.getSelectedCode("Student Comments")},PropsProto.getNavigationDropdown=function(){return this.getSelectedCode("Navigation Dropdown")},PropsProto.getTTXBusinessRules=function(){return this.getSelectedCode("TTX Business Rules")},PropsProto.showFeedback=function(){return this.isSelected("Feedback","LPN_FB1")},PropsProto.showExpandablePassages=function(){return this.isSelected("Expandable Passages","TDS_ExpandablePassages1")},PropsProto.hasAudioControl=function(){return this.existsAndNotEquals("TTS Audio Adjustments","TDS_TTSAA0")},PropsProto.showVoicePackControl=function(){return this.isSelected("TTS Audio Adjustments","TDS_TTSAA_SelectVP")},PropsProto.showVolumeControl=function(){return this.isSelected("TTS Audio Adjustments","TDS_TTSAA_Volume")},PropsProto.showPitchControl=function(){return this.isSelected("TTS Audio Adjustments","TDS_TTSAA_Pitch")},PropsProto.showRateControl=function(){return this.isSelected("TTS Audio Adjustments","TDS_TTSAA_Rate")},PropsProto.blockPausing=function(){return this.isSelected("Block Pausing","TDS_BP1")},PropsProto.hasResponseReset=function(){return this.isSelected("Item Response Reset","TDS_ItemReset1")},PropsProto.hasResponseRecovery=function(){return this.isSelected("Item Response Recovery","TDS_IRR1")},PropsProto.isTestShellClassic=function(){return this.isSelected("Test Shell","TDS_TS_Classic")},PropsProto.isTestShellModern=function(){return this.isSelected("Test Shell","TDS_TS_Modern")},PropsProto.isTestShellUniversal=function(){return this.isSelected("Test Shell","TDS_TS_Universal")},PropsProto.isTestShellAccessibility=function(){return this.isSelected("Test Shell","TDS_TS_Accessibility")},PropsProto.isStreamlinedMode=function(){return this.isSelected("Streamlined Mode","TDS_SLM1")},PropsProto.requirePageVisit=function(){return this.isSelected("Require Page Visit","TDS_RPV1")},PropsProto.hasASL=function(){return this.isSelected("American Sign Language","TDS_ASL1")},PropsProto.hasClosedCaptioning=function(){return this.isSelected("Closed Captioning","TDS_ClosedCap1")},PropsProto.hideTestScore=function(){return this.isSelected("Suppress Score","TDS_SS1")},PropsProto.showItemScoreReportSummary=function(){return this.isSelected("Item Score Report","TDS_ISR_Summary")},PropsProto.showItemScoreReportResponses=function(){return this.isSelected("Item Score Report","TDS_ISR_SumViewResp")},PropsProto.isPermissiveModeEnabled=function(){return this.isSelected("Permissive Mode","TDS_PM1")},PropsProto.hasFullScreenEnabled=function(){return this.isSelected("Fullscreen","TDS_FS_On")||this.isSelected("Fullscreen","TDS_FS_Pass")},PropsProto.hasFullScreenPassword=function(){return this.isSelected("Fullscreen","TDS_FS_Pass")},PropsProto.hasSoundPlayCheck=function(){return this.isSelected("Hardware Checks","TDS_HWPlayback")||this.isSelected("Hardware Checks","TDS_HWPlaybackVol")},PropsProto.hasSoundPlayVolCheck=function(){return this.isSelected("Hardware Checks","TDS_HWPlaybackVol")},PropsProto.hasRecorderCheck=function(){return this.isSelected("Hardware Checks","TDS_HWRecording")},PropsProto.hasSoundCheck=function(){return this.existsAndNotEquals("Hardware Checks","TDS_HW0")},PropsProto.hasMaskingEnabled=function(){return this.isSelected("Masking","TDS_Masking1")},PropsProto.isAudioRewindEnabled=function(){return this.isSelected("Audio Playback Controls","TDS_APC_PSP")},PropsProto.isAudioScrubberEnabled=function(){return this.isSelected("Audio Playback Controls","TDS_APC_SCRUBBER")},PropsProto.isPaginatedItemGroupsEnabled=function(){return this.isSelected("Paginate Item Groups","TDS_PIG1")},PropsProto.hasReverseContrast=function(){return this.isSelected("Color Choices","TDS_CCInvert")},PropsProto.getTestProgressIndicator=function(){return this.getSelectedCode("Test Progress Indicator")||"TDS_TPI_Responses"},PropsProto.hasSystemVolumeControl=function(){return this.isSelected("System Volume Control","TDS_SVC1")},PropsProto.isDictionaryEnabled=function(){return this.existsAndNotEquals("Dictionary","TDS_Dict0")},PropsProto.getDictionary=function(){return this.getSelectedCode("Dictionary")},PropsProto.getDictionaryOptions=function(){var accType=this._accommodations.getType("Dictionary Options");return null!=accType?accType.getCodes():[]},PropsProto.isSpanishDictionaryEnabled=function(){return this.existsAndNotEquals("Spanish Dictionary","TDS_SP0")},PropsProto.getSpanishDictionary=function(){return this.getSelectedCode("Spanish Dictionary")},PropsProto.getSpanishDictionaryOptions=function(){var accType=this._accommodations.getType("Spanish Dictionary Options");return null!=accType?accType.getCodes():[]},PropsProto.isThesaurusEnabled=function(){return this.existsAndNotEquals("Thesaurus","TDS_TH0")},PropsProto.getThesaurus=function(){return this.getSelectedCode("Thesaurus")},PropsProto.getThesaurusOptions=function(){var accType=this._accommodations.getType("Thesaurus Options");return null!=accType?accType.getCodes():[]},PropsProto.isTTSTrackingEnabled=function(){return this.existsAndNotEquals("TTS Tracking","TDS_TTSTracking0")},PropsProto.isSecurityBreachDetectionEnabled=function(){return this.isSelected("Enhanced Security Options","TDS_ESO_DetectBrowserBreach")&&!this.isPermissiveModeEnabled()},PropsProto.showItemToolsMenu=function(){return this.isSelected("Item Tools Menu","TDS_ITM1")},PropsProto.checkOptionalUnanswered=function(){return this.isSelected("Check Optional Unanswered","TDS_COU1")},PropsProto.getHTMLEditorButtonGroups=function(){for(var accType=this._accommodations.getType("HTMLEditor Button Groups"),selButtonGroups=accType?accType.getSelected():[],buttonGroups=[],index=0;index<selButtonGroups.length;++index)buttonGroups.push(selButtonGroups[index].getCode());return buttonGroups},PropsProto.isReviewScreenLayoutDropDown=function(){return this.isSelected("Review Screen Layout","TDS_RSL_DropDown")},PropsProto.isReviewScreenLayoutListView=function(){return this.isSelected("Review Screen Layout","TDS_RSL_ListView")},PropsProto.prefetchAnyItem=function(){return this.isSelected("Prefetch Item Rules","TDS_PIR_Any")},PropsProto.isAutoMuted=function(){return this.isSelected("Mute System Volume","TDS_Mute1")},PropsProto.isPassageMuted=function(){return!this.isAutoMuted()&&this.isSelected("Mute System Volume","TDS_Mute3")},PropsProto.isItemMuted=function(){return!this.isAutoMuted()&&this.isSelected("Mute System Volume","TDS_Mute2")},Accs.Properties=Props}(Accommodations),Accommodations.Manager={_mapOfAccommodations:new Util.Structs.Map,_current:null,onChange:new YAHOO.util.CustomEvent("onChange",Accommodations.Manager,!1,YAHOO.util.CustomEvent.FLAT)},Accommodations.Manager.clear=function(){this._mapOfAccommodations.clear(),this._current=null},Accommodations.Manager.add=function(accommodations){var id=accommodations.getId();this._mapOfAccommodations.set(id,accommodations),null==this._current&&(this.setDefault(id),this.setCurrent(id))},Accommodations.Manager.getAll=function(){return this._mapOfAccommodations.getValues()},Accommodations.Manager.get=function(id){return this._mapOfAccommodations.get(id)},Accommodations.Manager.getProperties=function(id){var accommodations=this.get(id);return new Accommodations.Properties(accommodations)},Accommodations.Manager.setDefault=function(id){YAHOO.lang.isString(id)&&(this._default=id)},Accommodations.Manager.getDefault=function(){return this.get(this._default)},Accommodations.Manager.getDefaultProperties=function(){var accommodations=this.getDefault();return new Accommodations.Properties(accommodations)},Accommodations.Manager.getDefaultProps=Accommodations.Manager.getDefaultProperties,Accommodations.Manager.setCurrent=function(id){if(YAHOO.lang.isString(id)&&id!=this._current&&null!=this.get(id)){var accsPrevious=this.getCurrent();this._current=id;var accsCurrent=this.getCurrent();this.onChange.fire({previous:accsPrevious,current:accsCurrent})}},Accommodations.Manager.getCurrent=function(){return this.get(this._current)},Accommodations.Manager.getCurrentProperties=function(){var accommodations=this.getCurrent();return new Accommodations.Properties(accommodations)},Accommodations.Manager.getCurrentProps=Accommodations.Manager.getCurrentProperties,Accommodations.Manager.addJson=function(json){if(YAHOO.lang.isArray(json))Util.Array.each(json,Accommodations.Manager.addJson,this);else{var accommodations=Accommodations.create(json);accommodations.selectAll(),this.add(accommodations)}},Accommodations.Manager.updateCSS=function(el,newId){var newAccs=Accommodations.Manager.get(newId);if(null!=newAccs){var currentId=el.getAttribute(Accommodations.DOM_ID);if(currentId!=newId){if(null!=currentId){var currentAccs=Accommodations.Manager.get(currentId);currentAccs&&currentAccs.removeCSS(el)}newAccs.applyCSS(el)}}},Accommodations.Renderer=function(){function Renderer(accs,opts){this._accs=accs,this._opts=opts||{},YAHOO.lang.augmentObject(this._opts,{showHidden:!1,showLocked:!1,reviewDisabled:!1,reviewAll:!1})}return Renderer.prototype.getContainer=function(){var containerId="accs-container-"+this._accs.getDomId();return document.getElementById(containerId)},Renderer.prototype.getForm=function(){var formId="accs-form-"+this._accs.getDomId();return document.forms[formId]},Renderer.prototype._onSelect=function(accValue){console.log("AccSelect: "+accValue),this.renderTypes(accValue.getParentType().getDependentTypes())},Renderer.prototype.bind=function(){this._accs.on("selectValue",this._onSelect.bind(this))},Renderer.prototype.unbind=function(){this._accs.removeListener("selectValue",this._onSelect.bind(this))},Renderer.prototype.render=function(parentEl){parentEl=YAHOO.util.Dom.get(parentEl);var container=this.getContainer();if(!container){var containerId="accs-container-"+this._accs.getDomId();container=HTML.DIV({id:containerId})}parentEl.appendChild(container);var form=this.getForm();if(!form){var formId="accs-form-"+this._accs.getDomId();form=HTML.FORM({id:formId,name:formId})}container.appendChild(form);var accTypes=this._accs.getTypes().filter(function(accType){return!accType.getDependsOnTool()});return this.renderTypes(accTypes),!0},Renderer.prototype.renderTypes=function(accTypes){accTypes.forEach(this.renderType.bind(this))},Renderer.prototype.renderType=function(accType){var containerEl=this.createContainer(accType),isMultiselect=accType.isMultiSelect();if(!this._opts.showHidden&&!accType.isVisible()||!this._opts.showLocked&&!accType.isSelectable())$(containerEl).hide();else{$(containerEl).show();var editable=accType.getValues().length>1,disabled=!accType.isSelectable()||!editable,reviewMode=this._opts.reviewAll&&(!editable||!accType.allowStudentControl())||this._opts.reviewDisabled&&disabled,labelEl=this.createLabel(accType,reviewMode),container=isMultiselect?$("<fieldset></fieldset>").appendTo(containerEl):containerEl;$(labelEl).appendTo(container);var ctrlEl;reviewMode?ctrlEl=this.createList(accType):accType.isBoolSelect()?($(containerEl).addClass("checkbox"),ctrlEl=this.createCheckBox(accType,disabled)):accType.isMultiSelect()?($(containerEl).addClass("multiselect"),ctrlEl=this.createCheckboxes(accType,disabled)):($(containerEl).addClass("singleselect"),ctrlEl=this.createDropdown(accType,disabled)),ctrlEl&&($(ctrlEl).addClass("control"),$(container).append(ctrlEl));var clearEl=document.createElement("span");clearEl.className="clear",containerEl.appendChild(clearEl)}this.getForm().appendChild(containerEl),this.renderTypes(accType.getDependentTypes())},Renderer.prototype.createContainer=function(accType){var containerEl=document.getElementById(accType.getControlId());return containerEl&&$(containerEl).empty(),containerEl||(containerEl=document.createElement("div")).setAttribute("id",accType.getControlId()),containerEl.className="",accType.getDependsOnTool()&&$(containerEl).addClass("dependency"),containerEl},Renderer.prototype.createLabel=function(accType,reviewMode){var isMultiselect=accType.isMultiSelect(),tagName=isMultiselect?"div":"label",labelEl=document.createElement(reviewMode?"span":tagName);labelEl.className="label",reviewMode||(isMultiselect||labelEl.setAttribute("for",accType.getId()),labelEl.setAttribute("i18n-text",accType.getId())),isMultiselect&&$(labelEl).attr({id:"containerLabel_"+accType.getControlId()});var labelText=document.createTextNode(accType.getLabel()+": ");if(labelEl.appendChild(labelText),isMultiselect){var legendEl=$("<legend></legend");return legendEl.append(labelEl),legendEl}return labelEl},Renderer.prototype.createList=function(accType){var spanEl=document.createElement("span"),valueNames=accType.getSelected().map(function(accValue){return accValue.getLabel()});return $(spanEl).text(valueNames.join(", ")),spanEl},Renderer.prototype.createCheckBox=function(accType,disabled){var accValues=accType.getValues(),trueValue=Util.Array.find(accValues,function(accValue){return"True"==accValue.getName()}),checkbox=document.createElement("input");return checkbox.setAttribute("id",accType.getId()),checkbox.setAttribute("name",accType.getId()),checkbox.setAttribute("type","checkbox"),checkbox.setAttribute("tabindex",0),checkbox.value=trueValue.getCode(),accValues.forEach(function(accValue){accValue.isSelected()&&accValue.getCode()==checkbox.value&&(checkbox.checked=!0)}),disabled&&(checkbox.disabled=!0),YUE.on(checkbox,"click",function(){this.save()}.bind(this)),checkbox},Renderer.prototype.createCheckboxes=function(accType,disabled){function clickEvent(clickedCheckbox,clickedValue){var checkboxes=form[typeId];if(!clickedCheckbox.checked){var defaultValue=accType.getDefault(),defaultCheckbox=null;return $(checkboxes).each(function(idx,checkbox){defaultValue.getCode()==checkbox.value&&(defaultCheckbox=checkbox),checkbox.checked}),void(defaultCheckbox&&(defaultCheckbox.checked=!0))}$(checkboxes).each(function(idx,checkbox){clickedValue.allowCombine()?accs.getValue(checkbox.value).allowCombine()||(checkbox.checked=!1):clickedCheckbox.value!=checkbox.value&&(checkbox.checked=!1)})}var accs=this._accs,form=this.getForm(),typeId=accType.getId(),accValues=accType.getValues(),$valueUl=$("<ul></ul>").addClass("values control"),isDisabled=!accType.isSelectable();return accValues.forEach(function(accValue,i){var $valueLi=$("<li></li>").addClass("value-option"),boxId="valueCb_"+typeId+"_"+i,$valueCb=$("<input />").addClass(accValue.allowCombine()?"allowCombine":"").attr({type:"checkbox",name:typeId,id:boxId,value:accValue.getCode()}).prop({checked:!!accValue.isSelected(),disabled:!!disabled}),$valueLabel=$("<label></label>").html(accValue.getLabel()).addClass(isDisabled?"disabled":"").attr({for:boxId});YUE.on($valueCb[0],"click",function(){clickEvent($valueCb[0],accValue),this.save()}.bind(this)),$valueLi.append($valueCb).append($valueLabel),$valueUl.append($valueLi)}.bind(this)),$valueUl[0]},Renderer.prototype.createDropdown=function(accType,disabled){var accValues=accType.getValues(),select=document.createElement("select");select.id=accType.getId(),select.name=accType.getId(),select.setAttribute("tabindex",0),accType.isMultiSelect()&&select.setAttribute("multiple","multiple");var optIdx=0;return accValues.forEach(function(accValue){if(!accType.isMultiSelect()||"None"!=accValue.getCode()&&-1==accValue.getCode().indexOf("_None")){var optionLabel=accValue.getLabel()||accValue.getCode(),optionValue=accValue.getCode();(select.options[optIdx]=new Option(optionLabel,optionValue)).selected=accValue.isSelected(),optIdx++}}),disabled&&(select.disabled=!0),YUE.on(select,"change",function(){this.save()}.bind(this)),select},Renderer.prototype._saveType=function(accType){var form=this.getForm(),accValues=accType.getValues(),ctrl=form[accType.getId()];if(ctrl)if(accType.isBoolSelect()){var accValue=ctrl.checked?accValues[1]:accValues[0];this._accs.selectCodes(accType.getName(),[accValue.getCode()])}else if(accType.isMultiSelect()){var selectedCodes=[];$(ctrl).each(function(idx,checkbox){checkbox.checked&&selectedCodes.push(checkbox.value)}),this._accs.selectCodes(accType.getName(),selectedCodes)}else this._accs.selectCodes(accType.getName(),[ctrl.value])},Renderer.prototype.save=function(){this._accs.getTypes().forEach(this._saveType.bind(this))},Renderer}(),Accommodations.Dialog=function(){function AccsDialog(accs,parentEl,width,height){this.onCancel=new YAHOO.util.CustomEvent("onCancel",this,!0,YAHOO.util.CustomEvent.FLAT),this.onBeforeSave=new YAHOO.util.CustomEvent("onBeforeSave",this,!0,YAHOO.util.CustomEvent.FLAT),this.onSave=new YAHOO.util.CustomEvent("onSave",this,!0,YAHOO.util.CustomEvent.FLAT),this._parentContainer=YAHOO.util.Dom.get(parentEl),this._yuiDialog=null,this._width=width||350,this._height=height||400,this._accommodations=accs,this._renderer=null}var yuiDialog=null;return AccsDialog.prototype._init=function(){var self=this;YAHOO.util.Dom.setStyle(this._parentContainer,"display","");this._parentContainer.style["overflow-y"]="scroll",yuiDialog=new YAHOO.widget.Dialog(this._parentContainer,{modal:!0,visible:!1,draggable:!1,close:!1,postmethod:"none"}),TDS.Dialog.fixTabIndex(yuiDialog),yuiDialog.cfg.queueProperty("buttons",[{text:"Submit",handler:function(){this.hide(),self.onBeforeSave.fire(self._accommodations),self._renderer.save(),self.onSave.fire(self._accommodations)},isDefault:!0},{text:"Cancel",handler:function(){this.hide(),self.onCancel.fire()}}]),yuiDialog.beforeShowEvent.subscribe(function(){var buttons=yuiDialog.getButtons();buttons[0].set("label",Messages.getAlt("Global.Button.Submit","Submit")),buttons[1].set("label",Messages.getAlt("Global.Button.Cancel","Cancel"))}),this._renderer=new Accommodations.Renderer(this._accommodations)},AccsDialog.prototype.show=function(){yuiDialog||this._init();var el=$("div.bd",yuiDialog.innerElement).get(0);this._renderer.render(el),yuiDialog.render(),yuiDialog.changeContentEvent.fire(),yuiDialog.show()},AccsDialog}(),ItemDurationTimer.startTimerForPage=function(){this.startTime=new Date},ItemDurationTimer.getPageDuration=function(){if(this.startTime){var duration=(new Date).getTime()-this.startTime.getTime();return delete this.startTime,duration}console.log("Timer has not been started for the current page. Cannot retrieve page duration.")};var TDS=window.TDS||{},tds=TDS;!function(TDS){TDS._initialized=!1,TDS.buildNumber=0,TDS.baseUrl="",TDS.messages=null,TDS.globalAccommodations=null,TDS.testeeCheckin=null,TDS.clientStylePath=null,TDS.isProxyLogin=!1,TDS.isDataEntry=!1,TDS.isReadOnly=!1,TDS.isSIRVE=!1,TDS.inPTMode=!1,TDS.showItemScores=!1,TDS.Settings={},TDS.Debug={showExceptions:!1,ignoreForbiddenApps:!1,ignoreBrowserChecks:!1},TDS.init=function(){TDS._initialized||(TDS.Config&&TDS.Config.load(),TDS.messages&&(TDS.messages._getLanguage=TDS.getLanguage,TDS.Messages.Template.processLanguage()),TDS.unloader&&TDS.isProxyLogin&&TDS.unloader.promptToDisablePopupBlocker(),TDS._initialized=!0,Util.log("TDS INIT"))},TDS.getAccommodations=function(){if("object"==typeof LoginShell&&null!=LoginShell.segmentsAccommodations)return LoginShell.segmentsAccommodations[0];if("object"==typeof ContentManager){var page=ContentManager.getCurrentPage();if(page)return page.getAccommodations()}var accommodations=Accommodations.Manager.getCurrent();return accommodations||TDS.globalAccommodations},TDS.getAccs=TDS.getAccommodations,TDS.getAccommodationProperties=function(){var accommodations=TDS.getAccommodations();return new Accommodations.Properties(accommodations)},TDS.getAccProps=TDS.getAccommodationProperties,TDS.getLanguages=function(){return new Accommodations.Properties(TDS.globalAccommodations).getLanguages()},TDS.getLanguage=function(){return TDS.getAccommodationProperties().getLanguage()},TDS.resolveBaseUrl=function(path){var url=TDS.baseUrl+(path||"");return Util.Browser.resolveUrl(url)},TDS.redirect=function(url){TDS.Dialog&&TDS.Dialog.showProgress(),!0!==Util.String.isHttpProtocol(url)&&(url=this.baseUrl+url),setTimeout(function(){top.window.location.href=url},1)},TDS.redirectError=function(key,header,context){var url=TDS.baseUrl+"Pages/Notification.aspx";if(YAHOO.lang.isString(key)){var message=Messages.get(key);url+="?messageKey="+encodeURIComponent(message)}YAHOO.lang.isString(header)&&(url=url+"&header="+encodeURIComponent(header)),YAHOO.lang.isString(context)&&(url=url+"&context="+encodeURIComponent(context)),top.location.href=url},TDS.redirectTestShell=function(pageNum,itemNum){var redirectUrl;redirectUrl=TDS.getAccommodationProperties().isTestShellModern()?"Pages/TestShell.aspx?name=modern":"Pages/TestShell.aspx",pageNum>0&&(redirectUrl+=-1!=redirectUrl.indexOf("?")?"&":"?",redirectUrl+="page="+pageNum),itemNum>0&&(redirectUrl+=-1!=redirectUrl.indexOf("?")?"&":"?",redirectUrl+="item="+itemNum),TDS.unloader.disable(),TDS.redirect(redirectUrl)},TDS.getLoginUrl=function(){var url;return"object"==typeof TDS.Student&&(url=TDS.Student.Storage.getReturnUrl()),null==url&&(url=TDS.baseUrl,url+="Pages/LoginShell.aspx?logout=true"),url},TDS.redirectLogin=function(){var url=TDS.getLoginUrl();TDS.redirect(url)},TDS.logoutProctor=function(onlyLogoutOfTest,redirect){TDS.unloader.disable(),arguments.length<2&&(redirect=!0);var proctor=TDS.Student.Storage.getProctor();if(!proctor)return Util.Promise.defer().promise;var sessionKey=proctor.sessionKey,proctorKey=proctor.proctorKey,proctorLogoutUrl=proctor.returnUrl,loginBrowserKey=proctor.loginBrowserKey,satBrowserKey=proctor.satBrowserKey,promise=TDS.Student.API.logoutProctor(sessionKey,proctorKey,loginBrowserKey,satBrowserKey);return!onlyLogoutOfTest&&proctorLogoutUrl&&(promise=promise.then(function(){return Util.Frame.loadInBackground(proctorLogoutUrl)})),redirect&&promise.then(TDS.redirectLogin),promise},TDS.logout=function(onlyLogProctorOfTest){TDS.unloader.disable(),TDS.isProxyLogin?TDS.logoutProctor(onlyLogProctorOfTest):TDS.redirectLogin()},TDS.getAppSetting=function(name,defaultValue){if(TDS.Config&&TDS.Config.appSettings){var value=TDS.Config.appSettings[name];if(void 0!==value)return value}return defaultValue},TDS.isProctoredAssessmentPreview=function(){return TDS.isProxyLogin&&TDS.inPTMode},YAHOO.util.Event.onDOMReady(TDS.init),YAHOO.util.Event.throwErrors=!0,"object"==typeof Util&&Util.Dom.stopDragEvents()}(window.TDS),TDS.Config=function(TDS,Config){function setStyles(){Config.styles&&Util.Array.each(Config.styles,function(style){YUD.addClass(document.body,style)})}function loadGlobalAccs(){"function"==typeof Accommodations&&(TDS.globalAccommodations=new Accommodations("global"),Config.accs_global&&(TDS.globalAccommodations.importJson(Config.accs_global),TDS.globalAccommodations.selectDefaults()))}function loadTestAccs(){"function"==typeof Accommodations&&("object"==typeof TDS.Student&&(Config.accs_segments=TDS.Student.Storage.getAccJson()),Config.accs_segments&&Config.accs_segments.forEach(function(json){var accommodations=Accommodations.create(json);Accommodations.Manager.add(accommodations)}))}function loadMessages(){if("object"==typeof TDS.Messages){var messageLoader=new TDS.Messages.MessageLoader;Config.messages&&messageLoader.load(Config.messages),TDS.messages=messageLoader.getMessageSystem()}}return YAHOO.lang.augmentObject(Config,{styles:[],accs_global:null,accs_segments:null,messages:null,appSettings:null}),Config.load=function(){setStyles(),loadGlobalAccs(),loadTestAccs(),loadMessages()},Config}(window.TDS,window.TDS.Config||{}),tds.language=function(){function add(xmlLang,itsLang){xmlLookup[xmlLang]=itsLang,itsLookup[itsLang]=xmlLang}function getITSFromXml(xmlLang){return xmlLang&&(xmlLang=xmlLang.toLowerCase()),xmlLookup[xmlLang]}function getXmlFromITS(itsLang){return itsLang&&(itsLang=itsLang.toUpperCase()),itsLookup[itsLang]}function getITSDefault(){var language=Accommodations.Manager.getDefaultProperties().getSelectedCode("Language");return language||DEFAULT_ITS}function getITSAlt(){return getITSDefault()==DEFAULT_ITS?null:DEFAULT_ITS}function hasAttribute(el){return el&&1==el.nodeType&&el.lang}function getAttribute(el){for(;el;){if(hasAttribute(el))return el.lang;el=el.parentElement}return""}function isDividerElement(el){return el&&$(el).hasClass("languagedivider")}function setAttribute(el,lang){el&&null!=lang&&el.setAttribute("lang",lang)}function setITSAttribute(el,itsLang){setAttribute(el,getXmlFromITS(itsLang))}function getDocumentAttribute(){return document.documentElement.lang}function setDocumentAttribute(lang){null!=lang&&(document.documentElement.lang=lang)}var xmlLookup={},itsLookup={},DEFAULT_ITS="ENU";return add("en-us","ENU"),add("es-mx","ESN"),add("haw","HAW"),{getITSFromXml:getITSFromXml,getXmlFromITS:getXmlFromITS,getDefault:function(){return getXmlFromITS(getITSDefault())},getITSDefault:getITSDefault,getAlt:function(){return getXmlFromITS(getITSAlt())},getITSAlt:getITSAlt,getAttribute:getAttribute,getITSAttribute:function(el){var xmlLang=getAttribute(el);return xmlLang?getITSFromXml(xmlLang):xmlLang},setAttribute:setAttribute,setITSAttribute:setITSAttribute,getDocumentAttribute:getDocumentAttribute,getITSDocumentAttribute:function(){var lang=getDocumentAttribute();return lang?getITSFromXml(lang):lang},setDocumentAttribute:setDocumentAttribute,setITSDocumentAttribute:function(itsLang){var lang=getXmlFromITS(itsLang);lang&&setDocumentAttribute(lang)},tagElements:function(el,lang){function swap(currentLang){return currentLang==defaultLang?altLang:defaultLang}function process(currentEl,currentLang){setITSAttribute(currentEl,currentLang),$(currentEl).children().each(function(idx,childEl){isDividerElement(childEl)?currentLang=swap(currentLang):process(childEl,currentLang)})}var defaultLang=getITSDefault(),altLang=getITSAlt();lang||(lang=defaultLang),process(el,lang)}}}(),"object"!=typeof TDS&&(TDS={}),TDS.Diagnostics=function(TDS){function setDebugMode(enabled){debugMode=enabled}function getUrl(name){return TDS.baseUrl+"Pages/API/Global.axd/"+name}function sendRequest(url,callback,data){YAHOO.util.Connect.asyncRequest("POST",url,callback,data)}function logServerError(message,details,completed){if(message)try{message=encodeURIComponent(message),details=details?encodeURIComponent(details):"";var callback={timeout:3e4};"function"==typeof completed&&(callback.success=completed.bind(null,!0),callback.failure=completed.bind(null,!1)),sendRequest(getUrl("LogError"),callback,"message="+message+"&details="+details)}catch(ex){Util.log("logError failed: "+ex.message)}}function getServerDebugDetails(){var details="TDS LOGS: "+Util.getDebugLog();return details+="\n\n"}function getExceptionSummary(stackInfo){var message='JS EXCEPTION: \n "'+stackInfo.message+'"';if("failed"!=stackInfo.mode)try{var urlPieces=stackInfo.stack[0].url.split("/"),urlFile=urlPieces[urlPieces.length-1];urlFile&&(urlFile=-1!=urlFile.toLowerCase().indexOf("scripthandler.axd")?"scripthandler":urlFile.split("?")[0]),message+=" on line "+stackInfo.stack[0].line+" of the file "+urlFile}catch(e){message+=" [error parsing stack]"}return message}function appendDivider(sb){sb.appendLine(DIVIDER)}function appendLoggers(sb){loggers.forEach(function(fn){try{var logStr=fn();logStr&&(sb.appendLine(),sb.appendLine(logStr),sb.appendLine(),sb.appendLine(DIVIDER))}catch(ex){}})}function getExceptionDetails(stackInfo){var details=new Util.StringBuilder;return stackInfo.stack&&stackInfo.stack.length>0&&"failed"!=stackInfo.Name&&stackInfo.stack.forEach(function(frame){if(details.appendFormat("FUNCTION: '{0}' {1} ({2})",frame.func,frame.url,frame.line),details.appendLine(),details.appendLine("CONTEXT:"),frame.context&&frame.context.length>0){var row=0;frame.context.forEach(function(code){"string"==typeof code&&(code.length>80&&(code=code.substring(0,80)),Util.String.endsWith(code,"\n")||(code+="\n")),details.appendFormat("{0}: {1}",++row,code)})}details.appendLine()}),appendDivider(details),appendLoggers(details),details.toString()}var Kit,loggers=[],sendCount=0,sendLimit=10,signatures={},debugMode=!1;"object"==typeof window.CrashKit?Kit=window.CrashKit:"object"==typeof window.TraceKit&&(Kit=window.TraceKit);var DIVIDER="#####";if(Kit&&(Kit.report.subscribe(function(stackInfo){if(stackInfo&&stackInfo.message){if(debugMode){var summary=getExceptionSummary(stackInfo);try{TDS.Dialog.showAlert(summary)}catch(e){alert(summary)}}var stackHash=Util.String.hashCode(stackInfo.message);if(!(signatures[stackHash]||++sendCount>sendLimit)){signatures[stackHash]=!0;var serverDetails,serverMessage="JS EXCEPTION: "+stackInfo.message;try{serverDetails=getExceptionDetails(stackInfo)}catch(ex){serverDetails="JS PARSING ERROR: "+ex.message}logServerError(serverMessage,serverDetails),console.warn(serverDetails)}}}),"object"==typeof window.TraceKit&&window.TraceKit===Kit)){var traceKitWindowOnError=window.onerror;Kit.report.addErrorHandler=function(win){win&&(win.onerror=traceKitWindowOnError)},TraceKit.linesOfContext=5}return $(document).ready(function(){setDebugMode(TDS.Debug.showExceptions)}),{report:function(ex,rethrow){if(Kit){if("string"==typeof ex)try{throw new Error(ex)}catch(ex2){ex=ex2}try{return void Kit.report(ex)}catch(ex){}}if("boolean"!=typeof rethrow||rethrow)throw ex},addErrorHandler:function(win){Kit&&Kit.report.addErrorHandler(win)},logServerError:logServerError,logServerDebug:function(message){!function(message,showID){logServerError("JAVASCRIPT LOG DUMP: "+message,getServerDebugDetails(),showID)}(message=message||"",!1)},showError:setDebugMode.bind(null,!0),registerLogger:function(fn){loggers.push(fn)},appendDivider:appendDivider,appendLoggers:appendLoggers}}(TDS),TDS=window.TDS||{},function(TDS){function onShowDialog(){YUD.addClass(document.body,CSS_SHOWING_DIALOG),TDS.ARIA.hideContent()}function onHideDialog(){YUD.removeClass(document.body,CSS_SHOWING_DIALOG),TDS.ARIA.showContent()}function setProgressMessage(html){html?html+="<br/>":html="",progressDialog.setBody(html)}function hideProgress(){progressDialog.hide()}function showObj(obj){hideProgress();var buttons;(buttons=YAHOO.lang.isArray(obj.buttons)?obj.buttons:[{text:"Global.Label.OK",handler:function(){this.hide()}}]).forEach(function(button){button.text&&(button.text=Messages.getAlt(button.text,button.altText))});var header;header=obj.header?Messages.get(obj.header):"";var html;return obj.text?-1!=(html=obj.altText?Messages.getAlt(obj.text,obj.altText):Messages.get(obj.text)).indexOf("#")&&(html=Messages.parse(html)):html=obj.bodyHtml?obj.bodyHtml:"",dialog.cfg.queueProperty("buttons",buttons),dialog.setHeader(header),dialog.setBody(html),obj.formHtml&&(dialog.form.innerHTML=obj.formHtml,obj.formHandler&&YUE.on(dialog.form,"submit",obj.formHandler)),dialog.render(document.body),dialog.show(),dialog.cfg.setProperty("zindex",1005),dialog}function showDialog(header,message,buttons){return showObj({text:message,header:header,buttons:buttons})}function _showAlert(message,funcOk){showDialog("Global.Label.Warning",message,[{text:"Global.Label.OK",handler:function(){this.hide(),YAHOO.lang.isFunction(funcOk)&&funcOk()}}])}function fixTabIndex(dialog){dialog.beforeShowEvent.subscribe(function(){this.setFirstLastFocusable();for(var i=0;i<dialog.focusableElements.length;i++)dialog.focusableElements[i].setAttribute("tabindex",0)}),dialog.showEvent.subscribe(function(){dialog.focusDefaultButton()}),dialog.beforeShowEvent.subscribe(function(){if(dialog.cfg.getProperty("usearia")){var id=dialog.body.id||YUD.generateId(dialog.body);dialog.cfg.setProperty("describedby",id)}})}var CSS_SHOWING_DIALOG="showingDialog",progressDialog=new YAHOO.widget.Panel("yuiProgressDialog",{width:"240px",fixedcenter:!0,close:!1,draggable:!1,modal:!0,visible:!1});progressDialog.showEvent.subscribe(function(){YUD.addClass(document.body,"showingLoading")}),progressDialog.hideEvent.subscribe(function(){YUD.removeClass(document.body,"showingLoading")});var dialog=new YAHOO.widget.SimpleDialog("yuiSimpleDialog",{width:"250px",fixedcenter:!0,modal:!0,visible:!1,draggable:!1,close:!1,postmethod:"none",usearia:!0,role:"dialog"});dialog.showEvent.subscribe(onShowDialog),dialog.hideEvent.subscribe(onHideDialog),fixTabIndex(dialog),TDS.Dialog={showProgress:function(message){progressDialog.setHeader(Messages.get("Global.Label.PleaseWait")),progressDialog.render(document.body),progressDialog.show(),progressDialog.cfg.setProperty("zindex",1004),setProgressMessage(message)},hideProgress:hideProgress,showObj:showObj,show:showDialog,showPrompt:function(message,funcYes,funcNo){return showDialog("Global.Label.Warning",message,[{text:"Global.Label.Yes",handler:function(){this.hide(),YAHOO.lang.isFunction(funcYes)&&funcYes()},isDefault:!0},{text:"Global.Label.No",handler:function(){this.hide(),YAHOO.lang.isFunction(funcNo)&&funcNo()}}])},showAlert:function(message,funcOk){_showAlert(message,funcOk)},showWarning:function(message,funcOk){_showAlert(message,funcOk)},showInput:function(message,cb){var getDialogInput=function(){return Util.Dom.getElementByClassName("tds-dialogInput","input",dialog.form)},handleOk=function(){if(dialog.hide(),YAHOO.lang.isFunction(cb)){var dialogInput=getDialogInput();dialogInput&&cb(dialogInput.value)}};showObj({header:"&nbsp;",bodyHtml:'<span class="tds-dialogMessage">'+message+"</span>",formHtml:'<input class="tds-dialogInput" type="text"></input>',formHandler:handleOk,buttons:[{text:"Global.Label.Ok",altText:"Ok",handler:handleOk},{text:"Global.Label.Cancel",altText:"Cancel",handler:function(){dialog.hide()},isDefault:!0}]});var dialogInput=getDialogInput();dialogInput&&setTimeout(function(){dialogInput.focus()},0)},fixTabIndex:fixTabIndex,fixTabLoop:function(dialog,fixFormElements){if(dialog.setFirstLastFocusable(),dialog.setTabLoop(dialog.firstElement,dialog.lastElement),fixFormElements&&(dialog.firstFormElement=dialog.firstElement,dialog.lastFormElement=dialog.lastElement),Util.Browser.isFirefox()){var dialogEl=$(dialog.innerElement),closeBtn=dialogEl.find("a").get(0);closeBtn&&$(closeBtn).on("focus",function(e){var frameEl=dialogEl.find("iframe").get(0);if(frameEl){var frameDoc=Util.Dom.getFrameContentDocument(frameEl);frameDoc&&frameDoc.activeElement&&Util.Dom.blur(frameDoc.activeElement)}})}},isAccessible:function(){var accProps=Accommodations.Manager.getCurrentProps();return accProps&&accProps.isStreamlinedMode()},onShow:onShowDialog,onHide:onHideDialog}}(TDS),window.TDS=window.TDS||{},function(TDS){var TM={_timeout:120,_overlayManager:new YAHOO.widget.OverlayManager,_container:null,Events:new Util.EventManager};TM.makeResize=function(panel){var mask=panel.getMask(),frame=panel.getFrame(),IE_QUIRKS=YAHOO.env.ua.ie&&"BackCompat"==document.compatMode,IE_SYNC=6==YAHOO.env.ua.ie||7==YAHOO.env.ua.ie&&IE_QUIRKS,resize=new YAHOO.util.Resize(panel.id,{autoRatio:!1,minWidth:300,minHeight:100,status:!1,proxy:!0,hover:!0});6==YAHOO.env.ua.ie&&(YUD.setStyle(resize._handles.r,"height",panel.element.offsetHeight-5+"px"),resize.on("startResize",function(){YUD.setStyle(mask,"height",panel.body.offsetHeight+"px"),YUD.setStyle(mask,"width",panel.body.offsetWidth+"px")})),resize.on("resize",function(args){var panelHeight=args.height,panelWidth=args.width;panelHeight||(panelHeight=resize._cache.height),panelWidth||(panelWidth=resize._cache.width);var bodyHeight=panelHeight-(this.header?this.header.offsetHeight:0)-(this.footer?this.footer.offsetHeight:0),bodyContentHeight=IE_QUIRKS?bodyHeight:bodyHeight-20,bodyContentWidth=IE_QUIRKS?panelWidth:panelWidth-20;YUD.setStyle(this.body,"height",bodyContentHeight+"px"),YUD.setStyle(this.body,"width",bodyContentWidth+"px"),6==YAHOO.env.ua.ie&&(YUD.setStyle(resize._handles.r,"height",this.element.offsetHeight-5+"px"),YUD.setStyle(mask,"height",bodyHeight+"px"),YUD.setStyle(mask,"width",panelWidth+"px"),YUD.setStyle(frame,"height",bodyContentHeight+"px"),YUD.setStyle(frame,"width",bodyContentWidth+"px")),IE_SYNC&&(this.sizeUnderlay(),this.syncIframe())},panel,!0)},TM.bottomLeft=function(dialog){dialog.refresh();dialog.element.offsetWidth;var x,y,elementHeight=dialog.element.offsetHeight,viewPortHeight=(YUD.getViewportWidth(),YUD.getViewportHeight());x=10+YUD.getDocumentScrollLeft();var footerOffset=YUD.get("foot")?YUD.get("foot").offsetHeight:0;y=elementHeight+footerOffset<viewPortHeight?viewPortHeight-elementHeight-footerOffset+YUD.getDocumentScrollTop():10+YUD.getDocumentScrollTop(),dialog.cfg.setProperty("xy",[parseInt(x,10),parseInt(y,10)]),dialog.cfg.refireEvent("iframe"),YAHOO.env.ua.webkit&&dialog.forceContainerRedraw()},TM.init=function(){TM._container=YUD.get("tools"),TM._container||(TM._container=HTML.DIV({id:"tools"}),document.body.appendChild(TM._container)),TM.Events.fire("init")},TM.createPanel=function(id,name,header,footer,key,resize){var panel=new YAHOO.widget.Dialog(id,{draggable:!0,constraintoviewport:!0,modal:!1,close:!0,underlay:"none",visible:!1,zindex:998}),htmlBody=[];if(htmlBody.push('<iframe id="frame-'+id+'" frameborder="0" title="'+header+'" marginheight="0" marginwidth="0" height="100%" width="100%"></iframe>'),TDS.Dialog.isAccessible()){var msgEndLink=Messages.getAlt("TDSDialog.Label.EndLink","End of the dialog");htmlBody.push('<a href="#" tabindex="0" role="presentation" class="yui-panel-bottom">'+msgEndLink+"</a>")}return htmlBody.push('<div class="yui-panel-mask"></div>'),header&&panel.setHeader(header),panel.setBody(htmlBody.join("")),footer&&panel.setFooter(footer),panel.getFrame=function(){return this.element.getElementsByTagName("iframe")[0]},panel.getMask=function(){return YUD.getElementsByClassName("yui-panel-mask","div",panel.element)[0]},panel.getBottomElement=function(){return $(panel.innerElement).find("a.yui-panel-bottom")},panel.isShowing=function(){return TM.isShowing(id)},panel.load=function(){TM.loadKey(panel,key)},panel.renderEvent.subscribe(function(){panel.dd.useShim=!0,YUD.addClass(panel.innerElement,"tool");var $closeButton=$(panel.innerElement).find(".container-close");$closeButton.detach(),$closeButton.insertBefore($(panel.innerElement).find("h2"));var className="tool-"+name;YUD.addClass(panel.innerElement,className),panel.innerElement&&panel.innerElement.parentNode&&YUD.addClass(panel.innerElement.parentNode,className+"-container"),panel.load(),TDS.Dialog.isAccessible()&&TDS.Dialog.fixTabLoop(panel,!0)},panel,!0),panel.refresh=function(){panel.cfg.setProperty("width",YUD.getStyle(panel.innerElement,"width")),panel.cfg.setProperty("height",YUD.getStyle(panel.innerElement,"height"))},TM.Events.fire("onCreating",panel),panel.render(TM._container),TM.bottomLeft(panel),resize&&TM.makeResize(panel),panel.beforeShowEvent.subscribe(function(){panel.refresh()}),panel.showEvent.subscribe(function(){TM.Events.fire("onShow",panel),TDS.ARIA.hideContent(),setTimeout(function(){TM._overlayManager.focus(panel)},0)}),panel.beforeHideEvent.subscribe(function(){Util.Browser.isSecure()&&!Util.Browser.isMac()&&Util.SecureBrowser.fixFocus()}),panel.hideEvent.subscribe(function(){TM.Events.fire("onHide",panel),TDS.ARIA.showContent(),Util.Dom.focusWindow(2)}),TM._overlayManager.register(panel),TM.Events.fire("onCreated",panel),panel},TM.loadFrameUrl=function(container,frame,url,success,abort){function loadFrame(){YUD.addClass(container,"yui-panel-loading"),YUE.addListener(frame,"load",onFrameLoaded),timer=YAHOO.lang.later(1e3*TM._timeout,this,onFrameAborted),frame.src=url}function disableContextMenu(iframe){Util.Browser.isChromeOS()&&$(Util.Frame.getFrames(iframe)).each(function(){$(this).contents().on("contextmenu",function(){return!1})})}function onFrameLoaded(){Util.log("tool load: "+url),YUD.removeClass(container,"yui-panel-loading"),timer&&timer.cancel(),YUE.removeListener(frame,"load",onFrameLoaded);var frameDoc=Util.Dom.getFrameContentDocument(frame);disableContextMenu(frame);var allowAccess=!0;try{frameDoc.URL}catch(ex){allowAccess=!1}if(allowAccess){if(""==frame.src||"about:blank"==frameDoc.URL)return;KeyManager.attachListener(frameDoc),Util.Dom.copyCSSFrame(frame)}YAHOO.lang.isFunction(success)&&success(frameDoc,allowAccess)}function onFrameAborted(){Util.log("tool abort: "+url),YUD.removeClass(container,"yui-panel-loading"),YUE.removeListener(frame,"load",onFrameLoaded);var frameWin=Util.Dom.getFrameContentWindow(frame);try{frameWin.stop()}catch(ex){}YAHOO.lang.isFunction(abort)&&abort();frame.src=Util.Frame.BLANK_SOURCE,Util.Frame.writeContent(frame,'Timeout occured loading content. <a href="#" id="reload">Click here to reload</a>');var frameDoc=Util.Dom.getFrameContentDocument(frame);YUE.addListener(frameDoc.getElementById("reload"),"click",function(ev){YUE.stopEvent(ev),loadFrame()})}var timer=null;loadFrame()},TM.loadUrl=function(panel,url,fn){var frame=panel.getFrame();TM.loadFrameUrl(panel.element,frame,url,function(){TM.Events.fire("onLoaded",panel),YAHOO.lang.isFunction(fn)&&fn()})},TM.loadFrameKey=function(container,frame,messageKey,fn){if(messageKey){var url;url=Messages.has(messageKey)?Messages.get(messageKey):messageKey,Util.String.isHttpProtocol(url)||(url=TDS.baseUrl+"Pages/"+url),TM.loadFrameUrl(container,frame,url,fn)}},TM.loadKey=function(panel,messageKey){var frame=panel.getFrame();TM.loadFrameKey(panel.element,frame,messageKey,function(){TM.Events.fire("onLoaded",panel)},function(){TM.Events.fire("onFailed",panel)})},TM.get=function(id){return TM._overlayManager.find(id)},TM.getAll=function(){return TM._overlayManager.overlays},TM.isShowing=function(id){var panel=TM.get(id);return!!panel&&panel.cfg.getProperty("visible")},TM.hide=function(id){var panel=TM.get(id);panel&&panel.hide()},TM.hideAll=function(){TM._overlayManager.hideAll()},TM.show=function(id){var panel=TM.get(id);panel&&(TM.hideAll(),panel.show())},TM.toggle=function(id){var panel=TM.get(id);panel&&(TM.isShowing(panel)?TM.hide(panel):(TM.show(panel),setTimeout(function(){panel.getFrame().focus()},0)))},TM.Events.subscribe("onLoaded",function(panel){var panelFrame=panel.getFrame(),panelDoc=Util.Dom.getFrameContentDocument(panelFrame);YUD.batch(panelDoc.getElementsByTagName("a"),function(link){if(0!=link.href.length){var targetID=link.hash.substring(1);if(0!=targetID.length){var target=panelDoc.getElementById(targetID);null!=target&&YUE.on(link,"click",function(evt){YUE.stopEvent(evt),target.scrollIntoView(),window.scrollTo(0,0)})}}})}),TDS.ToolManager=TM,YUE.onDOMReady(function(){TM.init();var panel=TM.createPanel("panel-hack","hack","Header","Footer");YUD.setStyle(panel.element,"display","none")})}(window.TDS);var KeyEventResult={Ignored:0,Stop:1,Matched:2,Allow:3},KeyManager={onKeyEvent:new YAHOO.util.CustomEvent("onGlobalKeyEvent",KeyManager,!1,YAHOO.util.CustomEvent.FLAT),isInit:!1,isWindows:!1,isMac:!1,isUnix:!1,attachListener:function(doc){YAHOO.util.Event.addListener(doc,"keyup",this._onKeyUpDown,this,!0),YAHOO.util.Event.addListener(doc,"keydown",this._onKeyUpDown,this,!0),YAHOO.util.Event.addListener(doc,"keypress",this._onKeyPress,this,!0)},preinit:function(){if(-1!=navigator.platform.indexOf("Windows")||-1!=navigator.platform.indexOf("Win32")||-1!=navigator.platform.indexOf("Win64")?this.isWindows=!0:-1!=navigator.platform.indexOf("Macintosh")||-1!=navigator.platform.indexOf("MacPPC")||-1!=navigator.platform.indexOf("MacIntel")?this.isMac=!0:-1==navigator.platform.indexOf("X11")&&-1==navigator.platform.indexOf("Linux")&&-1==navigator.platform.indexOf("BSD")||(this.isUnix=!0),this._lastUpDownType={},!this._identifierToKeyCodeMap){this._identifierToKeyCodeMap={};for(var key in this._keyCodeToIdentifierMap)this._identifierToKeyCodeMap[this._keyCodeToIdentifierMap[key]]=parseInt(key,10);for(var key in this._specialCharCodeMap)this._identifierToKeyCodeMap[this._specialCharCodeMap[key]]=parseInt(key,10)}YAHOO.env.ua.ie?this._charCode2KeyCode={13:13,27:27}:YAHOO.env.ua.gecko?this._keyCodeFix={12:this._identifierToKeyCode("NumLock")}:YAHOO.env.ua.webkit&&(YAHOO.env.ua.webkit<525.13?this._charCode2KeyCode={63289:this._identifierToKeyCode("NumLock"),63276:this._identifierToKeyCode("PageUp"),63277:this._identifierToKeyCode("PageDown"),63275:this._identifierToKeyCode("End"),63273:this._identifierToKeyCode("Home"),63234:this._identifierToKeyCode("Left"),63232:this._identifierToKeyCode("Up"),63235:this._identifierToKeyCode("Right"),63233:this._identifierToKeyCode("Down"),63272:this._identifierToKeyCode("Delete"),63302:this._identifierToKeyCode("Insert"),63236:this._identifierToKeyCode("F1"),63237:this._identifierToKeyCode("F2"),63238:this._identifierToKeyCode("F3"),63239:this._identifierToKeyCode("F4"),63240:this._identifierToKeyCode("F5"),63241:this._identifierToKeyCode("F6"),63242:this._identifierToKeyCode("F7"),63243:this._identifierToKeyCode("F8"),63244:this._identifierToKeyCode("F9"),63245:this._identifierToKeyCode("F10"),63246:this._identifierToKeyCode("F11"),63247:this._identifierToKeyCode("F12"),63248:this._identifierToKeyCode("PrintScreen"),3:this._identifierToKeyCode("Enter"),12:this._identifierToKeyCode("NumLock"),13:this._identifierToKeyCode("Enter")}:this._charCode2KeyCode={13:13,27:27})},init:function(el){this.preinit(),"object"!=typeof el&&(el=YAHOO.env.ua.gecko?window:document),this.attachListener(el),this.isInit=!0,Util.log("keyboard: init")},isValidKeyIdentifier:function(keyIdentifier){if(this._identifierToKeyCodeMap[keyIdentifier])return!0;if(1!=keyIdentifier.length)return!1;if(keyIdentifier>="0"&&keyIdentifier<="9")return!0;if(keyIdentifier>="A"&&keyIdentifier<="Z")return!0;switch(keyIdentifier){case"+":case"-":case"*":case"/":return!0;default:return!1}},__keyEvents:{keyup:1,keydown:1,keypress:1,keyinput:1},_onKeyUpDown:function(domEvent){if(this.isInit)if(YAHOO.env.ua.ie){var keyCode=(domEvent=window.event||domEvent).keyCode,charCode=0,type=domEvent.type;"keydown"==this._lastUpDownType[keyCode]&&"keydown"==type||this._idealKeyHandler(keyCode,charCode,type,domEvent),"keydown"==type&&(this._isNonPrintableKeyCode(keyCode)||8==keyCode||9==keyCode)&&this._idealKeyHandler(keyCode,charCode,"keypress",domEvent),this._lastUpDownType[keyCode]=type}else if(YAHOO.env.ua.gecko){var keyCode=this._keyCodeFix[domEvent.keyCode]||domEvent.keyCode,charCode=domEvent.charCode,type=domEvent.type;if(this.isWindows){var keyIdentifier=keyCode?this._keyCodeToIdentifier(keyCode):this._charCodeToIdentifier(charCode);"keypress"==this._lastUpDownType[keyIdentifier]&&"keydown"==type||this._idealKeyHandler(keyCode,charCode,type,domEvent),this._lastUpDownType[keyIdentifier]=type}else this._idealKeyHandler(keyCode,charCode,type,domEvent)}else if(YAHOO.env.ua.webkit){var keyCode=0,charCode=0,type=domEvent.type;if(YAHOO.env.ua.webkit<525.13){if(YAHOO.env.ua.webkit>420){if(this._lastCharCodeForType||(this._lastCharCodeForType={}),this._lastCharCodeForType[type]>63e3)return void(this._lastCharCodeForType[type]=null);this._lastCharCodeForType[type]=domEvent.charCode}"keyup"==type||"keydown"==type?keyCode=3!=domEvent.charCode&&13!=domEvent.charCode||"Enter"==domEvent.keyIdentifier?this._charCode2KeyCode[domEvent.charCode]||domEvent.keyCode:domEvent.keyCode:this._charCode2KeyCode[domEvent.charCode]?keyCode=this._charCode2KeyCode[domEvent.charCode]:charCode=domEvent.charCode,this._idealKeyHandler(keyCode,charCode,type,domEvent)}else keyCode=domEvent.keyCode,"keydown"==this._lastUpDownType[keyCode]&&"keydown"==type||this._idealKeyHandler(keyCode,charCode,type,domEvent),"keydown"==type&&((this._isNonPrintableKeyCode(keyCode)||8==keyCode||9==keyCode)&&this._idealKeyHandler(keyCode,charCode,"keypress",domEvent),!Util.Browser.isChromeOS()||90!=keyCode&&166!=keyCode&&167!=keyCode||this._idealKeyHandler(keyCode,charCode,"keydown",domEvent)),this._lastUpDownType[keyCode]=type}else YAHOO.env.ua.opera&&this._idealKeyHandler(domEvent.keyCode,0,domEvent.type,domEvent)},_onKeyPress:function(domEvent){if(this.isInit)if(YAHOO.env.ua.ie)domEvent=window.event||domEvent,this._charCode2KeyCode[domEvent.keyCode]?this._idealKeyHandler(this._charCode2KeyCode[domEvent.keyCode],0,domEvent.type,domEvent):this._idealKeyHandler(0,domEvent.keyCode,domEvent.type,domEvent);else if(YAHOO.env.ua.gecko){var keyCode=this._keyCodeFix[domEvent.keyCode]||domEvent.keyCode,charCode=domEvent.charCode,type=domEvent.type;if(this.isWindows){var keyIdentifier=keyCode?this._keyCodeToIdentifier(keyCode):this._charCodeToIdentifier(charCode);"keypress"==this._lastUpDownType[keyIdentifier]&&"keydown"==type||this._idealKeyHandler(keyCode,charCode,type,domEvent),this._lastUpDownType[keyIdentifier]=type}else this._idealKeyHandler(keyCode,charCode,type,domEvent)}else if(YAHOO.env.ua.webkit)if(YAHOO.env.ua.webkit<525.13){var keyCode=0,charCode=0,type=domEvent.type;if(!YAHOO.env.ua.webkit>420){if(this._lastCharCodeForType||(this._lastCharCodeForType={}),this._lastCharCodeForType[type]>63e3)return void(this._lastCharCodeForType[type]=null);this._lastCharCodeForType[type]=domEvent.charCode}"keyup"==type||"keydown"==type?keyCode=this._charCode2KeyCode[domEvent.charCode]||domEvent.keyCode:this._charCode2KeyCode[domEvent.charCode]?keyCode=this._charCode2KeyCode[domEvent.charCode]:charCode=domEvent.charCode,this._idealKeyHandler(keyCode,charCode,type,domEvent)}else this._charCode2KeyCode[domEvent.keyCode]?this._idealKeyHandler(this._charCode2KeyCode[domEvent.keyCode],0,domEvent.type,domEvent):this._idealKeyHandler(0,domEvent.keyCode,domEvent.type,domEvent);else YAHOO.env.ua.opera&&(this._keyCodeToIdentifierMap[domEvent.keyCode]?this._idealKeyHandler(domEvent.keyCode,0,domEvent.type,domEvent):this._idealKeyHandler(0,domEvent.keyCode,domEvent.type,domEvent))},_idealKeyHandler:function(keyCode,charCode,eventType,domEvent){if(keyCode||charCode){var keyIdentifier;keyCode?onglobalkeyevent(domEvent,eventType,keyIdentifier=this._keyCodeToIdentifier(keyCode),keyCode,charCode):onglobalkeyevent(domEvent,"keypress",keyIdentifier=this._charCodeToIdentifier(charCode),keyCode,charCode);var cancelled=0==domEvent.returnValue;"keydown"==eventType&&cancelled&&(YAHOO.env.ua.webkit>=525.13||YAHOO.env.ua.ie)&&(this._isNonPrintableKeyCode(keyCode)||8==keyCode||9==keyCode||(!domEvent.shiftKey&&0==charCode&&this._IEkeyCodeToIdentifierMap[keyCode]?keyIdentifier=this._IEkeyCodeToIdentifierMap[keyCode]:domEvent.shiftKey&&0==keyIdentifier&&this._IEShiftkeyCodeToIdentifierMap[keyCode]&&(keyIdentifier=this._IEShiftkeyCodeToIdentifierMap[keyCode]),onglobalkeyevent(domEvent,"keypress",keyIdentifier,keyCode,charCode)))}},_specialCharCodeMap:{8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space"},_keyCodeToIdentifierMap:{16:"Shift",17:"Control",18:"Alt",20:"CapsLock",224:"Meta",37:"Left",38:"Up",39:"Right",40:"Down",33:"PageUp",34:"PageDown",35:"End",36:"Home",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",44:"PrintScreen",145:"Scroll",19:"Pause",91:"Win",93:"Apps"},_IEkeyCodeToIdentifierMap:{186:";",187:"=",188:",",190:".",191:"/",219:"[",220:"\\",221:"]",222:"'"},_IEShiftkeyCodeToIdentifierMap:{48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",186:":",187:"+",188:"<",190:">",191:"?",219:"{",220:"|",221:"}",222:'"'},_numpadToCharCode:{96:"0".charCodeAt(0),97:"1".charCodeAt(0),98:"2".charCodeAt(0),99:"3".charCodeAt(0),100:"4".charCodeAt(0),101:"5".charCodeAt(0),102:"6".charCodeAt(0),103:"7".charCodeAt(0),104:"8".charCodeAt(0),105:"9".charCodeAt(0),106:"*".charCodeAt(0),107:"+".charCodeAt(0),109:"-".charCodeAt(0),110:",".charCodeAt(0),111:"/".charCodeAt(0)},_charCodeA:"A".charCodeAt(0),_charCodeZ:"Z".charCodeAt(0),_charCode0:"0".charCodeAt(0),_charCode9:"9".charCodeAt(0),_isNonPrintableKeyCode:function(keyCode){return!!this._keyCodeToIdentifierMap[keyCode]},_isIdentifiableKeyCode:function(keyCode){return keyCode>=this._charCodeA&&keyCode<=this._charCodeZ||(keyCode>=this._charCode0&&keyCode<=this._charCode9||(!!this._specialCharCodeMap[keyCode]||(!!this._numpadToCharCode[keyCode]||!!this._isNonPrintableKeyCode(keyCode))))},_keyCodeToIdentifier:function(keyCode){if(this._isIdentifiableKeyCode(keyCode)){var numPadKeyCode=this._numpadToCharCode[keyCode];return numPadKeyCode?String.fromCharCode(numPadKeyCode):this._keyCodeToIdentifierMap[keyCode]||this._specialCharCodeMap[keyCode]||String.fromCharCode(keyCode)}return"Unidentified"},_charCodeToIdentifier:function(charCode){return this._specialCharCodeMap[charCode]||String.fromCharCode(charCode).toUpperCase()},_identifierToKeyCode:function(keyIdentifier){return this._identifierToKeyCodeMap[keyIdentifier]||keyIdentifier.charCodeAt(0)}};"object"!=typeof TDS&&(TDS={}),TDS.Button={},TDS.Button.init=function(){var spans=YUD.getElementsByClassName("tds-button","span");YUD.batch(spans,this.processButtonSpan)},TDS.Button.processButtonSpan=function(buttonSpan){var button=buttonSpan.getElementsByTagName("button")[0];YUE.on(button,"focus",function(el){YUD.addClass(buttonSpan,"tds-button-focus")}),YUE.on(button,"blur",function(el){YUD.removeClass(buttonSpan,"tds-button-focus")}),YUE.on(button,"mouseover",function(el){YUD.addClass(buttonSpan,"tds-button-hover")}),YUE.on(button,"mouseout",function(el){YUD.removeClass(buttonSpan,"tds-button-hover")})},window.TDS=window.TDS||{},TDS.ARIA=function(){function getStatus(container){var statusEl=$(container).children(".startContent")[0];if(!statusEl){statusEl=$('<div tabindex="-1" class="startContent">Beginning of Content</div>').prependTo(container)[0]}return statusEl}var aria={};return aria.setStatus=function(container,msg){var statusEl=getStatus(container);return $(statusEl).text(msg),statusEl},aria.hideContent=function(){$(".tds-ot-wrapper, #topBar, #contents, #btnNextBottom").attr("aria-hidden","true")},aria.showContent=function(){$(".tds-ot-wrapper, #topBar, #contents, #btnNextBottom").attr("aria-hidden","false")},aria}(),window.tds=window.tds||{},tds.PromiseTimer=function(){function log(msg){debug&&console.log("Timer: %s",msg)}function Timer(interval,timeout){this._interval=interval||0,this._timeout=timeout||0,this._promiseFactory=null,this._enabled=!1,this._waiting=!1,this._running=!1,this._id=null}var debug=!1;return Timer.prototype.isEnabled=function(){return this._enabled},Timer.prototype.isWaiting=function(){return this._waiting},Timer.prototype.isRunning=function(){return this._running},Timer.prototype._setTimeout=function(){this._clearTimeout(),this._enabled&&!this._running&&(log("timer start"),this._waiting=!0,this._id=setTimeout(this._onTick.bind(this),this._interval))},Timer.prototype._clearTimeout=function(){this._id&&(log("timer stop"),clearTimeout(this._id),this._id=null)},Timer.prototype._onTick=function(){log("timer ready"),this._waiting=!1,this._exec()},Timer.prototype._exec=function(){if(this._clearTimeout(),this._running)return!1;log("promise start"),this._running=!0;var promise=null;try{promise=this._promiseFactory()}catch(ex){console.warn("Error calling promise factory. ",ex)}return promise=Util.Promise.when(promise),this._timeout>0&&(promise=promise.timeout(this._timeout)),promise.finally(this._execDone.bind(this)),!0},Timer.prototype._execDone=function(){log("promise done"),this._running=!1,this._setTimeout()},Timer.prototype.start=function(promiseFactory){if("function"!=typeof promiseFactory)throw new Error("Timer must be started with a promise factory function.");return this._promiseFactory=promiseFactory,!this._enabled&&0!=this._interval&&(this._enabled=!0,this._setTimeout(),!0)},Timer.prototype.stop=function(){return!!this._enabled&&(this._promiseFactory=null,this._enabled=!1,this._clearTimeout(),!0)},Object.defineProperty(Timer,"debug",{get:function(){return debug},set:function(value){debug="boolean"==typeof value&&value}}),Timer}(),"object"!=typeof TDS&&(TDS={}),TDS.XhrManager=function(Util){function TDSXhr(opt_timeoutInterval,opt_maxRetries,opt_scope){TDSXhr.superclass.constructor.call(this,opt_timeoutInterval,opt_maxRetries,opt_scope),this.Events.subscribe("onRequest",function(request){var config=request.getArgs();config&&config.showProgress&&this.Events.fire("onShowProgress")}),this.Events.subscribe("onComplete",function(request){var config=request.getArgs();config&&config.showProgress&&this.Events.fire("onHideProgress")}),this.Events.subscribe("onComplete",checkIfValid)}function checkIfValid(request){if(request.isSuccess())return!0;var config=request.getArgs();if(config&&!config.showDialog)return!0;var errorMessage,json=request.getResponseJson();errorMessage=json&&json.replyText?json.replyText:TDSXhr.defaultErrorMessage;var retriable=config&&config.allowRetry&&request.allowRetry(),logout=config&&config.forceLogout;return this.Events.fire("onError",request,errorMessage,retriable,logout),!1}return YAHOO.extend(TDSXhr,Util.XhrManager),TDSXhr.defaultErrorMessage="There was a problem with your request.",TDSXhr.JsonReply={OK:0,Error:1,Denied:2,ReturnStatus:3},TDSXhr.prototype.getUrl=function(action,data){return null},TDSXhr.prototype.createAction=function(action,data,callback,customConfig,parameters){var url=this.getUrl(action,data);(parameters=parameters||{}).timestamp=Util.Date.now();var querystring=Util.QueryString.stringify(parameters);url+=(-1==url.indexOf("?")?"?":"&")+querystring;var content=null;YAHOO.lang.isString(data)?content=data:YAHOO.lang.isObject(data)&&(content=Util.QueryString.stringify(data));var request=this.createRequest(action,url,"POST",content,function(request){var json=request.getResponseJson();YAHOO.lang.isObject(json)&&YAHOO.lang.isFunction(callback)&&callback(json.data,json)}),config={showProgress:!0,showDialog:!0,showError:!1,allowRetry:!0,forceLogout:!0};return YAHOO.lang.isObject(customConfig)&&(config=YAHOO.lang.merge(config,customConfig)),request.setArgs(config),request},TDSXhr.prototype.sendAction=function(action,data,callback,customConfig,parameters){var request=this.createAction(action,data,callback,customConfig,parameters);try{this.sendRequest(request)}catch(ex){TDS.Diagnostics.report(ex)}},TDSXhr.prototype.sendPromise=function(action,postData,queryData,customConfig){var url=this.getUrl(action,postData);(queryData=queryData||{}).timestamp=Util.Date.now();var qs=Util.QueryString.stringify(queryData);url+=(-1==url.indexOf("?")?"?":"&")+qs;var config={showProgress:!0,showDialog:!0,showError:!1,allowRetry:!0,forceLogout:!0,plainJson:!1};YAHOO.lang.isObject(customConfig)&&(config=YAHOO.lang.merge(config,customConfig));var content=null;config.plainJson&&YAHOO.lang.isObject(postData)?config=JSON.stringify(postData):YAHOO.lang.isString(postData)?content=postData:YAHOO.lang.isObject(postData)&&(content=Util.QueryString.stringify(postData));var defered=Util.Promise.defer(),request=this.createRequest(action,url,"POST",content,function(request){var json=request.getResponseJson();request.isSuccess()&&YAHOO.lang.isObject(json)?config.plainJson?defered.resolve(json):defered.resolve(json.data):defered.reject(request)});return request.setArgs(config),this.sendRequest(request),defered.promise},TDSXhr}(window.Util),window.tds=window.tds||{},tds.XhrBatch=function(){function Request(action,data,deferred){this.action=action,this.data=data,this.deferred=deferred}function Requests(){this._list=[],this._locked=!1}function XhrBatch(batchUrl,timeout,xhrInterface){this._url=batchUrl,this._xhrTimeout=timeout,this._xhrInterface=xhrInterface||xhrJquery}Request.prototype.dispose=function(){this.action=void 0,this.data=void 0,this.deferred&&(this.deferred.promise.isPending()&&this.deferred.reject(),this.deferred=void 0)},Requests.prototype.lock=function(){this._locked=!0},Requests.prototype.unlock=function(){this._locked=!1},Object.defineProperty(Requests.prototype,"locked",{get:function(){return this._locked}}),Object.defineProperty(Requests.prototype,"empty",{get:function(){return 0==this._list.length}}),Requests.prototype.add=function(action,data){if(this._locked)throw new Error("Requests collection is locked");var deferred=Util.Promise.defer();return this._list.push(new Request(action,data,deferred)),deferred.promise},Requests.prototype.list=function(){return this._list},Requests.prototype.resolveAll=function(){this._list.forEach(function(request){request.deferred.resolve()})},Requests.prototype.rejectAll=function(){this._list.forEach(function(request){request.deferred.reject()})},Requests.prototype.reset=function(){this._locked=!1,this._list.forEach(function(request){request.dispose()}),this._list=[]},Requests.prototype.toJSON=function(){var json={requests:this._list.map(function(request){return{action:request.action,data:request.data}})};return JSON.stringify(json)},Requests.prototype.getAPI=function(){return{add:this.add.bind(this)}};var xhrJquery={send:function(url,json,timeout){return Q($.ajax({type:"POST",url:url,contentType:"application/json; charset=utf-8",dataType:"json",data:json,timeout:timeout}))}};return XhrBatch.prototype.send=function(requests){if(requests.empty)return Util.Promise.when([]);var json=requests.toJSON(),xhrPromise=this._xhrInterface.send(this._url,json,this._timeout),sendDeferred=Util.Promise.defer();return xhrPromise.then(this._onSuccess.bind(this,requests,sendDeferred),this._onError.bind(this,requests,sendDeferred)),sendDeferred.promise},XhrBatch.prototype._onSuccess=function(requests,sendDeferred,json){var responses=json.responses;if("object"==typeof responses){var groups=requests.list().map(function(request,idx){return{request:request,response:responses[idx]}});this._processResponses(groups);var publicGroups=groups.map(function(group){var request=group.request,response=group.response;return{action:request.action,request:request.data,response:response?response.data:void 0,error:!!response&&response.error}});sendDeferred.resolve(publicGroups)}else this._onError(requests,sendDeferred,null)},XhrBatch.prototype._onError=function(requests,sendDeferred,jqXhr){requests.rejectAll(),sendDeferred.reject(jqXhr)},XhrBatch.prototype._processResponses=function(groups){groups.forEach(function(group){var request=group.request,response=group.response,data=response?response.data:void 0;response&&response.error?request.deferred.reject(data):request.deferred.resolve(data)}.bind(this))},XhrBatch.Requests=Requests,XhrBatch}(),window.tds=window.tds||{},tds.XhrTimer=function(){function Entry(maxTicks,callback){this._ticks=0,this._maxTicks=maxTicks,this._callback=callback}function XhrTimer(xhrBatch,promiseTimer){this._xhrBatch=xhrBatch,this._timer=promiseTimer,this._entries=[],this._xhrPromise=null}return Object.defineProperty(Entry.prototype,"ready",{get:function(){return this._ticks>=this._maxTicks}}),Entry.prototype.tick=function(){return++this._ticks},Entry.prototype.reset=function(){this._ticks=0},Entry.prototype.check=function(api){this._callback(api,!1)},Entry.prototype.dispose=function(){this._callback=null},XhrTimer.prototype.register=function(maxTicks,callback){this._entries.push(new Entry(maxTicks,callback))},XhrTimer.prototype.start=function(){return this._timer.start(this._onTick.bind(this,!1))},XhrTimer.prototype.stop=function(){return this._timer.stop()},XhrTimer.prototype.clear=function(){this._entries.forEach(function(entry){entry.dispose()}),this._entries=[]},XhrTimer.prototype._getRequests=function(manual,callback){var requests=new tds.XhrBatch.Requests;if(this._entries.forEach(function(entry){if(entry.tick(),manual||entry.ready){entry.reset();try{entry.check(requests)}catch(ex){console.warn("Error processing xhr timer entry. ",entry,ex)}}}),"function"==typeof callback)try{callback(requests)}catch(ex){console.warn("XhrTimer: Send callback failed",ex)}return requests},XhrTimer.prototype._sendXhr=function(requests){return this._xhrPromise=this._xhrBatch.send(requests),this._xhrPromise},XhrTimer.prototype._onTick=function(){var requests=this._getRequests(!1,null);return this._sendXhr(requests)},XhrTimer.prototype._wait=function(callback){return Util.Promise.when(this._xhrPromise).finally(callback)},XhrTimer.prototype.send=function(callback,stopTimer){var self=this;return this._wait(function(){var paused=self.stop(),requests=self._getRequests(!0,callback);return self._sendXhr(requests).finally(function(){requests.reset(),paused&&!stopTimer&&self.start()})})},XhrTimer.prototype.requestJSON=function(callback,stopTimer){var deferred=Util.Promise.defer();return this._wait(function(){try{var paused=self.stop(),requests=this._getRequests(!0,callback);paused&&!stopTimer&&self.start();var json=requests.toJSON();requests.reset(),deferred.resolve(json)}catch(ex){deferred.reject(ex)}}.bind(this)),deferred.promise},XhrTimer.create=function(xhrUrl,xhrTimeout,timerInterval,timerTimeout){if("string"!=typeof xhrUrl)throw new Error("Must provide timer url");if(!(xhrTimeout>0))throw new Error("Must provide valid xhr timeout");if(!(timerInterval>0))throw new Error("Must provide valid timer interval");if(timerInterval>0&&xhrTimeout>timerTimeout)throw new Error("Timer timeout cannot be less than or the same as xhr timeout");return new XhrTimer(new tds.XhrBatch(xhrUrl,xhrTimeout),new tds.PromiseTimer(timerInterval,timerTimeout))},XhrTimer}(),TDS.Help=function(TDS){function HelpGuide(contentFrame,btnStartTTS){this.onReset=new YAHOO.util.CustomEvent("onReset",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),this.selection=null;var frame=contentFrame,enabled=!1,that=this;this.handleMobileSelection=function(frame,btnStartTTS){var that=this;if(frame&&Util.Browser.isMobile()){var frameDoc=Util.Dom.getFrameContentDocument(frame);frameDoc&&YUE.addListener(frameDoc,"selectionchange",function(evt){evt&&evt.target!=btnStartTTS&&(that.selection=rangy.getSelection(frameDoc))})}},this.init=function(){return shouldEnableTTS(),enabled},this.isEnabled=function(){return enabled},this.hasTTSInstrAccommodationEnabled=function(){var accProps=TDS.getAccommodationProperties(),language=accProps.getLanguage();return accProps.hasTTSInstruction()&&isTTSPossibleForLanguage(language)},this.getStartSpeakingHandler=function(){return startSpeakingHandler},this.getStopSpeakingHandler=function(){return stopSpeakingHandler},this.reset=function(fireResetEvent){enabled=checkEnabled(),fireResetEvent&&this.onReset.fire()};var isTTSPossibleForLanguage=function(language){return"ENU"==language||"ESN"==language},checkEnabled=function(){var language=TDS.getAccommodationProperties().getLanguage(),ctrl=TTS.getInstance(),languageSupported=ctrl.isLanguageSupported(language);return!(!(ctrl.getStatus()!=TTS.Status.NotSupported)||!languageSupported)},shouldEnableTTS=function(){return that.hasTTSInstrAccommodationEnabled()&&(TTS.Manager.getStatus()!=TTS.Status.Uninitialized?that.reset(!0):(TTS.Manager.Events.onInitFailure.subscribe(function(){disable()}),TTS.Manager.Events.onStatusChange.subscribe(function(){TTS.Manager.getStatus()==TTS.Status.NotSupported&&disable()}),TTS.Manager.Events.onInitSuccess.subscribe(function(){that.reset(!0)}),YAHOO.util.Event.onDOMReady(function(){TTS.getInstance()}))),!1},disable=function(){enabled=!1,that.onReset.fire()},startSpeakingHandler=function(evt,altFrame,touchSelected){if(enabled){var prepSelection=function(frame,language){var doc=Util.Dom.getFrameContentWindow(frame).document;if(touchSelected)selected=touchSelected;else var selected=rangy.getSelection(doc);var element=doc.getElementById("helpContent");tds.language.tagElements(element,language);var entity={};return entity.getElement=function(){return element},ctrl.setCurrentDomEntity(entity),selected},language=TDS.getAccommodationProperties().getLanguage(),ctrl=TTS.getInstance();ctrl.stop();if(TTS.version&&TTS.version>1){var selection;(selection=void 0!==altFrame&&null!=altFrame?prepSelection(altFrame,language):prepSelection(frame,language)).getAllRanges().length&&!TDS.Audio.isActive()&&ctrl.playSelection(selection,language)}else void 0!==altFrame&&null!=altFrame?TDS.Audio.isActive()||ctrl.play(Util.Dom.getFrameContentWindow(altFrame),TTS.Parser.Types.Selection,language):TDS.Audio.isActive()||ctrl.play(Util.Dom.getFrameContentWindow(frame),TTS.Parser.Types.Selection,language)}},stopSpeakingHandler=function(evt,altFrame){enabled&&TTS.getInstance().stop()}}return HelpGuide.getKey=function(){var key="Global.Path.Help",accProps=TDS.getAccProps();return accProps&&(accProps.isStreamlinedMode()||accProps.hasBraille())&&Messages.has(key+".Streamlined")&&(key+=".Streamlined"),key},HelpGuide.getUrl=function(){var key=HelpGuide.getKey(),url=TDS.baseUrl+"Pages/";return url+=Messages.get(key)},HelpGuide.onLoad=function(frame,btnStartSpeaking,btnStopSpeaking,messageDiv,noTTSMessageDiv){btnStartSpeaking=YUD.get(btnStartSpeaking),btnStopSpeaking=YUD.get(btnStopSpeaking),messageDiv=YUD.get(messageDiv),noTTSMessageDiv=YUD.get(noTTSMessageDiv);var tdsHelpFunctionality=new HelpGuide(frame);tdsHelpFunctionality.handleMobileSelection(frame,btnStartSpeaking);var disableTTS=function(){var hasTTSInstrAccommmodation=tdsHelpFunctionality.hasTTSInstrAccommodationEnabled();YUD.addClass(btnStartSpeaking,"disabled"),YUD.addClass(btnStopSpeaking,"disabled"),YUD.setStyle(messageDiv,"display","none"),hasTTSInstrAccommmodation?YUD.setStyle(noTTSMessageDiv,"display","block"):(YUD.setStyle(noTTSMessageDiv,"display","none"),YUD.setStyle(btnStartSpeaking,"display","none"),YUD.setStyle(btnStopSpeaking,"display","none"));var startSpeakingEvt=Util.Browser.isMobile()?"touchstart":"click";YUE.removeListener(btnStartSpeaking,startSpeakingEvt),YUE.removeListener(btnStopSpeaking,"click")},initDisplay=function(){if(tdsHelpFunctionality.isEnabled()){YUD.removeClass(btnStartSpeaking,"disabled"),YUD.removeClass(btnStopSpeaking,"disabled");var startSpeakingEvt=Util.Browser.isMobile()?"touchstart":"click";YUE.addListener(btnStartSpeaking,startSpeakingEvt,function(evt){YUE.stopEvent(evt),tdsHelpFunctionality.getStartSpeakingHandler()(null,null,tdsHelpFunctionality.selection)}),YUE.addListener(btnStopSpeaking,"click",function(){tdsHelpFunctionality.getStopSpeakingHandler()()})}else disableTTS()};tdsHelpFunctionality.onReset.subscribe(function(){initDisplay()}),tdsHelpFunctionality.init(),initDisplay()},TDS.ToolManager.Events.subscribe("onCreating",function(panel){if(-1!=panel.id.indexOf("tool-Global.Path.Help")){var tdsHelpFunctionality=new HelpGuide(panel.getFrame());if(tdsHelpFunctionality.hasTTSInstrAccommodationEnabled()){var buttons=[{text:Messages.get("TDSContentJS.Label.StartSpeaking"),handler:function(){var thatPanel=panel;tdsHelpFunctionality.getStartSpeakingHandler()(null,thatPanel.getFrame())},disabled:!0},{text:Messages.get("TDSContentJS.Label.StopSpeaking"),handler:function(){var thatPanel=panel;tdsHelpFunctionality.getStopSpeakingHandler()(null,thatPanel.getFrame())},isDefault:!0,disabled:!0}];panel.cfg.queueProperty("buttons",buttons),panel.renderEvent.subscribe(function(){var helpMessage=Messages.get("TestInstructions.Label.Help");helpMessage+=Messages.get("TestInstructions.Label.NoTTSHelp");var helpMessageElement=document.createElement("span");helpMessageElement.innerHTML=helpMessage,panel.appendToFooter(helpMessageElement)});var oninited=function(thatPanel){var enableTTSOnInstr=tdsHelpFunctionality.isEnabled();if(null!=thatPanel.getButtons()){for(var counter1=0;counter1<thatPanel.getButtons().length;++counter1){var button=null,label=thatPanel.getButtons()[counter1].getAttributeConfig("label").value;if(label==Messages.get("TDSContentJS.Label.StartSpeaking")){(button=thatPanel.getButtons()[counter1]).addClass("ttsHelpSpeakButtonClass");var startSpeakingEvt=Util.Browser.isMobile()?"mousedown":"click";button.removeListener("click"),button.addListener(startSpeakingEvt,function(){tdsHelpFunctionality.getStartSpeakingHandler()(null,thatPanel.getFrame())});var btnStartSpeaking=button._button;tdsHelpFunctionality.handleMobileSelection(thatPanel.getFrame(),btnStartSpeaking)}else label==Messages.get("TDSContentJS.Label.StopSpeaking")&&(button=thatPanel.getButtons()[counter1]).addClass("ttsHelpStopSpeakButtonClass");null!=button&&(button.setAttributeConfig("disabled",enableTTSOnInstr),enableTTSOnInstr?button.removeClass("disabled"):button.addClass("disabled"))}enableTTSOnInstr?(YAHOO.util.Dom.addClass(panel.footer,"hasTTS"),YAHOO.util.Dom.removeClass(panel.footer,"noTTS")):(YAHOO.util.Dom.addClass(panel.footer,"noTTS"),YAHOO.util.Dom.removeClass(panel.footer,"hasTTS"))}}.bind(this);panel.showEvent.subscribe(function(){tdsHelpFunctionality.reset(!1),oninited(panel)}.bind(this)),panel.hideEvent.subscribe(function(){TTS.Manager.stop()}),tdsHelpFunctionality.onReset.subscribe(function(){oninited(panel)}),tdsHelpFunctionality.init(),YAHOO.util.Event.onDOMReady(function(){TTS.getInstance()})}}}),HelpGuide}(window.TDS),TDS.Cache={},TDS.Cache.id=null,TDS.Cache.validate=!1,TDS.Cache._statusLookup=["uncached","idle","checking","downloading","updateready","obsolete"],TDS.Cache._eventLookup=["cached","checking","downloading","error","noupdate","obsolete","progress","updateready"],TDS.Cache._currentEvent=null,TDS.Cache._count=0,TDS.Cache._shuttingDown=!1,TDS.Cache._shutDown=!1,TDS.Cache.Events=new Util.EventManager,TDS.Cache.getCount=function(){return TDS.Cache._count},TDS.Cache.hasManifest=function(){return null!=document.getElementsByTagName("html")[0].getAttribute("manifest")},TDS.Cache.isSupported=function(){return"object"==typeof window.applicationCache},TDS.Cache.isAvailable=function(){return this.hasManifest()&&this.isSupported()},TDS.Cache.getStatus=function(){if(this.isAvailable())try{return TDS.Cache._statusLookup[window.applicationCache.status]}catch(ex){}return null},TDS.Cache.getEvent=function(){return TDS.Cache._currentEvent},TDS.Cache.isBusy=function(){var status=this.getStatus(),event=this.getEvent();return["checking","downloading"].indexOf(status)>-1||"uncached"==status&&null!=event&&["checking","downloading","progress"].indexOf(event)>-1},TDS.Cache.enable=function(){Mozilla.execPrivileged(function(){Mozilla.setPreference("browser.cache.offline.enable",!0)})},TDS.Cache.disable=function(){Mozilla.execPrivileged(function(){Mozilla.setPreference("browser.cache.offline.enable",!1)})},TDS.Cache.init=function(){if(!this.isAvailable())return!1;for(var cacheEvents=TDS.Cache._eventLookup,i=0;i<cacheEvents.length;i++)try{window.applicationCache.addEventListener(cacheEvents[i],TDS.Cache._handler,!1)}catch(ex){return!1}return!0},TDS.Cache._handler=function(evt){TDS.Cache._currentEvent=evt.type,"progress"==evt.type&&TDS.Cache._count++,TDS.Cache.Events.fire("onChange",evt),TDS.Cache._shuttingDown&&TDS.Cache._tryToShutdown()},TDS.Cache.stop=function(){TDS.Cache._shuttingDown||(TDS.Cache._shuttingDown=!0,TDS.Cache.Events.fire("onStop"),TDS.Cache._tryToShutdown()||(TDS.Cache._shuttingDown=!0,TDS.Cache.disable()))},TDS.Cache._tryToShutdown=function(){return!TDS.Cache._shutDown&&((!TDS.Cache.isAvailable()||!TDS.Cache.isBusy())&&(TDS.Cache._shutDown=!0,setTimeout(function(){TDS.Cache.enable(),TDS.Cache.Events.fire("onShutdown")},5e3),!0))},TDS.Cache.init(),TDS.Cache.checkObsolete=function(){var storedCacheId=Mozilla.getPreference("tds.cache.id");storedCacheId!=TDS.Cache.id&&(YAHOO.lang.isString(TDS.Cache.id)&&(Util.log("checkObsolete: set="+TDS.Cache.id),Mozilla.setPreference("tds.cache.id",TDS.Cache.id)),YAHOO.lang.isString(storedCacheId)&&(Util.log("checkObsolete: clearCache"),Util.SecureBrowser.clearCache()))},TDS.IdleTimer=function(TDS){return function(waitMins,respondSecs,funcNoResponse){this.message=ErrorCodes.get("IdleTimeout"),this.isStarted=!1,this.timerIdle=null,this.waitMins=waitMins,this.respondSecs=respondSecs,this.Events=new Util.EventManager,this.getIdleMilliseconds=function(){return 60*this.waitMins*1e3},this.getRespondMilliseconds=function(){return 1e3*this.respondSecs},this.start=function(){Util.log("timeout: start"),this.isStarted=!0,this.reset()},this.stop=function(){this.isStarted=!1,this.cancel()},this.reset=function(){this.isStarted&&(this.cancel(),this.timerIdle=YAHOO.lang.later(this.getIdleMilliseconds(),this,this.openDialog))},this.cancel=function(){null!=this.timerIdle&&this.timerIdle.cancel()},this.openDialog=function(){Util.log("timeout: openDialog"),this.stop(),this.timerIdle=YAHOO.lang.later(this.getRespondMilliseconds(),this,this.dialogNoResponse);var self=this;TDS.Dialog.showAlert(this.message,function(){self.cancel(),self.start(),self.Events.fire("onResume")}.bind(this))},this.dialogNoResponse=function(){Util.log("timeout: dialogNoResponse"),"function"==typeof funcNoResponse&&funcNoResponse(),this.Events.fire("onTimeout")},this.addListeners=function(win){YAHOO.util.Event.addListener(win,"keyup",this.reset,this,!0),YAHOO.util.Event.addListener(win,"mousedown",this.reset,this,!0)},this.addListeners(window),-1!=this.message.indexOf("{0}")&&(this.message=this.message.replace("{0}",this.waitMins)),-1!=this.message.indexOf("{1}")&&(this.message=this.message.replace("{1}",this.respondSecs))}}(window.TDS),TDS.Shell=function(TDS){function addClick(id,callback){var target=YUD.get(id);return null!=target&&(shell.allowFocus||!1!==window.ContentManager.enableARIA||(target.setAttribute("tabindex","-1"),"SELECT"!=target.tagName&&(YUE.on(target,"mousedown",function(evt){YUE.stopEvent(evt)}),YUE.on(target,"mouseup",function(evt){YUE.stopEvent(evt)}))),YUE.on(target,"click",function(evt){"A"!=target.nodeName&&"SELECT"!=target.nodeName||YUE.stopEvent(evt),"disabled"!=YUD.getAttribute(target,"disabled")&&callback.call(this,evt)},this,!0),!0)}function enableButton(id){var btnEl=YUD.get(id);btnEl&&($(btnEl).parent().removeClass("inactive"),$(btnEl).parent().addClass("active"),btnEl.setAttribute("aria-disabled","false"))}function disableButton(id){var btnEl=YUD.get(id);btnEl&&($(btnEl).parent().removeClass("active"),$(btnEl).parent().addClass("inactive"),btnEl.setAttribute("aria-disabled","true"))}function showButton(id){var btnEl=YUD.get(id);btnEl&&($(btnEl).parent().show(),btnEl.setAttribute("aria-hidden","false"))}function hideButton(id){var btnEl=YUD.get(id);btnEl&&($(btnEl).parent().hide(),btnEl.setAttribute("aria-hidden","true"))}function processButton(linkEl,options){options.inactive?disableButton(linkEl):enableButton(linkEl),options.hidden?hideButton(linkEl):showButton(linkEl),YAHOO.lang.isFunction(options.fn)&&addClick(linkEl,options.fn)}function createButton(parentId,options){var ulEl=YUD.get(parentId);if(null==ulEl)return null;var liEl=document.createElement("li"),linkEl=document.createElement("a");options.id&&(linkEl.id=options.id);var classname=options.classname||options.className;classname&&$(linkEl).addClass(classname),options.allowFocus?linkEl.setAttribute("tabindex","0"):linkEl.setAttribute("tabindex","-1"),YUD.setAttribute(linkEl,"href","#"),YUD.setAttribute(linkEl,"role","button"),liEl.appendChild(linkEl);var iconEl=document.createElement("span");iconEl.className="icon",linkEl.appendChild(iconEl);var labelEl;"universal"==shell.name?((labelEl=document.createElement("span")).className="label",linkEl.appendChild(labelEl)):labelEl=iconEl;var text=options.text||options.label;return options.i18n?labelEl.innerHTML=Messages.getAlt(options.i18n,text):text&&(labelEl.innerHTML=text),ulEl.appendChild(liEl),linkEl}function addButton(parentId,options){"boolean"!=typeof(options=options||{}).allowFocus&&(options.allowFocus=shell.allowFocus);var linkEl=null;return options.id&&(linkEl=document.getElementById(options.id)),linkEl||(linkEl=createButton(parentId,options)),processButton(linkEl,options),linkEl}var shell={name:null,allowFocus:!1},addTool=addButton.bind(shell,"studentTools"),addControl=addButton.bind(shell,"studentControls");return shell.enableButton=enableButton,shell.disableButton=disableButton,shell.showButton=showButton,shell.hideButton=hideButton,shell.addTool=addTool,shell.addControl=addControl,shell.addClick=addClick,shell.processConfig=function(config){var toolbar=config.toolbars[shell.name]||config.toolbars.modern;toolbar.controls.forEach(function(name){var button=config.controls[name];addControl(button)}),toolbar.tools.forEach(function(name){var button=config.tools[name];addTool(button)})},shell.getNavigationEl=function(){return document.getElementById("ddlNavigation")},shell.getJumpEl=function(){return document.getElementById("jumpGo")},shell.getHelpEl=function(){return document.getElementById("btnHelp")},shell.getSettingsEl=function(){return document.getElementById("btnSettings")},shell.getSoundCuesEl=function(){return document.getElementById("soundCues")},shell.getContentsEl=function(){return document.getElementById("contents")},shell.setSessionName=function(text){$(".sessionID").html(text)},shell.setStudentName=function(text){$("#ot-studentInfo, .studentInfo").html(text)},shell}(window.TDS),TDS.Shell.Notification=function(){function activate(){$(SELECTOR_CONTAINER).addClass("alertActive")}function show(){$(SELECTOR_CONTAINER).removeClass("alertClosed"),$(SELECTOR_DISMISS).attr("aria-expanded","true")}function toggle(){$(SELECTOR_CONTAINER).toggleClass("alertClosed"),$(SELECTOR_DISMISS).attr("aria-expanded",function(index,value){return value&&"false"!==value?"false":"true"})}function remove(numToShow){$(SELECTOR_ENTRIES).slice(numToShow).remove()}function init(){isInit||($(SELECTOR_DISMISS).click(function(evt){YUE.stopEvent(evt),toggle()}).keyup(function(evt){32===evt.which&&toggle()}),isInit=!0)}var SELECTOR_CONTAINER=".alertBar",SELECTOR_DISMISS=".alertBar .alertDismiss",SELECTOR_CONTENT=".alertBar .alertContent",SELECTOR_ENTRIES=".alertBar .alertContent li",isInit=!1;return{add:function(text){init(),activate(),show(),$(SELECTOR_CONTENT).prepend("<li>"+text+"</li>"),remove(3)}}}(),function(TDS){var _unloadWindow;TDS.unloader={needUnload:!0},TDS.unloader.disable=function(){this.needUnload=!1},TDS.unloader.initiateUnload=function(){if(!this.needUnload)return!1;if(TDS.isProxyLogin){if(Util.Browser.isSecure())return!0;var targetUrl=TDS.resolveBaseUrl("Pages/Logout.aspx");return _unloadWindow=_unloadWindow||window.open(targetUrl,"unload",""),window.focus(),!1}return!0},TDS.unloader.promptToDisablePopupBlocker=function(){function checkAndPrompt(){var popup=window.open("","popupcheck","");if(popup)return popup.close(),void TDS.Student.Storage.setPopupsEnabled(!0);var warningMessage=Messages.get("Global.Label.Warning"),tryAgainMessage=Messages.get("Try again"),logoutMessage=Messages.get("Logout"),popupBlockerMessage=Messages.getAlt("Global.Label.PopupBlockerMessage","This site requires popus to work properly.  Please disable your popup blocker for this site, then click ["+Messages.get("Try again")+"]."),buttons=[{text:tryAgainMessage,handler:function(){this.hide(),setTimeout(checkAndPrompt,1)},isDefault:!0},{text:logoutMessage,handler:function(){this.hide(),TDS.logout()},isDefault:!1}];TDS.Dialog.show(warningMessage,popupBlockerMessage,buttons)}TDS.Student.Storage.getPopupsEnabled()||Util.Browser.isSecure()||checkAndPrompt()}}(TDS),this.createjs=this.createjs||{},function(){var a=createjs.SoundJS=createjs.SoundJS||{};a.version="0.5.2",a.buildDate="Thu, 12 Dec 2013 23:33:37 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b._listeners=null,b._captureListeners=null,b.initialize=function(){},b.addEventListener=function(a,b,c){var d,e=(d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[a];return e&&this.removeEventListener(a,b,c),(e=d[a])?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b){if("string"==typeof a){var c=this._listeners;if(!c||!c[a])return!1;a=new createjs.Event(a)}if(a.target=b||this,a.bubbles&&this.parent){for(var d=this,e=[d];d.parent;)e.push(d=d.parent);var f,g=e.length;for(f=g-1;f>=0&&!a.propagationStopped;f--)e[f]._dispatchEvent(a,1+(0==f));for(f=1;g>f&&!a.propagationStopped;f++)e[f]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;a.currentTarget=this,a.eventPhase=b,a.removed=!1,e=e.slice();for(var f=0;c>f&&!a.immediatePropagationStopped;f++){var g=e[f];g.handleEvent?g.handleEvent(a):g(a),a.removed&&(this.off(a.type,g,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;b.type=null,b.target=null,b.currentTarget=null,b.eventPhase=0,b.bubbles=!1,b.cancelable=!1,b.timeStamp=0,b.defaultPrevented=!1,b.propagationStopped=!1,b.immediatePropagationStopped=!1,b.removed=!1,b.initialize=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c,this.timeStamp=(new Date).getTime()},b.preventDefault=function(){this.defaultPrevented=!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";function a(){throw"Sound cannot be instantiated"}function b(a,b){this.init(a,b)}function d(){}var e=a;e.DELIMITER="|",e.INTERRUPT_ANY="any",e.INTERRUPT_EARLY="early",e.INTERRUPT_LATE="late",e.INTERRUPT_NONE="none",e.PLAY_INITED="playInited",e.PLAY_SUCCEEDED="playSucceeded",e.PLAY_INTERRUPTED="playInterrupted",e.PLAY_FINISHED="playFinished",e.PLAY_FAILED="playFailed",e.SUPPORTED_EXTENSIONS=["mp3","ogg","mpeg","wav","m4a","mp4","aiff","wma","mid"],e.EXTENSION_MAP={m4a:"mp4"},e.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,e.defaultInterruptBehavior=e.INTERRUPT_NONE,e.alternateExtensions=[],e._lastID=0,e.activePlugin=null,e._pluginsRegistered=!1,e._masterVolume=1,e._masterMute=!1,e._instances=[],e._idHash={},e._preloadHash={},e._defaultSoundInstance=null,e.addEventListener=null,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._sendFileLoadEvent=function(a){if(e._preloadHash[a])for(var b=0,c=e._preloadHash[a].length;c>b;b++){var d=e._preloadHash[a][b];if(e._preloadHash[a][b]=!0,e.hasEventListener("fileload")){var f=new createjs.Event("fileload");f.src=d.src,f.id=d.id,f.data=d.data,e.dispatchEvent(f)}}},e.getPreloadHandlers=function(){return{callback:createjs.proxy(e.initLoad,e),types:["sound"],extensions:e.SUPPORTED_EXTENSIONS}},e.registerPlugin=function(a){try{console.log("createjs.Sound.registerPlugin has been deprecated. Please use registerPlugins.")}catch(b){}return e._registerPlugin(a)},e._registerPlugin=function(a){return e._pluginsRegistered=!0,null!=a&&(!!a.isSupported()&&(e.activePlugin=new a,!0))},e.registerPlugins=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];if(e._registerPlugin(d))return!0}return!1},e.initializeDefaultPlugins=function(){return null!=e.activePlugin||!e._pluginsRegistered&&!!e.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])},e.isReady=function(){return null!=e.activePlugin},e.getCapabilities=function(){return null==e.activePlugin?null:e.activePlugin._capabilities},e.getCapability=function(a){return null==e.activePlugin?null:e.activePlugin._capabilities[a]},e.initLoad=function(a,b,c,d,f){a=a.replace(f,"");var g=e.registerSound(a,c,d,!1,f);return null!=g&&g},e.registerSound=function(a,c,d,f,g){if(!e.initializeDefaultPlugins())return!1;if(a instanceof Object&&(g=c,c=a.id,d=a.data,a=a.src),e.alternateExtensions.length)h=e._parsePath2(a,"sound",c,d);else var h=e._parsePath(a,"sound",c,d);if(null==h)return!1;null!=g&&(a=g+a,h.src=g+h.src),null!=c&&(e._idHash[c]=h.src);var i=null;null!=d&&(isNaN(d.channels)?isNaN(d)||(i=parseInt(d)):i=parseInt(d.channels));var j=e.activePlugin.register(h.src,i);if(null!=j&&(null!=j.numChannels&&(i=j.numChannels),b.create(h.src,i),null!=d&&isNaN(d)?d.channels=h.data.channels=i||b.maxPerChannel():d=h.data=i||b.maxPerChannel(),null!=j.tag?h.tag=j.tag:j.src&&(h.src=j.src),null!=j.completeHandler&&(h.completeHandler=j.completeHandler),j.type&&(h.type=j.type)),0!=f)if(e._preloadHash[h.src]||(e._preloadHash[h.src]=[]),e._preloadHash[h.src].push({src:a,id:c,data:d}),1==e._preloadHash[h.src].length)e.activePlugin.preload(h.src,j);else if(1==e._preloadHash[h.src][0])return!0;return h},e.registerManifest=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.registerSound(a[d].src,a[d].id,a[d].data,a[d].preload,b);return c},e.removeSound=function(a,c){if(null==e.activePlugin)return!1;if(a instanceof Object&&(a=a.src),a=e._getSrcById(a),e.alternateExtensions.length)d=e._parsePath2(a);else var d=e._parsePath(a);if(null==d)return!1;null!=c&&(d.src=c+d.src),a=d.src;for(var f in e._idHash)e._idHash[f]==a&&delete e._idHash[f];return b.removeSrc(a),delete e._preloadHash[a],e.activePlugin.removeSound(a),!0},e.removeManifest=function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=createjs.Sound.removeSound(a[d].src,b);return c},e.removeAllSounds=function(){e._idHash={},e._preloadHash={},b.removeAll(),e.activePlugin.removeAllSounds()},e.loadComplete=function(a){if(e.alternateExtensions.length)b=e._parsePath2(a,"sound");else var b=e._parsePath(a,"sound");return a=b?e._getSrcById(b.src):e._getSrcById(a),1==e._preloadHash[a][0]},e._parsePath=function(a,b,c,d){"string"!=typeof a&&(a=a.toString());var f=a.split(e.DELIMITER);if(f.length>1)try{console.log('createjs.Sound.DELIMITER "|" loading approach has been deprecated. Please use the new alternateExtensions property.')}catch(g){}for(var h={type:b||"sound",id:c,data:d},i=e.getCapabilities(),j=0,k=f.length;k>j;j++){var l=f[j],m=l.match(e.FILE_PATTERN);if(null==m)return!1;var n=m[4],o=m[5];if(i[o]&&createjs.indexOf(e.SUPPORTED_EXTENSIONS,o)>-1)return h.name=n,h.src=l,h.extension=o,h}return null},e._parsePath2=function(a,b,c,d){"string"!=typeof a&&(a=a.toString());var f=a.match(e.FILE_PATTERN);if(null==f)return!1;for(var g=f[4],h=f[5],i=e.getCapabilities(),j=0;!i[h];)if(h=e.alternateExtensions[j++],j>e.alternateExtensions.length)return null;a=a.replace("."+f[5],"."+h);var k={type:b||"sound",id:c,data:d};return k.name=g,k.src=a,k.extension=h,k},e.play=function(a,b,c,d,f,g,h){var i=e.createInstance(a);return e._playInstance(i,b,c,d,f,g,h)||i.playFailed(),i},e.createInstance=function(c){if(!e.initializeDefaultPlugins())return e._defaultSoundInstance;if(c=e._getSrcById(c),e.alternateExtensions.length)d=e._parsePath2(c,"sound");else var d=e._parsePath(c,"sound");var f=null;return null!=d&&null!=d.src?(b.create(d.src),f=e.activePlugin.create(d.src)):f=a._defaultSoundInstance,f.uniqueId=e._lastID++,f},e.setVolume=function(a){if(null==Number(a))return!1;if(a=Math.max(0,Math.min(1,a)),e._masterVolume=a,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterVolume(a)},e.getVolume=function(){return e._masterVolume},e.setMute=function(a){if(null==a||void 0==a)return!1;if(this._masterMute=a,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(a))for(var b=this._instances,c=0,d=b.length;d>c;c++)b[c].setMasterMute(a);return!0},e.getMute=function(){return this._masterMute},e.stop=function(){for(var a=this._instances,b=a.length;b--;)a[b].stop()},e._playInstance=function(a,b,c,d,f,g,h){if(b instanceof Object&&(c=b.delay,d=b.offset,f=b.loop,g=b.volume,h=b.pan,b=b.interrupt),b=b||e.defaultInterruptBehavior,null==c&&(c=0),null==d&&(d=a.getPosition()),null==f&&(f=0),null==g&&(g=a.volume),null==h&&(h=a.pan),0==c){if(!e._beginPlaying(a,b,d,f,g,h))return!1}else{var j=setTimeout(function(){e._beginPlaying(a,b,d,f,g,h)},c);a._delayTimeoutId=j}return this._instances.push(a),!0},e._beginPlaying=function(a,c,d,e,f,g){if(!b.add(a,c))return!1;if(!a._beginPlaying(d,e,f,g)){var i=createjs.indexOf(this._instances,a);return i>-1&&this._instances.splice(i,1),!1}return!0},e._getSrcById=function(a){return null==e._idHash||null==e._idHash[a]?a:e._idHash[a]},e._playFinished=function(a){b.remove(a);var c=createjs.indexOf(this._instances,a);c>-1&&this._instances.splice(c,1)},createjs.Sound=a,b.channels={},b.create=function(a,c){return null==b.get(a)&&(b.channels[a]=new b(a,c),!0)},b.removeSrc=function(a){var c=b.get(a);return null!=c&&(c.removeAll(),delete b.channels[a],!0)},b.removeAll=function(){for(var a in b.channels)b.channels[a].removeAll();b.channels={}},b.add=function(a,c){var d=b.get(a.src);return null!=d&&d.add(a,c)},b.remove=function(a){var c=b.get(a.src);return null!=c&&(c.remove(a),!0)},b.maxPerChannel=function(){return f.maxDefault},b.get=function(a){return b.channels[a]};var f=b.prototype;f.src=null,f.max=null,f.maxDefault=100,f.length=0,f.init=function(a,b){this.src=a,this.max=b||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},f.get=function(a){return this._instances[a]},f.add=function(a,b){return!!this.getSlot(b,a)&&(this._instances.push(a),this.length++,!0)},f.remove=function(a){var b=createjs.indexOf(this._instances,a);return-1!=b&&(this._instances.splice(b,1),this.length--,!0)},f.removeAll=function(){for(var a=this.length-1;a>=0;a--)this._instances[a].stop()},f.getSlot=function(b){for(var c,d,e=0,f=this.max;f>e;e++){if(null==(c=this.get(e)))return!0;(b!=a.INTERRUPT_NONE||c.playState==a.PLAY_FINISHED)&&(0!=e?c.playState==a.PLAY_FINISHED||c.playState==a.PLAY_INTERRUPTED||c.playState==a.PLAY_FAILED?d=c:(b==a.INTERRUPT_EARLY&&c.getPosition()<d.getPosition()||b==a.INTERRUPT_LATE&&c.getPosition()>d.getPosition())&&(d=c):d=c)}return null!=d&&(d._interrupt(),this.remove(d),!0)},f.toString=function(){return"[Sound SoundChannel]"},a._defaultSoundInstance=new function(){this.isDefault=!0,this.addEventListener=this.removeEventListener=this.removeAllEventListeners=this.dispatchEvent=this.hasEventListener=this._listeners=this._interrupt=this._playFailed=this.pause=this.resume=this.play=this._beginPlaying=this._cleanUp=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setMute=this.getMute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1},this.getVolume=this.getPan=this.getDuration=function(){return 0},this.playState=a.PLAY_FAILED,this.toString=function(){return"[Sound Default Sound Instance]"}},d.init=function(){var a=window.navigator.userAgent;d.isFirefox=a.indexOf("Firefox")>-1,d.isOpera=null!=window.opera,d.isChrome=a.indexOf("Chrome")>-1,d.isIOS=a.indexOf("iPod")>-1||a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1,d.isAndroid=a.indexOf("Android")>-1,d.isBlackberry=a.indexOf("Blackberry")>-1},d.init(),createjs.Sound.BrowserDetect=d}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._init()}var b=a;b._capabilities=null,b.isSupported=function(){var a=createjs.Sound.BrowserDetect.isIOS||createjs.Sound.BrowserDetect.isAndroid||createjs.Sound.BrowserDetect.isBlackberry;return!("file:"==location.protocol&&!a&&!this._isFileXHRSupported())&&(b._generateCapabilities(),null!=b.context)},b._isFileXHRSupported=function(){var a=!0,b=new XMLHttpRequest;try{b.open("GET","fail.fail",!1)}catch(c){return a=!1}b.onerror=function(){a=!1},b.onload=function(){a=404==this.status||200==this.status||0==this.status&&""!=this.response};try{b.send()}catch(c){a=!1}return a},b._generateCapabilities=function(){if(null==b._capabilities){var a=document.createElement("audio");if(null==a.canPlayType)return null;if(window.webkitAudioContext)b.context=new webkitAudioContext;else{if(!window.AudioContext)return null;b.context=new AudioContext}b._compatibilitySetUp(),b.playEmptySound(),b._capabilities={panning:!0,volume:!0,tracks:-1};for(var c=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=c.length;f>e;e++){var g=c[e],h=d[g]||g;b._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}b.context.destination.numberOfChannels<2&&(b._capabilities.panning=!1),b.dynamicsCompressorNode=b.context.createDynamicsCompressor(),b.dynamicsCompressorNode.connect(b.context.destination),b.gainNode=b.context.createGain(),b.gainNode.connect(b.dynamicsCompressorNode)}},b._compatibilitySetUp=function(){if(!b.context.createGain){b.context.createGain=b.context.createGainNode;var a=b.context.createBufferSource();a.__proto__.start=a.__proto__.noteGrainOn,a.__proto__.stop=a.__proto__.noteOff,this._panningModel=0}},b.playEmptySound=function(){var a=this.context.createBuffer(1,1,22050),b=this.context.createBufferSource();b.buffer=a,b.connect(this.context.destination),b.start(0,0,0)};var c=a.prototype;c._capabilities=null,c._volume=1,c.context=null,c._panningModel="equalpower",c.dynamicsCompressorNode=null,c.gainNode=null,c._arrayBuffers=null,c._init=function(){this._capabilities=b._capabilities,this._arrayBuffers={},this.context=b.context,this.gainNode=b.gainNode,this.dynamicsCompressorNode=b.dynamicsCompressorNode},c.register=function(a){return this._arrayBuffers[a]=!0,{tag:new createjs.WebAudioPlugin.Loader(a,this)}},c.isPreloadStarted=function(a){return null!=this._arrayBuffers[a]},c.isPreloadComplete=function(a){return!(null==this._arrayBuffers[a]||1==this._arrayBuffers[a])},c.removeSound=function(a){delete this._arrayBuffers[a]},c.removeAllSounds=function(){this._arrayBuffers={}},c.addPreloadResults=function(a,b){this._arrayBuffers[a]=b},c._handlePreloadComplete=function(){createjs.Sound._sendFileLoadEvent(this.src)},c.preload=function(a){this._arrayBuffers[a]=!0;var b=new createjs.WebAudioPlugin.Loader(a,this);b.onload=this._handlePreloadComplete,b.load()},c.create=function(a){return this.isPreloadStarted(a)||this.preload(a),new createjs.WebAudioPlugin.SoundInstance(a,this)},c.setVolume=function(a){return this._volume=a,this._updateVolume(),!0},c._updateVolume=function(){var a=createjs.Sound._masterMute?0:this._volume;a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a)},c.getVolume=function(){return this._volume},c.setMute=function(){return this._updateVolume(),!0},c.toString=function(){return"[WebAudioPlugin]"},createjs.WebAudioPlugin=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype=new createjs.EventDispatcher;b.src=null,b.uniqueId=-1,b.playState=null,b._owner=null,b._offset=0,b._delay=0,b._volume=1;try{Object.defineProperty(b,"volume",{get:function(){return this._volume},set:function(a){return null!=Number(a)&&(a=Math.max(0,Math.min(1,a)),this._volume=a,void this._updateVolume())}})}catch(c){}b._pan=0;try{Object.defineProperty(b,"pan",{get:function(){return this._pan},set:function(a){return!(!this._owner._capabilities.panning||null==Number(a))&&(a=Math.max(-1,Math.min(1,a)),this._pan=a,void this.panNode.setPosition(a,0,-.5))}})}catch(c){}b._duration=0,b._remainingLoops=0,b._delayTimeoutId=null,b._soundCompleteTimeout=null,b.gainNode=null,b.panNode=null,b.sourceNode=null,b._sourceNodeNext=null,b._muted=!1,b._paused=!1,b._startTime=0,b._endedHandler=null,b._sendEvent=function(a){var b=new createjs.Event(a);this.dispatchEvent(b)},b._init=function(a,b){this._owner=b,this.src=a,this.gainNode=this._owner.context.createGain(),this.panNode=this._owner.context.createPanner(),this.panNode.panningModel=this._owner._panningModel,this.panNode.connect(this.gainNode),this._owner.isPreloadComplete(this.src)&&(this._duration=1e3*this._owner._arrayBuffers[this.src].duration),this._endedHandler=createjs.proxy(this._handleSoundComplete,this)},b._cleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),this._startTime=0,null!=window.createjs&&createjs.Sound._playFinished(this)},b._cleanUpAudioNode=function(a){return a&&(a.stop(0),a.disconnect(this.panNode),a=null),a},b._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._paused=!1,this._sendEvent("interrupted")},b._handleSoundReady=function(){if(null!=window.createjs){if(1e3*this._offset>this.getDuration())return void this.playFailed();this._offset<0&&(this._offset=0),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.gainNode.connect(this._owner.gainNode);var a=this._owner._arrayBuffers[this.src].duration;this.sourceNode=this._createAndPlayAudioNode(this._owner.context.currentTime-a,this._offset),this._duration=1e3*a,this._startTime=this.sourceNode.startTime-this._offset,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(a-this._offset)),0!=this._remainingLoops&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0))}},b._createAndPlayAudioNode=function(a,b){var c=this._owner.context.createBufferSource();return c.buffer=this._owner._arrayBuffers[this.src],c.connect(this.panNode),this._owner.context.currentTime,c.startTime=a+c.buffer.duration,c.start(c.startTime,b,c.buffer.duration-b),c},b.play=function(a,b,c,d,e,f){this._cleanUp(),createjs.Sound._playInstance(this,a,b,c,d,e,f)},b._beginPlaying=function(a,b,c,d){return null!=window.createjs&&this.src?(this._offset=a/1e3,this._remainingLoops=b,this.volume=c,this.pan=d,this._owner.isPreloadComplete(this.src)?(this._handleSoundReady(null),this._sendEvent("succeeded"),1):void this.playFailed()):void 0},b.pause=function(){return!this._paused&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._paused=!0,this._offset=this._owner.context.currentTime-this._startTime,this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),!0)},b.resume=function(){return!!this._paused&&(this._handleSoundReady(null),!0)},b.stop=function(){return this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._offset=0,!0},b.setVolume=function(a){return this.volume=a,!0},b._updateVolume=function(){var a=this._muted?0:this._volume;return a!=this.gainNode.gain.value&&(this.gainNode.gain.value=a,!0)},b.getVolume=function(){return this.volume},b.setMute=function(a){return null!=a&&void 0!=a&&(this._muted=a,this._updateVolume(),!0)},b.getMute=function(){return this._muted},b.setPan=function(a){return this.pan=a,this.pan==a&&void 0},b.getPan=function(){return this.pan},b.getPosition=function(){if(this._paused||null==this.sourceNode)a=this._offset;else var a=this._owner.context.currentTime-this._startTime;return 1e3*a},b.setPosition=function(a){return this._offset=a/1e3,this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout)),this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||this._handleSoundReady(null),!0},b.getDuration=function(){return this._duration},b._handleSoundComplete=function(){return this._offset=0,0!=this._remainingLoops?(this._remainingLoops--,this._sourceNodeNext?(this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._startTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)):this._handleSoundReady(null),void this._sendEvent("loop")):void(null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._sendEvent("complete")))},b.playFailed=function(){null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed"))},b.toString=function(){return"[WebAudioPlugin SoundInstance]"},createjs.WebAudioPlugin.SoundInstance=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype;b.request=null,b.owner=null,b.progress=-1,b.src=null,b.originalSrc=null,b.result=null,b.onload=null,b.onprogress=null,b.onError=null,b._init=function(a,b){this.src=a,this.originalSrc=a,this.owner=b},b.load=function(a){null!=a&&(this.src=a),this.request=new XMLHttpRequest,this.request.open("GET",this.src,!0),this.request.responseType="arraybuffer",this.request.onload=createjs.proxy(this.handleLoad,this),this.request.onError=createjs.proxy(this.handleError,this),this.request.onprogress=createjs.proxy(this.handleProgress,this),this.request.send()},b.handleProgress=function(a,b){this.progress=a/b,null!=this.onprogress&&this.onprogress({loaded:a,total:b,progress:this.progress})},b.handleLoad=function(){this.owner.context.decodeAudioData(this.request.response,createjs.proxy(this.handleAudioDecoded,this),createjs.proxy(this.handleError,this))},b.handleAudioDecoded=function(a){this.progress=1,this.result=a,this.src=this.originalSrc,this.owner.addPreloadResults(this.src,this.result),this.onload&&this.onload()},b.handleError=function(a){this.owner.removeSound(this.src),this.onerror&&this.onerror(a)},b.toString=function(){return"[WebAudioPlugin Loader]"},createjs.WebAudioPlugin.Loader=a}(),this.createjs=this.createjs||{},function(){"use strict";function a(){this._init()}var b=a;b.MAX_INSTANCES=30,b._AUDIO_READY="canplaythrough",b._AUDIO_ENDED="ended",b._AUDIO_SEEKED="seeked",b._AUDIO_STALLED="stalled",b._capabilities=null,b.enableIOS=!1,b.isSupported=function(){return!(createjs.Sound.BrowserDetect.isIOS&&!b.enableIOS)&&(b._generateCapabilities(),null!=b.tag&&null!=b._capabilities)},b._generateCapabilities=function(){if(null==b._capabilities){var a=b.tag=document.createElement("audio");if(null==a.canPlayType)return null;b._capabilities={panning:!0,volume:!0,tracks:-1};for(var c=createjs.Sound.SUPPORTED_EXTENSIONS,d=createjs.Sound.EXTENSION_MAP,e=0,f=c.length;f>e;e++){var g=c[e],h=d[g]||g;b._capabilities[g]="no"!=a.canPlayType("audio/"+g)&&""!=a.canPlayType("audio/"+g)||"no"!=a.canPlayType("audio/"+h)&&""!=a.canPlayType("audio/"+h)}}};var c=a.prototype;c._capabilities=null,c._audioSources=null,c.defaultNumChannels=2,c.loadedHandler=null,c._init=function(){this._capabilities=b._capabilities,this._audioSources={}},c.register=function(a,b){this._audioSources[a]=!0;for(var c=createjs.HTMLAudioPlugin.TagPool.get(a),d=null,e=b||this.defaultNumChannels,f=0;e>f;f++)d=this._createTag(a),c.add(d);if(d.id=a,this.loadedHandler=createjs.proxy(this._handleTagLoad,this),d.addEventListener&&d.addEventListener("canplaythrough",this.loadedHandler),null==d.onreadystatechange)d.onreadystatechange=this.loadedHandler;else{var g=d.onreadystatechange;d.onreadystatechange=function(){g(),this.loadedHandler()}}return{tag:d,numChannels:e}},c._handleTagLoad=function(a){a.target.removeEventListener&&a.target.removeEventListener("canplaythrough",this.loadedHandler),a.target.onreadystatechange=null,a.target.src!=a.target.id&&createjs.HTMLAudioPlugin.TagPool.checkSrc(a.target.id)},c._createTag=function(a){var b=document.createElement("audio");return b.autoplay=!1,b.preload="none",b.src=a,b},c.removeSound=function(a){delete this._audioSources[a],createjs.HTMLAudioPlugin.TagPool.remove(a)},c.removeAllSounds=function(){this._audioSources={},createjs.HTMLAudioPlugin.TagPool.removeAll()},c.create=function(a){if(!this.isPreloadStarted(a)){var b=createjs.HTMLAudioPlugin.TagPool.get(a),c=this._createTag(a);c.id=a,b.add(c),this.preload(a,{tag:c})}return new createjs.HTMLAudioPlugin.SoundInstance(a,this)},c.isPreloadStarted=function(a){return null!=this._audioSources[a]},c.preload=function(a,b){this._audioSources[a]=!0,new createjs.HTMLAudioPlugin.Loader(a,b.tag)},c.toString=function(){return"[HTMLAudioPlugin]"},createjs.HTMLAudioPlugin=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype=new createjs.EventDispatcher;b.src=null,b.uniqueId=-1,b.playState=null,b._owner=null,b.loaded=!1,b._offset=0,b._delay=0,b._volume=1;try{Object.defineProperty(b,"volume",{get:function(){return this._volume},set:function(a){null!=Number(a)&&(a=Math.max(0,Math.min(1,a)),this._volume=a,this._updateVolume())}})}catch(c){}b.pan=0,b._duration=0,b._remainingLoops=0,b._delayTimeoutId=null,b.tag=null,b._muted=!1,b._paused=!1,b._endedHandler=null,b._readyHandler=null,b._stalledHandler=null,b.loopHandler=null,b._init=function(a,b){this.src=a,this._owner=b,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleSoundReady,this),this._stalledHandler=createjs.proxy(this._handleSoundStalled,this),this.loopHandler=createjs.proxy(this.handleSoundLoop,this)},b._sendEvent=function(a){var b=new createjs.Event(a);this.dispatchEvent(b)},b._cleanUp=function(){var a=this.tag;if(null!=a){a.pause(),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),a.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{a.currentTime=0}catch(b){}createjs.HTMLAudioPlugin.TagPool.setInstance(this.src,a),this.tag=null}clearTimeout(this._delayTimeoutId),null!=window.createjs&&createjs.Sound._playFinished(this)},b._interrupt=function(){null!=this.tag&&(this.playState=createjs.Sound.PLAY_INTERRUPTED,this._cleanUp(),this._paused=!1,this._sendEvent("interrupted"))},b.play=function(a,b,c,d,e,f){this._cleanUp(),createjs.Sound._playInstance(this,a,b,c,d,e,f)},b._beginPlaying=function(a,b,c,d){if(null==window.createjs)return-1;var e=this.tag=createjs.HTMLAudioPlugin.TagPool.getInstance(this.src);return null==e?(this.playFailed(),-1):(e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._offset=a,this.volume=c,this.pan=d,this._updateVolume(),this._remainingLoops=b,4!==e.readyState?(e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),e.preload="auto",e.load()):this._handleSoundReady(null),this._sendEvent("succeeded"),1)},b._handleSoundStalled=function(){this._cleanUp(),this._sendEvent("failed")},b._handleSoundReady=function(){if(null!=window.createjs){if(this._duration=1e3*this.tag.duration,this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._offset>=this.getDuration())return void this.playFailed();this._offset>0&&(this.tag.currentTime=.001*this._offset),-1==this._remainingLoops&&(this.tag.loop=!0),0!=this._remainingLoops&&(this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1),this.tag.loop=!0),this.tag.play()}},b.pause=function(){return!this._paused&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&null!=this.tag&&(this._paused=!0,this.tag.pause(),clearTimeout(this._delayTimeoutId),!0)},b.resume=function(){return!(!this._paused||null==this.tag)&&(this._paused=!1,this.tag.play(),!0)},b.stop=function(){return this._offset=0,this.pause(),this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),!0},b.setMasterVolume=function(){return this._updateVolume(),!0},b.setVolume=function(a){return this.volume=a,!0},b._updateVolume=function(){if(null!=this.tag){var a=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;return a!=this.tag.volume&&(this.tag.volume=a),!0}return!1},b.getVolume=function(){return this.volume},b.setMasterMute=function(){return this._updateVolume(),!0},b.setMute=function(a){return null!=a&&void 0!=a&&(this._muted=a,this._updateVolume(),!0)},b.getMute=function(){return this._muted},b.setPan=function(){return!1},b.getPan=function(){return 0},b.getPosition=function(){return null==this.tag?this._offset:1e3*this.tag.currentTime},b.setPosition=function(a){if(null==this.tag)this._offset=a;else{this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{this.tag.currentTime=.001*a}catch(b){return!1}this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)}return!0},b.getDuration=function(){return this._duration},b._handleSoundComplete=function(){this._offset=0,null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),this._sendEvent("complete"))},b.handleSoundLoop=function(){this._offset=0,0==--this._remainingLoops&&(this.tag.loop=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)),this._sendEvent("loop")},b.playFailed=function(){null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FAILED,this._cleanUp(),this._sendEvent("failed"))},b.toString=function(){return"[HTMLAudioPlugin SoundInstance]"},createjs.HTMLAudioPlugin.SoundInstance=a}(),function(){"use strict";function a(a,b){this._init(a,b)}var b=a.prototype;b.src=null,b.tag=null,b.preloadTimer=null,b.loadedHandler=null,b._init=function(a,b){if(this.src=a,this.tag=b,this.preloadTimer=setInterval(createjs.proxy(this.preloadTick,this),200),this.loadedHandler=createjs.proxy(this.sendLoadedEvent,this),this.tag.addEventListener&&this.tag.addEventListener("canplaythrough",this.loadedHandler),null==this.tag.onreadystatechange)this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this);else{var c=this.tag.onreadystatechange;this.tag.onreadystatechange=function(){c(),this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this)}}this.tag.preload="auto",this.tag.load()},b.preloadTick=function(){var a=this.tag.buffered,b=this.tag.duration;a.length>0&&a.end(0)>=b-1&&this.handleTagLoaded()},b.handleTagLoaded=function(){clearInterval(this.preloadTimer)},b.sendLoadedEvent=function(){this.tag.removeEventListener&&this.tag.removeEventListener("canplaythrough",this.loadedHandler),this.tag.onreadystatechange=null,createjs.Sound._sendFileLoadEvent(this.src)},b.toString=function(){return"[HTMLAudioPlugin Loader]"},createjs.HTMLAudioPlugin.Loader=a}(),function(){"use strict";function a(a){this._init(a)}var b=a;b.tags={},b.get=function(c){var d=b.tags[c];return null==d&&(d=b.tags[c]=new a(c)),d},b.remove=function(a){var c=b.tags[a];return null!=c&&(c.removeAll(),delete b.tags[a],!0)},b.removeAll=function(){for(var a in b.tags)b.tags[a].removeAll();b.tags={}},b.getInstance=function(a){var c=b.tags[a];return null==c?null:c.get()},b.setInstance=function(a,c){var d=b.tags[a];return null==d?null:d.set(c)},b.checkSrc=function(a){var c=b.tags[a];return null==c?null:void c.checkSrcChange()};var c=a.prototype;c.src=null,c.length=0,c.available=0,c.tags=null,c._init=function(a){this.src=a,this.tags=[]},c.add=function(a){this.tags.push(a),this.length++,this.available++},c.removeAll=function(){for(;this.length--;)delete this.tags[this.length];this.src=null,this.tags.length=0},c.get=function(){if(0==this.tags.length)return null;this.available=this.tags.length;var a=this.tags.pop();return null==a.parentNode&&document.body.appendChild(a),a},c.set=function(a){-1==createjs.indexOf(this.tags,a)&&this.tags.push(a),this.available=this.tags.length},c.checkSrcChange=function(){for(var a=this.tags.length-1,b=this.tags[a].src;a--;)this.tags[a].src=b},c.toString=function(){return"[HTMLAudioPlugin TagPool]"},createjs.HTMLAudioPlugin.TagPool=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=createjs.PreloadJS=createjs.PreloadJS||{};a.version="0.4.1",a.buildDate="Thu, 12 Dec 2013 23:33:38 GMT"}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c){this.initialize(a,b,c)},b=a.prototype;b.type=null,b.target=null,b.currentTarget=null,b.eventPhase=0,b.bubbles=!1,b.cancelable=!1,b.timeStamp=0,b.defaultPrevented=!1,b.propagationStopped=!1,b.immediatePropagationStopped=!1,b.removed=!1,b.initialize=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c,this.timeStamp=(new Date).getTime()},b.preventDefault=function(){this.defaultPrevented=!0},b.stopPropagation=function(){this.propagationStopped=!0},b.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},b.remove=function(){this.removed=!0},b.clone=function(){return new a(this.type,this.bubbles,this.cancelable)},b.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){},b=a.prototype;a.initialize=function(a){a.addEventListener=b.addEventListener,a.on=b.on,a.removeEventListener=a.off=b.removeEventListener,a.removeAllEventListeners=b.removeAllEventListeners,a.hasEventListener=b.hasEventListener,a.dispatchEvent=b.dispatchEvent,a._dispatchEvent=b._dispatchEvent,a.willTrigger=b.willTrigger},b._listeners=null,b._captureListeners=null,b.initialize=function(){},b.addEventListener=function(a,b,c){var d,e=(d=c?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{})[a];return e&&this.removeEventListener(a,b,c),(e=d[a])?e.push(b):d[a]=[b],b},b.on=function(a,b,c,d,e,f){return b.handleEvent&&(c=c||b,b=b.handleEvent),c=c||this,this.addEventListener(a,function(a){b.call(c,a,e),d&&a.remove()},f)},b.removeEventListener=function(a,b,c){var d=c?this._captureListeners:this._listeners;if(d){var e=d[a];if(e)for(var f=0,g=e.length;g>f;f++)if(e[f]==b){1==g?delete d[a]:e.splice(f,1);break}}},b.off=b.removeEventListener,b.removeAllEventListeners=function(a){a?(this._listeners&&delete this._listeners[a],this._captureListeners&&delete this._captureListeners[a]):this._listeners=this._captureListeners=null},b.dispatchEvent=function(a,b){if("string"==typeof a){var c=this._listeners;if(!c||!c[a])return!1;a=new createjs.Event(a)}if(a.target=b||this,a.bubbles&&this.parent){for(var d=this,e=[d];d.parent;)e.push(d=d.parent);var f,g=e.length;for(f=g-1;f>=0&&!a.propagationStopped;f--)e[f]._dispatchEvent(a,1+(0==f));for(f=1;g>f&&!a.propagationStopped;f++)e[f]._dispatchEvent(a,3)}else this._dispatchEvent(a,2);return a.defaultPrevented},b.hasEventListener=function(a){var b=this._listeners,c=this._captureListeners;return!!(b&&b[a]||c&&c[a])},b.willTrigger=function(a){for(var b=this;b;){if(b.hasEventListener(a))return!0;b=b.parent}return!1},b.toString=function(){return"[EventDispatcher]"},b._dispatchEvent=function(a,b){var c,d=1==b?this._captureListeners:this._listeners;if(a&&d){var e=d[a.type];if(!e||!(c=e.length))return;a.currentTarget=this,a.eventPhase=b,a.removed=!1,e=e.slice();for(var f=0;c>f&&!a.immediatePropagationStopped;f++){var g=e[f];g.handleEvent?g.handleEvent(a):g(a),a.removed&&(this.off(a.type,g,1==b),a.removed=!1)}}},createjs.EventDispatcher=a}(),this.createjs=this.createjs||{},function(){"use strict";createjs.indexOf=function(a,b){for(var c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}}(),this.createjs=this.createjs||{},function(){"use strict";createjs.proxy=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){return a.apply(b,Array.prototype.slice.call(arguments,0).concat(c))}}}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(){this.init()},b=a.prototype=new createjs.EventDispatcher,c=a;c.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?)|(.{0,2}\/{1}))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,c.PATH_PATTERN=/^(?:(\w+:)\/{2})|(.{0,2}\/{1})?([/.]*?(?:[^?]+)?\/?)?$/,b.loaded=!1,b.canceled=!1,b.progress=0,b._item=null,b.getItem=function(){return this._item},b.init=function(){},b.load=function(){},b.close=function(){},b._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},b._sendProgress=function(a){if(!this._isCanceled()){var b=null;"number"==typeof a?(this.progress=a,b=new createjs.Event("progress"),b.loaded=this.progress,b.total=1):(b=a,this.progress=a.loaded/a.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),b.progress=this.progress,this.hasEventListener("progress")&&this.dispatchEvent(b)}},b._sendComplete=function(){this._isCanceled()||this.dispatchEvent("complete")},b._sendError=function(a){!this._isCanceled()&&this.hasEventListener("error")&&(null==a&&(a=new createjs.Event("error")),this.dispatchEvent(a))},b._isCanceled=function(){return!(null!=window.createjs&&!this.canceled)},b._parseURI=function(a){return a?a.match(c.FILE_PATTERN):null},b._parsePath=function(a){return a?a.match(c.PATH_PATTERN):null},b._formatQueryString=function(a,b){if(null==a)throw new Error("You must specify data.");var c=[];for(var d in a)c.push(d+"="+escape(a[d]));return b&&(c=c.concat(b)),c.join("&")},b.buildPath=function(a,b){if(null==b)return a;var c=[],d=a.indexOf("?");if(-1!=d){var e=a.slice(d+1);c=c.concat(e.split("&"))}return-1!=d?a.slice(0,d)+"?"+this._formatQueryString(b,c):a+"?"+this._formatQueryString(b,c)},b._isCrossDomain=function(a){var b=document.createElement("a");b.href=a.src;var c=document.createElement("a");return c.href=location.href,""!=b.hostname&&(b.port!=c.port||b.protocol!=c.protocol||b.hostname!=c.hostname)},b._isLocal=function(a){var b=document.createElement("a");return b.href=a.src,""==b.hostname&&"file:"==b.protocol},b.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b,c){this.init(a,b,c)},b=a.prototype=new createjs.AbstractLoader,c=a;c.loadTimeout=8e3,c.LOAD_TIMEOUT=0,c.BINARY="binary",c.CSS="css",c.IMAGE="image",c.JAVASCRIPT="javascript",c.JSON="json",c.JSONP="jsonp",c.MANIFEST="manifest",c.SOUND="sound",c.SVG="svg",c.TEXT="text",c.XML="xml",c.POST="POST",c.GET="GET",b._basePath=null,b._crossOrigin="",b.useXHR=!0,b.stopOnError=!1,b.maintainScriptOrder=!0,b.next=null,b._typeCallbacks=null,b._extensionCallbacks=null,b._loadStartWasDispatched=!1,b._maxConnections=1,b._currentlyLoadingScript=null,b._currentLoads=null,b._loadQueue=null,b._loadQueueBackup=null,b._loadItemsById=null,b._loadItemsBySrc=null,b._loadedResults=null,b._loadedRawResults=null,b._numItems=0,b._numItemsLoaded=0,b._scriptOrder=null,b._loadedScripts=null,b.init=function(a,b,c){this._numItems=this._numItemsLoaded=0,this._paused=!1,this._loadStartWasDispatched=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=b,this.setUseXHR(a),this._crossOrigin=!0===c?"Anonymous":!1===c||null==c?"":c},b.setUseXHR=function(a){return this.useXHR=0!=a&&null!=window.XMLHttpRequest,this.useXHR},b.removeAll=function(){this.remove()},b.remove=function(a){var b=null;if(!a||a instanceof Array){if(a)b=a;else if(arguments.length>0)return}else b=[a];var c=!1;if(b){for(;b.length;){var d=b.pop(),e=this.getResult(d);for(f=this._loadQueue.length-1;f>=0;f--)if((g=this._loadQueue[f].getItem()).id==d||g.src==d){this._loadQueue.splice(f,1)[0].cancel();break}for(f=this._loadQueueBackup.length-1;f>=0;f--)if((g=this._loadQueueBackup[f].getItem()).id==d||g.src==d){this._loadQueueBackup.splice(f,1)[0].cancel();break}if(e)delete this._loadItemsById[e.id],delete this._loadItemsBySrc[e.src],this._disposeItem(e);else for(var f=this._currentLoads.length-1;f>=0;f--){var g=this._currentLoads[f].getItem();if(g.id==d||g.src==d){this._currentLoads.splice(f,1)[0].cancel(),c=!0;break}}}c&&this._loadNext()}else{this.close();for(var h in this._loadItemsById)this._disposeItem(this._loadItemsById[h]);this.init(this.useXHR)}},b.reset=function(){this.close();for(var a in this._loadItemsById)this._disposeItem(this._loadItemsById[a]);for(var b=[],c=0,d=this._loadQueueBackup.length;d>c;c++)b.push(this._loadQueueBackup[c].getItem());this.loadManifest(b,!1)},c.isBinary=function(a){switch(a){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},c.isText=function(a){switch(a){case createjs.LoadQueue.TEXT:case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.XML:case createjs.LoadQueue.HTML:case createjs.LoadQueue.CSS:case createjs.LoadQueue.SVG:case createjs.LoadQueue.JAVASCRIPT:return!0;default:return!1}},b.installPlugin=function(a){if(null!=a&&null!=a.getPreloadHandlers){var b=a.getPreloadHandlers();if(b.scope=a,null!=b.types)for(var c=0,d=b.types.length;d>c;c++)this._typeCallbacks[b.types[c]]=b;if(null!=b.extensions)for(c=0,d=b.extensions.length;d>c;c++)this._extensionCallbacks[b.extensions[c]]=b}},b.setMaxConnections=function(a){this._maxConnections=a,!this._paused&&this._loadQueue.length>0&&this._loadNext()},b.loadFile=function(a,b,c){if(null==a){var d=new createjs.Event("error");return d.text="PRELOAD_NO_FILE",void this._sendError(d)}this._addItem(a,null,c),!1!==b?this.setPaused(!1):this.setPaused(!0)},b.loadManifest=function(a,b,d){var e=null,f=null;if(a instanceof Array){if(0==a.length)return(g=new createjs.Event("error")).text="PRELOAD_MANIFEST_EMPTY",void this._sendError(g);e=a}else if("string"==typeof a)e=[{src:a,type:c.MANIFEST}];else{if("object"!=typeof a)return(g=new createjs.Event("error")).text="PRELOAD_MANIFEST_NULL",void this._sendError(g);if(void 0!==a.src){if(null==a.type)a.type=c.MANIFEST;else if(a.type!=c.MANIFEST){var g=new createjs.Event("error");g.text="PRELOAD_MANIFEST_ERROR",this._sendError(g)}e=[a]}else void 0!==a.manifest&&(e=a.manifest,f=a.path)}for(var h=0,i=e.length;i>h;h++)this._addItem(e[h],f,d);!1!==b?this.setPaused(!1):this.setPaused(!0)},b.load=function(){this.setPaused(!1)},b.getItem=function(a){return this._loadItemsById[a]||this._loadItemsBySrc[a]},b.getResult=function(a,b){var c=this._loadItemsById[a]||this._loadItemsBySrc[a];if(null==c)return null;var d=c.id;return b&&this._loadedRawResults[d]?this._loadedRawResults[d]:this._loadedResults[d]},b.setPaused=function(a){this._paused=a,this._paused||this._loadNext()},b.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},b._addItem=function(a,b,c){var d=this._createLoadItem(a,b,c);if(null!=d){var e=this._createLoader(d);null!=e&&(this._loadQueue.push(e),this._loadQueueBackup.push(e),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&d.type==createjs.LoadQueue.JAVASCRIPT&&e instanceof createjs.XHRLoader&&(this._scriptOrder.push(d),this._loadedScripts.push(null)))}},b._createLoadItem=function(a,b,c){var d=null;switch(typeof a){case"string":d={src:a};break;case"object":d=window.HTMLAudioElement&&a instanceof window.HTMLAudioElement?{tag:a,src:d.tag.src,type:createjs.LoadQueue.SOUND}:a;break;default:return null}var e=this._parseURI(d.src);null!=e&&(d.ext=e[6]),null==d.type&&(d.type=this._getTypeByExtension(d.ext));var f="",g=c||this._basePath,h=d.src;if(e&&null==e[1]&&null==e[3])if(b){f=b;var i=this._parsePath(b);h=b+h,null!=g&&i&&null==i[1]&&null==i[2]&&(f=g+f)}else null!=g&&(f=g);if(d.src=f+d.src,d.path=f,(d.type==createjs.LoadQueue.JSON||d.type==createjs.LoadQueue.MANIFEST)&&(d._loadAsJSONP=null!=d.callback),d.type==createjs.LoadQueue.JSONP&&null==d.callback)throw new Error("callback is required for loading JSONP requests.");(void 0===d.tag||null===d.tag)&&(d.tag=this._createTag(d)),(void 0===d.id||null===d.id||""===d.id)&&(d.id=h);var j=this._typeCallbacks[d.type]||this._extensionCallbacks[d.ext];if(j){var k=j.callback.call(j.scope,d.src,d.type,d.id,d.data,f,this);if(!1===k)return null;!0===k||(null!=k.src&&(d.src=k.src),null!=k.id&&(d.id=k.id),null!=k.tag&&(d.tag=k.tag),null!=k.completeHandler&&(d.completeHandler=k.completeHandler),k.type&&(d.type=k.type),null!=(e=this._parseURI(d.src))&&null!=e[6]&&(d.ext=e[6].toLowerCase()))}return this._loadItemsById[d.id]=d,this._loadItemsBySrc[d.src]=d,d},b._createLoader=function(a){var b=this.useXHR;switch(a.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:b=!a._loadAsJSONP;break;case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:b=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:b=!1;break;case null:return null}return b?new createjs.XHRLoader(a,this._crossOrigin):new createjs.TagLoader(a)},b._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var a=0;a<this._loadQueue.length&&!(this._currentLoads.length>=this._maxConnections);a++){var b=this._loadQueue[a];if(this.maintainScriptOrder&&b instanceof createjs.TagLoader&&b.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(a,1),a--,this._loadItem(b)}}},b._loadItem=function(a){a.on("progress",this._handleProgress,this),a.on("complete",this._handleFileComplete,this),a.on("error",this._handleFileError,this),this._currentLoads.push(a),this._sendFileStart(a.getItem()),a.load()},b._handleFileError=function(a){var b=a.target;this._numItemsLoaded++,this._updateProgress();var c=new createjs.Event("error");c.text="FILE_LOAD_ERROR",c.item=b.getItem(),this._sendError(c),this.stopOnError||(this._removeLoadItem(b),this._loadNext())},b._handleFileComplete=function(a){var b=a.target,c=b.getItem();if(this._loadedResults[c.id]=b.getResult(),b instanceof createjs.XHRLoader&&(this._loadedRawResults[c.id]=b.getResult(!0)),this._removeLoadItem(b),this.maintainScriptOrder&&c.type==createjs.LoadQueue.JAVASCRIPT){if(!(b instanceof createjs.TagLoader))return this._loadedScripts[createjs.indexOf(this._scriptOrder,c)]=c,void this._checkScriptLoadOrder(b);this._currentlyLoadingScript=!1}if(delete c._loadAsJSONP,c.type==createjs.LoadQueue.MANIFEST){var d=b.getResult();null!=d&&void 0!==d.manifest&&this.loadManifest(d,!0)}this._processFinishedLoad(c,b)},b._processFinishedLoad=function(a,b){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(a,b),this._loadNext()},b._checkScriptLoadOrder=function(){for(var a=this._loadedScripts.length,b=0;a>b;b++){var c=this._loadedScripts[b];if(null===c)break;if(!0!==c){var d=this._loadedResults[c.id];(document.body||document.getElementsByTagName("body")[0]).appendChild(d),this._processFinishedLoad(c),this._loadedScripts[b]=!0}}},b._removeLoadItem=function(a){for(var b=this._currentLoads.length,c=0;b>c;c++)if(this._currentLoads[c]==a){this._currentLoads.splice(c,1);break}},b._handleProgress=function(a){var b=a.target;this._sendFileProgress(b.getItem(),b.progress),this._updateProgress()},b._updateProgress=function(){var a=this._numItemsLoaded/this._numItems,b=this._numItems-this._numItemsLoaded;if(b>0){for(var c=0,d=0,e=this._currentLoads.length;e>d;d++)c+=this._currentLoads[d].progress;a+=c/b*(b/this._numItems)}this._sendProgress(a)},b._disposeItem=function(a){delete this._loadedResults[a.id],delete this._loadedRawResults[a.id],delete this._loadItemsById[a.id],delete this._loadItemsBySrc[a.src]},b._createTag=function(a){var b=null;switch(a.type){case createjs.LoadQueue.IMAGE:return b=document.createElement("img"),""==this._crossOrigin||this._isLocal(a)||(b.crossOrigin=this._crossOrigin),b;case createjs.LoadQueue.SOUND:return b=document.createElement("audio"),b.autoplay=!1,b;case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:case createjs.LoadQueue.MANIFEST:return b=document.createElement("script"),b.type="text/javascript",b;case createjs.LoadQueue.CSS:return b=this.useXHR?document.createElement("style"):document.createElement("link"),b.rel="stylesheet",b.type="text/css",b;case createjs.LoadQueue.SVG:return this.useXHR?b=document.createElement("svg"):(b=document.createElement("object"),b.type="image/svg+xml"),b}return null},b._getTypeByExtension=function(a){if(null==a)return createjs.LoadQueue.TEXT;switch(a.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},b._sendFileProgress=function(a,b){if(this._isCanceled())this._cleanUp();else if(this.hasEventListener("fileprogress")){var c=new createjs.Event("fileprogress");c.progress=b,c.loaded=b,c.total=1,c.item=a,this.dispatchEvent(c)}},b._sendFileComplete=function(a,b){if(!this._isCanceled()){var c=new createjs.Event("fileload");c.loader=b,c.item=a,c.result=this._loadedResults[a.id],c.rawResult=this._loadedRawResults[a.id],a.completeHandler&&a.completeHandler(c),this.hasEventListener("fileload")&&this.dispatchEvent(c)}},b._sendFileStart=function(a){var b=new createjs.Event("filestart");b.item=a,this.hasEventListener("filestart")&&this.dispatchEvent(b)},b.toString=function(){return"[PreloadJS LoadQueue]"},createjs.LoadQueue=a;var d=function(){};d.init=function(){var a=navigator.userAgent;d.isFirefox=a.indexOf("Firefox")>-1,d.isOpera=null!=window.opera,d.isChrome=a.indexOf("Chrome")>-1,d.isIOS=a.indexOf("iPod")>-1||a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1},d.init(),createjs.LoadQueue.BrowserDetect=d}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a){this.init(a)},b=a.prototype=new createjs.AbstractLoader;b._loadTimeout=null,b._tagCompleteProxy=null,b._isAudio=!1,b._tag=null,b._jsonResult=null,b.init=function(a){this._item=a,this._tag=a.tag,this._isAudio=window.HTMLAudioElement&&a.tag instanceof window.HTMLAudioElement,this._tagCompleteProxy=createjs.proxy(this._handleLoad,this)},b.getResult=function(){return this._item.type==createjs.LoadQueue.JSONP||this._item.type==createjs.LoadQueue.MANIFEST?this._jsonResult:this._tag},b.cancel=function(){this.canceled=!0,this._clean()},b.load=function(){var a=this._item,b=this._tag;clearTimeout(this._loadTimeout);var c=createjs.LoadQueue.LOAD_TIMEOUT;0==c&&(c=createjs.LoadQueue.loadTimeout),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),c),this._isAudio&&(b.src=null,b.preload="auto"),b.onerror=createjs.proxy(this._handleError,this),this._isAudio?(b.onstalled=createjs.proxy(this._handleStalled,this),b.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(b.onload=createjs.proxy(this._handleLoad,this),b.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this));var d=this.buildPath(a.src,a.values);switch(a.type){case createjs.LoadQueue.CSS:b.href=d;break;case createjs.LoadQueue.SVG:b.data=d;break;default:b.src=d}if(a.type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.JSON||a.type==createjs.LoadQueue.MANIFEST){if(null==a.callback)throw new Error("callback is required for loading JSONP requests.");if(null!=window[a.callback])throw new Error('JSONP callback "'+a.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[a.callback]=createjs.proxy(this._handleJSONPLoad,this)}(a.type==createjs.LoadQueue.SVG||a.type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.JSON||a.type==createjs.LoadQueue.MANIFEST||a.type==createjs.LoadQueue.JAVASCRIPT||a.type==createjs.LoadQueue.CSS)&&(this._startTagVisibility=b.style.visibility,b.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(b)),null!=b.load&&b.load()},b._handleJSONPLoad=function(a){this._jsonResult=a},b._handleTimeout=function(){this._clean();var a=new createjs.Event("error");a.text="PRELOAD_TIMEOUT",this._sendError(a)},b._handleStalled=function(){},b._handleError=function(){this._clean();var a=new createjs.Event("error");this._sendError(a)},b._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var a=this.getItem().tag;("loaded"==a.readyState||"complete"==a.readyState)&&this._handleLoad()},b._handleLoad=function(){if(!this._isCanceled()){var a=this.getItem(),b=a.tag;if(!(this.loaded||this._isAudio&&4!==b.readyState)){switch(this.loaded=!0,a.type){case createjs.LoadQueue.SVG:case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.CSS:b.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(b)}this._clean(),this._sendComplete()}}},b._clean=function(){clearTimeout(this._loadTimeout);var a=this.getItem(),b=a.tag;null!=b&&(b.onload=null,b.removeEventListener&&b.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),b.onstalled=null,b.onprogress=null,b.onerror=null,null!=b.parentNode&&a.type==createjs.LoadQueue.SVG&&a.type==createjs.LoadQueue.JSON&&a.type==createjs.LoadQueue.MANIFEST&&a.type==createjs.LoadQueue.CSS&&a.type==createjs.LoadQueue.JSONP&&b.parentNode.removeChild(b)),((a=this.getItem()).type==createjs.LoadQueue.JSONP||a.type==createjs.LoadQueue.MANIFEST)&&(window[a.callback]=null)},b.toString=function(){return"[PreloadJS TagLoader]"},createjs.TagLoader=a}(),this.createjs=this.createjs||{},function(){"use strict";var a=function(a,b){this.init(a,b)},b=a.prototype=new createjs.AbstractLoader;b._request=null,b._loadTimeout=null,b._xhrLevel=1,b._response=null,b._rawResponse=null,b._crossOrigin="",b.init=function(a,b){this._item=a,this._crossOrigin=b,this._createXHR(a)},b.getResult=function(a){return a&&this._rawResponse?this._rawResponse:this._response},b.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},b.load=function(){if(null!=this._request){if(this._request.onloadstart=createjs.proxy(this._handleLoadStart,this),this._request.onprogress=createjs.proxy(this._handleProgress,this),this._request.onabort=createjs.proxy(this._handleAbort,this),this._request.onerror=createjs.proxy(this._handleError,this),this._request.ontimeout=createjs.proxy(this._handleTimeout,this),1==this._xhrLevel){var a=createjs.LoadQueue.LOAD_TIMEOUT;if(0==a)a=createjs.LoadQueue.loadTimeout;else try{console.warn("LoadQueue.LOAD_TIMEOUT has been deprecated in favor of LoadQueue.loadTimeout")}catch(b){}this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),a)}this._request.onload=createjs.proxy(this._handleLoad,this),this._request.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=createjs.LoadQueue.GET?this._item.method==createjs.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(c){var d=new createjs.Event("error");d.error=c,this._sendError(d)}}else this._handleError()},b.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},b.getResponseHeader=function(a){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(a):null},b._handleProgress=function(a){if(a&&!(a.loaded>0&&0==a.total)){var b=new createjs.Event("progress");b.loaded=a.loaded,b.total=a.total,this._sendProgress(b)}},b._handleLoadStart=function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},b._handleAbort=function(){this._clean();var a=new createjs.Event("error");a.text="XHR_ABORTED",this._sendError(a)},b._handleError=function(){this._clean();var a=new createjs.Event("error");this._sendError(a)},b._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},b._handleLoad=function(){if(!this.loaded){if(this.loaded=!0,!this._checkError())return void this._handleError();this._response=this._getResponse(),this._clean(),this._generateTag()&&this._sendComplete()}},b._handleTimeout=function(a){this._clean(),new createjs.Event("error").text="PRELOAD_TIMEOUT",this._sendError(a)},b._checkError=function(){switch(parseInt(this._request.status)){case 404:case 0:return!1}return!0},b._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(a){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(a){}return null},b._createXHR=function(a){var b=this._isCrossDomain(a),c=null;if(b&&window.XDomainRequest)c=new XDomainRequest;else if(window.XMLHttpRequest)c=new XMLHttpRequest;else try{c=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(d){try{c=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(d){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(d){return!1}}}createjs.LoadQueue.isText(a.type)&&c.overrideMimeType&&c.overrideMimeType("text/plain; charset=utf-8"),this._xhrLevel="string"==typeof c.responseType?2:1;var e=null;return e=a.method==createjs.LoadQueue.GET?this.buildPath(a.src,a.values):a.src,c.open(a.method||createjs.LoadQueue.GET,e,!0),b&&c instanceof XMLHttpRequest&&1==this._xhrLevel&&c.setRequestHeader("Origin",location.origin),a.values&&a.method==createjs.LoadQueue.POST&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),createjs.LoadQueue.isBinary(a.type)&&(c.responseType="arraybuffer"),this._request=c,!0},b._clean=function(){clearTimeout(this._loadTimeout);var a=this._request;a.onloadstart=null,a.onprogress=null,a.onabort=null,a.onerror=null,a.onload=null,a.ontimeout=null,a.onloadend=null,a.onreadystatechange=null},b._generateTag=function(){var a=this._item.type,b=this._item.tag;switch(a){case createjs.LoadQueue.IMAGE:return b.onload=createjs.proxy(this._handleTagReady,this),""!=this._crossOrigin&&(b.crossOrigin="Anonymous"),b.src=this.buildPath(this._item.src,this._item.values),this._rawResponse=this._response,this._response=b,!1;case createjs.LoadQueue.JAVASCRIPT:return b=document.createElement("script"),b.text=this._response,this._rawResponse=this._response,this._response=b,!0;case createjs.LoadQueue.CSS:if(document.getElementsByTagName("head")[0].appendChild(b),b.styleSheet)b.styleSheet.cssText=this._response;else{var d=document.createTextNode(this._response);b.appendChild(d)}return this._rawResponse=this._response,this._response=b,!0;case createjs.LoadQueue.XML:e=this._parseXML(this._response,"text/xml");return this._rawResponse=this._response,this._response=e,!0;case createjs.LoadQueue.SVG:var e=this._parseXML(this._response,"image/svg+xml");return this._rawResponse=this._response,null!=e.documentElement?(b.appendChild(e.documentElement),this._response=b):this._response=e,!0;case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:var f={};try{f=JSON.parse(this._response)}catch(g){f=g}return this._rawResponse=this._response,this._response=f,!0}return!0},b._parseXML=function(a,b){var c=null;try{window.DOMParser?c=(new DOMParser).parseFromString(a,b):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async=!1,c.loadXML(a))}catch(e){}return c},b._handleTagReady=function(){this._sendComplete()},b.toString=function(){return"[PreloadJS XHRLoader]"},createjs.XHRLoader=a}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],(e=str(d,i))&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i))&&g.push(quote(d)+(gap?": ":":")+e);return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(void 0!==(d=walk(e,c))?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){"use strict";var e=10,t=16,n=4.5,r=1.5,i=[0,0,0,.5],s=!1,o={};window.captionator=o,o.CaptionatorCueStructure=function(t,n){var r=this;this.isTimeDependent=!1,this.cueSource=t,this.options=n,this.processedCue=null,this.toString=function(e){if(!1!==n.processCueHTML){var i=function(t,n){if(null===r.processedCue){var o,u,s="";for(o in t)o.match(/^\d+$/)&&t.hasOwnProperty(o)&&((u=t[o])instanceof Object&&u.children&&u.children.length?"v"===u.token?s+='<q data-voice="'+u.voice.replace(/[\"]/g,"")+"\" class='voice speaker-"+u.voice.replace(/[^a-z0-9]+/gi,"-").toLowerCase()+" webvtt-span' title=\""+u.voice.replace(/[\"]/g,"")+'">'+i(u.children,n+1)+"</q>":"c"===u.token?s+="<span class='webvtt-span webvtt-class-span "+u.classes.join(" ")+"'>"+i(u.children,n+1)+"</span>":u.timeIn>0?null===e||void 0===e||e>0&&e>=u.timeIn?s+="<span class='webvtt-span webvtt-timestamp-span' data-timestamp='"+u.token+"' data-timestamp-seconds='"+u.timeIn+"'>"+i(u.children,n+1)+"</span>":e<u.timeIn&&(s+="<span class='webvtt-span webvtt-timestamp-span webvtt-cue-future' aria-hidden='true' style='opacity: 0;' data-timestamp='"+u.token+"' data-timestamp-seconds='"+u.timeIn+"'>"+i(u.children,n+1)+"</span>"):s+=u.rawToken+i(u.children,n+1)+"</"+u.token+">":(u instanceof String||"string"==typeof u||"number"==typeof u)&&(s+=u));return!r.isTimeDependent&&0===n&&(r.processedCue=s),s}return r.processedCue};return i(this,0)}return t},this.getPlain=function(e){if(!1!==n.processCueHTML){var r=function(t,n){var s,o,i="";for(s in t)s.match(/^\d+$/)&&t.hasOwnProperty(s)&&((o=t[s])instanceof Object&&o.children&&o.children.length?o.timeIn>0?(null===e||void 0===e||e>0&&e>=o.timeIn)&&(i+=r(o.children,n+1)):i+=r(o.children,n+1):(o instanceof String||"string"==typeof o||"number"==typeof o)&&(i+=o));return i};return r(this,0)}return t.replace(/<[^>]*>/gi,"")}},o.CaptionatorCueStructure.prototype=[],o.TextTrack=function(t,n,r,i,s,u){this.onload=function(){},this.onerror=function(){},this.oncuechange=function(){},this.id=t||"",this.internalMode=o.TextTrack.OFF,this.cues=new o.TextTrackCueList(this),this.activeCues=new o.ActiveTextTrackCueList(this.cues,this),this.kind=n||"subtitles",this.label=r||"",this.language=i||"",this.src=s||"",this.readyState=o.TextTrack.NONE,this.internalDefault=u||!1,this.getMode=function(){return this.internalMode},this.setMode=function(e){if(-1===[o.TextTrack.OFF,o.TextTrack.HIDDEN,o.TextTrack.SHOWING].indexOf(e))throw new Error("Illegal mode value for track: "+e);e!==this.internalMode&&(this.internalMode=e,this.readyState===o.TextTrack.NONE&&this.src.length>0&&e>o.TextTrack.OFF&&this.loadTrack(this.src,null),this.videoNode._captionator_dirtyBit=!0,o.rebuildCaptions(this.videoNode),e===o.TextTrack.OFF&&(this.cues.length=0,this.readyState=o.TextTrack.NONE))},this.getDefault=function(){return this.internalDefault},Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode),this.__defineGetter__("default",this.getDefault)):Object.defineProperty&&(Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode}),Object.defineProperty(this,"default",{get:this.getDefault})),this.loadTrack=function(e,t){var n,r=new XMLHttpRequest;if(this.readyState===o.TextTrack.LOADED)t instanceof Function&&t(n);else{this.src=e,this.readyState=o.TextTrack.LOADING;var i=this;r.open("GET",e,!0),r.onreadystatechange=function(e){if(4===r.readyState)if(200===r.status){var s=i.videoNode._captionatorOptions||{};"metadata"===i.kind&&(s.processCueHTML=!1,s.sanitiseCueHTML=!1),n=o.parseCaptions(r.responseText,s),i.readyState=o.TextTrack.LOADED,i.cues.loadCues(n),i.activeCues.refreshCues.apply(i.activeCues),i.videoNode._captionator_dirtyBit=!0,o.rebuildCaptions(i.videoNode),i.onload.call(this),t instanceof Function&&t.call(i,n)}else i.readyState=o.TextTrack.ERROR,i.onerror()};try{r.send(null)}catch(s){i.readyState=o.TextTrack.ERROR,i.onerror(s)}}},this.addCue=function(e){if(!(e&&e instanceof o.TextTrackCue))throw new Error("The argument is null or not an instance of TextTrackCue.");this.cues.addCue(e)},this.removeCue=function(){}},o.TextTrack.NONE=0,o.TextTrack.LOADING=1,o.TextTrack.LOADED=2,o.TextTrack.ERROR=3,o.TextTrack.OFF=0,o.TextTrack.HIDDEN=1,o.TextTrack.SHOWING=2,o.TextTrackCue=function(t,n,r,i,s,u,a){if(this.id=t,this.track=a instanceof o.TextTrack?a:null,this.startTime=parseFloat(n),this.endTime=parseFloat(r)>=this.startTime?parseFloat(r):this.startTime,this.text="string"==typeof i||i instanceof o.CaptionatorCueStructure?i:"",this.settings="string"==typeof s?s:"",this.intSettings={},this.pauseOnExit=!!u,this.wasActive=!1,this.direction="horizontal",this.snapToLines=!0,this.linePosition="auto",this.textPosition=50,this.size=0,this.alignment="middle",this.settings.length){var f=this.intSettings,l=this;(s=s.split(/\s+/).filter(function(e){return e.length>0}))instanceof Array&&s.forEach(function(e){var t={D:"direction",L:"linePosition",T:"textPosition",A:"alignment",S:"size"};t[(e=e.split(":"))[0]]&&(f[t[e[0]]]=e[1]),t[e[0]]in l&&(l[t[e[0]]]=e[1])})}this.linePosition.match(/\%/)&&(this.snapToLines=!1),this.getCueAsSource=function(){return String(this.text)},this.getCueAsHTML=function(){var t=document.createDocumentFragment(),n=document.createElement("div");return n.innerHTML=String(this.text),Array.prototype.forEach.call(n.childNodes,function(e){t.appendChild(e.cloneNode(!0))}),t},this.isActive=function(){var e=0;if(this.track instanceof o.TextTrack&&(this.track.mode===o.TextTrack.SHOWING||this.track.mode===o.TextTrack.HIDDEN)&&this.track.readyState===o.TextTrack.LOADED)try{if(e=this.track.videoNode.currentTime,this.startTime<=e&&this.endTime>=e)return this.wasActive||(this.wasActive=!0,this.onenter()),!0}catch(t){return!1}return this.wasActive&&(this.wasActive=!1,this.onexit()),!1},Object.prototype.__defineGetter__?this.__defineGetter__("active",this.isActive):Object.defineProperty&&Object.defineProperty(this,"active",{get:this.isActive}),this.toString=function(){return"TextTrackCue:"+this.id+"\n"+String(this.text)},this.onenter=function(){},this.onexit=function(){}},o.TextTrackCueList=function(t){this.track=t instanceof o.TextTrack?t:null,this.getCueById=function(e){return this.filter(function(t){return t.id===e})[0]},this.loadCues=function(e){for(var t=0;t<e.length;t++)e[t].track=this.track,Array.prototype.push.call(this,e[t])},this.addCue=function(e){if(!(e&&e instanceof o.TextTrackCue))throw new Error("The argument is null or not an instance of TextTrackCue.");if(e.track!==this.track&&e.track)throw new Error("This cue is associated with a different track!");Array.prototype.push.call(this,e)},this.toString=function(){return"[TextTrackCueList]"}},o.TextTrackCueList.prototype=[],o.ActiveTextTrackCueList=function(t,n){this.refreshCues=function(){if(t.length){var e=this,r=!1,i=[].slice.call(this,0);if(this.length=0,t.forEach(function(t){t.active&&(e.push(t),e[e.length-1]!==i[e.length-1]&&(r=!0))}),r)try{n.oncuechange()}catch(s){}}},this.toString=function(){return"[ActiveTextTrackCueList]"},this.refreshCues()},o.ActiveTextTrackCueList.prototype=new o.TextTrackCueList(null);var u=function(e){this.targetObject=e,this.currentTime=0;var t=function(){};this.addEventListener=function(e,t,n){"timeupdate"===e&&t instanceof Function&&(this.timeupdateEventHandler=t)},this.attachEvent=function(e,t){"timeupdate"===e&&t instanceof Function&&(this.timeupdateEventHandler=t)},this.updateTime=function(e){isNaN(e)||(this.currentTime=e,t())}};o.rebuildCaptions=function(e){var t=e.textTracks||[],r=(e._captionatorOptions instanceof Object&&e._captionatorOptions,e.currentTime),i=[],u=[],a=[];t.forEach(function(e,t){e.mode===o.TextTrack.SHOWING&&e.readyState===o.TextTrack.LOADED&&(a=[].slice.call(e.activeCues,0),a=a.sort(function(e,t){return e.startTime>t.startTime?-1:1}),i=i.concat(a))}),u=i.map(function(e){return e.track.id+"."+e.id+":"+e.text.toString(r).length}),(!o.compareArray(u,e._captionator_previousActiveCues)||e._captionator_dirtyBit)&&(e._captionator_dirtyBit=!1,e._captionator_availableCueArea=null,e._captionator_previousActiveCues=u,o.styleCueCanvas(e),[].slice.call(e._descriptionContainerObject.getElementsByTagName("div"),0).concat([].slice.call(e._containerObject.getElementsByTagName("div"),0)).forEach(function(e){e.cueObject&&!e.cueObject.active&&(e.cueObject.rendered=!1,e.cueObject.domNode=null,e.parentElement.removeChild(e))}),i.forEach(function(t){var n,i;"metadata"!==t.track.kind&&t.mode!==o.TextTrack.HIDDEN&&(t.rendered?(n=t.domNode,i=n.getElementsByClassName("captionator-cue-inner")[0],t.text.toString(r)!==n.currentText&&(n.currentText=t.text.toString(r),i.innerHTML=n.currentText,i.spanified=!1)):(n=document.createElement("div"),i=document.createElement("span"),i.className="captionator-cue-inner",n.id=String(t.id).length?t.id:o.generateID(),n.className="captionator-cue",n.appendChild(i),n.cueObject=t,t.domNode=n,n.setAttribute("lang",t.track.language),n.currentText=t.text.toString(r),i.innerHTML=n.currentText,t.rendered=!0,"descriptions"===t.track.kind?e._descriptionContainerObject.appendChild(n):e._containerObject.appendChild(n)),"descriptions"!==t.track.kind&&o.styleCue(n,t,e))}))},o.captionify=function(a,f,l){var c=[],h=0;if((l=l instanceof Object?l:{}).minimumFontSize&&"number"==typeof l.minimumFontSize&&(e=l.minimumFontSize),l.minimumLineHeight&&"number"==typeof l.minimumLineHeight&&(t=l.minimumLineHeight),l.fontSizeVerticalPercentage&&"number"==typeof l.fontSizeVerticalPercentage&&(n=l.fontSizeVerticalPercentage),l.lineHeightRatio&&"number"!=typeof l.lineHeightRatio&&(r=l.lineHeightRatio),l.cueBackgroundColour&&l.cueBackgroundColour instanceof Array&&(i=l.cueBackgroundColour),HTMLVideoElement||a instanceof u||l.forceCaptionify){if("function"!=typeof document.createElement("video").addTextTrack&&"function"!=typeof document.createElement("video").addTrack||l.forceCaptionify){if(!s&&l.exportObjects&&(window.TextTrack=o.TextTrack,window.TextTrackCueList=o.TextTrackCueList,window.ActiveTextTrackCueList=o.ActiveTextTrackCueList,window.TextTrackCue=o.TextTrackCue,s=!0),a&&!1!==a&&void 0!==a&&null!==a)if(a instanceof Array)for(h=0;h<a.length;h++)"string"==typeof a[h]?c=c.concat([].slice.call(document.querySelectorAll(a[h]),0)):a[h].constructor===HTMLVideoElement&&c.push(a[h]);else"string"==typeof a?c=[].slice.call(document.querySelectorAll(a),0):a.constructor===HTMLVideoElement&&c.push(a);else c=[].slice.call(document.getElementsByTagName("video"),0);return!!c.length&&(c.forEach(function(e){e.addTextTrack=function(t,n,r,i,s,u,a){var c,f=["subtitles","captions","descriptions","captions","metadata","chapters"];f.slice(0,7);if(t="string"==typeof t?t:"",r="string"==typeof r?r:"",i="string"==typeof i?i:"",a="boolean"==typeof a&&a,!f.filter(function(e){return n===e}).length)throw o.createDOMException(12,"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.","SYNTAX_ERR");return!!(c=new o.TextTrack(t,n,r,i,s,null))&&(e.textTracks instanceof Array||(e.textTracks=[]),e.textTracks.push(c),c)},o.processVideoElement(c[h],f,l)}),!0)}return!1}return!1},o.parseCaptions=function(e,t){t=t instanceof Object?t:{};var n="",r=[],i="",s=[],u=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\,(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,a=/^(\d+)?:?(\d{2}):(\d{2})\.(\d+)\,(\d+)?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,f=/^(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s*(.*)/,l=/(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)/,c=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/,h=/^\[(\d{2})?:?(\d{2})\:(\d{2})\.(\d{2,3})\]\s*(.*?)$/,p=/^(DEFAULTS|DEFAULT)\s+\-\-\>\s+(.*)/g,d=/^(STYLE|STYLES)\s+\-\-\>\s*\n([\s\S]*)/g,v=/^(COMMENT|COMMENTS)\s+\-\-\>\s+(.*)/g,m=/<tt\s+xml/gi,g=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)/;if(e){var b=function(n){var s,u,a,h,p,r=new o.CaptionatorCueStructure(n,t),i=[],f=[],c=0;i=n.split(/(<\/?[^>]+>)/gi),a=r;for(s in i)if(i.hasOwnProperty(s))if("<"===(u=i[s]).substr(0,1)){if("/"===u.substr(1,1)){var m=u.substr(2).split(/[\s>]+/g)[0];if(f.length>0){var g=0;for(c=f.length-1;c>=0&&(g=c,f[c][f[c].length-1].token!==m);c--);a=f[g],f=f.slice(0,g)}}else if(u.substr(1).match(l)||u.match(/^<v\s+[^>]+>/i)||u.match(/^<c[a-z0-9\-\_\.]+>/)||u.match(/^<(b|i|u|ruby|rt)>/)||!1!==t.sanitiseCueHTML){var b={token:u.replace(/[<\/>]+/gi,"").split(/[\s\.]+/)[0],rawToken:u,children:[]};"v"===b.token?b.voice=u.match(/^<v\s*([^>]+)>/i)[1]:"c"===b.token?b.classes=u.replace(/[<\/>\s]+/gi,"").split(/[\.]+/gi).slice(1).filter(function(e){return!!e.replace(/[^a-z0-9]+/gi,"").length}):!(h=b.rawToken.match(l))||(r.isTimeDependent=!0,p=h.slice(1),b.timeIn=parseInt(60*(p[0]||0)*60,10)+parseInt(60*(p[1]||0),10)+parseInt(p[2]||0,10)+parseFloat("0."+(p[3]||0))),a.push(b),f.push(a),a=b.children}}else!1!==t.sanitiseCueHTML&&(u=u.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;"),t.ignoreWhitespace||(u=u.replace(/\n+/g,"<br />"))),a.push(u);return r},E=function(t){var n,r=0;return"string"!=typeof t?0:((n=g.exec(t))&&(n=n.slice(1),r=parseInt(60*(n[0]||0)*60,10)+parseInt(60*(n[1]||0),10)+parseInt(n[2]||0,10)+parseFloat("0."+(n[3]||0))),r)};if(r=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),m.exec(e)){var x=document.createElement("ttml");return x.innerHTML=e,[].slice.call(x.querySelectorAll("[begin],[end]"),0).map(function(n,r){var u,f=0,l=0,c=String(n.getAttribute("begin")),h=String(n.getAttribute("end")),p=n.getAttribute("id")||r;return f=E(c),l=E(h),u=!1===t.processCueHTML?n.innerHTML:b(n.innerHTML),new o.TextTrackCue(p,f,l,u,{},!1,null)})}return e.split(/\n+/g).reduce(function(e,t,n,r){return e||!!h.exec(t)},!1)?(r=r.split(/\n+/g),n="LRC"):r=r.split(/\n\n+/g),r=r.filter(function(e){return e.match(/^WEBVTT(\s*FILE)?/gi)?(n="WebVTT",!1):!!e.replace(/\s*/gi,"").length}).map(function(r,l){var m,g,y,w,E,S,T,N,C,k,x="";if(N=p.exec(r))return s=N.slice(2).join(""),s=s.split(/\s+/g).filter(function(e){return e&&!!e.length}),null;if(N=d.exec(r))return i+=N[N.length-1],null;if(N=v.exec(r))return null;for(m="LRC"===n?[r.substr(0,r.indexOf("]")+1),r.substr(r.indexOf("]")+1)]:r.split(/\n/g);!m[0].replace(/\s+/gi,"").length&&m.length>0;)m.shift();for(T=m[0].match(/^\s*[a-z0-9\-]+\s*$/gi)?String(m.shift().replace(/\s*/gi,"")):l,S=0;S<m.length;S++){var L=m[S];(C=f.exec(L))||(C=u.exec(L))||(C=a.exec(L))?(E=C.slice(1),g=parseInt(60*(E[0]||0)*60,10)+parseInt(60*(E[1]||0),10)+parseInt(E[2]||0,10)+parseFloat("0."+(E[3]||0)),y=parseInt(60*(E[4]||0)*60,10)+parseInt(60*(E[5]||0),10)+parseInt(E[6]||0,10)+parseFloat("0."+(E[7]||0)),E[8]&&(x=E[8])):(C=c.exec(L))?(E=C.slice(1),g=parseFloat(E[0]),y=g+parseFloat(E[1]),E[2]&&(x=E[2])):!(C=h.exec(L))||(E=C.slice(1,C.length-1),g=parseInt(60*(E[0]||0)*60,10)+parseInt(60*(E[1]||0),10)+parseInt(E[2]||0,10)+parseFloat("0."+(E[3]||0)),y=g),m=m.slice(0,S).concat(m.slice(S+1));break}if(!g&&!y)return null;var A=s.reduce(function(e,t,n,r){return e[t.split(":")[0]]=t.split(":")[1],e},{});A=x.split(/\s+/g).filter(function(e){return e&&!!e.length}).reduce(function(e,t,n,r){return e[t.split(":")[0]]=t.split(":")[1],e},A),x="";for(var O in A)A.hasOwnProperty(O)&&(x+=x.length?" ":"",x+=O+":"+A[O]);return w=!1===t.processCueHTML?m.join("\n"):b(m.join("\n")),k=new o.TextTrackCue(T,g,y,w,x,!1,null),k.styleData=i,k}).filter(function(e){return null!==e}),"LRC"===n&&(r.forEach(function(e,t){var i,n=0;t>0&&(n=e.startTime,(i=r[--t]).endTime<n&&(i.endTime=n))}),r=r.filter(function(e){return e.text.toString().replace(/\s*/,"").length>0})),r}throw new Error("Required parameter captionData not supplied.")},o.processVideoElement=function(e,t,n){var r=[],i=navigator.language||navigator.userLanguage;t||i.split("-")[0];if(n=n instanceof Object?n:{},!e.captioned){e._captionatorOptions=n,e.className+=(e.className.length?" ":"")+"captioned",e.captioned=!0,0===e.id.length&&(e.id=o.generateID());[].slice.call(e.querySelectorAll("track"),0).forEach(function(i){var s=null;s=i.querySelectorAll("source").length>0?i.querySelectorAll("source"):i.getAttribute("src");var u=e.addTextTrack(i.getAttribute("id")||o.generateID(),i.getAttribute("kind"),i.getAttribute("label"),i.getAttribute("srclang").split("-")[0],s,i.getAttribute("type"),i.hasAttribute("default"));i.track=u,u.trackNode=i,u.videoNode=e,r.push(u);var a=!1;("subtitles"===u.kind||"captions"===u.kind)&&t===u.language&&n.enableCaptionsByDefault&&(r.filter(function(e){return("captions"===e.kind||"subtitles"===e.kind)&&t===e.language&&e.mode===o.TextTrack.SHOWING}).length||(a=!0)),"chapters"===u.kind&&t===u.language&&(r.filter(function(e){return"chapters"===e.kind&&e.mode===o.TextTrack.SHOWING}).length||(a=!0)),"descriptions"===u.kind&&!0===n.enableDescriptionsByDefault&&t===u.language&&(r.filter(function(e){return"descriptions"===e.kind&&e.mode===o.TextTrack.SHOWING}).length||(a=!0)),!0===a&&r.forEach(function(e){e.trackNode.hasAttribute("default")&&e.mode===o.TextTrack.SHOWING&&(e.mode=o.TextTrack.HIDDEN)}),i.hasAttribute("default")&&(r.filter(function(e){return!(!e.trackNode.hasAttribute("default")||e.trackNode===i)}).length||(a=!0,u.internalDefault=!0)),!0===a&&(u.mode=o.TextTrack.SHOWING)}),e.addEventListener("timeupdate",function(e){var t=e.target;try{t.textTracks.forEach(function(e){e.activeCues.refreshCues.apply(e.activeCues)})}catch(r){}n.renderer instanceof Function?n.renderer.call(o,t):o.rebuildCaptions(t)},!1),window.addEventListener("resize",function(t){e._captionator_dirtyBit=!0,o.rebuildCaptions(e)},!1),!0===n.enableHighResolution&&window.setInterval(function(){try{e.textTracks.forEach(function(e){e.activeCues.refreshCues.apply(e.activeCues)})}catch(r){}n.renderer instanceof Function?n.renderer.call(o,e):o.rebuildCaptions(e)},20)}return e},o.getNodeMetrics=function(e){var t=window.getComputedStyle(e,null),n=e,r=e.offsetTop,i=e.offsetLeft,s=e,o=0,u=0;for(s=parseInt(t.getPropertyValue("width"),10),o=parseInt(t.getPropertyValue("height"),10);n=n.offsetParent;)r+=n.offsetTop,i+=n.offsetLeft;if(e.hasAttribute("controls")){var a=navigator.userAgent.toLowerCase();-1!==a.indexOf("chrome")?u=32:-1!==a.indexOf("opera")?u=25:-1!==a.indexOf("firefox")?u=28:-1!==a.indexOf("ie 9")||-1!==a.indexOf("ipad")?u=44:-1!==a.indexOf("safari")&&(u=25)}else if(e._captionatorOptions){var f=e._captionatorOptions;f.controlHeight&&(u=parseInt(f.controlHeight,10))}return{left:i,top:r,width:s,height:o,controlHeight:u}},o.applyStyles=function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e.style[n]=t[n])},o.checkDirection=function(e){var t="A-Za-z--------",n="---",r=new RegExp("^[^"+n+"]*["+t+"]");return new RegExp("^[^"+t+"]*["+n+"]").test(e)?"rtl":r.test(e)?"ltr":""},o.styleCue=function(s,u,a){var p,d,g,y,b,w,E,S,x,T,_,D,B,z,f=0,l=0,c=0,h=0,v=0,m=0,N=0,C=0,k=0,L=0,A=0,O=0,M=0,P=0,H=a._captionatorOptions||{},F=50,I=0,q=0,R=!0,U="",X=(u.track.language,function(e){if(e.spanified)return e.characterCount;var r,i,s,u,n="<span class='captionator-cue-character'>",a=0;for(r in e.childNodes)e.childNodes.hasOwnProperty(r)&&!e.childNodes[r].nospan&&(3===(i=e.childNodes[r]).nodeType?(u=document.createDocumentFragment(),s=i.nodeValue,u.appendChild(document.createElement("span")),u.childNodes[0].innerHTML=n+s.split(/(.)/).filter(function(e){return!!e.length}).join("</span>"+n)+"</span>",[].slice.call(u.querySelectorAll("span.captionator-cue-character"),0).forEach(function(e){a++,o.applyStyles(e,{display:"block",lineHeight:"auto",height:y+"px",width:T+"px",textAlign:"center"})}),i.parentNode.replaceChild(u,i)):1===e.childNodes[r].nodeType&&(a+=X(e.childNodes[r])));return e.characterCount=a,e.spanified=!0,a});if(B=o.getNodeMetrics(a),a._captionator_availableCueArea||(a._captionator_availableCueArea={bottom:B.height-B.controlHeight,right:B.width,top:0,left:0,height:B.height-B.controlHeight,width:B.width}),"horizontal"===u.direction&&(o.applyStyles(s,{width:"auto",position:"static",display:"inline-block",padding:"1em"}),I=parseInt(s.offsetWidth,10),q=Math.floor(I/a._captionator_availableCueArea.width*100),q=q<=100?q:100),g=B.height*(n/100)/96*72,g=g>=e?g:e,y=Math.floor(g/72*96),b=Math.floor(g*r),b=b>t?b:t,x=Math.ceil(b/72*96),T=x,x*Math.floor(B.height/x)<B.height&&(x=Math.floor(B.height/Math.floor(B.height/x)),b=Math.ceil(x/96*72)),x*Math.floor(B.width/x)<B.width&&(T=Math.ceil(B.width/Math.floor(B.width/x))),E=Math.floor(a._captionator_availableCueArea.height/x),S=Math.floor(a._captionator_availableCueArea.width/T),0===parseFloat(String(u.size).replace(/[^\d\.]/gi,""))?!0===H.sizeCuesByTextBoundingBox?p=q:(p=100,R=!1):(R=!1,p=parseFloat(String(u.size).replace(/[^\d\.]/gi,"")),p=p<=100?p:100),v="horizontal"===u.direction?Math.floor(.01*B.width):0,m="horizontal"===u.direction?0:Math.floor(.01*B.height),"auto"===u.linePosition?u.linePosition="horizontal"===u.direction?E:S:String(u.linePosition).match(/\%/)&&(u.snapToLines=!1,u.linePosition=parseFloat(String(u.linePosition).replace(/\%/gi,""))),"horizontal"===u.direction)h=x,"auto"!==u.textPosition&&R&&(F=parseFloat(String(u.textPosition).replace(/[^\d\.]/gi,"")),p-F>q?p-=F:p=q),c=!0===u.snapToLines?a._captionator_availableCueArea.width*(p/100):B.width*(p/100),"auto"===u.textPosition?f=(a._captionator_availableCueArea.right-c)/2+a._captionator_availableCueArea.left:(F=parseFloat(String(u.textPosition).replace(/[^\d\.]/gi,"")),f=(a._captionator_availableCueArea.right-c)*(F/100)+a._captionator_availableCueArea.left),!0===u.snapToLines?l=(E-1)*x+a._captionator_availableCueArea.top:(w=B.controlHeight+x+2*m,l=(B.height-w)*(u.linePosition/100));else{if(l=a._captionator_availableCueArea.top,f=a._captionator_availableCueArea.right-T,c=T,h=a._captionator_availableCueArea.height*(p/100),C=X(s),k=[].slice.call(s.querySelectorAll("span.captionator-cue-character"),0),N=Math.floor((h-2*m)/y),c=Math.ceil(C/N)*T,L=Math.ceil(C/N),A=C-N*(L-1),O=A*y,!0===u.snapToLines)f="vertical-lr"===u.direction?a._captionator_availableCueArea.left:a._captionator_availableCueArea.right-c;else{var V=c+2*v;f="vertical-lr"===u.direction?(B.width-V)*(u.linePosition/100):B.width-V-(B.width-V)*(u.linePosition/100)}"auto"===u.textPosition?l=(a._captionator_availableCueArea.bottom-h)/2+a._captionator_availableCueArea.top:(u.textPosition=parseFloat(String(u.textPosition).replace(/[^\d\.]/gi,"")),l=(a._captionator_availableCueArea.bottom-h)*(u.textPosition/100)+a._captionator_availableCueArea.top),M=0,P=0,_=0,D=0,k.forEach(function(e,t){_="vertical-lr"===u.direction?T*M:c-T*(M+1),"start"===u.alignment||"start"!==u.alignment&&M<L-1?D=P*y+m:"end"===u.alignment?D=P*y-y+(h+2*m-O):"middle"===u.alignment&&(D=(h-2*m-O)/2+P*y),e.setAttribute("aria-hidden","true"),o.applyStyles(e,{position:"absolute",top:D+"px",left:_+"px"}),P>=N-1?(P=0,M++):P++}),s.accessified||(U=u.text.getPlain(a.currentTime),z=document.createElement("div"),z.innerHTML=U,z.nospan=!0,s.appendChild(z),s.accessified=!0,o.applyStyles(z,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"}))}if("horizontal"===u.direction&&(d="rtl"===o.checkDirection(String(u.text))?{start:"right",middle:"center",end:"left"}[u.alignment]:{start:"left",middle:"center",end:"right"}[u.alignment]),o.applyStyles(s,{position:"absolute",overflow:"hidden",width:c+"px",height:h+"px",top:l+"px",left:f+"px",padding:m+"px "+v+"px",textAlign:d,backgroundColor:"rgba("+i.join(",")+")",direction:o.checkDirection(String(u.text)),lineHeight:b+"pt",boxSizing:"border-box"}),"vertical"===u.direction||"vertical-lr"===u.direction)f-a._captionator_availableCueArea.left-a._captionator_availableCueArea.left>=a._captionator_availableCueArea.right-(f+c)?a._captionator_availableCueArea.right=f:a._captionator_availableCueArea.left=f+c,a._captionator_availableCueArea.width=a._captionator_availableCueArea.right-a._captionator_availableCueArea.left;else{if(s.scrollHeight>1.2*s.offsetHeight)if(u.snapToLines){for(var $=0;s.scrollHeight>1.2*s.offsetHeight;)h+=x,s.style.height=h+"px",$++;l-=$*x,s.style.top=l+"px"}else{s.scrollHeight;h=s.scrollHeight+m,w=B.controlHeight+h+2*m,l=(B.height-w)*(u.linePosition/100),s.style.height=h+"px",s.style.top=l+"px"}l-a._captionator_availableCueArea.top-a._captionator_availableCueArea.top>=a._captionator_availableCueArea.bottom-(l+h)&&a._captionator_availableCueArea.bottom>l?a._captionator_availableCueArea.bottom=l:a._captionator_availableCueArea.top<l+h&&(a._captionator_availableCueArea.top=l+h),a._captionator_availableCueArea.height=a._captionator_availableCueArea.bottom-a._captionator_availableCueArea.top}},o.styleCueCanvas=function(i){var s,u,a,f,l,c,h=i._captionatorOptions instanceof Object?i._captionatorOptions:{};if(!(i instanceof HTMLVideoElement))throw new Error("Cannot style a cue canvas for a non-video node!");if(i._containerObject&&(a=i._containerObject,l=a.id),i._descriptionContainerObject&&(f=i._descriptionContainerObject,c=f.id),f?f.parentNode||document.body.appendChild(f):(f=document.createElement("div"),f.className="captionator-cue-descriptive-container",c=o.generateID(),f.id=c,i._descriptionContainerObject=f,f.setAttribute("aria-live","polite"),f.setAttribute("aria-atomic","true"),f.setAttribute("role","region"),document.body.appendChild(f),o.applyStyles(f,{position:"absolute",overflow:"hidden",width:"1px",height:"1px",opacity:"0",textIndent:"-999em"})),a)a.parentNode||document.body.appendChild(a);else{if(a=document.createElement("div"),a.className="captionator-cue-canvas",l=o.generateID(),a.id=l,h.appendCueCanvasTo){var p=null;if(h.appendCueCanvasTo instanceof HTMLElement)p=h.appendCueCanvasTo;else if("string"==typeof h.appendCueCanvasTo)try{var d=document.querySelectorAll(h.appendCueCanvasTo);if(!(d.length>0))throw null;p=d[0]}catch(v){p=document.body,h.appendCueCanvasTo=!1}else p=document.body,h.appendCueCanvasTo=!1;p.appendChild(a)}else document.body.appendChild(a);i._containerObject=a}var m=o.getNodeMetrics(i);s=(s=m.height*(n/100)/96*72)>=e?s:e,u=(u=Math.floor(s*r))>t?u:t,o.applyStyles(a,{position:"absolute",overflow:"hidden",zIndex:100,height:m.height-m.controlHeight+"px",width:m.width+"px",top:(h.appendCueCanvasTo?0:m.top)+"px",left:(h.appendCueCanvasTo?0:m.left)+"px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",fontSize:s+"pt",lineHeight:u+"pt",boxSizing:"border-box"})},o.createDOMException=function(e,t,n){try{document.querySelectorAll("div/[]")}catch(r){var i=function(t,n,r){this.code=t,this.message=n,this.name=r};return i.prototype=r,new i(e,t,n)}},o.compareArray=function(t,n){if(t instanceof Array&&n instanceof Array){if(t.length!==n.length)return!1;for(var r in t)if(t.hasOwnProperty(r)&&t[r]!==n[r])return!1;return!0}return!1},o.generateID=function(e){var t="";for(e=e||10;t.length<e;)t+=String.fromCharCode(65+Math.floor(26*Math.random()));return"captionator"+t}}(),function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:code<NUMBER?-1:code<NUMBER+10?code-NUMBER+26+26:code<UPPER+26?code-UPPER:code<LOWER+26?code-LOWER+26:void 0}var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);exports.toByteArray=function(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;i<l;i+=4,j+=3)push((16711680&(tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3))))>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?push(255&(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4)):1===placeHolders&&(push((tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2)>>8&255),push(255&tmp)),arr},exports.fromByteArray=function(uint8){function encode(num){return lookup.charAt(num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;i<length;i+=3)output+=function(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}(temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2]);switch(extraBytes){case 1:output+=encode((temp=uint8[uint8.length-1])>>2),output+=encode(temp<<4&63),output+="==";break;case 2:output+=encode((temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1])>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}}("undefined"==typeof exports?this.base64js={}:exports),function(window){"use strict";function normalize(name){var obj,prefixes=["webkit","moz","ms"];return obj=name?name.split(".").reduce(function(current,next){if(current){var i,name=next.charAt(0).toUpperCase()+next.substr(1),ret=current[next];if(!ret){for(i=0;i<prefixes.length&&!ret&&!(ret=current[prefixes[i]+name]);++i);current[next]=ret}return ret}},window):window,{supported:!!obj,api:name,obj:obj}}function addRequirement(api,required){var polyfills,requirement;if("boolean"!=typeof required&&(required=!0),polyfills=_polyfills[api]||[],requirement=normalize(api),(polyfills=polyfills.filter(function(polyfill){return!requirement.supported||!!polyfill.fixesApi})).length>0){var tokens=api.split("."),owner=normalize(tokens.slice(0,tokens.length-1).join("."));if(owner.supported){var i,polyfillInfo,name=tokens[tokens.length-1];for(i=0;i<polyfills.length;++i)if((polyfillInfo=polyfills[i]).isSupported(normalize,requirement.obj)){var polyfill=polyfillInfo.bindToSelf?polyfillInfo.polyfill.bind(polyfillInfo):polyfillInfo.polyfill;owner.obj[name]=polyfill;break}requirement=normalize(api)}}requirement.required=required,_requirements[_requirements.length]=requirement}var _missingApis,_error,_options,_ready,defaultOptions={recording:!0,recordingSources:!1,processing:!0},_requirements=[],_polyfills={},webAudio={init:function(settings){if(!_ready){_ready=!0;try{_options=defaultOptions,addRequirement("Worker"),addRequirement("AudioContext"),addRequirement("AudioContext.prototype.decodeAudioData"),addRequirement("OfflineAudioContext",_options.processing||_options.recording),addRequirement("AudioContext.prototype.createBiquadFilter",_options.recording),addRequirement("AudioContext.prototype.createScriptProcessor",_options.recording),addRequirement("Blob",_options.recording),addRequirement("ArrayBuffer",_options.recording),addRequirement("Float32Array",_options.recording),addRequirement("Uint8Array",_options.recording),addRequirement("navigator.getUserMedia",_options.recording),addRequirement("navigator.getMediaDevices",_options.recording&&_options.recordingSources),addRequirement("AudioContext.prototype.createVolumeAnalyser",!1),addRequirement("AudioContext.prototype.createVoiceActivityDetector",_options.recording)}catch(error){console.error(error.message,error.stack),_error=error,_ready=!1}_missingApis=_requirements.filter(function(r){return r.required&&!r.supported}).map(function(r){return r.api}).sort(),(_ready=_ready&&0===_missingApis.length)&&(this.context=new AudioContext,webAudio.encoding&&webAudio.encoding.init(settings.workerFactory,settings.encodingWorkerUrl))}},isReady:function(){return!!_ready},getStatus:function(endl){return this.isReady()?"ready":(endl=endl||"\n",_missingApis.length>0?["not supported: missing apis"].concat(_missingApis).join(endl):_error?"not supported: "+_error.message+endl+_error.stack.replace(/\n/g,endl):"not supported: unkown error")},addPolyfill:function(api,polyfill){var polyfills=_polyfills[api];polyfills||(polyfills=[],_polyfills[api]=polyfills),polyfills[polyfills.length]=polyfill}};window.webAudio=webAudio}(window),function(window,webAudio){"use strict";webAudio.Resampler={resample:function(channelData,sampleRate,encodeRate,numberOfChannels,callback){if(sampleRate!==encodeRate){var buffer,input,channel,context,length=channelData[0].length*(encodeRate/sampleRate);for(buffer=(context=new OfflineAudioContext(numberOfChannels,length,sampleRate)).createBuffer(numberOfChannels,length,sampleRate),channel=0;channel<numberOfChannels;++channel)buffer.getChannelData(channel).set(channelData[channel],0);(input=context.createBufferSource()).buffer=buffer,input.connect(context.destination),context.oncomplete=function(event){var channel,channelData=[];for(channel=0;channel<numberOfChannels;++channel)channelData[channel]=new Float32Array(event.renderedBuffer.getChannelData(channel));callback(channelData)},input.start(context.currentTime),context.startRendering()}else callback(channelData)}}}(window,webAudio),function(window,webAudio){"use strict";function Player(continuousPlay){this.playlist=new webAudio.Playlist,this.context=webAudio.context,this.pauseInfo={lastStartTime:null,elapsedTime:0,track:null},this.playing=!1,this.hasStarted=!1,this._continuousPlay=!!continuousPlay}Player.prototype.handleEvent=function(event){var handler=this["on"+event.type];if("function"==typeof handler)return handler.call(this,event)},Player.prototype.getCurrentTrack=function(){return this.playlist.getCurrentTrack()},Player.prototype.play=function(){this.playing||(this.changeTrack(this.getCurrentTrack(),!1),this.playing=!0,this._input.start(this.context.currentTime,this.pauseInfo.elapsedTime),this.pauseInfo.lastStartTime=this.context.currentTime)},Player.prototype._stopInput=function(){this._input&&(this._input.onended=null,this._input.stop(),this._input.disconnect(),this._input=null)},Player.prototype.pause=function(){this._stopInput(),this.pauseInfo.elapsedTime+=this.context.currentTime-this.pauseInfo.lastStartTime,this.playing=!1},Player.prototype.stop=function(){this._stopInput(),this.pauseInfo.elapsedTime=0,this.playing=!1},Player.prototype.seek=function(time){},Player.prototype.volume=function(volume){},Player.prototype.createInput=function(buffer){this._input=this.context.createBufferSource(),this._input.connect(this.context.destination),this._input.buffer=buffer},Player.prototype.changeTrack=function(track,autoPlay){var buffer,wasPlaying=this.playing,self=this;"number"==typeof track&&(track=this.playlist.getTrack(track)),null!==track&&(this.playlist.setTrack(track),buffer=track.toAudioBuffer(this.context),"boolean"!=typeof autoPlay&&(autoPlay=!0),wasPlaying&&0===this.pauseInfo.elapsedTime&&this.stop(),this.createInput(buffer),this._input.onended=function(e){"function"==typeof self.ontrackend&&self.ontrackend(track),self.stop(),self.advanceTrack()},autoPlay&&this.play())},Player.prototype.advanceTrack=function(){var track=this.playlist.advanceTrack();null===track?"function"==typeof this.onplaylistend&&this.onplaylistend():this._continuousPlay&&this.changeTrack(track)},Player.prototype.ontrackend=null,Player.prototype.onplaylistend=null,webAudio.Player=Player}(window,webAudio),function(window,webAudio){"use strict";function Playlist(){this._playlist=[],this._nextId=0,this._currentIndex=-1}Playlist.prototype.addTracks=function(){var i,id,track,tracks=Array.prototype.slice.call(arguments);for(i=0;i<tracks.length;++i)track=tracks[i],id=this._nextId++,track.id=id,track.name=track.name||"Track "+(id+1),this._playlist.push(track);this._currentIndex<0&&this._playlist.length>0&&(this._currentIndex=0)},Playlist.prototype.setTrack=function(track){this.getTrack(track.id)||this.addTracks(track);var i;for(i=0;i<this._playlist.length;++i)if(track===this._playlist[i]){this._currentIndex=i;break}},Playlist.prototype.removeTracks=function(){var i,track,ids=Array.prototype.slice.call(arguments);for(i=0;i<this._playlist.length;++i)track=this._playlist[i],-1!==ids.indexOf(track.id)&&(this._playlist.splice(i,1),this._currentIndex>i&&--this._currentIndex,--i);0===this._playlist.length&&(this._currentIndex=-1)},Playlist.prototype.removeAllTracks=function(){var ids=this._playlist.map(function(track){return track.id});this.removeTracks.apply(this,ids)},Playlist.prototype.getTrack=function(id){var matches=this._playlist.filter(function(track){return track.id===id});return matches.length?matches[0]:null},Playlist.prototype.getCurrentTrack=function(){return this._currentIndex<0?null:this._playlist.length?this._playlist[this._currentIndex]:null},Playlist.prototype.advanceTrack=function(){if(this._currentIndex<0)return null;if(this._currentIndex===this._playlist.length-1){if(!this.loop)return null;this._currentIndex=0}else++this._currentIndex;return this.getCurrentTrack()},webAudio.Playlist=Playlist}(window,window.webAudio),function(window,webAudio){"use strict";function Track(audioBuffer){this.audioBuffer=audioBuffer,Object.defineProperties(this,{audioBuffer:{value:audioBuffer,writeable:!1,enumerable:!0,configurable:!1},sampleRate:{enumerable:!0,configurable:!1,get:function(){return this.audioBuffer.sampleRate}}})}Track.fromPCM=function(channelData,sampleRate,context){var channel,numberOfChannels=channelData.length,audioBuffer=context.createBuffer(numberOfChannels,channelData[0].length,sampleRate);for(channel=0;channel<numberOfChannels;++channel)audioBuffer.getChannelData(channel).set(channelData[channel],0);return new Track(audioBuffer)},Track.prototype.toPCM=function(){var currentChannel,channel,numberOfChannels=this.audioBuffer.numberOfChannels,channelData=[];for(channel=0;channel<numberOfChannels;++channel)currentChannel=this.audioBuffer.getChannelData(channel),channelData[channel]=new Float32Array(currentChannel.length),channelData[channel].set(currentChannel,0);return{channelData:channelData,sampleRate:this.audioBuffer.sampleRate}},Track.prototype.toAudioBuffer=function(context){return this.audioBuffer},Track.fromArrayBuffer=function(buffer,context,format,callback,errorCallback){var success,failure;success=function(audioBuffer){var track=new Track(audioBuffer);callback(track)},failure=function(){webAudio.encoding.decode(buffer,format,function(track){callback(track)},function(error){errorCallback&&errorCallback(error)})},context.decodeAudioData(buffer,success,failure)},Track.fromBlob=function(blob,context,callback){var reader=new FileReader;reader.addEventListener("loadend",function(){Track.fromArrayBuffer(reader.result,context,null,callback)}),reader.readAsArrayBuffer(blob)},webAudio.Track=Track}(window,webAudio),function(window,webAudio){"use strict";function Recorder(options){this._options=options||{},this._initialized=!1,this._context=webAudio.context,this._input=null,this._inputMediaStream=null,this._active=!1,this._channelBuffers=[],this._bufferCount=0,this.encoder=null,this._isRecording=!1,this._initOptions()}Recorder.prototype.handleEvent=function(event){var handler=this["on"+event.type];if("function"==typeof handler)return handler.call(this,event)};var defaultOptions={bufferSize:16384};Recorder.prototype._initOptions=function(){this._options.bufferSize=this._options.bufferSize||defaultOptions.bufferSize,this.setSource(this._options.source)},Recorder.prototype.setSource=function(source){this._options.source=source instanceof webAudio.RecorderSource?source:new webAudio.RecorderSource,this._initialized=!1,this._inputMediaStream&&this._inputMediaStream.stop&&this._inputMediaStream.stop(),this._input&&this._input.disconnect()},Recorder.prototype.setSourceDevice=function(device){this.setSource(new webAudio.RecorderSource(device))},Recorder.prototype.startRecording=function(callback,errorCallback,mediaDeviceErrorCallback){try{if(!this._initialized)return void this.initiateRecording(callback,mediaDeviceErrorCallback);if(this._active)return;this.filter=this._context.createBiquadFilter(),this.filter.type="lowpass",this.filter.frequency.value=4e3,this.filter.channelCount=1,this._vadNode=this._context.createVoiceActivityDetector(),this._input.connect(this.filter),this._input.connect(this._vadNode.head),this._active=!0,this._initiateStreamingEncoder(this._options.streamingEncoderFormat),this._isRecording=!0,"function"==typeof callback&&callback()}catch(error){errorCallback(error.stack||error.message||error.toString())}},Recorder.prototype._initiateStreamingEncoder=function(format){this.encoder=webAudio.encoding.createEncoder(this._options.streamingEncoderFormat);var self=this;this.encoder.onencodingcomplete=function(buffer){self._oncomplete(buffer)},this.encoder.onencodingerror=function(error){self._onerror(error)},this.encoder.start(this.filter)},Recorder.prototype.initiateRecording=function(callback,errorCallback){var self=this;this._options.source.getStreamContainer(function(streamContainer){self._inputMediaStream=streamContainer.stream,self._input=streamContainer.streamSourceNode,self._inputMediaStream.enabled=!1,self._initialized=!0,self.startRecording(callback)},errorCallback)},Recorder.prototype.stopRecording=function(){this._active=!1,this._vadNode.disconnect(),"function"==typeof this.onbeforestop&&this.onbeforestop(),this.encoder.stop(),this.encoder=null,this._isRecording=!1},Recorder.prototype.getQuality=function(){return this._vadNode&&this._vadNode.getQuality()||null},Recorder.prototype.isRecording=function(){return this._isRecording},Recorder.prototype.onbeforestop=function(){},Recorder.prototype._oncomplete=function(buffer){this._input.disconnect(),"function"==typeof this.oncomplete&&this.oncomplete(buffer)},Recorder.prototype.oncomplete=function(){},Recorder.prototype._onerror=function(error){this._input.disconnect(),this._vadNode.disconnect(),"function"==typeof this.onerror&&this.onerror(error)},Recorder.prototype.onerror=function(){},webAudio.addPolyfill("AudioContext.prototype.createScriptProcessor",{fixesApi:!1,bindToSelf:!1,isSupported:function(normalize){var normalized=normalize("AudioContext.prototype.createJavaScriptNode");return this.polyfill=normalized.obj,normalized.supported}}),webAudio.Recorder=Recorder}(window,webAudio),function(window,webAudio){"use strict";webAudio.addPolyfill("navigator.getUserMedia",{fixesApi:!0,bindToSelf:!0,isSupported:function(normalize,native){return!!normalize("MediaStreamTrack.getSources").supported&&(this.getUserMedia=native,!0)},polyfill:function(constraints,successCallback,errorCallback){"object"==typeof constraints.audio&&constraints.audio.sourceId&&(constraints.audio.optional=constraints.audio.optional||[],constraints.audio.optional.push({sourceId:constraints.audio.sourceId}),delete constraints.audio.sourceId),this.getUserMedia.call(navigator,constraints,successCallback,errorCallback)}}),webAudio.addPolyfill("navigator.getMediaDevices",{fixesApi:!1,bindToSelf:!1,isSupported:function(normalize){return normalize("MediaStreamTrack.getSources").supported},polyfill:function(callback){window.MediaStreamTrack.getSources(function(devices){devices=devices.map(function(d){return{deviceId:d.id,kind:d.kind+"input",label:d.label,groupId:null}}),callback(devices)})}})}(window,webAudio),function(window,webAudio){function getDeviceList(){return SecureBrowser.audioDevices.length?SecureBrowser.audioDevices:deviceCache&&deviceCache.length?deviceCache:[]}function grantPermissionForDevice(constraints,device){if(!device){var kind=constraints.video?"video":"audio",devices=getDeviceList().filter(function(device){return device.type===kind}),preferredDevices=devices.map(function(device){return{match:device.name.match(/(default|usb)/i),device:device}}).filter(function(obj){return!!obj.match}).sort(function(obj1,obj2){if(obj1.match[1]===obj2.match[1])return 0;if("default"===obj1.match[1].toLowerCase())return-1;if("default"===obj2.match[1].toLowerCase())return 1;throw new Error("invalid matched value in device name")}).map(function(obj){return obj.device});device=preferredDevices.length?preferredDevices[0]:devices[0]}SecureBrowser.selectAudioDevice(device)}function checkForAudioDevices(callback,timeout){devicesAvailable?callback(getDeviceList().map(function(d){return{deviceId:d.id,kind:d.type+"input",label:d.name,groupId:null}})):setTimeout(checkForAudioDevices.bind(null,callback,timeout),timeout)}var deviceCache,devicesAvailable=!1,requestsForDevice=[];window.AIRAudioRecorder={audioDevicesAvailable:function(){if(devicesAvailable=!0,deviceCache=SecureBrowser.audioDevices.slice(),requestsForDevice.length){var request=requestsForDevice.shift();grantPermissionForDevice(request.constraints,request.device)}}},webAudio.addPolyfill("navigator.getUserMedia",{fixesApi:!0,bindToSelf:!0,isSupported:function(normalize,native){return!("undefined"==typeof SecureBrowser||!SecureBrowser.audioDevices||!SecureBrowser.selectAudioDevice)&&(this.getUserMedia=native,!0)},polyfill:function(constraints,successCallback,errorCallback){var device=null;constraints.audio&&constraints.audio.sourceId&&((device=getDeviceList().filter(function(device){return device.id===constraints.audio.sourceId})[0])||console.warn('unknown device requested, deviceId: "'+constraints.audio.sourceId+'"'),delete constraints.audio.sourceId),requestsForDevice.push({constraints:constraints,device:device}),this.getUserMedia.call(navigator,constraints,successCallback,errorCallback)}}),webAudio.addPolyfill("navigator.getMediaDevices",{fixesApi:!1,bindToSelf:!1,isSupported:function(normalize){return!("undefined"==typeof SecureBrowser||!SecureBrowser.audioDevices)},polyfill:function(callback){window.navigator.getUserMedia({audio:!0},function(stream){stream.stop()},function(error){console.error("error enumerating devices for navigator.getUserMedia: ",error),devicesAvailable=!0,deviceCache=[]}),checkForAudioDevices(callback,1e3)}})}(window,webAudio),function(window,webAudio){"use strict";function StreamContainer(stream){this.stream=stream,this.streamSourceNode=webAudio.context.createMediaStreamSource(stream)}function RecorderSource(device){device=device||{deviceId:null,label:""},this.deviceId=device.deviceId,this.label=device.label,this._streamContainer=null}RecorderSource.prototype.getStreamContainer=function(successCallback,errorCallback){var constraints={audio:{}};null!==this.deviceId&&(constraints.audio.sourceId=this.deviceId);var self=this;window.navigator.getUserMedia(constraints,function(stream){self._streamContainer=new StreamContainer(stream),successCallback(self._streamContainer)},function(error){"string"!=typeof error&&(error=error.name),"string"!=typeof error&&(error="Unkown error"),errorCallback(error)})},RecorderSource.getAudioSources=function(callback){if("function"!=typeof window.navigator.getMediaDevices)return console.warn("device enumeration is not supported on this browser"),void callback([new RecorderSource]);window.navigator.getMediaDevices(function(devices){var recorderSources,i=0;recorderSources=devices.filter(function(d){return"audioinput"===d.kind}).map(function(d){return d.label||(d.label="audioinput"+i++),new RecorderSource(d)}),callback(recorderSources)})},webAudio.RecorderSource=RecorderSource}(window,webAudio),function(window,webAudio){"use strict";function startEncoding(id,sampleRate,numberOfChannels){var encoder=callbacks[id];encodingWorker.postMessage({command:"start",encoderName:encoder.format.name,format:encoder.format.format,id:id,sampleRate:sampleRate,numberOfChannels:numberOfChannels})}function appendData(id,channelData){var encoder=callbacks[id],buffers=channelData.map(function(typedArray){return typedArray.buffer});encodingWorker.postMessage({command:"append",encoderName:encoder.format.name,id:id,channelData:channelData},buffers)}function endEncoding(id){var encoder=callbacks[id];encodingWorker.postMessage({command:"end",encoderName:encoder.format.name,id:id})}function encodingComplete(buffer,id,time){var callbackInfo;(callbackInfo=callbacks[id])instanceof webAudio.Encoder?callbackInfo._notify(buffer):(callbackInfo.complete(buffer,callbackInfo.encoder),delete callbacks[id])}function encodingError(error,id){var callbackInfo=callbacks[id];delete callbacks[id],callbackInfo instanceof webAudio.Encoder?callbackInfo._notify(error):"function"==typeof callbackInfo.error?callbackInfo.error(error):console.error(error)}function decodingComplete(track,id,time){var callbackInfo,track=new webAudio.Track.fromPCM(track.channelData,track.sampleRate,webAudio.context);callbackInfo=callbacks[id],delete callbacks[id],callbackInfo.complete(track,callbackInfo.encoder)}function decodingError(error,id){var callbackInfo=callbacks[id];delete callbacks[id],"function"==typeof callbackInfo.error?callbackInfo.error(error):console.error(error)}var encodingWorker,containerFormats={wav:{name:"wav",extension:"wav",type:"audio/wav",format:"int16"},opus:{name:"opus",extension:"ogg",type:'audio/ogg; codecs="opus"',format:"int16"}},nextId=0,callbacks={};webAudio.encoding={encode:function(track,encoder,options,complete,error,progress){var id=nextId++;"function"==typeof options&&(progress=error,error=complete,complete=options,options={}),callbacks[id]={complete:complete,encoder:encoder,error:error,progress:progress};var pcm=track.toPCM(),transferrable=pcm.channelData.map(function(typed){return typed.buffer});encodingWorker.postMessage({command:"encode",encoderName:encoder.name,track:pcm,options:options,id:id},transferrable)},createEncoder:function(format){var id=nextId++,encoder=new webAudio.Encoder(id,format,{start:startEncoding,append:appendData,end:endEncoding});return callbacks[id]=encoder,encoder},decode:function(buffer,encoding,options,complete,error,progress){var id=nextId++;"function"==typeof options&&(progress=error,error=complete,complete=options,options={}),callbacks[id]={complete:complete,encoder:encoding,error:error,progress:progress},encodingWorker.postMessage({command:"decode",encoderName:encoding.name,track:buffer,options:options,id:id},[buffer])},saveAs:function(filename){return function(buffer,format){var blob=new Blob([buffer],{type:format.type}),url=(window.URL||window.webkitURL).createObjectURL(blob),link=window.document.createElement("a"),click=document.createEvent("MouseEvents");link.href=url,link.download=filename+"."+format.extension,click.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),link.dispatchEvent(click)}},format:containerFormats,init:function(workerFactory,workerUrl){(encodingWorker=workerFactory.create(workerUrl)).addEventListener("message",function(event){switch(event.data.command){case"log":console.log(event.data.message);break;case"encode":case"end":switch(event.data.status){case"complete":encodingComplete(event.data.result,event.data.id,event.data.time);break;case"error":encodingError(event.data.error,event.data.id)}break;case"decode":switch(event.data.status){case"complete":decodingComplete(event.data.result,event.data.id,event.data.time);break;case"error":decodingError(event.data.error,event.data.id)}break;case"resamplerequest":var channelData=event.data.channelData,sampleRate=event.data.sampleRate,encodeRate=event.data.encodeRate,numberOfChannels=event.data.numberOfChannels;webAudio.Resampler.resample(channelData,sampleRate,encodeRate,numberOfChannels,function(channelData){var transferrables=channelData.map(function(typedArray){return typedArray.buffer});encodingWorker.postMessage({command:"resampleresult",id:event.data.id,channelData:channelData},transferrables)})}}),encodingWorker.addEventListener("error",function(event){console.log("encodingWorker error: ",event)})}}}(window,webAudio),function(webAudio){"use strict";function Encoder(id,format,worker){this._worker=worker,this.format=format,this.id=id,this._processor=null,this._disconnected=!0,this._channelCount=null,this._sampleRate=null,this._durationOfSilenceToAppend=null}Encoder.prototype.start=function(audioNode){this._disconnected=!1,this._channelCount=audioNode.channelCount,this._sampleRate=audioNode.context.sampleRate,this._worker.start(this.id,this._sampleRate,this._channelCount),this._processor=audioNode.context.createScriptProcessor(16384,this._channelCount,1);var self=this;this._processor.onaudioprocess=function(e){e.inputBuffer;var channel,channelData=[];for(channel=0;channel<e.inputBuffer.numberOfChannels;++channel)channelData[channel]=new Float32Array(e.inputBuffer.getChannelData(channel));self._append(channelData),self._disconnected&&(self._end(),self._processor.disconnect(),audioNode.disconnect())},audioNode.connect(this._processor),this._processor.connect(audioNode.context.destination)},Encoder.prototype.appendSilence=function(duration){this._durationOfSilenceToAppend=duration},Encoder.prototype._appendSilence=function(){var i,channelData=[],samples=this._durationOfSilenceToAppend*this._sampleRate;for(i=0;i<this._channelCount;++i)channelData[channelData.length]=new Float32Array(samples);this._append(channelData)},Encoder.prototype._append=function(channelData){this._worker.append(this.id,channelData)},Encoder.prototype._end=function(){null!==this._durationOfSilenceToAppend&&this._appendSilence(),this._worker.end(this.id)},Encoder.prototype.stop=function(){this._disconnected=!0},Encoder.prototype._notify=function(buffer){buffer instanceof ArrayBuffer?this.onencodingcomplete(buffer,this.format):this.onencodingerror(buffer)},Encoder.prototype.onencodingcomplete=function(buffer,format){},Encoder.prototype.onencodingerror=function(error){},webAudio.Encoder=Encoder}(webAudio),function(exports){"use strict";function SampleDeque(numberOfChannels,TypedArrayConstructor){this.numberOfChannels=numberOfChannels,this.length=0,this.TypedArray=TypedArrayConstructor,this._queue=[]}SampleDeque.prototype.enqueue=function(samples){this._queue.push(samples),this.length+=samples.length/this.numberOfChannels},SampleDeque.prototype.tryDequeue=function(numberOfSamples,usePadding){if("boolean"!=typeof usePadding&&(usePadding=!1),this.length<=0||numberOfSamples>this.length&&!usePadding)return!1;var current,n,segment,TypedArray=this.TypedArray,sampleTotal=numberOfSamples*this.numberOfChannels,lengthTotal=this.length*this.numberOfChannels,samples=new TypedArray(sampleTotal),count=0;do{n=sampleTotal-count,(current=this._queue[0]).length<=n?(segment=current,this._queue.shift()):(segment=current.subarray(0,n),this._queue[0]=current.subarray(n)),samples.set(segment,count),lengthTotal-=segment.length,count+=segment.length}while(count<sampleTotal&&lengthTotal>0);return this.length=lengthTotal/this.numberOfChannels,samples},exports.SampleDeque=SampleDeque}("undefined"!=typeof window?window:self),function(window,webAudio){"use strict";function VolumeAnalyserNode(context){var frequencyData,analyser=context.createAnalyser(),scriptProcessor=context.createScriptProcessor(2048,1,1);analyser.channelCount=1,analyser.smoothingTimeConstant=.6,analyser.fftSize=512,frequencyData=new Uint8Array(analyser.frequencyBinCount);var self=this,max=Math.sqrt(255)*Math.LN2;scriptProcessor.onaudioprocess=function(){var volumeAverage,length=frequencyData.length,i=length,volumeSum=0;for(analyser.getByteFrequencyData(frequencyData);i--;)volumeSum+=frequencyData[i];volumeAverage=Math.sqrt(volumeSum/length)*Math.LN2/max,"function"==typeof self.onvolumeprocess&&self.onvolumeprocess!==VolumeAnalyserNode.prototype.onvolumeprocess&&self.onvolumeprocess(volumeAverage),self.volume=volumeAverage},this._analyser=analyser,this._scriptProcessor=scriptProcessor,Object.defineProperties(this,{context:{value:context,writeable:!1,enumerable:!0,configurable:!1},numberOfInputs:{value:1,writeable:!1,enumerable:!0,configurable:!1},numberOfOutputs:{value:0,writeable:!1,enumerable:!0,configurable:!1},head:{value:analyser,writeable:!1,enumerable:!0,configurable:!1},tail:{value:analyser,writeable:!1,enumerable:!0,configurable:!1}}),this.connect(null),this.volume=0}VolumeAnalyserNode.prototype.onvolumeprocess=function(averageVolume){},VolumeAnalyserNode.prototype.connect=function(next){this._analyser.connect(this._scriptProcessor),this._scriptProcessor.connect(this.context.destination)},VolumeAnalyserNode.prototype.disconnect=function(){this._analyser.disconnect(),this._scriptProcessor.disconnect()},webAudio.addPolyfill("AudioContext.prototype.createVolumeAnalyser",{fixesApi:!1,isSupported:function(){return!0},polyfill:function(){return new VolumeAnalyserNode(this)}})}(window,webAudio),function(){"use strict";function getPeakLevel(buffer){for(var max=0,i=buffer.length;i--;){var sample=Math.abs(buffer[i]);sample>max&&(max=sample)}return max}function VoiceActivityDetector(sampleRate){this._sampleRate=sampleRate,this._ended=!0,this.start()}function VoiceActivityDetectionNode(context){var downmixer=context.createGain(),filter=context.createBiquadFilter(),scriptProcessor=context.createScriptProcessor(1024,1,1),self=this;self._detector=new VoiceActivityDetector(context.sampleRate),downmixer.channelCount=1,filter.type="bandpass",filter.frequency.value=2750,filter.Q.value=2,scriptProcessor.onaudioprocess=function(event){var buffer=event.inputBuffer.getChannelData(0);self._detector.processData(buffer,!1)},this._downmixer=downmixer,this._filter=filter,this._scriptProcessor=scriptProcessor,Object.defineProperties(this,{context:{value:context,writeable:!1,enumerable:!0,configurable:!1},numberOfInputs:{value:1,writeable:!1,enumerable:!0,configurable:!1},numberOfOutputs:{value:0,writeable:!1,enumerable:!0,configurable:!1},head:{value:downmixer,writeable:!1,enumerable:!0,configurable:!1},tail:{value:scriptProcessor,writeable:!1,enumerable:!0,configurable:!1}}),this.connect(null),this.volume=0}VoiceActivityDetector.prototype.processData=function(samples,singleSampleSet){singleSampleSet&&(this.start(),this.end()),this._sampleDeque.enqueue(new Float32Array(samples)),this._processData()},VoiceActivityDetector.prototype._processData=function(){for(;;){var chunkSamples=this._sampleDeque.tryDequeue(this._samplesPerChunk,this._ended);if(!chunkSamples)break;var peakLevel=getPeakLevel(chunkSamples);this._haveFloor?(this.chunkCount++,peakLevel>this._noiseFloor&&this.chunkOverFloorCount++):(this._haveFloor=!0,this._noiseFloor=2*peakLevel)}},VoiceActivityDetector.prototype.getQuality=function(){return this._processData(),this.chunkOverFloorCount>30||this.chunkOverFloorCount/this.chunkCount>.15?"GOOD":"POOR"},VoiceActivityDetector.prototype.start=function(){this._sampleDeque=new SampleDeque(1,Float32Array),this._haveFloor=!1,this._noiseFloor=0,this._samplesPerChunk=this._sampleRate/2,this.chunkCount=0,this.chunkOverFloorCount=0,this._ended=!1},VoiceActivityDetector.prototype.end=function(){this._ended=!0},VoiceActivityDetectionNode.prototype.getQuality=function(){return this._detector.getQuality()},VoiceActivityDetectionNode.prototype.connect=function(next){this._downmixer.connect(this._filter),this._filter.connect(this._scriptProcessor),this._scriptProcessor.connect(this.context.destination),this._detector.start()},VoiceActivityDetectionNode.prototype.disconnect=function(){this._scriptProcessor.disconnect(),this._filter.disconnect(),this._downmixer.disconnect(),this._detector.end()},["AudioContext.prototype.createVoiceActivityDetector","OfflineAudioContext.prototype.createVoiceActivityDetector"].forEach(function(api){webAudio.addPolyfill(api,{fixesApi:!1,isSupported:function(){return!0},polyfill:function(){return new VoiceActivityDetectionNode(this)}})}),webAudio.VoiceActivityDetector=VoiceActivityDetector}(),TDS=window.TDS||{},TDS.Audio=TDS.Audio||{},function(Audio){Audio.isActive=function(){return!(!Audio.Player||!Audio.Player.isPlaying())||!(!Audio.Recorder||!Audio.Recorder.isCapturing()&&!Audio.Recorder.isPlaying())},Audio.stopAll=function(){Audio.Player&&Audio.Player.isPlaying()&&Audio.Player.stopAll(),Audio.Recorder&&(Audio.Recorder.isCapturing()?Audio.Recorder.stopCapture():Audio.Recorder.isPlaying()&&Audio.Recorder.stopAudio())}}(TDS.Audio),TDS=window.TDS||{},TDS.Audio=TDS.Audio||{},function(Audio){function isReady(){return null!=appletEl}function setApplet(applet){if(!isReady()){appletTimer&&appletTimer.cancel(),processTimer&&processTimer.cancel(),appletEl=applet;var timeoutMillis=1e3*socketTimeout;setTimeout(function(){applet.setSocketParameters(timeoutMillis,timeoutMillis)},0);for(var i=0;i<initCallbacks.length;i++)initCallbacks[i]()}}function getAppletFrame(){return document.getElementById("audioFrame")}function getApplet(){var audioFrame=getAppletFrame();if(audioFrame){var frameDoc=Util.Dom.getFrameContentDocument(audioFrame);if(frameDoc)return frameDoc.getElementById("AIRAudio")}return null}function injectApplet(){var appletConfig={id:"AIRAudio",codebase:appletPath+"AIRAudio",code:"AIRAudio/AudioApplet.class",archive:"AIRAudio_Combined.jar",callback:"tdsFireAudioEvent"};return Util.Frame.injectApplet("audioFrame",appletConfig)}function removeApplet(){var audioFrame=getAppletFrame();Util.Dom.removeNode(audioFrame)}function checkApplet(){if(!isReady()){try{var applet=getApplet();applet&&"function"==typeof applet.getCurrentState&&"READY"==applet.getCurrentState()&&(console.log("AUDIO APPLET POLLING READY"),setApplet(applet))}catch(ex){console.error(ex)}isReady()||startAppletTimer()}}function checkProcess(){if(!isReady()){var javaRequired=!1,javaFound=!1;if(Util.Browser.isWindows()&&Util.Browser.isSecure()){javaRequired=!0;var processList=Util.SecureBrowser.getProcessList();if(processList.length>0)for(var i=0;i<processList.length;i++)if("java.exe"==processList[i]){javaFound=!0;break}}javaRequired&&!javaFound&&(processFailed=!0,removeApplet(),injectApplet())}}function startAppletTimer(){appletTimer=window.YAHOO.lang.later(appletInterval,this,checkApplet)}function startProcessTimer(){processTimer=window.YAHOO.lang.later(processTimeout,this,checkProcess)}function processEvent(id,type){if(null!=id){var data=null;type==Java.Event.RECORDING_PROGRESS?(data=id,id=activeID):console.log("AudioApplet: processEvent",arguments);var failEvent=-1!=type.indexOf("_FAIL"),terminalEvent=failEvent||type==Java.Event.PLAYING_DONE||type==Java.Event.PLAYING_STOPPED||type==Java.Event.RECORDING_DONE,loadListener=loadCallbacks[id];if(loadListener)return loadListener(id,type),void((failEvent||type==Java.Event.DECODE_COMPLETE)&&delete loadListener[id]);var eventListener=callbacks[id];eventListener&&eventListener(id,type,data),terminalEvent&&(id==activeID&&(playing=!1,recording=!1,activeID=null),delete callbacks[id])}else console.warn("AudioApplet: Invalid event audio ID")}var appletPath=null,initialized=!1,appletEl=null,appletTimer=null,appletInterval=5e3,processTimer=null,processTimeout=3e4,processFailed=!1,socketTimeout=90,playing=!1,recording=!1,activeID=null,callbacks={},initCallbacks=[],loadCallbacks=[],Java={};Java.Type={SOUNDCUE:"SOUNDCUE",CONTENTAUDIO:"CONTENTAUDIO",STUDENTRECORDING:"STUDENTRECORDING",UNKNOWN:"UNKNOWN"},Java.Status={INITIALIZING:"INITIALIZING",READY:"READY",PLAYINPROGRESS:"PLAYINPROGRESS",CAPTUREINPROGRESS:"CAPTUREINPROGRESS",STOPPINGCAPTURE:"STOPPINGCAPTURE",PAUSED:"PAUSED",UNDEFINED:"UNDEFINED"},Java.Format={SPX:"SPX",OGG:"OGG",WAVE:"WAVE"},Java.Event={INITIALIZED:"INITIALIZED",LOAD_START:"LOAD_START",LOAD_COMPLETE:"LOAD_COMPLETE",LOAD_FAIL:"LOAD_FAIL",DECODE_START:"DECODE_START",DECODE_COMPLETE:"DECODE_COMPLETE",DECODE_FAIL:"DECODE_FAIL",RECORDING_START:"RECORDING_START",RECORDING_PROGRESS:"RECORDING_PROGRESS",RECORDING_STOPPING:"RECORDING_STOPPING",RECORDING_DONE:"RECORDING_DONE",RECORDING_FAIL:"RECORDING_FAIL",PLAYING_START:"PLAYING_START",PLAYING_FAIL:"PLAYING_FAIL",PLAYING_PROGRESS:"PLAYING_PROGRESS",PLAYING_DONE:"PLAYING_DONE",PLAYING_STOPPED:"PLAYING_STOPPED",PLAYING_PAUSED:"PLAYING_PAUSED"},Java.setAppletPath=function(path){appletPath=path},Java.initialize=function(eventListener){return"function"==typeof eventListener&&initCallbacks.push(eventListener),!initialized&&("string"!=typeof(appletPath=appletPath||window.javaFolder)?(console.warn("Could not initialize java audio applet. No applet path set."),!1):(YAHOO.lang.later(1e3,this,function(){startAppletTimer(),startProcessTimer(),injectApplet()}),initialized=!0,!0))},Java.isInitialized=function(){return initialized},Java.isReady=isReady,Java.dispose=function(){var audioFrame=document.getElementById("audioFrame");null!=audioFrame&&(YUD.setStyle(audioFrame,"display","none"),appletEl&&appletEl.parentNode&&appletEl.parentNode.removeChild(appletEl))},window.tdsFireAudioEvent=function(applet,event,data,sequenceNumber,logSeqNumber){if(event==Java.Event.INITIALIZED){if(isReady())return;null!=applet&&"function"==typeof applet.getCurrentState&&"READY"==applet.getCurrentState()&&(console.log("AUDIO APPLET EVENT READY"),setApplet(applet))}else processEvent(data,event)},Java.isPlaying=function(){return playing},Java.isRecording=function(){return recording},Java.getState=function(){return appletEl.getCurrentState()},Java.playAudioClip=function(audioID,format,type,eventListener){return!(!isReady()||playing||recording)&&(!!appletEl.playAudioClip(audioID,format,type)&&(playing=!0,activeID=audioID,"function"==typeof eventListener&&(callbacks[audioID]=eventListener),!0))},Java.stopAudioClip=function(){return!!isReady()&&appletEl.stopAudioClip()},Java.startCapture=function(audioID,duration,format,eventListener){return!(!isReady()||playing||recording)&&(!!appletEl.startCapture(audioID,duration,format)&&(recording=!0,activeID=audioID,"function"==typeof eventListener&&(callbacks[audioID]=eventListener),!0))},Java.stopCapture=function(){return!!isReady()&&appletEl.stopCapture()},Java.loadBase64Audio=function(audioID,format,type,base64,eventListener){return!!isReady()&&(appletEl.loadBase64Audio(audioID,format,type,base64),"function"==typeof eventListener&&(loadCallbacks[audioID]=eventListener),!0)},Java.retrieveBase64Audio=function(audioID,format){if(!isReady())return null;var base64=appletEl.retrieveBase64Audio(audioID,format);return null!=base64&&"object"==typeof base64&&(base64=new String(base64).toString()),base64},Java.estimateQuality=function(audioID){return isReady()?appletEl.estimateQuality(audioID):null},Audio.Java=Java}(TDS.Audio),TDS=window.TDS||{},TDS.Audio=TDS.Audio||{},TDS.Audio.Services=function(){this._initialized=!1,this._list=[],this._lookup={}},TDS.Audio.Services.prototype.register=function(service){var name=service.getName();console.info("AudioService Register: "+name),this._list.push(service),this._lookup[name]=service},TDS.Audio.Services.prototype.getList=function(){return this._list},TDS.Audio.Services.prototype.get=function(name){return this._lookup[name]},TDS.Audio.Services.prototype.remove=function(name){var service=this.getService(name);Util.Array.remove(this._list,service),delete this._lookup[name]},TDS.Audio.Services.prototype.prioritize=function(names){names=names||[];for(var i=0;i<this._list.length;i++){var name=this._list[i].getName();-1==names.indexOf(name)&&names.push(name)}return Util.Array.sort(this._list,function(recA,recB){var idxA=names.indexOf(recA.getName()),idxB=names.indexOf(recB.getName());return idxA>idxB?1:idxA<idxB?-1:0}),this._list},TDS.Audio.Services.prototype.getSupported=function(){for(var services=this.getList(),i=0;i<services.length;i++){var service=services[i];if(service.isSupported())return service}return null},TDS=window.TDS||{},TDS.Audio=TDS.Audio||{},function(Audio){function createEvent(fireOnce){return new Util.Event.Custom(Recorder,fireOnce)}function processException(id,ex,fatal){setTimeout(function(){Recorder.onDeviceException.fire(id,ex,fatal)},0)}function reinitialize(){setTimeout(function(){try{Recorder.initialize()}catch(ex){processException(id,ex,!0)}},0)}var services=new TDS.Audio.Services,service=null,Recorder={};Recorder.onDeviceInit=createEvent(),Recorder.onDeviceReady=createEvent(!0),Recorder.onDeviceError=createEvent(),Recorder.onDeviceException=createEvent(),Recorder.onCaptureLoad=createEvent(),Recorder.onCaptureStart=createEvent(),Recorder.onCaptureProgress=createEvent(),Recorder.onCaptureStop=createEvent(),Recorder.onPlayStart=createEvent(),Recorder.onPlayStop=createEvent();var capturing=!1,playing=!1;Recorder.onCaptureStop.subscribe(function(){capturing=!1}),Recorder.onPlayStop.subscribe(function(){playing=!1}),Recorder.onDeviceError.subscribe(function(id,detail){capturing=!1,playing=!1,reinitialize()});var deviceBroken=!1;Recorder.isDeviceBroken=function(){return deviceBroken},Recorder.onDeviceException.subscribe(function(id,ex,fatal){capturing=!1,playing=!1,ex&&console.error(ex),capturing=!1,playing=!1,fatal?deviceBroken=!0:reinitialize()}),Recorder.getServices=function(){return services},Recorder.getSupportedService=function(){return service},Recorder.isCapturing=function(){return capturing},Recorder.isPlaying=function(){return playing},Recorder.register=services.register.bind(services),Recorder.isInitialized=function(){return service&&service.isReady()},Recorder.initialize=function(){return services.prioritize(["webaudio","sb"]),(service=services.getSupported())?(console.info("Recorder service initializing: "+service.getName()),service.initialize(),Recorder.loadSourceFromSessionStorage(),!0):(console.warn("Recorder service not found"),!1)},Recorder.isReady=function(){return service&&service.isReady()},Recorder.startCapture=function(id,duration){if(capturing||playing)return!1;if(Recorder.isReady())try{return service.startCapture(id,duration)&&(capturing=!0)}catch(ex){processException(id,ex)}return!1},Recorder.stopCapture=function(){if(Recorder.isReady()&&capturing)try{return service.stopCapture()&&(capturing=!1)}catch(ex){processException(null,ex)}return!1},Recorder.playAudio=function(id){if(capturing||playing)return!1;if(Recorder.isReady())try{return service.playAudio(id)&&(playing=!0)}catch(ex){processException(id,ex)}return!1},Recorder.stopAudio=function(){if(Recorder.isReady()&&playing)try{return service.stopAudio()&&(playing=!1)}catch(ex){processException(null,ex)}return!1},Recorder.loadBase64Audio=function(id,base64){return Recorder.isReady()&&service.loadBase64Audio(id,base64)},Recorder.retrieveBase64Audio=function(id,eventListener){return Recorder.isReady()&&service.retrieveBase64Audio(id,eventListener)},Recorder.retrieveQuality=function(id,eventListener){return Recorder.isReady()&&service.retrieveQuality(id,eventListener)},Recorder.getSources=function(callback){return Recorder.isReady()&&service.getSources(callback)||[]},Recorder.setSource=function(deviceId){return Recorder.isReady()&&service.setSource(deviceId)};Recorder.saveSourceInSessionStorage=function(deviceId){Util.Storage.set("Recorder-deviceId",deviceId)},Recorder.loadSourceFromSessionStorage=function(){Recorder.getSources(function(){var deviceId=Util.Storage.get("Recorder-deviceId");Recorder.setSource(deviceId)})},Recorder.removeSourceFromSessionStorage=function(){Util.Storage.remove("Recorder-deviceId")},Audio.Recorder=Recorder}(TDS.Audio),function(Diagnostics,Recorder){function getLogs(){var logFormatter=[],service=Recorder.getSupportedService();if(service&&"sb"==service.getName())for(var logs=service.getLogs(),i=0;i<logs.length;i++){var log=logs[i];logFormatter.push(Util.Date.formatTime(log.timestamp)),logFormatter.push(" - "),logFormatter.push(log.message),logFormatter.push("\n")}return logFormatter.join("")}Diagnostics&&(Recorder.onDeviceError.subscribe(function(id,detail){var message="Recorder Error: "+detail;id&&(message+=" ("+id+")"),Diagnostics.logServerError(message,getLogs())}),Recorder.onDeviceException.subscribe(function(id,ex){ex&&Diagnostics.report(ex)}))}(TDS.Diagnostics,TDS.Audio.Recorder),function(Audio){function initDefaultOptions(){null===defaultOptions&&setDefaultOptions()}function setDefaultOptions(){if(SBAPI.getDefaultOptions&&(defaultOptions=SBAPI.getDefaultOptions()),$.isEmptyObject(defaultOptions)){var devices=SBAPI.getCapabilities().supportedInputDevices;if(null==devices||0==devices.length)throw new Error("There are no supported input devices.");var device=devices[0],channelCount=device.channelCounts[0],sampleRate=device.sampleRates[0],sampleSize=device.sampleSizes[0];defaultOptions={captureDevice:device.id,channelCount:channelCount,sampleRate:sampleRate,sampleSize:sampleSize,encodingFormat:"OPUS",qualityIndicator:!0},console.log("SB Recorder Device: ",device)}}var Recorder=TDS.Audio.Recorder,SBEvent=TDS.SecureBrowser.Base.Recorder.Event,SBAPI=null,SBService={},ready=!1,defaultOptions=null;SBService.getName=function(){return"sb"},SBService.isSupported=function(){return null!=TDS.SecureBrowser.getRecorder()},SBService.getLogs=function(){return SBAPI.getLogs()},SBService.initialize=function(){ready=!1,SBAPI=TDS.SecureBrowser.getRecorder(),Recorder.onDeviceInit.fire(),SBAPI.initialize(function(event){if(event.type==SBEvent.DEVICE_READY)try{ready=!0,Recorder.onDeviceReady.fire()}catch(ex){Recorder.onDeviceException.fire(null,ex,!0)}else event.type==SBEvent.DEVICE_ERROR&&Util.String.contains(event.data,"Error during initialize")&&Recorder.onDeviceException.fire(null,null,!0)})},SBService.isReady=function(){return ready},SBService.startCapture=function(id,duration){var options;return Util.Browser.isCertified()?options=SBAPI.getDefaultOptions():(initDefaultOptions(),options=JSON.parse(JSON.stringify(defaultOptions)),options=YAHOO.lang.augmentObject(options,{filename:id,captureLimit:{duration:YAHOO.lang.isNumber(duration)?duration:30},progressFrequency:{type:"time",interval:99999}})),console.log("SB Recorder Capture: ",options),SBAPI.startCapture(options,function(event){event.type==SBEvent.CAPTURE_START?Recorder.onCaptureStart.fire(id):event.type==SBEvent.CAPTURE_END?Recorder.onCaptureStop.fire(id):event.type==SBEvent.DEVICE_ERROR&&Recorder.onDeviceError.fire(id,event.data)}),!0},SBService.stopCapture=function(){return SBAPI.stopCapture(),!0},SBService.playAudio=function(id){var audioData={type:"filename",filename:id};return SBAPI.play(audioData,function(event){event.type==SBEvent.PLAYBACK_START?Recorder.onPlayStart.fire(id):event.type==SBEvent.PLAYBACK_STOPPED?Recorder.onPlayStop.fire(id):event.type==SBEvent.DEVICE_ERROR&&Recorder.onDeviceError.fire(id,event.data)}),!0},SBService.stopAudio=function(){return SBAPI.stopPlay(),!0},SBService.loadBase64Audio=function(id,base64){return SBAPI.loadAudioFile(id,base64,function(){Recorder.onCaptureLoad.fire(id)})},SBService.retrieveBase64Audio=function(id){var data=SBAPI.retrieveAudioFile(id);return data&&data.base64?data.base64:null},SBService.retrieveQuality=function(id){var data=SBAPI.retrieveAudioFile(id);return data&&data.qualityIndicator?data.qualityIndicator:null},SBService.getSources=function(callback){"function"==typeof callback&&(initDefaultOptions(),callback([defaultOptions.captureDevice]))},SBService.setSource=function(deviceId){return initDefaultOptions(),defaultOptions.captureDevice===deviceId},Recorder.register(SBService)}(),function(audio,webAudio){function initWebAudio(){webAudio.init({workerFactory:Util.workerFactory,encodingWorkerUrl:TDS.resolveBaseUrl("Scripts/combined/webaudio-worker.js")})}function createAndAddRecorder(id){if(_recorders[id])return _recorders[id];var recorder=new webAudio.Recorder({source:new webAudio.RecorderSource(_sourceDevice),streamingEncoderFormat:webAudio.encoding.format.opus}),wrapper=_recorders[id]={id:id,recorder:recorder,timeout:null,encodedData:null};return recorder.onbeforestop=function(){recorder.encoder.appendSilence(1)},recorder.oncomplete=function(buffer){var bytes=new Uint8Array(buffer),base64=base64js.fromByteArray(bytes);wrapper.encodedData=base64,wrapper.track=null,RecorderSingleton.onCaptureStop.fire(id)},recorder.onerror=function(error){RecorderSingleton.onDeviceError.fire(id,error)},wrapper}function decodeBase64OggOpus(wrapper,callback,errorCallback){if(wrapper.track instanceof webAudio.Track)callback(wrapper.track);else{var bytes;try{bytes=base64js.toByteArray(wrapper.encodedData)}catch(error){return void errorCallback(error.toString())}webAudio.Track.fromArrayBuffer(bytes.buffer,webAudio.context,webAudio.encoding.format.opus,function(track){null!==track&&(track.name=wrapper.id,wrapper.track=track,callback(track))},function(error){errorCallback(error)})}}var _player,RecorderSingleton=audio.Recorder,_recorders={},_sources=[],_sourceDevice=null,webAudioService={getName:function(){return"webaudio"},isSupported:function(){return initWebAudio(),webAudio.isReady()},getLogs:function(){return[]},initialize:function(){initWebAudio(),webAudio.isReady()&&((_player=new webAudio.Player).ontrackend=function(track){var id=track.name;RecorderSingleton.onPlayStop.fire(id)},RecorderSingleton.onDeviceReady.fire())},isReady:function(){return webAudio.isReady()},startCapture:function(id,duration){var service=this,wrapper=createAndAddRecorder(id);return wrapper.recorder.startRecording(function(){"number"!=typeof duration&&(duration=30),wrapper.timeout=setTimeout(function(){service.stopCapture()},1e3*duration),RecorderSingleton.onCaptureStart.fire(id)},function(error){RecorderSingleton.onDeviceError.fire(id,"error starting capture:\n"+error.toString())},function(error){RecorderSingleton.onDeviceError.fire(id,"error acquiring capture device:\n"+error.toString())}),!0},stopCapture:function(){return Object.keys(_recorders).map(function(id){return _recorders[id]}).forEach(function(wrapper){var recorder=wrapper.recorder;wrapper.id;recorder.isRecording()&&(null!==wrapper.timeout&&(clearTimeout(wrapper.timeout),wrapper.timeout=null),recorder.stopRecording())}),!0},playAudio:function(id){var wrapper=_recorders[id];return null!==wrapper.encodedData&&(decodeBase64OggOpus(wrapper,function(track){_player.changeTrack(track,!0),RecorderSingleton.onPlayStart.fire(id)},function(error){RecorderSingleton.onDeviceError.fire(id,(error||"unknown error").toString())}),!0)},stopAudio:function(){var id=_player.getCurrentTrack().name;return _player.stop(),RecorderSingleton.onPlayStop.fire(id),!0},loadBase64Audio:function(id,data){var wrapper=createAndAddRecorder(id);if(wrapper.encodedData=data,wrapper.track=null,0===data.length)return wrapper.encodedData=null,void RecorderSingleton.onCaptureLoad.fire(id);decodeBase64OggOpus(wrapper,function(track){var analyser=new webAudio.VoiceActivityDetector(track.sampleRate),pcm=track.toPCM().channelData[0];analyser.processData(pcm,!0),wrapper.loadedQuality=analyser.getQuality(),RecorderSingleton.onCaptureLoad.fire(id)},function(error){RecorderSingleton.onDeviceError.fire(id,(error||"unknown error").toString())})},retrieveBase64Audio:function(id){var wrapper=_recorders[id];return wrapper&&wrapper.encodedData||null},retrieveQuality:function(id){var wrapper=_recorders[id],quality=wrapper.recorder.getQuality();return quality||(quality=wrapper.loadedQuality),quality},getSources:function(callback){"function"==typeof callback&&webAudio.RecorderSource.getAudioSources(function(sources){_sources=sources.slice(),callback(sources)})},setSource:function(deviceId){var sources=_sources.filter(function(source){return source.deviceId===deviceId});if(0===sources.length)return console.warn('invalid audio source device id "'+deviceId+'"'),void(_sourceDevice=null);var device=sources[0];_sourceDevice={deviceId:device.deviceId,label:device.label},Object.keys(_recorders).forEach(function(key){_recorders[key].recorder.setSourceDevice(_sourceDevice)})}};audio.Recorder.register(webAudioService)}(TDS.Audio,webAudio),function(audio){function PlayerPlugin(){this._publicApi=[]}Object.defineProperties(PlayerPlugin.prototype,{publicApi:{get:function(){return this._publicApi},enumerable:!0,configurable:!1}}),PlayerPlugin.prototype.expose=function(name,publicName){this.publicApi.push({plugin:this,name:name,publicName:publicName||name,isFunction:"function"==typeof this[name]})},PlayerPlugin.prototype.initialize=function(player){this.player=player},PlayerPlugin.prototype.player=null,PlayerPlugin.prototype.onSoundCreated=function(source){},PlayerPlugin.prototype.parseSource=function(element,source){},audio.PlayerPlugin=PlayerPlugin}(TDS.Audio),function(tds){function parseMIMEType(url){if(url){if(Util.String.contains(url,".mp3"))return"audio/mpeg";if(Util.String.contains(url,".m4a"))return"audio/mp4";if(Util.String.contains(url,".ogg"))return"audio/ogg";if(Util.String.contains(url,".oga"))return"audio/ogg";if(Util.String.contains(url,".webma"))return"audio/webm";if(Util.String.contains(url,".wav"))return"audio/wav"}return""}function parseSources(el){function parseSourceWithPlugins(source){_plugins.forEach(function(plugin){plugin.parseSource(el,source)})}for(var source,sourceElement,sources=[],sourceElements=el.getElementsByTagName("source"),i=0;i<sourceElements.length;++i)sourceElement=sourceElements[i],parseSourceWithPlugins(source={url:decodeURIComponent(sourceElement.src||sourceElement.getAttribute("src")),type:sourceElement.type||sourceElement.getAttribute("type")}),sources.push(source);if(!sources.length&&el.href&&((source={url:decodeURIComponent(el.href)}).type=parseMIMEType(source.url)||el.getAttribute("type")||"",parseSourceWithPlugins(source),sources.push(source)),TDS.getAppSetting("tds.audio.oggFix",!0)&&sources.length&&Util.Browser.getFirefoxVersion()>0)for(i=0;i<sources.length;i++)if(-1!=(source=sources[i]).type.indexOf("audio/ogg")){sources.splice(i,1),sources.unshift(source);break}return sources}function Player(){}var _impl,_services=new TDS.Audio.Services,player=new Player,_plugins=[];YAHOO.lang.augmentObject(Player.prototype,{setup:function(servicePriorities){return!!_impl||(Array.isArray(servicePriorities)||(servicePriorities=["createjs","sm2"]),_services.prioritize(servicePriorities),(_impl=_services.getSupported())?(console.info("Player service initializing: "+_impl.getName()),_impl.initialize(),this._initializePlugins(),Object.freeze(player),!0):(console.warn("Player service not found"),!1))},_initializePlugins:function(){_plugins.forEach(function(plugin){plugin.initialize(player),plugin.publicApi.forEach(function(api){api.isFunction?player[api.publicName]=function(){return api.plugin[api.name].apply(api.plugin,Array.prototype.slice.apply(arguments))}:Object.defineProperty(player,api.publicName,{get:function(){return api.plugin[api.name]}})})})},teardown:function(){_impl&&(_impl.teardown(),_impl=null)},register:function(service){service instanceof tds.Audio.PlayerPlugin?_plugins.push(service):_services.register(service)},getServices:function(){return _services},_findPlayableSource:function(el){for(var sources=parseSources(el),i=0;i<sources.length;i++){var source=sources[i];if(this.canPlaySource(source))return source}return null},_createSoundFromSource:function(id,source){var result=this.createSoundFromSource(id,source);return!1!==result&&_plugins.forEach(function(plugin){plugin.onSoundCreated(id,source)}),result},createSound:function(id,url){var source={url:url,type:parseMIMEType(url)};return this._createSoundFromSource(id,source)},createSoundFromElement:function(id,options){var el=YUD.get(id);if(null==el)return!1;if(!YAHOO.lang.isString(id)){if(!el.id||""==el.id)return!1;id=el.id}var source=this._findPlayableSource(el);return!!source&&this._createSoundFromSource(id,source,options)}}),["onReady","play","stop","pause","resume","stopAll","isPlaying","isPaused","canPlaySource","createSoundFromSource","getDuration","setPosition","getPosition"].forEach(function(api){Player.prototype[api]=function(){return _impl?_impl[api].apply(_impl,Array.prototype.slice.apply(arguments)):(console.warn("Player service not found"),null)}}),["onBeforePlay","onPlay","onStop","onPause","onBeforeResume","onResume","onStart","onFinish","onIdle","onFail","onTimeUpdate"].forEach(function(api){Object.defineProperty(Player.prototype,api,{get:function(){return _impl?_impl[api]:(console.warn("Player service not found"),null)}})}),Object.freeze(Player.prototype),tds.Audio=tds.Audio||{},Object.defineProperty(tds.Audio,"Player",{value:player,writable:!1,enumerable:!0,configurable:!1})}(window.TDS),function(audio){function WebAudioTimeUpdateNode(inputNode,soundId,sound){var context=inputNode.context,createScriptProcessor=context.createScriptProcessor||context.createJavaScriptNode,lastPosition=null,inputChannelCount=inputNode.channelCount||sound.sourceNode.buffer.numberOfChannels;this._processor=createScriptProcessor.call(context,this._selectBufferSize(context.sampleRate),inputChannelCount,1),this._processor.onaudioprocess=function(event){var eventEmitter=player.onTimeUpdate[soundId],position=sound.getPosition()/1e3;eventEmitter&&lastPosition!==position&&(eventEmitter.fire(position),lastPosition=position)},this._inputNode=context.createGain(),this.head=this._processor,this._sourceNode=null}createjs.WebAudioPlugin.Loader.prototype.onerror=function(m){createjs.Sound._sendFileLoadError(this.src,m)},createjs.Sound._sendFileLoadError=function(a){if(createjs.Sound._preloadHash[a])for(var b=0,c=createjs.Sound._preloadHash[a].length;c>b;b++){var d=createjs.Sound._preloadHash[a][b];if(createjs.Sound._preloadHash[a][b]=!0,createjs.Sound.hasEventListener("error")){var f=new createjs.Event("error");f.src=d.src,f.id=d.id,f.data="error",createjs.Sound.dispatchEvent(f)}}},WebAudioTimeUpdateNode.prototype._selectBufferSize=function(sampleRate){return[256,512,1024,2048,4096,8192,16384].filter(function(s){return s/sampleRate<.25}).pop()},WebAudioTimeUpdateNode.prototype.start=function(sourceNode){this._sourceNode=sourceNode,this._sourceNode.connect(this._inputNode),this._inputNode.connect(this._processor),this._processor.connect(this._processor.context.destination)},WebAudioTimeUpdateNode.prototype.stop=function(){this._processor.disconnect(),this._inputNode.disconnect(),this._sourceNode=null};var player={_sounds:{},getName:function(){return"createjs"},_initialized:!1,initialize:function(){this._initialized=!0,createjs.Sound.FILE_PATTERN=/()()().*\??.*(?:file=|\/|^)([^&]+\.(\w+))()/,createjs.Sound.on("fileload",this._onSoundLoad,this,!1),createjs.Sound.on("error",this._onSoundLoadError,this,!1),this._initializeTimeUpdateEvent();var self=this;setTimeout(function(){self._onReady.fire()},1)},_onSoundLoad:function(event){var id=event.id,sound=this._sounds[id],commands=sound.commands;this._sounds[id]=sound=createjs.Sound.createInstance(id),sound.air_loading=!1;sound.on("succeeded",function(event,id){sound.timeupdateNode=new WebAudioTimeUpdateNode(sound.panNode,id,sound),this.onPlay.fire(id),this.onStart.fire(id)},this,!1,id),sound.on("complete",function(event,id){this.onTimeUpdate[id].fire(this.getDuration(id)),this.onFinish.fire(id),this.onIdle.fire(id),sound.air_playState=""},this,!1,id);for(var i=0;i<commands.length;++i){var command=commands[i];command.name||(command={name:command,arguments:[]}),command.arguments.unshift(id),this[command.name].apply(this,command.arguments)}},_onSoundLoadError:function(event){var id=event.id;this.onFail.fire(id)},_initializeTimeUpdateEvent:function(){function startTimeUpdate(id){var sound=self._sounds[id];sound.timeupdateNode.start(sound.sourceNode)}function stopTimeUpdate(id){self._sounds[id].timeupdateNode.stop()}var self=this;this.onPlay.subscribe(startTimeUpdate),this.onResume.subscribe(startTimeUpdate),this.onIdle.subscribe(stopTimeUpdate),this.onPause.subscribe(stopTimeUpdate)},teardown:function(){createjs.Sound.activePlugin&&createjs.Sound.removeAllSounds(),createjs.Sound.removeAllEventListeners(),this.onBeforePlay.unsubscribeAll(),this.onPlay.unsubscribeAll(),this.onPause.unsubscribeAll(),this.onBeforeResume.unsubscribeAll(),this.onResume.unsubscribeAll(),this.onStart.unsubscribeAll(),this.onStop.unsubscribeAll(),this.onFinish.unsubscribeAll(),this.onFail.unsubscribeAll(),this.onIdle.unsubscribeAll();var self=this;Object.keys(this.onTimeUpdate).forEach(function(key){self.onTimeUpdate[key].unsubscribeAll(),delete self.onTimeUpdate[key]}),this._onReady.unsubscribeAll(),this._initialized=!1},_onReady:new Util.Event.Custom(null,!0),onReady:function(callback){this._onReady.subscribe(callback)},isSupported:function(){return!(!window.AudioContext&&!window.webkitAudioContext)},play:function(id){var sound=this._sounds[id];if(!sound)return!1;if(sound.air_loading)sound.commands.push("play");else{if(!1===this.onBeforePlay.fire(id))return!1;sound.play()}return sound.air_playState="playing",!0},_stop:function(sound,onStop){return wasPlaying="playing"===sound.air_playState&&sound.pause(),wasPaused="paused"===sound.air_playState,(wasPlaying||wasPaused)&&(sound.resume(),sound.stop()),"function"==typeof onStop&&onStop(wasPlaying,wasPaused),wasPlaying},stop:function(id){var sound=this._sounds[id];if(!sound)return!1;if(sound.air_loading){var lastCommand=sound.commands[sound.commands.length-1];"play"===lastCommand||"resume"===lastCommand,sound.commands.push("stop")}else this._stop(sound,function(wasPlaying,wasPaused){this.onTimeUpdate[id].fire(0),(wasPlaying||wasPaused)&&(this.onStop.fire(id),this.onIdle.fire(id))}.bind(this));return sound.air_playState="",!0},stopAll:function(){var self=this;Object.keys(this._sounds).forEach(function(id){self.stop(id)})},resume:function(id){var sound=this._sounds[id];if(!sound)return!1;if(sound.air_loading)"pause"===sound.commands[sound.commands.length-1],sound.commands.push("resume");else{if(!1===this.onBeforeResume.fire(id))return!1;sound.resume()&&(this.onResume.fire(id),this.onStart.fire(id))}return sound.air_playState="playing",!0},pause:function(id){var sound=this._sounds[id];if(!sound)return!1;var wasPlaying;if(sound.air_loading){var lastCommand=sound.commands[sound.commands.length-1];wasPlaying="play"===lastCommand||"resume"===lastCommand,sound.commands.push("pause")}else(wasPlaying=sound.pause())&&this.onPause.fire(id);return sound.air_playState="paused",wasPlaying},isPlaying:function(){var self=this,ids=Object.keys(self._sounds);return!!ids.length&&ids.some(function(id){var sound=self._sounds[id];return sound.air_loading?"play"===sound.commands[sound.commands.length-1]:"playing"===sound.air_playState})},isPaused:function(){},getDuration:function(id){var sound=this._sounds[id];return sound&&!sound.air_loading?sound.getDuration()/1e3:0},setPosition:function(id,time){var sound=this._sounds[id];sound&&(sound.air_loading?sound.commands.push({name:"setPosition:",arguments:[time]}):this._stop(sound,function(wasPlaying,wasPaused){sound.setPosition(Math.floor(1e3*time)),wasPaused?(this.play(id),this.pause(id)):wasPlaying&&(sound.play(),this.onTimeUpdate[id].fire(time))}.bind(this)))},getPosition:function(id){var sound=this._sounds[id];return sound&&!sound.air_loading?sound.getPosition()/1e3:0},canPlaySource:function(source){var m=source.type.match(/^(?:(?:audio|video)\/)?(\w+)(?:; codecs\*?=[\"%'\., \w]+)?$/);return!!m&&(createjs.Sound.initializeDefaultPlugins()&&createjs.Sound.getCapability(m[1]))},createSoundFromSource:function(id,source,options){if(this._sounds[id])return!1;if(!this.canPlaySource(source))return!1;var sound=createjs.Sound.registerSound(source.url,id,null,!0);return!0===sound&&(source.url+=(source.url.match(/#/)?source.url.match(/#.*\?/)?"&":"?":"#?")+"createjsuniqueid="+id,sound=createjs.Sound.registerSound(source.url,id,null,!0)),!1!==sound&&(this._sounds[id]={air_loading:!0,air_playState:"",commands:[]},this.onTimeUpdate[id]=new Util.Event.Custom,id)},onBeforePlay:new Util.Event.Custom,onPlay:new Util.Event.Custom,onPause:new Util.Event.Custom,onBeforeResume:new Util.Event.Custom,onResume:new Util.Event.Custom,onStart:new Util.Event.Custom,onStop:new Util.Event.Custom,onFinish:new Util.Event.Custom,onIdle:new Util.Event.Custom,onFail:new Util.Event.Custom,onTimeUpdate:{}};audio._createjs=audio._createjs||{},Object.defineProperty(audio._createjs,"player",{value:player,writeable:!1,enumerable:!1,configurable:!1}),audio.Player.register(player)}(window.TDS.Audio),function(audio){function createEvent(){return new Util.Event.Custom(this)}function setup(flashPath){SM.audioFormats.mp3.required=!1,SM.setup({url:flashPath,flashVersion:9,preferFlash:!1,useHTML5Audio:!0}),SM.ontimeout(function(){console.warn("AudioManager Error: SM2 timeout"),rebooted||(rebooted=!0,setTimeout(function(){SM.reboot()},1e3))})}function _onLoad(success){!1===success&&(console.log("AUDIO FAILED: "+this.id),YAHOO.lang.later(0,Player.onFail,Player.onFail.fire,this.id))}function _onPlay(){console.log("AUDIO PLAY: "+this.id),YAHOO.lang.later(0,Player.onPlay,Player.onPlay.fire,this.id),YAHOO.lang.later(0,Player.onStart,Player.onStart.fire,this.id)}function _onPause(){console.log("AUDIO PAUSE: "+this.id),YAHOO.lang.later(0,Player.onPause,Player.onPause.fire,this.id)}function _onResume(){console.log("AUDIO RESUME: "+this.id),YAHOO.lang.later(0,Player.onResume,Player.onResume.fire,this.id),YAHOO.lang.later(0,Player.onStart,Player.onStart.fire,this.id)}function _onStop(){console.log("AUDIO STOP: "+this.id),YAHOO.lang.later(0,Player.onStop,Player.onStop.fire,this.id),YAHOO.lang.later(0,Player.onIdle,Player.onIdle.fire,this.id)}function _onFinish(){console.log("AUDIO FINISH: "+this.id),YAHOO.lang.later(0,Player.onFinish,Player.onFinish.fire,this.id),YAHOO.lang.later(0,Player.onIdle,Player.onIdle.fire,this.id)}function _onFailure(){console.log("AUDIO FAILURE: "+this.id),YAHOO.lang.later(0,Player.onFail,Player.onFail.fire,this.id)}function _onTimeUpdate(){var position=SM.getSoundById(this.id).position/1e3;Player.onTimeUpdate[this.id].fire(position)}function attachEvents(options){options.onload=_onLoad,options.onplay=_onPlay,options.onpause=_onPause,options.onresume=_onResume,options.onstop=_onStop,options.onfinish=_onFinish,options.onfailure=_onFailure,options.whileplaying=_onTimeUpdate}function canPlaySource(source){return SM.canPlayURL(source.url)||SM.canPlayMIME(source.type)}var SM=window.soundManager,rebooted=!1,Player={};Player.onBeforePlay=createEvent(),Player.onPlay=createEvent(),Player.onPause=createEvent(),Player.onBeforeResume=createEvent(),Player.onResume=createEvent(),Player.onStart=createEvent(),Player.onStop=createEvent(),Player.onFinish=createEvent(),Player.onIdle=createEvent(),Player.onFail=createEvent(),Player.onTimeUpdate={},Player.onReady=SM.onready,Player.canPlaySource=canPlaySource,Player.createSoundFromSource=function(id,source,options){return!SM.getSoundById(id,!0)&&null!=source&&!!canPlaySource(source)&&((options=options||{}).id||(options.id=id),options=YAHOO.lang.augmentObject(options,source),attachEvents(options),SM.createSound(options),Player.onTimeUpdate[id]=createEvent(),Util.Browser.isMacPPC()&&(SM.play(id),SM.stop(id)),id)},Player.play=function(id){if(!1===Player.onBeforePlay.fire(id))return!1;var sound=SM.play(id);return sound&&0!==sound.playState},Player.stop=function(id){return!1!==SM.stop(id)},Player.pause=function(id){var sound=SM.pause(id);return sound&&sound.paused},Player.resume=function(id){return!1!==Player.onBeforeResume.fire(id)&&!1!==SM.resume(id)},Player.isPaused=function(){for(var ids=SM.soundIDs,i=0;i<ids.length;i++)if(SM.sounds[ids[i]].paused)return!0;return!1},Player.isPlaying=function(){for(var ids=SM.soundIDs,i=0;i<ids.length;i++){var sound=SM.sounds[ids[i]];if(!sound.paused&&sound.playState>0)return!0}return!1},Player.stopAll=function(){SM.stopAll()},Player.getDuration=function(id){return SM.getSoundById(id).durationEstimate/1e3},Player.setPosition=function(id,time){SM.setPosition(id,Math.floor(1e3*time))},Player.getPosition=function(id){var sound=SM.getSoundById(id);return sound?sound.position/1e3:0},Player.isSupported=function(){return!!SM},Player.initialize=function(){setup(TDS.resolveBaseUrl("Scripts/Libraries/soundmanager2/swf/"))},Player.teardown=function(){Player.stopAll();for(var ids=SM.soundIDs.slice(),i=0;i<ids.length;i++)SM.unload(ids[i]);Player.onBeforePlay.unsubscribeAll(),Player.onPlay.unsubscribeAll(),Player.onPause.unsubscribeAll(),Player.onBeforeResume.unsubscribeAll(),Player.onResume.unsubscribeAll(),Player.onStop.unsubscribeAll(),Player.onFinish.unsubscribeAll(),Player.onFail.unsubscribeAll(),Player.onIdle.unsubscribeAll(),Object.keys(Player.onTimeUpdate).forEach(function(key){Player.onTimeUpdate[key].unsubscribeAll(),delete Player.onTimeUpdate[key]})},Player.getName=function(){return"sm2"},audio._soundManager=audio._soundManager||{},Object.defineProperty(audio._soundManager,"player",{value:Player,writeable:!1,enumerable:!1,configurable:!1}),audio.Player.register(Player)}(window.TDS.Audio),function(audio){function QueuePlugin(){QueuePlugin.superclass.constructor.call(this),this.expose("createQueue")}var numInstances=0,Queue=function(player){this._instance=++numInstances,this._isStarted=!1,this._player=player,this._playerIDs=[],this._currentID=null,this.onStart=new Util.Event.Custom(this),this.onStop=new Util.Event.Custom(this)};Queue.prototype._log=function(name,id){this._instance},Queue.prototype._setStarted=function(id){this._isStarted||(this._log("Start",id),this._isStarted=!0,this._player.onStop.subscribe(this._onStop,this,!0),this._player.onIdle.subscribe(this._onIdle,this,!0),this.onStart.fire(this))},Queue.prototype._setStopped=function(id){this._isStarted&&(this._log("Stop",id),this._isStarted=!1,this._player.onStop.unsubscribe(this._onStop,this,!0),this._player.onIdle.unsubscribe(this._onIdle,this,!0),this.onStop.fire(this))},Queue.prototype._play=function(id){return!!this._player.play(id)&&(this._currentID=id,!0)},Queue.prototype._onStop=function(id){this._currentID==id&&(this._currentID=null,this._setStopped(id))},Queue.prototype._onIdle=function(id){if(this._isStarted){this._currentID=null;var inactiveIdx=this._playerIDs.indexOf(id);if(-1!=inactiveIdx){var nextID=this._playerIDs[inactiveIdx+1];nextID?this._play(nextID)||this._setStopped(id):this._setStopped(id)}}},Queue.prototype.isStarted=function(){return this._isStarted},Queue.prototype.start=function(){if(0==this._playerIDs.length)return!1;var firstID=this._playerIDs[0];return!!this._play(firstID)&&(this._setStarted(),!0)},Queue.prototype.stop=function(){this.isStarted()&&this._player.stop(this._currentID)},Queue.prototype.insert=function(id,pos){Util.Array.insertAt(this._playerIDs,id,pos||0)},Queue.prototype.append=function(id){this._playerIDs.push(id)},Queue.prototype.remove=function(id){Util.Array.remove(this._playerIDs,id)},Queue.prototype.clear=function(){for(var ids=this._playerIDs.slice(),i=0;i<ids.length;i++)this.remove(ids[i])},Queue.prototype.dispose=function(){this.stop(),this.clear(),this.onStart.unsubscribeAll(),this.onStop.unsubscribeAll()},YAHOO.lang.extend(QueuePlugin,audio.PlayerPlugin),QueuePlugin.prototype.createQueue=function(ids){var queue=new Queue(this.player);if(ids)for(var i=0;i<ids.length;i++)queue.append(ids[i]);return queue},audio.Player.register(new QueuePlugin)}(window.TDS.Audio),function(audio){function VirtualMediaContainer(){this.currentTime=0;var timeupdateEventHandlers=[];this.addEventListener=function(event,handler,ignore){"timeupdate"===event&&handler instanceof Function&&timeupdateEventHandlers.push(handler)},this.updateTime=function(newTime){isNaN(newTime)||(this.currentTime=newTime,timeupdateEventHandlers.forEach(function(handler){handler()}))},this._captionatorOptions={processCueHTML:!1}}function ClosedCaptioningPlugin(){ClosedCaptioningPlugin.superclass.constructor.call(this),this.expose("getTextTracks"),this.expose("onAddTrack")}function getPropertyOrAttributeValue(element,name){return element[name]||element.getAttribute(name)}var _tracks={},_allowedKinds=["subtitles","captions","descriptions","captions","metadata","chapters"];VirtualMediaContainer.prototype.addTextTrack=function(id,kind,label,language,src,isDefault){var newTrack;if(id="string"==typeof id?id:"",label="string"==typeof label?label:"",language="string"==typeof language?language:"",isDefault="boolean"==typeof isDefault&&isDefault,-1===!_allowedKinds.indexOf(kind))throw new Error("DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.");return!!(newTrack=new captionator.TextTrack(id,kind,label,language,src,isDefault))&&(this.textTracks instanceof Array||(this.textTracks=[]),this.textTracks.push(newTrack),newTrack.videoNode=this,newTrack)},captionator.rebuildCaptions=function(){},YAHOO.lang.extend(ClosedCaptioningPlugin,audio.PlayerPlugin),ClosedCaptioningPlugin.prototype.parseSource=function(element,source){var tracksElements=element.getElementsByTagName("track");tracksElements.length?(source.tracks=Array.prototype.map.call(tracksElements,function(track){return{src:getPropertyOrAttributeValue(track,"src"),kind:getPropertyOrAttributeValue(track,"kind"),lang:getPropertyOrAttributeValue(track,"srclang"),label:getPropertyOrAttributeValue(track,"label"),isDefault:getPropertyOrAttributeValue(track,"default")}}),!source.tracks.some(function(track){return track.isDefault})&&source.tracks.length&&(source.tracks[0].isDefault=!0)):null!==element.getAttribute("texttrack")?source.tracks=[{src:source.url.replace(/(file=\w+.)(?:\w+)/,"$1vtt"),kind:"captions",lang:"en",label:"Captions",isDefault:!0}]:(source.tracks=[],console.warn("TDS.Audio.ClosedCaptioningPlugin: invalid item source element"))},ClosedCaptioningPlugin.prototype.onSoundCreated=function(id,source){if(source.tracks.length){var media=new VirtualMediaContainer,player=this.player,self=this,tracks=source.tracks.map(function(track,i){return media.addTextTrack(id+"_track"+i,track.kind,track.label,track.lang,track.src,track.isDefault)});tracks.forEach(function(track){track.loadTrack(track.src,function(cues){var track=this;track.mode=track.default?captionator.TextTrack.SHOWING:captionator.TextTrack.HIDDEN,player.onTimeUpdate[id].subscribe(function(time){media.updateTime(time)}),media.addEventListener("timeupdate",function(){try{track.activeCues.refreshCues()}catch(error){}}),self.onAddTrack.fire(track)})}),_tracks[id]=tracks}},ClosedCaptioningPlugin.prototype.getTextTracks=function(id){return _tracks[id]||[]},ClosedCaptioningPlugin.prototype.onAddTrack=new Util.Event.Custom,audio.Player.register(new ClosedCaptioningPlugin)}(TDS.Audio),function(Audio){function enableAll(){for(var i=0;i<widgetList.length;i++){var el=YUD.get(widgetList[i]);YUD.removeClass(el,CSS_DISABLED)}}function disableAll(id){for(var i=0;i<widgetList.length;i++)if(widgetList[i]!=id){var el=YUD.get(widgetList[i]);YUD.addClass(el,CSS_DISABLED)}}function setEventClass(id,type){var el=YUD.get(id);if(null!=el){type=type.toLowerCase();var lastEvent=el.getAttribute(ATTRIB_AUDIO_EVENT);lastEvent&&YUD.removeClass(el,lastEvent),el.setAttribute(ATTRIB_AUDIO_EVENT,type),YUD.addClass(el,type)}}function setEventClassAll(type){for(var i=0;i<recorderList.length;i++)setEventClass(recorderList[i].id,type)}function createPlayerControls(id,options){var soundElement=getSoundElement(id),container=createPlayerContainer(soundElement);return options.scrubber?container.classList.add("audio-layout-scrubber"):options.playStop?container.classList.add("audio-layout-single"):container.classList.add("audio-layout-multi"),{container:container,playStop:options.playStop?createPlayStopButton(container,soundElement):null,playPause:options.playPause?createPlayPauseButton(container,soundElement):null,rewind:options.rewind?createRewindButton(container,soundElement):null,scrubber:options.scrubber?createScrubber(container,soundElement):null}}function getSoundElement(id){var soundElement=YUD.get(id);if(!soundElement)return null;var id;return soundElement.id?id=soundElement.id:(id="sound-"+ ++playerCount,soundElement.id=id),soundElement}function createPlayerContainer(soundElement){var container=$(soundElement).parent(".audioControls").get(0);return container||((container=document.createElement("div")).className="audioControls "+CSS_DISABLED),container.id=soundElement.id,Player.onReady(function(){Player.createSoundFromElement(soundElement)&&(widgetList.push(container.id),YUD.removeClass(container,CSS_DISABLED))}),container.parentNode?$(container).empty():$(soundElement).replaceWith(container),container}function createPlayStopButton(container,soundElement){var playStopEl=document.createElement("a");return playStopEl.className="sound_repeat",playStopEl.setAttribute("href","#"),YUE.addListener(playStopEl,"click",function(ev){YUE.stopEvent(ev),YUD.hasClass(container,CSS_DISABLED)||Recorder.isCapturing()||Recorder.isPlaying()||(YUD.hasClass(container,"playing_start")?Player.stop(container.id):Player.play(container.id))}),container.appendChild(playStopEl),playStopEl.setAttribute("title","Play or stop recorded audio."),playStopEl}function createPlayPauseButton(container,soundElement){var id=container.id,playPauseEl=document.createElement("a");return playPauseEl.className="playPause",playPauseEl.setAttribute("href","#"),playPauseEl.setAttribute("title","Play or pause recorded audio."),YUE.addListener(playPauseEl,"click",function(ev){YUE.stopEvent(ev),YUD.hasClass(container,CSS_DISABLED)||Recorder.isCapturing()||Recorder.isPlaying()||(YUD.hasClass(container,"playing_start")||YUD.hasClass(container,"playing_resume")?Player.pause(id):YUD.hasClass(container,"playing_pause")?Player.resume(id):!YUD.hasClass(container,"playing_done")&&YUD.hasClass(container,"playing_start")&&YUD.hasClass(container,"playing_resume")?Player.stop(id):Player.play(id))}),container.appendChild(playPauseEl),playPauseEl}function createRewindButton(container,soundElement){var id=container.id,rewindEl=document.createElement("a");return rewindEl.className="rewind",rewindEl.setAttribute("href","#"),rewindEl.setAttribute("title","Go back to the beginning of the audio."),YUE.addListener(rewindEl,"click",function(ev){YUE.stopEvent(ev),YUD.hasClass(container,"playing_done")||Player.stop(id)}),container.appendChild(rewindEl),rewindEl}function createScrubber(container,soundElement){var scrubber=Audio.Widget.createScrubber(container.id);return scrubber.render(container),scrubber.getElement()}function getClosedCaptioningContainer(){return _closedCaptioningContainer=_closedCaptioningContainer||$(document.getElementById("tool-ClosedCaptioning"))}function renderTracksForSound(id){var visibleTracks=Player.getTextTracks(id).filter(function(track){return track.mode===captionator.TextTrack.SHOWING}),showClosedCaptions=TDS.getAccommodationProperties().hasClosedCaptioning()&&visibleTracks.length>0;getClosedCaptioningContainer().html("").toggleClass("tdsClosedCaptioningActive",showClosedCaptions).clearQueue("closedCaptionQueue"),visibleTracks.forEach(function(track){var container=getClosedCaptioningContainer(),wrapper=$('<div class="ccWrapper">').appendTo(container);track.oncuechange=function(){var visibleCues=track.activeCues.map(function(cue){return'<p class="currentText">'+cue.text+"</p>"}).join();wrapper.html(visibleCues)},track.oncuechange()})}var _closedCaptioningContainer,CSS_DISABLED="disabled",Recorder=Audio.Recorder,Player=Audio.Player,widgetList=[],recorderList=[],recorderLookup={},playerLookup={},ATTRIB_AUDIO_EVENT="data-audio-event",playerCount=0;TDS.Audio.Widget={},Recorder&&(Recorder.onDeviceInit.subscribe(function(){enableAll(),setEventClassAll("load_start")}),Recorder.onDeviceReady.subscribe(function(){enableAll();for(var i=0;i<recorderList.length;i++)recorderList[i].loaded?setEventClass(recorderList[i].id,"recording_done"):setEventClass(recorderList[i].id,"recording_ready")}),Recorder.onDeviceError.subscribe(function(id){enableAll(),setEventClassAll("recording_fail")}),Recorder.onDeviceException.subscribe(function(id){enableAll(),setEventClassAll("recording_fail")}),Recorder.onCaptureLoad.subscribe(function(id){recorderLookup[id]&&(recorderLookup[id].loaded=!0),setEventClass(id,"recording_done")}),Recorder.onCaptureStart.subscribe(function(id){disableAll(id),setEventClass(id,"recording_start")}),Recorder.onCaptureStop.subscribe(function(id){recorderLookup[id]&&(recorderLookup[id].loaded=!0,recorderLookup[id].dirty=!0),enableAll(),setEventClass(id,"recording_done"),Util.Browser.isMacPPC()&&(Recorder.playAudio(id),Recorder.stopAudio())}),Recorder.onPlayStart.subscribe(function(id){disableAll(id),setEventClass(id,"playing_start")}),Recorder.onPlayStop.subscribe(function(id){enableAll(),setEventClass(id,"playing_done")}),TDS.Audio.Widget.createRecorder=function(id,duration){var recorderEl=YUD.get(id);{if(recorderEl){id=recorderEl.id,widgetList.push(id),recorderList.push(recorderLookup[id]={id:id,el:recorderEl,loaded:!1,dirty:!1}),recorderEl.setAttribute(ATTRIB_AUDIO_EVENT,"recording_ready");var btnRecord=YUD.getElementsByClassName("btnRecord","a",recorderEl)[0],btnPlayPause=YUD.getElementsByClassName("btnPlayPause","a",recorderEl)[0];return YUE.addListener(btnRecord,"click",function(evt){YUE.stopEvent(evt),YUD.hasClass(recorderEl,CSS_DISABLED)||Player.isPlaying()||(YUD.hasClass(recorderEl,"recording_start")?Recorder.stopCapture():Recorder.startCapture(id,duration))}),YUE.addListener(btnPlayPause,"click",function(evt){YUE.stopEvent(evt),YUD.hasClass(recorderEl,CSS_DISABLED)||Player.isPlaying()||(YUD.hasClass(recorderEl,"playing_start")?Recorder.stopAudio():Recorder.playAudio(id))}),Recorder.isDeviceBroken()?YUD.addClass(recorderEl,"recording_fail"):Recorder.isReady()&&!Audio.isActive()&&YUD.removeClass(recorderEl,CSS_DISABLED),{id:id,controls:[btnRecord,btnPlayPause]}}console.warn("Could not find recorder id '"+id+"'")}},TDS.Audio.Widget.getRecorder=function(id){return recorderLookup[id]},TDS.Audio.Widget.createSourceSelect=function(id,onselect){"use strict";function stopMeter(meter){meter.analyser&&meter.analyser.disconnect(),meter.analyser=null,meter.streamContainer&&stopStream(meter.streamContainer.stream),meter.streamContainer=null}function stopStream(stream){"function"!=typeof stream.stop?([].forEach.call(stream.getAudioTracks(),function(track){track.stop()}),[].forEach.call(stream.getVideoTracks(),function(track){track.stop()})):stream.stop()}function updateVolumeMeter(meter,volume){volume=(100*volume).toFixed(0)+"%",meter.element.textContent=volume,"horizontal"===direction?meter.element.style.width=volume:"vertical"===direction&&(meter.element.style.height=volume)}function animateVolumeMeter(){disposed||(animating&&activeMeter&&activeMeter.analyser&&updateVolumeMeter(activeMeter,activeMeter.analyser.volume),requestAnimationFrame(animateVolumeMeter))}function startVolumeAnalyserFor(meter){meter.source.getStreamContainer(function(streamContainer){var stream=streamContainer.stream;if(0===stream.getAudioTracks().length)return console.log("no audio tracks for source",stream),void stopStream(stream);meter.analyser=webAudio.context.createVolumeAnalyser(),meter.streamContainer=streamContainer,streamContainer.streamSourceNode.connect(meter.analyser.head)},function(error){console.warn("Recorder.createSourceSelector: failed to get stream for a device; "+error)})}function createVolumeMeter(source){var container=document.createElement("div"),label=document.createElement("div"),meter=document.createElement("div"),volumeLevel=document.createElement("div");return YUD.addClass(label,"label"),label.textContent=source.label,YUD.addClass(meter,"meter"),meter.appendChild(volumeLevel),YUD.addClass(volumeLevel,"volumeLevel"),YUD.addClass(container,"device"),container.setAttribute("role","radio"),container.tabIndex=0,container.appendChild(label),container.appendChild(meter),meter={container:container,element:volumeLevel,analyser:null,source:source,streamContainer:null},YUE.addListener(container,"click",function(event){activeMeter&&stopMeter(activeMeter),activeMeter=meter,meters.forEach(function(meter){YUD.removeClass(meter.container,"selected"),meter.container.setAttribute("aria-checked","false")}),YUD.addClass(container,"selected"),container.setAttribute("aria-checked","true"),startVolumeAnalyserFor(meter),"function"==typeof onselect&&onselect(source.deviceId)}),sourcesContainer.appendChild(container),meter}var sourcesContainer=YUD.get(id);if(!sourcesContainer)return console.warn("could not find audio recording source select element"),null;var direction="horizontal",meters=[],activeMeter=null,animating=!1,disposed=!1;return{show:function(){animating=!0},hide:function(){animating=!1,meters.forEach(function(meter){updateVolumeMeter(meter,0)})},buildDeviceList:function(){var deferred=Util.Promise.defer();return Recorder.getSources(function(sources){var meter,length=sources.length,i=0;if(0!==length){for(;i<length;++i)meter=createVolumeMeter(sources[i]),meters.push(meter);deferred.resolve()}else deferred.reject()}),requestAnimationFrame(animateVolumeMeter),deferred.promise},dispose:function(){disposed=!0,this.hide(),meters.forEach(stopMeter)}}}),Player&&(Player.setup(),Player.onPlay.subscribe(function(id){disableAll(id),setEventClass(id,"playing_start")}),Player.onPause.subscribe(function(id){enableAll(),setEventClass(id,"playing_pause")}),Player.onResume.subscribe(function(id){disableAll(id),setEventClass(id,"playing_start")}),Player.onIdle.subscribe(function(id){enableAll(),setEventClass(id,"playing_done")}),Player.onFail.subscribe(function(id){enableAll(),setEventClass(id,"playing_fail")}),TDS.Audio.Widget.createPlayer=function(id){var controls=createPlayerControls(id,{playStop:!0});return{id:controls.container.id,controls:[controls.playStop]}},TDS.Audio.Widget.createPlayerRewind=function(id){var controls=createPlayerControls(id,{playPause:!0,rewind:!0});return{id:controls.container.id,controls:[controls.playPause,controls.rewind]}},TDS.Audio.Widget.createPlayerScrubber=function(id){var controls=createPlayerControls(id,{playPause:!0,scrubber:!0});return{id:controls.container.id,controls:[controls.playPause,controls.scrubber]}},TDS.Audio.Widget.getPlayer=function(id){return playerLookup[id]},function(){function hideCaptions(id){getClosedCaptioningContainer().toggleClass("tdsClosedCaptioningActive",!1)}Player.onStop.subscribe(hideCaptions),Player.onPause.subscribe(hideCaptions),Player.onFinish.subscribe(function(id){getClosedCaptioningContainer().delay(3e3,"closedCaptionQueue").toggleClass("tdsClosedCaptioningActive",!1)}),Player.onPlay.subscribe(renderTracksForSound),Player.onResume.subscribe(renderTracksForSound)}()),TDS.Audio.Widget.getIDs=function(){return widgetList}}(TDS.Audio),function(Audio){function AudioScrubber(audioId){this.audioId=audioId,this._isPlaying=!1,this.onChange=new Util.Event.Custom(this),TDS.Audio.Player.onTimeUpdate[this.audioId].subscribe(function(time){this.setTime(time)}.bind(this)),TDS.Audio.Player.onStart.subscribe(function(id){id===this.audioId&&(this._isPlaying=!0)}.bind(this)),TDS.Audio.Player.onPause.subscribe(function(id){id===this.audioId&&(this._isPlaying=!1)}.bind(this)),TDS.Audio.Player.onIdle.subscribe(function(id){id===this.audioId&&(this._isPlaying=!1)}.bind(this))}AudioScrubber.prototype.setTime=function(time){this._slider.setValue(time/this.getDuration()*100)},AudioScrubber.prototype.getDuration=function(){return TDS.Audio.Player.getDuration(this.audioId)},AudioScrubber.prototype.render=function(container,width){function toTime(sliderValue){return sliderValue/sliderMax*self.getDuration()}var wasPlayingAtStart,self=this,sliderMax=100;this._slider=Util.Slider.create(this.audioId+"_slider",0,sliderMax,width),container.appendChild(this._slider.getEl()),this._slider.onStart.subscribe(function(sliderValue,fromUserInterface){fromUserInterface&&(wasPlayingAtStart=this._isPlaying)&&TDS.Audio.Player.pause(this.audioId)}.bind(this)),this._slider.onChange.subscribe(function(sliderValue,fromUserInterface){fromUserInterface&&this.onChange.fire(toTime(sliderValue))}.bind(this)),this._slider.onEnd.subscribe(function(sliderValue,fromUserInterface){fromUserInterface&&(TDS.Audio.Player.setPosition(this.audioId,toTime(sliderValue)),wasPlayingAtStart&&TDS.Audio.Player.resume(this.audioId))}.bind(this))},AudioScrubber.prototype.getElement=function(){return this._slider.getEl()},Audio.Widget.createScrubber=function(audioId){return new AudioScrubber(audioId)}}(window.TDS.Audio),TTS=window.TTS||{},TTS.Config={PlayDelay:200,DefaultManager:"TTS.Manager",DefaultToSelection:!0,DefaultLanguage:"ENU",NoInit:!1,Debug:!1,i18n:{ESN:{option:"opcin"},ENU:{option:"option"}},isTrackingEnabled:function(){return!1},shouldSanitizeTextForTTS:function(){var ttxRule=null!=TDS.getAccommodationProperties()?TDS.getAccommodationProperties().getTTXBusinessRules():null;return null!=ttxRule&&-1!=ttxRule.indexOf("TDS_TTX_M")},getText:function(key,lang){return lang=lang||"ENU",TTS.Config.i18n[lang]?TTS.Config.i18n[lang][key]:key},User:{reset:function(){var langs=[TTS.Config.Lang.ESN.Code,TTS.Config.Lang.ENU.Code];langs.forEach(function(lang){TTS.Config.User.setVolume(TTS.Config.UserSet.Volume,lang),TTS.Config.User.setRate(TTS.Config.UserSet.Rate,lang),TTS.Config.User.setPitch(TTS.Config.UserSet.Pitch,lang)}),TTS.Config.User.setVoice("",langs)},getVoice:function(lang){return TTS.Config.User.getLocalStorage("Voice",lang)},setVoice:function(val,langs){langs=langs||[TTS.Config.Lang.ENU.Code];for(var k in langs){var lang=langs[k];TTS.getInstance().setVoice(val,lang)}TTS.Config.User.setLocalStorage("Voice",val,langs)},getRate:function(lang){return lang=lang||TTS.Config.Lang.ENU.Code,TTS.Config.User.getLocalStorage("Rate",lang)},setRate:function(val,lang){lang=lang||TTS.Config.Lang.ENU.Code,TTS.getInstance().setRate(val),TTS.Config.User.setLocalStorage("Rate",val,lang)},getPitch:function(lang){return lang=lang||TTS.Config.Lang.ENU.Code,TTS.Config.User.getLocalStorage("Pitch",lang)},setPitch:function(val,lang){lang=lang||TTS.Config.Lang.ENU.Code,TTS.getInstance().setPitch(val),TTS.Config.User.setLocalStorage("Pitch",val,lang)},getVolume:function(lang){return lang=lang||TTS.Config.Lang.ENU.Code,TTS.Config.User.getLocalStorage("Volume",lang)},setVolume:function(val,lang){lang=lang||TTS.Config.Lang.ENU.Code,TTS.getInstance().setVolume(val),TTS.Config.User.setLocalStorage("Volume",val,lang)},resetToDefaults:function(cfg,lang){lang=lang||TTS.Config.Lang.ENU.Code,cfg=cfg||TTS.Config.UserSet,TTS.Config.User.setVolume(cfg.Volume,lang),TTS.Config.User.setRate(cfg.Rate,lang),TTS.Config.User.setPitch(cfg.Pitch,lang)},getKey:function(val,lang){return lang=lang||TTS.Config.Lang.ENU.Code,"TTS_"+val+"_"+lang},getLocalStorage:function(str,lang){lang=lang||TTS.Config.Lang.ENU.Code;var key=TTS.Config.User.getKey(str,lang),ret=null;return window.Util&&Util.Storage&&(ret=Util.Storage.get(key)),void 0!==ret&&null!=ret||(ret=TTS.Config.User.Store[key]),void 0!==ret&&null!=ret||(ret=TTS.Config.UserSet[str]),TTS.Config.Debug&&console.log("TTS: Get this value (str, lang, key, ret)",str,lang,key,ret),ret},setLocalStorage:function(str,val,langs){"string"==typeof langs?langs=[langs]:langs||(langs=[TTS.Config.Lang.ENU.Code]);for(var i=0;i<langs.length;++i){var lang=langs[i],key=TTS.Config.User.getKey(str,lang);TTS.Config.Debug&&console.log("TTS: SET this local store value (str, lang, key)",str,lang,key,val),window.Util&&Util.Storage?Util.Storage.set(key,val):TTS.Config.User.Store[key]=val}},Store:{}},UserSet:{ShowVoicePacks:!0,ShowAdjustments:!0,ShowVolume:!0,MinVolume:0,MaxVolume:10,Volume:10,ShowPitch:!0,MinPitch:0,MaxPitch:20,Pitch:10,ShowRate:!0,MinRate:0,MaxRate:20,Rate:10,TickSize:20,LengthInPixels:200},Lang:{ENU:{Code:"ENU",Enabled:!0,Label:"English"},ESN:{Code:"ESN",Enabled:!0,Label:"Espaol"}},DefaultVoices:[{name:"MS_EN-US_DAVID",priority:3,language:"ENU"},{name:"MS_EN-US_ZIRA",priority:3,language:"ENU"},{name:"MS_EN-GB_HAZEL",priority:4,language:"ENU"},{name:"MSSam",priority:3,language:"ENU"},{name:"MSAnna",priority:3,language:"ENU"},{name:"MS-Anna",priority:3,language:"ENU"},{name:"MSMike",priority:3,language:"ENU"},{name:"MSMary",priority:3,language:"ENU"},{name:"MICHAEL",priority:2,language:"ENU"},{name:"MICHELLE",priority:2,language:"ENU"},{name:"VW Julie",priority:1,language:"ENU"},{name:"Julie",priority:1,language:"ENU"},{name:"Kate",priority:1,language:"ENU"},{name:"Paul",priority:1,language:"ENU"},{name:"Cepstral_Marta",priority:1,language:"ESN"},{name:"Cepstral_David",priority:1,language:"ENU"},{name:"Cepstral_Miguel",priority:2,language:"ESN"},{name:"Violeta",priority:2,language:"ESN"},{name:"kal_diphone",priority:3,language:"ENU"},{name:"el_diphone",priority:3,language:"ESN"},{name:"ked_diphone",priority:4,language:"ENU"},{name:"cmu_us_awb_arctic_hts",priority:5,language:"ENU"},{name:"cmu_us_slt_arctic_hts",priority:6,language:"ENU"},{name:"cmu_us_jmk_arctic_hts",priority:7,language:"ENU"},{name:"cmu_us_bdl_arctic_hts",priority:8,language:"ENU"},{name:"Agnes",priority:9,language:"ENU"},{name:"Alex",priority:11,language:"ENU"},{name:"Bruce",priority:16,language:"ENU"},{name:"Fred",priority:20,language:"ENU"},{name:"Junior",priority:23,language:"ENU"},{name:"Kathy",priority:24,language:"ENU"},{name:"Princess",priority:26,language:"ENU"},{name:"Ralph",priority:27,language:"ENU"},{name:"Vicki",priority:29,language:"ENU"},{name:"Victoria",priority:30,language:"ENU"},{name:"Rosa Infovox iVox HQ",priority:1,language:"ESN"},{name:"Heather Infovox iVox HQ",priority:1,language:"ENU"},{name:"Javier",priority:9,language:"ESN"},{name:"Monica",priority:9,language:"ESN"},{name:"Paulina",priority:9,language:"ESN"},{name:"US English Female TTS (by google)",priority:9,language:"ENU"},{name:"Chrome OS US English Voice",priority:9,language:"ENU"},{name:"native",priority:9,language:"ENU"},{name:"Chrome OS US English",priority:9,language:"ENU"},{name:"android",priority:9,language:"ENU"},{name:"julie",priority:9,language:"ENU"},{name:"violeta",priority:9,language:"ESN"},{name:"en-US",priority:9,language:"ENU"},{name:"es-ES",priority:9,language:"ESN"},{name:"eng",priority:9,language:"ENU"},{name:"spa",priority:9,language:"ESN"}],getVoices:function(){return window.TDS&&TDS.Config&&TDS.Config.voicePacks&&TDS.Config.voicePacks.length?TDS.Config.voicePacks:TTS.Config.DefaultVoices}},YUD=YAHOO.util.Dom,TTS.Util={createDiv:function(strOrHtml){var newdiv=document.createElement("div");return newdiv.innerHTML=strOrHtml||"",newdiv},getSub:function(elmObj,attrTag,lang){if(elmObj){if(lang=lang||"ENU",attrTag=attrTag||"ssml","SPAN"==elmObj.nodeName){if((YUD.hasClass(elmObj,"tts")||YUD.hasClass(elmObj,"TTS"))&&null!=elmObj.attributes&&null!=elmObj.attributes.getNamedItem("ssml")&&"sub"==elmObj.attributes.getNamedItem("ssml").nodeValue){var ssmlAlias="";return null!=elmObj.attributes.getNamedItem(attrTag)&&(ssmlAlias=elmObj.attributes.getNamedItem(attrTag).nodeValue),ssmlAlias+" "}}else if("INPUT"==elmObj.nodeName&&YUD.hasClass(elmObj,"tts")&&null!=elmObj.attributes&&null!=elmObj.attributes.getNamedItem(lang))return elmObj.attributes.getNamedItem(lang).nodeValue+" ";return null}},ignore:function(node){if(node&&"true"==YUD.getAttribute(node,"data-tts-skip"))return!0},hasAlt:function(node){if(node&&3!=node.nodeType&&(YUD.hasClass(node,"hasAlt")||YUD.hasClass(node,"contextAreaAlt")))return!0},bubble:function(node,match,results){return results=results||{},node&&"function"==typeof match&&(match(node)?results.node=node:node.parentNode&&"BODY"!=node.nodeName&&"IFRAME"!=node.nodeName&&TTS.Util.bubble(node.parentNode,match,results)),results.node},dfs:function(nodes,match,results){if(nodes){results=results||{};for(var i=0;i<nodes.length;++i){var node=nodes[i];if(results.node)break;if(match(node)){results.node=node;break}TTS.Util.dfs(node.childNodes,match,results)}return results.node}},cleanText:function(text,addHacks){return text=text.replace(/"/g," "),text=text.replace(/\u201C/g," "),text=text.replace(/\u201D/g," "),text=text.replace(/\u2019/g,"'"),TTS.Config.shouldSanitizeTextForTTS()&&(text=text.replace(/[^\u0000-\u0081\u00C1\u00E1\u00C9\u00E9\u00CD\u00ED\u00D1\u00F1\u00D3\u00F3\u00DA\u00FA\u00DC\u00FC\u00AB\u00BB\u00BF\u00A1\u2047]+/g,"")),null!=text&&""!=text&&addHacks&&(text=TTS.Util.addTagsAndHacks(text)),text=text.replace(/{silence}/g,"{silence:200}"),text=Util.Browser.isWindows()?text.replace(/{silence:([0-9]+)}/g,',<silence msec="$1"/>'):Util.Browser.isMac()?(text=text.replace(/\u00A0/g," ")).replace(/{silence:([0-9]+)}/g,"[[slnc $1]]"):text.replace(/{silence:([0-9]+)}/g," ; ")},replaceLeadDirectives:function(text){var replaceText=function(expString,target){var exp=new RegExp(expString),prefix=TTS.Util.getTTSPrefix(),prefixRegExp=new RegExp("^"+prefix+"\\s*"+expString),replacement=prefixRegExp.exec(target);if(replacement&&replacement[0]){var spaces=exp.exec(replacement[0]);spaces&&spaces[0]&&(spaces=spaces[0].replace(/\S/g," "),replacement=replacement[0].replace(exp,spaces))}return target=target.replace(prefixRegExp,replacement)},expString=";";return text=replaceText(expString,text),expString=',<silence msec="[0-9]*"/>',text=replaceText(expString,text)},shortenSilence:function(text){if(Util.Browser.isWindows()){for(var shortenSilence=text.split("/>"),filteredSilence=/<silencemsec="200"/g,silence=/<silence msec="200"/g,i=shortenSilence.length-1;i>0;i--){var filteredShortenSilence=i>0?shortenSilence[i-1].replace(/[ ,]/g,""):null;filteredShortenSilence&&0==filteredShortenSilence.search(filteredSilence)&&(shortenSilence[i]=shortenSilence[i].replace(silence,'<silence msec="1"  '))}text=shortenSilence.join("/>")}else if(Util.Browser.isMac()){for(filteredSilence=/\[\[slnc200/g,silence=/\[\[slnc 200/g,i=(shortenSilence=text.split("]]")).length-1;i>0;i--)(filteredShortenSilence=i>0?shortenSilence[i-1].replace(/[ ,]/g,""):null)&&0==filteredShortenSilence.search(filteredSilence)&&(shortenSilence[i]=shortenSilence[i].replace(silence,"[[slnc 1  "));text=shortenSilence.join("]]")}return text},getTTSPrefix:function(){var text="";return Util.Browser.isWindows()?'<bookmark mark="start"/> ':(Util.Browser.isMac()&&(text="[[sync 0x000000A1]] "),text)},getTTSPostscript:function(){var text="";return Util.Browser.isMac()&&(text=" [[sync 0x000000A2]]"),text},getDisplayType:function(element){return element.nodeType!=Node.ELEMENT_NODE?"inline":(element.currentStyle||window.getComputedStyle(element,"")).display}},TTS.Status={NotSupported:"NotSupported",Uninitialized:"Uninitialized",Initializing:"Initializing",Stopped:"Stopped",Playing:"Playing",Paused:"Paused",Unknown:"Unknown"},TTS.VoicePack=function(voicename,priority,language,available,isDefault){this.Voicename=voicename,this.Priority=priority,this.Language=language,this.Available=available,this.IsDefault=isDefault},TTS.Manager={Events:{onShowProgress:new YAHOO.util.CustomEvent("onShowProgress",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onHideProgress:new YAHOO.util.CustomEvent("onHideProgress",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onServiceLoad:new YAHOO.util.CustomEvent("onServiceLoad",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onInitSuccess:new YAHOO.util.CustomEvent("onInitSuccess",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onInitFailure:new YAHOO.util.CustomEvent("onInitFailure",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onStatusChange:new YAHOO.util.CustomEvent("onStatusChange",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onVolumeChange:new YAHOO.util.CustomEvent("onVolumeChange",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onPitchChange:new YAHOO.util.CustomEvent("onPitchChange",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onRateChange:new YAHOO.util.CustomEvent("onRateChange",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onVoiceChange:new YAHOO.util.CustomEvent("onVoiceChange",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onError:new YAHOO.util.CustomEvent("onError",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onWord:new YAHOO.util.CustomEvent("onWord",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT),onLog:new YAHOO.util.CustomEvent("onLog",TTS.Manager,!1,YAHOO.util.CustomEvent.FLAT)},_debugging:!1,_service:null,_lastStatus:TTS.Status.Uninitialized,_lastVolume:-1,_lastPitch:-1,_lastRate:-1,_lastVoice:null,_lastVoiceLanguage:null,_serviceEvents:["play","pause","resume","stop","setVolume","setVoice"],_statusPollingTimer:null,_statusPollingInterval:0,_statusPollingIntervalActive:500,_statusPollingIntervalIdle:3e4,_statusPollingMinActive:3e3,_statusPollingDateActive:null,_volumeFix:!1,_knownVoicePacks:[],_knownLanguages:{},_pausedEl:null,_initialized:!1},TTS.Manager._addKnownLanguage=function(languageCode){languageCode=languageCode.toUpperCase(),TTS.Manager._knownLanguages[languageCode]=languageCode},TTS.Manager.isKnownLanguage=function(languageCode){return languageCode=languageCode.toUpperCase(),null!=TTS.Manager._knownLanguages[languageCode]},TTS.Manager.log=function(message){TTS.Manager._debugging&&Util.log(message),TTS.Manager.Events.onLog.fire(message)},TTS.Manager.init=function(forceInit){if(TTS.Manager.Events.onServiceLoad.subscribe(function(service){TTS.Manager._initService(service)?TTS.Manager._initialized=!0:(TTS.Manager._lastStatus=TTS.Status.NotSupported,TTS.Manager.Events.onInitFailure.fire())}),1!=forceInit){if(TTS.Manager.getStatus()!=TTS.Status.Uninitialized)return}else TTS.Manager._service=null,delete TTS.Manager._service,TTS.Manager._changeStatus(TTS.Status.Uninitialized),TTS.Manager.Events.onServiceLoad.unsubscribeAll();try{var service=null;if(Util.Browser.isSecure()&&Util.Browser.isCertified()?service=new TTSService_Certified:Util.Browser.isSecure()&&Util.Browser.getSecureVersion()>0&&YAHOO.lang.isFunction(TTSService_SB)&&!Util.Browser.isMobile()?service=new TTSService_SB:"undefined"!=typeof TTSService_Applet&&YAHOO.lang.isFunction(TTSService_Applet)?service=new TTSService_Applet:Util.Browser.isSecure()&&(Util.Browser.isAndroid()||Util.Browser.isIOS()&&Util.Browser.getSecureVersion()>=2)?service=new TTSService_Generic:Util.Browser.isSecure()&&Util.Browser.isChrome()&&(service=new TTSService_Chrome),!service||!service.isSupported()||!service.load())return TTS.Manager._changeStatus(TTS.Status.NotSupported),!1;TTS.Manager._service=service,TTS.Manager.log("initializing"),TTS.Manager._changeStatus(TTS.Status.Initializing)}catch(ex){console.error("Failed to load a service.",ex),TTS.Manager.log(ex)}},TTS.Manager._initService=function(){TTS.Manager._initializeAvailableVoices(),TTS.Manager._updateStatus(),TTS.Manager.loadUserSettings(),TTS.Manager.Events.onInitSuccess.fire(),TTS.Manager.Events.onVolumeChange.fire(TTS.Manager._lastVolume),TTS.Manager.Events.onPitchChange.fire(TTS.Manager._lastPitch),TTS.Manager.Events.onRateChange.fire(TTS.Manager._lastRate),TTS.Manager._lastVoice=TTS.Manager.getVoice(),TTS.Manager.Events.onVoiceChange.fire(TTS.Manager._lastVoice);var service=TTS.Manager._service;return service&&service.subscribe&&TTS.Manager._service.subscribe(TTS.Manager.Events.onWord),!0},TTS.Manager._serviceFuncExists=function(functionName){return null!=TTS.Manager._service&&"function"==typeof TTS.Manager._service[functionName]},TTS.Manager.getStatus=function(){if(!TTS.Manager._serviceFuncExists("getStatus"))return TTS.Manager._lastStatus;try{return TTS.Manager._service.getStatus()}catch(ex){return TTS.Status.Unknown}},TTS.Manager.supportsVolumeControl=function(){return!!TTS.Manager._serviceFuncExists("supportsVolumeControl")&&TTS.Manager._service.supportsVolumeControl()},TTS.Manager.supportsPitchControl=function(){return!!TTS.Manager._serviceFuncExists("supportsPitchControl")&&TTS.Manager._service.supportsPitchControl()},TTS.Manager.supportsRateControl=function(){return!!TTS.Manager._serviceFuncExists("supportsRateControl")&&TTS.Manager._service.supportsRateControl()},TTS.Manager.play=function(text,language){language=language||"ENU";var played=!1;try{if(null==text||0==text.length)return!1;if(!TTS.Manager._serviceFuncExists("play"))return!1;if(!TTS.Manager.isLanguageSupported(language))return!1;var currentStatus=TTS.Manager.getStatus();if(currentStatus==TTS.Status.Playing)return!1;currentStatus==TTS.Status.Unknown&&TTS.Manager.stop(),TTS.Manager.setVoiceForLanguage(language),played=TTS.Manager._service.play(text),currentStatus!=TTS.Status.Unknown&&(TTS.Manager._statusPollingDateActive=new Date,TTS.Manager._statusPollingInterval=TTS.Manager._statusPollingIntervalActive,TTS.Manager._updateStatus())}catch(ex){console.error("Failed to play the sound.",ex),TTS.Manager.log(ex)}return played},TTS.Manager.stop=function(){if(!TTS.Manager._serviceFuncExists("stop"))return!1;var currentStatus=TTS.Manager.getStatus();if(currentStatus!=TTS.Status.Playing&&currentStatus!=TTS.Status.Unknown&&currentStatus!=TTS.Status.Paused)return!1;try{return TTS.Manager._service.stop()}catch(ex){return TTS.Manager.log(ex),!1}},TTS.Manager._getCurrentEl=function(){var currentDomEnt=TTS.getInstance().getCurrentDomEntity();return!!currentDomEnt&&currentDomEnt.getElement()},TTS.Manager.pause=function(){return!!TTS.Manager._serviceFuncExists("pause")&&(TTS.Manager.getStatus()==TTS.Status.Playing&&(TTS.Manager._pausedEl=this._getCurrentEl(),TTS.Manager._service.pause()))},TTS.Manager.canResume=function(){return this._getCurrentEl()==TTS.Manager._pausedEl},TTS.Manager.resume=function(){return!!TTS.Manager._serviceFuncExists("resume")&&(TTS.Manager.getStatus()==TTS.Status.Paused&&(TTS.Manager.getStatus()!=TTS.Status.Unknown&&(TTS.Manager._statusPollingDateActive=new Date,TTS.Manager._statusPollingInterval=TTS.Manager._statusPollingIntervalActive,TTS.Manager._updateStatus()),TTS.Manager._service.resume()))},TTS.Manager.getVoices=function(){if(!TTS.Manager._serviceFuncExists("getVoices"))return[];var voices=TTS.Manager._service.getVoices();return TTS.Config.Debug&&console.log("getVoice call returned.",voices,TTS.Manager._service),voices},TTS.Manager.getVoice=function(){return TTS.Manager._serviceFuncExists("getVoice")?TTS.Manager._service.getVoice():null},TTS.Manager.loadUserSettings=function(){try{if(!Util||!Util.Storage)return;var curLang,curVoicePack=TTS.Manager.getCurrentVoicePack();curVoicePack&&(curLang=curVoicePack.Language),TTS.Manager.setVolume(TTS.Config.User.getVolume(curLang)),TTS.Manager.setPitch(TTS.Config.User.getPitch(curLang)),TTS.Manager.setRate(TTS.Config.User.getRate(curLang));for(var langCodes=TTS.Manager.getKnownLanguageCodes(),i=0;i<langCodes.length;i++){var langVoicePref=TTS.Config.User.getVoice(langCodes[i]);if(langVoicePref){TTS.Config.Debug&&console.log("Setting a user preference for the language.",langVoicePref);for(var voicePacks=TTS.Manager.getVoicesForLanguage(langCodes[i]),j=0;j<voicePacks.length;j++){var voicePack=voicePacks[j];voicePack.ServiceVoiceName==langVoicePref&&(TTS.Manager.setAsPreferredVoicePack(voicePack),TTS.Manager.setVoice(voicePack.ServiceVoiceName))}}}}catch(e){console.error("Failed to load user settings.",e)}},TTS.Manager.setVoice=function(name){if(!TTS.Manager._serviceFuncExists("setVoice"))return null;if(!YAHOO.util.Lang.isString(name))throw new Error("Invalid voice name");try{TTS.Manager._service.setVoice(name),TTS.Manager.Events.onVoiceChange.fire(name)}catch(ex){console.error("Failed to set the voice.",name)}},TTS.Manager.getVolume=function(){return TTS.Manager._serviceFuncExists("getVolume")?TTS.Manager._service.getVolume():-1},TTS.Manager.setVolume=function(level){if(!TTS.Manager._serviceFuncExists("setVolume"))return!1;if(!YAHOO.util.Lang.isNumber(level))throw new Error("Invalid volume level: value="+level+" type="+typeof level);try{TTS.Manager._service.setVolume(level),TTS.Manager.Events.onVolumeChange.fire(level),TTS.Manager._lastVolume=level}catch(ex){console.error("Failed to set the volume.",ex,level)}},TTS.Manager.increaseVolume=function(){var current=TTS.Manager.getVolume();return 10!=current&&(TTS.Manager.setVolume(current+1),!0)},TTS.Manager.decreaseVolume=function(){var current=TTS.Manager.getVolume();return 0!=current&&(TTS.Manager.setVolume(current-1),!0)},TTS.Manager.getPitch=function(){return TTS.Manager._serviceFuncExists("getPitch")?TTS.Manager._service.getPitch():-1},TTS.Manager.setPitch=function(level){if(!TTS.Manager._serviceFuncExists("setPitch"))return!1;if(!YAHOO.util.Lang.isNumber(level))throw new Error("Invalid pitch level: value="+level+" type="+typeof level);try{TTS.Manager._service.setPitch(level),TTS.Manager.Events.onPitchChange.fire(level),TTS.Manager._lastPitch=level}catch(ex){console.error("Failed to set the pitch",ex,level),TTS.Manager.log(ex)}},TTS.Manager.getRate=function(){return TTS.Manager._serviceFuncExists("getRate")?TTS.Manager._service.getRate():-1},TTS.Manager.setRate=function(level){if(!TTS.Manager._serviceFuncExists("setRate"))return!1;if(!YAHOO.util.Lang.isNumber(level))throw new Error("Invalid rate level: value="+level+" type="+typeof level);try{TTS.Manager._service.setRate(level),TTS.Manager.Events.onRateChange.fire(level),TTS.Manager._lastRate=level}catch(ex){console.error("Failed to set the TTS Manager Rate information.",ex,level),TTS.Manager.log(ex)}},TTS.Manager.isAvailable=function(){var ttsStatus=TTS.Manager.getStatus();return ttsStatus==TTS.Status.Stopped||ttsStatus==TTS.Status.Playing||ttsStatus==TTS.Status.Paused},TTS.Manager._updateStatus=function(){null!=TTS.Manager._statusPollingTimer&&TTS.Manager._statusPollingTimer.cancel();var currentStatus=TTS.Manager.getStatus();if(currentStatus!=TTS.Manager._lastStatus&&this._changeStatus(currentStatus),currentStatus==TTS.Status.Playing)TTS.Manager._statusPollingInterval=TTS.Manager._statusPollingIntervalActive;else if(currentStatus==TTS.Status.Stopped||currentStatus==TTS.Status.Paused){var diffPollingActive=new Date-(TTS.Manager._statusPollingDateActive||0);(0==TTS.Manager._statusPollingMinActive||diffPollingActive>TTS.Manager._statusPollingMinActive)&&(TTS.Manager._statusPollingDateActive=null,TTS.Manager._statusPollingInterval=TTS.Manager._statusPollingIntervalIdle)}this._statusPollingInterval>0&&(TTS.Manager._statusPollingTimer=YAHOO.lang.later(this._statusPollingInterval,TTS.Manager,TTS.Manager._updateStatus))},TTS.Manager._changeStatus=function(currentStatus){if(TTS.Manager._lastStatus=currentStatus,currentStatus==TTS.Status.Playing&&!TTS.Manager._volumeFix&&!TTS.Manager._volumeFix){var volume=TTS.Manager._lastVolume>=0?TTS.Manager._lastVolume:10;TTS.Manager.setVolume(volume);var pitch=TTS.Manager._lastPitch>=0?TTS.Manager._lastPitch:10;TTS.Manager.setPitch(pitch);var rate=TTS.Manager._lastRate>=0?TTS.Manager._lastRate:10;TTS.Manager.setRate(rate),TTS.Manager._volumeFix=!0}TTS.Manager.Events.onStatusChange.fire(currentStatus)},TTS.Manager._initializeAvailableVoices=function(){var availableVoices=TTS.Manager.getVoices();if(TTS.Config.Debug&&console.log("TTS.Manager Available Voices: ",availableVoices),null!=availableVoices&&void 0!==availableVoices){for(counter1=0;counter1<TTS.Manager._knownVoicePacks.length;++counter1)for(var voicePackElement=TTS.Manager._knownVoicePacks[counter1],counter2=0;counter2<availableVoices.length;++counter2){var availableVoice=availableVoices[counter2],availableVoiceLower=availableVoice.toLowerCase(),voicePackVoiceNameLower=voicePackElement.Voicename.toLowerCase();if(availableVoiceLower.indexOf(voicePackVoiceNameLower,0)>=0){voicePackElement.Available=!0,voicePackElement.ServiceVoiceName=availableVoice;break}}for(var defaultVoice=TTS.Manager.getVoice(),counter1=0;counter1<TTS.Manager._knownVoicePacks.length;++counter1){voicePackElement=TTS.Manager._knownVoicePacks[counter1];defaultVoice.indexOf(voicePackElement.Voicename,0)>=0?(voicePackElement.IsDefault=!0,voicePackElement.Priority=1):(voicePackElement.IsDefault=!1,voicePackElement.Priority=voicePackElement.Priority+1)}}},TTS.Manager.clearVoicePacks=function(){TTS.Manager._knownVoicePacks=[]},TTS.Manager.registerVoicePack=function(voicename,priority,language){TTS.Manager._knownVoicePacks.push(new TTS.VoicePack(voicename,priority,language,!1,!1)),TTS.Manager._addKnownLanguage(language)},TTS.Manager.getVoicesForLanguage=function(language){var availableVoices=TTS.Manager.getVoices(),availableVoicesForLanguage=[];if(null!=availableVoices&&void 0!==availableVoices){for(var counter=0;counter<TTS.Manager._knownVoicePacks.length;++counter){var voicePackElement=TTS.Manager._knownVoicePacks[counter];voicePackElement.Language==language&&voicePackElement.Available&&availableVoicesForLanguage.push(voicePackElement)}return availableVoicesForLanguage}},TTS.Manager.getVoiceForLanguage=function(language){for(var defaultVoice=null,selectedVoice=new TTS.VoicePack(null,100,null,!1,!1),counter1=0;counter1<TTS.Manager._knownVoicePacks.length;++counter1){var thisVoice=TTS.Manager._knownVoicePacks[counter1];thisVoice.IsDefault&&(defaultVoice=thisVoice),thisVoice.Language==language&&thisVoice.Available&&selectedVoice.Priority>thisVoice.Priority&&(selectedVoice=thisVoice)}return selectedVoice.Available||(selectedVoice=defaultVoice),selectedVoice},TTS.Manager.setVoiceForLanguage=function(language){var selectedVoice=TTS.Manager.getVoiceForLanguage(language),currentVoicePack=TTS.Manager.getCurrentVoicePack();selectedVoice&&selectedVoice!=currentVoicePack&&(currentVoicePack&&selectedVoice.Language==currentVoicePack.Language&&selectedVoice.ServiceVoiceName!=TTS.Manager.getCurrentVoicePack().ServiceVoiceName&&(selectedVoice=TTS.Manager.getCurrentVoicePack()),TTS.Manager.setVoice(selectedVoice.ServiceVoiceName),TTS.Manager.setVolume(TTS.Config.User.getVolume(language)),TTS.Manager.setPitch(TTS.Config.User.getPitch(language)),TTS.Manager.setRate(TTS.Config.User.getRate(language)),TTS.Manager._lastVoiceLanguage=language)},TTS.Manager.getCurrentVoicePack=function(){for(var voiceName=TTS.Manager.getVoice(),i=0;i<TTS.Manager._knownVoicePacks.length;i++){var voicePack=TTS.Manager._knownVoicePacks[i];if(voiceName.toLowerCase().indexOf(voicePack.Voicename.toLowerCase())>=0)return voicePack}return null},TTS.Manager.isLanguageSupported=function(languageCode){for(var counter1=0;counter1<TTS.Manager._knownVoicePacks.length;++counter1){var thisVoice=TTS.Manager._knownVoicePacks[counter1];if(thisVoice.Language==languageCode&&thisVoice.Available)return!0}return!1},TTS.Manager.getKnownLanguageCodes=function(){var languages=[];for(var lang in TTS.Manager._knownLanguages)languages.push(lang);return languages},TTS.Manager.setAsPreferredVoicePack=function(voicePack){voicePack.Available&&(voicePack.Priority=0)},TTS.Manager.Events.onStatusChange.subscribe(function(currentStatus){TTS.Manager.log("status change: '"+function(status){return status==TTS.Status.Stopped?"Stopped":status==TTS.Status.Playing?"Playing":status==TTS.Status.Paused?"Paused":"Uninitialized"}(currentStatus)+"'")}),TTS.Manager.Events.onVolumeChange.subscribe(function(volume){TTS.Manager.log("volume change - "+volume)}),TTS.Manager.Events.onVoiceChange.subscribe(function(voice){TTS.Manager.log("voice change - '"+voice+"'")}),TTSManager=TTS.Manager,TTSStatus=TTS.Status,TDS=window.TDS||{},TTS=window.TTS||{},TTS.version=2,TTS.Store=TTS.Store||{count:0,Instances:{}},TTS.Singleton=null,TTS.createSingleton=function(NoInit){if(!TTS.Singleton){var cfg=JSON.parse(JSON.stringify(TTS.Config));cfg.NoInit=NoInit,TTS.Singleton=new TTS.Control(cfg),TTS.Singleton.init()}},TTS.getInstance=function(NoInit){return TTS.Singleton||TTS.createSingleton(NoInit),TTS.Singleton},TTS.Control=function(cfg){var _cfg=cfg||JSON.parse(JSON.stringify(TTS.Config)),_eM=this.getEventManager(),_highObj=new TTS.Parse.Highlighter,_manager=null,_currentDomEntity=null;_highObj.subscribe(_eM),this.getConfig=function(){return _cfg},this.getHighlighter=function(){return _highObj};var getManager=function(){return _manager||(_manager=window[_cfg.DefaultManager]||window.TTS.Manager),_manager};this.getCurrentDomEntity=function(){return _currentDomEntity},this.setCurrentDomEntity=function(node){_currentDomEntity=node},this.getMarkedLanguage=function(node,failIfNotFound){if(!node)return null;if(3==node.nodeType||4==node.nodeType||8==node.nodeType)return this.getMarkedLanguage(node.parentNode);var language=tds.language.getITSAttribute(node);if(language)return language;if(failIfNotFound)return null;var entity=this.getCurrentDomEntity();return entity&&tds.language.tagElements(entity.getElement()),this.getMarkedLanguage(node,!0)},this.init=function(cb){_cfg.NoInit||(this.eventSubscribe(cb),this.OSHacks(),this.registerVoices(TTS.Config.getVoices()),getManager().init())};TTS.Store.Instances[TTS.Store.count++]=this},TTS.Control.prototype.runOnInit=function(cb){if("function"==typeof cb){var state=TTS.Manager.getStatus();TTS.Manager._initialized||state==TTS.Status.NotSupported?cb(state):this.getEventManager().onInitSuccess.subscribe(cb)}},TTS.Control.prototype.isLanguageSupported=function(langCode){return TTS.Manager.isLanguageSupported(langCode)},TTS.Control.prototype.getVoicesForLanguage=function(lang){return lang=lang||TTS.Config.Lang.ENU.Code,TTS.Manager.getVoicesForLanguage(lang)},TTS.Control.prototype.getVoiceForLanguage=function(lang){return lang=lang||TTS.Config.Lang.ENU.Code,TTS.Manager.getVoiceForLanguage(lang)},TTS.Control.prototype.getStatus=function(){return TTS.Manager.getStatus()},TTS.Control.prototype.getVoice=function(){return TTS.Manager.getVoice()},TTS.Control.prototype.getVoices=function(){return TTS.Manager.getVoices()},TTS.Control.prototype.registerVoices=function(voices){if((voices=voices||TTS.Config.getVoices())&&voices.length){TTS.Manager.clearVoicePacks();for(var i=0;i<voices.length;i++){var voicePack=voices[i];TTS.Manager.registerVoicePack(voicePack.name,voicePack.priority,voicePack.language)}TTS.Manager._initialized&&TTS.Manager._initializeAvailableVoices()}},TTS.Control.prototype.setManager=function(manager){this._manager=manager},TTS.Control.prototype.OSHacks=function(){Util.Browser.isLinux()?this.speak=function(text,language){TTS.Manager.play(text,language)}:this.speak=function(text,language){setTimeout(function(){TTS.Manager.play(text,language)},this.getConfig().PlayDelay||0)}},TTS.Control.prototype.speak=function(dom,parseType,language,selection){this.Error(new Error("If this is in the message, then the TTS.Manager did not init correctly."))},TTS.Control.prototype.eventSubscribe=function(cb){var eventManager=this.getEventManager();eventManager.onStatusChange.subscribe(function(newStatus){TTS.Config.Debug&&console.log("TTS Status Change.",newStatus)}.bind(this)),eventManager.onInitSuccess.subscribe(function(cb){TTS.Config.Debug&&console.log("Initializing TTS: Success."),"function"==typeof cb&&cb(),this.initSuccess()}.bind(this,cb)),eventManager.onInitFailure.subscribe(function(){console.error("Initializing TTS: Failed."),"function"==typeof cb&&cb()}.bind(this,cb))},TTS.Control.prototype.initSuccess=function(){try{this.INIT_SUCCESS=!0}catch(e){this.Error(e)}},TTS.Control.prototype.play=function(domNode,language){try{this.stop(),language||(language=this.getMarkedLanguage(domNode)),language||(language=tds.language.getITSDefault()),this.pn=new TTS.Parse.ParseNode(language,domNode),this.playParseNode(this.pn,language)}catch(e){this.Error(e)}return null},TTS.Control.prototype.playSelection=function(sel,language){try{this.stop(),language||(language=tds.language.getITSDefault());var selector=new TTS.Parse.Selector(sel,language);if(null==selector)return null;sel&&"function"==typeof sel.collapseToStart&&sel.collapseToStart(),this.pn=selector.collectNodes(),this.playParseNode(this.pn,language)}catch(e){this.Error(e)}return null},TTS.Control.prototype.playParseNode=function(pn,language){try{this.stop();var speakString=pn.CompileSpeakString();this.pn=pn,speakString=TTS.Util.replaceLeadDirectives(speakString),speakString=TTS.Util.shortenSilence(speakString),this.getHighlighter().setSpeakString(speakString,pn),this.speak(speakString,language)}catch(e){this.Error(e)}},TTS.Control.prototype.hasActualWords=function(text){return!!text&&text.search(/[\S]/g)>-1},TTS.Control.prototype.isPlaying=function(){var state=TTS.Manager.getStatus();return state!=TTS.Status.NotSupported&&(state==TTS.Status.Playing||state==TTS.Status.Unknown)},TTS.Control.prototype.isAvailable=function(){return TTS.Manager.isAvailable()},TTS.Control.prototype.canResume=function(){return TTS.Manager.canResume()},TTS.Control.prototype.resume=function(){var lang=this.pn.getLanguage(),node=this.pn.getNode();this.pn=new TTS.Parse.ParseNode(lang,node),this.getHighlighter().setParseNodeRoot(this.pn),TTS.Manager.resume()},TTS.Control.prototype.stop=function(){TTS.Manager.stop()},TTS.Control.prototype.pause=function(){TTS.Manager.pause()},TTS.Control.prototype.getEventManager=function(){return TTS.Manager.Events},TTS.Control.prototype.setVoice=function(val,langs){TTS.Manager.setVoice(val)},TTS.Control.prototype.setVolume=function(val){TTS.Manager.setVolume(val)},TTS.Control.prototype.setRate=function(val){TTS.Manager.setRate(val)},TTS.Control.prototype.setPitch=function(val){TTS.Manager.setPitch(val)},TTS.Control.prototype.Error=function(exception){TTS.Config.Debug&&console.log(exception),TDS.Diagnostics.report(exception)},TTS=window.TTS||{},TTS.Parse=window.TTS.Parse||{},TTS.Parse.TTSNodeTypes={Speak:0,DoNotSpeak:1,Alt:2,CompoundSpeak:3,ContainerWithPause:4,Silence:5,SpeakableInput:6,Image:7,Other:8},TTS.Parse.ParseNode=function(lang,node,offset,startIndex,endOffset,doNotAssemble,insertPrecedingSpace){var _lang=lang,_ttsNodeType=TTS.Parse.TTSNodeTypes.Other,_speakString="",_children=new Array,_offset=null!=offset&&offset?offset:0,_domNode=node,_startIndex=null==startIndex?0:startIndex,_endIndex=_startIndex,_cutoff=null,_prefix="",_postscript="";endOffset&&-1!=endOffset||(endOffset=null);var isFirst=0==_offset&&null==endOffset,Debug=function(string){TTS.Config.Debug&&console.log(string)},assembleNode=function(node,isFirst){if(_ttsNodeType=TTS.Parse.ParseNode.classifyTTSNode(node,_offset,isFirst),TTS.Parse.nodeAccommodatesLanguage(node,_ttsNodeType,_lang)){var pn,start=_endIndex;switch(_ttsNodeType){case TTS.Parse.TTSNodeTypes.Speak:createSpeakableNode(node,_offset,endOffset,insertPrecedingSpace),Debug("start: "+_startIndex+" end: "+_endIndex+" "+_speakString);break;case TTS.Parse.TTSNodeTypes.Alt:_speakString=getSpeakAsText(node),_speakString=_speakString.replace(/\s{2,}/g," ").trim()+" ",_speakString=TTS.Util.cleanText(_speakString),_endIndex=_startIndex+_speakString.length,Debug("start: "+_startIndex+" end: "+_endIndex+" "+_speakString);break;case TTS.Parse.TTSNodeTypes.Image:_speakString=getAltText(node),_speakString=_speakString.replace(/\s{2,}/g," ").trim()+" ",_speakString=TTS.Util.cleanText(_speakString),_endIndex=_startIndex+_speakString.length,Debug("start: "+_startIndex+" end: "+_endIndex+" "+_speakString);break;case TTS.Parse.TTSNodeTypes.DoNotSpeak:_speakString=TTS.Util.cleanText(" {silence} "),_endIndex=_startIndex+_speakString.length;break;case TTS.Parse.TTSNodeTypes.CompoundSpeak:for(var speakText,nextStart=_startIndex,offset=_offset,idx=(speakText=_cutoff?node.nodeValue.substring(_offset,_cutoff):node.nodeValue.substring(_offset)).search(/\s{2,}/),idx2=speakText.search(/\S+/),i=0;idx>-1||idx2>-1;)0==idx?-1==idx2?(pn=new TTS.Parse.ParseNode(_lang,node,offset,nextStart,-1),speakText=""):(pn=new TTS.Parse.ParseNode(_lang,node,offset,nextStart,offset+idx2),speakText=speakText.substring(idx2),offset+=idx2,nextStart=pn.getEndIndex()):-1==idx?(pn=new TTS.Parse.ParseNode(_lang,node,offset,nextStart,_cutoff||-1),speakText=""):(pn=new TTS.Parse.ParseNode(_lang,node,offset,nextStart,offset+idx),speakText=speakText.substring(idx),offset+=idx,nextStart=pn.getEndIndex()),_children[i]=pn,i+=1,idx=speakText.search(/\s{2,}/),idx2=speakText.search(/\S+/),_endIndex=pn.getEndIndex();Debug("wrote a compound speak");break;case TTS.Parse.TTSNodeTypes.ContainerWithPause:createParseNodeChildren(node,Math.max(0,_offset-start),start,insertPrecedingSpace),_children[_children.length]=silentParseNode(_endIndex),_endIndex=_children[_children.length-1].getEndIndex();break;case TTS.Parse.TTSNodeTypes.SpeakableInput:createSpeakableInputNode(node,_lang);break;case TTS.Parse.TTSNodeTypes.Other:createParseNodeChildren(node,Math.max(0,_offset-start),start,insertPrecedingSpace)}}else createParseNodeChildren(node,0,_endIndex,insertPrecedingSpace)},createParseNodeChildren=function(node,offset,start,insertSpace){for(var child,insertSpace=insertSpace||"block"==TTS.Util.getDisplayType(node),pn=null,i=0;i<node.childNodes.length;i++)child=node.childNodes[i],pn=new TTS.Parse.ParseNode(_lang,child,offset,start,null,!1,insertSpace),_children[i]=pn,insertSpace&&(insertSpace=!(pn.getStringLength()>0)),insertSpace=insertSpace||"block"==TTS.Util.getDisplayType(child)||$(child).hasClass("draggable"),start=pn.getEndIndex(),_endIndex=pn.getEndIndex(),Debug("start: "+_startIndex+" end: "+_endIndex+"  chunk--Dom Node--"+_domNode)},silentParseNode=function(start){var pn=new TTS.Parse.ParseNode(_lang,null,0,start,null,!0,!1);return pn.setSpeakString(" {silence} "),pn},createSpeakableNode=function(node,offset,endOffset,insertPrecedingSpace){_speakString=insertPrecedingSpace?" ":"",0==offset&&null==endOffset&&node.nodeValue.search(/\S+/)>-1?_speakString+=node.nodeValue:(null==endOffset?node.nodeValue.substring(offset):node.nodeValue.substring(offset,endOffset)).search(/\S+/)>-1?_speakString+=null==endOffset?node.nodeValue.substring(offset):node.nodeValue.substring(offset,endOffset):_speakString+=" ",_speakString=TTS.Util.cleanText(_speakString),_endIndex=_startIndex+_speakString.length,insertPrecedingSpace&&(_startIndex+=1),Debug("Speakable Node: "+node.nodeValue+" _speakString: "+_speakString+" start: "+_startIndex+" end: "+_endIndex)},createSpeakableInputNode=function(node,lang){var val=node.getAttribute("value"),ttsKey=node.getAttribute("data-tts-prefix");null==ttsKey&&(ttsKey="TDSTTS.Speak.Option"+val),_speakString=TTS.Util.cleanText(Messages.getAlt(ttsKey+"."+lang," ")),_endIndex=_startIndex+_speakString.length,Debug("Speakable INPUT Node: "+node.nodeValue+" _speakString: "+_speakString+" start: "+_startIndex+" end: "+_endIndex+"-Dom-"+_domNode.nodeName)};this.CompileSpeakString=function(){for(var finalString=_prefix+_speakString,i=0;i<_children.length;i++)finalString+=_children[i].CompileSpeakString();return finalString+_postscript},this.getChildren=function(){return _children},this.getEndIndex=function(){return _endIndex},this.getStartIndex=function(){return _startIndex},this.getChildCount=function(){return _children.length},this.getNode=function(){return _domNode},this.getLanguage=function(){return _lang},this.getNodeID=function(){return _domNode.id},this.getOwnerDocument=function(){return _domNode.ownerDocument},this.getStringLength=function(){return _endIndex-_startIndex},this.addChild=function(pn){_children[_children.length]=pn,_endIndex=pn.getEndIndex()},this.setCutoff=function(cutoff){_cutoff=cutoff},this.assembleNodeForSelector=function(){assembleNode(_domNode,!0)},this.setEndIndex=function(idx){_endIndex=idx},this.setSpeakString=function(string){_speakString=TTS.Util.cleanText(string),_endIndex=_startIndex+_speakString.length},this.createSilentParseNode=function(start){return silentParseNode(start)};var getSpeakAsText=function(node){if(node.className&&node.className.indexOf("TTS speakAs")>=0)return node.getAttribute("ssml_alias")},getAltText=function(node){var txt=node.getAttribute("alt");return txt||""};if(this.getLocation=function(idx,isStart){if(idx<_startIndex)return null;if(isStart){if(idx>=_endIndex)return null}else if(idx>_endIndex)return null;if(_startIndex==_endIndex)return null;switch(_ttsNodeType){case TTS.Parse.TTSNodeTypes.Speak:return new TTS.Parse.Location(_domNode,Math.min(idx-_startIndex+_offset,_domNode.nodeValue.length));case TTS.Parse.TTSNodeTypes.SpeakableInput:case TTS.Parse.TTSNodeTypes.Image:case TTS.Parse.TTSNodeTypes.Alt:return new TTS.Parse.Location(_domNode,null);default:for(var i=0;i<_children.length;i++){var loc=_children[i].getLocation(idx,isStart);if(null!=loc)return loc}return null}},this.containsSpeakableText=function(text){text||(text=this.CompileSpeakString());var start=0;_prefix&&(start=_prefix.length);var substring=text.substring(start);return(!_postscript||substring.length!=_postscript.length)&&(Util.Browser.isWindows()?substring=substring.replace(/<silence msec="([0-9]+)"\/>/g,""):Util.Browser.isMac()&&(substring=(substring=substring.replace(/\[\[slnc ([0-9]+)\]\]/g,"")).substring(0,substring.length-_postscript.length)),substring.search(/[\r\t ,.;()]*[a-zA-Z0-9]/g)>-1)},0==_startIndex&&(_prefix=TTS.Util.getTTSPrefix(),_endIndex=_prefix.length,_postscript=TTS.Util.getTTSPostscript()),node&&YAHOO.lang.isArray(node)){_domNode=node[0];for(var start=_endIndex,i=0;i<node.length;i++){var next=node[i],pn=new TTS.Parse.ParseNode(_lang,next,Math.max(0,_offset-start),start,null,!1,!0);_children[i]=pn,start=pn.getEndIndex(),_endIndex=pn.getEndIndex(),Debug("start: "+_startIndex+" end: "+_endIndex+"  Dom Node"+_domNode)}doNotAssemble=!0}return doNotAssemble||assembleNode(node,isFirst),this},TTS.Parse.ParseNode.classifyTTSNode=function(node,offset,isFirst){if(node.nodeType==Node.ELEMENT_NODE){if(node.className&&node.className.indexOf("TTS speakAs")>=0)return TTS.Parse.TTSNodeTypes.Alt;var skip=node.getAttribute("data-tts-skip");if(skip&&"true"==skip)return TTS.Parse.TTSNodeTypes.DoNotSpeak;switch(node.nodeName.toLowerCase()){case"td":case"th":case"dt":case"dd":return TTS.Parse.TTSNodeTypes.ContainerWithPause;case"input":if(null!=node.getAttribute("value"))return TTS.Parse.TTSNodeTypes.SpeakableInput;case"img":case"math":return TTS.Parse.TTSNodeTypes.Image;case"script":return TTS.Parse.TTSNodeTypes.DoNotSpeak}}return 3==node.nodeType?node.nodeValue.substring(offset).search(/\s{2,}\S/)>-1&&isFirst?TTS.Parse.TTSNodeTypes.CompoundSpeak:TTS.Parse.TTSNodeTypes.Speak:TTS.Parse.TTSNodeTypes.Other},TTS.Parse.ParseNode.getEnclosingAltNode=function(node){return node?node.nodeType==Node.ELEMENT_NODE&&node.className&&node.className.indexOf("TTS speakAs")>=0?node:TTS.Parse.ParseNode.getEnclosingAltNode(node.parentNode):null},TTS.Parse.Location=function(node,offset){var _node=node,_offset=offset;this.getNode=function(){return _node},this.getOffset=function(){return _offset}},TTS.Parse.nodeAccommodatesLanguage=function(node,ttsNodeType,lang){if(ttsNodeType==TTS.Parse.TTSNodeTypes.SpeakableInput)return!0;var nodeLang=TTS.getInstance().getMarkedLanguage(node);return null!=nodeLang&&nodeLang==lang},TTS=window.TTS||{},TTS.Parse=window.TTS.Parse||{},TTS.Parse.Highlighter=function(doc){var _textHighlighterClass="tts-highlight",_nonTextHighlighterClass="tts-highlight",_speakString="",_parseNodeRoot=null,_wordEndingPattern=(doc||document,null),_textClassApplier=rangy.createCssClassApplier(_textHighlighterClass,{normalize:!0}),_currentRange=null,_chromebookOffset=0,Debug=function(string){TTS.Config.Debug&&console.log(string)},highliteRange=function(pn,start,end){if(null!=pn&&null!=start&&null!=end){clearCurrentRange(),start=pn.getLocation(start,!0);var endIndex=pn.getEndIndex();if(end=end>endIndex?endIndex:end,end=pn.getLocation(end,!1),null!=start&&null!=end){var ownerDoc=pn.getOwnerDocument();ownerDoc||(ownerDoc=document),_currentRange=rangy.createRange(ownerDoc),null!=start.getOffset()?_currentRange.setStart(start.getNode(),start.getOffset()):_currentRange.setStart(start.getNode()),null!=end.getOffset()?_currentRange.setEnd(end.getNode(),end.getOffset()):_currentRange.setEndAfter(end.getNode());var state=TTS.Manager.getStatus();state&&state!=TTS.Status.Paused?highlightRange(_currentRange):(unhighlightRange(_currentRange),_currentRange=null)}}},highlightRange=function(range){var nodes=getHighlightRangeNodes(range);0==nodes.length?_textClassApplier.applyToRange(range):nodes.forEach(function(node){YUD.addClass(node,_nonTextHighlighterClass)})},unhighlightRange=function(range){var nodes=getHighlightRangeNodes(range);0==nodes.length?_textClassApplier.undoToRange(range):nodes.forEach(function(node){YUD.removeClass(node,_nonTextHighlighterClass)})},highlightNodeNames=["img","math","input"],getHighlightRangeNodes=function(range){return range.getNodes([1],function(node){var nodeName=node.nodeName.toLowerCase();return highlightNodeNames.filter(function(element){return element==nodeName}).length>0})},clearCurrentRange=function(){null!=_currentRange&&(unhighlightRange(_currentRange),_currentRange=null)};TTS.Manager.Events.onStatusChange.subscribe(function(currentStatus){currentStatus&&currentStatus==TTS.Status.Paused&&null!=_currentRange&&unhighlightRange(_currentRange)}),this.setParseNodeRoot=function(pn){_parseNodeRoot=pn},this.setSpeakString=function(speakString,pn){_parseNodeRoot=pn;var leadingSpaces=(_speakString=speakString).match(/^ +/)||[""];_chromebookOffset=leadingSpaces[0].length+1},this.highlightCallback=function(obj1){if(TTS.Config.isTrackingEnabled()){var start=parseInt(obj1.index);Util.Browser.isChromeOS()&&Util.Browser.getChromeVersion()>=34&&(start+=_chromebookOffset);var end,part=_speakString.substring(start),match=_wordEndingPattern.exec(part);null!=match&&match.length>0?(end=start+match[0].length-1,Debug("********"+match[0]+" start: "+start+" len: "+match[0].length+" string: "+part)):(end=start+part.length,Debug("******** start: "+start+" string: "+part)),highliteRange(_parseNodeRoot,start,end)}},this.statusChangeCallback=function(currentStatus){TTS.Config.isTrackingEnabled()&&currentStatus==TTS.Status.Stopped&&(clearCurrentRange(),_speakString="",_parseNodeRoot=null)},this.subscribe=function(eM){eM&&(eM.onWord&&eM.onWord.subscribe(this.highlightCallback),eM.onStatusChange&&eM.onStatusChange.subscribe(this.statusChangeCallback))},this.unsubscribe=function(eM){eM&&(eM.onWord&&this.highlightCallback&&eM.onWord.unsubscribe(this.highlightCallback),eM.onStatusChange&&this.statusChangeCallback&&eM.onStatusChange.subscribe(this.statusChangeCallback))},this.setTextHighlighterClass=function(name){_textHighlighterClass=name,_textClassApplier=rangy.createCssClassApplier(_textHighlighterClass,{normalize:!0})},this.setNonTextHighlighterClass=function(name){_nonTextHighlighterClass=name};_wordEndingPattern=new RegExp("[s.;()]*[a-zA-Z-0-9,'-]+[\r\t .:;()?]","m")},TTS=window.TTS||{},TTS.Parse=window.TTS.Parse||{},TTS.Parse.Selector=function(sel,lang){if(0==sel.rangeCount)return TTS.Config.Debug,null;var _lang=lang,selection=sel.getRangeAt(0),_start=selection.startContainer,altParent=TTS.Parse.ParseNode.getEnclosingAltNode(_start);null!=altParent&&altParent!=_start&&selection.setStartBefore(altParent),_start=selection.startContainer;var _end=selection.endContainer,_commonAncestor=selection.commonAncestorContainer,_parseTreeRoot=new TTS.Parse.ParseNode(_lang,_commonAncestor,null,0,0,!0),_startOffset=selection.startOffset,_endOffset=selection.endOffset,_startNodeType=TTS.Parse.ParseNode.classifyTTSNode(_start,_startOffset,!0),_nextStart=(TTS.Parse.ParseNode.classifyTTSNode(_end,0,!0),_parseTreeRoot.getEndIndex()),_foundStart=!1,_foundEnd=!1,Debug=function(string){TTS.Config.Debug&&console.log(string)};this.collectNodes=function(node,offset){return _collectNodes(node,offset)};var _collectNodes=function(node,offset){if(node||(node=_commonAncestor),_foundStart||(_foundStart=ttsSameNode(node,_start))&&(offset=_startOffset),_foundStart&&!_foundEnd){var pn=null,startAt=node==_start?_startOffset:0,ttsNodeType=TTS.Parse.ParseNode.classifyTTSNode(node,startAt,!0);switch(ttsNodeType){case TTS.Parse.TTSNodeTypes.Speak:if(differentLanguage(node))break;pn=ttsSameNode(node,_end)?new TTS.Parse.ParseNode(_lang,node,offset,_nextStart,_endOffset,null,!0):new TTS.Parse.ParseNode(_lang,node,offset,_nextStart,null,null,!0);break;case TTS.Parse.TTSNodeTypes.CompoundSpeak:if(differentLanguage(node))break;pn=new TTS.Parse.ParseNode(_lang,node,startAt,_nextStart,null,!0),node==_end&&pn.setCutoff(_endOffset),pn.assembleNodeForSelector();break;case TTS.Parse.TTSNodeTypes.Image:case TTS.Parse.TTSNodeTypes.Alt:if(differentLanguage(node))break;pn=new TTS.Parse.ParseNode(_lang,node,0,_nextStart);break;case TTS.Parse.TTSNodeTypes.DoNotSpeak:break;case TTS.Parse.TTSNodeTypes.ContainerWithPause:collectChildren(node,offset),pn=_parseTreeRoot.createSilentParseNode(_nextStart);break;case TTS.Parse.TTSNodeTypes.SpeakableInput:pn=new TTS.Parse.ParseNode(_lang,node,0,_nextStart,null);break;case TTS.Parse.TTSNodeTypes.Other:ttsSameNode(node,_end)||collectChildren(node,offset);break;default:TTS.getInstance().Error(new Error("Error in TTSSelector.  Unexpected node type in collect nodes: "+ttsNodeType))}null!=pn&&(_parseTreeRoot.addChild(pn),_nextStart=pn.getEndIndex()),null!=pn&&Debug("PN: "+pn.CompileSpeakString()+" start: "+pn.getStartIndex()+" end: "+pn.getEndIndex()),ttsSameNode(node,_end)&&(_foundEnd=!0),_parseTreeRoot.setEndIndex(_nextStart)}else for(var j=0;j<node.childNodes.length;j++){if(_foundEnd)return _parseTreeRoot;_collectNodes(node.childNodes[j],offset),ttsSameNode(node.childNodes[j],_end)&&(_foundEnd=!0)}return _parseTreeRoot},collectChildren=function(node,offset){var i=0;for(_startNodeType!=TTS.Parse.TTSNodeTypes.Other&&_startNodeType!=TTS.Parse.TTSNodeTypes.ContainerWithPause||!_startOffset||(i=_startOffset),i=i;i<node.childNodes.length;i++)_collectNodes(node.childNodes[i],offset,_foundStart)},ttsSameNode=function(outer,other){return TTS.Parse.ParseNode.classifyTTSNode(outer)==TTS.Parse.TTSNodeTypes.Alt?outer.contains?outer.contains(other):!!(16&outer.compareDocumentPosition(other)):outer==other},differentLanguage=function(node){return _lang!=TTS.getInstance().getMarkedLanguage(node)};this.getParseNode=function(){return _parseTreeRoot}},TTS=window.TTS||{},TTS.Config=TTS.Config||{},TTS.Config.UI=function(cfg){this.cfg=TTS.Config.UserSet||{},this.setCfg(cfg),this.DOM={},this.next=null,this.back=null},TTS.Config.UI.prototype.getCfg=function(){return this.cfg},TTS.Config.UI.prototype.setCfg=function(cfg){if(cfg)for(var key in cfg)void 0!==cfg[key]&&"function"!=typeof cfg[key]&&(this.cfg[key]=cfg[key])},TTS.Config.UI.prototype.init=function(){var YUD=YAHOO.util.Dom;this.section=TTS.Config.Lang.ENU.Code,this.DOM={ENU:YUD.get("englishTTSTest"),ESN:YUD.get("spanishTTSTest"),ERROR:YUD.get("checkErrorDiv"),NONE:YUD.get("ttsNotAvailable"),ADJUST:YUD.get("TTS_Adjustments"),RATE:YUD.get("TTS_Adjust_Rate"),VOLUME:YUD.get("TTS_Adjust_Volume"),PITCH:YUD.get("TTS_Adjust_Pitch"),VOICE:YUD.get("TTS_Select_VoicePack"),VOICE_NAME:YUD.get("TTS_Voice_Name"),NO_SUP:YUD.get("checkErrorDiv"),NO_ESN:YUD.get("ESNVoicePack"),NO_ENU:YUD.get("ENUVoicePack"),DEFAULTS:YUD.get("TTS_Set_Defaults")},this.connectEvents(),this.buildSliders(),this.render()},TTS.Config.UI.prototype.connectEvents=function(){var YUE=YAHOO.util.Event;YUE.addListener("clickToHearEnglish","click",this.runSpeechEnglish.bind(this)),YUE.addListener("btnSoundEnglishYes","click",this.soundOK.bind(this)),YUE.addListener("btnSoundEnglishNo","click",this.noSound.bind(this)),YUE.addListener("skipEnglish","click",this.soundOK.bind(this)),YUE.addListener("logoutOnErrorButton","click",this.gotoLogin.bind(this)),YUE.addListener("btnErrorTryAgain","click",this.tryAgain.bind(this)),YUE.addListener("noAudioLogout","click",this.gotoLogin.bind(this)),YUE.addListener("clickToHearSpanish","click",this.runSpeechSpanish.bind(this)),YUE.addListener("btnSoundSpanishYes","click",this.soundOK.bind(this)),YUE.addListener("btnSoundSpanishNo","click",this.noSound.bind(this)),YUE.addListener("skipSpanish","click",this.soundOK.bind(this)),YUE.addListener("continueNoAudio","click",this.gotoInstructions.bind(this)),YUE.addListener("continueError","click",this.soundOK.bind(this)),YUE.addListener("TTS_Set_Defaults","click",this.reset.bind(this)),YUE.addListener("TTS_Select_VoicePack","change",this.setVoicePack.bind(this))},TTS.Config.UI.prototype.buildSliders=function(){TTS.Config.Debug&&console.log("TTS: Build the sliders",this.cfg),this.volumeSlider=YAHOO.widget.Slider.getHorizSlider("TTS_Adjust_Volume","volumeThumb",0,this.cfg.LengthInPixels,this.cfg.TickSize),this.subscribeToEvents("Volume",this.volumeSlider),this.pitchSlider=YAHOO.widget.Slider.getHorizSlider("TTS_Adjust_Pitch","pitchThumb",0,this.cfg.LengthInPixels,this.cfg.TickSize),this.subscribeToEvents("Pitch",this.pitchSlider),this.rateSlider=YAHOO.widget.Slider.getHorizSlider("TTS_Adjust_Rate","rateThumb",0,this.cfg.LengthInPixels,this.cfg.TickSize),this.subscribeToEvents("Rate",this.rateSlider)},TTS.Config.UI.prototype.subscribeToEvents=function(property,thisSlider){thisSlider.subscribe("change",function(newOffset){var val=this.calculateValue(property,newOffset);document.getElementById(property+"_Value").innerHTML=val}.bind(this)),thisSlider.subscribe("slideEnd",function(){try{var language=this.getLangCode(),value=TTS.Config.User["get"+property](language);if(1==thisSlider.valueChangeSource||3==thisSlider.valueChangeSource){value=this.calculateValue(property,thisSlider.getValue());var func=TTS.Config.User["set"+property];"function"==typeof func&&(func(value,language),this.changed())}document.getElementById(property+"_Value").innerHTML=value.toString()}catch(e){console.error("Slider Error: (property, value)",property,value,e)}}.bind(this))},TTS.Config.UI.prototype.calculateValue=function(property,inputValue){var returnValue=inputValue;switch(property){case"Volume":returnValue=parseInt(inputValue/this.cfg.TickSize);break;case"Pitch":case"Rate":returnValue=parseInt(inputValue/this.cfg.TickSize*2)}return returnValue},TTS.Config.UI.prototype.getLangCode=function(){return YAHOO.util.Dom.hasClass(this.DOM.ESN,"hidden")?"ENU":"ESN"},TTS.Config.UI.prototype.reset=function(){TTS.Config.User.reset(),this.section="ENU",this.changed(!0),this.render()},TTS.Config.UI.prototype.render=function(){this.hideAll(),this.renderErrors()||(this.renderSections(),this.renderSliders(),this.renderVoice(),this.show(this.DOM.DEFAULTS))},TTS.Config.UI.prototype.renderErrors=function(){if(TTS.getInstance().getStatus()==TTS.Status.NotSupported)return this.hideAll(),this.show(this.DOM.NONE),!0;var lang=this.section;return TTS.getInstance().isLanguageSupported(lang)?void 0:(this.hideAll(),this.show(this.DOM.NO_SUP),this.show(this.DOM["NO_"+lang]),!0)},TTS.Config.UI.prototype.renderSections=function(){this.show(this.DOM[this.section]),this.cfg.ShowAdjust?this.show(this.DOM.ADJUST):this.hide(this.DOM.ADJUST)},TTS.Config.UI.prototype.changed=function(checked){this.DOM.DEFAULTS.checked=checked},TTS.Config.UI.prototype.renderSliders=function(){YAHOO.util.Dom;var ctn=this.DOM.ADJUST;this.cfg.ShowAdjustments?this.show(ctn):this.hide(ctn),this.cfg.ShowVolume?this.show(this.DOM.VOLUME):this.hide(this.DOM.VOLUME.parentNode),this.cfg.ShowRate?this.show(this.DOM.RATE):this.hide(this.DOM.RATE.parentNode),this.cfg.ShowPitch?this.show(this.DOM.PITCH):this.hide(this.DOM.PITCH.parentNode);var language=this.getLangCode(),volume=TTS.Config.User.getVolume(language),rate=TTS.Config.User.getRate(language),pitch=TTS.Config.User.getPitch(language);TTS.Manager.setVolume(volume),TTS.Manager.setPitch(pitch),TTS.Manager.setRate(rate),this.volumeSlider&&this.volumeSlider.setValue(parseInt((volume-2)*(this.cfg.LengthInPixels/8))),this.rateSlider&&this.rateSlider.setValue(parseInt(rate*(this.cfg.LengthInPixels/20))),this.pitchSlider&&this.pitchSlider.setValue(parseInt(pitch*(this.cfg.LengthInPixels/20)))},TTS.Config.UI.prototype.show=function(els){if(els){var YUD=YAHOO.util.Dom;YAHOO.lang.isArray(els)||(els=[els]);for(var key in els)els[key]&&"function"!=typeof els[key]&&YUD.removeClass(els[key],"hidden")}},TTS.Config.UI.prototype.hide=function(els){if(els){var YUD=YAHOO.util.Dom;YAHOO.lang.isArray(els)||(els=[els]);for(var key in els)els[key]&&"function"!=typeof els[key]&&YUD.addClass(els[key],"hidden")}},TTS.Config.UI.prototype.hideAll=function(){for(key in this.DOM)YUD.addClass(this.DOM[key],"hidden")},TTS.Config.UI.prototype.error=function(){this.hideAll(),this.show(this.DOM.ERROR)},TTS.Config.UI.prototype.renderVoice=function(){var langCode=this.getLangCode(),ctrl=TTS.getInstance(),voices=ctrl.getVoicesForLanguage(langCode),vPack=ctrl.getVoiceForLanguage(langCode),voice=vPack?vPack.ServiceVoiceName:null;this.cfg.ShowVoicePacks?this.renderVoicePacks(voices,voice,langCode):this.renderVoiceName(vPack,voice,langCode)},TTS.Config.UI.prototype.renderVoiceName=function(vPack,voice,langCode){this.show(this.DOM.VOICE_NAME),this.DOM.VOICE_NAME.innerHTML=vPack?vPack.Voicename:"",TTS.Config.User.setVoice(voice,langCode)},TTS.Config.UI.prototype.renderVoicePacks=function(voices,voice,langCode){try{var sel=this.DOM.VOICE;sel.innerHTML="",this.show(this.DOM.VOICE);for(var i=0;i<voices.length;++i){var vConfig=voices[i];if(vConfig&&vConfig.Available){var option=document.createElement("option");option.value=vConfig.ServiceVoiceName,option.innerHTML=vConfig.Voicename||vConfig.ServiceVoiceName,voice==vConfig.ServiceVoiceName&&(option.selected=!0,TTS.Config.User.setVoice(voice,langCode)),sel.appendChild(option)}}}catch(e){console.error("failed to render the voice packs.",e)}},TTS.Config.UI.prototype.setVoicePack=function(evt){this.changed(),TTS.Config.User.setVoice(this.DOM.VOICE.value)},TTS.Config.UI.prototype.runSpeechEnglish=function(){TTS.Config.Debug&&console.log("TTS: Run speech english"),TTS.getInstance().play(document.getElementById("englishMessageDiv"),"ENU")},TTS.Config.UI.prototype.runSpeechSpanish=function(){TTS.Config.Debug&&console.log("TTS: Run speech Spanish"),TTS.getInstance().play(document.getElementById("spanishMessageDiv"),"ESN")},TTS.Config.UI.prototype.stopSpeech=function(){TTS.Config.Debug&&console.log("TTS: Stop speech Spanish"),TTS.getInstance().stop()},TTS.Config.UI.prototype.nextLang=function(){if("ENU"==this.section&&TTS.Config.Lang.ESN.Enabled)return this.section="ESN",this.render(),!0},TTS.Config.UI.prototype.prevLang=function(){if("ESN"==this.section)return this.section="ENU",this.render(),!0},TTS.Config.UI.prototype.soundOK=function(){TTS.getInstance().stop(),this.nextLang()||this.gotoInstructions()},TTS.Config.UI.prototype.noSound=function(){console.log("No sound playing"),this.error()},TTS.Config.UI.prototype.tryAgain=function(){this.reset()},TTS.Config.UI.prototype.gotoInstructions=function(){"function"==typeof this.next&&this.next()},TTS.Config.UI.prototype.gotoLogin=function(){console.log("Go to the login?"),"function"==typeof this.back&&this.back()};var YUD=YAHOO.util.Dom,CFG={PRI:{Label:"TDSTTS.Label.Speak",cb:!1},SEC:{Label:"TDSTTS.Label.Speak",cb:!1},PRI_OP:{Label:"TDSTTS.Label.SpeakStemAndOptionsPrimary",cb:!1},SEC_OP:{Label:"TDSTTS.Label.SpeakStemAndOptionsSecondary",cb:!1},SEL_PRI:{Label:"TDSTTS.Label.SpeakTextPrimary",cb:!1},SEL_SEC:{Label:"TDSTTS.Label.SpeakTextSecondary",cb:!1},STOP:{Label:"TDSTTS.Label.StopSpeaking",css:"stopspeaking",cb:!1},PAUSE:{Label:"TDSTTS.Label.PauseSpeaking",css:"pausespeaking",cb:!1},RESUME:{Label:"TDSTTS.Label.ResumeSpeaking",css:"resumespeaking",cb:!1},MODE:{Label:"TDSTTS.Label.SpeakOption",cb:!1},ORDER:["PRI","SEC","PRI_OP","SEC_OP","SEL_PRI","SEL_SEC","STOP","PAUSE","RESUME","MODE"]};if(TTS.Menu=function(){this.hasPauseSupport=!(Util.Browser.isChrome()||Util.Browser.isIOS()||Util.Browser.osxVersionIsAtLeast(10,9)&&Util.Browser.getSecureVersion()<6.5||Util.Browser.isAndroid()),this.assembleContent=function(cfg,node){if(node){var ctrl=TTS.getInstance();if(!ctrl.isPlaying()){var anyNode=YAHOO.lang.isArray(node)?node[0]:node;ctrl.getMarkedLanguage(anyNode);this.assembleLanguageContent(node,cfg.PRI,cfg.PRI_OP,tds.language.getITSDefault()),this.assembleLanguageContent(node,cfg.SEC,cfg.SEC_OP,tds.language.getITSAlt())}}},this.assembleLanguageContent=function(node,cfgLangOb,cfgLangOpOb,language){var ctrl=TTS.getInstance(),pnResponseArea=null,pnContent=null;if(cfgLangOb.cb=!1,cfgLangOb.Label=this.getDomTitle(node,cfgLangOb.Label,language),cfgLangOb.contain=null,cfgLangOpOb.cb=!1,cfgLangOpOb.Label=this.getDomTitle(null,cfgLangOpOb.Label,language),cfgLangOpOb.contain=null,ctrl.isLanguageSupported(language)&&language&&ctrl.isLanguageSupported(language)&&(pnContent=new TTS.Parse.ParseNode(language,node),cfgLangOb.cb=this.getPlayFunction(pnContent,language),cfgLangOb.contain=pnContent,TTS.getInstance().getCurrentDomEntity()instanceof ContentItem)){var raNode=ctrl.getCurrentDomEntity().getResponseTTS();raNode&&(raNode.splice(0,0,node),pnResponseArea=new TTS.Parse.ParseNode(language,raNode),cfgLangOpOb.cb=this.getPlayFunction(pnResponseArea,language),cfgLangOpOb.contain=pnResponseArea)}},this.reset()},TTS.Menu.prototype.reset=function(){return this.cfg=JSON.parse(JSON.stringify(CFG)),this.cfg},TTS.Menu.prototype.getMenuCfg=function(dom,selection,win,explicitText,page,entity){var cfg=this.reset(),ctrl=TTS.getInstance();return ctrl.isPlaying()||(ctrl.setCurrentDomEntity(entity),this.assembleContent(cfg,dom),this.checkSelection(cfg,dom,selection,win||window)),this.checkServiceStates(cfg),cfg},TTS.Menu.prototype.checkAlt=function(cfg,text){TTS.getInstance();cfg.PRI.cb=this.getPlayFunction(text,TTS.Parser.Types.HTML,this.pri)},TTS.Menu.prototype.getGlobalMenuCfg=function(dom,selection){},TTS.Menu.prototype.checkSelection=function(cfg,dom,sel,win){TTS.getInstance();var win=win&&win.document?win.document:win;if(dom&&sel&&0!=sel.rangeCount&&!sel.getRangeAt(0).collapsed){var priLang=tds.language.getITSDefault(),secLang=tds.language.getITSAlt(),priSelector=new TTS.Parse.Selector(sel,priLang),pnPrimary=priSelector?priSelector.collectNodes():null,pnSecondary=null;if(secLang){var secSelector=new TTS.Parse.Selector(sel,secLang);pnSecondary=secSelector?secSelector.collectNodes():null}cfg.SEL_PRI.cb=this.getPlayFunction(pnPrimary,priLang),cfg.SEL_SEC.cb=this.getPlayFunction(pnSecondary,secLang)}},TTS.Menu.prototype.addMode=function(cfg,cb){if(cfg=cfg||this.cfg,!TTS.getInstance().isPlaying())return cfg.MODE.cb=cb,cfg},TTS.Menu.prototype.addOptions=function(cfg,dom){if(cfg=cfg||this.cfg,!TTS.getInstance().isPlaying()){var priLang=tds.language.getITSDefault(),pnPrimary=new TTS.Parse.ParseNode(priLang,dom),pnSecondary=null,secLang=tds.language.getITSAlt();secLang&&(pnSecondary=new TTS.Parse.ParseNode(secLang,dom)),cfg.PRI_OP.cb=this.getPlayFunction(pnPrimary,priLang),cfg.PRI_OP.Label=this.getDomTitle(null,cfg.PRI_OP.Label,priLang),cfg.PRI_OP.contain=pnPrimary,cfg.SEC_OP.cb=this.getPlayFunction(pnSecondary,secLang),cfg.SEC_OP.Label=this.getDomTitle(null,cfg.SEC_OP.Label,secLang),cfg.SEC_OP.contain=pnSecondary}},TTS.Menu.prototype.addFocusedOption=function(cfg,dom,language){if(dom&&(cfg=cfg||this.cfg,!TTS.getInstance().isPlaying())){var priLang=language||tds.language.getITSDefault(),pnPrimary=new TTS.Parse.ParseNode(priLang,dom),pnSecondary=null,secLang=tds.language.getITSAlt();return secLang&&(pnSecondary=new TTS.Parse.ParseNode(secLang,dom)),cfg.PRI.cb=this.getPlayFunction(pnPrimary,priLang),cfg.PRI.Label=this.getDomTitle(dom,cfg.PRI.Label,priLang),cfg.PRI.contain=pnPrimary,cfg.SEC.cb=this.getPlayFunction(pnSecondary,secLang),cfg.SEC.Label=this.getDomTitle(dom,cfg.SEC.Label,secLang),cfg.SEC.contain=pnSecondary,cfg}},TTS.Menu.prototype.getPlayFunction=function(parseNode,language){var ctrl=TTS.getInstance();return!(!parseNode||!ctrl.isLanguageSupported(language))&&(!!parseNode.containsSpeakableText()&&function(){ctrl.playParseNode(parseNode,language)})},TTS.Menu.prototype.checkServiceStates=function(cfg){var ctrl=TTS.getInstance();ctrl.isPlaying()&&(cfg.STOP.cb=function(){TTS.getInstance().stop()}),this.hasPauseSupport&&(ctrl.isPlaying()?cfg.PAUSE.cb=function(){TTS.getInstance().pause()}:ctrl.getStatus()==TTS.Status.Paused&&ctrl.canResume()&&(cfg.RESUME.cb=function(){TTS.getInstance().resume()}))},TTS.Menu.prototype.getDomTitle=function(dom,label,lang){if(!dom)return label;if(YAHOO.lang.isArray(dom)&&dom.length>0&&(dom=dom[0]),!Util.Dom.isElement(dom))return label;var key=dom.getAttribute("data-menu-prefix");return key||(key="TDSTTS.Label.Speak",dom.title?key+=dom.title.replace(/\s+/g,""):key+="Question"),key+=lang},function(){var CM={accessibilityEnabled:!1,enableKeyEvents:!0,enableMouseEvents:!0,enableARIA:!1,_readOnly:!1,_debug:!0,_zoom:null,_printMode:!1};Util.Event.Emitter(CM),CM.registerFrame=function(iFrame){CM.fire("registerFrame",iFrame)},CM.setReadOnly=function(value){this._readOnly=value},CM.isReadOnly=function(){return this._readOnly},CM._baseUrl="",CM.getBaseUrl=function(){return this._baseUrl},CM.setBaseUrl=function(baseUrl){this._baseUrl=baseUrl},CM.resolveBaseUrl=function(url){return Util.String.isHttpProtocol(url)?url:this._baseUrl+url},CM.enableAccessibility=function(){this.accessibilityEnabled=!0,this.enableKeyEvents=!1,this.enableMouseEvents=!1,this.enableARIA=!0},CM.isAccessibilityEnabled=function(){return this.accessibilityEnabled},CM.init=function(baseUrl){if(YAHOO.lang.isString(baseUrl)&&CM.setBaseUrl(baseUrl),"function"==typeof CM.addKeyEvents&&CM.addKeyEvents(document),window!=parent)try{CM.addKeyEvents(parent.document),CM.Menu.applyDocFix(parent)}catch(ex){}CM.Menu.init(),Util.Browser.isTouchDevice()&&CM.listenForFocus(document);var defaultZoom=null,accProps=ContentManager.getAccProps();accProps&&(defaultZoom=accProps.getPrintSize()),CM._zoom=new ContentZoom(defaultZoom),CM._zoom.addDocument(document,{includeElements:!1}),CM.fire("init")},CM.getZoom=function(){return this._zoom},CM.getZoomFactor=function(){var zoomInfo=CM.getZoom();return zoomInfo?zoomInfo.getFactor():1},CM.getAccommodations=function(){return Accommodations.Manager.getDefault()},CM.getAccs=CM.getAccommodations,CM.getAccommodationProperties=function(){var accommodations=this.getAccommodations();return new Accommodations.Properties(accommodations)},CM.getAccProps=CM.getAccommodationProperties,CM.getLanguage=function(){var language=this.getAccommodationProperties().getSelectedCode("Language");return language||"ENU"},CM.addMouseEvents=function(entity,element){function checkForMenu(evt){Util.Browser.isSecure()&&Util.Browser.isMac()?"pointerdown"==evt.type&&2==evt.button&&setTimeout(function(){CM.Menu.show({evt:evt})},0):"contextmenu"==evt.type&&CM.Menu.show({evt:evt})}return!!this.enableMouseEvents&&(null!=element&&(!0!==element.__tds_mouseEventsEnabled&&(element.setAttribute&&element.setAttribute("touch-action","pan-y"),element.addEventListener("pointerdown",function(evt){var targetEl=YUE.getTarget(evt);if(!Util.Dom.isTextInput(document.activeElement)||!$.contains(document.activeElement,targetEl)){entity.setActive({component:!1});var clickedComponent=entity.findComponent(targetEl);clickedComponent&&entity.setActiveComponent(clickedComponent),null==entity.getActiveComponent()&&entity.resetComponent()}}),element.addEventListener("pointerdown",checkForMenu),element.addEventListener("contextmenu",checkForMenu),element.__tds_mouseEventsEnabled=!0,!0)))},CM.CSS={CONTEXT_AREA:"contextArea",CONTEXT_AREA_ALT:"contextArea-hasalt",CONTEXT_AREA_FOCUS:"contextArea-focused",CONTEXT_BODY_FOCUS:"contextBody-focused",CONTEXT_AREA_SELECT:"contextArea-selected",CONTEXT_BODY_SELECT:"contextBody-selected",MARK_REVIEW_OFF:"markReview",MARK_REVIEW_ON:"markReviewMarked",HIGHLIGHT:"highlight"},CM._labels={},CM._labels.TTS_SPEAKTEXT={classname:"speaktext",text:"TDSContentJS.Label.SpeakSelected"},CM._labels.TTS_SPEAKSECTION={classname:"speaksection",text:"Speak {title}"},CM._labels.TTS_SPEAKSECTION_ALT={classname:"speaksection",text:"Speak {title}"},CM._labels.TTS_STOP={classname:"speakstop",text:"TDSContentJS.Label.StopSpeaking"},CM._labels.HIGHLIGHT_TEXT={classname:"highlighttext",text:"TDSContentJS.Label.Highlight"},CM._labels.HIGHLIGHT_CLEAR={classname:"highlightclear",text:"TDSContentJS.Label.ResetHighlight"},CM.getLabel=function(id){var label=CM._labels[id.toUpperCase()];return label?{classname:label.classname,text:Messages.get(label.text)}:null},CM.getCommentCode=function(){return Accommodations.Manager.getCurrentProperties().getStudentComments()},CM.getCommentLabel=function(){var commentCode=CM.getCommentCode(),label="Comments";return"TDS_SCDropDown"==commentCode?label=Messages.getAlt("TestShell.Comments.DropDown","Comments"):"TDS_SCNotepad"==commentCode?label=Messages.getAlt("TestShell.Comments.Notepad","Notepad"):"TDS_SCTextArea"==commentCode&&(label=Messages.getAlt("TestShell.Comments.TextArea","Comments")),label},CM.clear=function(){CM._zoom.setLevel(CM._zoom.defaultLevel),CM.clearPagePlugins(),CM.clearEntityPlugins(),CM.clearTransforms()},CM.enablePrintMode=function(){this._printMode=!0},CM.isPrintMode=function(){return this._printMode},window.ContentManager=CM}(),function(CM){CM.getElementById=function(id,obj){var parentEl,el=document.getElementById(id);return(parentEl=parent instanceof ContentPage||parent instanceof ContentEntity?parent.getElement():Util.Dom.isElement(parent)?parent:document)==document||parentEl.contains(el)?el:null},CM.getEventXY=function(domEvent,clickXY){var element=YUE.getTarget(domEvent);for(clickXY||(clickXY=YUE.getXY(domEvent));Util.Dom.getWindow(element.ownerDocument).frameElement&&!Util.Dom.getWindow(element.ownerDocument).its;){element=Util.Dom.getWindow(element.ownerDocument).frameElement;YUD.getXY(element)}return clickXY},CM.getJavaString=function(value){return null!=value&&"object"==typeof value&&(value=new String(value).toString()),value},CM.focus=function(el){return(!el.ownerDocument||el.ownerDocument.activeElement!=el)&&Util.Dom.focus(el)},CM.blur=function(el){return(!el.ownerDocument||el.ownerDocument.activeElement==el)&&Util.Dom.blur(el)},CM.preventFocus=function(el){YUE.onFocus(el,function(){CM.blur(el)})},CM.isLinkClickable=function(link){var mediaType=link.getAttribute("type");return null!=mediaType&&-1!=["application/rtf","application/pdf"].indexOf(mediaType)},CM.getAncestor=Util.Dom.getAncestor,CM.isElement=Util.Dom.isElement,CM.isVisible=Util.Dom.isVisible,CM.isDialogShowing=function(){return YUD.hasClass(document.body,"showingLoading")||YUD.hasClass(document.body,"showingDialog")},CM.log=function(message){"object"==typeof Util?Util.log(message):"object"==typeof console&&console.log(message)},CM.fixItemFrame=function(item,win,doc){CM.Menu.applyDocFix(win),CM.addMouseEvents(item,doc),CM.addKeyEvents(doc),Util.Dom.stopAllEvents(doc,"contextmenu");var page=item.getPage();page.getAccommodations().applyCSS(doc.body);var zoom=page.getZoom();zoom.addDocument(doc),zoom.refresh()},CM.setReadOnlyKeyEvent=function(item,input){var readOnlyFunc=function(evt){item.isReadOnly()&&YUE.stopEvent(evt)};YUE.on(input,"keypress",readOnlyFunc),YUE.on(input,"mousedown",readOnlyFunc)},CM.createRange=function(doc){if("object"==typeof window.rangy)try{return window.rangy.createRange(doc)}catch(ex){}return null},CM.getSelection=function(doc){if("object"==typeof window.rangy)try{return Util.Browser.isAndroid()?Util.SecureBrowser.getSelectedText():window.rangy.getSelection(doc)}catch(ex){}return null},CM.applyRedrawFix=function(){setTimeout(function(){YUD.addClass(document.body,"forceRedraw"),setTimeout(function(){YUD.removeClass(document.body,"forceRedraw")},0)},0)},CM.listenForFocus=function(doc){var focused=!1,setFocused=function(){YUD.addClass(document.body,"inputFocus"),focused=!0},setBlurred=function(){YUD.removeClass(document.body,"inputFocus"),focused=!1};YUE.onFocus(doc,function(ev){if(Util.Event.inTextInput(ev)){var targetEl=YUE.getTarget(ev);"off"!=YUD.getAttribute(targetEl,"autocorrect")&&(YUD.setAttribute(targetEl,"autocorrect","off"),YUD.setAttribute(targetEl,"autocapitalize","off"),YUD.setAttribute(targetEl,"autocomplete","off")),CM.applyRedrawFix(),setFocused()}}),YUE.onBlur(doc,function(ev){setBlurred()});var win=Util.Dom.getWindow(doc);YUE.on(win,"scroll",function(ev){focused&&!Util.Dom.isTextInput(document.activeElement)&&setBlurred()})},YUD.toggleClass=function(node,className,force){(void 0!==force?force:!YUD.hasClass(node,className))?YUD.addClass(node,className):YUD.removeClass(node,className)}}(ContentManager),function(CM){function Renderer(parentEl,id,html){this.id=id,this._parentEl=parentEl,this._pageEl=null,this._html=html,this._imagesLoading=[],this._imagesLoaded=[],this._imagesFailed=[],this._imagesAborted=[],this._imagesTimer=null,this._imagesRetry=0,this._resourceCollection=new ResourceLoader.Collection,this._status=State.Init,Util.Event.Emitter(this)}function process(renderer){var pageWin=renderer.getWin();pageWin.__tds_processed||(ContentManager.Menu.applyDocFix(document),"function"==typeof CM.addKeyEvents&&CM.addKeyEvents(document),Util.Dom.stopDragEvents(document),Util.Dom.stopAllEvents(document,"contextmenu"),YUE.on(document,"mousedown",function(ev){1==ev.button&&YUE.stopEvent(ev)}),pageWin.__tds_processed=!0)}var State={Init:0,Rendering:1,Rendered:2,Available:3,Loaded:4},StateNames={};StateNames[State.Init]="init",StateNames[State.Rendering]="rendering",StateNames[State.Rendered]="rendered",StateNames[State.Available]="available",StateNames[State.Loaded]="loaded",Renderer.State=State,Renderer.getStateNames=function(){return Util.Object.values(StateNames)},Renderer.init=function(){},Renderer.isDirect=function(){return!0},Renderer.writeHtml=function(parentEl,html){var pageWrapper=Util.Dom.getOwnerDocument(parentEl).createElement("div");return YUD.addClass(pageWrapper,"pageWrapper"),html&&(html.documentElement&&(html=html.documentElement),html.nodeType>0?pageWrapper.appendChild(html):pageWrapper.innerHTML=html),pageWrapper.setAttribute("aria-hidden","true"),parentEl.appendChild(pageWrapper),pageWrapper},Renderer.show=function(el){el&&(el.setAttribute("aria-hidden","false"),YUD.removeClass(el,"hiding"),YUD.addClass(el,"showing"))},Renderer.hide=function(el){el&&(el.setAttribute("aria-hidden","true"),YUD.removeClass(el,"showing"),YUD.addClass(el,"hiding"))},Renderer.remove=function(page){var pageContainer=page.getContainer();Util.Dom.removeNode(pageContainer)},Renderer.prototype._log=function(message){CM._debug&&CM.log("RENDERER "+this.id+": "+message)},Renderer.prototype.getState=function(){return this._status},Renderer.prototype.setState=function(newState){if(!YAHOO.lang.isNumber(newState)||newState<State.Init||newState>State.Loaded)throw"Invalid page state";var currentState=this.getState(),currentStateName=StateNames[currentState],newStateName=StateNames[newState];if(null==newStateName)throw"No page state name found";var statusError="Invalid page state transition ("+currentStateName+" --\x3e "+newStateName+")";if(newState==State.Init&&currentState>=State.Init)throw statusError;if(newState==State.Rendering&&currentState!=State.Init)throw statusError;if(newState==State.Rendered&&currentState!=State.Rendering)throw statusError;if(newState==State.Available&&currentState!=State.Rendered)throw statusError;if(newState==State.Loaded&&currentState!=State.Available)throw statusError;this._status=newState,this._log(newStateName),this.fire(newStateName)},Renderer.prototype.getHtml=function(){return this._html},Renderer.prototype.setHtml=function(html){return this.getState()<=State.Rendering&&(this._html=html,!0)},Renderer.prototype.getContainer=function(){return this._pageEl},Renderer.prototype.getWin=function(){return document.parentWindow||document.defaultView},Renderer.prototype.getElement=function(){return document.getElementById("Page_"+this.id)},Renderer.prototype.render=function(){if(this.getState()>State.Init)return this._pageEl;this.setState(State.Rendering);var pageEl=Renderer.writeHtml(this._parentEl,this.getHtml());this._pageEl=pageEl,Renderer.hide(pageEl),YUD.addClass(document.body,"yui-skin-sam"),YUD.addClass(document.body,Util.Browser.isTouchDevice()?"touch":"no-touch");var pageElement=this.getElement();if(null==pageElement)throw new Error("The page element could not be found.");return YUD.batch(pageElement.getElementsByTagName("img"),this.addImage,this,!0),this.setState(State.Rendered),YAHOO.lang.later(1,this,this.onAvailable),pageEl},Renderer.prototype.onAvailable=function(){process(this);var pageElement=this.getElement();this.setState(State.Available),YUD.batch(pageElement.getElementsByTagName("a"),function(link){CM.isLinkClickable(link)||YUE.on(link,"click",function(ev){YUE.stopEvent(ev)})}),this._resourceCollection.hasLoaders()&&(this._resourceCollection.subscribe(ResourceLoader.Status.COMPLETE,this.checkLoaded,this),this._resourceCollection.subscribe(ResourceLoader.Status.ERROR,this.checkLoaded,this),this._resourceCollection.subscribe(ResourceLoader.Status.ABORT,this.checkLoaded,this),this._resourceCollection.load()),YAHOO.lang.later(1,this,this.checkLoaded)},Renderer.prototype.checkLoaded=function(){this._imagesLoading.length>0||(null!=this._imagesTimer&&(this._imagesTimer.cancel(),this._imagesTimer=null),this._resourceCollection.hasLoaders()&&this._resourceCollection.getStatus()==ResourceLoader.Status.LOADING||this.getState()==State.Available&&this.setState(State.Loaded))},Renderer.prototype.getResourceLoaders=function(){return this._resourceCollection},Renderer.prototype.addResourceLoader=function(resource){this._resourceCollection.add(resource)},Renderer.prototype.getImagesLoading=function(){return this._imagesLoading},Renderer.prototype.getImagesLoaded=function(){return this._imagesLoaded},Renderer.prototype.getImagesFailed=function(){return this._imagesFailed},Renderer.prototype.getImagesAborted=function(){return this._imagesAborted},Renderer.prototype.addImage=function(image){""==image.id&&(image.id=YUD.generateId()),this._imagesLoading.push(image);var loadEvent=YAHOO.env.ua.ie&&YAHOO.env.ua.ie<11?"readystatechange":"load";YUE.addListener(image,loadEvent,this._onImageEvent,image,this),YUE.addListener(image,"abort",this._onImageEvent,image,this),YUE.addListener(image,"error",this._onImageEvent,image,this),image.dateRequested=Util.Date.now(),this._startImageTimer()},Renderer.prototype._startImageTimer=function(){null!=this._imagesTimer&&this._imagesTimer.cancel(),this._imagesTimer=YAHOO.lang.later(9e4,this,this._onImagesTimeout)},Renderer.prototype._onImagesTimeout=function(){Util.log("image timeout"),this._imagesRetry<2?(this._imagesRetry++,Util.Array.each(this._imagesLoading,function(image){image.src=image.src,image.dateRequested=Util.Date.now()}),this._startImageTimer()):Util.Array.each(this._imagesLoading,function(image){var evt={type:"abort"};this._onImageEvent(evt,image)},this)},Renderer.prototype._onImageEvent=function(evt,image){setTimeout(this._processImageEvent.bind(this,evt,image),0)},Renderer.prototype._processImageEvent=function(evt,image){if(Util.Array.contains(this._imagesLoading,image)){if("readystatechange"==evt.type){if("complete"!=image.readyState)return;evt={type:"load"}}void 0===image.naturalWidth&&("load"==evt.type?(image.naturalWidth=image.width,image.naturalHeight=image.height):(image.naturalWidth=0,image.naturalHeight=0));var loadEvent=YAHOO.env.ua.ie&&YAHOO.env.ua.ie<11?"readystatechange":"load";YUE.removeListener(image,loadEvent,this._onImageEvent),YUE.removeListener(image,"abort",this._onImageEvent),YUE.removeListener(image,"error",this._onImageEvent),Util.Array.remove(this._imagesLoading,image),"load"==evt.type?this._imagesLoaded.push(image):"abort"==evt.type?this._imagesAborted.push(image):this._imagesFailed.push(image),image.dateCompleted=Util.Date.now(),this.checkLoaded()}},Renderer.prototype.dispose=function(){this.id=null,this._html=null,this._container=null,this._doc=null,this._imagesLoading=null,this._imagesLoaded=null,this._imagesFailed=null,this._imagesAborted=null,this._imagesTimer=null,this._imagesRetry=null,this.fire("dispose"),this.removeAllListeners()},CM.Renderer=Renderer}(ContentManager),function(CM){function createPassage(page,itsPassage){var passage=new ContentPassage(page,itsPassage.bankKey,itsPassage.itemKey,itsPassage.filePath);return page.setPassage(passage),passage.stemTTS=itsPassage.stemTTS,passage.printed=itsPassage.printed,passage.resources=itsPassage.resources,passage.attachments=itsPassage.attachments,passage.specs=itsPassage.specs,passage}function createItem(page,itsItem){var item=new ContentItem(page,itsItem.bankKey,itsItem.itemKey,itsItem.filePath,itsItem.format,itsItem.responseType,itsItem.grade,itsItem.subject,itsItem.position);return item.disabled=itsItem.disabled,page.addItem(item),item.stemTTS=itsItem.stemTTS,item.illustrationTTS=itsItem.illustrationTTS,item.rendererSpec=itsItem.rendererSpec||null,item.gridAnswerSpace=itsItem.gridAnswerSpace,item.tutorial=itsItem.tutorial,item.resources=itsItem.resources,item.attachments=itsItem.attachments,itsItem.resources&&(item.gtr=itsItem.resources.guideToRevision,item.coverPage=itsItem.resources.coverPage),item.value=itsItem.value,item.printed=itsItem.printed,item.rubric=itsItem.rubric,itsItem.qti&&(item.qti=itsItem.qti),item.specs=itsItem.specs,item}function createPage(pages,content){Util.Assert.isObject(content),Util.Assert.isString(content.id);var pageID=content.id,page=pages.get(pageID);if(page)return page;var pagesEl=pages.getElement(),renderer=new Renderer(pagesEl,pageID,content.html),eventQueue=[];if(page=new ContentPage(pages,renderer,pageID,content.segmentID,content.layout),page.soundCue=content.soundCue||null,eventQueue.push(pages.fire.bind(pages,"pageCreated",page,content)),pages._lookup.set(pageID,page),content.passage){var passage=createPassage(page,content.passage);eventQueue.push(page.fire.bind(page,"passageCreated",passage,content.passage))}return content.items&&content.items.forEach(function(itemContent){var item=createItem(page,itemContent);eventQueue.push(page.fire.bind(page,"itemCreated",item,itemContent))}),eventQueue.forEach(function(func){func()}),page}function Pages(id){this._id=id,this._currentPage=null,this._lookup=new Util.Structs.Map,Util.Event.Emitter(this)}var Renderer=CM.Renderer;Pages.prototype.create=function(content){return createPage(this,content)},Pages.prototype.getElement=function(){return document.getElementById(this._id)},Pages.prototype.list=function(){return this._lookup.getValues()},Pages.prototype.get=function(id){return this._lookup.get(id)},Pages.prototype.setCurrent=function(page){this._currentPage=page},Pages.prototype.getCurrent=function(){return this._currentPage},Pages.prototype.getItem=function(position){for(var pages=this.list(),i=0;i<pages.length;i++){var item=pages[i].getItem(position);if(item)return item}return null},Pages.prototype.remove=function(page){page.isShowing()&&page.hide(),Renderer.remove(page),this._lookup.remove(page.id),page.dispose()},Pages.prototype.dispose=function(){this.list().forEach(function(page){page.dispose()}),this._lookup.clear(),this._currentPage=null,this.getElement().innerHTML="",this.fire("dispose"),this.removeAllListeners()},CM.Pages=Pages;var list=[];CM.createPages=function(id){var pages=new Pages(id);return list.push(pages),pages.once("dipose",function(){Util.Array.remove(list,pages)}),CM.fire("pagesCreated",pages),pages},CM.getPages=function(){return list},CM.createPassage=createPassage,CM.createItem=createItem}(ContentManager),function(CM){function Page(pages,renderer,pageID,segmentID,layoutName){Util.Assert.isInstanceOf(CM.Pages,pages),Util.Assert.isInstanceOf(Renderer,renderer),Util.Assert.isString(pageID),Util.Assert.isString(segmentID),Util.Assert.isString(layoutName),this.id=pageID,this.segmentID=segmentID,this.layout=layoutName,this._pages=pages,this._renderer=renderer,this.soundCue=null,this.autoPlayQueue=TDS.Audio.Player.createQueue(),this._container=null,this._doc=null,this._passage=null,this._items=[],this._itemHash={},this._activeEntity=null,this._lastEntity=null,this._enableScroll=!0,this.zoomFactor=0,this.plugins=new CM.Plugins,Util.Event.Emitter(this),this.init()}var Renderer=CM.Renderer;Page.prototype.getParent=function(){return this._pages},Page.prototype.onAvailable=function(){this.getEntities().forEach(function(entity){var entityEl=entity.getElement();entityEl?(Renderer.hide(entityEl),ContentManager.addMouseEvents(entity,entityEl)):console.warn("On available can't hide entity element.",entity)})},Page.prototype.onLoaded=function(){this.getEntities().forEach(function(entity){entity.getText()||$(entity.getElement()).addClass("contentEmpty")})},Page.prototype.onStatusChange=function(status){var funcName="on"+Util.String.capitalize(status);"function"==typeof this[funcName]&&this[funcName](),this.fire(status),this.getEntities().forEach(function(entity){entity.fire(status)})},Page.prototype.init=function(){Renderer.getStateNames().forEach(function(status){this._renderer.once(status,this.onStatusChange.bind(this,status))}.bind(this))},Page.prototype.getRenderer=function(){return this._renderer},Page.prototype.getContainer=function(){return this._container},Page.prototype.getDoc=function(){return document},Page.prototype.getActiveDoc=function(){var activeEntity=this.getActiveEntity();if(null!=activeEntity){var activeComponent=activeEntity.getActiveComponent();if(null!=activeComponent&&YAHOO.lang.isFunction(activeComponent.getDoc))return activeComponent.getDoc()}return this.getDoc()},Page.prototype.getBody=function(){var doc=this.getDoc();return doc?doc.body:null},Page.prototype.getWin=function(){var doc=this.getDoc();return doc?doc.parentWindow||doc.defaultView:null},Page.prototype.getActiveWin=function(){var activeEntity=this.getActiveEntity();if(null!=activeEntity){var activeComponent=activeEntity.getActiveComponent();if(null!=activeComponent&&YAHOO.lang.isFunction(activeComponent.getWin))return activeComponent.getWin()}return this.getWin()},Page.prototype.getFrameElement=function(){var win=this.getWin();return win?win.frameElement:null},Page.prototype.getElement=function(){return document.getElementById("Page_"+this.id)},Page.prototype.getCompoundElement=function(){var pageDoc=this.getDoc(),items=this.getItems();if(pageDoc&&items.length>0){var firstItem=items[0];return pageDoc.getElementById("compound_"+firstItem.position)}return null},Page.prototype.getHeader=function(){var headers=this.getElement().getElementsByTagName("h3");return headers.length>0?headers[0]:null},Page.prototype.getAccommodations=function(){return Accommodations.Manager.get(this.segmentID)},Page.prototype.getAccs=Page.prototype.getAccommodations,Page.prototype.getAccommodationProperties=function(){return Accommodations.Manager.getProperties(this.segmentID)},Page.prototype.getAccProps=Page.prototype.getAccommodationProperties,Page.prototype._fireBeforeZoom=function(){var level=this.getZoomFactor();return this.fire("beforeZoom",level)},Page.prototype._fireZoom=function(){var level=this.getZoomFactor();return this.fire("zoom",level)},Page.prototype.getZoom=function(){return CM.getZoom()},Page.prototype.getZoomFactor=function(){return CM.getZoomFactor()},Page.prototype.zoomIn=function(){var zoom=CM.getZoom();return!!(zoom&&this._fireBeforeZoom()&&zoom.zoomIn())&&(this._fireZoom(),!0)},Page.prototype.zoomOut=function(){var zoom=CM.getZoom();return!!(zoom&&this._fireBeforeZoom()&&zoom.zoomOut())&&(this._fireZoom(),!0)},Page.prototype.updateElementsZoom=function(){var zoom=CM.getZoom(),factor=zoom.getFactor();if(zoom&&factor!=this.zoomFactor){var pageEl=this.getElement();zoom.updateElements(pageEl)}},Page.prototype.setPassage=function(passage){this._passage=passage},Page.prototype.getPassage=function(showing){return this._passage&&showing&&!this._passage.isShowing()?null:this._passage},Page.prototype.addItem=function(item){this._items.push(item),this._itemHash[item.position]=item},Page.prototype.getItems=function(showing){return showing?this._items.filter(function(item){return item.isShowing()}):this._items.slice(0)},Page.prototype.getItem=function(position){return this._itemHash[position]},Page.prototype.getEntities=function(showing){var passage=this.getPassage(showing),items=this.getItems(showing);return passage?Util.Array.concat(passage,items):items},Page.prototype.getActiveEntity=function(){return this._activeEntity},Page.prototype.clearEntity=function(){var activeEntity=this.getActiveEntity();return null!=activeEntity&&(activeEntity.clearActive(),!0)},Page.prototype.prevEntity=function(){var items=this.getItems(!0),currentEntity=this.getActiveEntity();if(null==currentEntity||currentEntity instanceof ContentPassage)currentEntity=items[items.length-1];else for(var i=0;i<items.length;i++)if(currentEntity==items[i]){currentEntity=items[i-1]||this.getPassage(!0)||items[items.length-1];break}return currentEntity?(currentEntity.setActive(),currentEntity):null},Page.prototype.nextEntity=function(){var items=this.getItems(!0),currentEntity=this.getActiveEntity();if(null==currentEntity||currentEntity instanceof ContentPassage)currentEntity=items[0];else for(var i=0;i<items.length;i++)if(currentEntity==items[i]){currentEntity=items[i+1]||this.getPassage(!0)||items[0];break}return currentEntity?(currentEntity.setActive(),currentEntity):null},Page.prototype.getComponents=function(){var lookup=[],mapping=[];return this.getEntities(!0).forEach(function(entity){entity.getComponents(!0).forEach(function(component){-1==lookup.indexOf(component)&&(lookup.push(component),mapping.push({entity:entity,component:component}))})}),mapping},Page.prototype.isShowing=function(){return this==this._pages.getCurrent()},Page.prototype.collapseSelection=function(){var pageDoc=this.getActiveDoc(),pageSelection=CM.getSelection(pageDoc);pageSelection&&!pageSelection.isCollapsed&&pageSelection.rangeCount>0&&pageSelection.collapseToStart()},Page.prototype.getScrollableElement=function(){var pageElement=this.getElement();if(pageElement){var entity=this.getActiveEntity();if("12"==this.layout)return Util.Dom.getElementByClassName("writeWrap","div",pageElement);if(entity instanceof ContentPassage)return entity.getElement();if(entity instanceof ContentItem)return Util.Dom.getElementByClassName("theQuestions","div",pageElement)}return null},Page.prototype.enableScroll=function(){this._enableScroll=!0},Page.prototype.disableScroll=function(){this._enableScroll=!1},Page.prototype.scroll=function(direction){var el=this.getScrollableElement();if(null!=el&&this._enableScroll){switch(direction){case"Up":el.scrollTop-=25;break;case"Down":el.scrollTop+=25;break;case"Left":el.scrollLeft-=25;break;case"Right":el.scrollLeft+=25}}},Page.prototype.toString=function(){return"Page "+this.id},Page.prototype.render=function(){return!this._container&&(this._container=this._renderer.render(),!0)},Page.prototype.wait=function(eventName){var deferred=Q.defer();return this.once(eventName,function(){deferred.resolve()}),deferred.promise},Page.prototype.hide=function(){if(!this.isShowing())return!1;var containerEl=this.getContainer();return!!containerEl&&(this.fire("beforeHide"),Renderer.hide(containerEl),this.clearEntity(),this._pages.getCurrent()==this&&this._pages.setCurrent(null),this.getEntities().forEach(function(entity){entity.hide()}),this.fire("hide"),YAHOO.lang.later(1,this,function(){this.fire("afterHide")}),!0)},Page.prototype.show=function(){if(this.isShowing())return!1;var containerEl=this.getContainer();if(null==containerEl)return!1;if(!1===this.fire("beforeShow"))return!1;var currentPage=this._pages.getCurrent();currentPage&&currentPage!=this&&currentPage.hide(),Renderer.show(containerEl),this._pages.setCurrent(this);var plugins=this.plugins.getAll(),entities=Util.Array.findWhere(plugins,function(plugin){return plugin.getEntitiesToShow()});if(entities||(entities=this.getEntities()),entities.forEach(function(entity){entity.show()}),!CM.isAccessibilityEnabled()){var activeEntity=Util.Array.findWhere(plugins,function(plugin){return plugin.getEntityForFocus()});if(!activeEntity)if(this._lastEntity&&this._lastEntity.isShowing())activeEntity=this._lastEntity;else{var items=this.getItems(!0);if(items.length>0)activeEntity=items[0];else{var passage=this.getPassage(!0);passage&&(activeEntity=passage)}}activeEntity&&activeEntity.setActive({force:!0})}return $("body").addClass("tds-contentRedraw"),this.fire("show"),YAHOO.lang.later(1,this,function(){$("body").removeClass("tds-contentRedraw"),this.fire("afterShow")}),!0},Page.prototype.getLastActive=function(){return this._lastEntity},Page.prototype.dispose=function(){this.plugins.getAll().forEach(function(plugin){plugin.dispose()}),this.plugins.clear(),this._passage&&(this._passage.dispose(),delete this._passage),this._items&&(this._items.forEach(function(item){item.dispose()}),Util.Array.clear(this._items)),this._pages=null,this.id=null,this.segmentID=null,this.layout=null,this.soundCue=null,this.autoPlayQueue=TDS.Audio.Player.createQueue(),this._container=null,this._doc=null,this._passage=null,this._items=null,this._itemHash=null,this._html=null,this._activeEntity=null,this._zoom=null,this._lastEntity=null,Renderer.getStateNames().forEach(function(status){this._renderer.removeListener(status,this.onRendererStatus)}.bind(this)),this._renderer=null,this.fire("dispose"),this.removeAllListeners()},window.ContentPage=Page}(ContentManager),function(CM){function Entity(page,bankKey,itemKey,filePath){this._errors=[],this._page=page,this._showing=!1,this.bankKey=bankKey,this.itemKey=itemKey,this.filePath=filePath,this.audioLinks=[],this.printed=!1,this._components=[],this._activeComponent=null,this.plugins=new CM.Plugins,this.orderedPlugins=[],this.plugins.on("add",function(plugin){this.orderedPlugins.push(plugin)}.bind(this)),this.plugins.on("remove",function(plugin){Util.Array.remove(this.orderedPlugins,plugin)}.bind(this)),Util.Event.Emitter(this),this.init()}Entity.prototype.init=function(){},Entity.prototype.addError=function(ex,details){this._errors.push({ex:ex,details:details})},Entity.prototype.getErrors=function(){return this._errors},Entity.prototype.clearErrors=function(){Util.Array.clear(this._errors)},Entity.prototype.getElement=function(){},Entity.prototype.getToolsElement=function(){},Entity.prototype.getToolElement=function(name){var toolsEl=this.getToolsElement();if(toolsEl)return $("."+name,toolsEl).get(0)},Entity.prototype.addToolElement=function(obj){Util.Assert.isObject(obj),Util.Assert.isString(obj.classname);var toolsEl=this.getToolsElement();if(toolsEl){var toolEl=this.getToolElement(obj.classname);if(toolEl)return toolEl;if(toolEl=document.createElement("a"),$(toolEl).addClass("toolButton"),$(toolEl).addClass(obj.classname),toolEl.setAttribute("href","#"),toolEl.setAttribute("tabindex","0"),obj.text&&toolEl.setAttribute("aria-label",obj.text),toolEl.setAttribute("role","button"),obj.hasPopup&&toolEl.setAttribute("aria-haspopup","true"),obj.fn){var callback=function(evt){function execTool(){obj.fn.call(this,toolEl,evt)}var currentPage=this.getPage().getParent().getCurrent();if(currentPage&&currentPage.getActiveEntity()==this&&YUE.stopEvent(evt),obj.delay){var timeout=!0===obj.delay?0:obj.delay;setTimeout(execTool.bind(this),timeout)}else execTool()}.bind(this);toolEl.addEventListener("pointerdown",callback),new YAHOO.util.KeyListener(toolEl,{keys:[32,13]},{fn:callback}).enable()}return toolsEl.appendChild(toolEl),this.addComponent(toolEl),toolEl}},Entity.prototype.getText=function(){var el=this.getElement(),text=$(el).text();return text=$.trim(text)},Entity.prototype.isEmpty=function(){return 0===this.getText().length&&!$(this.getElement()).has("img, audio, video").length},Entity.prototype.getPage=function(){return this._page},Entity.prototype.getResource=function(type){return this.resources?this.resources[type]:null},Entity.prototype.isVisible=function(){var element=this.getElement();return Util.Dom.isVisible(element)},Entity.prototype.isShowing=function(){return this._showing},Entity.prototype.show=function(){if(this.isShowing())return!1;this._showing=!0;var entityEl=this.getElement();return CM.Renderer.show(entityEl),this.fire("show"),!0},Entity.prototype.hide=function(){if(!this.isShowing())return!1;this._showing=!1;var entityEl=this.getElement();return CM.Renderer.hide(entityEl),this.fire("hide"),!0},Entity.prototype.isActive=function(){return this==this._page._activeEntity},Entity.prototype.clearActive=function(){var activeEntity=this._page.getActiveEntity();if(!activeEntity||activeEntity!=this)return!1;this._log("ENTITY INACTIVE");var element=activeEntity.getElement();return CM.blur(element),this._page.collapseSelection(),this._page._activeEntity=null,this.clearComponent(),this.fire("blur"),!0};var ActiveOptions={component:!0,force:!1};Entity.prototype.setActive=function(opts){opts=YAHOO.lang.augmentObject(opts||{},ActiveOptions);var previousEntity=this._page.getActiveEntity()||null;return!(!opts.force&&this==previousEntity)&&(this._page.clearEntity(),this._log("ENTITY ACTIVE"),this._page._activeEntity=this,this._page._lastEntity=this,opts.component&&(!0===opts.component?this.resetComponent():"object"==typeof opts.component&&this.setActiveComponent(opts.component)),this.fire("focus",previousEntity),!0)},Entity.prototype.scrollTo=function(){this.getElement().scrollIntoView(!1)},Entity.prototype.addComponent=function(el){if(!el)return!1;if(Util.Dom.isElement(el)&&el.setAttribute("tabindex","0"),el.addEventListener){var accProps=this.getPage().getAccProps();accProps&&accProps.isStreamlinedMode()&&(el.addEventListener("focus",function(evt){YUE.stopPropagation(evt),this.setActiveComponent(el)}.bind(this)),el.addEventListener("blur",function(evt){YUE.stopPropagation(evt),this.clearComponent()}.bind(this)))}return!!this._components&&(this._components.push(el),!0)},Entity.prototype.getComponents=function(visible){var components;return components=visible?Util.Array.filter(this._components,function(component){return"function"==typeof component.isVisible?component.isVisible():!Util.Dom.isElement(component)||Util.Dom.isVisible(component)}):Util.Array.clone(this._components),Util.Dom.sort(components),components},Entity.prototype.findComponent=function(element){return CM.getAncestor(element,this._components)},Entity.prototype.getActiveComponent=function(){return this._activeComponent},Entity.prototype.setActiveComponent=function(component,force){if((force||this._activeComponent!=component)&&(this._activeComponent&&(this._log("COMPONENT BLUR: "+this._activeComponent.id+" ("+this._activeComponent.className+")"),CM.blur(this._activeComponent),CM.fireComponentEvent("blur",this,this._activeComponent),this.fire("blurComponent",this._activeComponent),this._activeComponent=null),component)){if(this.isActive()||this.setActive({component:!1}),!(-1!=this.getComponents().indexOf(component)))throw new Error("Component not found for this item.");this._activeComponent=component,this._log("COMPONENT FOCUS: "+this._activeComponent.id+" ("+this._activeComponent.className+")"),CM.focus(this._activeComponent),CM.fireComponentEvent("focus",this,this._activeComponent),this.fire("focusComponent",this._activeComponent)}},Entity.prototype.clearComponent=function(){this.setActiveComponent(null)},Entity.prototype.resetComponent=function(){var firstComponent=Util.Array.pick(this.getComponents());firstComponent&&this.setActiveComponent(firstComponent)},Entity.prototype.resetCaretPosition=function(){var page=this.getPage(),pageWin=page.getWin(),pageDoc=page.getDoc(),element=this.getActiveComponent();if(!CM.isElement(element))return!1;if(!YUD.inDocument(element,pageDoc))return!1;CM.focus(pageWin);for(var xPathResult=pageDoc.evaluate(".//text()",element,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),textNode=null,i=0,l=xPathResult.snapshotLength;i<l;i++){var node=xPathResult.snapshotItem(i),text=node.textContent;if(text=text.replace(/\s+/g," "),text=text.replace(/^\s+|\s+$/g,""),textNode=node,text.length>0)break}if(!textNode)return!1;var selection=pageWin.getSelection();selection.removeAllRanges();var range=pageDoc.createRange();return range.setStart(textNode,0),range.setEnd(textNode,0),selection.addRange(range),selection.collapseToStart(),!0},Entity.prototype.dispose=function(){if(this.plugins.getAll().forEach(function(plugin){plugin.dispose()}),this.plugins.clear(),this._activeComponent=null,this._components)for(var i=0;i<this._components.length;i++)this._components[i].dispose&&this._components[i].dispose(),delete this._components[i];this._components=null,this._page=null,this.bankKey=null,this.itemKey=null,this.audioLinks=null,this.fire("dispose"),this.removeAllListeners()},window.ContentEntity=Entity}(ContentManager),function(CM){function Passage(page,bankKey,itemKey,filePath){Passage.superclass.constructor.call(this,page,bankKey,itemKey,filePath)}YAHOO.lang.extend(Passage,ContentEntity),Passage.prototype.getID=function(){return"G-"+this.bankKey+"-"+this.itemKey},Passage.prototype.getElement=function(){var pageElement=this.getPage().getElement();return Util.Dom.getElementByClassName("thePassage","div",pageElement)},Passage.prototype.getToolsElement=function(){var pageElement=this.getPage().getElement();return Util.Dom.getElementByClassName("passageTools","div",pageElement)},Passage.prototype.clearActive=function(){var itemElement=this.getElement();YUD.removeClass(itemElement,"activePassage"),Passage.superclass.clearActive.call(this)},Passage.prototype.setActive=function(opts){var activated=Passage.superclass.setActive.call(this,opts);if(activated){var element=this.getElement();YUD.addClass(element,"activePassage")}return activated},Passage.prototype._log=function(message){CM._debug&&CM.log("PASSAGE G-"+this.bankKey+"-"+this.itemKey+": "+message)},Passage.prototype.toString=function(){return"Passage G-"+this.bankKey+"-"+this.itemKey},window.ContentPassage=Passage}(window.ContentManager),function(CM,Entity){function Item(page,bankKey,itemKey,filePath,format,responseType,grade,subject,position){this.format=format,this.responseType=responseType,this.grade=grade,this.subject=subject,this.position=position,this.isDirty=!1,this.value=null,this.disabled=!1,this.stemTTS=null,this.illustrationTTS=null,this.gridAnswerSpace=null,this.tutorial=null,this.gtr=null,Item.superclass.constructor.call(this,page,bankKey,itemKey,filePath),this.widgets=new CM.Widgets,this.widgets.on("add",function(widget){this.orderedPlugins.push(widget)}.bind(this)),this.widgets.on("remove",function(widget){Util.Array.remove(this.orderedPlugins,widget)}.bind(this))}YAHOO.lang.extend(Item,Entity),Item.prototype.getParentPage=function(){return this._page},Item.prototype.getID=function(){return"I-"+this.bankKey+"-"+this.itemKey},Item.prototype.init=function(){},Item.prototype.isReadOnly=function(){return!!CM.isReadOnly()||this.disabled},Item.prototype.isResponseType=function(type){return type.toLowerCase()==this.responseType.toLowerCase()},Item.prototype.getElement=function(){var compoundEl=this._page.getCompoundElement();if(compoundEl)return compoundEl;var doc=this._page.getDoc();return doc?doc.getElementById("Item_"+this.position):null},Item.prototype.setQuestionLabel=function(text){$(".questionNumber",this.getElement()).text(text)},Item.prototype.getQuestionLabel=function(){return $(".questionNumber",this.getElement()).text()},Item.prototype.setQuestionHeader=function(text){var header=$(".questionLabel",this.getElement())[0];header&&(header.innerHTML=text)},Item.prototype.getIllustrationElement=function(){var doc=this._page.getDoc();return doc?doc.getElementById("Illustration_"+this.position):null},Item.prototype.getStemElement=function(){var doc=this._page.getDoc();return doc?doc.getElementById("Stem_"+this.position):null},Item.prototype.getResponseArea=function(){var itemEl=this.getElement();return $(".answerCell, .answerContainer",itemEl).get(0)},Item.prototype.getResponseTTS=function(){if(!this._page.getDoc())return null;this._page.getElement();var mcWidgets=this.widgets.get("mc");if(mcWidgets.length){var options=mcWidgets[0]._group.getOptions(),optionElements=[];if(options&&options.length>0)for(var i=0;i<options.length;i++){var optionEl=options[i].getElement();optionEl&&optionElements.push(optionEl)}return optionElements}return null},Item.prototype.clearActive=function(){var itemElement=this.getElement();YUD.removeClass(itemElement,"activeItem"),Item.superclass.clearActive.call(this)},Item.prototype.setActive=function(opts){var activated=Item.superclass.setActive.call(this,opts);if(activated){var element=this.getElement();YUD.addClass(element,"activeItem")}return activated},Item.prototype.showFeedback=function(){var itemEl=this.getElement();itemEl&&YUD.addClass(itemEl,"showFeedback")},Item.prototype.hideFeedback=function(){var itemEl=this.getElement();itemEl&&YUD.removeClass(itemEl,"showFeedback")},Item.prototype.getToolsElement=function(){return $(".itemTools",this.getElement()).get(0)},Item.prototype._log=function(message){CM._debug&&console.log("ITEM I-"+this.bankKey+"-"+this.itemKey+" ("+this.position+"): "+message)},Item.prototype.toString=function(){return"Item I-"+this.bankKey+"-"+this.itemKey},window.ContentItem=Item}(ContentManager,ContentEntity),function(CM,CI){function parseDataType(value){return"string"==typeof value?DataType.String:$.isArray(value)?DataType.Array:$.isXMLDoc(value)?DataType.Xml:DataType.Unknown}function Container(){}var DataType={Unknown:"unknown",String:"string",Array:"array",Xml:"xml"};CM.DataType=DataType;var Response=function(id,value,valid,empty,selected){var created=new Date;Object.defineProperties(this,{id:{get:function(){return id}},created:{get:function(){return created}},value:{get:function(){return value}},valid:{get:function(){return valid}},selected:{get:function(){return selected}},empty:{get:function(){return empty}}}),Object.defineProperties(this,{isValid:{get:function(){return valid}},isSelected:{get:function(){return selected}}})};Object.defineProperty(Response.prototype,"dataType",{get:function(){return parseDataType(this.value)}}),Response.prototype.toString=function(delimiter){var type=this.dataType;return null==this.value?"":type==DataType.String?this.value:type==DataType.Array?this.value.join(delimiter||","):type==DataType.Xml?Util.Xml.serializeToString(this.value):JSON.stringify(this.value)},CM.createResponse=function(id,value,valid,empty,selected){return Util.Assert.isString(id),Util.Assert.isNotUndefined(value),Util.Assert.isBoolean(valid),"boolean"!=typeof empty&&(empty=null==value||0==value.length||!valid),"boolean"!=typeof selected&&(selected=valid||!empty),new Response(id,value,valid,empty,selected)},Container.prototype.validate=function(){},Container.prototype.load=function(){throw new Error("Container load not implemented.")},Container.prototype.create=function(responses){throw new Error("Container create not implemented.")};var containerLookup=new Util.Structs.Map,containerMap=new Util.Structs.Map;CM.registerResponseContainer=function(name,cls){YAHOO.lang.extend(cls,Container),containerLookup.set(name.toLowerCase(),cls)},CM.mapResponseContainer=function(format,name){containerMap.set(format.toLowerCase(),name.toLowerCase())},CM.createResponseContainer=function(format){var name=containerMap.get(format.toLowerCase());if(name){var cls=containerLookup.get(name),instance=new cls;return cls.superclass.constructor.call(instance),instance}return null},CI.prototype.isResponseAvailable=function(){var widgets=this.widgets.getAll();return!!widgets.length&&widgets.every(function(widget){return widget.isResponseAvailable()})},CI.prototype.getResponse=function(){if(!this.isResponseAvailable())return null;var responses=this.widgets.getAll().map(function(widget){var response=widget.getResponse();if(!(response instanceof Response))throw new Error("No response object returned from response '"+response.id+"'.");if(null!=response.value&&response.dataType!=widget.dataType)throw new Error("The response data type '"+response.dataType+"' does not match the widget data type '"+widget.dataType+" '.");return response}),container=CM.createResponseContainer(this.format);if(null==container)return responses[0];var value=container.create(responses),valid=responses.every(function(response){return response.valid}),empty=responses.every(function(response){return response.empty}),selected=responses.every(function(response){return response.selected});return CM.createResponse(this.getID(),value,valid,empty,selected)},CI.prototype.setResponse=function(value,autoLoad){var widgets=this.widgets.getAll();if(0==widgets.length)throw new Error("No item widgets found");if(autoLoad&&0==(widgets=widgets.filter(function(widget){return widget.options.autoLoad})).length)return!1;var container=CM.createResponseContainer(this.format);return null==container?widgets[0].setResponse(value):container.load(value,widgets)}}(ContentManager,ContentItem),function(CM){function parse(contentsNode){var contents=[];return batchNodes("content",contentsNode,function(contentNode){var content=parseContent(contentNode);contents.push(content)}),contents}function parseContent(contentNode){var content={id:getAttrib(contentNode,"groupID"),segmentID:getAttrib(contentNode,"segmentID"),layout:getAttrib(contentNode,"layout"),language:getAttrib(contentNode,"language"),passage:null,items:[]},soundCueNode=getNode("soundCue",contentNode);soundCueNode&&(content.soundCue={bankKey:getAttribInt(soundCueNode,"bankKey"),itemKey:getAttribInt(soundCueNode,"itemKey")});var passageNode=getNode("passage",contentNode);passageNode&&(content.passage=parsePassage(passageNode));var itemsNode=getNode("items",contentNode);return itemsNode&&batchNodes("item",itemsNode,function(itemNode){var item=parseItem(itemNode);content.items.push(item)}),content.html=getCData(contentNode,"html"),content}function parseResources(contentNode){var resources={},resourcesNode=getNode("resources",contentNode);return resourcesNode&&batchNodes("resource",resourcesNode,function(resourceNode){var resourceType=getAttrib(resourceNode,"type"),resource={bankKey:getAttribInt(resourceNode,"bankKey"),itemKey:getAttribInt(resourceNode,"itemKey")};resources[resourceType]=resource}),resources}function parseAttachments(contentNode){var attachments=[],attachmentsNode=getNode("attachments",contentNode);return attachmentsNode&&batchNodes("attachment",attachmentsNode,function(attachmentNode){var attachment={id:getAttrib(attachmentNode,"id"),type:getAttrib(attachmentNode,"type"),subType:getAttrib(attachmentNode,"subType"),target:getAttrib(attachmentNode,"target"),url:getAttrib(attachmentNode,"url")};attachments.push(attachment)}),attachments}function parseMedia(contentNode){var mediaResources=[],mediaNode=getNode("media",contentNode);return mediaNode&&batchNodes("resource",mediaNode,function(resourceNode){var mediaResource={file:getAttrib(resourceNode,"file"),type:getAttrib(resourceNode,"type"),data:getText(resourceNode)};mediaResources.push(mediaResource)}),mediaResources}function parseSpecs(node){var specs=[],constraintsNode=getNode("constraints",node);null!=constraintsNode&&(constraintsNode.parentNode.removeChild(constraintsNode),specs.push(constraintsNode));var searchNode=getNode("search",node);return null!=searchNode&&(searchNode.parentNode.removeChild(searchNode),specs.push(searchNode)),specs}function parsePassage(passageNode){var passage={bankKey:getAttribInt(passageNode,"bankKey"),itemKey:getAttribInt(passageNode,"itemKey"),printed:getAttribBool(passageNode,"printed"),filePath:getCData(passageNode,"filePath")};return passage.resources=parseResources(passageNode),passage.attachments=parseAttachments(passageNode),passage.media=parseMedia(passageNode),passage.specs=parseSpecs(passageNode),passage}function parseItem(itemNode){var item={bankKey:getAttribInt(itemNode,"bankKey"),itemKey:getAttribInt(itemNode,"itemKey"),subject:getAttrib(itemNode,"subject"),grade:getAttrib(itemNode,"grade"),format:getAttrib(itemNode,"format"),marked:getAttribBool(itemNode,"marked"),disabled:getAttribBool(itemNode,"disabled"),responseType:getAttrib(itemNode,"responseType"),position:getAttribInt(itemNode,"position"),positionOnPage:getAttribInt(itemNode,"positionOnPage"),filePath:getCData(itemNode,"filePath"),printable:getAttribBool(itemNode,"printable"),printed:getAttribBool(itemNode,"printed")},tutorialNode=getNode("tutorial",itemNode);tutorialNode&&(item.tutorial={bankKey:getAttribInt(tutorialNode,"bankKey"),itemKey:getAttribInt(tutorialNode,"itemKey")}),item.resources=parseResources(itemNode),item.attachments=parseAttachments(itemNode),item.media=parseMedia(itemNode),item.rendererSpec=getCData(itemNode,"rendererSpec"),item.gridAnswerSpace=getCData(itemNode,"gridAnswerSpace");var optionsNode=getNode("options",itemNode);optionsNode&&(item.optionsConfig={minChoices:getAttribInt(optionsNode,"minChoices"),maxChoices:getAttribInt(optionsNode,"maxChoices")},item.options=[],batchNodes("option",optionsNode,function(optionNode){var option=parseOption(optionNode);item.options.push(option)})),item.value=getCData(itemNode,"response");var rubricNode=getNode("rubric",itemNode);rubricNode&&(item.rubric={type:getAttrib(rubricNode,"type"),data:getText(rubricNode)});var qtiNode=getNode("qti",itemNode);if(qtiNode){var qtiSpec=getAttrib(qtiNode,"spec"),qtiXml=getText(qtiNode);item.qti={spec:qtiSpec,xml:qtiXml}}return item.specs=parseSpecs(itemNode),item}function parseOption(optionNode){var option={key:getAttrib(optionNode,"key")};return option.value=getCData(optionNode,"value"),option.sound=getCData(optionNode,"sound"),option.feedback=getCData(optionNode,"feedback"),option}var getNode=Util.Dom.queryTag,batchNodes=(Util.Dom.queryTags,Util.Dom.queryTagsBatch),getAttribInt=Util.Xml.getAttributeInt,getAttribBool=Util.Xml.getAttributeBool,getAttrib=Util.Xml.getAttribute,getText=Util.Xml.getNodeText,getCData=Util.Xml.getCData;CM.Xml={},CM.Xml.create=function(root){return parse(getNode("contents",root))}}(ContentManager),function(CM){function adopt(oldParent,newParent){if(oldParent&&newParent){var orphans=YUD.getChildren(oldParent);if(orphans&&orphans.length)for(var orphanCount=orphans.length,j=0;j<orphanCount;j++){var orphan=orphans[j];newParent.appendChild(oldParent.removeChild(orphan))}}}function pruneNonHtml(doc){var allNodes=[],traverseTreeRecursive=function(parentNode){if(parentNode){allNodes.push(parentNode);var children=YUD.getChildren(parentNode);if(children)for(var i=0;i<children.length;i++)traverseTreeRecursive(children[i])}},itemNode=doc.documentElement;traverseTreeRecursive(itemNode);for(var nodeCount=allNodes.length,i=0;i<nodeCount;i++){var currentNode=allNodes.pop();if(validHtmlTags.indexOf(currentNode.nodeName)<0&&currentNode.parentNode!=doc){var grandParentNode=currentNode.parentNode;adopt(currentNode,grandParentNode),grandParentNode.removeChild(currentNode)}}}function mapInteractionsToWidgetConfigs(item,type,custom){var stemEl=item.getElement(),selector="*[data-qti-type="+type+"]";return custom&&(selector+="[data-qti-custom="+custom+"]"),$(selector,stemEl).map(function(idx,interactionEl){var scriptEl=$(interactionEl).children().get(0),interactionId=interactionEl.getAttribute("data-qti-identifier"),interactionXml=scriptEl.innerHTML,interactionNode=Util.Xml.parseFromString(interactionXml).documentElement;return new CM.WidgetConfig(interactionId,interactionEl,interactionNode)}).get()}var QTI={},validHtmlTags=["abbr","acronym","address","blockquote","br","cite","code","dfn","div","em","h1","h2","h3","h4","h5","h6","kbd","p","pre","q","samp","span","strong","var","dl","dlElement","dt","dd","ol","ul","li","b","big","hr","i","small","sub","sup","tt","caption","col","colgroup","table","tableCell"," tableCellScope","tbody","td","tfoot","th","thead","tr","img","a"];QTI.validHtmlTags=validHtmlTags,QTI.loadStem=function(item){var stemEl=item.getStemElement(),xmlString=item.qti.xml;xmlString=(xmlString=xmlString.replace(/<prompt/g,"<p")).replace(/<\/prompt/g,"</p");var xmlDoc=Util.Xml.parseFromString(xmlString);pruneNonHtml(xmlDoc),adopt(xmlDoc.documentElement,stemEl)},QTI.createWidgetMatch=function(type,custom){return function(page,item,content){return!!item.isResponseType("QTI")&&mapInteractionsToWidgetConfigs(item,type,custom)}},QTI.moveContents=function(fromNode,toNode){$(fromNode).contents().each(function(idx,childNode){$(toNode).append(childNode)})},QTI.replaceNodes=function(parentNode,selector,replacer){return $(selector,parentNode).map(function(idx,currentNode){var newNode=replacer(currentNode);return QTI.moveContents(currentNode,newNode),$(currentNode).replaceWith(newNode),newNode}).get()},QTI.replacePrompt=function(parentNode){var doc=parentNode.ownerDocument,prompts=QTI.replaceNodes(parentNode,"prompt",function(promptNode){var promptEl=doc.createElement("div");return promptEl.setAttribute("class","interactionPrompt"),promptEl});return prompts.length>0?prompts[0]:null},QTI.createInteractionElement=function(interactionNode,nodeName){var interactionEl=document.createElement(nodeName||"div");return interactionEl.innerHTML=Util.Xml.innerHTML(interactionNode),interactionEl},QTI.isNativeEntity=function(entity){return entity instanceof ContentItem&&"QTI"==entity.responseType||!!(entity instanceof ContentPassage&&entity.qti)},CM.QTI=QTI}(window.ContentManager),function(CM){function PagePlugin(page,config){Util.Assert.isInstanceOf(ContentPage,page),Util.Event.Emitter(this),this.page=page,this.config=config,YAHOO.lang.augmentObject(this,{delay:!1}),this.init(config)}PagePlugin.prototype.getName=function(){return"default"},PagePlugin.prototype.getResources=function(){return[]},PagePlugin.prototype.init=function(config){},PagePlugin.prototype.load=function(){},PagePlugin.prototype.beforeShow=function(){},PagePlugin.prototype.show=function(){},PagePlugin.prototype.beforeHide=function(){},PagePlugin.prototype.hide=function(){},PagePlugin.prototype.zoom=function(level){},PagePlugin.prototype.dispose=function(){},PagePlugin.prototype.getEntitiesToShow=function(){},PagePlugin.prototype.getEntityForFocus=function(){return null},PagePlugin.prototype.getString=function(){return"PLUGIN ["+this.getName()+"]"},CM.PagePlugin=PagePlugin}(ContentManager),function(CM){function EntityPlugin(page,entity,config){Util.Assert.isInstanceOf(ContentPage,page),Util.Assert.isInstanceOf(ContentEntity,entity),Util.Event.Emitter(this),this.page=page,this.entity=entity,this.config=config,this.init(config)}EntityPlugin.prototype.getResources=function(){return[]},EntityPlugin.prototype.getComponents=function(){return[]},EntityPlugin.prototype.init=function(){},EntityPlugin.prototype.load=function(el){},EntityPlugin.prototype.show=function(){},EntityPlugin.prototype.hide=function(){},EntityPlugin.prototype.focus=function(){},EntityPlugin.prototype.blur=function(){},EntityPlugin.prototype.zoom=function(level){},EntityPlugin.prototype.keyEvent=function(ev){},EntityPlugin.prototype.showMenu=function(menu,evt){},EntityPlugin.prototype.dispose=function(){},CM.EntityPlugin=EntityPlugin}(ContentManager),function(CM){function WidgetConfig(id,element,data){Util.Assert.isInstanceOf(WidgetConfig,this,"WidgetConfig is a class."),Util.Assert.isString(id,"WidgetConfig requires string id."),Util.Assert.isElement(element,"WidgetConfig requires HTMLElement."),this.id=id,this.element=element,this.data=data}function ItemWidget(page,item,config){Util.Assert.isInstanceOf(ContentPage,page),Util.Assert.isInstanceOf(ContentItem,item),Util.Assert.isInstanceOf(WidgetConfig,config),this.id=config.id,this.element=config.element,YAHOO.lang.augmentObject(this,DefaultProps),this.options||(this.options={}),YAHOO.lang.augmentObject(this.options,DefaultOptions),ItemWidget.superclass.constructor.call(this,page,item,config.data)}CM.WidgetConfig=WidgetConfig;var DefaultProps={dataType:CM.DataType.String},DefaultOptions={autoLoad:!1};YAHOO.lang.extend(ItemWidget,CM.EntityPlugin),ItemWidget.prototype.createResponse=function(value,valid,empty,selected){return CM.createResponse(this.id,value,valid,empty,selected)},ItemWidget.prototype.isResponseAvailable=function(){return!0},ItemWidget.prototype.getResponse=function(){return null},ItemWidget.prototype.setResponse=function(value){return!1},CM.ItemWidget=ItemWidget}(ContentManager),ContentManager.Plugins=function(){function Plugins(){this._lookup=new Util.Structs.Map,Util.Event.Emitter(this)}return Plugins.prototype.remove=function(plugin){return Util.Array.remove(this._lookup,plugin)},Plugins.prototype.add=function(name,plugin){this._lookup.set(name,plugin),this.fire("add",plugin)},Plugins.prototype.getNames=function(){return this._lookup.getKeys()},Plugins.prototype.getAll=function(){return this._lookup.getValues()},Plugins.prototype.has=function(name){return this._lookup.containsKey(name)},Plugins.prototype.get=function(name){return this._lookup.get(name)},Plugins.prototype.remove=function(name){this._lookup.remove(name)&&this.fire("remove",plugin)},Plugins.prototype.clear=function(){this._lookup.clear()},Plugins}(),function(CM){function getValues(){return lookup.getValues()}function create(reg,page,config){var instance=new reg.cls(page,config);return reg.cls.superclass.constructor.call(instance,page,config),instance}function findMatches(page,content){function configure(reg,config){var instance=create(reg,page,config);page.plugins.add(reg.name,instance)}getValues().forEach(function(reg){if("function"==typeof reg.match){var configs=reg.match(page,content);configs&&configure(reg,configs)}});var pluginNames=page.plugins.getNames();pluginNames.length>0&&console.log("Page Plugins: "+pluginNames.join(", "))}function eachPlugin(page,callback){page.plugins.getAll().forEach(callback)}function onPageCreated(page,content){page.on("rendered",function(){findMatches(page,content)}),page.on("available",function(){eachPlugin(page,function(plugin){plugin.delay||plugin.load()})}),page.on("loaded",function(){eachPlugin(page,function(plugin){plugin.delay&&plugin.load()})}),page.on("show",function(){eachPlugin(page,function(plugin){plugin.show()})}),page.on("beforeShow",function(){eachPlugin(page,function(plugin){plugin.beforeShow()})}),page.on("beforeHide",function(){eachPlugin(page,function(plugin){plugin.beforeHide()})}),page.on("hide",function(){eachPlugin(page,function(plugin){plugin.hide()})}),page.on("zoom",function(level){eachPlugin(page,function(plugin){plugin.zoom(level)})})}var lookup=new Util.Structs.Map;CM.on("pagesCreated",function(pages){pages.on("pageCreated",onPageCreated)}),CM.registerPagePlugin=function(name,cls,match){Util.Assert.isString(name,"Name should be a string."),Util.Assert.isFunction(cls),Util.Assert.isFunction(match),"object"==typeof cls.superclass&&"function"==typeof cls.superclass.constructor||YAHOO.lang.extend(cls,CM.PagePlugin),lookup.set(name,{name:name,cls:cls,match:match})},CM.getPagePlugin=function(name){return lookup.get(name)},CM.getPagePlugins=getValues,CM.clearPagePlugins=function(){lookup.clear()}}(ContentManager),ContentManager.Widgets=function(){function Widgets(){this._list=[],this._groups={},Util.Event.Emitter(this)}return Widgets.prototype.add=function(name,widget){if(-1!=this._list.indexOf(widget))throw new Error("The widget '"+widget.id+"' is already added");this._list.push(widget);var group=this._groups[name];group||(group=[],this._groups[name]=group),group.push(widget),this._list.sort(function(w1,w2){var e1=w1.element,e2=w2.element;return 2&e1.compareDocumentPosition(e2)?1:-1}),this.fire("add",widget)},Widgets.prototype.getAll=function(){return this._list},Widgets.prototype.getNames=function(){return Util.Object.keys(this._groups)},Widgets.prototype.has=function(name){return!!this._groups[name]},Widgets.prototype.get=function(name,id){var group=this._groups[name]||[];return"string"==typeof id?Util.Array.find(group,function(widget){return widget.id==id}):"number"==typeof id?group[id]:group},Widgets.prototype.remove=function(widget){var removed=Util.Array.remove(this._list,widget);return Util.Object.each(this._groups,function(widgets,name){Util.Array.remove(widgets,widget)&&(widgets.length||delete this._groups[name])},this),removed&&this.fire("remove",widget),removed},Widgets.prototype.clear=function(){Util.Array.clear(this._list),Object.keys(this._groups).forEach(function(group){Util.Array.clear(group)}),Util.Object.clear(this._groups)},Widgets}(),function(CM){function sort(arr){Util.Array.sort(arr,function(obj1,obj2){return obj1.priority-obj2.priority||obj1.order-obj2.order})}function addRegistration(name,cls,match,opts,defaults){var reg={name:name,cls:cls,match:match,order:regCount++};opts&&YAHOO.util.Lang.augmentObject(reg,opts),defaults&&YAHOO.util.Lang.augmentObject(reg,defaults),registrations.push(reg),sort(registrations)}function extend(cls,supercls,prototypeHasOverrides){YAHOO.lang.extend(cls,supercls,!0===prototypeHasOverrides?cls.prototype:void 0)}function extendPlugin(cls,prototypeHasOverrides){"object"==typeof cls.superclass&&"function"==typeof cls.superclass.constructor||extend(cls,CM.EntityPlugin,prototypeHasOverrides)}function extendWidget(cls,prototypeHasOverrides){extend(cls,CM.ItemWidget,prototypeHasOverrides)}function create(cls,page,entity,config){var instance=new cls(page,entity,config);return cls.superclass.constructor.call(instance,page,entity,config),instance}function processWidgetConfig(reg,config){Util.Dom.isTextInput(config.element)||config.element.getAttribute("role")||config.element.setAttribute("role","group");var label=config.element.getAttribute("aria-label");if(!label){var labelKey="cm.widget.label."+reg.name;label=Messages.has(labelKey)?Messages.get(labelKey):reg.name,config.element.setAttribute("aria-label",label)}}function findMatches(page,entity,content,list){function configure(reg,config){reg.widget&&(Util.Assert.isInstanceOf(CM.WidgetConfig,config,"The match() function must return a WidgetConfig."),processWidgetConfig(reg,config));var instance=create(reg.cls,page,entity,config);instances.push(instance),instance instanceof CM.ItemWidget?entity.widgets.add(reg.name,instance):entity.plugins.add(reg.name,instance)}var errors=[],instances=[],entityEl=entity.getElement(),isItem=entity instanceof ContentItem;if(!entityEl)return instances;list.forEach(function(reg){if(!reg.widget||isItem){var configs;try{configs=reg.match(page,entity,content)}catch(ex){errors.push(ex)}configs&&(reg.widget&&$.isArray(configs)?configs.forEach(function(config){configure(reg,config)}):configure(reg,configs))}}),errors.forEach(function(ex){entity.addError(ex),console.error(ex)});var pluginNames=entity.plugins.getNames();if(pluginNames.length>0&&console.log("Entity Plugins: "+pluginNames.join(", ")),isItem){var widgetNames=entity.widgets.getNames();if(widgetNames.length>0){var sbWidget=new Util.StringBuilder("Item Widgets: ");widgetNames.forEach(function(name,widx){widx>0&&sbWidget.append(", "),sbWidget.append(name);var widgets=entity.widgets.get(name);widgets&&(sbWidget.append(" ["),widgets.forEach(function(widget,idx){idx>0&&sbWidget.append(", "),sbWidget.append(widget.id)}),sbWidget.append("]"))}),console.log(sbWidget.toString())}}return instances}function loadInstances(page,entity,instances){var errors=[];instances.forEach(function(instance){var result;try{result=instance.load()}catch(ex){return errors.push(ex),Util.Array.remove(entity.orderedPlugins,instance),void(instance instanceof CM.ItemWidget?entity.widgets.remove(instance):entity.plugins.remove(instance))}if(Util.Promise.isPromise(result)){var rlp=new ResourceLoader.Promise(result);page.addResourceLoader(rlp)}instance.getComponents().forEach(function(component){entity.addComponent(component)})}),errors.forEach(function(ex){entity.addError(ex),console.error(ex)})}function eachPlugin(entity,callback){entity.orderedPlugins.forEach(callback)}function onEntityCreated(entity,content){entity.on("rendered",function(){var filteredRegs=registrations.filter(function(reg){return!reg.defer});findMatches(this,entity,content,filteredRegs)}.bind(this)),entity.on("show",function(){eachPlugin(entity,function(obj){obj.show()})}),entity.on("hide",function(){eachPlugin(entity,function(obj){obj.hide()})}),entity.on("focus",function(previousEntity,domEvent){eachPlugin(entity,function(obj){obj.focus(previousEntity,domEvent)})}),entity.on("blur",function(){eachPlugin(entity,function(obj){obj.blur()})}),entity.on("keyevent",function(evt){eachPlugin(entity,function(obj){obj.keyEvent(evt)})}),entity.on("menushow",function(contentMenu,evt,pageSelection){eachPlugin(entity,function(obj){obj.showMenu(contentMenu,evt,pageSelection)})})}function onPageCreated(page,content){page.on("passageCreated",onEntityCreated),page.on("itemCreated",onEntityCreated),page.on("available",function(){page.getEntities().forEach(function(entity){loadInstances(page,entity,entity.orderedPlugins);var deferredRegs=registrations.filter(function(reg){return reg.defer}),deferredInstances=findMatches(page,entity,content,deferredRegs);loadInstances(page,entity,deferredInstances)})}),page.on("loaded",function(){page.getItems().forEach(function(item){item.value&&item.setResponse(item.value,!0)})}),page.on("beforeShow",function(){var zoom=CM.getZoom(),factor=zoom.getFactor();zoom&&factor!=this.zoomFactor&&page.getEntities().forEach(function(entity){eachPlugin(entity,function(obj){obj.zoom(factor)})})}),page.on("zoom",function(level){page.getEntities().forEach(function(entity){eachPlugin(entity,function(obj){obj.zoom(level)})})})}var regCount=0,registrations=[];CM.on("pagesCreated",function(pages){pages.on("pageCreated",onPageCreated)}),CM.extendEntityPlugin=extendPlugin,CM.registerEntityPlugin=function(name,cls,match,opts){extendPlugin(cls,opts&&opts.prototypeHasOverrides),addRegistration(name,cls,match,opts,{widget:!1,priority:100,defer:!1})},CM.extendWidget=extendWidget,CM.registerWidget=function(name,cls,match,opts){extendWidget(cls,opts&&opts.prototypeHasOverrides),addRegistration(name,cls,match,opts,{widget:!0,priority:200,defer:!1})},CM.createWidget=create,CM.getEntityPlugins=function(){return registrations},CM.clearEntityPlugins=function(){Util.Array.clear(registrations)}}(ContentManager),function(CM){function onEntityCreated(entity,content){return entity.on("show",function(){return CM.fireEntityEvent("show",entity)}),entity.on("hide",function(){return CM.fireEntityEvent("hide",entity)}),entity.on("focus",function(previousEntity){return CM.fireEntityEvent("focus",entity,previousEntity)}),entity.on("blur",function(){return CM.fireEntityEvent("blur",entity)}),entity.on("menushow",function(contentMenu,evt,pageSelection){return CM.fireEntityEvent("menushow",entity,[contentMenu,evt,pageSelection])}),CM.fireEntityEvent("init",entity,[content])}function onPageCreated(page,content){return CM.Renderer.getStateNames().forEach(function(status){page.once(status,function(){return CM.firePageEvent(status,page,null,!0)})}),page.on("passageCreated",onEntityCreated),page.on("itemCreated",onEntityCreated),page.on("beforeShow",function(){return CM.firePageEvent("beforeShow",page)}),page.on("show",function(){return CM.firePageEvent("show",page)}),page.on("afterShow",function(){return CM.firePageEvent("afterShow",page)}),page.on("beforeHide",function(){return CM.firePageEvent("beforeHide",page)}),page.on("hide",function(){return CM.firePageEvent("hide",page)}),page.on("beforeZoom",function(level){return CM.firePageEvent("beforeZoom",page,[level],!0)}),page.on("zoom",function(level){return CM.firePageEvent("zoom",page,[level],!0)}),page.on("keyevent",function(evt){return CM.firePageEvent("keyevent",page,[evt],!0)}),CM.firePageEvent("init",page,[content],!1)}var pageEvents=new Util.Event.Emitter(CM),entityEvents=new Util.Event.Emitter(CM),itemEvents=new Util.Event.Emitter(CM),passageEvents=new Util.Event.Emitter(CM),componentEvents=new Util.Event.Emitter(CM);CM.onPageEvent=function(name,callback){pageEvents.on(name,callback,null,!1)},CM.oncePageEvent=function(name,callback){pageEvents.once(name,callback,null,!0)},CM.removePageEvent=function(name,callback){pageEvents.removeListener(name,callback)},CM.onEntityEvent=function(name,callback){entityEvents.on(name,callback,null,!1)},CM.onceEntityEvent=function(name,callback){entityEvents.once(name,callback,null,!0)},CM.removeEntityEvent=function(name,callback){entityEvents.removeListener(name,callback)},CM.onItemEvent=function(name,callback){itemEvents.on(name,callback,null,!1)},CM.onceItemEvent=function(name,callback){itemEvents.once(name,callback,null,!0)},CM.removeItemEvent=function(name,callback){itemEvents.removeListener(name,callback)},CM.onPassageEvent=function(name,callback){passageEvents.on(name,callback,null,!1)},CM.oncePassageEvent=function(name,callback){passageEvents.once(name,callback,null,!0)},CM.removePassageEvent=function(name,callback){passageEvents.removeListener(name,callback)},CM.onComponentEvent=function(name,callback){componentEvents.on(name,callback,null,!1)},CM.onceComponentEvent=function(name,callback){componentEvents.once(name,callback,null,!0)},CM.removeComponentEvent=function(name,callback){componentEvents.removeListener(name,callback)},CM.firePageEvent=function(name,page,args,fireEntityEvents){"string"==typeof page&&(page=CM.getPage(page)),Util.Assert.isString(name),Util.Assert.isInstanceOf(ContentPage,page);var pageArgs=[page].concat(args||[]),ret=pageEvents.fireArgs(name,pageArgs);if(!0===fireEntityEvents&&!1!==ret){var passage=page.getPassage();passage&&CM.fireEntityEvent(name,passage,args);for(var items=page.getItems(),i=0;i<items.length;i++)CM.fireEntityEvent(name,items[i],args)}return ret},CM.fireEntityEvent=function(name,entity,args){Util.Assert.isString(name),Util.Assert.isInstanceOf(ContentEntity,entity);var entityArgs=[entity.getPage(),entity].concat(args||[]);entityEvents.fireArgs(name,entityArgs),entity instanceof ContentItem?itemEvents.fireArgs(name,entityArgs):entity instanceof ContentPassage&&passageEvents.fireArgs(name,entityArgs)},CM.fireComponentEvent=function(name,entity,component,args){var componentArgs=[entity.getPage(),entity,component].concat(args||[]);componentEvents.fireArgs(name,componentArgs)},CM.on("pagesCreated",function(pages){pages.on("pageCreated",onPageCreated)})}(ContentManager),function(CM){function serializeToHtmlString(node){var div=document.createElement("div");return div.appendChild(node),div.innerHTML}function processTransformers(page,content,xmlStr,isHtml){var matches=transforms.filter(function(transform){return transform.match(page,content,xmlStr)});if(!matches.length)return null;var xmlDoc;try{xmlDoc=Util.Xml.parseFromString(xmlStr,"application/xml")}catch(ex){return console.error(ex),null}return matches.map(function(transform){return transform.execute(page,content,xmlDoc)}).some(function(changed){return!!changed})&&(xmlStr=isHtml?serializeToHtmlString(xmlDoc.documentElement):Util.Xml.serializeToString(xmlDoc.documentElement)),xmlStr}var transforms=[];CM.addTransform=function(transform){transforms.push(transform)},CM.clearTransforms=function(){Util.Array.clear(transforms)},CM.onPageEvent("init",function(page,content){if(transforms.length&&content.html){var xmlStr=processTransformers(page,content,content.html,!0);xmlStr&&xmlStr!=content.html&&page.getRenderer().setHtml(xmlStr)}}),CM.onItemEvent("init",function(page,item,content){if(transforms.length&&item.qti){var xmlStr=processTransformers(page,content,item.qti.xml,!1);xmlStr&&xmlStr!=item.qti.xml&&(item.qti.xml=xmlStr)}})}(window.ContentManager),function(CM){function onKeyEvent(evt){if((!evt.ctrlKey||Util.Browser.supportsModifierKeys())&&!CM.isDialogShowing()&&(evt.ctrlKey&&77==evt.keyCode&&(YUE.stopEvent(evt),"keydown"==evt.type&&CM.Menu.show({evt:evt})),!CM.Menu.isShowing()&&!CM.isDialogShowing())){9==evt.keyCode&&YUE.stopEvent(evt);var currentPage=CM.getCurrentPage();if(null!=currentPage){var currentEntity=currentPage.getActiveEntity();if(null!=currentEntity){if(!evt.key)switch(evt.keyCode){case 9:evt.key="Tab";break;case 13:evt.key="Enter";break;case 27:evt.key="Esc";break;case 32:evt.key="Space";break;case 37:evt.key="Left";break;case 38:evt.key="Up";break;case 39:evt.key="Right";break;case 40:evt.key="Down"}currentPage.fire("keyevent",evt),currentEntity.fire("keyevent",evt)}}}}function processTab(page,evt){var nextIC,moveBack=evt&&evt.shiftKey,mapping=page.getComponents(),currentEntity=page.getActiveEntity(),currentComponent=currentEntity.getActiveComponent(),currentIC=Util.Array.find(mapping,function(ic){return ic.entity==currentEntity&&ic.component==currentComponent}),iter=Util.Iterator(mapping);iter.jumpTo(currentIC);var nextEntity=(nextIC=moveBack?iter.prev():iter.next()).entity,nextComponent=nextIC.component;nextEntity&&nextEntity!=currentEntity&&nextEntity.setActive({component:!1}),nextComponent&&nextComponent!=currentComponent&&nextEntity.setActiveComponent(nextComponent)}CM.addKeyEvents=function(keyEventObj){return!!CM.enableKeyEvents&&(null!=keyEventObj&&(!0!==keyEventObj.__tds_keyEventsEnabled&&(YUE.addListener(keyEventObj,"keydown",onKeyEvent),YUE.addListener(keyEventObj,"keypress",onKeyEvent),YUE.addListener(keyEventObj,"keyup",onKeyEvent),keyEventObj.__tds_keyEventsEnabled=!0,!0)))},CM.onPageEvent("keyevent",function(page,evt){"keydown"==evt.type&&("Tab"!=evt.key||evt.ctrlKey||evt.altKey||processTab(page,evt))}),CM.onPageEvent("keyevent",function(page,evt){var keyCode=evt.keyCode;if(keyCode>=37&&keyCode<=40&&!Util.Event.hasModifier(evt)&&!Mozilla.inCaretMode()){var targetEl=YAHOO.util.Event.getTarget(evt);Util.Event.inTextInput(evt)||Util.Dom.isFormElement(targetEl)||"svg"!=targetEl.tagName&&(YUE.stopEvent(evt),"keydown"==evt.type&&page.scroll(evt.key))}});var lastRange=null;CM.onEntityEvent("keyevent",function(page,entity,evt){if(Mozilla.inCaretMode()&&("Up"==evt.key||"Down"==evt.key||"Left"==evt.key||"Right"==evt.key)){var range,selection=entity.getPage().getWin().getSelection();try{range=selection.getRangeAt(0)}catch(ex){return}if(range){var activeElement=entity.getActiveComponent(),startElement=range.startContainer,endElement=range.endContainer,outOfBounds=null==CM.getAncestor(startElement,[activeElement]);if(outOfBounds||(outOfBounds=null==CM.getAncestor(endElement,[activeElement])),outOfBounds){if(!lastRange)return;try{selection.collapseToStart(),selection.removeAllRanges(),selection.addRange(lastRange)}catch(ex){return}}else lastRange=range.cloneRange()}}})}(ContentManager),function(CM){function getLevelClass(level){if(LEVELS[level])return LEVELS[level].css}function getFactor(level){return LEVELS[level]?LEVELS[level].factor:-1}function parseLevelFromEl(el,defaultValue){return Util.Dom.isDocument(el)&&(el=el.body),hasAttribute(el,ZOOM_LEVEL)?1*el.getAttribute(ZOOM_LEVEL):"number"==typeof defaultValue?defaultValue:-1}function parseLevelFromClass(name,defaultValue){for(var i=0;i<LEVELS.length;i++)if(LEVELS[i].css==name)return i;return"number"==typeof defaultValue?defaultValue:-1}function hasAttribute(ele,attr){return ele.hasAttribute?ele.hasAttribute(attr):null!=ele.getAttribute(attr)}function removeClasses(el){LEVELS.forEach(function(level){$(el).removeClass(level.css)})}function getImages(parentEl){return parentEl?Util.Array.concat($("img",parentEl).toArray(),$("#wordListPanel").toArray()):[]}function getFlashObjects(parentEl){return parentEl?$("embed, object",parentEl).filter(function(idx,el){if("application/x-shockwave-flash"==el.type)return"OBJECT"!=el.nodeName||!el.data||-1==el.data.indexOf("jwplayer")}).map(function(idx,el){return"EMBED"==el.nodeName?el.parentNode:el}).toArray():[]}function getElements(parentEl){return Util.Array.concat(getImages(parentEl),getFlashObjects(parentEl))}function saveImageDimensions(image){image&&(hasAttribute(image,ORIG_HEIGHT)||image.width>0&&image.height>0&&(image.setAttribute(ORIG_WIDTH,image.width),image.setAttribute(ORIG_HEIGHT,image.height)))}function saveElementDimensions(el){if(el&&!hasAttribute(el,ORIG_HEIGHT)){var width,height;hasAttribute(el,"width")&&hasAttribute(el,"height")?(width=1*el.getAttribute("width"),height=1*el.getAttribute("height")):(width=$(el).width(),height=$(el).height()),width>0&&height>0&&(el.setAttribute(ORIG_WIDTH,width),el.setAttribute(ORIG_HEIGHT,height))}}function saveDimensions(parentEl){parentEl&&(getImages(parentEl).forEach(function(el){saveImageDimensions(el)}),getFlashObjects(parentEl).forEach(function(el){saveElementDimensions(el)}))}function styleElement(el,level){var className=getLevelClass(level);return!(!className||$(el).hasClass(className))&&(removeClasses(el),$(el).addClass(className),!0)}function zoomElement(el,level){if(!hasAttribute(el,ORIG_WIDTH))return!1;var factor=getFactor(level);if(!(factor>0))return!1;var zoomWidth=el.getAttribute(ORIG_WIDTH)*factor,zoomHeight=el.getAttribute(ORIG_HEIGHT)*factor;return"IMG"==el.nodeName?(el.width=zoomWidth,el.height=zoomHeight):($(el).css("width",zoomWidth+"px"),$(el).css("height",zoomHeight+"px")),!0}function zoomElements(parentEl,level){return parseLevelFromEl(parentEl)!==level&&(saveDimensions(parentEl),getElements(parentEl).forEach(function(el){zoomElement(el,level)}),parentEl.setAttribute(ZOOM_LEVEL,level),!0)}function Zoom(defaultZoomCSS){Util.Event.Emitter(this),this._zoomables=[],this.previousLevel=-1,this.defaultLevel=parseLevelFromClass(defaultZoomCSS,0),this.currentLevel=this.defaultLevel}var ORIG_WIDTH="data-width",ORIG_HEIGHT="data-height",ZOOM_LEVEL="data-zoom",LEVELS=[{css:"TDS_PS_L0",factor:1},{css:"TDS_PS_L1",factor:1.25},{css:"TDS_PS_L2",factor:1.5},{css:"TDS_PS_L3",factor:1.75},{css:"TDS_PS_L4",factor:2}];Zoom.prototype.getCSS=function(){return LEVELS[this.currentLevel].css},Zoom.prototype.getFactor=function(){return LEVELS[this.currentLevel].factor},Zoom.prototype.addDocument=function(doc,options){if(doc=doc||document,options=options||{},YAHOO.lang.augmentObject(options,{cleanClasses:!0,includeElements:!0}),this._zoomables.some(function(obj){return obj.document==doc}))return!1;options.cleanClasses&&removeClasses(doc);var obj={document:doc,options:options};return this._zoomables.push(obj),this._updateLevel(obj),!0},Zoom.prototype._updateLevel=function(obj){var level=this.currentLevel,el=obj.document.body;styleElement(el,level),obj.options.includeElements&&zoomElements(el,level)},Zoom.prototype.setLevel=function(level,force){if("string"==typeof level)level=parseLevelFromClass(level,0);else if("number"!=typeof level)return!1;return!(!force&&this.currentLevel===level)&&(this.previousLevel=this.currentLevel,this.currentLevel=level,this._zoomables.forEach(this._updateLevel.bind(this)),this.fire("change",level),!0)},Zoom.prototype.zoomIn=function(){return this.currentLevel<LEVELS.length-1&&this.setLevel(this.currentLevel+1)},Zoom.prototype.zoomOut=function(){return this.currentLevel>0&&this.setLevel(this.currentLevel-1)},Zoom.prototype.reset=function(force){this.setLevel(this.defaultLevel,force)},Zoom.prototype.refresh=function(){return this.setLevel(this.currentLevel,!0)},Zoom.prototype.updateElements=function(parentEl){zoomElements(parentEl,this.currentLevel)},Zoom.prototype.updateElement=function(el){zoomElement(el,this.currentLevel)},window.ContentZoom=Zoom}(window.ContentManager),function(CM){CM&&(CM.onPageEvent("beforeShow",function(page){page.updateElementsZoom()}),CM.onPageEvent("zoom",function(page,level){page==CM.getCurrentPage()&&(page.zoomLevel=level,page.updateElementsZoom())}))}(window.ContentManager),function(CM){function MenuCollection(){this._global=[],this._entity=[],this._component=[],this.cancel=!1}MenuCollection.prototype.getMenuItems=function(){return this._entity.length>0||this._component.length>0?Util.Array.concat(this._entity,this._component):this._global.length>0?this._global:[]},MenuCollection.prototype.addMenuItem=function(level,label,fn,disabled,checked,insert){var menuItem;if(YAHOO.lang.isString(label))menuItem={text:label};else{if(!YAHOO.lang.isObject(label))return;menuItem=label}if(YAHOO.lang.isFunction(fn))if(YAHOO.env.ua.gecko){menuItem.onclick={fn:function(){YAHOO.lang.later(0,this,fn)}}}else menuItem.onclick={fn:fn};YAHOO.lang.isBoolean(disabled)&&(menuItem.disabled=disabled),YAHOO.lang.isBoolean(checked)&&(menuItem.checked=checked);var collection=this["_"+level];collection&&(insert?collection.unshift(menuItem):collection.push(menuItem))},MenuCollection.prototype.insertMenuItem=function(level,label,fn,disabled,checked){this.addMenuItem(level,label,fn,disabled,checked,!0)};var menuInstance=null,MenuManager={};MenuManager.getInstance=function(){return menuInstance},MenuManager.init=function(){function checkFocusLeft(evt){var targetEl=YUE.getTarget(evt);YUD.hasClass(targetEl,"yuimenuitemlabel")||MenuManager.hide()}var menuId="menu_"+Math.random().toString().split(".")[1],contextMenu=new YAHOO.widget.ContextMenu(menuId,{zindex:1e3,iframe:!1,shadow:!1,usearia:!0});menuInstance=contextMenu,contextMenu.showEvent.subscribe(function(){setTimeout(function(){this.cfg.setProperty("clicktohide",!0),YUE.onFocus(document,checkFocusLeft)}.bind(this),500)}),contextMenu.beforeHideEvent.subscribe(function(){contextMenu.activeItem&&contextMenu.activeItem._oAnchor&&Util.Dom.blur(contextMenu.activeItem._oAnchor),document.activeElement&&YUD.hasClass(document.activeElement,"yuimenuitemlabel")&&Util.Dom.blur(document.activeElement),contextMenu.clearActiveItem()}),contextMenu.hideEvent.subscribe(function(){this.cfg.setProperty("clicktohide",!1),YUE.removeFocusListener(document,checkFocusLeft)}),MenuManager.applyTextSelectionFix(contextMenu),Util.Browser.isOnlyTouchDevice()&&(menuInstance.setInitialFocus=function(){},menuInstance.setInitialSelection=function(){}),new YAHOO.util.KeyListener(contextMenu.element,{keys:[32,13]},{fn:function(evt,args){YUE.stopEvent(args[1]),menuInstance.activeItem&&(menuInstance.activeItem.clickEvent.fire(evt),menuInstance.hide())}}).enable()},MenuManager.isShowing=function(){return menuInstance&&menuInstance.cfg.getProperty("visible")},MenuManager.show=function(opts){opts=opts||{},YAHOO.lang.augmentObject(opts,{custom:[],xy:null,location:"top",target:null,evt:null,entity:null,component:null});var menuItems=opts.custom;if(!menuInstance)return!1;if(MenuManager.hide())return!1;if(0==menuItems.length&&CM.isReadOnly())return!1;var entity=opts.entity;if(!entity){var page=CM.getCurrentPage();page&&(entity=page.getActiveEntity())}var component=opts.component;!component&&entity&&(component=entity.getActiveComponent());var targetEl=opts.target,domEvent=opts.evt,menuXY=opts.xy;if(!menuXY){var fromElement=null;if(targetEl?fromElement=targetEl:component&&component.getXY?menuXY=component.getXY():domEvent&&!domEvent.keyCode?menuXY=CM.getEventXY(domEvent):Util.Dom.isElement(component)?fromElement=component:entity&&(fromElement=entity.getElement()),fromElement&&(menuXY=YUD.getXY(fromElement),"bottom"==opts.location)){var region=YUD.getRegion(fromElement);menuXY[1]+=region.height}}if(0==menuItems.length){var contentMenu=new MenuCollection,selection=CM.getSelection(document);if(entity.fire("menushow",contentMenu,domEvent,selection),contentMenu.cancel)return!1;menuItems=contentMenu.getMenuItems()}0==menuItems.length&&menuItems.push({text:Messages.getAlt("TDSContentEventsJS.Label.EmptyMenu","Empty"),disabled:!CM.isAccessibilityEnabled()}),menuInstance.clearContent(),menuInstance.contextEventTarget=targetEl,menuInstance.cfg.setProperty("xy",menuXY),menuInstance.addItems(menuItems);var menuContainer=CM.isAccessibilityEnabled()&&entity&&entity.getToolsElement()||document.body;return menuInstance.render(menuContainer),menuInstance.show(),!0},MenuManager.hide=function(){return!(!menuInstance||!MenuManager.isShowing())&&(menuInstance.hide(),!0)},MenuManager.applyDocFix=function(contentDoc){if(document!=contentDoc){new YAHOO.widget.Menu("preload");var docListeners=YAHOO.util.Event.getListeners(document);if(null!=docListeners)for(var focusBlurAssigned=!1,i=0;i<docListeners.length;i++){var listener=docListeners[i];listener.obj==YAHOO.widget.MenuManager&&(YUE.on(contentDoc,listener.type,listener.fn,YAHOO.widget.MenuManager,!0),focusBlurAssigned||(YUE.onFocus(contentDoc,listener.fn,YAHOO.widget.MenuManager,!0),YUE.onBlur(contentDoc,listener.fn,YAHOO.widget.MenuManager,!0),focusBlurAssigned=!0))}}},MenuManager.applyTextSelectionFix=function(contextMenu){if(!YAHOO.env.ua.ie){var makeSelection=function(rangeData){var range=document.createRange();if(range){range.setStart(rangeData.anchorNode,rangeData.anchorOffset),range.setEnd(rangeData.focusNode,rangeData.focusOffset);var selection=window.getSelection();selection&&(selection.removeAllRanges?selection.removeAllRanges():selection.empty&&selection.empty(),selection.addRange(range))}},onFocus=function(type,args,rangeData){this.unsubscribe("focus",onFocus),setTimeout(function(){try{makeSelection(rangeData)}catch(ex){}},0)};contextMenu.subscribe("beforeShow",function(){var rangeData,selection=window.getSelection();selection&&!selection.isCollapsed&&(rangeData={anchorNode:selection.anchorNode,anchorOffset:selection.anchorOffset,focusNode:selection.focusNode,focusOffset:selection.focusOffset},this.subscribe("focus",onFocus,rangeData))})}},MenuManager.isContextEvent=function(evt){return"btnContext"==(evt.currentTarget||YUE.getTarget(evt)).id||("contextmenu"==evt.type||"mousedown"==evt.type&&2==evt.button||"keydown"==evt.type&&evt.ctrlKey&&77==evt.keyCode)},CM.Menu=MenuManager,CM.Menu.Collection=MenuCollection}(window.ContentManager),function(CM){function update(){if(null!=currentFrame&&2==currentFrame.loadState){Util.Dom.copyCSSFrame(currentFrame);var frameWin=currentFrame.getWindow();frameWin&&setTimeout(function(){CM.focus(frameWin)},0)}}function load(id,bankKey,itemKey){var frame=YUD.get(id);if(null!=frame)return frame;if(null==Dialog.urlFrame)throw new Error("There is no url defined for content dialog frame.");var accProps=Accommodations.Manager.getDefaultProps(),lang=accProps?accProps.getLanguage():"ENU",url=Dialog.urlFrame;url+="?language="+lang,url+="&bankKey="+bankKey,url+="&itemKey="+itemKey;var dialogsEl=YUD.get("dialogContentFrames");return null==dialogsEl&&((dialogsEl=document.createElement("div")).id="dialogContentFrames",document.body.appendChild(dialogsEl)),(frame=Util.Frame.create(id,dialogsEl)).load(url),frame.onLoaded.subscribe(function(){var frameWin=frame.getWindow(),frameDoc=frame.getDocument();"object"==typeof KeyManager&&KeyManager.attachListener(YAHOO.env.ua.gecko?frameWin:frameDoc),update(),Dialog.onLoad.fire(frame),Util.Browser.isChromeOS()&&$(Util.Frame.getFrames(frame)).each(function(){$(this).contents().on("contextmenu",function(){return!1})})}),frame}var currentFrame=null,Dialog={urlFrame:null,onBeforeShow:new Util.Event.Custom,onShow:new Util.Event.Custom,onBeforeHide:new Util.Event.Custom,onHide:new Util.Event.Custom,onLoad:new Util.Event.Custom};Dialog.show=function(id,bankKey,itemKey){if(TDS.Audio.isActive())window.TestShell&&TestShell.UI.showWarning(ErrorCodes.get("NavigateAudioPlaying"));else{TTS.getInstance().isPlaying()&&TTS.getInstance().stop(),CM.Menu.hide();var frame=load(id,bankKey,itemKey);Dialog.onBeforeShow.fire(frame),frame.show(),YUD.addClass("dialogContent","enable"),YUE.addListener("dialogContentClose","click",Dialog.hide),currentFrame=frame,update(),Dialog.onShow.fire(frame)}},Dialog.hide=function(){null!=currentFrame&&(Dialog.onBeforeHide.fire(currentFrame),currentFrame.hide(),YUD.removeClass("dialogContent","enable"),YUE.purgeElement("dialogContentClose"),Dialog.onHide.fire(currentFrame),currentFrame=null,Util.Dom.focusWindow(2))},Dialog.isShowing=function(){return YUD.hasClass("dialogContent","enable")},Dialog.containsElement=function(el){return!!(currentFrame&&el&&el.ownerDocument)&&currentFrame.getDocument()==el.ownerDocument},Dialog.onLoad.subscribe(function(frame){frame.getWindow();var frameDoc=frame.getDocument();if(-1!=frame.id.indexOf("gtr",0)){var container=frameDoc.getElementById("pageLayout");YUE.delegate(container,"click",function(ev,li,container){YUD.toggleClass(li,"checked")},"li")}}),CM.Dialog=Dialog,window.DialogContent=Dialog}(ContentManager),function(CM){var pages=CM.createPages("contents");CM.createPage=function(content){return pages.create(content)},CM.getPage=function(id){return pages.get(id)},CM.getPages=function(){return pages.list()},CM.getCurrentPage=function(){return pages.getCurrent()},CM.getCurrentEntity=function(){var page=CM.getCurrentPage();return page?page.getActiveEntity():null},CM.removePage=function(page){return pages.remove(page)},CM.enableCaretMode=function(enable){if(Mozilla.enableCaretMode(enable)){var page=pages.getCurrent();if(page){var entity=page.getActiveEntity();entity&&entity.resetCaretPosition()}}},CM.resetActiveComponent=function(){var page=pages.getCurrent();if(page){var entity=page.getActiveEntity();entity instanceof ContentItem&&entity.resetComponent()}},CM.requestNextPage=function(verify){var page=CM.getCurrentPage();return!page||CM.fire("requestNextPage",page,verify)},CM.requestPreviousPage=function(verify){var page=CM.getCurrentPage();return!page||CM.fire("requestPreviousPage",page,verify)},CM.setItemCompleted=function(item){if(item){CM.fireEntityEvent("completed",item);var page=item.getPage();CM.firePageEvent("completed",page)}}}(ContentManager),ContentPage.prototype.addResourceLoader=function(resource){this._renderer.addResourceLoader(resource)},ContentManager.Modes=function(CM){function Mode(entity){this.entity=entity}function createInstance(cls,entity){var instance=new cls(entity);return cls.superclass.constructor.call(instance,entity),instance}function onSelect(mode,el,evt){YUE.stopEvent(evt),mode.select(el,evt)}function addListeners(mode,elements){return elements.map(function(element){return Util.Event.addTouchMouse("start",element,onSelect.bind(null,mode,element))})}function disableMode(){return!!current&&(console.log("mode disabled: "+current.name),$(document.body).removeClass("modeEnabled"),$(current.entity.getElement()).removeClass("mode-"+current.name),current.listeners.forEach(function(listener){listener.destroy()}),mouseListener&&(mouseListener.destroy(),mouseListener=null),keyListener.disable(),current.mode.dispose(),current=null,setTimeout(function(){CM.setReadOnly(!1)},250),!0)}Mode.prototype.select=function(){},Mode.prototype.enable=function(){},Mode.prototype.canDisable=function(entity,evt){return!0},Mode.prototype.dispose=function(){};var mouseListener,Modes={},lookup=new Util.Structs.Map,current=null,keyListener=new YAHOO.util.KeyListener(document,{keys:27},{fn:disableMode});return Util.Event.Emitter(Modes),$.extend(Modes,{register:function(name,cls){"object"==typeof cls.superclass&&"function"==typeof cls.superclass.constructor||YAHOO.lang.extend(cls,Mode),lookup.set(name,cls)},isEnabled:function(){return null!=current},enable:function(name,entity){disableMode(),entity=entity||CM.getCurrentEntity();var cls=lookup.get(name);if(!entity||!cls)return null;var mode=createInstance(cls,entity),elements=mode.enable();if(!elements||!elements.length)return null;console.log("mode enabled: "+name),CM.setReadOnly(!0);var listeners=addListeners(mode,elements);return current={name:name,entity:entity,mode:mode,listeners:listeners},mouseListener=Util.Event.addTouchMouse("start",document.body,function(evt){current.mode.canDisable(current.entity,evt)&&(YUE.stopEvent(evt),disableMode())}),keyListener.enable(),$(document.body).addClass("modeEnabled"),$(entity.getElement()).addClass("mode-"+name),Modes.fire("enabled",name,mode),mode},disable:disableMode}),CM.onEntityEvent("hide",function(){disableMode()}),Modes}(window.ContentManager),ContentManager.onItemEvent("menushow",function(page,item,menu,evt){if(item&&TDS.getAccommodationProperties().hasASL()){var menuType="entity",optionGroup=item.MC,subType="STEM";if(optionGroup){var focusedOption=optionGroup.getFocusedOption();focusedOption&&(menuType="component",subType="Option "+focusedOption.key)}AslModule.addEntityToMenu(item,subType,menu,menuType)}}),ContentManager.onPassageEvent("menushow",function(page,item,menu,evt){if(TDS.getAccommodationProperties().hasASL()){AslModule.addEntityToMenu(item,null,menu,"entity")}}),AslModule={},AslModule.addEntityToMenu=function(entity,subtype,menu,menuType){entity.hasAslAttachments(subtype)&&function(messageKey,menuClass,menuFunc){var menuItem={text:Messages.get(messageKey),classname:menuClass,onclick:{fn:menuFunc}};menu.addMenuItem(menuType,menuItem)}("TDSContentEventJS.Label.ASLItem","ASL",function(){var link=entity.getAslAttachments()[0].url;AslModule.showImageDialog(link,entity.getPage().getZoomFactor())})},AslModule.showImageDialog=function(url,zoomFactor){var anchor=document.createElement("a");anchor.href=url,VideoManager.openDialog(null,anchor,zoomFactor)},ContentEntity.prototype.getAslAttachments=function(st){var rv=[];return Util.Array.each(this.attachments,function(att){att.type&&"ASL"==att.type&&(null!=st&&0!=st.length&&null!=att.subType&&st!=att.subType||rv.push(att))}),rv},ContentEntity.prototype.hasAslAttachments=function(st){return 0!=this.getAslAttachments(st).length},function(CM){function Plugin_Styles(page,entity,config){}ContentManager.registerEntityPlugin("styles",Plugin_Styles,function(page,entity,content){return entity instanceof ContentPassage}),Plugin_Styles.prototype.load=function(){var pageEl=this.page.getElement(),entity=this.entity;entity.on("show",function(){pageEl.classList.add("passageShowing")}),entity.on("hide",function(){pageEl.classList.remove("passageShowing")})}}(),function(CM){function Plugin_FakePass(page,config){}ContentManager.registerPagePlugin("fakepassage",Plugin_FakePass,function(page,content){var passage=page.getPassage(),pageEl=page.getElement(),passageEl=Util.Dom.getElementByClassName("thePassage","div",pageEl);return!passage&&passageEl}),Plugin_FakePass.prototype.load=function(){var page=this.page,firstItem=page.getItems()[0],passage=ContentManager.createPassage(page,{bankKey:firstItem.bankKey,itemKey:0});page.setPassage(passage)}}(),function(CM){function Plugin_PTools(page,entity,el){this.el=el}window.ContentManager.registerEntityPlugin("passage.tools",Plugin_PTools,function(page,entity,content){if(entity instanceof ContentPassage){var passageEl=entity.getElement();if(passageEl){if(entity.getToolsElement())return!1;var paddingEl=Util.Dom.getElementByClassName("padding","div",passageEl);if(paddingEl)return paddingEl}}return!1}),Plugin_PTools.prototype.load=function(){var passageEl=this.entity.getElement(),toolsEl=$(".passageTools",passageEl).get(0);toolsEl||((toolsEl=document.createElement("div")).className="toolsContainer passageTools",$(passageEl).prepend(toolsEl))}}(),function(CM){function Plugin_Menu(page,entity,el){this.el=el}CM.registerEntityPlugin("passage.menu",Plugin_Menu,function(page,entity,content){return entity instanceof ContentPassage&&page.getAccProps().showItemToolsMenu()}),Plugin_Menu.prototype.load=function(){var entity=this.entity;entity.addToolElement({classname:"passageMenu",text:Messages.getAlt("TDSContentEventsJS.Label.ContextMenu","Menu"),stopEvent:!0,hasPopup:!0,delay:!0,fn:function(menuEl,evt){CM.Menu.show({entity:entity,evt:evt,target:menuEl,location:"bottom"})}})}}(window.ContentManager),function(CM){function Plugin_Expand(page,config){}CM.registerEntityPlugin("passage.expandable",Plugin_Expand,function(page,entity){if(entity instanceof ContentPassage&&page.getPassage()){var accProps=page.getAccommodationProperties();if(accProps&&accProps.showExpandablePassages())return!0}return!1}),Plugin_Expand.prototype.load=function(){var page=this.page,pageEl=page.getElement(),passage=page.getPassage();if(null!=passage.getElement()){YUD.addClass(pageEl,"passage-collapsed");var expandLink=document.createElement("a");YUD.setAttribute(expandLink,"href","#"),YUD.setAttribute(expandLink,"role","button"),YUD.addClass(expandLink,"toolButton"),YUD.addClass(expandLink,"expand-collapse-passage");YUE.on(expandLink,"click",function(clickEv){YUE.stopEvent(clickEv),$(pageEl).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){CM.fireEntityEvent("passageExpandCollapse",passage)}),YUD.hasClass(pageEl,"passage-expanded")?(YUD.removeClass(pageEl,"passage-expanded"),YUD.addClass(pageEl,"passage-collapsed")):YUD.hasClass(pageEl,"passage-collapsed")&&(YUD.removeClass(pageEl,"passage-collapsed"),YUD.addClass(pageEl,"passage-expanded"))});var toolsEl=passage.getToolsElement();toolsEl&&toolsEl.appendChild(expandLink)}}}(ContentManager),function(CM){function Plugin_Print(){}window.ContentManager.registerEntityPlugin("passage.print",Plugin_Print,function(page,entity){if("function"!=typeof window.tdsPassagePrint)return!1;if(YUD.hasClass(document.body,"unproctored"))return!1;if(entity instanceof ContentPassage){var accProps=page.getAccProps();return accProps.hasPrintStimulus()||accProps.hasEmbossStimulus()}return!1}),Plugin_Print.prototype.send=function(){var item=this.entity;console.log("Passage Tool: Print",item),"function"==typeof window.tdsPassagePrint&&window.tdsPassagePrint()},Plugin_Print.prototype.load=function(){if(!this.page.getAccProps().showItemToolsMenu()){this.element=this.entity.addToolElement({classname:"printPassage",text:Messages.get("TDSContentEventsJS.Label.PrintPassage"),fn:this.send.bind(this)})}},Plugin_Print.prototype.showMenu=function(menu,evt){var menuItem={text:Messages.get("TDSContentEventsJS.Label.PrintPassage"),classname:"printPassage",onclick:{fn:this.send.bind(this)}};menu.addMenuItem("entity",menuItem)}}(),function(CM){function Plugin_ITools(page,entity,el){this.el=el}window.ContentManager.registerEntityPlugin("item.tools",Plugin_ITools,function(page,entity,content){return entity instanceof ContentItem}),Plugin_ITools.prototype.load=function(){var item=this.entity,itemEl=item.getElement(),commentBoxEl=document.getElementById("Item_CommentBox_"+item.position);$(commentBoxEl).remove();var toolsEl=$(".itemTools",itemEl).get(0);if(!toolsEl){var markCommentEl=$(".markComment",itemEl).get(0);markCommentEl&&((toolsEl=document.createElement("div")).className="toolsContainer itemTools markComment",$(markCommentEl).after(toolsEl),$(markCommentEl).remove())}}}(),function(CM){function Plugin_Menu(page,entity,el){this.el=el}CM.registerEntityPlugin("item.menu",Plugin_Menu,function(page,entity,content){return entity instanceof ContentItem&&page.getAccProps().showItemToolsMenu()}),Plugin_Menu.prototype.load=function(){var entity=this.entity;entity.addToolElement({classname:"itemMenu",text:Messages.getAlt("TDSContentEventsJS.Label.ContextMenu","Menu"),stopEvent:!0,hasPopup:!0,delay:!0,fn:function(menuEl,evt){CM.Menu.show({entity:entity,evt:evt,target:menuEl,location:"bottom"})}})}}(window.ContentManager),function(CM){function Plugin_Tut(page,entity,tutorial){}window.ContentManager.registerEntityPlugin("item.tutorial",Plugin_Tut,function(page,entity,content){return!!(entity instanceof ContentItem&&content.tutorial&&page.getAccProps().hasTutorial())&&content.tutorial}),Plugin_Tut.prototype.open=function(){var item=this.entity;console.log("Item Tool: Tutorial",this.config,item),"function"==typeof window.tdsItemResource&&window.tdsItemResource("help",item.tutorial.bankKey,item.tutorial.itemKey)},Plugin_Tut.prototype.load=function(){if(!this.page.getAccProps().showItemToolsMenu()){this.entity.addToolElement({classname:"contexthelp",text:Messages.get("TDSContentEventsJS.Label.HelpItem"),fn:this.open.bind(this)})}},Plugin_Tut.prototype.showMenu=function(menu,evt){menu.addMenuItem("entity",{text:Messages.get("TDSContentEventsJS.Label.HelpItem"),classname:"helpItem",hasPopup:!0,onclick:{fn:this.open.bind(this)}})}}(),function(CM){function Plugin_Print(page,entity){this.element=null}window.ContentManager.registerEntityPlugin("item.print",Plugin_Print,function(page,entity,content){if(entity instanceof ContentItem){var accProps=page.getAccProps();return accProps.hasPrintItem()||accProps.hasEmbossItem()}return!1}),Plugin_Print.prototype.send=function(){var item=this.entity;console.log("Item Tool: Print",item),"function"==typeof window.tdsItemPrint&&window.tdsItemPrint(item.position)},Plugin_Print.prototype.load=function(){if(!this.page.getAccProps().showItemToolsMenu()){this.element=this.entity.addToolElement({classname:"printItem",text:Messages.get("TDSContentEventsJS.Label.PrintItem"),fn:this.send.bind(this)})}},Plugin_Print.prototype.showMenu=function(menu,evt){menu.addMenuItem("entity",{text:Messages.get("TDSContentEventsJS.Label.PrintItem"),classname:"printItem",onclick:{fn:this.send.bind(this)}})},Plugin_Print.prototype.dispose=function(){this.element&&($(this.element).remove(),this.element=null)}}(),function(CM){function Plugin_GTR(page,entity,config){}window.ContentManager.registerEntityPlugin("item.gtr",Plugin_GTR,function(page,entity,content){if(entity instanceof ContentItem){var gtr=content.resources.guideToRevision;if(gtr&&page.getAccProps().hasGuideForRevision())return gtr}return!1}),Plugin_GTR.prototype.open=function(){var item=this.entity;console.log("Item Tool: GTR",this.config,item),"function"==typeof window.tdsItemResource&&window.tdsItemResource("gtr_"+item.position,item.gtr.bankKey,item.gtr.itemKey)},Plugin_GTR.prototype.load=function(){if(!this.page.getAccProps().showItemToolsMenu()){this.entity.addToolElement({classname:"guideToRevision",text:Messages.get("TDSContentEventsJS.Label.GTRItem"),hasPopup:!0,fn:this.open.bind(this)})}},Plugin_GTR.prototype.showMenu=function(menu,evt){menu.addMenuItem("entity",{text:Messages.get("TDSContentEventsJS.Label.GTRItem"),classname:"gtrItem",onclick:{fn:this.open.bind(this)}})}}(),function(CM){function Plugin_IC(page,entity){}CM.registerEntityPlugin("item.comment",Plugin_IC,function(page,entity,content){return entity instanceof ContentItem&&page.getAccProps().hasStudentComments()}),Plugin_IC.prototype.toggle=function(){var item=this.entity;console.log("Item Tool: Comment",item),CM.fireEntityEvent("comment",item)},Plugin_IC.prototype.load=function(){if(!this.page.getAccProps().showItemToolsMenu()){var messageLabel=CM.getCommentLabel();this.entity.addToolElement({classname:"commentItem",text:Messages.get(messageLabel),fn:this.toggle.bind(this)})}},Plugin_IC.prototype.showMenu=function(menu,evt){var messageLabel=CM.getCommentLabel();menu.addMenuItem("entity",{text:Messages.get(messageLabel),classname:"comment Notepad",onclick:{fn:this.toggle.bind(this)}})}}(window.ContentManager),function(CM){function Plugin_Mark(page,entity,config){this.marked=config.marked}window.ContentManager.registerEntityPlugin("item.mark",Plugin_Mark,function(page,entity,content){return!!(entity instanceof ContentItem&&page.getAccProps().hasMarkForReview())&&{marked:content.marked}}),Plugin_Mark.prototype.update=function(){var item=this.entity,itemEl=item.getElement();this.marked?YUD.addClass(itemEl,"itemMarked"):YUD.removeClass(itemEl,"itemMarked");var markLinkEl=item.getToolElement("markReview");markLinkEl&&(this.marked?(YUD.addClass(markLinkEl,"markReviewMarked"),markLinkEl.setAttribute("aria-checked","true")):(YUD.removeClass(markLinkEl,"markReviewMarked"),markLinkEl.setAttribute("aria-checked","false")))},Plugin_Mark.prototype.toggle=function(){this.marked=!this.marked,this.update();var item=this.entity;console.log("Item Tool: Mark",this.marked,item),"function"==typeof window.tdsUpdateItemMark&&window.tdsUpdateItemMark(item.position,this.marked)},Plugin_Mark.prototype.load=function(){if(this.update(),!this.page.getAccProps().showItemToolsMenu()){this.entity.addToolElement({classname:"markReview",text:Messages.get("TDSContentEventsJS.Label.MarkForReview"),fn:this.toggle.bind(this)})}},Plugin_Mark.prototype.showMenu=function(menu,evt){var messageKey=this.marked?"TDSContentEventsJS.Label.UnmarkForReview":"TDSContentEventsJS.Label.MarkForReview";menu.addMenuItem("entity",{text:Messages.get(messageKey),classname:"markReview",onclick:{fn:this.toggle.bind(this)}})}}(),function(CM){function Plugin_GTR(page,entity){}window.ContentManager.registerEntityPlugin("item.reset",Plugin_GTR,function(page,entity,content){return entity instanceof ContentItem&&page.getAccProps().hasResponseReset()}),Plugin_GTR.prototype.send=function(){var item=this.entity;console.log("Item Tool: Reset",item),"function"==typeof window.tdsRemoveResponse&&window.tdsRemoveResponse(item.position)},Plugin_GTR.prototype.load=function(){if(!this.page.getAccProps().showItemToolsMenu()){this.entity.addToolElement({classname:"removeResponse",text:Messages.get("TDSContentEventsJS.Label.ResetItem"),fn:this.send.bind(this)})}},Plugin_GTR.prototype.showMenu=function(menu,evt){menu.addMenuItem("entity",{text:Messages.get("TDSContentEventsJS.Label.ResetItem"),classname:"resetItem",onclick:{fn:this.send.bind(this)}})}}(),function(CM){function Widget_Ins(page,item){}CM.registerWidget("instructional",Widget_Ins,function(page,item){var id="Item_Instruction_"+item.position;return("INS"==item.format||"Generic Instruction"==item.format)&&new CM.WidgetConfig(id,item.getElement())}),Widget_Ins.prototype.isResponseAvailable=function(){return!0},Widget_Ins.prototype.getResponse=function(){return this.createResponse("",!0,!1,!0)}}(window.ContentManager),function(CM){function getTabEl(item){return document.getElementById("itemTab-"+item.position)}function createTabEl(item){var itemTabEl=document.createElement("li");itemTabEl.setAttribute("id","itemTab-"+item.position);var itemLinkEl=document.createElement("a");itemLinkEl.setAttribute("href","#"),itemLinkEl.setAttribute("tabindex","0");var tabData={item:item};return $(itemLinkEl).on("click",tabData,onTabClick),$(itemLinkEl).text(item.getQuestionLabel()),itemTabEl.appendChild(itemLinkEl),itemTabEl}function createWidgetEl(items){var containerEl=document.createElement("ul");return containerEl.className=CSS_WIDGET,items.forEach(function(item){var itemTabEl=createTabEl(item);containerEl.appendChild(itemTabEl)}),containerEl}function onTabClick(evt){evt.data.item.setActive()}function updateItemAnswered(item){var tabEl=getTabEl(item),response=item.getResponse();response&&response.isValid?YUD.addClass(tabEl,CSS_ITEMANSWERED):YUD.removeClass(tabEl,CSS_ITEMANSWERED)}function allowPagination(page){if(ContentManager.isAccessibilityEnabled())return!1;if(page.getCompoundElement())return!1;var passage=page.getPassage(),items=page.getItems();if(null==passage||items.length<2)return!1;var accProps=page.getAccommodationProperties();return!(null==accProps||!accProps.isPaginatedItemGroupsEnabled())}function Plugin_Paginate(page){this.delay=!0,this.lastTab=null}function requestPage(direction,page,verify){if(!page)return!0;var pagination=page.plugins.get("pagination");if(!pagination)return!0;var tabableItems=pagination.getTabableItems(),iterator=Util.Iterator(tabableItems,{limits:!0,pit:!0}),currentItem=Util.Array.find(tabableItems,function(item){return item.isShowing()});iterator.jumpTo(currentItem);var nextItem="next"==direction?iterator.next():iterator.prev();if(nextItem){if(verify)return!1;if(nextItem.setActive())return!1}return!0}var CSS_WIDGET="multi-page",CSS_ITEMANSWERED="page-answered";CM.registerPagePlugin("pagination",Plugin_Paginate,function(page){return allowPagination(page)}),Plugin_Paginate.prototype.getTabableItems=function(){var page=this.page,items=page.getItems();return"28"!=page.layout&&"29"!=page.layout||(items=items.filter(function(item){return"SIM"!=item.format.toUpperCase()})),items},Plugin_Paginate.prototype.showItem=function(item){item.show();var tabEl=getTabEl(item);YUD.addClass(tabEl,"page-active");var scrollEl=this.page.getScrollableElement();scrollEl&&(scrollEl.scrollTop=0,scrollEl.scrollLeft=0)},Plugin_Paginate.prototype.hideItem=function(item){item.hide();var tabEl=getTabEl(item);YUD.removeClass(tabEl,"page-active"),updateItemAnswered(item)},Plugin_Paginate.prototype.onFocusItem=function(focusItem){var tabableItems=this.getTabableItems();-1!=tabableItems.indexOf(focusItem)&&tabableItems.forEach(function(item){item==focusItem?this.showItem(item):this.hideItem(item)}.bind(this))},Plugin_Paginate.prototype.load=function(){var page=this.page,tabableItems=this.getTabableItems(),widgetEl=createWidgetEl(tabableItems);$(page.getPassage().getElement()).parent().prepend(widgetEl),tabableItems.forEach(function(item){item.on("focus",this.onFocusItem.bind(this,item))}.bind(this))},Plugin_Paginate.prototype.getEntitiesToShow=function(){var entities=this.page.getEntities(),tabableItems=this.getTabableItems();return entities.filter(function(entity){return!(entity instanceof ContentPassage&&entity.isEmpty())&&-1==tabableItems.indexOf(entity)})},Plugin_Paginate.prototype.getEntityForFocus=function(){var page=this.page,tabableItems=this.getTabableItems(),lastActive=page.getLastActive();return-1!=tabableItems.indexOf(lastActive)?lastActive:tabableItems[0]},CM.on("requestNextPage",requestPage.bind(null,"next")),CM.on("requestPreviousPage",requestPage.bind(null,"back"))}(ContentManager),function(CM){function Plugin_Comp(page,entity,config){}ContentManager.registerEntityPlugin("components",Plugin_Comp,function(page,entity,content){return!0}),Plugin_Comp.prototype.findPassageComponents=function(passage){var passageEl=passage.getElement();null!=passageEl&&passage.addComponent(passageEl)},Plugin_Comp.prototype.findItemComponents=function(item){var itemEl=item.getElement();item.addComponent(itemEl)},Plugin_Comp.prototype.load=function(){var entity=this.entity;entity instanceof ContentItem?this.findItemComponents(entity):entity instanceof ContentPassage&&this.findPassageComponents(entity),entity.on("focusComponent",function(component){ContentManager.isElement(component)&&YUD.addClass(component,"contextAreaFocus")}),entity.on("blurComponent",function(component){ContentManager.isElement(component)&&YUD.removeClass(component,"contextAreaFocus"),ContentManager.enableCaretMode(!1)})}}(),function(CM){function Plugin_Accs(page,config){}ContentManager.registerPagePlugin("accommodations",Plugin_Accs,function(page,content){return null!=page.getAccommodations()}),Plugin_Accs.prototype.beforeShow=function(){var page=this.page,pageAccs=page.getAccommodations();Accommodations.Manager.updateCSS(page.getBody(),pageAccs.getId())}}(),function(rangy,CM){function getSelfOrAncestorWithClass(node,cssClass){for(;node;){if(YUD.hasClass(node,cssClass))return node;node=node.parentNode}return null}function checkMathML(node){return!!/mfrac|msup|mfenced|msqrt|msubsup|msub|mover|munder|msubsup|mlongdiv|munderover|mroot/.test(node)}function createCSSClassApplier(){var cssClassApplier=rangy.createClassApplier(CSS_HIGHLIGHT,{ignoreWhiteSpace:!0,useExistingElements:!1,removeEmptyElements:!1,tagNames:["span"]});return cssClassApplier.isModifiable=function(textNode){return null==getSelfOrAncestorWithClass(textNode.parentNode,"no-highlight")&&!checkMathML(textNode.parentNode.nodeName)},cssClassApplier}function getCSSClassApplier(){return globalClassApplier||(globalClassApplier=createCSSClassApplier()),globalClassApplier}function hasSelection(selection){if(selection&&"function"==typeof selection.toString){var text=selection.toString();return(text=YAHOO.lang.trim(text)).length>0}return!1}function Plugin_High(page,entity,config){this.highlighter=rangy.createHighlighter(),this.highlighter.addClassApplier(getCSSClassApplier())}var CSS_HIGHLIGHT="highlight";if(rangy){rangy.config&&(rangy.config.alertOnFail=!1,rangy.config.alertOnWarn=!1);var globalClassApplier;CM.registerEntityPlugin("highlighter",Plugin_High,function(page,entity){var accProps=page.getAccommodationProperties();return accProps&&accProps.hasHighlighting()}),Plugin_High.prototype.highlightSelection=function(selection){var pageEl=this.page.getElement();this.highlighter.highlightSelection("highlight",{selection:selection,containerElementId:pageEl.id}),Util.Browser.isMobile()||selection.collapseToStart()},Plugin_High.prototype.removeAllHighlights=function(){this.highlighter.removeAllHighlights()},Plugin_High.prototype.reload=function(){var serialized=this.highlighter.serialize();console.log(serialized),this.removeAllHighlights(),this.highlighter.deserialize(serialized)},Plugin_High.prototype.showMenu=function(menu,evt,selection){if(!TTS.Singleton||!TTS.Singleton.isPlaying()){var self=this,highlighter=this.highlighter;if(hasSelection(selection)){var lblHighlightText=CM.getLabel("HIGHLIGHT_TEXT");menu.addMenuItem("entity",lblHighlightText,function(){self.highlightSelection(selection),CM.enableCaretMode(!1)})}var selectedHighlights=highlighter.getHighlightsInSelection(selection);if(0==selectedHighlights.length){var targetEl=YUE.getTarget(evt);if(targetEl&&targetEl.firstChild){var targetHighlight=highlighter.getHighlightForElement(targetEl);targetHighlight&&selectedHighlights.push(targetHighlight)}}if(selectedHighlights&&selectedHighlights.length){var lblHighlightRemove=Messages.getAlt("TDSContentJS.Label.RemoveHighlight","Remove Highlight");menu.addMenuItem("entity",{classname:"highlightremove",text:lblHighlightRemove},function(){highlighter.removeHighlights(selectedHighlights)})}if(highlighter.highlights.length>0){var lblHighlightClr=CM.getLabel("HIGHLIGHT_CLEAR");menu.addMenuItem("entity",lblHighlightClr,function(){self.removeAllHighlights()})}}}}}(window.rangy,window.ContentManager),function(CM){function Plugin(page){}window.ContentManager.registerPagePlugin("attachments",Plugin,function(page){var pageEl=page.getElement(),attachments=Util.Dom.getElementsByTagName("a",pageEl).filter(function(linkEl){return-1!=".pdf .rtf".indexOf(linkEl.href)});return attachments.length>0?attachments:null}),Plugin.prototype.init=function(links){links.forEach(function(linkEl){linkEl.target="_blank"})}}(),function(CM){var getMediaResources=function(content){if(content.media)return content.media;var mediaResources=[];if(content.passage&&content.passage.media&&(mediaResources=Util.Array.concat(mediaResources,content.passage.media)),content.items)for(var i=0;i<content.items.length;i++){var item=content.items[i];item.media&&(mediaResources=Util.Array.concat(mediaResources,item.media))}return mediaResources},findMediaResource=function(content,url){for(var mediaResources=getMediaResources(content),i=0;i<mediaResources.length;i++){var mediaResource=mediaResources[i];if(-1!=url.indexOf(mediaResource.file))return mediaResource}return null},cleanXml=function(xmlStr){return xmlStr=xmlStr.replace('<?xml version="1.0" encoding="UTF-8"?>',"")},cleanMathML=function(mathMLStr){return mathMLStr=mathMLStr.replace('<!DOCTYPE math:math PUBLIC "-//OpenOffice.org//DTD Modified W3C MathML 1.01//EN" "math.dtd">',""),mathMLStr=mathMLStr.replace(/math:/g,""),mathMLStr=mathMLStr.replace(/:math/g,"")},isMathMLSymbol=function(text){if(text){var code=text.charCodeAt(0);if(code>=160&&code<=255)return!0;if(code>=8592&&code<=8703)return!0;if(code>=8960&&code<=9215)return!0;if(code>=8226&&code<=8959)return!0;if(code>=9632&&code<=9727)return!0;if(code>=913&&code<=969)return!0}return!1},processMathML=function(mathMLDoc){Util.Dom.querySelectorBatch("mi, mo",mathMLDoc,function(el){var text=Util.Dom.getTextContent(el);isMathMLSymbol(text)&&(YUD.addClass(el,"symbol"),YUD.addClass(el,"symbol_"+text.charCodeAt(0)),el.getAttribute("lspace")&&el.removeAttribute("lspace"),el.getAttribute("rspace")&&el.removeAttribute("rspace"))})},processPageImageXml=function(page,pageXmlDoc,imgNode,mediaResource){var mediaData=mediaResource.data;if(-1!=mediaData.indexOf("MathML")){if(!Util.Browser.supportsMathML())return!1;var pageAccs=page.getAccProps();if(pageAccs){if(pageAccs.hasBraille())return!1;if(pageAccs.isStreamlinedMode()&&pageAccs.isPermissiveModeEnabled())return!1}mediaData=cleanMathML(mediaData)}mediaData=cleanXml(mediaData);var mediaDoc=Util.Xml.parseFromString(mediaData);-1!=mediaData.indexOf("MathML")&&processMathML(mediaDoc);var mediaNode=pageXmlDoc.importNode(mediaDoc.documentElement,!0),imgAlt=imgNode.getAttribute("alt");return imgAlt&&mediaNode.setAttribute("alt",imgAlt),YUD.insertBefore(mediaNode,imgNode),Util.Dom.removeNode(imgNode),!0},processPageImageBase64=function(page,pageXmlDoc,imgNode,mediaResource){return imgNode.src="data:"+mediaResource.type+";base64,"+mediaResource.data,!0};CM.addTransform({match:function(page,content,xmlStr){return!YAHOO.env.ua.ie&&getMediaResources(content).length>0},execute:function(page,content,xmlDoc){var imageNodes=xmlDoc.getElementsByTagName("img");imageNodes=Util.Array.slice(imageNodes);for(var changed=!1,i=0;i<imageNodes.length;i++){var imgNode=imageNodes[i],imgUrl=imgNode.getAttribute("src"),mediaResource=findMediaResource(content,imgUrl);null!=mediaResource&&null!=mediaResource.data&&("application/mathml+xml"==mediaResource.type?processPageImageXml(page,xmlDoc,imgNode,mediaResource)&&(changed=!0):"image/png"==mediaResource.type&&processPageImageBase64(0,0,imgNode,mediaResource)&&(changed=!0))}return changed}}),CM.addTransform({match:function(page,content,xmlStr){return-1!=xmlStr.indexOf("<audio")},execute:function(page,content,xmlDoc){return $("audio",xmlDoc).each(function(idx,audioNode){var newEl=Util.Dom.renameTag(audioNode,"div"),currentClass=newEl.getAttribute("class");currentClass?-1===currentClass.indexOf("tds-audio")&&newEl.setAttribute("class",currentClass+" tds-audio"):newEl.setAttribute("class","tds-audio")}),!0}})}(window.ContentManager),function(CM){function allowCaret(page,entity){var isPassage=entity instanceof ContentPassage,isStem=entity instanceof ContentItem&&entity.getStemElement()==entity.getActiveComponent();if(!isPassage&&!isStem)return!1;var allowedAccommodation=!1,accProps=page.getAccommodationProperties();return accProps.hasHighlighting()?allowedAccommodation=!0:isPassage&&accProps.hasTTSStimulus()?allowedAccommodation=!0:isStem&&accProps.hasTTSItem()&&(allowedAccommodation=!0),allowedAccommodation}function Plugin(page){}window.ContentManager.registerEntityPlugin("caretbrowser",Plugin,function(page){return Mozilla.execPrivileged()}),Plugin.prototype.showMenu=function(menu,evt){var page=this.page,entity=this.entity;if(evt.keyCode&&allowCaret(page,entity)){var menuFunc,menuItem;Mozilla.inCaretMode()?(menuFunc=function(){ContentManager.enableCaretMode(!1)},menuItem={text:Messages.get("TDSContentEventsJS.Link.DisableTextSelection"),classname:"caretMode",onclick:{fn:menuFunc}}):(menuFunc=function(){var focusedComponent=entity.getActiveComponent();focusedComponent&&focusedComponent.focus&&(entity.clearComponent(),entity.setActiveComponent(focusedComponent),ContentManager.enableCaretMode(!0))},menuItem={text:Messages.get("TDSContentEventsJS.Link.EnableTextSelection"),classname:"caretMode",onclick:{fn:menuFunc}}),menu.addMenuItem("entity",menuItem)}}}(),function(CM,Modes){function getStrikeables(entity){var entityEl=entity.getElement();return $(SELECTOR_STRIKEABLE,entityEl).get()}function isStrikeable(el){return $(el).is(SELECTOR_STRIKEABLE)}function hasStrikethrough(el){return $(el).hasClass(CSS_STRIKETHROUGH)}function toggleStrikethrough(el){$(el).toggleClass(CSS_STRIKETHROUGH)}function Mode_Strike(){}function Plugin_Strike(page,entity){}var CSS_STRIKETHROUGH="strikethrough",SELECTOR_STRIKEABLE="div.optionContainer";window.ContentManager.Modes.register("strikethrough",Mode_Strike),Mode_Strike.prototype.select=function(el){toggleStrikethrough(el)},Mode_Strike.prototype.enable=function(){return getStrikeables(this.entity)},CM.registerEntityPlugin("strikethrough",Plugin_Strike,function(page,entity){return!!(entity instanceof ContentItem&&page.getAccommodationProperties().hasStrikethrough())&&["mc","ebsr","qti.choice"].some(function(widgetName){return entity.widgets.has(widgetName)})},{priority:300}),Plugin_Strike.prototype.showMenu=function(menu,evt){var component=this.entity.getActiveComponent(),hasMenuButton=this.page.getAccProps().showItemToolsMenu();if(isStrikeable(component)&&CM.Menu.isContextEvent(evt)){menuLabel={text:hasStrikethrough(component)?Messages.get("TDSMC.MenuLabel.UndoStrikethrough"):Messages.get("TDSMC.MenuLabel.Strikethrough"),classname:CSS_STRIKETHROUGH};menu.addMenuItem("component",menuLabel,function(){toggleStrikethrough(component)})}else if(hasMenuButton){var menuLabel={text:Messages.get("TDSMC.MenuLabel.Strikethrough"),classname:CSS_STRIKETHROUGH};menu.addMenuItem("component",menuLabel,function(){CM.Modes.enable("strikethrough")})}}}(window.ContentManager),function(CM){function Plugin_MathJax(page,config){}ContentManager.registerPagePlugin("mathjax",Plugin_MathJax,function(page,content){return void 0!==window.MathJax&&!Util.Browser.supportsMathML()}),Plugin_MathJax.prototype.load=function(){var pageEl=this.page.getElement();pageEl.getElementsByTagName("math").length>0&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,pageEl.id])}}(),function(CM){function Plugin_Lang(page,entity,config){}CM.registerEntityPlugin("language",Plugin_Lang,function(page,entity,content){return!CM.QTI.isNativeEntity(entity)},{priority:301,defer:!0}),Plugin_Lang.prototype.load=function(){var el=this.entity.getElement();tds.language.tagElements(el)}}(ContentManager),function(Audio,CM){function Player_Plugin(page,config){}var Player=Audio.Player,Widget=(Audio.Recorder,Audio.Widget);CM.registerEntityPlugin("audio.player",Player_Plugin,function(page,entity,content){var entityEl=entity.getElement();if(entityEl){var audioElements=$("audio, div.tds-audio",entityEl).not(".slides_audio").add("a.sound_explicit, a.sound_repeat, a.sound_cue",entityEl).get();if(audioElements.length>0)return audioElements}return!1},{priority:300,defer:!0}),Player_Plugin.prototype.load=function(){var page=this.page,entity=this.entity;this.config.forEach(function(audioEl){var $audio=$(audioEl);$audio.hasClass("sound_explicit")&&$audio.addClass("sound_repeat");var autoplay=audioEl.getAttribute("autoplay");autoplay=!!autoplay&&"true"==autoplay.toLowerCase();var audio,isMCOption=$audio.closest(".optionSound").length>0,accProps=page.getAccommodationProperties();(audio=!isMCOption&&accProps&&accProps.isAudioScrubberEnabled()?Widget.createPlayerScrubber(audioEl):!isMCOption&&accProps&&accProps.isAudioRewindEnabled()?Widget.createPlayerRewind(audioEl):Widget.createPlayer(audioEl)).controls.forEach(function(el){entity.addComponent(el)}),audio?(entity.audioLinks.push(audio.id),autoplay&&!CM.isAccessibilityEnabled()&&page.autoPlayQueue.append(audio.id)):$audio.addClass("disabled")})},Player_Plugin.prototype.hide=function(){Player.isPlaying()&&Player.stopAll()}}(TDS.Audio,window.ContentManager),function(Audio,CM){function Recorder_Widget(page,item,config){}var Player=Audio.Player,Recorder=Audio.Recorder,Widget=Audio.Widget;CM.registerWidget("audio.recorder",Recorder_Widget,function(page,item){var id="elicited_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el,{})}),Recorder_Widget.prototype.init=function(){},Recorder_Widget.prototype.load=function(){var item=this.entity,recorderID=this.id;Recorder.isInitialized()||Recorder.initialize();var duration="SER"==item.format.toUpperCase()?120:30,recorder=Widget.createRecorder(recorderID,duration);item.recorder=recorderID,recorder.controls.forEach(function(el){item.addComponent(el)}),item.value&&item.value.length>0&&Recorder.onDeviceReady.subscribe(function(){Recorder.loadBase64Audio(recorderID,item.value)})},Recorder_Widget.prototype.showMenu=function(contentMenu,evt,pageSelection){var menu=contentMenu;this.entity;if(!Player.isPlaying()){var micDiv=YUD.get(this.id),id=micDiv.id,recorderMenuItems=[];if(Recorder.isCapturing()){menuLabel=Messages.get("TDSAudioJS.Label.StopRecording");recorderMenuItems.push({text:menuLabel,classname:"stoprecording",onclick:{fn:function(){Recorder.stopCapture(id)}}})}else if(Recorder.isPlaying()){if(YUD.hasClass(micDiv,"playing_start")){menuLabel=Messages.get("TDSAudioJS.Label.StopPlayRecording");recorderMenuItems.push({text:menuLabel,classname:"stopquestion",onclick:{fn:function(){Recorder.stopAudio(id)}}})}}else{menuLabel=Messages.get("TDSAudioJS.Label.StartRecording");if(recorderMenuItems.push({text:menuLabel,classname:"startrecording",onclick:{fn:function(){Recorder.startCapture(id)}}}),YUD.hasClass(micDiv,"decode_complete")||YUD.hasClass(micDiv,"recording_done")||YUD.hasClass(micDiv,"playing_done")||YUD.hasClass(micDiv,"playing_stopped")){var menuLabel=Messages.get("TDSAudioJS.Label.PlayRecording");recorderMenuItems.push({text:menuLabel,classname:"playrecording",onclick:{fn:function(){Recorder.playAudio(id)}}})}}for(var i=0;i<recorderMenuItems.length;i++)menu._entity.push(recorderMenuItems[i])}},Recorder_Widget.prototype.hide=function(){Recorder.isPlaying()&&Recorder.stopAudio(),Recorder.isCapturing()&&Recorder.stopCapture()},Recorder_Widget.prototype.getResponse=function(){var value=Recorder.retrieveBase64Audio(this.id)||"",haveSound=value.length>0;return this.createResponse(value,haveSound)},Recorder_Widget.prototype.setResponse=function(value){Recorder.loadBase64Audio(this.id,value)}}(TDS.Audio,window.ContentManager),function(CM){function hasTTSItemEnabled(page){var accProps=page.getAccommodationProperties();return accProps&&accProps.hasTTSItem()}function hasTTSPassageEnabled(page){var accProps=page.getAccommodationProperties();return accProps&&accProps.hasTTSStimulus()}function hasTTSEnabled(page){return hasTTSItemEnabled(page)||hasTTSPassageEnabled(page)}function ItemPlugin_TTS(page,entity,config){}function PassagePlugin_TTS(page,entity,config){}function ttsNotSpeaking(){var ttsInstance=TTS.getInstance();return!ttsInstance||!ttsInstance.isPlaying()}CM&&(TTS.MenuSystem={Last:null,addMenuSetup:function(menu,playCfg){try{if(!menu||!playCfg||!playCfg.ORDER)return;TTS.MenuSystem.Last=playCfg;for(var order=playCfg.ORDER,i=0;i<order.length;++i){var entry=playCfg[order[i]];entry&&("function"==typeof entry.cb||entry.allowDisabled)&&menu.addMenuItem(entry.level||"entity",{text:Messages.get(entry.Label||"TTS"),onclick:{fn:entry.cb},disabled:"function"==typeof entry.cb?TDS.Audio.isActive():entry.allowDisabled,classname:entry.css||"speaksection"})}}catch(e){console.error("Failed to create menu item.",e)}}},TTS.Config.isTrackingEnabled=function(){return null!=window.ContentManager&&window.ContentManager.getAccommodationProperties().isTTSTrackingEnabled()},CM.registerEntityPlugin("item.tts",ItemPlugin_TTS,function(page,entity){var accProps=page.getAccommodationProperties();return!!(accProps&&entity instanceof ContentItem)&&!entity.isResponseType("EBSR")&&accProps.hasTTSItem()},{priority:299}),ItemPlugin_TTS.prototype.load=function(){var page=this.page,item=this.entity,itemEl=item.getElement();if(itemEl){var markCommentEl=Util.Dom.getElementByClassName("markComment","span",itemEl);markCommentEl&&markCommentEl.setAttribute("data-tts-skip","true");var posEl=Util.Dom.queryTag("h2",itemEl);posEl&&Util.Dom.getTextContent(posEl)==item.position&&posEl.setAttribute("data-tts-skip","true")}TTS.createSingleton();var pageDoc=page.getDoc();if(pageDoc){var commentBoxEl=pageDoc.getElementById("Item_CommentBox_"+item.position);commentBoxEl&&commentBoxEl.setAttribute("data-tts-skip","true")}},ItemPlugin_TTS.prototype.showMenu=function(menu,evt,selection){var page=this.page,item=this.entity;if(TTS.getInstance().isAvailable()){item.widgets.has("mc");var pageWin=page.getActiveWin(),languages="ENU"!=CM.getLanguage()?["ESN","ENU"]:["ENU"],domToParse=[],stem=item.getStemElement();stem&&domToParse.push(stem);var illustration=item.getIllustrationElement();illustration&&domToParse.push(illustration);var menuCfg=new TTS.Menu(languages).getMenuCfg(domToParse,selection,pageWin,item.stemTTS,page,item);TTS.MenuSystem.addMenuSetup(menu,menuCfg),TTS.Config.Debug&&console.log("TTS On Item Menushow config",menuCfg)}},ItemPlugin_TTS.prototype.hide=function(){TTS.getInstance().stop()},CM.registerEntityPlugin("passage.tts",PassagePlugin_TTS,function(page,entity){var accProps=page.getAccommodationProperties();return!!(accProps&&entity instanceof ContentPassage)&&accProps.hasTTSStimulus()}),PassagePlugin_TTS.prototype.load=function(){TTS.createSingleton()},PassagePlugin_TTS.prototype.showMenu=function(menu,evt,selection){var page=this.page,passage=this.entity;if(TTS.Manager.isAvailable()){var languages="ENU"!=CM.getLanguage()?["ESN","ENU"]:["ENU"],menuCfg=new TTS.Menu(languages).getMenuCfg(passage.getElement(),selection,page.getActiveWin(),passage.stemTTS,page,passage);TTS.Config.Debug&&console.log("Passage menu show.",menuCfg),TTS.MenuSystem.addMenuSetup(menu,menuCfg)}},PassagePlugin_TTS.prototype.hide=function(){TTS.getInstance().stop()},CM.registerPagePlugin("tts-page",function(page,config){},function(page){return hasTTSEnabled(page)}),TDS.Audio.Player.onBeforePlay.subscribe(function(){return ttsNotSpeaking()}),TDS.Audio.Player.onBeforeResume.subscribe(function(){return ttsNotSpeaking()}),CM.onPageEvent("hide",function(page){TTS.getInstance().stop()}))}(window.ContentManager),function(CM,Modes){function getSpeakables(entity){var entityEl=entity.getElement();return $(SELECTOR_TTSOPTION,entityEl).get()}function isSpeakable(el){return $(el).is(SELECTOR_TTSOPTION)}function isTTSAvailable(){return!!TTS.getInstance().isAvailable()}function Mode_TTSOption(){}function Plugin_TTSOption(page,entity){}var SELECTOR_TTSOPTION="div.optionContainer";window.ContentManager.Modes.register("tts-option",Mode_TTSOption),Mode_TTSOption.prototype.select=function(el,evt){var language=tds.language.getITSFromXml(evt.target.lang),menuCfg=(new TTS.Menu).addFocusedOption(null,el,language);menuCfg&&menuCfg.PRI&&menuCfg.PRI.cb&&menuCfg.PRI.cb(),CM.Modes.disable("tts-option")},Mode_TTSOption.prototype.enable=function(){return isTTSAvailable()?getSpeakables(this.entity):null},CM.registerEntityPlugin("tts-option",Plugin_TTSOption,function(page,entity){return!!(entity instanceof ContentItem&&page.getAccommodationProperties().hasTTSItem())&&["mc","ebsr","choice"].some(function(widgetName){return entity.widgets.has(widgetName)})},{priority:299}),Plugin_TTSOption.prototype.showMenu=function(menu,evt){var component=this.entity.getActiveComponent(),hasMenuButton=this.page.getAccProps().showItemToolsMenu();component&&isSpeakable(component);var menuCfg,languages="ENU"!=CM.getLanguage()?["ESN","ENU"]:["ENU"],ttsMenu=new TTS.Menu(languages);component&&isSpeakable(component)&&CM.Menu.isContextEvent(evt)?menuCfg=ttsMenu.addFocusedOption(null,component):hasMenuButton&&TTS.Manager.getStatus()!=TTS.Status.NotSupported&&(menuCfg=ttsMenu.addMode(null,function(){CM.Modes.enable("tts-option")})),TTS.MenuSystem.addMenuSetup(menu,menuCfg)}}(window.ContentManager),function(CM){function processQTI(page,item){var qtiDoc=Util.Xml.parseFromString(item.qti.xml),itemBodyNode=Util.Dom.getElementByTagName("itemBody",qtiDoc);Util.Dom.getElementsByTagName("*",itemBodyNode).forEach(function(itemBodyChild){if(Util.String.contains(itemBodyChild.nodeName,"Interaction")){var interactionType=itemBodyChild.nodeName,nodeName=-1!=inlineInteractions.indexOf(interactionType)?"span":"div",interactionEl=qtiDoc.createElement(nodeName),interactionId=itemBodyChild.getAttribute("responseIdentifier");interactionEl.setAttribute("data-qti-type",interactionType),interactionEl.setAttribute("data-qti-identifier",interactionId);var className="qti-interaction",customData=itemBodyChild.getAttribute("class");customData&&(className+=" "+customData),interactionEl.setAttribute("class",className),$(itemBodyChild).replaceWith(interactionEl);var scriptEl=qtiDoc.createElement("script");if("customInteraction"==itemBodyChild.nodeName){if(scriptEl.setAttribute("type","text/xml"),scriptEl.appendChild($(itemBodyChild).children().get(0)),customData){var customList=customData.split(" ");customList[0]&&interactionEl.setAttribute("data-qti-custom",customList[0])}}else scriptEl.setAttribute("type","text/qti"),scriptEl.appendChild(itemBodyChild);interactionEl.appendChild(scriptEl)}});var itemBodyHtml=Util.Xml.innerHTML(itemBodyNode),stemEl=item.getStemElement();stemEl.innerHTML=itemBodyHtml;var responseEl=item.getResponseArea();if(responseEl){var $blockInteraction=$("div.qti-interaction",stemEl);if($blockInteraction.length){var $afterInteraction=$blockInteraction.nextAll();$blockInteraction.appendTo(responseEl),$afterInteraction.appendTo(responseEl)}}}function Plugin_QTI(page,item,config){}function Container_QTI(widgets){}var inlineInteractions=["textEntryInteraction","inlineChoiceInteraction"];CM.registerEntityPlugin("qti",Plugin_QTI,function(page,entity){return entity instanceof ContentItem&&entity.isResponseType("QTI")}),Plugin_QTI.prototype.init=function(){processQTI(this.page,this.entity)},CM.registerResponseContainer("qti",Container_QTI),Container_QTI.prototype.create=function(responses){function addValue(responseNode,value){if(null!=value){var valueNode=xmlDoc.createElement("value");valueNode.appendChild(document.createTextNode(value)),responseNode.appendChild(valueNode)}}var xmlDoc=Util.Xml.parseFromString("<itemResponse></itemResponse>"),rootNode=xmlDoc.documentElement;return responses.forEach(function(response){var responseNode=xmlDoc.createElement("response");responseNode.setAttribute("id",response.id),"array"==response.dataType?response.value.forEach(function(value){addValue(responseNode,value)}):addValue(responseNode,response.value),rootNode.appendChild(responseNode)}),Util.Xml.serializeToString(xmlDoc)},Container_QTI.prototype.load=function(value,widgets){var rootNode=Util.Xml.parseFromString(value).documentElement;$("response",rootNode).each(function(idx,responseNode){var values=$("value",responseNode).map(function(valueIdx,valueNode){return Util.Xml.getNodeText(valueNode)}).get();if(values.length>0){var id=responseNode.getAttribute("id"),widget=Util.Array.find(widgets,function(widget){return widget.id==id});widget&&("array"==widget.dataType?widget.setResponse(values):widget.setResponse(values[0]))}})},CM.mapResponseContainer("QTI","QTI")}(window.ContentManager),function(CM){function Widget_TE(page,item,config){this.options={autoLoad:!0},this.inputEl=null}var match=CM.QTI.createWidgetMatch("textEntryInteraction");CM.registerWidget("qti.textentry",Widget_TE,match),Widget_TE.prototype.load=function(){var teEl=this.element,teNode=this.config,teInput=document.createElement("input");teInput.type="text",teInput.className="textEntry",teEl.appendChild(teInput);var expectedLength=1*teNode.getAttribute("expectedLength");expectedLength>0&&(teInput.setAttribute("size",expectedLength),teInput.setAttribute("maxlength",expectedLength)),this.inputEl=teInput},Widget_TE.prototype.getComponents=function(){return[this.inputEl]},Widget_TE.prototype.getResponse=function(){var value=this.inputEl.value,isValid=YAHOO.lang.trim(value).length>0;return this.createResponse(value,isValid)},Widget_TE.prototype.setResponse=function(value){this.inputEl.value=value}}(window.ContentManager),function(CM){function Widget_IC(page,item,config){this.options={autoLoad:!0},this.selectEl=null}var match=CM.QTI.createWidgetMatch("inlineChoiceInteraction");CM.registerWidget("qti.inlinechoice",Widget_IC,match),Widget_IC.prototype.load=function(){var containerEl=this.element,interactionNode=this.config,selectEl=document.createElement("select");this.selectEl=selectEl,$("inlineChoice",interactionNode).each(function(idx,icNode){var id=icNode.getAttribute("identifier"),text=Util.Xml.getNodeText(icNode),optionEl=new Option(text,id);selectEl.options[idx]=optionEl}),containerEl.appendChild(selectEl)},Widget_IC.prototype.getComponents=function(){return[this.selectEl]},Widget_IC.prototype.getResponse=function(){var value=this.selectEl.value,isValid=this.selectEl.selectedIndex>0;return this.createResponse(value,isValid)},Widget_IC.prototype.setResponse=function(value){this.selectEl.value=value}}(window.ContentManager),function(){var AnimationManager={};AnimationManager.canPlayHTML5=function(pageLink){return!!VideoManager.SWF.parseData(pageLink).html5&&(!(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9)&&!(Util.Browser.getFirefoxVersion()>0&&Util.Browser.getFirefoxVersion()<4))},AnimationManager.injectHTML5=function(pageLink,scriptUrl){var animData=VideoManager.SWF.parseData(pageLink),animUrl=animData.url.replace(".swf",".html");if(-1!=animUrl.indexOf("?")){var id=Util.Date.now();"object"==typeof TDS&&(TDS.buildNumber?id=TDS.buildNumber:TDS.Cache&&TDS.Cache.id&&(id=TDS.Cache.id)),animUrl=animUrl.replace("?","?cid="+id+"&")}scriptUrl&&-1!=animUrl.indexOf("?")&&(scriptUrl=encodeURIComponent(scriptUrl),animUrl=animUrl.replace("?","?scriptUrl="+scriptUrl+"&"));var animWidth=animData.width||400,animHeight=animData.height||400,animFrame=Util.Dom.getOwnerDocument(pageLink).createElement("iframe");return animFrame.className="frame-anim-html5",animFrame.setAttribute("width",animWidth+"px"),animFrame.setAttribute("height",animHeight+"px"),animFrame.setAttribute("src",animUrl),pageLink.parentNode.replaceChild(animFrame,pageLink),animFrame},AnimationManager.reloadHTML5=function(currentFrame){var animUrl=YUD.getAttribute(currentFrame,"src"),animWidth=YUD.getAttribute(currentFrame,"width"),animHeight=YUD.getAttribute(currentFrame,"height"),animFrame=Util.Dom.getOwnerDocument(currentFrame).createElement("iframe");return animFrame.className="frame-anim-html5",animFrame.setAttribute("width",animWidth),animFrame.setAttribute("height",animHeight),animFrame.setAttribute("src",animUrl),currentFrame.parentNode.replaceChild(animFrame,currentFrame),animFrame},AnimationManager.getHTML5Frames=function(el){var animFrames=[],frames=el.getElementsByTagName("iframe");return YUD.batch(frames,function(frame){YUD.hasClass(frame,"frame-anim-html5")&&animFrames.push(frame)}),animFrames},AnimationManager.stop=function(animFrame){console.log("Content Dialog: Stop HTML5 animation");var animWin=Util.Dom.getFrameContentWindow(animFrame);animWin&&"function"==typeof animWin.stopAnimation&&animWin.stopAnimation()},AnimationManager.resume=function(animFrame){console.log("Content Dialog: Resume HTML5 animation");var animWin=Util.Dom.getFrameContentWindow(animFrame);animWin&&"function"==typeof animWin.playAnimation&&setTimeout(function(){animWin.playAnimation()},30)},window.AnimationManager=AnimationManager}(),function(){function processLinks(parentEl){var processed=!1,scriptUrl=ContentManager.resolveBaseUrl("Scripts/Libraries/"),pageLinks=parentEl.getElementsByTagName("a");return pageLinks=Array.prototype.slice.call(pageLinks),YUD.batch(pageLinks,function(pageLink){AnimationManager.canPlayHTML5(pageLink)&&(AnimationManager.injectHTML5(pageLink,scriptUrl),processed=!0)}),processed}ContentManager.onPageEvent("available",function(page){processLinks(page.getElement())}),ContentManager.onPageEvent("show",function(page){var pageEl=page.getElement(),animFrames=AnimationManager.getHTML5Frames(pageEl);animFrames.length>0&&AnimationManager.reloadHTML5(animFrames[0])}),ContentManager.Dialog.onLoad.subscribe(function(frame){var frameDoc=frame.getDocument();Util.String.contains(frame.id,"help")&&processLinks(frameDoc)}),ContentManager.Dialog.onBeforeHide.subscribe(function(frame){var dialogFrame=frame.getDocument();if(dialogFrame){var animFrames=AnimationManager.getHTML5Frames(dialogFrame);animFrames.length>0&&AnimationManager.stop(animFrames[0])}}),ContentManager.Dialog.onShow.subscribe(function(frame){var dialogFrame=frame.getDocument();if(dialogFrame){var animFrames=AnimationManager.getHTML5Frames(dialogFrame);animFrames.length>0&&AnimationManager.resume(animFrames[0])}})}(),void 0===jwplayer){var jwplayer=function(a){if(jwplayer.api)return jwplayer.api.selectPlayer(a)},$jw=jwplayer;jwplayer.version="5.10.2295 (Licensed version)",jwplayer.vid=document.createElement("video"),jwplayer.audio=document.createElement("audio"),jwplayer.source=document.createElement("source"),function(b){function a(d){if(b.utils.exists(d)){var e=d.indexOf("://"),c=d.indexOf("?");return e>0&&(c<0||c>e)}}b.utils=function(){},b.utils.typeOf=function(d){var c=typeof d;return"object"===c&&(d?d instanceof Array&&(c="array"):c="null"),c},b.utils.extend=function(){var c=b.utils.extend.arguments;if(c.length>1){for(var e=1;e<c.length;e++)for(var d in c[e])c[0][d]=c[e][d];return c[0]}return null},b.utils.clone=function(f){var c,d=b.utils.clone.arguments;if(1==d.length)switch(b.utils.typeOf(d[0])){case"object":c={};for(var e in d[0])c[e]=b.utils.clone(d[0][e]);break;case"array":c=[];for(var e in d[0])c[e]=b.utils.clone(d[0][e]);break;default:return d[0]}return c},b.utils.extension=function(c){return c?(c=c.substring(c.lastIndexOf("/")+1,c.length),(c=c.split("?")[0]).lastIndexOf(".")>-1?c.substr(c.lastIndexOf(".")+1,c.length).toLowerCase():void 0):""},b.utils.html=function(c,d){c.innerHTML=d},b.utils.wrap=function(c,d){c.parentNode&&c.parentNode.replaceChild(d,c),d.appendChild(c)},b.utils.ajax=function(g,f,c){var e;(e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).onreadystatechange=function(){if(4===e.readyState)if(200===e.status){if(f){if(!b.utils.exists(e.responseXML))try{if(window.DOMParser){var h=(new DOMParser).parseFromString(e.responseText,"text/xml");h&&(e=b.utils.extend({},e,{responseXML:h}))}else(h=new ActiveXObject("Microsoft.XMLDOM")).async="false",h.loadXML(e.responseText),e=b.utils.extend({},e,{responseXML:h})}catch(j){c&&c(g)}f(e)}}else c&&c(g)};try{e.open("GET",g,!0),e.send(null)}catch(d){c&&c(g)}return e},b.utils.load=function(d,e,c){d.onreadystatechange=function(){4===d.readyState&&(200===d.status?e&&e():c&&c())}},b.utils.find=function(d,c){return d.getElementsByTagName(c)},b.utils.append=function(c,d){c.appendChild(d)},b.utils.isIE=function(){return void 0!==window.ActiveXObject},b.utils.userAgentMatch=function(d){return null!==navigator.userAgent.toLowerCase().match(d)},b.utils.isIOS=function(){return b.utils.userAgentMatch(/iP(hone|ad|od)/i)},b.utils.isIPad=function(){return b.utils.userAgentMatch(/iPad/i)},b.utils.isIPod=function(){return b.utils.userAgentMatch(/iP(hone|od)/i)},b.utils.isAndroid=function(){return b.utils.userAgentMatch(/android/i)},b.utils.isLegacyAndroid=function(){return b.utils.userAgentMatch(/android 2.[012]/i)},b.utils.isBlackberry=function(){return b.utils.userAgentMatch(/blackberry/i)},b.utils.isMobile=function(){return b.utils.userAgentMatch(/(iP(hone|ad|od))|android/i)},b.utils.getFirstPlaylistItemFromConfig=function(c){var e,d={};return e=c.playlist&&c.playlist.length?c.playlist[0]:c,d.file=e.file,d.levels=e.levels,d.streamer=e.streamer,d.playlistfile=e.playlistfile,d.provider=e.provider,d.provider||(d.file&&(d.file.toLowerCase().indexOf("youtube.com")>-1||d.file.toLowerCase().indexOf("youtu.be")>-1)&&(d.provider="youtube"),d.streamer&&0==d.streamer.toLowerCase().indexOf("rtmp://")&&(d.provider="rtmp"),e.type&&(d.provider=e.type.toLowerCase())),"audio"==d.provider&&(d.provider="sound"),d},b.utils.getOuterHTML=function(c){if(c.outerHTML)return c.outerHTML;try{return(new XMLSerializer).serializeToString(c)}catch(d){return""}},b.utils.setOuterHTML=function(f,e){if(f.outerHTML)f.outerHTML=e;else{var g=document.createElement("div");g.innerHTML=e;var c=document.createRange();c.selectNodeContents(g);var d=c.extractContents();f.parentNode.insertBefore(d,f),f.parentNode.removeChild(f)}},b.utils.hasFlash=function(){if(void 0!==navigator.plugins&&void 0!==navigator.plugins["Shockwave Flash"])return!0;if(void 0!==window.ActiveXObject)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(c){}return!1},b.utils.getPluginName=function(c){return c.lastIndexOf("/")>=0&&(c=c.substring(c.lastIndexOf("/")+1,c.length)),c.lastIndexOf("-")>=0&&(c=c.substring(0,c.lastIndexOf("-"))),c.lastIndexOf(".swf")>=0&&(c=c.substring(0,c.lastIndexOf(".swf"))),c.lastIndexOf(".js")>=0&&(c=c.substring(0,c.lastIndexOf(".js"))),c},b.utils.getPluginVersion=function(c){return c.lastIndexOf("-")>=0?c.lastIndexOf(".js")>=0?c.substring(c.lastIndexOf("-")+1,c.lastIndexOf(".js")):c.lastIndexOf(".swf")>=0?c.substring(c.lastIndexOf("-")+1,c.lastIndexOf(".swf")):c.substring(c.lastIndexOf("-")+1):""},b.utils.getAbsolutePath=function(j,h){if(b.utils.exists(h)||(h=document.location.href),b.utils.exists(j)){if(a(j))return j;var d,k=h.substring(0,h.indexOf("://")+3),g=h.substring(k.length,h.indexOf("/",k.length+1));if(0===j.indexOf("/"))d=j.split("/");else{var e=h.split("?")[0];d=(e=e.substring(k.length+g.length+1,e.lastIndexOf("/"))).split("/").concat(j.split("/"))}for(var c=[],f=0;f<d.length;f++)d[f]&&b.utils.exists(d[f])&&"."!=d[f]&&(".."==d[f]?c.pop():c.push(d[f]));return k+g+"/"+c.join("/")}},b.utils.pluginPathType={ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE",CDN:"CDN"},b.utils.getPluginPathType=function(d){if("string"==typeof d){var e=(d=d.split("?")[0]).indexOf("://");if(e>0)return b.utils.pluginPathType.ABSOLUTE;var c=d.indexOf("/"),f=b.utils.extension(d);return!(e<0&&c<0)||f&&isNaN(f)?b.utils.pluginPathType.RELATIVE:b.utils.pluginPathType.CDN}},b.utils.mapEmpty=function(c){for(var d in c)return!1;return!0},b.utils.mapLength=function(d){var c=0;for(var e in d)c++;return c},b.utils.log=function(d,c){"undefined"!=typeof console&&void 0!==console.log&&(c?console.log(d,c):console.log(d))},b.utils.css=function(d,g,c){if(b.utils.exists(d))for(var e in g)try{if(void 0===g[e])continue;if("number"==typeof g[e]&&"zIndex"!=e&&"opacity"!=e){if(isNaN(g[e]))continue;e.match(/color/i)?g[e]="#"+b.utils.strings.pad(g[e].toString(16),6):g[e]=Math.ceil(g[e])+"px"}d.style[e]=g[e]}catch(f){}},b.utils.isYouTube=function(c){return c.indexOf("youtube.com")>-1||c.indexOf("youtu.be")>-1},b.utils.transform=function(e,d,c,g,h){if(b.utils.exists(d)||(d=1),b.utils.exists(c)||(c=1),b.utils.exists(g)||(g=0),b.utils.exists(h)||(h=0),1==d&&1==c&&0==g&&0==h)e.style.webkitTransform="",e.style.MozTransform="",e.style.OTransform="";else{var f="scale("+d+","+c+") translate("+g+"px,"+h+"px)";e.style.webkitTransform=f,e.style.MozTransform=f,e.style.OTransform=f}},b.utils.stretch=function(k,q,p,g,n,h){if(void 0!==p&&void 0!==g&&void 0!==n&&void 0!==h){var d=p/n,f=g/h,e=!1,c={};switch(q.parentElement&&(q.parentElement.style.overflow="hidden"),b.utils.transform(q),k.toUpperCase()){case b.utils.stretching.NONE:c.width=n,c.height=h,c.top=(g-c.height)/2,c.left=(p-c.width)/2;break;case b.utils.stretching.UNIFORM:d>f?(c.width=n*f,c.height=h*f,c.width/p>.95&&(e=!0,d=Math.ceil(100*p/c.width)/100,f=1,c.width=p)):(c.width=n*d,c.height=h*d,c.height/g>.95&&(e=!0,d=1,f=Math.ceil(100*g/c.height)/100,c.height=g)),c.top=(g-c.height)/2,c.left=(p-c.width)/2;break;case b.utils.stretching.FILL:d>f?(c.width=n*d,c.height=h*d):(c.width=n*f,c.height=h*f),c.top=(g-c.height)/2,c.left=(p-c.width)/2;break;case b.utils.stretching.EXACTFIT:c.width=n,c.height=h;var o=Math.round(n/2*(1-1/d)),j=Math.round(h/2*(1-1/f));e=!0,c.top=c.left=0}e&&b.utils.transform(q,d,f,o,j),b.utils.css(q,c)}},b.utils.stretching={NONE:"NONE",FILL:"FILL",UNIFORM:"UNIFORM",EXACTFIT:"EXACTFIT"},b.utils.deepReplaceKeyName=function(k,e,c){switch(b.utils.typeOf(k)){case"array":for(g=0;g<k.length;g++)k[g]=b.utils.deepReplaceKeyName(k[g],e,c);break;case"object":for(var f in k){var j;if(e instanceof Array&&c instanceof Array){if(e.length!=c.length)continue;j=e,c}else j=[e],[c];for(var d=f,g=0;g<j.length;g++)d=d.replace(new RegExp(e[g],"g"),c[g]);k[d]=b.utils.deepReplaceKeyName(k[f],e,c),f!=d&&delete k[f]}}return k},b.utils.isInArray=function(e,d){if(!(e&&e instanceof Array))return!1;for(var c=0;c<e.length;c++)if(d===e[c])return!0;return!1},b.utils.exists=function(c){switch(typeof c){case"string":return c.length>0;case"object":return null!==c;case"undefined":return!1}return!0},b.utils.empty=function(c){if("function"==typeof c.hasChildNodes)for(;c.hasChildNodes();)c.removeChild(c.firstChild)},b.utils.parseDimension=function(c){return"string"==typeof c?""===c?0:c.lastIndexOf("%")>-1?c:parseInt(c.replace("px",""),10):c},b.utils.getDimensions=function(c){return c&&c.style?{x:b.utils.parseDimension(c.style.left),y:b.utils.parseDimension(c.style.top),width:b.utils.parseDimension(c.style.width),height:b.utils.parseDimension(c.style.height)}:{}},b.utils.getElementWidth=function(c){return c?c==document.body?b.utils.parentNode(c).clientWidth:c.clientWidth>0?c.clientWidth:c.style?b.utils.parseDimension(c.style.width):null:null},b.utils.getElementHeight=function(c){return c?c==document.body?b.utils.parentNode(c).clientHeight:c.clientHeight>0?c.clientHeight:c.style?b.utils.parseDimension(c.style.height):null:null},b.utils.timeFormat=function(c){return str="00:00",c>0&&(str=Math.floor(c/60)<10?"0"+Math.floor(c/60)+":":Math.floor(c/60)+":",str+=Math.floor(c%60)<10?"0"+Math.floor(c%60):Math.floor(c%60)),str},b.utils.useNativeFullscreen=function(){return navigator&&navigator.vendor&&0==navigator.vendor.indexOf("Apple")},b.utils.parentNode=function(c){return c?c.parentNode?c.parentNode:c.parentElement?c.parentElement:c:document.body},b.utils.getBoundingClientRect=function(c){return"function"==typeof c.getBoundingClientRect?c.getBoundingClientRect():{left:c.offsetLeft+document.body.scrollLeft,top:c.offsetTop+document.body.scrollTop,width:c.offsetWidth,height:c.offsetHeight}},b.utils.translateEventResponse=function(e,c){var g=b.utils.extend({},c);e!=b.api.events.JWPLAYER_FULLSCREEN||g.fullscreen?"object"==typeof g.data?delete(g=b.utils.extend(g,g.data)).data:"object"==typeof g.metadata&&b.utils.deepReplaceKeyName(g.metadata,["__dot__","__spc__","__dsh__"],["."," ","-"]):(g.fullscreen="true"==g.message,delete g.message);var d=["position","duration","offset"];for(var f in d)g[d[f]]&&(g[d[f]]=Math.round(1e3*g[d[f]])/1e3);return g},b.utils.saveCookie=function(c,d){document.cookie="jwplayer."+c+"="+d+"; path=/"},b.utils.getCookies=function(){for(var f={},e=document.cookie.split("; "),d=0;d<e.length;d++){var c=e[d].split("=");0==c[0].indexOf("jwplayer.")&&(f[c[0].substring(9,c[0].length)]=c[1])}return f},b.utils.readCookie=function(c){return b.utils.getCookies()[c]}}(jwplayer),function(a){a.events=function(){},a.events.COMPLETE="COMPLETE",a.events.ERROR="ERROR"}(jwplayer),function(jwplayer){jwplayer.events.eventdispatcher=function(debug){var _debug=debug,_listeners,_globallisteners;this.resetEventListeners=function(){_listeners={},_globallisteners=[]},this.resetEventListeners(),this.addEventListener=function(type,listener,count){try{jwplayer.utils.exists(_listeners[type])||(_listeners[type]=[]),"string"==typeof listener&&eval("listener = "+listener),_listeners[type].push({listener:listener,count:count})}catch(err){jwplayer.utils.log("error",err)}return!1},this.removeEventListener=function(type,listener){if(_listeners[type]){try{for(var listenerIndex=0;listenerIndex<_listeners[type].length;listenerIndex++)if(_listeners[type][listenerIndex].listener.toString()==listener.toString()){_listeners[type].splice(listenerIndex,1);break}}catch(err){jwplayer.utils.log("error",err)}return!1}},this.addGlobalListener=function(listener,count){try{"string"==typeof listener&&eval("listener = "+listener),_globallisteners.push({listener:listener,count:count})}catch(err){jwplayer.utils.log("error",err)}return!1},this.removeGlobalListener=function(listener){if(listener){try{for(var globalListenerIndex=0;globalListenerIndex<_globallisteners.length;globalListenerIndex++)if(_globallisteners[globalListenerIndex].listener.toString()==listener.toString()){_globallisteners.splice(globalListenerIndex,1);break}}catch(err){jwplayer.utils.log("error",err)}return!1}},this.sendEvent=function(type,data){if(jwplayer.utils.exists(data)||(data={}),_debug&&jwplayer.utils.log(type,data),void 0!==_listeners[type])for(var listenerIndex=0;listenerIndex<_listeners[type].length;listenerIndex++){try{_listeners[type][listenerIndex].listener(data)}catch(err){jwplayer.utils.log("There was an error while handling a listener: "+err.toString(),_listeners[type][listenerIndex].listener)}_listeners[type][listenerIndex]&&(1===_listeners[type][listenerIndex].count?delete _listeners[type][listenerIndex]:_listeners[type][listenerIndex].count>0&&(_listeners[type][listenerIndex].count=_listeners[type][listenerIndex].count-1))}for(var globalListenerIndex=0;globalListenerIndex<_globallisteners.length;globalListenerIndex++){try{_globallisteners[globalListenerIndex].listener(data)}catch(err){jwplayer.utils.log("There was an error while handling a listener: "+err.toString(),_globallisteners[globalListenerIndex].listener)}_globallisteners[globalListenerIndex]&&(1===_globallisteners[globalListenerIndex].count?delete _globallisteners[globalListenerIndex]:_globallisteners[globalListenerIndex].count>0&&(_globallisteners[globalListenerIndex].count=_globallisteners[globalListenerIndex].count-1))}}}}(jwplayer),function(a){var b={};a.utils.animations=function(){},a.utils.animations.transform=function(c,d){c.style.webkitTransform=d,c.style.MozTransform=d,c.style.OTransform=d,c.style.msTransform=d},a.utils.animations.transformOrigin=function(c,d){c.style.webkitTransformOrigin=d,c.style.MozTransformOrigin=d,c.style.OTransformOrigin=d,c.style.msTransformOrigin=d},a.utils.animations.rotate=function(c,d){a.utils.animations.transform(c,["rotate(",d,"deg)"].join(""))},a.utils.cancelAnimation=function(c){delete b[c.id]},a.utils.fadeTo=function(m,f,e,j,h,d){if((b[m.id]==d||!a.utils.exists(d))&&m.style.opacity!=f){var c=(new Date).getTime();if(d>c&&setTimeout(function(){a.utils.fadeTo(m,f,e,j,0,d)},d-c),"none"==m.style.display&&(m.style.display="block"),a.utils.exists(j)||(j=""===m.style.opacity?1:m.style.opacity),m.style.opacity==f&&""!==m.style.opacity&&a.utils.exists(d))0===f&&(m.style.display="none");else{a.utils.exists(d)||(d=c,b[m.id]=d),a.utils.exists(h)||(h=0);var k=e>0?(c-d)/(1e3*e):0,g=j+(k=k>1?1:k)*(f-j);if(g>1?g=1:g<0&&(g=0),m.style.opacity=g,h>0)return b[m.id]=d+1e3*h,void a.utils.fadeTo(m,f,e,j,0,b[m.id]);setTimeout(function(){a.utils.fadeTo(m,f,e,j,0,d)},10)}}}}(jwplayer),function(a){a.utils.arrays=function(){},a.utils.arrays.indexOf=function(c,d){for(var b=0;b<c.length;b++)if(c[b]==d)return b;return-1},a.utils.arrays.remove=function(c,d){var b=a.utils.arrays.indexOf(c,d);b>-1&&c.splice(b,1)}}(jwplayer),jwplayer.utils.extensionmap={"3gp":{html5:"video/3gpp",flash:"video"},"3gpp":{html5:"video/3gpp"},"3g2":{html5:"video/3gpp2",flash:"video"},"3gpp2":{html5:"video/3gpp2"},flv:{flash:"video"},f4a:{html5:"audio/mp4"},f4b:{html5:"audio/mp4",flash:"video"},f4v:{html5:"video/mp4",flash:"video"},mov:{html5:"video/quicktime",flash:"video"},m4a:{html5:"audio/mp4",flash:"video"},m4b:{html5:"audio/mp4"},m4p:{html5:"audio/mp4"},m4v:{html5:"video/mp4",flash:"video"},mp4:{html5:"video/mp4",flash:"video"},rbs:{flash:"sound"},aac:{html5:"audio/aac",flash:"video"},mp3:{html5:"audio/mp3",flash:"sound"},ogg:{html5:"audio/ogg"},oga:{html5:"audio/ogg"},ogv:{html5:"video/ogg"},webm:{html5:"video/webm"},m3u8:{html5:"audio/x-mpegurl"},gif:{flash:"image"},jpeg:{flash:"image"},jpg:{flash:"image"},swf:{flash:"image"},png:{flash:"image"},wav:{html5:"audio/x-wav"}},function(e){function c(k,j){return e.utils.exists(j)?e.utils.extend(j,g[k]):j=g[k],j}function d(n,j){if(f[n.tagName.toLowerCase()]&&!e.utils.exists(j))return f[n.tagName.toLowerCase()](n);j=c("element",j);var o={};for(var k in j)if("length"!=k){var m=n.getAttribute(k);e.utils.exists(m)&&(o[j[k]]=m)}var l=n.style["#background-color"];return l&&"transparent"!=l&&"rgba(0, 0, 0, 0)"!=l&&(o.screencolor=l),o}function h(n,k){k=c("media",k);var l=[],j=e.utils.selectors("source",n);for(var m in j)isNaN(m)||l.push(a(j[m]));var o=d(n,k);return e.utils.exists(o.file)&&(l[0]={file:o.file}),o.levels=l,o}function a(l,k){var j=d(l,k=c("source",k));return j.width=j.width?j.width:0,j.bitrate=j.bitrate?j.bitrate:0,j}e.utils.mediaparser=function(){};var g={element:{width:"width",height:"height",id:"id",class:"className",name:"name"},media:{src:"file",preload:"preload",autoplay:"autostart",loop:"repeat",controls:"controls"},source:{src:"file",type:"type",media:"media","data-jw-width":"width","data-jw-bitrate":"bitrate"},video:{poster:"image"}},f={};e.utils.mediaparser.parseMedia=function(j){return d(j)},f.media=h,f.audio=h,f.source=a,f.video=function(l,k){return h(l,k=c("video",k))}}(jwplayer),function(a){a.utils.loaderstatus={NEW:"NEW",LOADING:"LOADING",ERROR:"ERROR",COMPLETE:"COMPLETE"},a.utils.scriptloader=function(c){var d=a.utils.loaderstatus.NEW,b=new a.events.eventdispatcher;a.utils.extend(this,b),this.load=function(){if(d==a.utils.loaderstatus.NEW){d=a.utils.loaderstatus.LOADING;var e=document.createElement("script");e.onload=function(f){d=a.utils.loaderstatus.COMPLETE,b.sendEvent(a.events.COMPLETE)},e.onerror=function(f){d=a.utils.loaderstatus.ERROR,b.sendEvent(a.events.ERROR)},e.onreadystatechange=function(){"loaded"!=e.readyState&&"complete"!=e.readyState||(d=a.utils.loaderstatus.COMPLETE,b.sendEvent(a.events.COMPLETE))},document.getElementsByTagName("head")[0].appendChild(e),e.src=c}},this.getStatus=function(){return d}}}(jwplayer),function(a){a.utils.selectors=function(b,e){a.utils.exists(e)||(e=document);var c=(b=a.utils.strings.trim(b)).charAt(0);if("#"==c)return e.getElementById(b.substr(1));if("."==c)return e.getElementsByClassName?e.getElementsByClassName(b.substr(1)):a.utils.selectors.getElementsByTagAndClass("*",b.substr(1));if(b.indexOf(".")>0){var d=b.split(".");return a.utils.selectors.getElementsByTagAndClass(d[0],d[1])}return e.getElementsByTagName(b)},a.utils.selectors.getElementsByTagAndClass=function(e,h,g){var j=[];a.utils.exists(g)||(g=document);for(var f=g.getElementsByTagName(e),d=0;d<f.length;d++)if(a.utils.exists(f[d].className))for(var c=f[d].className.split(" "),b=0;b<c.length;b++)c[b]==h&&j.push(f[d]);return j}}(jwplayer),function(a){a.utils.strings=function(){},a.utils.strings.trim=function(b){return b.replace(/^\s*/,"").replace(/\s*$/,"")},a.utils.strings.pad=function(c,d,b){for(b||(b="0");c.length<d;)c=b+c;return c},a.utils.strings.serialize=function(b){return null==b?null:"true"==b||"false"!=b&&(isNaN(Number(b))||b.length>5||0==b.length?b:Number(b))},a.utils.strings.seconds=function(d){var b=(d=d.replace(",",".")).split(":"),c=0;return"s"==d.substr(-1)?c=Number(d.substr(0,d.length-1)):"m"==d.substr(-1)?c=60*Number(d.substr(0,d.length-1)):"h"==d.substr(-1)?c=3600*Number(d.substr(0,d.length-1)):b.length>1?(c=Number(b[b.length-1]),c+=60*Number(b[b.length-2]),3==b.length&&(c+=3600*Number(b[b.length-3]))):c=Number(d),c},a.utils.strings.xmlAttribute=function(b,c){for(var d=0;d<b.attributes.length;d++)if(b.attributes[d].name&&b.attributes[d].name.toLowerCase()==c.toLowerCase())return b.attributes[d].value.toString();return""},a.utils.strings.jsonToString=function(f){var h=h||{};if(h&&h.stringify)return h.stringify(f);var c=typeof f;if("object"==c&&null!==f){var g=[],b=f&&f.constructor==Array;for(var d in f){var e=f[d];switch(typeof e){case"string":e='"'+e.replace(/"/g,'\\"')+'"';break;case"object":a.utils.exists(e)&&(e=a.utils.strings.jsonToString(e))}b?"function"!=typeof e&&g.push(String(e)):"function"!=typeof e&&g.push('"'+d+'":'+String(e))}return b?"["+String(g)+"]":"{"+String(g)+"}"}if("string"!=c)return String(f);f='"'+f.replace(/"/g,'\\"')+'"'}}(jwplayer),function(c){function b(f){return["true","false","t","f"].toString().indexOf(f.toLowerCase().replace(" ",""))>=0?"boolean":d.test(f)?"color":isNaN(parseInt(f,10))||parseInt(f,10).toString().length!=f.length?isNaN(parseFloat(f))||parseFloat(f).toString().length!=f.length?"string":"float":"integer"}function e(g,f){if(!c.utils.exists(f))return g;switch(f){case"color":return g.length>0?a(g):null;case"integer":return parseInt(g,10);case"float":return parseFloat(g);case"boolean":return"true"==g.toLowerCase()||"1"==g}return g}function a(f){switch(f.toLowerCase()){case"blue":return parseInt("0000FF",16);case"green":return parseInt("00FF00",16);case"red":return parseInt("FF0000",16);case"cyan":return parseInt("00FFFF",16);case"magenta":return parseInt("FF00FF",16);case"yellow":return parseInt("FFFF00",16);case"black":return parseInt("000000",16);case"white":return parseInt("FFFFFF",16);default:return 3==(f=f.replace(/(#|0x)?([0-9A-F]{3,6})$/gi,"$2")).length&&(f=f.charAt(0)+f.charAt(0)+f.charAt(1)+f.charAt(1)+f.charAt(2)+f.charAt(2)),parseInt(f,16)}return parseInt("000000",16)}var d=new RegExp(/^(#|0x)[0-9a-fA-F]{3,6}/);c.utils.typechecker=function(g,f){return f=c.utils.exists(f)?f:b(g),e(g,f)}}(jwplayer),function(a){a.utils.parsers=function(){},a.utils.parsers.localName=function(b){return b?b.localName?b.localName:b.baseName?b.baseName:"":""},a.utils.parsers.textContent=function(b){return b?b.textContent?b.textContent:b.text?b.text:"":""}}(jwplayer),function(a){a.utils.parsers.jwparser=function(){},a.utils.parsers.jwparser.PREFIX="jwplayer",a.utils.parsers.jwparser.parseEntry=function(c,d){for(var b=0;b<c.childNodes.length;b++)c.childNodes[b].prefix==a.utils.parsers.jwparser.PREFIX&&(d[a.utils.parsers.localName(c.childNodes[b])]=a.utils.strings.serialize(a.utils.parsers.textContent(c.childNodes[b])),"file"==a.utils.parsers.localName(c.childNodes[b])&&d.levels&&delete d.levels),!d.file&&String(d.link).toLowerCase().indexOf("youtube")>-1&&(d.file=d.link);return d},a.utils.parsers.jwparser.getProvider=function(c){if(c.type)return c.type;if(c.file.indexOf("youtube.com/w")>-1||c.file.indexOf("youtube.com/v")>-1||c.file.indexOf("youtu.be/")>-1)return"youtube";if(c.streamer&&0==c.streamer.indexOf("rtmp"))return"rtmp";if(c.streamer&&0==c.streamer.indexOf("http"))return"http";var b=a.utils.strings.extension(c.file);return extensions.hasOwnProperty(b)?extensions[b]:""}}(jwplayer),function(a){a.utils.parsers.mediaparser=function(){},a.utils.parsers.mediaparser.PREFIX="media",a.utils.parsers.mediaparser.parseGroup=function(d,f){for(var e=!1,c=0;c<d.childNodes.length;c++)if(d.childNodes[c].prefix==a.utils.parsers.mediaparser.PREFIX){if(!a.utils.parsers.localName(d.childNodes[c]))continue;switch(a.utils.parsers.localName(d.childNodes[c]).toLowerCase()){case"content":e||(f.file=a.utils.strings.xmlAttribute(d.childNodes[c],"url")),a.utils.strings.xmlAttribute(d.childNodes[c],"duration")&&(f.duration=a.utils.strings.seconds(a.utils.strings.xmlAttribute(d.childNodes[c],"duration"))),a.utils.strings.xmlAttribute(d.childNodes[c],"start")&&(f.start=a.utils.strings.seconds(a.utils.strings.xmlAttribute(d.childNodes[c],"start"))),d.childNodes[c].childNodes&&d.childNodes[c].childNodes.length>0&&(f=a.utils.parsers.mediaparser.parseGroup(d.childNodes[c],f)),(a.utils.strings.xmlAttribute(d.childNodes[c],"width")||a.utils.strings.xmlAttribute(d.childNodes[c],"bitrate")||a.utils.strings.xmlAttribute(d.childNodes[c],"url"))&&(f.levels||(f.levels=[]),f.levels.push({width:a.utils.strings.xmlAttribute(d.childNodes[c],"width"),bitrate:a.utils.strings.xmlAttribute(d.childNodes[c],"bitrate"),file:a.utils.strings.xmlAttribute(d.childNodes[c],"url")}));break;case"title":f.title=a.utils.parsers.textContent(d.childNodes[c]);break;case"description":f.description=a.utils.parsers.textContent(d.childNodes[c]);break;case"keywords":f.tags=a.utils.parsers.textContent(d.childNodes[c]);break;case"thumbnail":f.image=a.utils.strings.xmlAttribute(d.childNodes[c],"url");break;case"credit":f.author=a.utils.parsers.textContent(d.childNodes[c]);break;case"player":var b=d.childNodes[c].url;(b.indexOf("youtube.com")>=0||b.indexOf("youtu.be")>=0)&&(e=!0,f.file=a.utils.strings.xmlAttribute(d.childNodes[c],"url"));break;case"group":a.utils.parsers.mediaparser.parseGroup(d.childNodes[c],f)}}return f}}(jwplayer),function(b){function a(d){for(var e={},c=0;c<d.childNodes.length;c++)if(b.utils.parsers.localName(d.childNodes[c]))switch(b.utils.parsers.localName(d.childNodes[c]).toLowerCase()){case"enclosure":e.file=b.utils.strings.xmlAttribute(d.childNodes[c],"url");break;case"title":e.title=b.utils.parsers.textContent(d.childNodes[c]);break;case"pubdate":e.date=b.utils.parsers.textContent(d.childNodes[c]);break;case"description":e.description=b.utils.parsers.textContent(d.childNodes[c]);break;case"link":e.link=b.utils.parsers.textContent(d.childNodes[c]);break;case"category":e.tags?e.tags+=b.utils.parsers.textContent(d.childNodes[c]):e.tags=b.utils.parsers.textContent(d.childNodes[c])}return e=b.utils.parsers.mediaparser.parseGroup(d,e),e=b.utils.parsers.jwparser.parseEntry(d,e),new b.html5.playlistitem(e)}b.utils.parsers.rssparser=function(){},b.utils.parsers.rssparser.parse=function(f){for(var c=[],e=0;e<f.childNodes.length;e++)if("channel"==b.utils.parsers.localName(f.childNodes[e]).toLowerCase())for(var d=0;d<f.childNodes[e].childNodes.length;d++)"item"==b.utils.parsers.localName(f.childNodes[e].childNodes[d]).toLowerCase()&&c.push(a(f.childNodes[e].childNodes[d]));return c}}(jwplayer),function(a){var c={},b={};a.plugins=function(){},a.plugins.loadPlugins=function(e,d){return b[e]=new a.plugins.pluginloader(new a.plugins.model(c),d),b[e]},a.plugins.registerPlugin=function(h,f,e){var d=a.utils.getPluginName(h);if(c[d])c[d].registerPlugin(h,f,e);else{a.utils.log("A plugin ("+h+") was registered with the player that was not loaded. Please check your configuration.");for(var g in b)b[g].pluginFailed()}}}(jwplayer),function(a){a.plugins.model=function(b){this.addPlugin=function(c){var d=a.utils.getPluginName(c);return b[d]||(b[d]=new a.plugins.plugin(c)),b[d]}}}(jwplayer),function(a){a.plugins.pluginmodes={FLASH:"FLASH",JAVASCRIPT:"JAVASCRIPT",HYBRID:"HYBRID"},a.plugins.plugin=function(b){function e(){switch(a.utils.getPluginPathType(b)){case a.utils.pluginPathType.ABSOLUTE:return b;case a.utils.pluginPathType.RELATIVE:return a.utils.getAbsolutePath(b,window.location.href);case a.utils.pluginPathType.CDN:var o=a.utils.getPluginName(b),n=a.utils.getPluginVersion(b);return(0==window.location.href.indexOf("https://")?d.replace("http://","https://secure"):d)+"/"+a.version.split(".")[0]+"/"+o+"/"+o+(""!==n?"-"+n:"")+".js"}}function g(m){l=setTimeout(function(){j=a.utils.loaderstatus.COMPLETE,c.sendEvent(a.events.COMPLETE)},1e3)}function f(m){j=a.utils.loaderstatus.ERROR,c.sendEvent(a.events.ERROR)}var k,h,l,d="http://lp.longtailvideo.com",j=a.utils.loaderstatus.NEW,c=new a.events.eventdispatcher;a.utils.extend(this,c),this.load=function(){if(j==a.utils.loaderstatus.NEW){if(b.lastIndexOf(".swf")>0)return k=b,j=a.utils.loaderstatus.COMPLETE,void c.sendEvent(a.events.COMPLETE);j=a.utils.loaderstatus.LOADING;var m=new a.utils.scriptloader(e());m.addEventListener(a.events.COMPLETE,g),m.addEventListener(a.events.ERROR,f),m.load()}},this.registerPlugin=function(o,n,m){l&&(clearTimeout(l),l=void 0),n&&m?(k=m,h=n):"string"==typeof n?k=n:"function"==typeof n?h=n:n||m||(k=o),j=a.utils.loaderstatus.COMPLETE,c.sendEvent(a.events.COMPLETE)},this.getStatus=function(){return j},this.getPluginName=function(){return a.utils.getPluginName(b)},this.getFlashPath=function(){if(k)switch(a.utils.getPluginPathType(k)){case a.utils.pluginPathType.ABSOLUTE:return k;case a.utils.pluginPathType.RELATIVE:return b.lastIndexOf(".swf")>0?a.utils.getAbsolutePath(k,window.location.href):a.utils.getAbsolutePath(k,e());case a.utils.pluginPathType.CDN:return k.indexOf("-")>-1?k+"h":k+"-h"}return null},this.getJS=function(){return h},this.getPluginmode=function(){return void 0!==k&&void 0!==h?a.plugins.pluginmodes.HYBRID:void 0!==k?a.plugins.pluginmodes.FLASH:void 0!==h?a.plugins.pluginmodes.JAVASCRIPT:void 0},this.getNewInstance=function(n,m,o){return new h(n,m,o)},this.getURL=function(){return b}}}(jwplayer),function(a){a.plugins.pluginloader=function(h,e){function f(){b||(b=!0,k=a.utils.loaderstatus.COMPLETE,c.sendEvent(a.events.COMPLETE))}function j(){if(!b){var m=0;for(plugin in g){var l=g[plugin].getStatus();l!=a.utils.loaderstatus.LOADING&&l!=a.utils.loaderstatus.NEW||m++}0==m&&f()}}var g={},k=a.utils.loaderstatus.NEW,d=!1,b=!1,c=new a.events.eventdispatcher;a.utils.extend(this,c),this.setupPlugins=function(n,l,s){var m={length:0,plugins:{}},p={length:0,plugins:{}};for(var o in g){var q=g[o].getPluginName();if(g[o].getFlashPath()&&(m.plugins[g[o].getFlashPath()]=l.plugins[o],m.plugins[g[o].getFlashPath()].pluginmode=g[o].getPluginmode(),m.length++),g[o].getJS()){var r=document.createElement("div");r.id=n.id+"_"+q,r.style.position="absolute",r.style.zIndex=p.length+10,p.plugins[q]=g[o].getNewInstance(n,l.plugins[o],r),p.length++,void 0!==p.plugins[q].resize&&(n.onReady(s(p.plugins[q],r,!0)),n.onResize(s(p.plugins[q],r)))}}return n.plugins=p.plugins,m},this.load=function(){k=a.utils.loaderstatus.LOADING,d=!0;for(var l in e)a.utils.exists(l)&&(g[l]=h.addPlugin(l),g[l].addEventListener(a.events.COMPLETE,j),g[l].addEventListener(a.events.ERROR,j));for(l in g)g[l].load();d=!1,j()},this.pluginFailed=function(){f()},this.getStatus=function(){return k}}}(jwplayer),function(b){var a=[];b.api=function(d){function e(v,u){return function(A,w,x,y){if("flash"==v.renderingMode||"html5"==v.renderingMode){var z;w?(j[A]=w,z="jwplayer('"+v.id+"').callback('"+A+"')"):!w&&j[A]&&delete j[A],g.jwDockSetButton(A,z,x,y)}return u}}function q(u){h=[],b.utils.getOuterHTML(u.container)!=o&&b.api.destroyPlayer(u.id,o)}function f(u){return function(w){var v=w.newstate,y=w.oldstate;if(v==u){var x=t[v];if(x)for(var z=0;z<x.length;z++)"function"==typeof x[z]&&x[z].call(this,{oldstate:y,newstate:v})}}}function l(u,v){return function(x){if(u==x.component){var w=p[u][v];if(w)for(var y=0;y<w.length;y++)"function"==typeof w[y]&&w[y].call(this,x)}}}this.container=d,this.id=d.id;var m={},t={},p={},g=void 0,k=!1,h=[],r=void 0,o=b.utils.getOuterHTML(d),s={},j={};return this.getBuffer=function(){return this.callInternal("jwGetBuffer")},this.getContainer=function(){return this.container},this.getPlugin=function(u){var w=this,v={};return"dock"==u?b.utils.extend(v,{setButton:e(w,v),show:function(){return w.callInternal("jwDockShow"),v},hide:function(){return w.callInternal("jwDockHide"),v},onShow:function(x){return w.componentListener("dock",b.api.events.JWPLAYER_COMPONENT_SHOW,x),v},onHide:function(x){return w.componentListener("dock",b.api.events.JWPLAYER_COMPONENT_HIDE,x),v}}):"controlbar"==u?b.utils.extend(v,{show:function(){return w.callInternal("jwControlbarShow"),v},hide:function(){return w.callInternal("jwControlbarHide"),v},onShow:function(x){return w.componentListener("controlbar",b.api.events.JWPLAYER_COMPONENT_SHOW,x),v},onHide:function(x){return w.componentListener("controlbar",b.api.events.JWPLAYER_COMPONENT_HIDE,x),v}}):"display"==u?b.utils.extend(v,{show:function(){return w.callInternal("jwDisplayShow"),v},hide:function(){return w.callInternal("jwDisplayHide"),v},onShow:function(x){return w.componentListener("display",b.api.events.JWPLAYER_COMPONENT_SHOW,x),v},onHide:function(x){return w.componentListener("display",b.api.events.JWPLAYER_COMPONENT_HIDE,x),v}}):this.plugins[u]},this.callback=function(u){if(j[u])return j[u]()},this.getDuration=function(){return this.callInternal("jwGetDuration")},this.getFullscreen=function(){return this.callInternal("jwGetFullscreen")},this.getHeight=function(){return this.callInternal("jwGetHeight")},this.getLockState=function(){return this.callInternal("jwGetLockState")},this.getMeta=function(){return this.getItemMeta()},this.getMute=function(){return this.callInternal("jwGetMute")},this.getPlaylist=function(){var v=this.callInternal("jwGetPlaylist");"flash"==this.renderingMode&&b.utils.deepReplaceKeyName(v,["__dot__","__spc__","__dsh__"],["."," ","-"]);for(var u=0;u<v.length;u++)b.utils.exists(v[u].index)||(v[u].index=u);return v},this.getPlaylistItem=function(u){return b.utils.exists(u)||(u=this.getCurrentItem()),this.getPlaylist()[u]},this.getPosition=function(){return this.callInternal("jwGetPosition")},this.getRenderingMode=function(){return this.renderingMode},this.getState=function(){return this.callInternal("jwGetState")},this.getVolume=function(){return this.callInternal("jwGetVolume")},this.getWidth=function(){return this.callInternal("jwGetWidth")},this.setFullscreen=function(u){return b.utils.exists(u)?this.callInternal("jwSetFullscreen",u):this.callInternal("jwSetFullscreen",!this.callInternal("jwGetFullscreen")),this},this.setMute=function(u){return b.utils.exists(u)?this.callInternal("jwSetMute",u):this.callInternal("jwSetMute",!this.callInternal("jwGetMute")),this},this.lock=function(){return this},this.unlock=function(){return this},this.load=function(u){return this.callInternal("jwLoad",u),this},this.playlistItem=function(u){return this.callInternal("jwPlaylistItem",u),this},this.playlistPrev=function(){return this.callInternal("jwPlaylistPrev"),this},this.playlistNext=function(){return this.callInternal("jwPlaylistNext"),this},this.resize=function(v,u){if("html5"==this.renderingMode)g.jwResize(v,u);else{this.container.width=v,this.container.height=u;var w=document.getElementById(this.id+"_wrapper");w&&(w.style.width=v+"px",w.style.height=u+"px")}return this},this.play=function(u){return void 0===u?(u=this.getState())==b.api.events.state.PLAYING||u==b.api.events.state.BUFFERING?this.callInternal("jwPause"):this.callInternal("jwPlay"):this.callInternal("jwPlay",u),this},this.pause=function(u){return void 0===u?(u=this.getState())==b.api.events.state.PLAYING||u==b.api.events.state.BUFFERING?this.callInternal("jwPause"):this.callInternal("jwPlay"):this.callInternal("jwPause",u),this},this.stop=function(){return this.callInternal("jwStop"),this},this.seek=function(u){return this.callInternal("jwSeek",u),this},this.setVolume=function(u){return this.callInternal("jwSetVolume",u),this},this.loadInstream=function(v,u){return r=new b.api.instream(this,g,v,u)},this.onBufferChange=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BUFFER,u)},this.onBufferFull=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BUFFER_FULL,u)},this.onError=function(u){return this.eventListener(b.api.events.JWPLAYER_ERROR,u)},this.onFullscreen=function(u){return this.eventListener(b.api.events.JWPLAYER_FULLSCREEN,u)},this.onMeta=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_META,u)},this.onMute=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_MUTE,u)},this.onPlaylist=function(u){return this.eventListener(b.api.events.JWPLAYER_PLAYLIST_LOADED,u)},this.onPlaylistItem=function(u){return this.eventListener(b.api.events.JWPLAYER_PLAYLIST_ITEM,u)},this.onReady=function(u){return this.eventListener(b.api.events.API_READY,u)},this.onResize=function(u){return this.eventListener(b.api.events.JWPLAYER_RESIZE,u)},this.onComplete=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_COMPLETE,u)},this.onSeek=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_SEEK,u)},this.onTime=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_TIME,u)},this.onVolume=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_VOLUME,u)},this.onBeforePlay=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BEFOREPLAY,u)},this.onBeforeComplete=function(u){return this.eventListener(b.api.events.JWPLAYER_MEDIA_BEFORECOMPLETE,u)},this.onBuffer=function(u){return this.stateListener(b.api.events.state.BUFFERING,u)},this.onPause=function(u){return this.stateListener(b.api.events.state.PAUSED,u)},this.onPlay=function(u){return this.stateListener(b.api.events.state.PLAYING,u)},this.onIdle=function(u){return this.stateListener(b.api.events.state.IDLE,u)},this.remove=function(){if(!k)throw"Cannot call remove() before player is ready";q(this)},this.setup=function(v){if(b.embed){var u=this.id;q(this);var w=b(u);return w.config=v,new b.embed(w)}return this},this.registerPlugin=function(w,v,u){b.plugins.registerPlugin(w,v,u)},this.setPlayer=function(u,v){g=u,this.renderingMode=v},this.stateListener=function(u,v){return t[u]||(t[u]=[],this.eventListener(b.api.events.JWPLAYER_PLAYER_STATE,f(u))),t[u].push(v),this},this.detachMedia=function(){if("html5"==this.renderingMode)return this.callInternal("jwDetachMedia")},this.attachMedia=function(){if("html5"==this.renderingMode)return this.callInternal("jwAttachMedia")},this.componentListener=function(u,v,w){return p[u]||(p[u]={}),p[u][v]||(p[u][v]=[],this.eventListener(v,l(u,v))),p[u][v].push(w),this},this.addInternalListener=function(u,v){try{u.jwAddEventListener(v,'function(dat) { jwplayer("'+this.id+'").dispatchEvent("'+v+'", dat); }')}catch(w){b.utils.log("Could not add internal listener")}},this.eventListener=function(u,v){return m[u]||(m[u]=[],g&&k&&this.addInternalListener(g,u)),m[u].push(v),this},this.dispatchEvent=function(w){if(m[w])for(var v=_utils.translateEventResponse(w,arguments[1]),u=0;u<m[w].length;u++)"function"==typeof m[w][u]&&m[w][u].call(this,v)},this.dispatchInstreamEvent=function(u){r&&r.dispatchEvent(u,arguments)},this.callInternal=function(){if(k){for(var w=arguments[0],u=[],v=1;v<arguments.length;v++)u.push(arguments[v]);return void 0!==g&&"function"==typeof g[w]?2==u.length?g[w](u[0],u[1]):1==u.length?g[w](u[0]):g[w]():null}h.push(arguments)},this.playerReady=function(v){k=!0,g||this.setPlayer(document.getElementById(v.id)),this.container=document.getElementById(this.id);for(var u in m)this.addInternalListener(g,u);for(this.eventListener(b.api.events.JWPLAYER_PLAYLIST_ITEM,function(w){s={}}),this.eventListener(b.api.events.JWPLAYER_MEDIA_META,function(w){b.utils.extend(s,w.metadata)}),this.dispatchEvent(b.api.events.API_READY);h.length>0;)this.callInternal.apply(this,h.shift())},this.getItemMeta=function(){return s},this.getCurrentItem=function(){return this.callInternal("jwGetPlaylistIndex")},this},b.api.selectPlayer=function(d){var c;if(b.utils.exists(d)||(d=0),d.nodeType?c=d:"string"==typeof d&&(c=document.getElementById(d)),c){var e=b.api.playerById(c.id);return e||b.api.addPlayer(new b.api(c))}return"number"==typeof d?b.getPlayers()[d]:null},b.api.events={API_READY:"jwplayerAPIReady",JWPLAYER_READY:"jwplayerReady",JWPLAYER_FULLSCREEN:"jwplayerFullscreen",JWPLAYER_RESIZE:"jwplayerResize",JWPLAYER_ERROR:"jwplayerError",JWPLAYER_MEDIA_BEFOREPLAY:"jwplayerMediaBeforePlay",JWPLAYER_MEDIA_BEFORECOMPLETE:"jwplayerMediaBeforeComplete",JWPLAYER_COMPONENT_SHOW:"jwplayerComponentShow",JWPLAYER_COMPONENT_HIDE:"jwplayerComponentHide",JWPLAYER_MEDIA_BUFFER:"jwplayerMediaBuffer",JWPLAYER_MEDIA_BUFFER_FULL:"jwplayerMediaBufferFull",JWPLAYER_MEDIA_ERROR:"jwplayerMediaError",JWPLAYER_MEDIA_LOADED:"jwplayerMediaLoaded",JWPLAYER_MEDIA_COMPLETE:"jwplayerMediaComplete",JWPLAYER_MEDIA_SEEK:"jwplayerMediaSeek",JWPLAYER_MEDIA_TIME:"jwplayerMediaTime",JWPLAYER_MEDIA_VOLUME:"jwplayerMediaVolume",JWPLAYER_MEDIA_META:"jwplayerMediaMeta",JWPLAYER_MEDIA_MUTE:"jwplayerMediaMute",JWPLAYER_PLAYER_STATE:"jwplayerPlayerState",JWPLAYER_PLAYLIST_LOADED:"jwplayerPlaylistLoaded",JWPLAYER_PLAYLIST_ITEM:"jwplayerPlaylistItem",JWPLAYER_INSTREAM_CLICK:"jwplayerInstreamClicked",JWPLAYER_INSTREAM_DESTROYED:"jwplayerInstreamDestroyed"},b.api.events.state={BUFFERING:"BUFFERING",IDLE:"IDLE",PAUSED:"PAUSED",PLAYING:"PLAYING"},b.api.playerById=function(d){for(var c=0;c<a.length;c++)if(a[c].id==d)return a[c];return null},b.api.addPlayer=function(c){for(var d=0;d<a.length;d++)if(a[d]==c)return c;return a.push(c),c},b.api.destroyPlayer=function(h,d){for(var g=-1,l=0;l<a.length;l++)a[l].id!=h||(g=l);if(g>=0){try{a[g].callInternal("jwDestroy")}catch(k){}var c=document.getElementById(a[g].id);if(document.getElementById(a[g].id+"_wrapper")&&(c=document.getElementById(a[g].id+"_wrapper")),c)if(d)b.utils.setOuterHTML(c,d);else{var j=document.createElement("div"),f=c.id;c.id.indexOf("_wrapper")==c.id.length-8&&(newID=c.id.substring(0,c.id.length-8)),j.setAttribute("id",f),c.parentNode.replaceChild(j,c)}a.splice(g,1)}return null},b.getPlayers=function(){return a.slice(0)}}(jwplayer);var _userPlayerReady="function"==typeof playerReady?playerReady:void 0;playerReady=function(b){var a=jwplayer.api.playerById(b.id);a?a.playerReady(b):jwplayer.api.selectPlayer(b.id).playerReady(b),_userPlayerReady&&_userPlayerReady.call(this,b)},function(a){a.api.instream=function(c,j,n,q){function m(r,s){b.jwInstreamAddEventListener(s,'function(dat) { jwplayer("'+h.id+'").dispatchInstreamEvent("'+s+'", dat); }')}function d(r,s){return e[r]||(e[r]=[],m(b,r)),e[r].push(s),this}function o(r,s){return p[r]||(p[r]=[],d(a.api.events.JWPLAYER_PLAYER_STATE,l(r))),p[r].push(s),this}function l(r){return function(t){var s=t.newstate,v=t.oldstate;if(s==r){var u=p[s];if(u)for(var w=0;w<u.length;w++)"function"==typeof u[w]&&u[w].call(this,{oldstate:v,newstate:s,type:t.type})}}}var h=c,b=j,e={},p={};this.dispatchEvent=function(u,t){if(e[u])for(var s=_utils.translateEventResponse(u,t[1]),r=0;r<e[u].length;r++)"function"==typeof e[u][r]&&e[u][r].call(this,s)},this.onError=function(r){return d(a.api.events.JWPLAYER_ERROR,r)},this.onFullscreen=function(r){return d(a.api.events.JWPLAYER_FULLSCREEN,r)},this.onMeta=function(r){return d(a.api.events.JWPLAYER_MEDIA_META,r)},this.onMute=function(r){return d(a.api.events.JWPLAYER_MEDIA_MUTE,r)},this.onComplete=function(r){return d(a.api.events.JWPLAYER_MEDIA_COMPLETE,r)},this.onSeek=function(r){return d(a.api.events.JWPLAYER_MEDIA_SEEK,r)},this.onTime=function(r){return d(a.api.events.JWPLAYER_MEDIA_TIME,r)},this.onVolume=function(r){return d(a.api.events.JWPLAYER_MEDIA_VOLUME,r)},this.onBuffer=function(r){return o(a.api.events.state.BUFFERING,r)},this.onPause=function(r){return o(a.api.events.state.PAUSED,r)},this.onPlay=function(r){return o(a.api.events.state.PLAYING,r)},this.onIdle=function(r){return o(a.api.events.state.IDLE,r)},this.onInstreamClick=function(r){return d(a.api.events.JWPLAYER_INSTREAM_CLICK,r)},this.onInstreamDestroyed=function(r){return d(a.api.events.JWPLAYER_INSTREAM_DESTROYED,r)},this.play=function(r){b.jwInstreamPlay(r)},this.pause=function(r){b.jwInstreamPause(r)},this.seek=function(r){b.jwInstreamSeek(r)},this.destroy=function(){b.jwInstreamDestroy()},this.getState=function(){return b.jwInstreamGetState()},this.getDuration=function(){return b.jwInstreamGetDuration()},this.getPosition=function(){return b.jwInstreamGetPosition()},h.callInternal("jwLoadInstream",n,q)}}(jwplayer),function(a){function b(){if(!document.body)return setTimeout(b,15);for(var d=c.selectors.getElementsByTagAndClass("video","jwplayer"),e=0;e<d.length;e++){var f=d[e];""==f.id&&(f.id="jwplayer_"+Math.round(1e5*Math.random())),a(f.id).setup({})}}var c=a.utils;a.embed=function(h){function d(n,m){for(var l in m)"function"==typeof n[l]&&n[l].call(n,m[l])}function e(){if(j.getStatus()==c.loaderstatus.COMPLETE){for(var n=0;n<f.modes.length;n++)if(f.modes[n].type&&a.embed[f.modes[n].type]){var p=f.modes[n].config,t=f;if(p){t=c.extend(c.clone(f),p);for(var s=["file","levels","playlist"],m=0;m<s.length;m++){var q=s[m];if(c.exists(p[q]))for(var l=0;l<s.length;l++)if(l!=m){var o=s[l];c.exists(t[o])&&!c.exists(p[o])&&delete t[o]}}}var r=new a.embed[f.modes[n].type](document.getElementById(h.id),f.modes[n],t,j,h);if(r.supportsConfig())return r.embed(),d(h,f.events),h}c.log("No suitable players found"),new a.embed.logo(c.extend({hide:!0},f.components.logo),"none",h.id)}}var k={width:400,height:300,components:{controlbar:{position:"over"}}},g=c.mediaparser.parseMedia(h.container),f=new a.embed.config(c.extend(k,g,h.config),this),j=a.plugins.loadPlugins(h.id,f.plugins);return j.addEventListener(a.events.COMPLETE,e),j.addEventListener(a.events.ERROR,e),j.load(),h},b()}(jwplayer),function(e){function h(m){var l=[{type:"flash",src:m||"/jwplayer/player.swf"},{type:"html5"},{type:"download"}];return k.isAndroid()&&(l[0]=l.splice(1,1,l[0])[0]),l}function c(m){return m instanceof Array||"object"==typeof m&&!m.position&&!m.size}function j(l){return"string"==typeof l&&(parseInt(l).toString()==l||l.toLowerCase().indexOf("px")>-1)?parseInt(l):l}function f(l){var o={};switch(k.typeOf(l.plugins)){case"object":for(var n in l.plugins)o[k.getPluginName(n)]=n;break;case"string":for(var p=l.plugins.split(","),m=0;m<p.length;m++)o[k.getPluginName(p[m])]=p[m]}return o}function d(p,o,n,l){"object"!=k.typeOf(p[o])&&(p[o]={});var m=p[o][n];if("object"!=k.typeOf(m)&&(p[o][n]=m={}),l)if("plugins"==o){var q=k.getPluginName(n);m[l]=p[q+"."+l],delete p[q+"."+l]}else m[l]=p[n+"."+l],delete p[n+"."+l]}var k=e.utils,a={players:"modes",autoplay:"autostart"},g=["playlist","dock","controlbar","logo","display"];e.embed.deserialize=function(m){var n=f(m);for(var l in n)d(m,"plugins",n[l]);for(var q in m)if(q.indexOf(".")>-1){var p=q.split("."),o=p[0],q=p[1];k.isInArray(g,o)?d(m,"components",o,q):n[o]&&d(m,"plugins",n[o],q)}return m},e.embed.config=function(l,v){var s,u=k.extend({},l);if(c(u.playlist)&&(s=u.playlist,delete u.playlist),u=e.embed.deserialize(u),u.height=j(u.height),u.width=j(u.width),"string"==typeof u.plugins){var m=u.plugins.split(",");"object"!=typeof u.plugins&&(u.plugins={});for(var q=0;q<m.length;q++){var r=k.getPluginName(m[q]);"object"==typeof u[r]?(u.plugins[m[q]]=u[r],delete u[r]):u.plugins[m[q]]={}}}for(var t=0;t<g.length;t++){var p=g[t];k.exists(u[p])&&("object"!=typeof u[p]?(u.components[p]||(u.components[p]={}),"logo"==p?u.components[p].file=u[p]:u.components[p].position=u[p],delete u[p]):(u.components[p]||(u.components[p]={}),k.extend(u.components[p],u[p]),delete u[p])),void 0!==u[p+"size"]&&(u.components[p]||(u.components[p]={}),u.components[p].size=u[p+"size"],delete u[p+"size"])}void 0!==u.icons&&(u.components.display||(u.components.display={}),u.components.display.icons=u.icons,delete u.icons);for(var o in a)u[o]&&(u[a[o]]||(u[a[o]]=u[o]),delete u[o]);var n;return u.flashplayer&&!u.modes?(n=h(u.flashplayer),delete u.flashplayer):u.modes?("string"==typeof u.modes?n=h(u.modes):u.modes instanceof Array?n=u.modes:"object"==typeof u.modes&&u.modes.type&&(n=[u.modes]),delete u.modes):n=h(),u.modes=n,s&&(u.playlist=s),u}}(jwplayer),function(a){a.embed.download=function(c,g,b,d,f){function e(j,l,h){if(h)return!1;var k=["image","sound","youtube","http"];if(l&&k.toString().indexOf(l)>-1)return!0;if(!l||l&&"video"==l){var m=a.utils.extension(j);if(m&&a.utils.extensionmap[m])return!0}return!1}this.embed=function(){function t(){a.utils.stretch(a.utils.stretching.UNIFORM,q.display_image,j,m,_imageWidth,_imageHeight)}a.utils.extend({},b);var q={},j=b.width?b.width:480;"number"!=typeof j&&(j=parseInt(j,10));var m=b.height?b.height:320;"number"!=typeof m&&(m=parseInt(m,10));var u,o,n,s={};b.playlist&&b.playlist.length?(s.file=b.playlist[0].file,o=b.playlist[0].image,s.levels=b.playlist[0].levels):(s.file=b.file,o=b.image,s.levels=b.levels),s.file?u=s.file:s.levels&&s.levels.length&&(u=s.levels[0].file);var l={display:{style:{cursor:n=u?"pointer":"auto",width:j,height:m,backgroundColor:"#000",position:"relative",textDecoration:"none",border:"none",display:"block"}},display_icon:{style:{cursor:n,position:"absolute",display:u?"block":"none",top:0,left:0,border:0,margin:0,padding:0,zIndex:3,width:50,height:50,backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALdJREFUeNrs18ENgjAYhmFouDOCcQJGcARHgE10BDcgTOIosAGwQOuPwaQeuFRi2p/3Sb6EC5L3QCxZBgAAAOCorLW1zMn65TrlkH4NcV7QNcUQt7Gn7KIhxA+qNIR81spOGkL8oFJDyLJRdosqKDDkK+iX5+d7huzwM40xptMQMkjIOeRGo+VkEVvIPfTGIpKASfYIfT9iCHkHrBEzf4gcUQ56aEzuGK/mw0rHpy4AAACAf3kJMACBxjAQNRckhwAAAABJRU5ErkJggg==)"}},display_iconBackground:{style:{cursor:n,position:"absolute",display:u?"block":"none",top:(m-50)/2,left:(j-50)/2,border:0,width:50,height:50,margin:0,padding:0,zIndex:2,backgroundImage:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEpJREFUeNrszwENADAIA7DhX8ENoBMZ5KR10EryckCJiIiIiIiIiIiIiIiIiIiIiIh8GmkRERERERERERERERERERERERGRHSPAAPlXH1phYpYaAAAAAElFTkSuQmCC)"}},display_image:{style:{width:j,height:m,display:o?"block":"none",position:"absolute",cursor:n,left:0,top:0,margin:0,padding:0,textDecoration:"none",zIndex:1,border:"none"}}},h=function(v,x,y){var w=document.createElement(v);return w.id=y||c.id+"_jwplayer_"+x,a.utils.css(w,l[x].style),w};q.display=h("a","display",c.id),u&&q.display.setAttribute("href",a.utils.getAbsolutePath(u)),q.display_image=h("img","display_image"),q.display_image.setAttribute("alt","Click to download..."),o&&q.display_image.setAttribute("src",a.utils.getAbsolutePath(o)),q.display_icon=h("div","display_icon"),q.display_iconBackground=h("div","display_iconBackground"),q.display.appendChild(q.display_image),q.display_iconBackground.appendChild(q.display_icon),q.display.appendChild(q.display_iconBackground),_css=a.utils.css,_hide=function(v){_css(v,{display:"none"})},q.display_image.onerror=function(v){_hide(q.display_image)},q.display_image.onload=function(v){_imageWidth=q.display_image.naturalWidth,_imageHeight=q.display_image.naturalHeight,t()},c.parentNode.replaceChild(q.display,c);b.plugins&&b.plugins.logo&&b.plugins.logo;q.display.appendChild(new a.embed.logo(b.components.logo,"download",c.id)),f.container=document.getElementById(f.id),f.setPlayer(q.display,"download")},this.supportsConfig=function(){if(!b)return!0;var j=a.utils.getFirstPlaylistItemFromConfig(b);if(void 0===j.file&&void 0===j.levels)return!0;if(j.file)return e(j.file,j.provider,j.playlistfile);if(j.levels&&j.levels.length)for(var h=0;h<j.levels.length;h++)if(j.levels[h].file&&e(j.levels[h].file,j.provider,j.playlistfile))return!0}}}(jwplayer),function(a){a.embed.flash=function(f,g,l,e,j){function m(o,n,p){var q=document.createElement("param");q.setAttribute("name",n),q.setAttribute("value",p),o.appendChild(q)}function k(o,p,n){return function(q){n&&document.getElementById(j.id+"_wrapper").appendChild(p);var s=document.getElementById(j.id).getPluginConfig("display");o.resize(s.width,s.height);var r={left:s.x,top:s.y};a.utils.css(p,r)}}function h(q,p){if(q[p]){var s=q[p];for(var o in s){var n=s[o];if("string"==typeof n)q[o]||(q[o]=n);else for(var r in n)q[o+"."+r]||(q[o+"."+r]=n[r])}delete q[p]}}function b(q){if(!q)return{};var t={},s=[];for(var n in q){var p=a.utils.getPluginName(n),o=q[n];s.push(n);for(var r in o)t[p+"."+r]=o[r]}return t.plugins=s.join(","),t}function c(p){var n=p.netstreambasepath?"":"netstreambasepath="+encodeURIComponent(window.location.href.split("#")[0])+"&";for(var o in p)"object"==typeof p[o]?n+=o+"="+encodeURIComponent("[[JSON]]"+a.utils.strings.jsonToString(p[o]))+"&":n+=o+"="+encodeURIComponent(p[o])+"&";return n.substring(0,n.length-1)}this.embed=function(){l.id=j.id;var A,r=a.utils.extend({},l),o=r.width,y=r.height;f.id+"_wrapper"==f.parentNode.id?A=document.getElementById(f.id+"_wrapper"):((A=document.createElement("div")).id=f.id+"_wrapper",a.utils.wrap(f,A),a.utils.css(A,{position:"relative",width:o,height:y}));var p=e.setupPlugins(j,r,k);p.length>0?a.utils.extend(r,b(p.plugins)):delete r.plugins;for(var s=["height","width","modes","events"],v=0;v<s.length;v++)delete r[s[v]];var q="opaque";r.wmode&&(q=r.wmode),h(r,"components"),h(r,"providers"),void 0!==r["dock.position"]&&"false"==r["dock.position"].toString().toLowerCase()&&(r.dock=r["dock.position"],delete r["dock.position"]);var x=a.utils.getCookies();for(var n in x)void 0===r[n]&&(r[n]=x[n]);var u;if(a.utils.isIE()){var w='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" bgcolor="#000000" width="100%" height="100%" id="'+f.id+'" name="'+f.id+'" tabindex=0"">';w+='<param name="movie" value="'+g.src+'">',w+='<param name="allowfullscreen" value="true">',w+='<param name="allowscriptaccess" value="always">',w+='<param name="seamlesstabbing" value="true">',w+='<param name="wmode" value="'+q+'">',w+='<param name="flashvars" value="'+c(r)+'">',w+="</object>",a.utils.setOuterHTML(f,w),u=document.getElementById(f.id)}else{var t=document.createElement("object");t.setAttribute("type","application/x-shockwave-flash"),t.setAttribute("data",g.src),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("bgcolor","#000000"),t.setAttribute("id",f.id),t.setAttribute("name",f.id),t.setAttribute("tabindex",0),m(t,"allowfullscreen","true"),m(t,"allowscriptaccess","always"),m(t,"seamlesstabbing","true"),m(t,"wmode",q),m(t,"flashvars",c(r)),f.parentNode.replaceChild(t,f),u=t}j.container=u,j.setPlayer(u,"flash")},this.supportsConfig=function(){if(a.utils.hasFlash()){if(!l)return!0;var o=a.utils.getFirstPlaylistItemFromConfig(l);if(void 0===o.file&&void 0===o.levels)return!0;if(o.file)return flashCanPlay(o.file,o.provider);if(o.levels&&o.levels.length)for(var n=0;n<o.levels.length;n++)if(o.levels[n].file&&flashCanPlay(o.levels[n].file,o.provider))return!0}return!1},flashCanPlay=function(n,p){var o=["video","http","sound","image"];if(p&&o.toString().indexOf(p)<0)return!0;var q=a.utils.extension(n);return!q||!(a.utils.exists(a.utils.extensionmap[q])&&!a.utils.exists(a.utils.extensionmap[q].flash))}}}(jwplayer),function(a){a.embed.html5=function(c,g,b,d,f){function e(j,k,h){return function(l){var m=document.getElementById(c.id+"_displayarea");h&&m.appendChild(k),j.resize(m.clientWidth,m.clientHeight),k.left=m.style.left,k.top=m.style.top}}this.embed=function(){if(!a.html5)return null;d.setupPlugins(f,b,e),c.innerHTML="";for(var j=a.utils.extend({screencolor:"0x000000"},b),h=["plugins","modes","events"],k=0;k<h.length;k++)delete j[h[k]];j.levels&&!j.sources&&(j.sources=b.levels),j.skin&&j.skin.toLowerCase().indexOf(".zip")>0&&(j.skin=j.skin.replace(/\.zip/i,".xml"));var l=new(a.html5(c).setup)(j);f.container=document.getElementById(f.id),f.setPlayer(l,"html5")},this.supportsConfig=function(){if(a.vid.canPlayType){if(!b)return!0;var j=a.utils.getFirstPlaylistItemFromConfig(b);if(void 0===j.file&&void 0===j.levels)return!0;if(j.file)return html5CanPlay(a.vid,j.file,j.provider,j.playlistfile);if(j.levels&&j.levels.length)for(var h=0;h<j.levels.length;h++)if(j.levels[h].file&&html5CanPlay(a.vid,j.levels[h].file,j.provider,j.playlistfile))return!0}return!1},html5CanPlay=function(k,j,l,h){if(h)return!1;if(l&&"youtube"==l)return!0;if(l&&"video"!=l&&"http"!=l&&"sound"!=l)return!1;if(null!==navigator.userAgent.match(/BlackBerry/i))return!1;var m=a.utils.extension(j);return!a.utils.exists(m)||!a.utils.exists(a.utils.extensionmap[m])||!!a.utils.exists(a.utils.extensionmap[m].html5)&&(!(!a.utils.isLegacyAndroid()||!m.match(/m4v|mp4/))||browserCanPlay(k,a.utils.extensionmap[m].html5))},browserCanPlay=function(j,h){return!h||(!!j.canPlayType(h)||!("audio/mp3"!=h||!navigator.userAgent.match(/safari/i))&&j.canPlayType("audio/mpeg"))}}}(jwplayer),function(a){a.embed.logo=function(m,l,d){function o(){if(j.prefix){var q=a.version.split(/\W/).splice(0,2).join("/");j.prefix.indexOf(q)<0&&(j.prefix+=q+"/")}h=a.utils.extend({},j,m)}function p(){var s={border:"none",textDecoration:"none",position:"absolute",cursor:"pointer",zIndex:10};s.display=h.hide?"none":"block";var r=h.position.toLowerCase().split("-");for(var q in r)s[r[q]]=h.margin;return s}function c(){(b=document.createElement("img")).id=d+"_jwplayer_logo",b.style.display="none",b.onload=function(q){_css(b,p()),e()},h.file&&(0===h.file.indexOf("http://")?b.src=h.file:b.src=h.prefix+h.file)}function f(){h.link?(b.onmouseover=g,b.onmouseout=e,b.onclick=n):this.mouseEnabled=!1}function n(q){void 0!==q&&(q.preventDefault(),q.stopPropagation()),h.link&&window.open(h.link,h.linktarget)}function e(q){h.link&&(b.style.opacity=h.out)}function g(q){h.hide&&(b.style.opacity=h.over)}var j={prefix:"http://l.longtailvideo.com/"+l+"/",file:"",link:"",linktarget:"_top",margin:8,out:.5,over:1,timeout:5,hide:!1,position:"bottom-left"};_css=a.utils.css;var b,h;if(o(),c(),f(),h.file)return b}}(jwplayer),function(a){a.html5=function(b){var c=b;return this.setup=function(d){return a.utils.extend(this,new a.html5.api(c,d)),this},this}}(jwplayer),function(a){var d=a.utils,b=d.css,c=d.isIOS();a.html5.view=function(n,H,h){function L(){(R=document.createElement("div")).id=y.id,R.className=y.className,_videowrapper=document.createElement("div"),_videowrapper.id=R.id+"_video_wrapper",y.id=R.id+"_video",b(R,{position:"relative",height:j.height,width:j.width,padding:0,backgroundColor:m.skin.getComponentSettings("display")&&m.skin.getComponentSettings("display").backgroundcolor?m.skin.getComponentSettings("display").backgroundcolor:parseInt("000000",16),zIndex:0}),b(y,{width:"100%",height:"100%",top:0,left:0,zIndex:1,margin:"auto",display:"block"}),b(_videowrapper,{overflow:"hidden",position:"absolute",top:0,left:0,bottom:0,right:0}),d.wrap(y,R),d.wrap(y,_videowrapper),(o=document.createElement("div")).id=R.id+"_displayarea",R.appendChild(o),_instreamArea=document.createElement("div"),_instreamArea.id=R.id+"_instreamarea",b(_instreamArea,{overflow:"hidden",position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:100,background:"000000",display:"none"}),R.appendChild(_instreamArea)}function K(){for(var U=0;U<j.plugins.order.length;U++){var V=j.plugins.order[U];d.exists(j.plugins.object[V].getDisplayElement)&&(j.plugins.object[V].height=d.parseDimension(j.plugins.object[V].getDisplayElement().style.height),j.plugins.object[V].width=d.parseDimension(j.plugins.object[V].getDisplayElement().style.width),j.plugins.config[V].currentPosition=j.plugins.config[V].position)}v()}function s(U){x=j.fullscreen}function p(U){if(!S){switch(U.newstate){case a.api.events.state.PLAYING:j.getMedia()&&j.getMedia().hasChrome()&&(o.style.display="none");break;default:o.style.display="block"}l()}}function v(V){var X=j.getMedia()?j.getMedia().getDisplayElement():null;if(d.exists(X)){O!=X&&(O&&O.parentNode&&O.parentNode.replaceChild(X,O),O=X);for(var U=0;U<j.plugins.order.length;U++){var W=j.plugins.order[U];d.exists(j.plugins.object[W].getDisplayElement)&&(j.plugins.config[W].currentPosition=j.plugins.config[W].position)}}G(j.width,j.height)}function M(U){switch(U.keyCode){case 27:m.jwGetFullscreen()&&m.jwSetFullscreen(!1);break;case 32:m.jwGetState()!=a.api.events.state.IDLE&&m.jwGetState()!=a.api.events.state.PAUSED?m.jwPause():m.jwPlay()}}function G(U,ad){if("none"!=R.style.display){var X=[].concat(j.plugins.order);if(X.reverse(),F=X.length+2,x&&B())try{j.fullscreen&&!j.getMedia().getDisplayElement().webkitDisplayingFullscreen&&(j.fullscreen=!1)}catch(aa){}if(j.fullscreen)B()||c||w(e,X,!0);else{g=U,t=ad,g="string"==typeof U&&U.indexOf("%")>0?d.getElementWidth(d.parentNode(R))*parseInt(U.replace("%"),"")/100:U,t="string"==typeof ad&&ad.indexOf("%")>0?d.getElementHeight(d.parentNode(R))*parseInt(ad.replace("%"),"")/100:ad;var Y={top:0,bottom:0,left:0,right:0,width:g,height:t,position:"absolute"};b(o,Y);var ab,ae={};try{ab=j.plugins.object.display.getDisplayElement()}catch(aa){}ab&&(ae.width=d.parseDimension(ab.style.width),ae.height=d.parseDimension(ab.style.height));var ac=d.extend({},Y,ae,{zIndex:_instreamArea.style.zIndex,display:_instreamArea.style.display});b(_instreamArea,ac),b(R,{height:t,width:g});var Z=w(I,X);if(Z.length>0){F+=Z.length;var W=Z.indexOf("playlist"),V=Z.indexOf("controlbar");W>=0&&V>=0&&(Z[W]=Z.splice(V,1,Z[W])[0]),w(q,Z,!0)}A=d.getElementWidth(o),N=d.getElementHeight(o)}l()}}function w(ab,X,Y){r=0;for(var Z=[],W=0;W<X.length;W++){var aa=X[W];if(d.exists(j.plugins.object[aa].getDisplayElement))if(j.plugins.config[aa].currentPosition!=a.html5.view.positions.NONE){var U=ab(aa,F--);if(U){var V=U.width,ac=U.height;Y&&(delete U.width,delete U.height),b(j.plugins.object[aa].getDisplayElement(),U),j.plugins.object[aa].resize(V,ac)}else Z.push(aa)}else b(j.plugins.object[aa].getDisplayElement(),{display:"none"})}return Z}function I(V,W){if(d.exists(j.plugins.object[V].getDisplayElement)&&j.plugins.config[V].position&&T(j.plugins.config[V].position)){d.exists(j.plugins.object[V].getDisplayElement().parentNode)||R.appendChild(j.plugins.object[V].getDisplayElement());var U=z(V);return U.zIndex=W,U}return!1}function q(U,V){return d.exists(j.plugins.object[U].getDisplayElement().parentNode)||o.appendChild(j.plugins.object[U].getDisplayElement()),{position:"absolute",width:d.getElementWidth(o)-d.parseDimension(o.style.right),height:d.getElementHeight(o)-d.parseDimension(o.style.bottom),zIndex:V}}function e(U,V){return{position:"fixed",width:j.width,height:j.height,zIndex:V}}function T(U){return[a.html5.view.positions.TOP,a.html5.view.positions.RIGHT,a.html5.view.positions.BOTTOM,a.html5.view.positions.LEFT].toString().indexOf(U.toUpperCase())>-1}function B(){return!!(m.jwGetState()!=a.api.events.state.IDLE&&!E&&j.getMedia()&&j.getMedia().getDisplayElement()&&j.getMedia().getDisplayElement().webkitSupportsFullscreen&&d.useNativeFullscreen())}var R,g,t,o,F,O,A,N,S,u,m=n,y=H,j=h,E=!1,x=!1;this.setup=function(){j&&j.getMedia()&&(y=j.getMedia().getDisplayElement()),L(),K(),m.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,p),m.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_LOADED,v),m.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_BEFOREPLAY,s),m.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_META,function(V){l()});var U;d.exists(window.onresize)&&(U=window.onresize),window.onresize=function(V){if(d.exists(U))try{U(V)}catch(X){}if(m.jwGetFullscreen()){if(!B()){var W=d.getBoundingClientRect(document.body);j.width=Math.abs(W.left)+Math.abs(W.right),j.height=window.innerHeight,G(j.width,j.height)}}else G(j.width,j.height)}};var r,l=this.resizeMedia=function(){o.style.position="absolute";var W=j.getMedia()?j.getMedia().getDisplayElement():u;if(W)if(W&&"video"==W.tagName.toLowerCase()){if(!W.videoWidth||!W.videoHeight)return W.style.width=o.style.width,void(W.style.height=o.style.height);if(W.style.position="absolute",d.fadeTo(W,1,.25),W.parentNode&&(W.parentNode.style.left=o.style.left,W.parentNode.style.top=o.style.top),j.fullscreen&&m.jwGetStretching()==a.utils.stretching.EXACTFIT&&!d.isMobile()){var U=document.createElement("div");d.stretch(a.utils.stretching.UNIFORM,U,d.getElementWidth(o),d.getElementHeight(o),A,N),d.stretch(a.utils.stretching.EXACTFIT,W,d.parseDimension(U.style.width),d.parseDimension(U.style.height),W.videoWidth?W.videoWidth:400,W.videoHeight?W.videoHeight:300),b(W,{left:U.style.left,top:U.style.top})}else c||d.stretch(m.jwGetStretching(),W,d.getElementWidth(o),d.getElementHeight(o),W.videoWidth?W.videoWidth:400,W.videoHeight?W.videoHeight:300)}else{var V=j.plugins.object.display.getDisplayElement();V?j.getMedia().resize(d.parseDimension(V.style.width),d.parseDimension(V.style.height)):j.getMedia().resize(d.parseDimension(o.style.width),d.parseDimension(o.style.height))}},z=this.getComponentPosition=function(V){var W={position:"absolute",margin:0,padding:0,top:null},U=j.plugins.config[V].currentPosition.toLowerCase();switch(U.toUpperCase()){case a.html5.view.positions.TOP:W.top=d.parseDimension(o.style.top),W.left=d.parseDimension(o.style.left),W.width=d.getElementWidth(o)-d.parseDimension(o.style.left)-d.parseDimension(o.style.right),W.height=j.plugins.object[V].height,o.style[U]=d.parseDimension(o.style[U])+j.plugins.object[V].height+"px",o.style.height=d.getElementHeight(o)-W.height+"px";break;case a.html5.view.positions.RIGHT:W.top=d.parseDimension(o.style.top),W.right=d.parseDimension(o.style.right),W.width=j.plugins.object[V].width,W.height=d.getElementHeight(o)-d.parseDimension(o.style.top)-d.parseDimension(o.style.bottom),o.style.width=d.getElementWidth(o)-W.width+"px";break;case a.html5.view.positions.BOTTOM:W.left=d.parseDimension(o.style.left),W.width=d.getElementWidth(o)-d.parseDimension(o.style.left)-d.parseDimension(o.style.right),W.height=j.plugins.object[V].height,W.bottom=d.parseDimension(o.style.bottom+r),r+=W.height,o.style.height=d.getElementHeight(o)-W.height+"px";break;case a.html5.view.positions.LEFT:W.top=d.parseDimension(o.style.top),W.left=d.parseDimension(o.style.left),W.width=j.plugins.object[V].width,W.height=d.getElementHeight(o)-d.parseDimension(o.style.top)-d.parseDimension(o.style.bottom),o.style[U]=d.parseDimension(o.style[U])+j.plugins.object[V].width+"px",o.style.width=d.getElementWidth(o)-W.width+"px"}return W};this.resize=G;var J,k,Q;this.fullscreen=function(W){if(!c){var Y;try{Y=j.getMedia().getDisplayElement()}catch(X){}W&&(k=j.width,Q=j.height);var aa={position:"fixed",width:"100%",height:"100%",top:0,left:0,zIndex:2147483e3},Z={position:"relative",height:k,width:Q,zIndex:0};if(B()&&Y&&Y.webkitSupportsFullscreen){if(W&&!Y.webkitDisplayingFullscreen)try{b(Y,aa),d.transform(Y),J=o.style.display,o.style.display="none",Y.webkitEnterFullscreen()}catch(V){}else if(!W){if(b(Y,Z),l(),Y.webkitDisplayingFullscreen)try{Y.webkitExitFullscreen()}catch(V){}o.style.display=J}E=!1}else{if(W){document.onkeydown=M,clearInterval(void 0);var U=d.getBoundingClientRect(document.body);j.width=Math.abs(U.left)+Math.abs(U.right),j.height=window.innerHeight,b(R,aa),aa.zIndex=1,j.getMedia()&&j.getMedia().getDisplayElement()&&b(j.getMedia().getDisplayElement(),aa),aa.zIndex=2,b(o,aa),E=!0}else document.onkeydown="",j.width=g,j.height=t,b(R,Z),E=!1;G(j.width,j.height)}}};this.setupInstream=function(U,V){d.css(_instreamArea,{display:"block",position:"absolute"}),o.style.display="none",_instreamArea.appendChild(U),u=V,S=!0};this.destroyInstream=function(){_instreamArea.style.display="none",_instreamArea.innerHTML="",o.style.display="block",u=null,S=!1,G(j.width,j.height)}},a.html5.view.positions={TOP:"TOP",RIGHT:"RIGHT",BOTTOM:"BOTTOM",LEFT:"LEFT",OVER:"OVER",NONE:"NONE"}}(jwplayer),function(a){var b={backgroundcolor:"",margin:10,font:"Arial,sans-serif",fontsize:10,fontcolor:parseInt("000000",16),fontstyle:"normal",fontweight:"bold",buttoncolor:parseInt("ffffff",16),position:a.html5.view.positions.BOTTOM,idlehide:!1,hideplaylistcontrols:!1,forcenextprev:!1,layout:{left:{position:"left",elements:[{name:"play",type:"button"},{name:"divider",type:"divider"},{name:"prev",type:"button"},{name:"divider",type:"divider"},{name:"next",type:"button"},{name:"divider",type:"divider"},{name:"elapsed",type:"text"}]},center:{position:"center",elements:[{name:"time",type:"slider"}]},right:{position:"right",elements:[{name:"duration",type:"text"},{name:"blank",type:"button"},{name:"divider",type:"divider"},{name:"mute",type:"button"},{name:"volume",type:"slider"},{name:"divider",type:"divider"},{name:"fullscreen",type:"button"}]}}};_utils=a.utils,_css=_utils.css,_hide=function(c){_css(c,{display:"none"})},_show=function(c){_css(c,{display:"block"})},a.html5.controlbar=function(m,Y){function K(){return ac||(ac=l.skin.getSkinElement("controlbar","background"))||(ac={width:0,height:0,src:null}),ac}function O(){if(af=0,E=0,R=0,!q){var ap={height:K().height,backgroundColor:D.backgroundcolor};(ag=document.createElement("div")).id=l.id+"_jwplayer_controlbar",_css(ag,ap)}var ao=l.skin.getSkinElement("controlbar","capLeft"),an=l.skin.getSkinElement("controlbar","capRight");ao&&y("capLeft","left",!1,ag),ad("background",ag,{position:"absolute",height:K().height,left:ao?ao.width:0,zIndex:0},"img"),K().src&&(S.background.src=K().src),ad("elements",ag,{position:"relative",height:K().height,zIndex:1}),an&&y("capRight","right",!1,ag)}function r(){var ao=["timeSlider","volumeSlider","timeSliderRail","volumeSliderRail"];for(var ap in ao){var an=ao[ap];void 0!==S[an]&&(c[an]=_utils.getBoundingClientRect(S[an]))}}function Z(an){if(!j)if(clearTimeout(p),D.position==a.html5.view.positions.OVER||l.jwGetFullscreen())switch(l.jwGetState()){case a.api.events.state.PAUSED:case a.api.events.state.IDLE:ag&&ag.style.opacity<1&&(!D.idlehide||_utils.exists(an))&&(e=!1,setTimeout(function(){e||X()},100)),D.idlehide&&(p=setTimeout(function(){A()},2e3));break;default:e=!0,an&&X(),p=setTimeout(function(){A()},2e3)}else X()}function A(){j||(ae(),1==ag.style.opacity&&(_utils.cancelAnimation(ag),_utils.fadeTo(ag,0,.1,1,0)))}function X(){j||(W(),0==ag.style.opacity&&(_utils.cancelAnimation(ag),_utils.fadeTo(ag,1,.1,0,0)))}function I(an){return function(){V&&d!=an&&(d=an,aa.sendEvent(an,{component:"controlbar",boundingRect:P()}))}}function P(){return D.position==a.html5.view.positions.OVER||l.jwGetFullscreen()?_utils.getDimensions(ag):{x:0,y:0,width:0,height:0}}function ad(ar,aq,ap,an){var ao;return q?ao=document.getElementById(ag.id+"_"+ar):(an||(an="div"),ao=document.createElement(an),S[ar]=ao,ao.id=ag.id+"_"+ar,aq.appendChild(ao)),_utils.exists(ap)&&_css(ao,ap),ao}function N(){if(l.jwGetHeight()<=40){D.layout=_utils.clone(D.layout);for(var an=0;an<D.layout.left.elements.length;an++)"fullscreen"==D.layout.left.elements[an].name&&D.layout.left.elements.splice(an,1);for(an=0;an<D.layout.right.elements.length;an++)"fullscreen"==D.layout.right.elements[an].name&&D.layout.right.elements.splice(an,1);o()}am(D.layout.left),am(D.layout.center),am(D.layout.right)}function am(aq,an){var ar="right"==aq.position?"right":"left",ap=_utils.extend([],aq.elements);_utils.exists(an)&&ap.reverse();for(var aq=ad(aq.position+"Group",S.elements,{float:"left",styleFloat:"left",cssFloat:"left",height:"100%"}),ao=0;ao<ap.length;ao++)C(ap[ao],ar,aq)}function L(){return R++}function C(ar,au,aw){var ao,ap,an,ax;if(aw||(aw=S.elements),"divider"!=ar.type)switch(ar.name){case"play":y("playButton",au,!1,aw),y("pauseButton",au,!0,aw),U("playButton","jwPlay"),U("pauseButton","jwPause");break;case"prev":y("prevButton",au,!0,aw),U("prevButton","jwPlaylistPrev");break;case"stop":y("stopButton",au,!0,aw),U("stopButton","jwStop");break;case"next":y("nextButton",au,!0,aw),U("nextButton","jwPlaylistNext");break;case"elapsed":y("elapsedText",au,!0,aw,null,null,l.skin.getSkinElement("controlbar","elapsedBackground"));break;case"time":ao=_utils.exists(l.skin.getSkinElement("controlbar","timeSliderCapLeft"))?l.skin.getSkinElement("controlbar","timeSliderCapLeft").width:0,ap=_utils.exists(l.skin.getSkinElement("controlbar","timeSliderCapRight"))?l.skin.getSkinElement("controlbar","timeSliderCapRight").width:0,"left"==au?ao:ap;var at=ad("timeSlider",aw,ax={height:K().height,position:"relative",float:"left",styleFloat:"left",cssFloat:"left"});y("timeSliderCapLeft",au,!0,at,"relative"),y("timeSliderRail",au,!1,at,"relative"),y("timeSliderBuffer",au,!1,at,"absolute"),y("timeSliderProgress",au,!1,at,"absolute"),y("timeSliderThumb",au,!1,at,"absolute"),y("timeSliderCapRight",au,!0,at,"relative"),ab("time");break;case"fullscreen":y("fullscreenButton",au,!1,aw),y("normalscreenButton",au,!0,aw),U("fullscreenButton","jwSetFullscreen",!0),U("normalscreenButton","jwSetFullscreen",!1);break;case"volume":ao=_utils.exists(l.skin.getSkinElement("controlbar","volumeSliderCapLeft"))?l.skin.getSkinElement("controlbar","volumeSliderCapLeft").width:0,ap=_utils.exists(l.skin.getSkinElement("controlbar","volumeSliderCapRight"))?l.skin.getSkinElement("controlbar","volumeSliderCapRight").width:0,"left"==au?ao:ap,an=l.skin.getSkinElement("controlbar","volumeSliderRail").width+ao+ap;var av=ad("volumeSlider",aw,ax={height:K().height,position:"relative",width:an,float:"left",styleFloat:"left",cssFloat:"left"});y("volumeSliderCapLeft",au,!1,av,"relative"),y("volumeSliderRail",au,!1,av,"relative"),y("volumeSliderProgress",au,!1,av,"absolute"),y("volumeSliderThumb",au,!1,av,"absolute"),y("volumeSliderCapRight",au,!1,av,"relative"),ab("volume");break;case"mute":y("muteButton",au,!1,aw),y("unmuteButton",au,!0,aw),U("muteButton","jwSetMute",!0),U("unmuteButton","jwSetMute",!1);break;case"duration":y("durationText",au,!0,aw,null,null,l.skin.getSkinElement("controlbar","durationBackground"))}else y("divider"+L(),au,!0,aw,void 0,ar.width,ar.element)}function y(aq,au,ao,ax,ar,an,ap){if(_utils.exists(l.skin.getSkinElement("controlbar",aq))||aq.indexOf("Text")>0||0===aq.indexOf("divider")){var at={height:"100%",position:ar||"relative",display:"block",float:"left",styleFloat:"left",cssFloat:"left"};0!==aq.indexOf("next")&&0!==aq.indexOf("prev")||!(l.jwGetPlaylist().length<2||"true"==D.hideplaylistcontrols.toString())||"true"!=D.forcenextprev.toString()&&(ao=!1,at.display="none");var ay;if(aq.indexOf("Text")>0)aq.innerhtml="00:00",at.font=D.fontsize+"px/"+(K().height+1)+"px "+D.font,at.color=D.fontcolor,at.textAlign="center",at.fontWeight=D.fontweight,at.fontStyle=D.fontstyle,at.cursor="default",ap&&(at.background="url("+ap.src+") no-repeat center",at.backgroundSize="100% "+K().height+"px"),at.padding="0 5px";else if(0===aq.indexOf("divider"))if(an)isNaN(parseInt(an))||(ay=parseInt(an));else if(ap){var av=l.skin.getSkinElement("controlbar",ap);av&&(at.background="url("+av.src+") repeat-x center left",ay=av.width)}else at.background="url("+l.skin.getSkinElement("controlbar","divider").src+") repeat-x center left",ay=l.skin.getSkinElement("controlbar","divider").width;else at.background="url("+l.skin.getSkinElement("controlbar",aq).src+") repeat-x center left",ay=l.skin.getSkinElement("controlbar",aq).width;if("left"==au?ao&&(af+=ay):"right"==au&&ao&&(E+=ay),"undefined"==_utils.typeOf(ax)&&(ax=S.elements),at.width=ay,q)_css(S[aq],at);else{var aw=ad(aq,ax,at);_utils.exists(l.skin.getSkinElement("controlbar",aq+"Over"))&&(aw.onmouseover=function(az){aw.style.backgroundImage=["url(",l.skin.getSkinElement("controlbar",aq+"Over").src,")"].join("")},aw.onmouseout=function(az){aw.style.backgroundImage=["url(",l.skin.getSkinElement("controlbar",aq).src,")"].join("")}),0==aq.indexOf("divider")&&aw.setAttribute("class","divider"),aw.innerHTML="&nbsp;"}}}function F(){l.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,B),l.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_ITEM,t),l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_BUFFER,v),l.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,s),l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_TIME,J),l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_MUTE,al),l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_VOLUME,n),l.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_COMPLETE,M)}function B(){D.hideplaylistcontrols||(l.jwGetPlaylist().length>1||"true"==D.forcenextprev.toString()?(_show(S.nextButton),_show(S.prevButton)):(_hide(S.nextButton),_hide(S.prevButton)),x(),ai())}function t(an){ah=l.jwGetPlaylist()[an.index].duration,Q=-1,J({id:l.id,duration:ah,position:0}),v({id:l.id,bufferProgress:0})}function ai(){J({id:l.id,duration:l.jwGetDuration(),position:0}),v({id:l.id,bufferProgress:0}),al({id:l.id,mute:l.jwGetMute()}),s({id:l.id,newstate:a.api.events.state.IDLE}),n({id:l.id,volume:l.jwGetVolume()})}function U(ap,aq,ao){if(!q&&_utils.exists(l.skin.getSkinElement("controlbar",ap))){var an=S[ap];_utils.exists(an)&&(_css(an,{cursor:"pointer"}),an.onmouseup="fullscreen"==aq?function(ar){ar.stopPropagation(),l.jwSetFullscreen(!l.jwGetFullscreen())}:function(ar){ar.stopPropagation(),_utils.exists(ao)?l[aq](ao):l[aq]()})}}function ab(an){if(!q){var ao=S[an+"Slider"];_css(S.elements,{cursor:"pointer"}),_css(ao,{cursor:"pointer"}),ao.onmousedown=function(ap){w=an},ao.onmouseup=function(ap){ap.stopPropagation(),ak(ap.pageX)},ao.onmousemove=function(ap){if("time"==w){h=!0;var aq=ap.pageX-c[an+"Slider"].left-window.pageXOffset;_css(S[w+"SliderThumb"],{left:aq})}}}}function ak(ao){h=!1;var an;if("time"==w){var aq=(an=ao-c.timeSliderRail.left+window.pageXOffset)/c.timeSliderRail.width*ah;aq<0?aq=0:aq>ah&&(aq=ah-3),l.jwGetState()!=a.api.events.state.PAUSED&&l.jwGetState()!=a.api.events.state.IDLE||l.jwPlay(),l.jwSeek(aq)}else if("volume"==w){an=ao-c.volumeSliderRail.left-window.pageXOffset;var ap=Math.round(an/c.volumeSliderRail.width*100);ap<10?ap=0:ap>100&&(ap=100),l.jwGetMute()&&l.jwSetMute(!1),l.jwSetVolume(ap)}w="none"}function v(ao){if(_utils.exists(ao.bufferPercent)&&(g=ao.bufferPercent),c.timeSliderRail){var aq=l.skin.getSkinElement("controlbar","timeSliderCapLeft"),ap=c.timeSliderRail.width,an=isNaN(Math.round(ap*g/100))?0:Math.round(ap*g/100);_css(S.timeSliderBuffer,{width:an,left:aq?aq.width:0})}}function al(an){an.mute?(_hide(S.muteButton),_show(S.unmuteButton),_hide(S.volumeSliderProgress)):(_show(S.muteButton),_hide(S.unmuteButton),_show(S.volumeSliderProgress))}function s(an){an.newstate==a.api.events.state.BUFFERING||an.newstate==a.api.events.state.PLAYING?(_show(S.pauseButton),_hide(S.playButton)):(_hide(S.pauseButton),_show(S.playButton)),Z(),an.newstate==a.api.events.state.IDLE?(_hide(S.timeSliderBuffer),_hide(S.timeSliderProgress),_hide(S.timeSliderThumb),J({id:l.id,duration:l.jwGetDuration(),position:0})):(_show(S.timeSliderBuffer),an.newstate!=a.api.events.state.BUFFERING&&(_show(S.timeSliderProgress),_show(S.timeSliderThumb)))}function M(an){v({bufferPercent:0}),J(_utils.extend(an,{position:0,duration:ah}))}function J(at){_utils.exists(at.position)&&(k=at.position);var ao=!1;_utils.exists(at.duration)&&at.duration!=ah&&(ah=at.duration,ao=!0);var aq=k===ah===0?0:k/ah,av=c.timeSliderRail;if(av){var ap=isNaN(Math.round(av.width*aq))?0:Math.round(av.width*aq),au=l.skin.getSkinElement("controlbar","timeSliderCapLeft"),ar=ap+(au?au.width:0);S.timeSliderProgress&&(_css(S.timeSliderProgress,{width:ap,left:au?au.width:0}),h||S.timeSliderThumb&&(S.timeSliderThumb.style.left=ar+"px"))}if(S.durationText&&(S.durationText.innerHTML=_utils.timeFormat(ah)),S.elapsedText){var an=_utils.timeFormat(k);S.elapsedText.innerHTML=an,Q!=an.length&&(ao=!0,Q=an.length)}ao&&x()}function o(){for(var at,aq,an=S.elements.childNodes,ap=0;ap<an.length;ap++){var ar=an[ap].childNodes;for(var ao in ar)isNaN(parseInt(ao,10))||(0===ar[ao].id.indexOf(ag.id+"_divider")&&aq&&0===aq.id.indexOf(ag.id+"_divider")&&ar[ao].style.backgroundImage==aq.style.backgroundImage?ar[ao].style.display="none":0===ar[ao].id.indexOf(ag.id+"_divider")&&at&&"none"!=at.style.display&&(ar[ao].style.display="block"),"none"!=ar[ao].style.display&&(aq=ar[ao]),at=ar[ao])}}function aj(){l.jwGetFullscreen()?(_show(S.normalscreenButton),_hide(S.fullscreenButton)):(_hide(S.normalscreenButton),_show(S.fullscreenButton)),l.jwGetState()==a.api.events.state.BUFFERING||l.jwGetState()==a.api.events.state.PLAYING?(_show(S.pauseButton),_hide(S.playButton)):(_hide(S.pauseButton),_show(S.playButton)),1==l.jwGetMute()?(_hide(S.muteButton),_show(S.unmuteButton),_hide(S.volumeSliderProgress)):(_show(S.muteButton),_hide(S.unmuteButton),_show(S.volumeSliderProgress))}function x(){o(),aj();var ap={width:f},ax={float:"left",styleFloat:"left",cssFloat:"left"};(D.position==a.html5.view.positions.OVER||l.jwGetFullscreen())&&(ap.left=D.margin,ap.width-=2*D.margin,ap.top=z-K().height-D.margin,ap.height=K().height);var ar=l.skin.getSkinElement("controlbar","capLeft"),av=l.skin.getSkinElement("controlbar","capRight");ax.width=ap.width-(ar?ar.width:0)-(av?av.width:0);var aq=_utils.getBoundingClientRect(S.leftGroup).width,au=_utils.getBoundingClientRect(S.rightGroup).width,at=ax.width-aq-au-1,ao=at,an=l.skin.getSkinElement("controlbar","timeSliderCapLeft"),aw=l.skin.getSkinElement("controlbar","timeSliderCapRight");return _utils.exists(an)&&(ao-=an.width),_utils.exists(aw)&&(ao-=aw.width),S.timeSlider.style.width=at+"px",S.timeSliderRail.style.width=ao+"px",_css(ag,ap),_css(S.elements,ax),_css(S.background,ax),r(),ap}function n(at){if(_utils.exists(S.volumeSliderRail)){var ap=isNaN(at.volume/100)?1:at.volume/100,aq=_utils.parseDimension(S.volumeSliderRail.style.width),an=isNaN(Math.round(aq*ap))?0:Math.round(aq*ap),ao=(_utils.parseDimension(S.volumeSliderRail.style.right),_utils.exists(l.skin.getSkinElement("controlbar","volumeSliderCapLeft"))?l.skin.getSkinElement("controlbar","volumeSliderCapLeft").width:0);if(_css(S.volumeSliderProgress,{width:an,left:ao}),S.volumeSliderThumb){var ar=an-Math.round(_utils.parseDimension(S.volumeSliderThumb.style.width)/2);ar=Math.min(Math.max(ar,0),aq-_utils.parseDimension(S.volumeSliderThumb.style.width)),_css(S.volumeSliderThumb,{left:ar})}_utils.exists(S.volumeSliderCapLeft)&&_css(S.volumeSliderCapLeft,{left:0})}}function T(){try{var ao=l.id.indexOf("_instream")>0?l.id.replace("_instream",""):l.id;(H=document.getElementById(ao)).addEventListener("mousemove",Z)}catch(an){_utils.log("Could not add mouse listeners to controlbar: "+an)}}window.controlbar=this;var l=m,D=_utils.extend({},b,l.skin.getComponentSettings("controlbar"),Y);if(D.position!=a.html5.view.positions.NONE&&void 0!==a.html5.view.positions[D.position]){_utils.mapLength(l.skin.getComponentLayout("controlbar"))>0&&(D.layout=l.skin.getComponentLayout("controlbar"));var ag,R,af,E,h,k,ah,g,f,z,ac,p,d,H,w="none",S={},q=!1,c={},Q=-1,j=!1,V=!1,G=!1,aa=new a.html5.eventdispatcher;_utils.extend(this,aa),this.getDisplayElement=function(){return ag},this.resize=function(ap,an){T(),_utils.cancelAnimation(ag),f=ap,z=an,G!=l.jwGetFullscreen()&&((G=l.jwGetFullscreen())||Z(),d=void 0);var ao=x();return J({id:l.id,duration:ah,position:k}),v({id:l.id,bufferPercent:g}),ao},this.show=function(){j&&(j=!1,_show(ag),W())},this.hide=function(){j||(j=!0,_hide(ag),ae())};var e,W=I(a.api.events.JWPLAYER_COMPONENT_SHOW),ae=I(a.api.events.JWPLAYER_COMPONENT_HIDE);return O(),N(),r(),q=!0,F(),D.idlehide="true"==D.idlehide.toString().toLowerCase(),D.position==a.html5.view.positions.OVER&&D.idlehide?(ag.style.opacity=0,V=!0):(ag.style.opacity=1,setTimeout(function(){V=!0,W()},1)),T(),ai(),this}}}(jwplayer),function(b){var c=b.utils;b.html5.controller=function(o,K,f,h){function F(){try{return P=F,!A&&(A=!0,N.sendEvent(b.api.events.JWPLAYER_MEDIA_BEFOREPLAY),A=!1,d)?(d=!1,void(P=null)):(v(m.item),m.playlist[m.item].levels[0].file.length>0&&(M||m.state==b.api.events.state.IDLE?(m.getMedia().load(m.playlist[m.item]),M=!1):m.state==b.api.events.state.PAUSED&&m.getMedia().play()),!0)}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T),P=null}return!1}function w(T){P=null,c.exists(T)||(T=!0);try{return(m.state!=b.api.events.state.IDLE||T)&&m.getMedia()&&m.getMedia().stop(T),A&&(d=!0),!0}catch(U){N.sendEvent(b.api.events.JWPLAYER_ERROR,U)}return!1}function k(){try{if(m.playlist[m.item].levels[0].file.length>0&&v(m.config.shuffle?S():m.item+1==m.playlist.length?0:m.item+1),m.state!=b.api.events.state.IDLE){var U=m.state;m.state=b.api.events.state.IDLE,N.sendEvent(b.api.events.JWPLAYER_PLAYER_STATE,{oldstate:U,newstate:b.api.events.state.IDLE})}return F(),!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}function S(){var T=null;if(m.playlist.length>1)for(;!c.exists(T);)(T=Math.floor(Math.random()*m.playlist.length))==m.item&&(T=null);else T=0;return T}function H(U){if(!m.playlist||!m.playlist[U])return!1;try{return m.playlist[U].levels[0].file.length>0&&(m.state!==b.api.events.state.IDLE&&(m.playlist[m.item]&&m.playlist[m.item].provider==m.playlist[U].provider?w(!1):w()),v(U),F()),!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}function v(T){m.playlist[T]&&(m.setActiveMediaProvider(m.playlist[T]),m.item!=T&&(m.item=T,M=!0,N.sendEvent(b.api.events.JWPLAYER_PLAYLIST_ITEM,{index:T})))}function u(U,V){try{return void 0===U&&(U=!m.fullscreen),void 0===V&&(V=!0),U!=m.fullscreen&&(m.fullscreen="true"==U.toString().toLowerCase(),j.fullscreen(m.fullscreen),V&&N.sendEvent(b.api.events.JWPLAYER_FULLSCREEN,{fullscreen:m.fullscreen}),N.sendEvent(b.api.events.JWPLAYER_RESIZE,{width:m.width,height:m.height})),!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}function O(T){c.isIOS()||(v(m.item),"true"!=m.config.autostart.toString().toLowerCase()||c.isIOS()||F())}function E(){if(m.state==b.api.events.state.IDLE)switch(P=E,m.config.repeat.toUpperCase()){case b.html5.controller.repeatoptions.SINGLE:F();break;case b.html5.controller.repeatoptions.ALWAYS:m.item!=m.playlist.length-1||m.config.shuffle?k():H(0);break;case b.html5.controller.repeatoptions.LIST:m.item!=m.playlist.length-1||m.config.shuffle?k():(w(),v(0));break;default:w()}}function Q(T){return function(){q?B(T,arguments):x.push({method:T,arguments:arguments})}}function B(V,U){var T=[];for(i=0;i<U.length;i++)T.push(U[i]);V.apply(this,T)}var P,m=f,j=h,y=K,M=!0,G=-1,A=!1,d=!1,C=[],q=!1,D=c.exists(m.config.debug)&&"console"==m.config.debug.toString().toLowerCase(),N=new b.html5.eventdispatcher(y.id,D);c.extend(this,N),m.addGlobalListener(function(T){q?N.sendEvent(T.type,T):C.push(T)}),m.addEventListener(b.api.events.JWPLAYER_MEDIA_BUFFER_FULL,function(){m.getMedia().play()}),m.addEventListener(b.api.events.JWPLAYER_MEDIA_TIME,function(T){T.position>=m.playlist[m.item].start&&G>=0&&(m.playlist[m.item].start=G,G=-1)}),m.addEventListener(b.api.events.JWPLAYER_MEDIA_COMPLETE,function(T){setTimeout(E,25)}),m.addEventListener(b.api.events.JWPLAYER_PLAYLIST_LOADED,O),m.addEventListener(b.api.events.JWPLAYER_FULLSCREEN,function(T){u(T.fullscreen,!1)}),b.html5.controller.repeatoptions={LIST:"LIST",ALWAYS:"ALWAYS",SINGLE:"SINGLE",NONE:"NONE"};var x=[];this.play=Q(F),this.pause=Q(function(){try{if(m.playlist[m.item].levels[0].file.length>0)switch(m.state){case b.api.events.state.PLAYING:case b.api.events.state.BUFFERING:m.getMedia()&&m.getMedia().pause();break;default:A&&(d=!0)}return!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}),this.seek=Q(function(T){try{if(m.playlist[m.item].levels[0].file.length>0)switch("number"!=typeof T&&(T=parseFloat(T)),m.state){case b.api.events.state.IDLE:G<0&&(G=m.playlist[m.item].start,m.playlist[m.item].start=T),A||F();break;case b.api.events.state.PLAYING:case b.api.events.state.PAUSED:case b.api.events.state.BUFFERING:m.seek(T)}return!0}catch(U){N.sendEvent(b.api.events.JWPLAYER_ERROR,U)}return!1}),this.stop=Q(w),this.next=Q(k),this.prev=Q(function(){try{if(m.playlist[m.item].levels[0].file.length>0&&v(m.config.shuffle?S():0===m.item?m.playlist.length-1:m.item-1),m.state!=b.api.events.state.IDLE){var U=m.state;m.state=b.api.events.state.IDLE,N.sendEvent(b.api.events.JWPLAYER_PLAYER_STATE,{oldstate:U,newstate:b.api.events.state.IDLE})}return F(),!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}),this.item=Q(H),this.setVolume=Q(function(U){try{v(m.item);var V=m.getMedia();switch(typeof U){case"number":V.volume(U);break;case"string":V.volume(parseInt(U,10))}return m.setVolume(U),!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}),this.setMute=Q(function(U){try{v(m.item);var V=m.getMedia();return void 0===U?(V.mute(!m.mute),m.setMute(!m.mute)):"true"==U.toString().toLowerCase()?(V.mute(!0),m.setMute(!0)):(V.mute(!1),m.setMute(!1)),!0}catch(T){N.sendEvent(b.api.events.JWPLAYER_ERROR,T)}return!1}),this.resize=Q(function(U,T){try{return m.width=U,m.height=T,j.resize(U,T),N.sendEvent(b.api.events.JWPLAYER_RESIZE,{width:m.width,height:m.height}),!0}catch(V){N.sendEvent(b.api.events.JWPLAYER_ERROR,V)}return!1}),this.setFullscreen=Q(u),this.load=Q(function(T){try{return w(),A&&(d=!1),m.loadPlaylist(T),!!m.playlist[m.item].provider&&(v(m.item),"true"!=m.config.autostart.toString().toLowerCase()||c.isIOS()||A||F(),!0)}catch(U){N.sendEvent(b.api.events.JWPLAYER_ERROR,U)}return!1}),this.playerReady=function(T){if(!q){for(q=!0,N.sendEvent(b.api.events.JWPLAYER_READY,T),b.utils.exists(window.playerReady)&&playerReady(T),b.utils.exists(window[f.config.playerReady])&&window[f.config.playerReady](T);C.length>0;){var V=C.shift();N.sendEvent(V.type,V)}for(f.config.autostart&&!b.utils.isIOS()&&O();x.length>0;){var U=x.shift();B(U.method,U.arguments)}}},this.detachMedia=function(){try{return m.getMedia().detachMedia()}catch(T){return null}},this.attachMedia=function(){try{m.getMedia().attachMedia(),"function"==typeof P&&P()}catch(U){return null}},this.beforePlay=function(){return A},this.destroy=function(){m.getMedia()&&m.getMedia().destroy()}}}(jwplayer),jwplayer.html5.defaultSkin=function(){return this.text='<?xml version="1.0" ?><skin author="LongTail Video" name="Five" version="1.1"><components><component name="controlbar"><settings><setting name="margin" value="20"/><setting name="fontsize" value="11"/><setting name="fontcolor" value="0x000000"/></settings><layout><group position="left"><button name="play"/><divider name="divider"/><button name="prev"/><divider name="divider"/><button name="next"/><divider name="divider"/><text name="elapsed"/></group><group position="center"><slider name="time"/></group><group position="right"><text name="duration"/><divider name="divider"/><button name="blank"/><divider name="divider"/><button name="mute"/><slider name="volume"/><divider name="divider"/><button name="fullscreen"/></group></layout><elements><element name="background" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAIAAABvFaqvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAElJREFUOI3t1LERACAMQlFgGvcfxNIhHMK4gsUvUviOmgtNsiAZkBSEKxKEnCYkkQrJn/YwbUNiSDDYRZaQRDaShv+oX9GBZEIuK+8hXVLs+/YAAAAASUVORK5CYII="/><element name="blankButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAFElEQVQYV2P8//8/AzpgHBUc7oIAGZdH0RjKN8EAAAAASUVORK5CYII="/><element name="capLeft" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAYAAAA7zJfaAAAAQElEQVQIWz3LsRGAMADDQJ0XB5bMINABZ9GENGrszxhjT2WLSqxEJG2JQrTMdV2q5LpOAvyRaVmsi7WdeZ/7+AAaOTq7BVrfOQAAAABJRU5ErkJggg=="/><element name="capRight" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAYAAAA7zJfaAAAAQElEQVQIWz3LsRGAMADDQJ0XB5bMINABZ9GENGrszxhjT2WLSqxEJG2JQrTMdV2q5LpOAvyRaVmsi7WdeZ/7+AAaOTq7BVrfOQAAAABJRU5ErkJggg=="/><element name="divider" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAYCAIAAAC0rgCNAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADhJREFUCB0FwcENgEAAw7Aq+893g8APUILNOQcbFRktVGqUVFRkWNz3xTa2sUaLNUosKlRUvvf5AdbWOTtzmzyWAAAAAElFTkSuQmCC"/><element name="playButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAANUlEQVR42u2RsQkAAAjD/NTTPaW6dXLrINJA1kBpGPMAjDWmOgp1HFQXx+b1KOefO4oxY57R73YnVYCQUCQAAAAASUVORK5CYII="/><element name="pauseButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAAIUlEQVQ4jWNgGAWjYOiD/0gYG3/U0FFDB4Oho2AUDAYAAEwiL9HrpdMVAAAAAElFTkSuQmCC"/><element name="prevButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAAQklEQVQ4y2NgGAWjYOiD/1AMA/JAfB5NjCJD/YH4PRaLyDa0H4lNNUP/DxlD59PCUBCIp3ZEwYA+NZLUKBgFgwEAAN+HLX9sB8u8AAAAAElFTkSuQmCC"/><element name="nextButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAYCAYAAAAVibZIAAAAQElEQVQ4y2NgGAWjYOiD/0B8Hojl0cT+U2ooCL8HYn9qGwrD/bQw9P+QMXQ+tSMqnpoRBUpS+tRMUqNgFAwGAADxZy1/mHvFnAAAAABJRU5ErkJggg=="/><element name="timeSliderRail" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAOElEQVRIDe3BwQkAIRADwAhhw/nU/kWwUK+KPITMABFh19Y+F0acY8CJvX9wYpXgRElwolSIiMf9ZWEDhtwurFsAAAAASUVORK5CYII="/><element name="timeSliderBuffer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAN0lEQVRIDe3BwQkAMQwDMBcc55mRe9zi7RR+FCwBEWG39vcfGHFm4MTuhhMlwYlVBSdKhYh43AW/LQMKm1spzwAAAABJRU5ErkJggg=="/><element name="timeSliderProgress" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAIElEQVRIiWNgGAWjYBTQBfynMR61YCRYMApGwSigMQAAiVWPcbq6UkIAAAAASUVORK5CYII="/><element name="timeSliderThumb" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAYCAYAAAA/OUfnAAAAO0lEQVQYlWP4//8/Awwz0JgDBP/BeN6Cxf/hnI2btiI4u/fsQ3AOHjqK4Jw4eQbBOX/hEoKDYjSd/AMA4cS4mfLsorgAAAAASUVORK5CYII="/><element name="muteButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAYCAYAAADKx8xXAAAAJklEQVQ4y2NgGAUjDcwH4v/kaPxPikZkxcNVI9mBQ5XoGAWDFwAAsKAXKQQmfbUAAAAASUVORK5CYII="/><element name="unmuteButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAYCAYAAADKx8xXAAAAMklEQVQ4y2NgGAWDHPyntub5xBr6Hwv/Pzk2/yfVG/8psRFE25Oq8T+tQnsIaB4FVAcAi2YVysVY52AAAAAASUVORK5CYII="/><element name="volumeSliderRail" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYAgMAAACdGdVrAAAACVBMVEUAAACmpqampqbBXAu8AAAAAnRSTlMAgJsrThgAAAArSURBVAhbY2AgErBAyA4I2QEhOyBkB4TsYOhAoaCCUCUwDTDtMMNgRuMHAFB5FoGH5T0UAAAAAElFTkSuQmCC"/><element name="volumeSliderProgress" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYAgMAAACdGdVrAAAACVBMVEUAAAAAAAAAAACDY+nAAAAAAnRSTlMAgJsrThgAAAArSURBVAhbY2AgErBAyA4I2QEhOyBkB4TsYOhAoaCCUCUwDTDtMMNgRuMHAFB5FoGH5T0UAAAAAElFTkSuQmCC"/><element name="volumeSliderCapRight" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAYCAYAAAAyJzegAAAAFElEQVQYV2P8//8/AzpgHBUc7oIAGZdH0RjKN8EAAAAASUVORK5CYII="/><element name="fullscreenButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAQklEQVRIiWNgGAWjYMiD/0iYFDmSLbDHImdPLQtgBpEiR7Zl2NijAA5oEkT/0Whi5UiyAJ8BVMsHNMtoo2AUDAIAAGdcIN3IDNXoAAAAAElFTkSuQmCC"/><element name="normalscreenButton" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAP0lEQVRIx2NgGAWjYMiD/1RSQ5QB/wmIUWzJfzx8qhj+n4DYCAY0DyJ7PBbYU8sHMEvwiZFtODXUjIJRMJgBACpWIN2ZxdPTAAAAAElFTkSuQmCC"/></elements></component><component name="display"><elements><element name="background" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAQMAAAAk8RryAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlOZpuml+rYAAAASSURBVBhXY2AYJuA/GBwY6jQAyDyoK8QcL4QAAAAASUVORK5CYII="/><element name="playIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAiUlEQVR42u3XSw2AMBREURwgAQlIQAISKgUpSEFKJeCg5b0E0kWBTVcD9ySTsL0Jn9IBAAAA+K2UUrBlW/Rr5ZDoIeeuoFkxJD9ss03aIXXQqB9SttoG7ZA6qNcOKdttiwcJh9RB+iFl4SshkRBuLR72+9cvH0SOKI2HRo7x/Fi1/uoCAAAAwLsD8ki99IlO2dQAAAAASUVORK5CYII="/><element name="muteIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAVUlEQVR42u3WMQrAIAxAUW/g/SdvGmvpoOBeSHgPsjj5QTANAACARCJilIhYM0tEvJM+Ik3Id9E957kQIb+F3OdCPC0hPkQriqWx9hp/x/QGAABQyAPLB22VGrpLDgAAAABJRU5ErkJggg=="/><element name="errorIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAA/0lEQVR42u2U0QmEMBAF7cASLMESUoIlpARLSCkpwRJSgiWkhOvAXD4WsgRkyaG5DbyB+Yvg8KITAAAAAAAYk+u61mwk15EjPtlEfihmqIiZR1Qx80ghjgdUuiHXGHSVsoag0x6x8DUoyjD5KovmEJ9NTDMRPIT0mtdIUkjlonuNohO+Ha99DTmkuGgKCTcvebAzx82ZoCWC3/3aIMWSRucaxcjORSFY4xpFdjYJGp1rFGcyCYZ/RVh6AUnfcNZ2zih3/mGj1jVCdiNDwyrq1rA/xMdeEXvDVdnYc1vDc3uPkDObXrlaxbNHSOohQhr/WOeLEWfWTgAAAAAAADzNF9sHJ7PJ57MlAAAAAElFTkSuQmCC"/><element name="bufferIcon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAACBklEQVR42u3Zv0sCYRzH8USTzOsHHEWGkC1HgaDgkktGDjUYtDQ01RDSljQ1BLU02+rk1NTm2NLq4Nx/0L/h9fnCd3j4cnZe1/U8xiO8h3uurufF0/3COd/3/0UWYiEWYiEWYiGJQ+J8xuPxKhXjEMZANinjIZhkGuVRNioE4wVURo4JkHm0xKWmhRAc1bh1EyCUw5BcBIjHiApKa4CErko6DEJwuRo6IRKzyJD8FJAyI3Zp2zRImiBcRhlfo5RtlxCcE3CcDNpGrhYIT2IhAJKilO0VRmzJ32fAMTpBTS0QMfGwlcuKMRftE0DJ0wCJdcOsCkBdXP3Mh9CEFUBTPS9mDZJBG6io4aqVzMdCokCw9H3kT6j/C/9iDdSeUMNC7DkyyxAs/Rk6Qss8FPWRZgdVtUH4DjxEn1zxh+/zj1wHlf4MQhNGrwqA6sY40U8JonRJwEQh+AO3AvCG6gHv4U7IY4krxkroWoAOkoQMGfCBrgIm+YBGqPENpIJ66CJg3x66Y0gnSUidAEEnNr9jjLiWMn5DiWP0OC/oAsCgkq43xBdGDMQr7YASP/vEkHvdl1+JOCcEV5sC4hGEOzTlPuKgd0b0xD4JkRcOgnRRTjdErkYhAsQVq6IdUuPJtmk7BCL3t/h88cx91pKQkI/pkDx6pmYTIjEoxiHsN1YWYiEWYiEWknhflZ5IErA5nr8AAAAASUVORK5CYII="/></elements></component><component name="dock"><settings><setting name="fontcolor" value="0xffffff"/></settings><elements><element name="button" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyAQMAAAAk8RryAAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlOZpuml+rYAAAASSURBVBhXY2AYJuA/GBwY6jQAyDyoK8QcL4QAAAAASUVORK5CYII="/></elements></component><component name="playlist"><settings><setting name="backgroundcolor" value="0xe8e8e8"/></settings><elements><element name="item" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAIAAAC1nk4lAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHBJREFUaN7t2MENwCAMBEEe9N8wSKYC/D8YV7CyJoRkVtVImxkZPQInMxoP0XiIxkM0HsGbjjSNBx544IEHHnjggUe/6UQeey0PIh7XTftGxKPj4eXCtLsHHh+ZxkO0Iw8PR55Ni8ZD9Hu/EAoP0dc5RRg9qeRjVF8AAAAASUVORK5CYII="/><element name="sliderCapTop" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAFUlEQVQokWP8//8/A7UB46ihI9hQAKt6FPPXhVGHAAAAAElFTkSuQmCC"/><element name="sliderRail" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAUCAYAAABiS3YzAAAAKElEQVQ4y2P4//8/Az68bNmy/+iYkB6GUUNHDR01dNTQUUNHDaXcUABUDOKhcxnsSwAAAABJRU5ErkJggg=="/><element name="sliderThumb" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAUCAYAAABiS3YzAAAAJUlEQVQ4T2P4//8/Ay4MBP9xYbz6Rg0dNXTU0FFDRw0dNZRyQwHH4NBa7GJsXAAAAABJRU5ErkJggg=="/><element name="sliderCapBottom" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAHCAYAAADnCQYGAAAAFUlEQVQokWP8//8/A7UB46ihI9hQAKt6FPPXhVGHAAAAAElFTkSuQmCC"/></elements></component></components></skin>',this.xml=null,window.DOMParser?(parser=new DOMParser,this.xml=parser.parseFromString(this.text,"text/xml")):(this.xml=new ActiveXObject("Microsoft.XMLDOM"),this.xml.async="false",this.xml.loadXML(this.text)),this},function(a){_utils=a.utils,_css=_utils.css,_hide=function(b){_css(b,{display:"none"})},_show=function(b){_css(b,{display:"block"})},a.html5.display=function(k,K){function B(Y){z=W.display_image.naturalWidth,T=W.display_image.naturalHeight,c(),h.jwGetState()!=a.api.events.state.IDLE&&"sound"!=h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider||(_css(W.display_image,{display:"block",opacity:0}),_utils.fadeTo(W.display_image,1,.1)),C=!1}function c(){if(h.jwGetFullscreen()&&h.jwGetStretching()==a.utils.stretching.EXACTFIT){var Y=document.createElement("div");_utils.stretch(a.utils.stretching.UNIFORM,Y,e,w,y,R),_utils.stretch(a.utils.stretching.EXACTFIT,W.display_image,_utils.parseDimension(Y.style.width),_utils.parseDimension(Y.style.height),z,T),_css(W.display_image,{left:Y.style.left,top:Y.style.top})}else _utils.stretch(h.jwGetStretching(),W.display_image,e,w,z,T)}function G(Y,aa){var Z=document.createElement(Y);return Z.id=h.id+"_jwplayer_"+aa,_css(Z,H[aa].style),Z}function f(){for(var Y in W)_utils.exists(H[Y].click)&&(W[Y].onclick=H[Y].click)}function U(Y){E?F():(W.display_icon.style.backgroundImage=["url(",h.skin.getSkinElement("display",Y).src,")"].join(""),_css(W.display_icon,{width:h.skin.getSkinElement("display",Y).width,height:h.skin.getSkinElement("display",Y).height,top:(h.skin.getSkinElement("display","background").height-h.skin.getSkinElement("display",Y).height)/2,left:(h.skin.getSkinElement("display","background").width-h.skin.getSkinElement("display",Y).width)/2}),b(),_utils.exists(h.skin.getSkinElement("display",Y+"Over"))?(W.display_icon.onmouseover=function(Z){W.display_icon.style.backgroundImage=["url(",h.skin.getSkinElement("display",Y+"Over").src,")"].join("")},W.display_icon.onmouseout=function(Z){W.display_icon.style.backgroundImage=["url(",h.skin.getSkinElement("display",Y).src,")"].join("")}):(W.display_icon.onmouseover=null,W.display_icon.onmouseout=null))}function F(){"true"==X.icons.toString()&&(_hide(W.display_icon),_hide(W.display_iconBackground),S())}function b(){g||"true"!=X.icons.toString()||(_show(W.display_icon),_show(W.display_iconBackground),J())}function I(){V=!1,W.display_image.style.display="none"}function q(Y){Y.type!=a.api.events.JWPLAYER_PLAYER_STATE&&Y.type!=a.api.events.JWPLAYER_PLAYLIST_ITEM||!E||(E=!1,_hide(W.display_text));var Z=h.jwGetState();Z!=v&&(v=Z,D>=0&&clearTimeout(D),O||h.jwGetState()==a.api.events.state.PLAYING||h.jwGetState()==a.api.events.state.PAUSED?t(h.jwGetState()):D=setTimeout(l(h.jwGetState()),500))}function l(Y){return function(){t(Y)}}function t(Y){switch(_utils.exists(M)&&(clearInterval(M),M=null,_utils.animations.rotate(W.display_icon,0)),Y){case a.api.events.state.BUFFERING:_utils.isIPod()?(I(),F()):("sound"==h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider&&x(),u=0,M=setInterval(function(){u+=N,_utils.animations.rotate(W.display_icon,u%360)},s),U("bufferIcon"),O=!0);break;case a.api.events.state.PAUSED:_utils.isIPod()||("sound"!=h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider&&_css(W.display_image,{background:"transparent no-repeat center center"}),U("playIcon"),O=!0);break;case a.api.events.state.IDLE:h.jwGetPlaylist()[h.jwGetPlaylistIndex()]&&h.jwGetPlaylist()[h.jwGetPlaylistIndex()].image?x():I(),U("playIcon"),O=!0;break;default:h.jwGetPlaylist()[h.jwGetPlaylistIndex()]&&"sound"==h.jwGetPlaylist()[h.jwGetPlaylistIndex()].provider?_utils.isIPod()?(I(),O=!1):x():(I(),O=!1),h.jwGetMute()&&X.showmute?U("muteIcon"):F()}D=-1}function x(){if(h.jwGetPlaylist()[h.jwGetPlaylistIndex()]){var Y=h.jwGetPlaylist()[h.jwGetPlaylistIndex()].image;Y&&(Y!=p?(p=Y,C=!0,W.display_image.src=_utils.getAbsolutePath(Y)):C||V||(V=!0,W.display_image.style.opacity=0,W.display_image.style.display="block",_utils.fadeTo(W.display_image,1,.1)))}}function A(Y){return function(){o&&(g||d==Y||(d=Y,L.sendEvent(Y,{component:"display",boundingRect:_utils.getDimensions(W.display_iconBackground)})))}}var e,w,z,T,u,M,E,d,m,y,R,j={icons:!0,showmute:!1},X=_utils.extend({},j,K),h=k,W={},N=_utils.exists(h.skin.getComponentSettings("display").bufferrotation)?parseInt(h.skin.getComponentSettings("display").bufferrotation,10):15,s=_utils.exists(h.skin.getComponentSettings("display").bufferinterval)?parseInt(h.skin.getComponentSettings("display").bufferinterval,10):100,D=-1,v=a.api.events.state.IDLE,O=!0,C=!1,V=!0,p="",g=!1,o=!1,L=new a.html5.eventdispatcher;_utils.extend(this,L);var H={display:{style:{cursor:"pointer",top:0,left:0,overflow:"hidden"},click:function(Y){void 0!==Y.preventDefault?Y.preventDefault():Y.returnValue=!1,"function"!=typeof m?h.jwGetState()!=a.api.events.state.PLAYING?h.jwPlay():h.jwPause():m(Y)}},display_icon:{style:{cursor:"pointer",position:"absolute",top:(h.skin.getSkinElement("display","background").height-h.skin.getSkinElement("display","playIcon").height)/2,left:(h.skin.getSkinElement("display","background").width-h.skin.getSkinElement("display","playIcon").width)/2,border:0,margin:0,padding:0,zIndex:3,display:"none"}},display_iconBackground:{style:{cursor:"pointer",position:"absolute",top:(w-h.skin.getSkinElement("display","background").height)/2,left:(e-h.skin.getSkinElement("display","background").width)/2,border:0,backgroundImage:["url(",h.skin.getSkinElement("display","background").src,")"].join(""),width:h.skin.getSkinElement("display","background").width,height:h.skin.getSkinElement("display","background").height,margin:0,padding:0,zIndex:2,display:"none"}},display_image:{style:{display:"none",width:e,height:w,position:"absolute",cursor:"pointer",left:0,top:0,margin:0,padding:0,textDecoration:"none",zIndex:1}},display_text:{style:{zIndex:4,position:"relative",opacity:.8,backgroundColor:parseInt("000000",16),color:parseInt("ffffff",16),textAlign:"center",fontFamily:"Arial,sans-serif",padding:"0 5px",fontSize:14}}};h.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,q),h.jwAddEventListener(a.api.events.JWPLAYER_MEDIA_MUTE,q),h.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,function(){v=""}),h.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_ITEM,q),h.jwAddEventListener(a.api.events.JWPLAYER_ERROR,function(Y){E=!0,F(),W.display_text.innerHTML=Y.message,_show(W.display_text),W.display_text.style.top=(w-_utils.getBoundingClientRect(W.display_text).height)/2+"px"}),W.display=G("div","display"),W.display_text=G("div","display_text"),W.display.appendChild(W.display_text),W.display_image=G("img","display_image"),W.display_image.onerror=function(Y){_hide(W.display_image)},W.display_image.onload=B,W.display_icon=G("div","display_icon"),W.display_iconBackground=G("div","display_iconBackground"),W.display.appendChild(W.display_image),W.display_iconBackground.appendChild(W.display_icon),W.display.appendChild(W.display_iconBackground),f(),setTimeout(function(){o=!0,"true"==X.icons.toString()&&J()},1),this.getDisplayElement=function(){return W.display},this.resize=function(Z,Y){h.jwGetFullscreen()&&_utils.isMobile()||(_css(W.display,{width:Z,height:Y}),_css(W.display_text,{width:Z-10,top:(Y-_utils.getBoundingClientRect(W.display_text).height)/2}),_css(W.display_iconBackground,{top:(Y-h.skin.getSkinElement("display","background").height)/2,left:(Z-h.skin.getSkinElement("display","background").width)/2}),e==Z&&w==Y||(e=Z,w=Y,d=void 0,J()),h.jwGetFullscreen()||(y=Z,R=Y),c(),q({}))},this.show=function(){g&&(g=!1,t(h.jwGetState()))},this.hide=function(){g||(F(),g=!0)};var J=A(a.api.events.JWPLAYER_COMPONENT_SHOW),S=A(a.api.events.JWPLAYER_COMPONENT_HIDE);return this.setAlternateClickHandler=function(Y){m=Y},this.revertAlternateClickHandler=function(){m=void 0},this}}(jwplayer),function(a){var c=a.utils,b=c.css;a.html5.dock=function(w,D){function h(H){return"url("+H+") no-repeat center center"}function l(H,T){if(p(),A.length>0){var R,L,I=10,S=I,P=-1,Q=w.skin.getSkinElement("dock","button").height,O=w.skin.getSkinElement("dock","button").width,M=H-O-I;n.align==a.html5.view.positions.LEFT&&(P=1,M=I);for(var J=0;J<A.length;J++){var U=Math.floor(S/T);S+Q+I>(U+1)*T&&(S=(U+1)*T+I,U=Math.floor(S/T));var K=j[A[J]].div;K.style.top=S%T+"px",K.style.left=M+(w.skin.getSkinElement("dock","button").width+I)*U*P+"px";var N={x:c.parseDimension(K.style.left),y:c.parseDimension(K.style.top),width:O,height:Q};(!R||N.x<=R.x&&N.y<=R.y)&&(R=N),(!L||N.x>=L.x&&N.y>=L.y)&&(L=N),K.style.width=O+"px",K.style.height=Q+"px",S+=w.skin.getSkinElement("dock","button").height+I}g={x:R.x,y:R.y,width:L.x-R.x+L.width,height:R.y-L.y+L.height}}C==w.jwGetFullscreen()&&k==H&&F==T||(k=H,F=T,C=w.jwGetFullscreen(),z=void 0,setTimeout(s,1))}function d(H){return function(){!f&&z!=H&&A.length>0&&(z=H,m.sendEvent(H,{component:"dock",boundingRect:g}))}}function B(H){if(!f)if(clearTimeout(y),D.position==a.html5.view.positions.OVER||w.jwGetFullscreen())switch(w.jwGetState()){case a.api.events.state.PAUSED:case a.api.events.state.IDLE:r&&r.style.opacity<1&&(!D.idlehide||c.exists(H))&&E(),D.idlehide&&(y=setTimeout(function(){u()},2e3));break;default:c.exists(H)&&E(),y=setTimeout(function(){u()},2e3)}else E()}function u(){f||(G(),1==r.style.opacity&&(c.cancelAnimation(r),c.fadeTo(r,0,.1,1,0)))}function E(){f||(s(),0==r.style.opacity&&(c.cancelAnimation(r),c.fadeTo(r,1,.1,0,0)))}function p(){try{(o=document.getElementById(w.id)).addEventListener("mousemove",B)}catch(H){c.log("Could not add mouse listeners to dock: "+H)}}var n=c.extend({},{align:a.html5.view.positions.RIGHT},D);if("FALSE"!=n.align){var k,F,z,o,y,j={},A=[],f=!1,C=!1,g={x:0,y:0,width:0,height:0},m=new a.html5.eventdispatcher;c.extend(this,m);var r=document.createElement("div");r.id=w.id+"_jwplayer_dock",r.style.opacity=1,p(),w.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,function(H){c.isMobile()?H.newstate==a.api.events.state.IDLE?v():e():B()}),this.getDisplayElement=function(){return r},this.setButton=function(K,H,I,J){!H&&j[K]?(c.arrays.remove(A,K),r.removeChild(j[K].div),delete j[K]):H&&(j[K]||(j[K]={}),j[K].handler=H,j[K].outGraphic=I,j[K].overGraphic=J,j[K].div||(A.push(K),j[K].div=document.createElement("div"),j[K].div.style.position="absolute",r.appendChild(j[K].div),j[K].div.appendChild(document.createElement("div")),j[K].div.childNodes[0].style.position="relative",j[K].div.childNodes[0].style.width="100%",j[K].div.childNodes[0].style.height="100%",j[K].div.childNodes[0].style.zIndex=10,j[K].div.childNodes[0].style.cursor="pointer",j[K].div.appendChild(document.createElement("img")),j[K].div.childNodes[1].style.position="absolute",j[K].div.childNodes[1].style.left=0,j[K].div.childNodes[1].style.top=0,w.skin.getSkinElement("dock","button")&&(j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src),j[K].div.childNodes[1].style.zIndex=9,j[K].div.childNodes[1].style.cursor="pointer",j[K].div.onmouseover=function(){j[K].overGraphic&&(j[K].div.childNodes[0].style.background=h(j[K].overGraphic)),w.skin.getSkinElement("dock","buttonOver")&&(j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","buttonOver").src)},j[K].div.onmouseout=function(){j[K].outGraphic&&(j[K].div.childNodes[0].style.background=h(j[K].outGraphic)),w.skin.getSkinElement("dock","button")&&(j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src)},w.skin.getSkinElement("dock","button")&&(j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src)),j[K].outGraphic?j[K].div.childNodes[0].style.background=h(j[K].outGraphic):j[K].overGraphic&&(j[K].div.childNodes[0].style.background=h(j[K].overGraphic)),H&&(j[K].div.onclick=function(L){L.preventDefault(),a(w.id).callback(K),j[K].overGraphic&&(j[K].div.childNodes[0].style.background=h(j[K].overGraphic)),w.skin.getSkinElement("dock","button")&&(j[K].div.childNodes[1].src=w.skin.getSkinElement("dock","button").src)})),l(k,F)};var s=d(a.api.events.JWPLAYER_COMPONENT_SHOW),G=d(a.api.events.JWPLAYER_COMPONENT_HIDE);this.resize=l;var v=function(){b(r,{display:"block"}),f&&(f=!1,s())},e=function(){b(r,{display:"none"}),f||(G(),f=!0)};return this.hide=e,this.show=v,this}}}(jwplayer),function(a){a.html5.eventdispatcher=function(d,b){var c=new a.events.eventdispatcher(b);a.utils.extend(this,c),this.sendEvent=function(e,f){a.utils.exists(f)||(f={}),a.utils.extend(f,{id:d,version:a.version,type:e}),c.sendEvent(e,f)}}}(jwplayer),function(a){var b=a.utils;a.html5.instream=function(y,m,x,z){function c(){_fakemodel.setMute(E.mute),_fakemodel.setVolume(E.volume)}function F(){g||((g=new a.html5.mediavideo(_fakemodel,E.getMedia()?E.getMedia().getDisplayElement():E.container)).addGlobalListener(I),g.addEventListener(a.api.events.JWPLAYER_MEDIA_META,J),g.addEventListener(a.api.events.JWPLAYER_MEDIA_COMPLETE,u),g.addEventListener(a.api.events.JWPLAYER_MEDIA_BUFFER_FULL,B)),g.attachMedia()}function I(K){h&&D(K.type,K)}function B(K){h&&g.play()}function u(K){h&&setTimeout(function(){n.jwInstreamDestroy(!0)},10)}function J(K){K.metadata.width&&K.metadata.height&&j.resizeMedia()}function D(K,L,M){(h||M)&&k.sendEvent(K,L)}function p(){var K=E.plugins.object.display.getDisplayElement().style;if(l){var L=E.plugins.object.controlbar.getDisplayElement().style;l.resize(b.parseDimension(K.width),b.parseDimension(K.height)),_css(l.getDisplayElement(),b.extend({},L,{zIndex:1001,opacity:1}))}q&&(q.resize(b.parseDimension(K.width),b.parseDimension(K.height)),_css(q.getDisplayElement(),b.extend({},K,{zIndex:1e3}))),j&&j.resizeMedia()}var v,A,r,H,o,G,e,f,g,l,q,k,d,t={controlbarseekable:"always",controlbarpausable:!0,controlbarstoppable:!0,playlistclickable:!0},C=y,E=m,j=x,w=z,h=!1,n=this;return this.load=function(M,K){c(),h=!0,A=b.extend(t,K),v=a.html5.playlistitem(M),F(),(d=document.createElement("div")).id=n.id+"_instream_container",w.detachMedia(),r=g.getDisplayElement(),f=E.playlist[E.item],(e=C.jwGetState())!=a.api.events.state.BUFFERING&&e!=a.api.events.state.PLAYING||r.pause(),H=r.src?r.src:r.currentSrc,o=r.innerHTML,G=r.currentTime,(q=new a.html5.display(n,b.extend({},E.plugins.config.display))).setAlternateClickHandler(function(N){_fakemodel.state==a.api.events.state.PAUSED?n.jwInstreamPlay():D(a.api.events.JWPLAYER_INSTREAM_CLICK,N)}),d.appendChild(q.getDisplayElement()),b.isMobile()||(l=new a.html5.controlbar(n,b.extend({},E.plugins.config.controlbar,{})),E.plugins.config.controlbar.position==a.html5.view.positions.OVER?d.appendChild(l.getDisplayElement()):E.plugins.object.controlbar.getDisplayElement().parentNode.appendChild(l.getDisplayElement())),j.setupInstream(d,r),p(),g.load(v)},this.jwInstreamDestroy=function(K){if(h){if(h=!1,e!=a.api.events.state.IDLE?(g.load(f,!1),g.stop(!1)):g.stop(!0),g.detachMedia(),j.destroyInstream(),l)try{l.getDisplayElement().parentNode.removeChild(l.getDisplayElement())}catch(L){}D(a.api.events.JWPLAYER_INSTREAM_DESTROYED,{reason:K?"complete":"destroyed"},!0),w.attachMedia(),e!=a.api.events.state.BUFFERING&&e!=a.api.events.state.PLAYING||(r.play(),E.playlist[E.item]==f&&E.getMedia().seek(G))}},this.jwInstreamAddEventListener=function(K,L){k.addEventListener(K,L)},this.jwInstreamRemoveEventListener=function(K,L){k.removeEventListener(K,L)},this.jwInstreamPlay=function(){h&&g.play(!0)},this.jwInstreamPause=function(){h&&g.pause(!0)},this.jwInstreamSeek=function(K){h&&g.seek(K)},this.jwInstreamGetState=function(){if(h)return _fakemodel.state},this.jwInstreamGetPosition=function(){if(h)return _fakemodel.position},this.jwInstreamGetDuration=function(){if(h)return _fakemodel.duration},this.playlistClickable=function(){return!h||"true"==A.playlistclickable.toString().toLowerCase()},this.jwPlay=function(K){"true"==A.controlbarpausable.toString().toLowerCase()&&this.jwInstreamPlay()},this.jwPause=function(K){"true"==A.controlbarpausable.toString().toLowerCase()&&this.jwInstreamPause()},this.jwStop=function(){"true"==A.controlbarstoppable.toString().toLowerCase()&&(this.jwInstreamDestroy(),C.jwStop())},this.jwSeek=function(K){switch(A.controlbarseekable.toLowerCase()){case"always":this.jwInstreamSeek(K);break;case"backwards":_fakemodel.position>K&&this.jwInstreamSeek(K)}},this.jwGetPosition=function(){},this.jwGetDuration=function(){},this.jwGetWidth=C.jwGetWidth,this.jwGetHeight=C.jwGetHeight,this.jwGetFullscreen=C.jwGetFullscreen,this.jwSetFullscreen=C.jwSetFullscreen,this.jwGetVolume=function(){return E.volume},this.jwSetVolume=function(K){g.volume(K),C.jwSetVolume(K)},this.jwGetMute=function(){return E.mute},this.jwSetMute=function(K){g.mute(K),C.jwSetMute(K)},this.jwGetState=function(){return _fakemodel.state},this.jwGetPlaylist=function(){return[v]},this.jwGetPlaylistIndex=function(){return 0},this.jwGetStretching=function(){return E.config.stretching},this.jwAddEventListener=function(L,K){k.addEventListener(L,K)},this.jwRemoveEventListener=function(L,K){k.removeEventListener(L,K)},this.skin=C.skin,this.id=C.id+"_instream",function(){_fakemodel=new a.html5.model(this,E.getMedia()?E.getMedia().getDisplayElement():E.container,E),k=new a.html5.eventdispatcher,C.jwAddEventListener(a.api.events.JWPLAYER_RESIZE,p),C.jwAddEventListener(a.api.events.JWPLAYER_FULLSCREEN,p)}(),this}}(jwplayer),function(a){var b={prefix:"",file:"",link:"",linktarget:"_top",margin:8,out:.5,over:1,timeout:5,hide:!0,position:"bottom-left"};_css=a.utils.css,a.html5.logo=function(n,r){function o(){if(b.prefix){var v=n.version.split(/\W/).splice(0,2).join("/");b.prefix.indexOf(v)<0&&(b.prefix+=v+"/")}r.position==a.html5.view.positions.OVER&&(r.position=b.position);try{0==window.location.href.indexOf("https")&&(b.prefix=b.prefix.replace("http://l.longtailvideo.com","https://securel.longtailvideo.com"))}catch(w){}d=a.utils.extend({},b,r)}function c(){(t=document.createElement("img")).id=q.id+"_jwplayer_logo",t.style.display="none",t.onload=function(v){_css(t,k()),p()},d.file&&(d.file.indexOf("/")>=0?t.src=d.file:t.src=d.prefix+d.file)}function l(){d.link?(t.onmouseover=f,t.onmouseout=p,t.onclick=s):this.mouseEnabled=!1}function s(v){void 0!==v&&v.stopPropagation(),h&&(q.jwPause(),q.jwSetFullscreen(!1),d.link&&window.open(d.link,d.linktarget))}function p(v){d.link&&h&&(t.style.opacity=d.out)}function f(v){h&&(t.style.opacity=d.over)}function k(){var x={textDecoration:"none",position:"absolute",cursor:"pointer"};x.display="true"!=d.hide.toString()||h?"block":"none";var w=d.position.toLowerCase().split("-");for(var v in w)x[w[v]]=parseInt(d.margin);return x}function m(){"true"==d.hide.toString()&&(t.style.display="block",t.style.opacity=0,a.utils.fadeTo(t,d.out,.1,parseFloat(t.style.opacity)),u=setTimeout(function(){e()},1e3*d.timeout)),h=!0}function e(){h=!1,"true"==d.hide.toString()&&a.utils.fadeTo(t,0,.1,parseFloat(t.style.opacity))}function j(v){v.newstate==a.api.events.state.BUFFERING&&(clearTimeout(u),m())}var u,d,t,q=n,h=!1;if(o(),q.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,j),c(),l(),d.file)return this.resize=function(w,v){},this.getDisplayElement=function(){return t},this}}(jwplayer),function(b){var g,e,d={ended:b.api.events.state.IDLE,playing:b.api.events.state.PLAYING,pause:b.api.events.state.PAUSED,buffering:b.api.events.state.BUFFERING},f=b.utils,a=f.isMobile(),c={};b.html5.mediavideo=function(k,I){function K(Y,X){return E[Y]?E[Y]:(E[Y]=function(Z){f.exists(Z.target.parentNode)&&X(Z)},E[Y])}function p(){var X=c[l.id];X||(X="video"==D.tagName.toLowerCase()?D:document.createElement("video"),c[l.id]=X,X.id||(X.id=D.id));for(var Y in M)X.addEventListener(Y,K(Y,M[Y]),!0);return X}function y(X){if(X!=b.api.events.state.PAUSED||h!=b.api.events.state.IDLE){if(a)switch(X){case b.api.events.state.PLAYING:S();break;case b.api.events.state.BUFFERING:case b.api.events.state.PAUSED:x()}if(h!=X){var Y=h;l.state=h=X,u(b.api.events.JWPLAYER_PLAYER_STATE,{oldstate:Y,newstate:X})}}}function A(X){}function G(Z){if(v){var Y;if(f.exists(Z)&&Z.lengthComputable&&Z.total)Y=Z.loaded/Z.total*100;else if(f.exists(o.buffered)&&o.buffered.length>0){var X=o.buffered.length-1;X>=0&&(Y=o.buffered.end(X)/o.duration*100)}f.useNativeFullscreen()&&f.exists(o.webkitDisplayingFullscreen)&&l.fullscreen!=o.webkitDisplayingFullscreen&&u(b.api.events.JWPLAYER_FULLSCREEN,{fullscreen:o.webkitDisplayingFullscreen},!0),!1===J&&h==b.api.events.state.BUFFERING&&(u(b.api.events.JWPLAYER_MEDIA_BUFFER_FULL),J=!0),L||(100==Y&&(L=!0),f.exists(Y)&&Y>l.buffer&&(l.buffer=Math.round(Y),u(b.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:Math.round(Y)})))}}function r(X){v&&(g&&e&&(o.style.width=g,o.style.height=e,g=_previousHieght=0),d[X.type]&&("ended"==X.type?R():y(d[X.type])))}function w(Y){if(v){var X=Math.round(10*o.duration)/10,Z={height:o.videoHeight,width:o.videoWidth,duration:X};z||(l.duration<X||isNaN(l.duration))&&o.duration!=1/0&&(l.duration=X),u(b.api.events.JWPLAYER_MEDIA_META,{metadata:Z})}}function V(){var Z="";for(var Y in W.levels){var X=W.levels[Y];D.ownerDocument.createElement("source");Z+=b.utils.getAbsolutePath(X.file),Y<W.levels.length-1&&(Z+=", ")}return Z}function C(){f.exists(H)||(H=setInterval(function(){G()},100))}function t(){clearInterval(H),H=null}function R(){h==b.api.events.state.PLAYING&&(B(!1),u(b.api.events.JWPLAYER_MEDIA_BEFORECOMPLETE),u(b.api.events.JWPLAYER_MEDIA_COMPLETE))}function s(Z){if(Z.length>0&&f.userAgentMatch(/Safari/i)&&!f.userAgentMatch(/Chrome/i)){for(var X=-1,Y=0;Y<Z.length;Y++)switch(f.extension(Z[Y].file)){case"mp4":X<0&&(X=Y);break;case"webm":Z.splice(Y,1)}if(X>0){var aa=Z.splice(X,1)[0];Z.unshift(aa)}}}function S(){setTimeout(function(){o.setAttribute("controls","controls")},100)}function x(){setTimeout(function(){o.removeAttribute("controls")},250)}function u(X,Z,Y){(v||Y)&&(Z?N.sendEvent(X,Z):N.sendEvent(X))}var M={abort:A,canplay:r,canplaythrough:r,durationchange:w,emptied:A,ended:r,error:function(Z){if(v&&h!=b.api.events.state.IDLE){var Y="There was an error: ";if(Z.target.error&&"video"==Z.target.tagName.toLowerCase()||Z.target.parentNode.error&&"video"==Z.target.parentNode.tagName.toLowerCase()){var X=f.exists(Z.target.error)?Z.target.error:Z.target.parentNode.error;switch(X.code){case X.MEDIA_ERR_ABORTED:return void f.log("User aborted the video playback.");case X.MEDIA_ERR_NETWORK:Y="A network error caused the video download to fail part-way: ";break;case X.MEDIA_ERR_DECODE:Y="The video playback was aborted due to a corruption problem or because the video used features your browser did not support: ";break;case X.MEDIA_ERR_SRC_NOT_SUPPORTED:Y="The video could not be loaded, either because the server or network failed or because the format is not supported: ";break;default:Y="An unknown error occurred: "}}else{if("source"!=Z.target.tagName.toLowerCase())return void f.log("An unknown error occurred.  Continuing...");if(--T>0)return;if(f.userAgentMatch(/firefox/i))return f.log("The video could not be loaded, either because the server or network failed or because the format is not supported."),void B(!1);Y="The video could not be loaded, either because the server or network failed or because the format is not supported: "}B(!1),Y+=V(),_error=!0,u(b.api.events.JWPLAYER_ERROR,{message:Y})}},loadeddata:w,loadedmetadata:w,loadstart:r,pause:r,play:A,playing:r,progress:G,ratechange:A,seeked:r,seeking:r,stalled:r,suspend:r,timeupdate:function(Y){if(v){if(f.exists(Y)&&f.exists(Y.target)&&(z>0&&!isNaN(Y.target.duration)&&(isNaN(l.duration)||l.duration<1)&&(Y.target.duration==1/0?l.duration=0:l.duration=Math.round(10*Y.target.duration)/10),!F&&o.readyState>0&&y(b.api.events.state.PLAYING),h==b.api.events.state.PLAYING)){if(o.readyState>0&&(P>-1||!F)){F=!0;try{o.currentTime!=P&&P>-1&&(o.currentTime=P,P=-1)}catch(X){}o.volume=l.volume/100,o.muted=l.mute}if(l.position=l.duration>0?Math.round(10*Y.target.currentTime)/10:0,u(b.api.events.JWPLAYER_MEDIA_TIME,{position:l.position,duration:l.duration}),l.position>=l.duration&&(l.position>0||l.duration>0))return void R()}G(Y)}},volumechange:function(X){var Y=Math.round(100*o.volume);u(b.api.events.JWPLAYER_MEDIA_VOLUME,{volume:Y},!0),u(b.api.events.JWPLAYER_MEDIA_MUTE,{mute:o.muted},!0)},waiting:r,canshowcurrentframe:A,dataunavailable:A,empty:A,load:function(X){},loadedfirstframe:A,webkitfullscreenchange:function(X){f.exists(o.webkitDisplayingFullscreen)&&l.fullscreen&&!o.webkitDisplayingFullscreen&&u(b.api.events.JWPLAYER_FULLSCREEN,{fullscreen:!1},!0)}},E={},N=new b.html5.eventdispatcher;f.extend(this,N);var o,h,F,W,H,P,L,J,T,l=k,D=I,O=!1,v=!1,z=!1;h=b.api.events.state.IDLE,v=!0,(o=p()).setAttribute("x-webkit-airplay","allow"),D.parentNode&&(o.id=D.id,D.parentNode.replaceChild(o,D)),this.load=function(Y,Z){if(void 0===Z&&(Z=!0),v){if(W=Y,z=W.duration>0,l.duration=W.duration,f.empty(o),o.style.display="block",o.style.opacity=1,g&&e&&(o.style.width=g,o.style.height=e,g=_previousHieght=0),T=0,s(Y.levels),Y.levels&&Y.levels.length>0)if(1==Y.levels.length||f.isIOS())o.src=Y.levels[0].file;else{o.src&&o.removeAttribute("src");for(var X=0;X<Y.levels.length;X++){var aa=o.ownerDocument.createElement("source");aa.src=Y.levels[X].file,o.appendChild(aa),T++}}else o.src=Y.file;o.volume=l.volume/100,o.muted=l.mute,a&&S(),L=J=F=!1,l.buffer=0,f.exists(Y.start)||(Y.start=0),P=Y.start>0?Y.start:-1,u(b.api.events.JWPLAYER_MEDIA_LOADED),(a||1!=Y.levels.length)&&O||o.load(),O=!1,Z&&(y(b.api.events.state.BUFFERING),u(b.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:0}),C()),o.videoWidth>0&&o.videoHeight>0&&w()}},this.play=function(){v&&(C(),J?y(b.api.events.state.PLAYING):(o.load(),y(b.api.events.state.BUFFERING)),o.play())},this.pause=function(){v&&(o.pause(),y(b.api.events.state.PAUSED))},this.seek=function(X){v&&(!F&&o.readyState>0?l.duration<=0||isNaN(l.duration)||l.position<=0||isNaN(l.position)||(o.currentTime=X,o.play()):P=X)};var B=this.stop=function(X){if(v){if(f.exists(X)||(X=!0),t(),X){J=!1;navigator.userAgent;if(o.webkitSupportsFullscreen)try{o.webkitExitFullscreen()}catch(Z){}o.style.opacity=0,x(),f.isIE()?o.src="":o.removeAttribute("src"),f.empty(o),o.load(),O=!0}if(f.isIPod())g=o.style.width,e=o.style.height,o.style.width=0,o.style.height=0;else if(f.isIPad()){o.style.display="none";try{o.webkitExitFullscreen()}catch(aa){}}y(b.api.events.state.IDLE)}};this.fullscreen=function(X){!0===X?this.resize("100%","100%"):this.resize(l.config.width,l.config.height)},this.resize=function(Y,X){},this.volume=function(X){a||(o.volume=X/100,u(b.api.events.JWPLAYER_MEDIA_VOLUME,{volume:X/100}))},this.mute=function(X){a||(o.muted=X,u(b.api.events.JWPLAYER_MEDIA_MUTE,{mute:X}))},this.getDisplayElement=function(){return o},this.hasChrome=function(){return a&&h==b.api.events.state.PLAYING},this.detachMedia=function(){return v=!1,this.getDisplayElement()},this.attachMedia=function(){v=!0},this.destroy=function(){if(o&&o.parentNode){t();for(var X in M)o.removeEventListener(X,K(X,M[X]),!0);f.empty(o),D=o.parentNode,o.parentNode.removeChild(o),delete c[l.id],o=null}}}}(jwplayer),function(a){a.api.events.state.IDLE,a.api.events.state.PLAYING,a.api.events.state.PAUSED,a.api.events.state.BUFFERING;var b=a.utils.css;a.html5.mediayoutube=function(j,e){function k(p){if(g!=p){var q=g;l.state=p,g=p,f.sendEvent(a.api.events.JWPLAYER_PLAYER_STATE,{oldstate:q,newstate:p})}}function o(v){var s=v.levels[0].file;s=["http://www.youtube.com/v/",d(s),"&amp;hl=en_US&amp;fs=1&autoplay=1"].join(""),(n=document.createElement("object")).id=h.id,n.style.position="absolute";var u={movie:s,allowfullscreen:"true",allowscriptaccess:"always"};for(var p in u){var t=document.createElement("param");t.name=p,t.value=u[p],n.appendChild(t)}m=document.createElement("embed"),n.appendChild(m);var q={src:s,type:"application/x-shockwave-flash",allowfullscreen:"true",allowscriptaccess:"always",width:n.width,height:n.height};for(var r in q)m.setAttribute(r,q[r]);n.appendChild(m),n.style.zIndex=2147483e3,h!=n&&h.parentNode&&h.parentNode.replaceChild(n,h),h=n}function d(q){for(var p=q.split(/\?|\#\!/),s="",r=0;r<p.length;r++)"v="==p[r].substr(0,2)&&(s=p[r].substr(2));return""==s&&(s=q.indexOf("/v/")>=0?q.substr(q.indexOf("/v/")+3):q.indexOf("youtu.be")>=0?q.substr(q.indexOf("youtu.be/")+9):q),s.indexOf("?")>-1&&(s=s.substr(0,s.indexOf("?"))),s.indexOf("&")>-1&&(s=s.substr(0,s.indexOf("&"))),s}var f=new a.html5.eventdispatcher;a.utils.extend(this,f);var n,m,l=j,h=document.getElementById(e.id),g=a.api.events.state.IDLE;return this.getDisplayElement=this.detachMedia=function(){return h},this.attachMedia=function(){},this.play=function(){g==a.api.events.state.IDLE?(f.sendEvent(a.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:100}),f.sendEvent(a.api.events.JWPLAYER_MEDIA_BUFFER_FULL),k(a.api.events.state.PLAYING)):g==a.api.events.state.PAUSED&&k(a.api.events.state.PLAYING)},this.pause=function(){k(a.api.events.state.PAUSED)},this.seek=function(p){},this.stop=function(p){_utils.exists(p)||(p=!0),l.position=0,k(a.api.events.state.IDLE),p&&b(h,{display:"none"})},this.volume=function(p){l.setVolume(p),f.sendEvent(a.api.events.JWPLAYER_MEDIA_VOLUME,{volume:Math.round(p)})},this.mute=function(p){h.muted=p,f.sendEvent(a.api.events.JWPLAYER_MEDIA_MUTE,{mute:p})},this.resize=function(q,p){q*p>0&&n&&(n.width=m.width=q,n.height=m.height=p)},this.fullscreen=function(p){!0===p?this.resize("100%","100%"):this.resize(l.config.width,l.config.height)},this.load=function(p){o(p),b(n,{display:"block"}),k(a.api.events.state.BUFFERING),f.sendEvent(a.api.events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:0}),f.sendEvent(a.api.events.JWPLAYER_MEDIA_LOADED),this.play()},this.hasChrome=function(){return g!=a.api.events.state.IDLE},this.embed=m,this}}(jwplayer),function(jwplayer){var _configurableStateVariables=["width","height","start","duration","volume","mute","fullscreen","item","plugins","stretching"],_utils=jwplayer.utils;jwplayer.html5.model=function(api,container,options){function _loadExternal(playlistfile){var loader=new jwplayer.html5.playlistloader;loader.addEventListener(jwplayer.api.events.JWPLAYER_PLAYLIST_LOADED,function(evt){_model.playlist=new jwplayer.html5.playlist(evt),_loadComplete()}),loader.addEventListener(jwplayer.api.events.JWPLAYER_ERROR,function(evt){_model.playlist=new jwplayer.html5.playlist({playlist:[]}),_loadComplete()}),loader.load(playlistfile)}function _loadComplete(){_model.config.shuffle?_model.item=_getShuffleItem():(_model.config.item>=_model.playlist.length?_model.config.item=_model.playlist.length-1:_model.config.item<0&&(_model.config.item=0),_model.item=_model.config.item),_model.position=0,_model.duration=_model.playlist.length>0?_model.playlist[_model.item].duration:0,_eventDispatcher.sendEvent(jwplayer.api.events.JWPLAYER_PLAYLIST_LOADED,{playlist:_model.playlist}),_eventDispatcher.sendEvent(jwplayer.api.events.JWPLAYER_PLAYLIST_ITEM,{index:_model.item})}function _getShuffleItem(){var result=null;if(_model.playlist.length>1)for(;!jwplayer.utils.exists(result);)(result=Math.floor(Math.random()*_model.playlist.length))==_model.item&&(result=null);else result=0;return result}function forward(evt){switch(evt.type){case jwplayer.api.events.JWPLAYER_MEDIA_LOADED:_container=_media.getDisplayElement();break;case jwplayer.api.events.JWPLAYER_MEDIA_MUTE:this.mute=evt.mute;break;case jwplayer.api.events.JWPLAYER_MEDIA_VOLUME:this.volume=evt.volume}_eventDispatcher.sendEvent(evt.type,evt)}var _api=api,_container=container,_cookies=_utils.getCookies(),_model={id:_container.id,playlist:[],state:jwplayer.api.events.state.IDLE,position:0,buffer:0,container:_container,config:{width:480,height:320,item:-1,skin:void 0,file:void 0,image:void 0,start:0,duration:0,bufferlength:5,volume:_cookies.volume?_cookies.volume:90,mute:!(!_cookies.mute||"true"!=_cookies.mute.toString().toLowerCase()),fullscreen:!1,repeat:"",stretching:jwplayer.utils.stretching.UNIFORM,autostart:!1,debug:void 0,screencolor:void 0}},_media,_eventDispatcher=new jwplayer.html5.eventdispatcher,_components=["display","logo","controlbar","playlist","dock"];jwplayer.utils.extend(_model,_eventDispatcher);for(var option in options){if("string"==typeof options[option]){var type=/color$/.test(option)?"color":null;options[option]=jwplayer.utils.typechecker(options[option],type)}var config=_model.config,path=option.split(".");for(var edge in path)edge==path.length-1?config[path[edge]]=options[option]:(jwplayer.utils.exists(config[path[edge]])||(config[path[edge]]={}),config=config[path[edge]])}for(var index in _configurableStateVariables){var configurableStateVariable=_configurableStateVariables[index];_model[configurableStateVariable]=_model.config[configurableStateVariable]}var pluginorder=_components.concat([]);if(jwplayer.utils.exists(_model.plugins)&&"string"==typeof _model.plugins){var userplugins=_model.plugins.split(",");for(var userplugin in userplugins)"string"==typeof userplugins[userplugin]&&pluginorder.push(userplugins[userplugin].replace(/^\s+|\s+$/g,""))}if(jwplayer.utils.isMobile()?(pluginorder=["display","logo","dock","playlist"],jwplayer.utils.exists(_model.config.repeat)||(_model.config.repeat="list")):_model.config.chromeless&&(pluginorder=["logo","dock","playlist"],jwplayer.utils.exists(_model.config.repeat)||(_model.config.repeat="list")),_model.plugins={order:pluginorder,config:{},object:{}},void 0!==_model.config.components)for(var component in _model.config.components)_model.plugins.config[component]=_model.config.components[component];var playlistVisible=!1;for(var pluginIndex in _model.plugins.order){var pluginName=_model.plugins.order[pluginIndex],pluginConfig=jwplayer.utils.exists(_model.plugins.config[pluginName])?_model.plugins.config[pluginName]:{};_model.plugins.config[pluginName]=jwplayer.utils.exists(_model.plugins.config[pluginName])?jwplayer.utils.extend(_model.plugins.config[pluginName],pluginConfig):pluginConfig,jwplayer.utils.exists(_model.plugins.config[pluginName].position)?("playlist"==pluginName&&(playlistVisible=!0),_model.plugins.config[pluginName].position=_model.plugins.config[pluginName].position.toString().toUpperCase()):_model.plugins.config[pluginName].position="playlist"==pluginName?jwplayer.html5.view.positions.NONE:jwplayer.html5.view.positions.OVER}if(_model.plugins.config.controlbar&&playlistVisible&&(_model.plugins.config.controlbar.hideplaylistcontrols=!0),void 0!==_model.plugins.config.dock){if("object"!=typeof _model.plugins.config.dock){var position=_model.plugins.config.dock.toString().toUpperCase();_model.plugins.config.dock={position:position}}if(void 0!==_model.plugins.config.dock.position&&(_model.plugins.config.dock.align=_model.plugins.config.dock.position,_model.plugins.config.dock.position=jwplayer.html5.view.positions.OVER),void 0===_model.plugins.config.dock.idlehide)try{_model.plugins.config.dock.idlehide=_model.plugins.config.controlbar.idlehide}catch(e){}}_model.loadPlaylist=function(arg){var input;if("string"==typeof arg)if(0==arg.indexOf("[")||"0"==arg.indexOf("{"))try{input=eval(arg)}catch(err){input=arg}else input=arg;else input=arg;var config;switch(jwplayer.utils.typeOf(input)){case"object":config=input;break;case"array":config={playlist:input};break;default:config={file:input}}_model.playlist=new jwplayer.html5.playlist(config),_model.item=_model.config.item>=0?_model.config.item:0,!_model.playlist[0].provider&&_model.playlist[0].file?_loadExternal(_model.playlist[0].file):_loadComplete()};var _mediaProviders={};return _model.setActiveMediaProvider=function(playlistItem){"audio"==playlistItem.provider&&(playlistItem.provider="sound");var provider=playlistItem.provider,current=_media?_media.getDisplayElement():null;if("sound"!=provider&&"http"!=provider&&""!=provider||(provider="video"),jwplayer.utils.exists(_mediaProviders[provider]))_media!=_mediaProviders[provider]&&(_media&&_media.stop(),_media=_mediaProviders[provider]);else{switch(provider){case"video":_media=new jwplayer.html5.mediavideo(_model,current||_container);break;case"youtube":_media=new jwplayer.html5.mediayoutube(_model,current||_container)}if(!jwplayer.utils.exists(_media))return!1;_media.addGlobalListener(forward),_mediaProviders[provider]=_media}return!0},_model.getMedia=function(){return _media},_model.seek=function(pos){return _eventDispatcher.sendEvent(jwplayer.api.events.JWPLAYER_MEDIA_SEEK,{position:_model.position,offset:pos}),_media.seek(pos)},_model.setVolume=function(newVol){_utils.saveCookie("volume",newVol),_model.volume=newVol},_model.setMute=function(state){_utils.saveCookie("mute",state),_model.mute=state},_model.setupPlugins=function(){if(!jwplayer.utils.exists(_model.plugins)||!jwplayer.utils.exists(_model.plugins.order)||0==_model.plugins.order.length)return jwplayer.utils.log("No plugins to set up"),_model;for(var i=0;i<_model.plugins.order.length;i++)try{var pluginName=_model.plugins.order[i];jwplayer.utils.exists(jwplayer.html5[pluginName])?_model.plugins.object[pluginName]="playlist"==pluginName?new jwplayer.html5.playlistcomponent(_api,_model.plugins.config[pluginName]):new jwplayer.html5[pluginName](_api,_model.plugins.config[pluginName]):_model.plugins.order.splice(plugin,plugin+1),"function"==typeof _model.plugins.object[pluginName].addGlobalListener&&_model.plugins.object[pluginName].addGlobalListener(forward)}catch(err){jwplayer.utils.log("Could not setup "+pluginName)}},_model}}(jwplayer),function(a){a.html5.playlist=function(b){var d=[];if(b.playlist&&b.playlist instanceof Array&&b.playlist.length>0)for(var c in b.playlist)isNaN(parseInt(c))||d.push(new a.html5.playlistitem(b.playlist[c]));else d.push(new a.html5.playlistitem(b));return d}}(jwplayer),function(a){var c={size:180,position:a.html5.view.positions.NONE,itemheight:60,thumbs:!0,fontcolor:"#000000",overcolor:"",activecolor:"",backgroundcolor:"#f8f8f8",font:"_sans",fontsize:"",fontstyle:"",fontweight:""},b={_sans:"Arial, Helvetica, sans-serif",_serif:"Times, Times New Roman, serif",_typewriter:"Courier New, Courier, monospace"};_utils=a.utils,_css=_utils.css,_hide=function(d){_css(d,{display:"none"})},_show=function(d){_css(d,{display:"block"})},a.html5.playlistcomponent=function(r,C){function p(){var E=document.createElement("ul");return _css(E,{width:y.style.width,minWidth:y.style.width,height:y.style.height,backgroundColor:e.backgroundcolor,backgroundImage:h.background?"url("+h.background.src+")":"",color:e.fontcolor,listStyle:"none",margin:0,padding:0,fontFamily:b[e.font]?b[e.font]:b._sans,fontSize:(e.fontsize?e.fontsize:11)+"px",fontStyle:e.fontstyle,fontWeight:e.fontweight,overflowY:"auto"}),E}function z(E){return function(){var F=f.getElementsByClassName("item")[E],G=e.fontcolor,H=h.item?"url("+h.item.src+")":"";E==x.jwGetPlaylistIndex()&&(""!==e.activecolor&&(G=e.activecolor),h.itemActive&&(H="url("+h.itemActive.src+")")),_css(F,{color:""!==e.overcolor?e.overcolor:G,backgroundImage:h.itemOver?"url("+h.itemOver.src+")":H})}}function o(E){return function(){var F=f.getElementsByClassName("item")[E],G=e.fontcolor,H=h.item?"url("+h.item.src+")":"";E==x.jwGetPlaylistIndex()&&(""!==e.activecolor&&(G=e.activecolor),h.itemActive&&(H="url("+h.itemActive.src+")")),_css(F,{color:G,backgroundImage:H})}}function q(J){var Q=d[J],P=document.createElement("li");P.className="item",_css(P,{height:e.itemheight,display:"block",cursor:"pointer",backgroundImage:h.item?"url("+h.item.src+")":"",backgroundSize:"100% "+e.itemheight+"px"}),P.onmouseover=z(J),P.onmouseout=o(J);var K=document.createElement("div"),G=new Image,L=0,M=0,N=0;w()&&(Q.image||Q["playlist.image"]||h.itemImage)&&(G.className="image",h.itemImage?(L=(e.itemheight-h.itemImage.height)/2,M=h.itemImage.width,N=h.itemImage.height):(M=4*e.itemheight/3,N=e.itemheight),_css(K,{height:N,width:M,float:"left",styleFloat:"left",cssFloat:"left",margin:"0 5px 0 0",background:"black",overflow:"hidden",margin:L+"px",position:"relative"}),_css(G,{position:"relative"}),K.appendChild(G),G.onload=function(){a.utils.stretch(a.utils.stretching.FILL,G,M,N,this.naturalWidth,this.naturalHeight)},Q["playlist.image"]?G.src=Q["playlist.image"]:Q.image?G.src=Q.image:h.itemImage&&(G.src=h.itemImage.src),P.appendChild(K));var F=l-M-2*L;D<e.itemheight*d.length&&(F-=15);var E=document.createElement("div");_css(E,{position:"relative",height:"100%",overflow:"hidden"});var H=document.createElement("span");Q.duration>0&&(H.className="duration",_css(H,{fontSize:(e.fontsize?e.fontsize:11)+"px",fontWeight:e.fontweight?e.fontweight:"bold",width:"40px",height:e.fontsize?e.fontsize+10:20,lineHeight:24,float:"right",styleFloat:"right",cssFloat:"right"}),H.innerHTML=_utils.timeFormat(Q.duration),E.appendChild(H));var O=document.createElement("span");if(O.className="title",_css(O,{padding:"5px 5px 0 "+(L?0:"5px"),height:e.fontsize?e.fontsize+10:20,lineHeight:e.fontsize?e.fontsize+10:20,overflow:"hidden",float:"left",styleFloat:"left",cssFloat:"left",width:(Q.duration>0?F-50:F)-10+"px",fontSize:(e.fontsize?e.fontsize:13)+"px",fontWeight:e.fontweight?e.fontweight:"bold"}),O.innerHTML=Q?Q.title:"",E.appendChild(O),Q.description){var I=document.createElement("span");I.className="description",_css(I,{display:"block",float:"left",styleFloat:"left",cssFloat:"left",margin:0,paddingLeft:O.style.paddingLeft,paddingRight:O.style.paddingRight,lineHeight:(e.fontsize?e.fontsize+4:16)+"px",overflow:"hidden",position:"relative"}),I.innerHTML=Q.description,E.appendChild(I)}return P.appendChild(E),P}function s(F){if(y.innerHTML="",d=t()){items=[],f=p();for(var G=0;G<d.length;G++){var E=q(G);E.onclick=A(G),f.appendChild(E),items.push(E)}if(k=x.jwGetPlaylistIndex(),o(k)(),y.appendChild(f),_utils.isIOS()&&window.iScroll){f.style.height=e.itemheight*d.length+"px";new iScroll(y.id)}}}function t(){for(var F=x.jwGetPlaylist(),G=[],E=0;E<F.length;E++)F[E]["ova.hidden"]||G.push(F[E]);return G}function A(E){return function(){x.jwPlaylistItem(E),x.jwPlay(!0)}}function n(){f.scrollTop=x.jwGetPlaylistIndex()*e.itemheight}function w(){return"true"==e.thumbs.toString().toLowerCase()}function v(E){k>=0&&(o(k)(),k=E.index),o(E.index)(),n()}function m(){if(e.position==a.html5.view.positions.OVER)switch(x.jwGetState()){case a.api.events.state.IDLE:_show(y);break;default:_hide(y)}}function B(){for(var E in h)h[E]=u(E)}function u(E){return x.skin.getSkinElement("playlist",E)}var x=r,e=a.utils.extend({},c,x.skin.getComponentSettings("playlist"),C);if(e.position!=a.html5.view.positions.NONE&&void 0!==a.html5.view.positions[e.position]){var y,l,D,d,f,k=-1,h={background:void 0,item:void 0,itemOver:void 0,itemImage:void 0,itemActive:void 0};return this.getDisplayElement=function(){return y},this.resize=function(G,E){if(l=G,D=E,x.jwGetFullscreen())_hide(y);else{var F={display:"block",width:l,height:D};_css(y,F)}},this.show=function(){_show(y)},this.hide=function(){_hide(y)},function(){switch(y=document.createElement("div"),y.id=x.id+"_jwplayer_playlistcomponent",y.style.overflow="hidden",e.position){case a.html5.view.positions.RIGHT:case a.html5.view.positions.LEFT:y.style.width=e.size+"px";break;case a.html5.view.positions.TOP:case a.html5.view.positions.BOTTOM:y.style.height=e.size+"px"}B(),h.item&&(e.itemheight=h.item.height),y.style.backgroundColor="#C6C6C6",x.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,s),x.jwAddEventListener(a.api.events.JWPLAYER_PLAYLIST_ITEM,v),x.jwAddEventListener(a.api.events.JWPLAYER_PLAYER_STATE,m)}(),this}}}(jwplayer),function(b){function a(e){if(b.utils.isYouTube(e.file))return"youtube";var c,f=b.utils.extension(e.file);if(f&&b.utils.extensionmap[f]){if("m3u8"==f)return"video";c=b.utils.extensionmap[f].html5}else e.type&&(c=e.type);if(c){var d=c.split("/")[0];if("audio"==d)return"sound";if("video"==d)return d}return""}b.html5.playlistitem=function(d){var e={author:"",date:"",description:"",image:"",link:"",mediaid:"",tags:"",title:"",provider:"",file:"",streamer:"",duration:-1,start:0,currentLevel:-1,levels:[]},c=b.utils.extend({},e,d);return c.type&&(c.provider=c.type,delete c.type),0===c.levels.length&&(c.levels[0]=new b.html5.playlistitemlevel(c)),c.provider?c.provider=c.provider.toLowerCase():c.provider=a(c.levels[0]),c}}(jwplayer),function(a){a.html5.playlistitemlevel=function(b){var d={file:"",streamer:"",bitrate:0,width:0};for(var c in d)a.utils.exists(b[c])&&(d[c]=b[c]);return d}}(jwplayer),function(a){a.html5.playlistloader=function(){function d(g){f=[];try{var f=a.utils.parsers.rssparser.parse(g.responseXML.firstChild);c.sendEvent(a.api.events.JWPLAYER_PLAYLIST_LOADED,{playlist:new a.html5.playlist({playlist:f})})}catch(h){b("Could not parse the playlist")}}function b(e){c.sendEvent(a.api.events.JWPLAYER_ERROR,{message:e||"Could not load playlist an unknown reason."})}var c=new a.html5.eventdispatcher;a.utils.extend(this,c),this.load=function(e){a.utils.ajax(e,d,b)}}}(jwplayer),function(a){a.html5.skin=function(){var b={},c=!1;this.load=function(d,e){new a.html5.skinloader(d,function(f){c=!0,b=f,e()},function(){new a.html5.skinloader("",function(f){c=!0,b=f,e()})})},this.getSkinElement=function(d,e){if(c)try{return b[d].elements[e]}catch(f){a.utils.log("No such skin component / element: ",[d,e])}return null},this.getComponentSettings=function(d){return c&&b&&b[d]?b[d].settings:null},this.getComponentLayout=function(d){return c?b[d].layout:null}}}(jwplayer),function(a){a.html5.skinloader=function(f,p,k){function d(y){var E=y.getElementsByTagName("component");if(0!==E.length)for(var H=0;H<E.length;H++){var C=E[H].getAttribute("name"),B={settings:{},elements:{},layout:{}};o[C]=B;for(var G=E[H].getElementsByTagName("elements")[0].getElementsByTagName("element"),F=0;F<G.length;F++)b(G[F],C);var z=E[H].getElementsByTagName("settings")[0];if(z&&z.childNodes.length>0)for(var K=z.getElementsByTagName("setting"),P=0;P<K.length;P++){var Q=K[P].getAttribute("name"),I=K[P].getAttribute("value"),x=/color$/.test(Q)?"color":null;o[C].settings[Q]=a.utils.typechecker(I,x)}var L=E[H].getElementsByTagName("layout")[0];if(L&&L.childNodes.length>0)for(var M=L.getElementsByTagName("group"),w=0;w<M.length;w++){var A=M[w];o[C].layout[A.getAttribute("position")]={elements:[]};for(var O=0;O<A.attributes.length;O++){var D=A.attributes[O];o[C].layout[A.getAttribute("position")][D.name]=D.value}for(var N=A.getElementsByTagName("*"),v=0;v<N.length;v++){var t=N[v];o[C].layout[A.getAttribute("position")].elements.push({type:t.tagName});for(var u=0;u<t.attributes.length;u++){var J=t.attributes[u];o[C].layout[A.getAttribute("position")].elements[v][J.name]=J.value}a.utils.exists(o[C].layout[A.getAttribute("position")].elements[v].name)||(o[C].layout[A.getAttribute("position")].elements[v].name=t.tagName)}}e=!1,r()}}function r(){clearInterval(j),s||(j=setInterval(function(){q()},100))}function b(y,x){var A,w=new Image,t=y.getAttribute("name"),v=y.getAttribute("src");if(0===v.indexOf("data:image/png;base64,"))A=v;else{var u=a.utils.getAbsolutePath(n);A=[u.substr(0,u.lastIndexOf("/")),x,v].join("/")}o[x].elements[t]={height:0,width:0,src:"",ready:!1,image:w},w.onload=function(B){g(w,t,x)},w.onerror=function(B){s=!0,r(),l()},w.src=A}function h(){for(var u in o){var w=o[u];for(var t in w.elements){var x=w.elements[t],v=x.image;v.onload=null,v.onerror=null,delete x.image,delete w.elements[t]}delete o[u]}}function q(){for(var t in o)if("properties"!=t)for(var u in o[t].elements)if(!o[t].elements[u].ready)return;!1===e&&(clearInterval(j),c(o))}function g(t,v,u){o[u]&&o[u].elements[v]?(o[u].elements[v].height=t.height,o[u].elements[v].width=t.width,o[u].elements[v].src=t.src,o[u].elements[v].ready=!0,r()):a.utils.log("Loaded an image for a missing element: "+u+"."+v)}var j,o={},c=p,l=k,e=!0,n=f,s=!1;"string"!=typeof n||""===n?d(a.html5.defaultSkin().xml):a.utils.ajax(a.utils.getAbsolutePath(n),function(t){try{if(a.utils.exists(t.responseXML))return void d(t.responseXML)}catch(u){h()}d(a.html5.defaultSkin().xml)},function(t){d(a.html5.defaultSkin().xml)})}}(jwplayer),function(a){a.html5.api=function(c,p){function f(){m.state==a.api.events.state.PLAYING||m.state==a.api.events.state.BUFFERING?l.pause():l.play()}function j(q){return function(){return m[q]}}function e(q,s,r){return function(){var t=m.plugins.object[q];t&&t[s]&&"function"==typeof t[s]&&t[s].apply(t,r)}}function o(q){return function(){if(d&&"function"==typeof d[q])return d[q].apply(this,arguments);_utils.log("Could not call instream method - instream API not initialized")}}function b(){m.config.playlistfile?(m.addEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,h),m.loadPlaylist(m.config.playlistfile)):"string"==typeof m.config.playlist?(m.addEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,h),m.loadPlaylist(m.config.playlist)):(m.loadPlaylist(m.config),setTimeout(h,25))}function h(q){m.removeEventListener(a.api.events.JWPLAYER_PLAYLIST_LOADED,h),m.setupPlugins(),k.setup();var q={id:n.id,version:n.version};l.playerReady(q)}var n={},g=document.createElement("div");c.parentNode.replaceChild(g,c),g.id=c.id,n.version=a.version,n.id=g.id;var m=new a.html5.model(n,g,p),k=new a.html5.view(n,g,m),l=new a.html5.controller(n,g,m,k);n.skin=new a.html5.skin,n.jwPlay=function(q){void 0===q?f():"true"==q.toString().toLowerCase()?l.play():l.pause()},n.jwPause=function(q){void 0===q?f():"true"==q.toString().toLowerCase()?l.pause():l.play()},n.jwStop=l.stop,n.jwSeek=l.seek,n.jwPlaylistItem=function(q){return d?d.playlistClickable()?(d.jwInstreamDestroy(),l.item(q)):void 0:l.item(q)},n.jwPlaylistNext=l.next,n.jwPlaylistPrev=l.prev,n.jwResize=l.resize,n.jwLoad=l.load,n.jwDetachMedia=l.detachMedia,n.jwAttachMedia=l.attachMedia,n.jwGetPlaylistIndex=j("item"),n.jwGetPosition=j("position"),n.jwGetDuration=j("duration"),n.jwGetBuffer=j("buffer"),n.jwGetWidth=j("width"),n.jwGetHeight=j("height"),n.jwGetFullscreen=j("fullscreen"),n.jwSetFullscreen=l.setFullscreen,n.jwGetVolume=j("volume"),n.jwSetVolume=l.setVolume,n.jwGetMute=j("mute"),n.jwSetMute=l.setMute,n.jwGetStretching=function(){return m.stretching.toUpperCase()},n.jwGetState=j("state"),n.jwGetVersion=function(){return n.version},n.jwGetPlaylist=function(){return m.playlist},n.jwAddEventListener=l.addEventListener,n.jwRemoveEventListener=l.removeEventListener,n.jwSendEvent=l.sendEvent,n.jwDockSetButton=function(t,q,r,s){m.plugins.object.dock&&m.plugins.object.dock.setButton&&m.plugins.object.dock.setButton(t,q,r,s)},n.jwControlbarShow=e("controlbar","show"),n.jwControlbarHide=e("controlbar","hide"),n.jwDockShow=e("dock","show"),n.jwDockHide=e("dock","hide"),n.jwDisplayShow=e("display","show"),n.jwDisplayHide=e("display","hide");var d;return n.jwLoadInstream=function(r,q){d||(d=new a.html5.instream(n,m,k,l)),setTimeout(function(){d.load(r,q)},10)},n.jwInstreamDestroy=function(){d&&d.jwInstreamDestroy()},n.jwInstreamAddEventListener=o("jwInstreamAddEventListener"),n.jwInstreamRemoveEventListener=o("jwInstreamRemoveEventListener"),n.jwInstreamGetState=o("jwInstreamGetState"),n.jwInstreamGetDuration=o("jwInstreamGetDuration"),n.jwInstreamGetPosition=o("jwInstreamGetPosition"),n.jwInstreamPlay=o("jwInstreamPlay"),n.jwInstreamPause=o("jwInstreamPause"),n.jwInstreamSeek=o("jwInstreamSeek"),n.jwDestroy=function(){l.destroy()},n.jwGetLevel=function(){},n.jwGetBandwidth=function(){},n.jwGetLockState=function(){},n.jwLock=function(){},n.jwUnlock=function(){},m.config.chromeless&&!a.utils.isIOS()?b():n.skin.load(m.config.skin,b),n}}(jwplayer)}var VideoManager={};VideoManager.parseData=function(link){if(null==link)return null;var getAttrib=function(name){return YUD.getAttribute(link,"data-"+name)||YUD.getAttribute(link,name)},autoplay=getAttrib("autoplay");autoplay=!!autoplay&&"true"==autoplay.toLowerCase();var dialog=getAttrib("dialog");dialog=!!dialog&&"true"==dialog.toLowerCase();var controls=getAttrib("controls");return controls=!controls||"true"==controls.toLowerCase(),{autoplay:autoplay,dialog:dialog,controls:controls,url:YUD.getAttribute(link,"href"),type:YUD.getAttribute(link,"type"),width:1*getAttrib("width"),height:1*getAttrib("height")}},VideoManager.canPlay=function(url){if("function"!=typeof jwplayer)return!1;if(!jwplayer.utils.exists(url))return!1;var extension=jwplayer.utils.extension(url);if(!jwplayer.utils.exists(extension))return!1;if("m4a"==extension)return!1;var extPlayers=jwplayer.utils.extensionmap[extension];return!!jwplayer.utils.exists(extPlayers)&&(Util.String.startsWith(extPlayers.html5,"video")||Util.String.startsWith(extPlayers.flash,"video"))},VideoManager.embed=function(pageWin,linkVideo,zoomFactor){if("function"!=typeof pageWin.jwplayer)return!1;var id=YUD.generateId().replace("yui","video");linkVideo.setAttribute("id",id);var flashPath=ContentManager.resolveBaseUrl("Scripts/Libraries/jwplayer/player.swf"),skinPath=ContentManager.resolveBaseUrl("Scripts/Libraries/jwplayer/skins/simple/simple.zip"),videoData=VideoManager.parseData(linkVideo),config={provider:"video",autostart:videoData.autoplay,fullscreen:!1,skin:skinPath};videoData.controls||(config["controlbar.position"]="none"),videoData.width>0&&videoData.height>0?(config.width=videoData.width,config.height=videoData.height):(config.width=400,config.height=226);var createAnArray=function(){return"function"==typeof pageWin.createAnArray?pageWin.createAnArray():[]};config.levels=createAnArray(),config.levels.push({file:videoData.url,type:videoData.type}),config.modes=createAnArray(),config.modes.push({type:"html5"}),config.modes.push({type:"flash",src:flashPath}),config.logo={file:"",link:""},config.abouttext="",config.aboutlink="";var player=pageWin.jwplayer(linkVideo).setup(config);if(zoomFactor){var zoomWidth=config.width*zoomFactor,zoomHeight=config.height*zoomFactor;player.resize(zoomWidth,zoomHeight)}return player},VideoManager.stop=function(page){VideoManager.SWF.forEach(page,function(swfAPI){swfAPI.stop()});var pageWin=page.getWin();if(YAHOO.lang.isFunction(pageWin.jwplayer))for(var players=pageWin.jwplayer.getPlayers(),i=0;i<players.length;i++){var player=players[i];"PLAYING"==player.getState()&&player.pause()}},VideoManager.openDialog=function(ev,pageLink,zoomFactor){TDS.ToolManager.hideAll();var id="video-"+Util.String.hashCode(pageLink.href),videoDialog=TDS.ToolManager.get(id);if(null==videoDialog){var header=pageLink.title||"";(videoDialog=TDS.ToolManager.createPanel(id,"video",header)).body.innerHTML="";var aslLink=pageLink.cloneNode(!0);videoDialog.body.appendChild(aslLink);var videoPlayer=VideoManager.embed(window,aslLink,zoomFactor);videoDialog.showEvent.subscribe(function(){(Util.Browser.isIOS()||Util.Browser.isAndroid())&&"IDLE"!=videoPlayer.getState()||videoPlayer.play()}),videoDialog.hideEvent.subscribe(function(){videoPlayer.stop()}),videoDialog.refresh=function(){var width=videoPlayer.getWidth(),height=videoPlayer.getHeight();width>0&&height>0&&(height+=videoDialog.header.offsetHeight,height+=1*YUD.getStyle(videoDialog.body,"padding-top").replace("px",""),height+=1*YUD.getStyle(videoDialog.body,"padding-bottom").replace("px",""),width+=1*YUD.getStyle(videoDialog.body,"padding-left").replace("px",""),width+=1*YUD.getStyle(videoDialog.body,"padding-right").replace("px",""),videoDialog.cfg.setProperty("width",width+"px"),videoDialog.cfg.setProperty("height",height+"px"))},videoPlayer.onReady(function(){videoDialog.refresh(),TDS.ToolManager.bottomLeft(videoDialog)})}videoDialog.show()},VideoManager.patchJWPlayer=function(player){!0!==player.__tds_fixedOuterHTML&&(player.utils.setOuterHTML=Util.Dom.setOuterHTML,player.__tds_fixedOuterHTML=!0),!0!==player.__tds_fixedExt&&(player.utils.extension=function(path){if(!path)return"";var pathPieces=(path=path.substring(path.lastIndexOf("/")+1,path.length)).split("?");if(path=pathPieces[0],pathPieces.length>1){var querystring=Util.QueryString.parse(pathPieces[1]);null!=querystring.file&&(path=querystring.file)}return path.lastIndexOf(".")>-1?path.substr(path.lastIndexOf(".")+1,path.length).toLowerCase():null},player.__tds_fixedExt=!0)},"function"==typeof window.jwplayer&&VideoManager.patchJWPlayer(window.jwplayer),VideoManager.SWF=function(embed,data){this._embed=embed,this._data=data,this._ready=!1},VideoManager.SWF.parseData=function(link){if(null==link)return null;var getAttrib=function(name){return YUD.getAttribute(link,"data-"+name)||YUD.getAttribute(link,name)},width=1*getAttrib("width"),height=1*getAttrib("height"),autoplay=getAttrib("autoplay");autoplay=!!autoplay&&"true"==autoplay.toLowerCase();var html5=getAttrib("anim-html5");html5=!!html5&&"true"==html5.toLowerCase();var flash=getAttrib("anim-flash");flash=flash?"true"==flash.toLowerCase():YUD.hasClass(link,"flashvideo");var shell=getAttrib("anim-shell");return shell=shell?"true"==shell.toLowerCase():!html5&&!!flash,{url:YUD.getAttribute(link,"href"),type:YUD.getAttribute(link,"type"),width:width,height:height,autoplay:autoplay,shell:shell,html5:html5,flash:flash}},VideoManager.SWF.prototype.getElement=function(){return this._embed},VideoManager.SWF.prototype.autoplay=function(){return this._data.autoplay},VideoManager.SWF.prototype.isReady=function(){return this._ready},VideoManager.SWF.prototype.getStatus=function(){if(!YAHOO.lang.isFunction(this._embed.getStatus))return"uninitialized";var status=this._embed.getStatus();return"notstarted"==status&&(status="initialized"),status},VideoManager.SWF.prototype.isLoaded=function(){return!!this.isReady()||"uninitialized"!=this.getStatus()},VideoManager.SWF.prototype.setReady=function(){this._ready=!0},VideoManager.SWF.prototype.isPlaying=function(){return"playing"==this.getStatus()},VideoManager.SWF.prototype.play=function(){return!!this.isReady()&&(!this.isPlaying()&&(!!YAHOO.lang.isFunction(this._embed.JSPlay)&&(this._embed.JSPlay(),!0)))},VideoManager.SWF.prototype.stop=function(){return!!this.isReady()&&(!!this.isPlaying()&&(!!YAHOO.lang.isFunction(this._embed.JSStop)&&(this._embed.JSStop(),!0)))},VideoManager.SWF.collection=new Util.Structs.Map,VideoManager.SWF.Status={LOADING:"loading",LOADED:"loaded",PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped"},VideoManager.SWF.Events=new Util.EventManager,VideoManager.SWF._animationStatusChange=function(){var data=[];1==arguments.length?(data.push(null),data.push(arguments[0])):2==arguments.length&&(data.push(arguments[0]),data.push(arguments[1])),0!=data.length&&("notstarted"==data[1]&&(data[1]="initialized"),YAHOO.lang.later(0,VideoManager.SWF,VideoManager.SWF.processStatusChange,data))},VideoManager.SWF.processStatusChange=function(id,status){if("initialized"==status)for(var apis=VideoManager.SWF.collection.getValues(),i=0;i<apis.length;i++){var swfAPI=apis[i];!swfAPI.isReady()&&swfAPI.isLoaded()&&(swfAPI.setReady(),VideoManager.SWF.Events.fire(VideoManager.SWF.Status.LOADED,swfAPI))}"playing"==status&&VideoManager.SWF.Events.fire(VideoManager.SWF.Status.PLAYING,null),"stopped"==status&&VideoManager.SWF.Events.fire(VideoManager.SWF.Status.STOPPED,null)},VideoManager.SWF.embed=function(win,linkVideo,overrideAutoplay,disableShell){YAHOO.lang.isFunction(win.animationStatusChange)||(win.animationStatusChange=VideoManager.SWF._animationStatusChange,win.checkAutoPlay=function(){return!1});var id="Animation-"+YAHOO.util.Dom.generateId(),animData=VideoManager.SWF.parseData(linkVideo);YAHOO.lang.isBoolean(overrideAutoplay)&&(animData.autoplay=overrideAutoplay);var divVideo=Util.Dom.getOwnerDocument(linkVideo).createElement("div");YUD.addClass(divVideo,"AnimationContainer"),YUD.setStyle(divVideo,"width",animData.width+"px"),YUD.setStyle(divVideo,"height",animData.height+"px"),divVideo.innerHTML=this.createHtml(id,animData,disableShell),YUD.insertAfter(divVideo,linkVideo);var parentNode=linkVideo.parentNode;parentNode&&parentNode.removeChild(linkVideo);var children=YUD.getChildren(divVideo),embed=children&&children.length>0?children[0]:null;VideoManager.SWF.stopRightClick(embed);var swfAPI=new VideoManager.SWF(embed,animData);return VideoManager.SWF.collection.set(id,swfAPI),VideoManager.SWF.Events.fire(VideoManager.SWF.Status.LOADING,swfAPI),swfAPI},VideoManager.SWF.createHtml=function(id,animData,disableShell){var wmode;wmode=Util.Browser.isMac()&&2==Util.Browser.getFirefoxVersion()?"window":"opaque";var embedBuilder=[];if(embedBuilder.push("<embed"),embedBuilder.push('id="'+id+'"'),embedBuilder.push('type="application/x-shockwave-flash"'),disableShell||!animData.shell)embedBuilder.push('src="'+animData.url+'"');else{var shellPath=ContentManager.resolveBaseUrl("Scripts/Video/AnimationShell.swf"),vars="animID="+id+"&animURL="+encodeURIComponent(animData.url);embedBuilder.push('src="'+shellPath+'"'),embedBuilder.push('flashvars="'+vars+'"')}return embedBuilder.push('width="100%"'),embedBuilder.push('height="100%"'),embedBuilder.push('play="'+animData.autoplay+'"'),embedBuilder.push('loop="false"'),embedBuilder.push('menu="false"'),embedBuilder.push('allowscriptaccess="always"'),embedBuilder.push('allowfullscreen="false"'),embedBuilder.push('quality="autohigh"'),embedBuilder.push('wmode="'+wmode+'"'),embedBuilder.push("></embed>"),embedBuilder.join(" ")},VideoManager.SWF.forEach=function(page,fn){for(var pageEmbeds=page.getElement().getElementsByTagName("embed"),i=0;i<pageEmbeds.length;i++){var embed=pageEmbeds[i],swfAPI=VideoManager.SWF.collection.get(embed.id);if(null!=swfAPI)try{fn(swfAPI)}catch(ex){Util.log("SWF ERROR: "+ex)}}},VideoManager.SWF.stopPlaying=function(){var page=ContentManager.getCurrentPage();null!=page&&VideoManager.SWF.forEach(page,function(api){api.isPlaying()&&api.stop()})},VideoManager.SWF.stopRightClick=function(embed){var flashDoc=Util.Dom.getOwnerDocument(embed),flashWin=flashDoc.parentWindow||flashDoc.defaultView;flashWin.addEventListener?flashWin.addEventListener("mousedown",VideoManager.SWF._onGeckoMouse,!0):embed.onmouseup=function(){embed.releaseCapture()}},VideoManager.SWF._onGeckoMouse=function(evt){var target=YUE.getTarget(evt);target&&"application/x-shockwave-flash"==target.type&&0!=evt.button&&VideoManager.SWF._killEvents(evt)},VideoManager.SWF._killEvents=function(evt){evt&&(evt.stopPropagation&&evt.stopPropagation(),evt.preventDefault&&evt.preventDefault(),evt.preventCapture&&evt.preventCapture(),evt.preventBubble&&evt.preventBubble())},ContentManager.onPageEvent("available",function(page){var pageWin=page.getWin();"function"==typeof pageWin.jwplayer&&VideoManager.patchJWPlayer(pageWin.jwplayer)}),ContentManager.onPageEvent("available",function(page){var pageEl=page.getElement(),pageWin=page.getWin(),pageLinks=pageEl.getElementsByTagName("a");YUD.batch(pageLinks,function(pageLink){if(VideoManager.SWF.parseData(pageLink).flash){var videoLoader=new ResourceLoader.Binary(pageLink.href,18e4,2);videoLoader.subscribe(ResourceLoader.Status.COMPLETE,function(){VideoManager.SWF.embed(pageWin,pageLink)}),page.addResourceLoader(videoLoader)}else VideoManager.canPlay(pageLink.href)&&(VideoManager.parseData(pageLink).dialog?YUE.on(pageLink,"click",VideoManager.openDialog,pageLink):VideoManager.embed(pageWin,pageLink,page.getZoomFactor()))})}),ContentManager.onPageEvent("show",function(page){VideoManager.SWF.forEach(page,function(swfAPI){swfAPI.autoplay()&&swfAPI.play()})}),ContentManager.onPageEvent("hide",function(page){VideoManager.stop(page)}),ContentManager.onPageEvent("zoom",function(page){if(page.getWin().jwplayer)for(var players=page.getWin().jwplayer.getPlayers(),i=0;i<players.length;i++){var player=players[i];player.config.width||(player.config.width=player.getWidth()),player.config.height||(player.config.height=player.getHeight());var zoomFactor=page.getZoomFactor();if(player.config.width>0&&player.config.height>0){var zoomWidth=player.config.width*zoomFactor,zoomHeight=player.config.height*zoomFactor;player.resize(zoomWidth,zoomHeight)}}}),VideoManager.SWF.Events.subscribe("loaded",function(swfAPI){var currentPage=ContentManager.getCurrentPage();null!=currentPage&&VideoManager.SWF.forEach(currentPage,function(pageSwfAPI){swfAPI==pageSwfAPI&&swfAPI.autoplay()&&swfAPI.play()})}),ContentManager.Dialog.onLoad.subscribe(function(frame){var frameWin=frame.getWindow(),frameDoc=frame.getDocument();if(Util.String.contains(frame.id,"help"))for(var flashLinks=YUD.getElementsByClassName("flashvideo","a",frameDoc),i=0;i<flashLinks.length;i++)flashLinks[i].parentNode&&VideoManager.SWF.embed(frameWin,flashLinks[i],!0,!0)}),ContentManager.Dialog.onShow.subscribe(function(dialogFrame){var dialogDoc=Util.Dom.getFrameContentDocument(dialogFrame);YUD.batch(dialogDoc.getElementsByTagName("embed"),function(embed){"function"==typeof embed.Play&&embed.Play()})}),ContentManager.Dialog.onHide.subscribe(function(dialogFrame){var dialogDoc=Util.Dom.getFrameContentDocument(dialogFrame);YUD.batch(dialogDoc.getElementsByTagName("embed"),function(embed){"function"==typeof embed.Rewind&&embed.Rewind()})}),VideoManager.SWF.Events.subscribe("playing",function(){TTS.getInstance().stop()});var SpellCheck=function(handler,node){this._handler=handler,this._rootNode=node,this._doc=Util.Dom.getOwnerDocument(node),this._elementsInserted=0,this._wordElements={},this._splitRegex=new RegExp("([^"+SpellCheck.WORD_BOUNDARY_CHARS+"]*)(["+SpellCheck.WORD_BOUNDARY_CHARS+"]*)","g"),this.wordClassName="spellcheck-word",this.invalidWordCssText="background: yellow;",this.onCheckStart=new YAHOO.util.CustomEvent("onCheckStart",this,!1,YAHOO.util.CustomEvent.FLAT),this.onCheckCompleted=new YAHOO.util.CustomEvent("onCheckCompleted",this,!1,YAHOO.util.CustomEvent.FLAT),this.onDone=new YAHOO.util.CustomEvent("onDone",this,!1,YAHOO.util.CustomEvent.FLAT),this.onWordChange=new YAHOO.util.CustomEvent("onWordChange",this,!1,YAHOO.util.CustomEvent.FLAT)};SpellCheck.WordStatus={UNKNOWN:0,VALID:1,INVALID:2,IGNORED:3,CORRECTED:4},SpellCheck.WORD_BOUNDARY_CHARS='\t\r\n !"#$%&()*+,-./:;<=>?@[\\]^_`{|}~',SpellCheck._KEY_PREFIX=":",SpellCheck.prototype.getWordElements=function(){var wordElements=[];for(var wordKey in this._wordElements)Util.Array.each(this._wordElements[wordKey],function(wordElement){wordElements.push(wordElement)});return wordElements},SpellCheck.prototype.check=function(){this.onCheckStart.fire();var words=this._getWords(this._rootNode),sc=this;this._handler.onDictionaryReady.subscribe(sc._onDictionaryReady,sc,!0),this._handler.lookupWords(words)},SpellCheck.prototype._onDictionaryReady=function(){this._handler.onDictionaryReady.unsubscribe(this._onDictionaryReady),this._wordElements={},this._elementsInserted=0,this._processHtml(this._rootNode)},SpellCheck.prototype.done=function(){this._wordElements={},this._elementsInserted=0,this._restoreHtml(this._rootNode)},SpellCheck.prototype._getWords=function(node){for(var words=[];node;){var next=this._nextNode(node);if(node.nodeType==Util.Dom.NodeType.TEXT){if(node.nodeValue)for(var parsedWords=this._parseWords(node.nodeValue),i=0;i<parsedWords.length;i++)words.push(parsedWords[i])}else node.nodeType==Util.Dom.NodeType.ELEMENT&&node.firstChild&&(next=node.firstChild);node=next}return words},SpellCheck.prototype._parseWords=function(text){var words=[];this._splitRegex.lastIndex=0;for(var result;(result=this._splitRegex.exec(text))&&0!=result[0].length;){var word=result[1];word&&words.push(word)}return words},SpellCheck.prototype._processHtml=function(node){for(;node;){var next=this._nextNode(node);if(node.nodeType==Util.Dom.NodeType.TEXT){var deleteNode=!0;if(node.nodeValue){var currentElements=this._elementsInserted;this._processText(node,node.nodeValue),currentElements==this._elementsInserted&&(deleteNode=!1)}deleteNode&&Util.Dom.removeNode(node)}else if(node.nodeType==Util.Dom.NodeType.ELEMENT)if(node.className==this.wordClassName){for(var runner=node.firstChild;runner;){if(this._isTextLeaf(runner))for(;this._isTextLeaf(runner.nextSibling);)runner.nodeValue+=runner.nextSibling.nodeValue,Util.Dom.removeNode(runner.nextSibling);runner=runner.nextSibling}if(node.firstChild)for(next=node.firstChild;node.firstChild;)node.parentNode.insertBefore(node.firstChild,node);Util.Dom.removeNode(node)}else node.firstChild&&(next=node.firstChild);node=next}},SpellCheck.prototype._processText=function(node,text){this._splitRegex.lastIndex=0;for(var result,stringSegmentStart=0;(result=this._splitRegex.exec(text))&&0!=result[0].length;){var word=result[1];if(word){var status=this._handler.checkWord(word);if(status!=SpellCheck.WordStatus.VALID){var preceedingText=text.substr(stringSegmentStart,result.index-stringSegmentStart);preceedingText&&this._processRange(node,preceedingText),stringSegmentStart=result.index+word.length,this._processWord(node,word,status)}}}var leftoverText=text.substr(stringSegmentStart);return leftoverText&&this._processRange(node,leftoverText),!0},SpellCheck.prototype._processRange=function(node,text){node.nodeType==Util.Dom.NodeType.TEXT&&node.nodeValue.length==text.length||(node.parentNode.insertBefore(this._doc.createTextNode(text),node),this._elementsInserted++)},SpellCheck.prototype._processWord=function(node,word,status){var el=this._doc.createElement("a");el.setAttribute("id",this.wordClassName+"-"+YUD.generateId()),el.setAttribute("href","#"),YUD.addClass(el,this.wordClassName),el.appendChild(this._doc.createTextNode(word)),this._registerWordElement(word,el),node.parentNode.insertBefore(el,node),this._elementsInserted++},SpellCheck.prototype._restoreHtml=function(node){for(;node;)if(node.nodeType!=Util.Dom.NodeType.ELEMENT||node.className!=this.wordClassName){if(this._isTextLeaf(node)){for(var textNodes=1,next=node.nextSibling;this._isTextLeaf(node.previousSibling);)node=node.previousSibling,++textNodes;for(;this._isTextLeaf(next);)next=next.nextSibling,++textNodes;if(textNodes>1){var workBuffer=[];for(workBuffer.push(node.nodeValue);this._isTextLeaf(node.nextSibling);)workBuffer.push(node.nextSibling.nodeValue),Util.Dom.removeNode(node.nextSibling);node.nodeValue=workBuffer.join("")}}node.firstChild&&this._restoreHtml(node.firstChild),node=node.nextSibling}else{for(var firstElement=node.firstChild,child=firstElement;child;child=next)next=child.nextSibling,node.parentNode.insertBefore(child,node);next=firstElement||node.nextSibling,Util.Dom.removeNode(node),node=next}},SpellCheck.prototype.replaceWord=function(el,old,word){if(old!=word){Util.Dom.setTextContent(el,word);var status=SpellCheck.WordStatus.VALID,oldIndex=SpellCheck._toInternalKey(old),newIndex=SpellCheck._toInternalKey(word),elements=this._wordElements[oldIndex];Util.Array.remove(elements,el),status!=SpellCheck.WordStatus.VALID&&(this._wordElements[newIndex]?this._wordElements[newIndex].push(el):this._wordElements[newIndex]=[el]),this.updateElement(el,word,status),this.onWordChange.fire({element:el,word:word,status:status})}},SpellCheck.prototype.updateElement=function(el,word,status){status==SpellCheck.WordStatus.VALID?this.removeMarkup(el):Util.Dom.setProperties(el,this.getElementProperties(status))},SpellCheck.prototype.removeMarkup=function(el){var firstChild=el.firstChild,text=firstChild.nodeValue;el.nextSibling&&el.nextSibling.nodeType==Util.Dom.NodeType.TEXT?el.previousSibling&&el.previousSibling.nodeType==Util.Dom.NodeType.TEXT?(el.previousSibling.nodeValue=el.previousSibling.nodeValue+text+el.nextSibling.nodeValue,Util.Dom.removeNode(el.nextSibling)):el.nextSibling.nodeValue=text+el.nextSibling.nodeValue:el.previousSibling&&el.previousSibling.nodeType==Util.Dom.NodeType.TEXT?el.previousSibling.nodeValue+=text:el.parentNode.insertBefore(firstChild,el),Util.Dom.removeNode(el)},SpellCheck.prototype._registerWordElement=function(word,el){var index=SpellCheck._toInternalKey(word);this._wordElements[index]?this._wordElements[index].push(el):this._wordElements[index]=[el]},SpellCheck._toInternalKey=function(word){return word in Object.prototype?SpellCheck._KEY_PREFIX+word:word},SpellCheck.prototype._nextNode=function(node){for(;node!=this._rootNode;){if(node.nextSibling)return node.nextSibling;node=node.parentNode}return null},SpellCheck.prototype._isTextLeaf=function(node){return null!=node&&node.nodeType==Util.Dom.NodeType.TEXT&&!node.firstChild},SpellCheck.prototype.getElementProperties=function(status){return{class:this.wordClassName,style:status==SpellCheck.WordStatus.INVALID?this.invalidWordCssText:""}};var SpellCheckManager={_language:"ENU",_lookupInProgress:!1,_unknownWords:[],_cache:{},onDictionaryReady:new YAHOO.util.CustomEvent("onDictionaryReady",SpellCheckManager,!1,YAHOO.util.CustomEvent.FLAT),_mozDictionary:null,_cacheHolder:[],_dictionaryHolder:[]};SpellCheckManager.getLanguage=function(){return this._language},SpellCheckManager.setLanguage=function(lang){this._language=lang,null==this._cacheHolder[lang.toLowerCase()]&&(this._cacheHolder[lang.toLowerCase()]={}),null==this._dictionaryHolder[lang.toLowerCase()]&&(this._dictionaryHolder[lang.toLowerCase()]=new MozSpellChecker(lang.toLowerCase())),this._mozDictionary=this._dictionaryHolder[lang.toLowerCase()],this._cache=this._cacheHolder[lang.toLowerCase()]},SpellCheckManager._getCachedWord=function(word){return YAHOO.lang.hasOwnProperty(this._cache,word)?this._cache[word]:null},SpellCheckManager.getSuggestions=function(word){var cacheEntry=this._getCachedWord(word);return cacheEntry?cacheEntry.suggestions:null},SpellCheckManager.checkWord=function(word){var cacheEntry=this._getCachedWord(word);return cacheEntry?cacheEntry.status:(this._unknownWords.push(word),SpellCheck.WordStatus.UNKNOWN)},SpellCheckManager.lookupWords=function(words){words=Util.Array.unique(words);for(var i=0;i<words.length;i++){var word=words[i];this.checkWord(word)}return this._unknownWords.length>0?(this._lookupInProgress=!0,this.processWords(),!0):(this.onDictionaryReady.fire(),!1)},SpellCheckManager.processWords=function(){var text=this._unknownWords.join(" ");SpellCheck.XHR.getErrors(this._language,text,function(spellingErrors){SpellCheckManager._receivedWordErrors(spellingErrors)})},SpellCheckManager._receivedWords=function(misspelledWords){if(misspelledWords)for(var i=0;i<this._unknownWords.length;i++){for(var unknownWord=this._unknownWords[i],isMisspelled=!1,j=0;j<misspelledWords.length;j++)if(unknownWord==misspelledWords[j]){isMisspelled=!0;break}this._cache[unknownWord]={status:isMisspelled?SpellCheck.WordStatus.INVALID:SpellCheck.WordStatus.VALID}}this._lookupInProgress=!1,this._unknownWords=[],this.onDictionaryReady.fire()},SpellCheckManager._receivedWordErrors=function(spellingErrors){if(spellingErrors)for(var i=0;i<this._unknownWords.length;i++){for(var unknownWord=this._unknownWords[i],isMisspelled=!1,spellingError=null,j=0;j<spellingErrors.length;j++)if(spellingError=spellingErrors[j],unknownWord==spellingError.word){isMisspelled=!0;break}this._cache[unknownWord]=isMisspelled?{status:SpellCheck.WordStatus.INVALID,suggestions:spellingError.suggestions}:{status:SpellCheck.WordStatus.VALID,suggestions:null}}this._lookupInProgress=!1,this._unknownWords=[],this.onDictionaryReady.fire()},SpellCheck.XHR={},SpellCheck.XHR.onRequest=new YAHOO.util.CustomEvent("onRequest",SpellCheck.XHR,!1,YAHOO.util.CustomEvent.FLAT),SpellCheck.XHR.onComplete=new YAHOO.util.CustomEvent("onComplete",SpellCheck.XHR,!1,YAHOO.util.CustomEvent.FLAT),SpellCheck.XHR.onSuccess=new YAHOO.util.CustomEvent("onSuccess",SpellCheck.XHR,!1,YAHOO.util.CustomEvent.FLAT),SpellCheck.XHR.onFailure=new YAHOO.util.CustomEvent("onFailure",SpellCheck.XHR,!1,YAHOO.util.CustomEvent.FLAT),SpellCheck.XHR._encodeText=function(text){return encodeURIComponent(text).replace(/%20/g,"+")},SpellCheck.XHR._sendRequest=function(action,language,text,success,failure){var callback={success:function(xhrObj){SpellCheck.XHR.onComplete.fire(),SpellCheck.XHR.onSuccess.fire();var contentType=xhrObj.getResponseHeader["Content-Type"],data=(xhrObj.responseText,null);if("text/plain"==contentType)data=xhrObj.responseText;else if("application/json"==contentType){var jsonString=xhrObj.responseText;data=YAHOO.lang.JSON.parse(jsonString)}"function"==typeof success&&success(action,data)},failure:function(xhrObj){SpellCheck.XHR.onComplete.fire(),SpellCheck.XHR.onFailure.fire(),"function"==typeof failure&&failure(xhrObj)},timeout:3e4},url="SpellEngine.axd/"+action+"?lang="+language,postData="text="+this._encodeText(text),id=YAHOO.util.Connect.asyncRequest("POST",url,callback,postData);return SpellCheck.XHR.onRequest.fire(),id},SpellCheck.XHR.checkWord=function(language,word,success,failure){return SpellCheck.XHR._sendRequest("checkWord",language,word,function(action,data){success(data)})},SpellCheck.XHR.checkText=function(language,text,success,failure){return SpellCheck.XHR._sendRequest("checkText",language,text,function(action,data){success(data)})},SpellCheck.XHR.getSuggestions=function(language,word,success,failure){return SpellCheck.XHR._sendRequest("getSuggestions",language,word,function(action,data){success(data)})},SpellCheck.XHR.getErrors=function(language,text,success,failure){return SpellCheck.XHR._sendRequest("getErrors",language,text,function(action,data){success(data)})},function(TDS){function MS(name,minChoices,maxChoices,orientation){Util.Event.Emitter(this),this.name=name,this.title="",this.prompt="",this.options=[],this.minChoices=minChoices||0,this.maxChoices=maxChoices||0,this.mode=1===this.maxChoices?Mode.Single:Mode.Multiple,this.orientation=orientation||Orientation.Vertical}var Mode={Single:"single",Multiple:"multiple"},Orientation={Vertical:"vertical",Horizontal:"horizontal",Stacked:"stacked",StackedB:"stackedb"};MS.Mode=Mode,MS.Orientation=Orientation,Object.defineProperty(MS.prototype,"selectedOptions",{get:function(){return this.options.filter(function(option){return!0===option.selected})}}),Object.defineProperty(MS.prototype,"selectedKeys",{get:function(){return this.selectedOptions.map(function(option){return option.key})}}),MS.prototype.createOption=function(key,html,feedback,soundLink){var option=this.getOption(key);if(option)throw new Error("An option with the key '"+key+"' already exists.");return option=new MS.Option(this,key,html),feedback&&(option.feedback=feedback),soundLink&&(option.soundLink=soundLink),this.options.push(option),option},MS.prototype.getOption=function(key){return Util.Array.find(this.options,function(option){return option.key===key})},MS.prototype.select=function(key){var option=this.getOption(key);return!!option&&option.select()},MS.prototype.deselect=function(key){var option=this.getOption(key);return!!option&&option.deselect()},MS.prototype.shuffle=function(){this.options=Util.Array.shuffle(this.options)},TDS.MultipleSelect=MS}(window.TDS),TDS=window.TDS||{},function(TDS){function Option(parent,key,html){Util.Event.Emitter(this),this.parent=parent,this.selected=!1,this.key=key,this.html=html,this.feedback=null,this.soundLink=null}var MS=window.TDS.MultipleSelect,Mode=MS.Mode;Object.defineProperty(Option.prototype,"value",{get:function(){var idx=this.parent.options.indexOf(this);return-1!=idx?this.parent.mode==Mode.Single?String.fromCharCode(idx+65):idx+1+"":""}}),Option.prototype.select=function(){if(this.selected)return this.parent.mode==Mode.Multiple&&this.deselect();var maxChoices=this.parent.maxChoices,selectedOptions=this.parent.selectedOptions,selectedCount=selectedOptions.length;if(1===maxChoices&&selectedCount>0)selectedOptions[0].deselect();else if(maxChoices>0&&maxChoices<=selectedCount)return!1;return this.selected=!0,this.onChanged(),!0},Option.prototype.deselect=function(){return!!this.selected&&(this.selected=!1,this.onChanged(),!0)},Option.prototype.onChanged=function(){this.selected?this.fire("selected"):this.fire("deselected")},Option.prototype.toString=function(){return this.key},MS.Option=Option}(),MS=TDS.MultipleSelect||{},function(MS){function Renderer(ms){Util.Assert.isInstanceOf(MS,ms),this.ms=ms,this.useTable=ms.orientation==Orientation.Horizontal}var Mode=MS.Mode,Orientation=MS.Orientation;Renderer.prototype.render=function(parentEl){var containerEl=this.createContainer(),promptEl=this.createPrompt();promptEl&&containerEl.appendChild(promptEl);var groupEl=this.createGroup();if(this.createOptions().forEach(function(optionEl){if(this.useTable){var cellEl=document.createElement("td");cellEl.appendChild(optionEl),groupEl.appendChild(cellEl)}else groupEl.appendChild(optionEl)}.bind(this)),containerEl.appendChild(groupEl),this.useTable){var tableEl=document.createElement("table");tableEl.className="flat",tableEl.appendChild(containerEl),containerEl=tableEl}parentEl.appendChild(containerEl)},Renderer.prototype.createContainer=function(){var containerTag=this.useTable?"tr":"div",containerEl=document.createElement(containerTag);return containerEl.className="optionsContainer",this.ms.mode==Mode.Single?$(containerEl).addClass("format_mc"):$(containerEl).addClass("format_ms"),containerEl},Renderer.prototype.createGroup=function(){var groupEl=document.createElement("div");return groupEl.className="optionsGroup",groupEl},Renderer.prototype.createPrompt=function(){if(this.ms.prompt){var promptEl=document.createElement("div");return promptEl.className="optionsPrompt",promptEl.innerHTML=this.ms.prompt,promptEl}return null},Renderer.prototype.createOptions=function(){var optionEls=[];return this.ms.options.forEach(function(option){var optionEl=this.createOption(option);optionEls.push(optionEl)}.bind(this)),optionEls},Renderer.prototype.createOption=function(option){var optionEl=document.createElement("div");$(optionEl).addClass("optionContainer"),$(optionEl).addClass("option"+option.value),option.selected&&$(optionEl).addClass("optionSelected");var strikeEl=document.createElement("span");strikeEl.className="striked",optionEl.appendChild(strikeEl);var clickerEl=document.createElement("span");clickerEl.className="optionClicker",optionEl.appendChild(clickerEl);var inputEl=document.createElement("input");inputEl.className="option",inputEl.name=this.ms.name,inputEl.type=this.ms.mode==Mode.Single?"radio":"checkbox",inputEl.value=option.value,inputEl.checked=option.selected,optionEl.appendChild(inputEl),inputEl.setAttribute("aria-label","Option "+option.value);var contentEl=document.createElement("div");if(contentEl.className="optionContent",$(contentEl).html(option.html),optionEl.appendChild(contentEl),option.feedback){var feedbackEl=document.createElement("div");feedbackEl.className="optionFeedback",optionEl.appendChild(feedbackEl)}return this.addOptionEvents(option,optionEl,inputEl),optionEl},Renderer.prototype.addOptionEvents=function(option,optionEl,inputEl){option.on("selected",function(){$(optionEl).addClass("optionSelected"),inputEl.checked||(inputEl.checked=!0)}),option.on("deselected",function(){$(optionEl).removeClass("optionSelected"),inputEl.checked&&(inputEl.checked=!1)}),$(inputEl).change(function(evt){inputEl.checked?option.select()||(inputEl.checked=!1):option.deselect()}),$(optionEl).click(function(evt){option.select()}),$(inputEl).click(function(evt){evt.stopPropagation()})},MS.Renderer=Renderer}(TDS.MultipleSelect),function(CM){function parseQTI(interactionNode){var responseIdentifier=interactionNode.getAttribute("responseIdentifier"),minChoices=1*interactionNode.getAttribute("minChoices"),maxChoices=1*interactionNode.getAttribute("maxChoices"),orientation=interactionNode.getAttribute("orientation"),ms=new MS(responseIdentifier,minChoices,maxChoices,orientation),promptNode=Util.Dom.getElementByTagName("prompt",interactionNode);return promptNode&&(ms.prompt=Util.Xml.innerHTML(promptNode)),Util.Dom.getElementsByTagName("simpleChoice",interactionNode).forEach(function(simpleChoiceNode){var identifier=simpleChoiceNode.getAttribute("identifier"),html=Util.Xml.innerHTML(simpleChoiceNode);ms.createOption(identifier,html)}),"true"===interactionNode.getAttribute("shuffle")&&ms.shuffle(),ms}function Widget_MS(page,item,config){this.dataType=CM.DataType.Array,this.options={autoLoad:!0},this.ms=null}var MS=TDS.MultipleSelect,Renderer=TDS.MultipleSelect.Renderer,match=CM.QTI.createWidgetMatch("choiceInteraction");CM.registerWidget("qti.choice",Widget_MS,match),Widget_MS.prototype.load=function(){var ms=parseQTI(this.config);new Renderer(ms).render(this.element),this.ms=ms},Widget_MS.prototype.getResponse=function(){var values=this.ms.selectedKeys,isValid=values.length>0;return this.createResponse(values,isValid)},Widget_MS.prototype.setResponse=function(values){values.forEach(function(value){this.ms.select(value)}.bind(this))}}(window.ContentManager),window.CKEDITOR&&window.CKEDITOR.dom||(window.CKEDITOR||(window.CKEDITOR=function(){var a=/(^|.*[\\\/])ckeditor\.js(?:\?.*|;.*)?$/i,f={timestamp:"F0RD",version:"4.4.7",revision:"3a35b3d",rnd:Math.floor(900*Math.random())+100,_:{pending:[],basePathSrcPattern:a},status:"unloaded",basePath:function(){var e=window.CKEDITOR_BASEPATH||"";if(!e)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var b=d[c].src.match(a);if(b){e=b[1];break}}if(-1==e.indexOf(":/")&&"//"!=e.slice(0,2)&&(e=0===e.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+e:location.href.match(/^[^\?]*\/(?:)/)[0]+e),!e)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return e}(),getUrl:function(a){return-1==a.indexOf(":/")&&0!==a.indexOf("/")&&(a=this.basePath+a),this.timestamp&&"/"!=a.charAt(a.length-1)&&!/[&?]t=/.test(a)&&(a+=(0<=a.indexOf("?")?"&":"?")+"t="+this.timestamp),a},domReady:function(){function a(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",a,!1),d()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",a),d())}catch(c){}}function d(){for(var a;a=c.shift();)a()}var c=[];return function(d){function b(){try{document.documentElement.doScroll("left")}catch(m){return void setTimeout(b,1)}a()}if(c.push(d),"complete"===document.readyState&&setTimeout(a,1),1==c.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",a),window.attachEvent("onload",a),d=!1;try{d=!window.frameElement}catch(f){}document.documentElement.doScroll&&d&&b()}}}()},b=window.CKEDITOR_GETURL;if(b){var c=f.getUrl;f.getUrl=function(a){return b.call(f,a)||c.call(f,a)}}return f}()),CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(a){var b,f=CKEDITOR.event.prototype;for(b in f)null==a[b]&&(a[b]=f[b])},CKEDITOR.event.prototype=function(){function a(a){var e=f(this);return e[a]||(e[a]=new b(a))}var f=function(a){return(a=a.getPrivate&&a.getPrivate()||a._||(a._={})).events||(a.events={})},b=function(a){this.name=a,this.listeners=[]};return b.prototype={getListenerIndex:function(a){for(var e=0,d=this.listeners;e<d.length;e++)if(d[e].fn==a)return e;return-1}},{define:function(b,e){var d=a.call(this,b);CKEDITOR.tools.extend(d,e,!0)},on:function(b,e,d,f,k){function j(a,m,y,s){return a={name:b,sender:this,editor:a,data:m,listenerData:f,stop:y,cancel:s,removeListener:g},!1!==e.call(d,a)&&a.data}function g(){y.removeListener(b,e)}var m=a.call(this,b);if(m.getListenerIndex(e)<0){m=m.listeners,d||(d=this),isNaN(k)&&(k=10);var y=this;j.fn=e,j.priority=k;for(var s=m.length-1;s>=0;s--)if(m[s].priority<=k)return m.splice(s+1,0,j),{removeListener:g};m.unshift(j)}return{removeListener:g}},once:function(){var a=Array.prototype.slice.call(arguments),e=a[1];return a[1]=function(a){return a.removeListener(),e.apply(this,arguments)},this.on.apply(this,a)},capture:function(){CKEDITOR.event.useCapture=1;var a=this.on.apply(this,arguments);return CKEDITOR.event.useCapture=0,a},fire:function(){var a=0,e=function(){a=1},d=0,b=function(){d=1};return function(k,j,g){var m=f(this)[k],k=a,y=d;if(a=d=0,m&&(s=m.listeners).length)for(var w,s=s.slice(0),q=0;q<s.length;q++){if(m.errorProof)try{w=s[q].call(this,g,j,e,b)}catch(t){}else w=s[q].call(this,g,j,e,b);if(!1===w?d=1:void 0!==w&&(j=w),a||d)break}return j=!d&&(void 0===j||j),a=k,d=y,j}}(),fireOnce:function(a,e,d){return e=this.fire(a,e,d),delete f(this)[a],e},removeListener:function(a,e){var d=f(this)[a];if(d){var b=d.getListenerIndex(e);b>=0&&d.listeners.splice(b,1)}},removeAllListeners:function(){var e,a=f(this);for(e in a)delete a[e]},hasListeners:function(a){return(a=f(this)[a])&&a.listeners.length>0}}}()),CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]),CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(a,f){return a in{instanceReady:1,loaded:1}&&(this[a]=!0),CKEDITOR.event.prototype.fire.call(this,a,f,this)},CKEDITOR.editor.prototype.fireOnce=function(a,f){return a in{instanceReady:1,loaded:1}&&(this[a]=!0),CKEDITOR.event.prototype.fireOnce.call(this,a,f,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype)),CKEDITOR.env||(CKEDITOR.env=function(){var a=navigator.userAgent.toLowerCase(),f={ie:a.indexOf("trident/")>-1,webkit:a.indexOf(" applewebkit/")>-1,air:a.indexOf(" adobeair/")>-1,mac:a.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode&&(!document.documentMode||document.documentMode<10),mobile:a.indexOf("mobile")>-1,iOS:/(ipad|iphone|ipod)/.test(a),isCustomDomain:function(){if(!this.ie)return!1;var a=document.domain,d=window.location.hostname;return a!=d&&a!="["+d+"]"},secure:"https:"==location.protocol};f.gecko="Gecko"==navigator.product&&!f.webkit&&!f.ie,f.webkit&&(a.indexOf("chrome")>-1?f.chrome=!0:f.safari=!0);var b=0;if(f.ie&&(b=f.quirks||!document.documentMode?parseFloat(a.match(/msie (\d+)/)[1]):document.documentMode,f.ie9Compat=9==b,f.ie8Compat=8==b,f.ie7Compat=7==b,f.ie6Compat=b<7||f.quirks),f.gecko){var c=a.match(/rv:([\d\.]+)/);c&&(b=1e4*(c=c[1].split("."))[0]+100*(c[1]||0)+1*(c[2]||0))}return f.air&&(b=parseFloat(a.match(/ adobeair\/(\d+)/)[1])),f.webkit&&(b=parseFloat(a.match(/ applewebkit\/(\d+)/)[1])),f.version=b,f.isCompatible=f.iOS&&b>=534||!f.mobile&&(f.ie&&b>6||f.gecko&&b>=2e4||f.air&&b>=1||f.webkit&&b>=522||!1),f.hidpi=window.devicePixelRatio>=2,f.needsBrFiller=f.gecko||f.webkit||f.ie&&b>10,f.needsNbspFiller=f.ie&&b<11,f.cssClass="cke_browser_"+(f.ie?"ie":f.gecko?"gecko":f.webkit?"webkit":"unknown"),f.quirks&&(f.cssClass=f.cssClass+" cke_browser_quirks"),f.ie&&(f.cssClass=f.cssClass+" cke_browser_ie"+(f.quirks?"6 cke_browser_iequirks":f.version)),f.air&&(f.cssClass=f.cssClass+" cke_browser_air"),f.iOS&&(f.cssClass=f.cssClass+" cke_browser_ios"),f.hidpi&&(f.cssClass=f.cssClass+" cke_hidpi"),f}()),"unloaded"==CKEDITOR.status&&(CKEDITOR.event.implementOn(CKEDITOR),CKEDITOR.loadFullCore=function(){if("basic_ready"!=CKEDITOR.status)CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var a=document.createElement("script");a.type="text/javascript",a.src=CKEDITOR.basePath+"ckeditor.js",document.getElementsByTagName("head")[0].appendChild(a)}},CKEDITOR.loadFullCoreTimeout=0,CKEDITOR.add=function(a){(this._.pending||(this._.pending=[])).push(a)},CKEDITOR.domReady(function(){var a=CKEDITOR.loadFullCore,f=CKEDITOR.loadFullCoreTimeout;a&&(CKEDITOR.status="basic_ready",a&&a._load?a():f&&setTimeout(function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()},1e3*f))}),CKEDITOR.status="basic_loaded"),CKEDITOR.dom={},function(){var a=[],f=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.ie?"-ms-":"",b=/&/g,c=/>/g,e=/</g,d=/"/g,h=/&amp;/g,k=/&gt;/g,j=/&lt;/g,g=/&quot;/g;CKEDITOR.on("reset",function(){a=[]}),CKEDITOR.tools={arrayCompare:function(a,e){if(!a&&!e)return!0;if(!a||!e||a.length!=e.length)return!1;for(var d=0;d<a.length;d++)if(a[d]!=e[d])return!1;return!0},clone:function(a){var e;if(a&&a instanceof Array){e=[];for(var d=0;d<a.length;d++)e[d]=CKEDITOR.tools.clone(a[d]);return e}if(null===a||"object"!=typeof a||a instanceof String||a instanceof Number||a instanceof Boolean||a instanceof Date||a instanceof RegExp||a.nodeType||a.window===a)return a;e=new a.constructor;for(d in a)e[d]=CKEDITOR.tools.clone(a[d]);return e},capitalize:function(a,e){return a.charAt(0).toUpperCase()+(e?a.slice(1):a.slice(1).toLowerCase())},extend:function(a){var d,b,e=arguments.length;"boolean"==typeof(d=arguments[e-1])?e--:"boolean"==typeof(d=arguments[e-2])&&(b=arguments[e-1],e-=2);for(var c=1;c<e;c++){var i,f=arguments[c];for(i in f)!0!==d&&null!=a[i]||(!b||i in b)&&(a[i]=f[i])}return a},prototypedCopy:function(a){var e=function(){};return e.prototype=a,new e},copy:function(a){var d,e={};for(d in a)e[d]=a[d];return e},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},isEmpty:function(a){for(var e in a)if(a.hasOwnProperty(e))return!1;return!0},cssVendorPrefix:function(a,e,d){return d?f+a+":"+e+";"+a+":"+e:(d={},d[a]=e,d[f+a]=e,d)},cssStyleToDomStyle:function(){var a=document.createElement("div").style,e=void 0!==a.cssFloat?"cssFloat":void 0!==a.styleFloat?"styleFloat":"float";return function(a){return"float"==a?e:a.replace(/-./g,function(a){return a.substr(1).toUpperCase()})}}(),buildStyleHtml:function(a){for(var e,a=[].concat(a),d=[],b=0;b<a.length;b++)(e=a[b])&&(/@import|[{}]/.test(e)?d.push("<style>"+e+"</style>"):d.push('<link type="text/css" rel=stylesheet href="'+e+'">'));return d.join("")},htmlEncode:function(a){return(""+a).replace(b,"&amp;").replace(c,"&gt;").replace(e,"&lt;")},htmlDecode:function(a){return a.replace(h,"&").replace(k,">").replace(j,"<")},htmlEncodeAttr:function(a){return a.replace(d,"&quot;").replace(e,"&lt;").replace(c,"&gt;")},htmlDecodeAttr:function(a){return a.replace(g,'"').replace(j,"<").replace(k,">")},getNextNumber:function(){var a=0;return function(){return++a}}(),getNextId:function(){return"cke_"+this.getNextNumber()},override:function(a,e){var d=e(a);return d.prototype=a.prototype,d},setTimeout:function(a,e,d,b,c){return c||(c=window),d||(d=c),c.setTimeout(function(){b?a.apply(d,[].concat(b)):a.apply(d)},e||0)},trim:function(){var a=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(e){return e.replace(a,"")}}(),ltrim:function(){var a=/^[ \t\n\r]+/g;return function(e){return e.replace(a,"")}}(),rtrim:function(){var a=/[ \t\n\r]+$/g;return function(e){return e.replace(a,"")}}(),indexOf:function(a,e){if("function"==typeof e){for(var d=0,b=a.length;d<b;d++)if(e(a[d]))return d}else{if(a.indexOf)return a.indexOf(e);for(d=0,b=a.length;d<b;d++)if(a[d]===e)return d}return-1},search:function(a,e){var d=CKEDITOR.tools.indexOf(a,e);return d>=0?a[d]:null},bind:function(a,e){return function(){return a.apply(e,arguments)}},createClass:function(a){var e=a.$,d=a.base,b=a.privates||a._,c=a.proto,a=a.statics;if(!e&&(e=function(){d&&this.base.apply(this,arguments)}),b)var f=e,e=function(){var e,a=this._||(this._={});for(e in b){var d=b[e];a[e]="function"==typeof d?CKEDITOR.tools.bind(d,this):d}f.apply(this,arguments)};return d&&(e.prototype=this.prototypedCopy(d.prototype),e.prototype.constructor=e,e.base=d,e.baseProto=d.prototype,e.prototype.base=function(){this.base=d.prototype.base,d.apply(this,arguments),this.base=arguments.callee}),c&&this.extend(e.prototype,c,!0),a&&this.extend(e,a,!0),e},addFunction:function(e,d){return a.push(function(){return e.apply(d||this,arguments)})-1},removeFunction:function(e){a[e]=null},callFunction:function(e){var d=a[e];return d&&d.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var e,a=/^-?\d+\.?\d*px$/;return function(d){return e=CKEDITOR.tools.trim(d+"")+"px",a.test(e)?e:d||""}}(),convertToPx:function(){var a;return function(e){return a||(a=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document),CKEDITOR.document.getBody().append(a)),/%$/.test(e)?e:(a.setStyle("width",e),a.$.clientWidth)}}(),repeat:function(a,e){return Array(e+1).join(a)},tryThese:function(){for(var a,e=0,d=arguments.length;e<d;e++){var b=arguments[e];try{a=b();break}catch(c){}}return a},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(a){return function(){var e=arguments,d=this;window.setTimeout(function(){a.apply(d,e)},0)}},normalizeCssText:function(a,e){var b,d=[],c=CKEDITOR.tools.parseCssText(a,!0,e);for(b in c)d.push(b+":"+c[b]);return d.sort(),d.length?d.join(";")+";":""},convertRgbToHex:function(a){return a.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(a,e,d,b){for(a=[e,d,b],e=0;e<3;e++)a[e]=("0"+parseInt(a[e],10).toString(16)).slice(-2);return"#"+a.join("")})},parseCssText:function(a,e,d){var b={};return d&&((d=new CKEDITOR.dom.element("span")).setAttribute("style",a),a=CKEDITOR.tools.convertRgbToHex(d.getAttribute("style")||"")),a&&";"!=a?(a.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,d,m){e&&("font-family"==(d=d.toLowerCase())&&(m=m.toLowerCase().replace(/["']/g,"").replace(/\s*,\s*/g,",")),m=CKEDITOR.tools.trim(m)),b[d]=m}),b):b},writeCssText:function(a,e){var d,b=[];for(d in a)b.push(d+":"+a[d]);return e&&b.sort(),b.join("; ")},objectCompare:function(a,e,d){var b;if(!a&&!e)return!0;if(!a||!e)return!1;for(b in a)if(a[b]!=e[b])return!1;if(!d)for(b in e)if(a[b]!=e[b])return!1;return!0},objectKeys:function(a){var d,e=[];for(d in a)e.push(d);return e},convertArrayToObject:function(a,e){var d={};1==arguments.length&&(e=!0);for(var b=0,c=a.length;b<c;++b)d[a[b]]=e;return d},fixDomain:function(){for(var a;;)try{a=window.parent.document.domain;break}catch(e){if(!(a=a?a.replace(/.+?(?:\.|$)/,""):document.domain))break;document.domain=a}return!!a},eventsBuffer:function(a,e){function d(){c=(new Date).getTime(),b=!1,e()}var b,c=0;return{input:function(){if(!b){var e=(new Date).getTime()-c;e<a?b=setTimeout(d,a-e):d()}},reset:function(){b&&clearTimeout(b),b=c=0}}},enableHtml5Elements:function(a,e){for(var c,d=["abbr","article","aside","audio","bdi","canvas","data","datalist","details","figcaption","figure","footer","header","hgroup","mark","meter","nav","output","progress","section","summary","time","video"],b=d.length;b--;)c=a.createElement(d[b]),e&&a.appendChild(c)},checkIfAnyArrayItemMatches:function(a,e){for(var d=0,b=a.length;d<b;++d)if(a[d].match(e))return!0;return!1},checkIfAnyObjectPropertyMatches:function(a,e){for(var d in a)if(d.match(e))return!0;return!1},transparentImageData:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw=="}}(),CKEDITOR.dtd=function(){var a=CKEDITOR.tools.extend,f=function(a,e){for(var d=CKEDITOR.tools.clone(a),b=1;b<arguments.length;b++){var c,e=arguments[b];for(c in e)delete d[c]}return d},b={},c={},e={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},d={command:1,link:1,meta:1,noscript:1,script:1,style:1},h={},k={"#":1},j={center:1,dir:1,noframes:1};return a(b,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,var:1,video:1,wbr:1},k,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1}),a(c,e,b,j),f={a:f(b,{a:1,button:1}),abbr:b,address:c,area:h,article:c,aside:c,audio:a({source:1,track:1},c),b:b,base:h,bdi:b,bdo:b,blockquote:c,body:c,br:h,button:f(b,{a:1,button:1}),canvas:b,caption:c,cite:b,code:b,col:h,colgroup:{col:1},command:h,datalist:a({option:1},b),dd:c,del:b,details:a({summary:1},c),dfn:b,div:c,dl:{dt:1,dd:1},dt:c,em:b,embed:h,fieldset:a({legend:1},c),figcaption:c,figure:a({figcaption:1},c),footer:c,form:c,h1:b,h2:b,h3:b,h4:b,h5:b,h6:b,head:a({title:1,base:1},d),header:c,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:h,html:a({head:1,body:1},c,d),i:b,iframe:k,img:h,input:h,ins:b,kbd:b,keygen:h,label:b,legend:b,li:c,link:h,main:c,map:c,mark:b,menu:a({li:1},c),meta:h,meter:f(b,{meter:1}),nav:c,noscript:a({link:1,meta:1,style:1},b),object:a({param:1},b),ol:{li:1},optgroup:{option:1},option:k,output:b,p:b,param:h,pre:b,progress:f(b,{progress:1}),q:b,rp:b,rt:b,ruby:a({rp:1,rt:1},b),s:b,samp:b,script:k,section:c,select:{optgroup:1,option:1},small:b,source:h,span:b,strong:b,style:k,sub:b,summary:b,sup:b,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:c,textarea:k,tfoot:{tr:1},th:c,thead:{tr:1},time:f(b,{time:1}),title:k,tr:{th:1,td:1},track:h,u:b,ul:{li:1},var:b,video:a({source:1,track:1},c),wbr:h,acronym:b,applet:a({param:1},c),basefont:h,big:b,center:c,dialog:h,dir:{li:1},font:b,isindex:h,noframes:c,strike:b,tt:b},a(f,{$block:a({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},e,j),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,main:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,main:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:b,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:a({body:1,head:1,html:1},f.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,var:1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),f}(),CKEDITOR.dom.event=function(a){this.$=a},CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var a=this.getKey();return(this.$.ctrlKey||this.$.metaKey)&&(a+=CKEDITOR.CTRL),this.$.shiftKey&&(a+=CKEDITOR.SHIFT),this.$.altKey&&(a+=CKEDITOR.ALT),a},preventDefault:function(a){var f=this.$;f.preventDefault?f.preventDefault():f.returnValue=!1,a&&this.stopPropagation()},stopPropagation:function(){var a=this.$;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},getTarget:function(){var a=this.$.target||this.$.srcElement;return a?new CKEDITOR.dom.node(a):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var a=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(a.documentElement.scrollLeft||a.body.scrollLeft),y:this.$.pageY||this.$.clientY+(a.documentElement.scrollTop||a.body.scrollTop)}}},CKEDITOR.CTRL=1114112,CKEDITOR.SHIFT=2228224,CKEDITOR.ALT=4456448,CKEDITOR.EVENT_PHASE_CAPTURING=1,CKEDITOR.EVENT_PHASE_AT_TARGET=2,CKEDITOR.EVENT_PHASE_BUBBLING=3,CKEDITOR.dom.domObject=function(a){a&&(this.$=a)},CKEDITOR.dom.domObject.prototype=function(){var a=function(a,b){return function(c){"undefined"!=typeof CKEDITOR&&a.fire(b,new CKEDITOR.dom.event(c))}};return{getPrivate:function(){var a;return(a=this.getCustomData("_"))||this.setCustomData("_",a={}),a},on:function(f){var b=this.getCustomData("_cke_nativeListeners");return b||(b={},this.setCustomData("_cke_nativeListeners",b)),b[f]||(b=b[f]=a(this,f),this.$.addEventListener?this.$.addEventListener(f,b,!!CKEDITOR.event.useCapture):this.$.attachEvent&&this.$.attachEvent("on"+f,b)),CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(a){if(CKEDITOR.event.prototype.removeListener.apply(this,arguments),!this.hasListeners(a)){var b=this.getCustomData("_cke_nativeListeners"),c=b&&b[a];c&&(this.$.removeEventListener?this.$.removeEventListener(a,c,!1):this.$.detachEvent&&this.$.detachEvent("on"+a,c),delete b[a])}},removeAllListeners:function(){var b,a=this.getCustomData("_cke_nativeListeners");for(b in a){var c=a[b];this.$.detachEvent?this.$.detachEvent("on"+b,c):this.$.removeEventListener&&this.$.removeEventListener(b,c,!1),delete a[b]}CKEDITOR.event.prototype.removeAllListeners.call(this)}}}(),function(a){var f={};CKEDITOR.on("reset",function(){f={}}),a.equals=function(a){try{return a&&a.$===this.$}catch(c){return!1}},a.setCustomData=function(a,c){var e=this.getUniqueId();return(f[e]||(f[e]={}))[a]=c,this},a.getCustomData=function(a){var c=this.$["data-cke-expando"];return(c=c&&f[c])&&a in c?c[a]:null},a.removeCustomData=function(a){var e,d,c=this.$["data-cke-expando"];return(c=c&&f[c])&&(e=c[a],d=a in c,delete c[a]),d?e:null},a.clearCustomData=function(){this.removeAllListeners();var a=this.$["data-cke-expando"];a&&delete f[a]},a.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())},CKEDITOR.event.implementOn(a)}(CKEDITOR.dom.domObject.prototype),CKEDITOR.dom.node=function(a){return a?new CKEDITOR.dom[a.nodeType==CKEDITOR.NODE_DOCUMENT?"document":a.nodeType==CKEDITOR.NODE_ELEMENT?"element":a.nodeType==CKEDITOR.NODE_TEXT?"text":a.nodeType==CKEDITOR.NODE_COMMENT?"comment":a.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](a):this},CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject,CKEDITOR.NODE_ELEMENT=1,CKEDITOR.NODE_DOCUMENT=9,CKEDITOR.NODE_TEXT=3,CKEDITOR.NODE_COMMENT=8,CKEDITOR.NODE_DOCUMENT_FRAGMENT=11,CKEDITOR.POSITION_IDENTICAL=0,CKEDITOR.POSITION_DISCONNECTED=1,CKEDITOR.POSITION_FOLLOWING=2,CKEDITOR.POSITION_PRECEDING=4,CKEDITOR.POSITION_IS_CONTAINED=8,CKEDITOR.POSITION_CONTAINS=16,CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(a,f){return a.append(this,f),a},clone:function(a,f){var b=this.$.cloneNode(a),c=function(e){if(e["data-cke-expando"]&&(e["data-cke-expando"]=!1),e.nodeType==CKEDITOR.NODE_ELEMENT&&(f||e.removeAttribute("id",!1),a))for(var e=e.childNodes,d=0;d<e.length;d++)c(e[d])};return c(b),new CKEDITOR.dom.node(b)},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(a){return a.$.parentNode.insertBefore(this.$,a.$.nextSibling),a},insertBefore:function(a){return a.$.parentNode.insertBefore(this.$,a.$),a},insertBeforeMe:function(a){return this.$.parentNode.insertBefore(a.$,this.$),a},getAddress:function(a){for(var f=[],b=this.getDocument().$.documentElement,c=this.$;c&&c!=b;){var e=c.parentNode;e&&f.unshift(this.getIndex.call({$:c},a)),c=e}return f},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(a){function f(a,e){var b=e?a.nextSibling:a.previousSibling;return b&&b.nodeType==CKEDITOR.NODE_TEXT?b.nodeValue?b:f(b,e):null}var e,b=this.$,c=-1;if(!this.$.parentNode||a&&b.nodeType==CKEDITOR.NODE_TEXT&&!b.nodeValue&&!f(b)&&!f(b,!0))return-1;do{(!a||b==this.$||b.nodeType!=CKEDITOR.NODE_TEXT||!e&&b.nodeValue)&&(c++,e=b.nodeType==CKEDITOR.NODE_TEXT)}while(b=b.previousSibling);return c},getNextSourceNode:function(a,f,b){if(b&&!b.call)var c=b,b=function(a){return!a.equals(c)};var e;if(!(a=!a&&this.getFirst&&this.getFirst())){if(this.type==CKEDITOR.NODE_ELEMENT&&b&&!1===b(this,!0))return null;a=this.getNext()}for(;!a&&(e=(e||this).getParent());){if(b&&!1===b(e,!0))return null;a=e.getNext()}return!a||b&&!1===b(a)?null:f&&f!=a.type?a.getNextSourceNode(!1,f,b):a},getPreviousSourceNode:function(a,f,b){if(b&&!b.call)var c=b,b=function(a){return!a.equals(c)};var e;if(!(a=!a&&this.getLast&&this.getLast())){if(this.type==CKEDITOR.NODE_ELEMENT&&b&&!1===b(this,!0))return null;a=this.getPrevious()}for(;!a&&(e=(e||this).getParent());){if(b&&!1===b(e,!0))return null;a=e.getPrevious()}return!a||b&&!1===b(a)?null:f&&a.type!=f?a.getPreviousSourceNode(!1,f,b):a},getPrevious:function(a){var b,f=this.$;do{b=(f=f.previousSibling)&&10!=f.nodeType&&new CKEDITOR.dom.node(f)}while(b&&a&&!a(b));return b},getNext:function(a){var b,f=this.$;do{b=(f=f.nextSibling)&&new CKEDITOR.dom.node(f)}while(b&&a&&!a(b));return b},getParent:function(a){var f=this.$.parentNode;return f&&(f.nodeType==CKEDITOR.NODE_ELEMENT||a&&f.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(f):null},getParents:function(a){var f=this,b=[];do{b[a?"push":"unshift"](f)}while(f=f.getParent());return b},getCommonAncestor:function(a){if(a.equals(this))return this;if(a.contains&&a.contains(this))return a;var f=this.contains?this:this.getParent();do{if(f.contains(a))return f}while(f=f.getParent());return null},getPosition:function(a){var f=this.$,b=a.$;if(f.compareDocumentPosition)return f.compareDocumentPosition(b);if(f==b)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&a.type==CKEDITOR.NODE_ELEMENT){if(f.contains){if(f.contains(b))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(b.contains(f))return CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in f)return f.sourceIndex<0||b.sourceIndex<0?CKEDITOR.POSITION_DISCONNECTED:f.sourceIndex<b.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}for(var f=this.getAddress(),a=a.getAddress(),b=Math.min(f.length,a.length),c=0;c<=b-1;c++)if(f[c]!=a[c]){if(c<b)return f[c]<a[c]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;break}return f.length<a.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING},getAscendant:function(a,f){var c,e,b=this.$;for(f||(b=b.parentNode),"function"==typeof a?(e=!0,c=a):(e=!1,c=function(e){return e="string"==typeof e.nodeName?e.nodeName.toLowerCase():"","string"==typeof a?e==a:e in a});b;){if(c(e?new CKEDITOR.dom.node(b):b))return new CKEDITOR.dom.node(b);try{b=b.parentNode}catch(d){b=null}}return null},hasAscendant:function(a,f){var b=this.$;for(f||(b=b.parentNode);b;){if(b.nodeName&&b.nodeName.toLowerCase()==a)return!0;b=b.parentNode}return!1},move:function(a,f){a.append(this.remove(),f)},remove:function(a){var f=this.$,b=f.parentNode;if(b){if(a)for(;a=f.firstChild;)b.insertBefore(f.removeChild(a),f);b.removeChild(f)}return this},replace:function(a){this.insertBefore(a),a.remove()},trim:function(){this.ltrim(),this.rtrim()},ltrim:function(){for(var a;this.getFirst&&(a=this.getFirst());){if(a.type==CKEDITOR.NODE_TEXT){var f=CKEDITOR.tools.ltrim(a.getText()),b=a.getLength();if(!f){a.remove();continue}f.length<b&&(a.split(b-f.length),this.$.removeChild(this.$.firstChild))}break}},rtrim:function(){for(var a;this.getLast&&(a=this.getLast());){if(a.type==CKEDITOR.NODE_TEXT){var f=CKEDITOR.tools.rtrim(a.getText()),b=a.getLength();if(!f){a.remove();continue}f.length<b&&(a.split(f.length),this.$.lastChild.parentNode.removeChild(this.$.lastChild))}break}CKEDITOR.env.needsBrFiller&&(a=this.$.lastChild)&&1==a.type&&"br"==a.nodeName.toLowerCase()&&a.parentNode.removeChild(a)},isReadOnly:function(){var a=this;if(this.type!=CKEDITOR.NODE_ELEMENT&&(a=this.getParent()),a&&void 0!==a.$.isContentEditable)return!(a.$.isContentEditable||a.data("cke-editable"));for(;a&&!a.data("cke-editable");){if("false"==a.getAttribute("contentEditable"))return!0;if("true"==a.getAttribute("contentEditable"))break;a=a.getParent()}return!a}}),CKEDITOR.dom.window=function(a){CKEDITOR.dom.domObject.call(this,a)},CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var a=this.$.document,f="CSS1Compat"==a.compatMode;return{width:(f?a.documentElement.clientWidth:a.body.clientWidth)||0,height:(f?a.documentElement.clientHeight:a.body.clientHeight)||0}},getScrollPosition:function(){var a=this.$;return"pageXOffset"in a?{x:a.pageXOffset||0,y:a.pageYOffset||0}:(a=a.document,{x:a.documentElement.scrollLeft||a.body.scrollLeft||0,y:a.documentElement.scrollTop||a.body.scrollTop||0})},getFrame:function(){var a=this.$.frameElement;return a?new CKEDITOR.dom.element.get(a):null}}),CKEDITOR.dom.document=function(a){CKEDITOR.dom.domObject.call(this,a)},CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(a){if(this.$.createStyleSheet)this.$.createStyleSheet(a);else{var f=new CKEDITOR.dom.element("link");f.setAttributes({rel:"stylesheet",type:"text/css",href:a}),this.getHead().append(f)}},appendStyleText:function(a){if(this.$.createStyleSheet){var f=this.$.createStyleSheet("");f.cssText=a}else{var b=new CKEDITOR.dom.element("style",this);b.append(new CKEDITOR.dom.text(a,this)),this.getHead().append(b)}return f||b.$.sheet},createElement:function(a,f){var b=new CKEDITOR.dom.element(a,this);return f&&(f.attributes&&b.setAttributes(f.attributes),f.styles&&b.setStyles(f.styles)),b},createText:function(a){return new CKEDITOR.dom.text(a,this)},focus:function(){this.getWindow().focus()},getActive:function(){var a;try{a=this.$.activeElement}catch(f){return null}return new CKEDITOR.dom.element(a)},getById:function(a){return(a=this.$.getElementById(a))?new CKEDITOR.dom.element(a):null},getByAddress:function(a,f){for(var b=this.$.documentElement,c=0;b&&c<a.length;c++){var e=a[c];if(f)for(var d=-1,h=0;h<b.childNodes.length;h++){var k=b.childNodes[h];if((!0!==f||3!=k.nodeType||!k.previousSibling||3!=k.previousSibling.nodeType)&&++d==e){b=k;break}}else b=b.childNodes[e]}return b?new CKEDITOR.dom.node(b):null},getElementsByTag:function(a,f){return!(CKEDITOR.env.ie&&document.documentMode<=8)&&f&&(a=f+":"+a),new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(a))},getHead:function(){var a=this.$.getElementsByTagName("head")[0];return a=a?new CKEDITOR.dom.element(a):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),!0)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(a){this.$.open("text/html","replace"),CKEDITOR.env.ie&&(a=a.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+CKEDITOR.tools.fixDomain+")();<\/script>")),this.$.write(a),this.$.close()},find:function(a){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(a))},findOne:function(a){return(a=this.$.querySelector(a))?new CKEDITOR.dom.element(a):null},_getHtml5ShivFrag:function(){var a=this.getCustomData("html5ShivFrag");return a||(a=this.$.createDocumentFragment(),CKEDITOR.tools.enableHtml5Elements(a,!0),this.setCustomData("html5ShivFrag",a)),a}}),CKEDITOR.dom.nodeList=function(a){this.$=a},CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(a){return a<0||a>=this.$.length?null:(a=this.$[a])?new CKEDITOR.dom.node(a):null}},CKEDITOR.dom.element=function(a,f){"string"==typeof a&&(a=(f?f.$:document).createElement(a)),CKEDITOR.dom.domObject.call(this,a)},CKEDITOR.dom.element.get=function(a){return(a="string"==typeof a?document.getElementById(a)||document.getElementsByName(a)[0]:a)&&(a.$?a:new CKEDITOR.dom.element(a))},CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node,CKEDITOR.dom.element.createFromHtml=function(a,f){var b=new CKEDITOR.dom.element("div",f);return b.setHtml(a),b.getFirst().remove()},CKEDITOR.dom.element.setMarker=function(a,f,b,c){var e=f.getCustomData("list_marker_id")||f.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),d=f.getCustomData("list_marker_names")||f.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");return a[e]=f,d[b]=1,f.setCustomData(b,c)},CKEDITOR.dom.element.clearAllMarkers=function(a){for(var f in a)CKEDITOR.dom.element.clearMarkers(a,a[f],1)},CKEDITOR.dom.element.clearMarkers=function(a,f,b){var d,c=f.getCustomData("list_marker_names"),e=f.getCustomData("list_marker_id");for(d in c)f.removeCustomData(d);f.removeCustomData("list_marker_names"),b&&(f.removeCustomData("list_marker_id"),delete a[e])},function(){function a(a){var d=!0;return a.$.id||(a.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber(),d=!1),function(){d||a.removeAttribute("id")}}function f(a,d){return"#"+a.$.id+" "+d.split(/,\s*/).join(", #"+a.$.id+" ")}function b(a){for(var d=0,b=0,f=c[a].length;b<f;b++)d+=parseInt(this.getComputedStyle(c[a][b])||0,10)||0;return d}CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:function(a){var d=this.$.className;return d&&(RegExp("(?:^|\\s)"+a+"(?:\\s|$)","").test(d)||(d=d+" "+a)),this.$.className=d||a,this},removeClass:function(a){var d=this.getAttribute("class");return d&&(a=RegExp("(?:^|\\s+)"+a+"(?=\\s|$)","i")).test(d)&&((d=d.replace(a,"").replace(/^\s+/,""))?this.setAttribute("class",d):this.removeAttribute("class")),this},hasClass:function(a){return RegExp("(?:^|\\s+)"+a+"(?=\\s|$)","").test(this.getAttribute("class"))},append:function(a,d){return"string"==typeof a&&(a=this.getDocument().createElement(a)),d?this.$.insertBefore(a.$,this.$.firstChild):this.$.appendChild(a.$),a},appendHtml:function(a){if(this.$.childNodes.length){var d=new CKEDITOR.dom.element("div",this.getDocument());d.setHtml(a),d.moveChildren(this)}else this.setHtml(a)},appendText:function(a){null!=this.$.text?this.$.text=this.$.text+a:this.append(new CKEDITOR.dom.text(a))},appendBogus:function(a){if(a||CKEDITOR.env.needsBrFiller){for(a=this.getLast();a&&a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(a.getText());)a=a.getPrevious();a&&a.is&&a.is("br")||(a=this.getDocument().createElement("br"),CKEDITOR.env.gecko&&a.setAttribute("type","_moz"),this.append(a))}},breakParent:function(a){var d=new CKEDITOR.dom.range(this.getDocument());d.setStartAfter(this),d.setEndAfter(a),a=d.extractContents(),d.insertNode(this.remove()),a.insertAfterNode(this)},contains:CKEDITOR.env.ie||CKEDITOR.env.webkit?function(a){var d=this.$;return a.type!=CKEDITOR.NODE_ELEMENT?d.contains(a.getParent().$):d!=a.$&&d.contains(a.$)}:function(a){return!!(16&this.$.compareDocumentPosition(a.$))},focus:function(){function a(){try{this.$.focus()}catch(e){}}return function(d){d?CKEDITOR.tools.setTimeout(a,100,this):a.call(this)}}(),getHtml:function(){var a=this.$.innerHTML;return CKEDITOR.env.ie?a.replace(/<\?[^>]*>/g,""):a},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var a=this.$.ownerDocument.createElement("div");return a.appendChild(this.$.cloneNode(!0)),a.innerHTML},getClientRect:function(){var a=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());return!a.width&&(a.width=a.right-a.left),!a.height&&(a.height=a.bottom-a.top),a},setHtml:CKEDITOR.env.ie&&CKEDITOR.env.version<9?function(a){try{var d=this.$;if(this.getParent())return d.innerHTML=a;var b=this.getDocument()._getHtml5ShivFrag();return b.appendChild(d),d.innerHTML=a,b.removeChild(d),a}catch(c){for(this.$.innerHTML="",(d=new CKEDITOR.dom.element("body",this.getDocument())).$.innerHTML=a,d=d.getChildren();d.count();)this.append(d.getItem(0));return a}}:function(a){return this.$.innerHTML=a},setText:function(){var a=document.createElement("p");return a.innerHTML="x",a=a.textContent,function(d){this.$[a?"textContent":"innerText"]=d}}(),getAttribute:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(a){switch(a){case"class":a="className";break;case"http-equiv":a="httpEquiv";break;case"name":return this.$.name;case"tabindex":return 0!==(a=this.$.getAttribute(a,2))&&0===this.$.tabIndex&&(a=null),a;case"checked":return((a=this.$.attributes.getNamedItem(a)).specified?a.nodeValue:this.$.checked)?"checked":null;case"hspace":case"value":return this.$[a];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(a,2)}:function(a){return this.$.getAttribute(a,2)},getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getComputedStyle:CKEDITOR.env.ie?function(a){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(a)]}:function(a){var d=this.getWindow().$.getComputedStyle(this.$,null);return d?d.getPropertyValue(a):""},getDtd:function(){var a=CKEDITOR.dtd[this.getName()];return this.getDtd=function(){return a},a},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:CKEDITOR.env.ie?function(){var a=this.$.tabIndex;return 0===a&&!CKEDITOR.dtd.$tabIndex[this.getName()]&&0!==parseInt(this.getAttribute("tabindex"),10)&&(a=-1),a}:CKEDITOR.env.webkit?function(){var a=this.$.tabIndex;return void 0===a&&(a=parseInt(this.getAttribute("tabindex"),10),isNaN(a)&&(a=-1)),a}:function(){return this.$.tabIndex},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var a=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&document.documentMode<=8){var d=this.$.scopeName;"HTML"!=d&&(a=d.toLowerCase()+":"+a)}return this.getName=function(){return a},this.getName()},getValue:function(){return this.$.value},getFirst:function(a){var d=this.$.firstChild;return(d=d&&new CKEDITOR.dom.node(d))&&a&&!a(d)&&(d=d.getNext(a)),d},getLast:function(a){var d=this.$.lastChild;return(d=d&&new CKEDITOR.dom.node(d))&&a&&!a(d)&&(d=d.getPrevious(a)),d},getStyle:function(a){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(a)]},is:function(){var a=this.getName();if("object"==typeof arguments[0])return!!arguments[0][a];for(var d=0;d<arguments.length;d++)if(arguments[d]==a)return!0;return!1},isEditable:function(a){var d=this.getName();return!(this.isReadOnly()||"none"==this.getComputedStyle("display")||"hidden"==this.getComputedStyle("visibility")||CKEDITOR.dtd.$nonEditable[d]||CKEDITOR.dtd.$empty[d]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount())&&(!1===a||!(!(a=CKEDITOR.dtd[d]||CKEDITOR.dtd.span)||!a["#"]))},isIdentical:function(a){var d=this.clone(0,1),a=a.clone(0,1);if(d.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),a.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),d.$.isEqualNode)return d.$.style.cssText=CKEDITOR.tools.normalizeCssText(d.$.style.cssText),a.$.style.cssText=CKEDITOR.tools.normalizeCssText(a.$.style.cssText),d.$.isEqualNode(a.$);if(d=d.getOuterHtml(),a=a.getOuterHtml(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&this.is("a")){var b=this.getParent();b.type==CKEDITOR.NODE_ELEMENT&&((b=b.clone()).setHtml(d),d=b.getHtml(),b.setHtml(a),a=b.getHtml())}return d==a},isVisible:function(){var d,b,a=(this.$.offsetHeight||this.$.offsetWidth)&&"hidden"!=this.getComputedStyle("visibility");return a&&CKEDITOR.env.webkit&&!(d=this.getWindow()).equals(CKEDITOR.document.getWindow())&&(b=d.$.frameElement)&&(a=new CKEDITOR.dom.element(b).isVisible()),!!a},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return!1;for(var a=this.getChildren(),d=0,b=a.count();d<b;d++){var c=a.getItem(d);if((c.type!=CKEDITOR.NODE_ELEMENT||!c.data("cke-bookmark"))&&(c.type==CKEDITOR.NODE_ELEMENT&&!c.isEmptyInlineRemoveable()||c.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(c.getText())))return!1}return!0},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(){for(var a=this.$.attributes,d=0;d<a.length;d++){var b=a[d];switch(b.nodeName){case"class":if(this.getAttribute("class"))return!0;case"data-cke-expando":continue;default:if(b.specified)return!0}}return!1}:function(){var a=this.$.attributes,d=a.length,b={"data-cke-expando":1,_moz_dirty:1};return d>0&&(d>2||!b[a[0].nodeName]||2==d&&!b[a[1].nodeName])},hasAttribute:function(){function a(d){var e=this.$.attributes.getNamedItem(d);if("input"==this.getName())switch(d){case"class":return this.$.className.length>0;case"checked":return!!this.$.checked;case"value":return"checkbox"==(d=this.getAttribute("type"))||"radio"==d?"on"!=this.$.value:!!this.$.value}return!!e&&e.specified}return CKEDITOR.env.ie?CKEDITOR.env.version<8?function(d){return"name"==d?!!this.$.name:a.call(this,d)}:a:function(a){return!!this.$.attributes.getNamedItem(a)}}(),hide:function(){this.setStyle("display","none")},moveChildren:function(a,d){var b=this.$;if(b!=(a=a.$)){var c;if(d)for(;c=b.lastChild;)a.insertBefore(b.removeChild(c),a.firstChild);else for(;c=b.firstChild;)a.appendChild(b.removeChild(c))}},mergeSiblings:function(){function a(d,b,e){if(b&&b.type==CKEDITOR.NODE_ELEMENT){for(var c=[];b.data("cke-bookmark")||b.isEmptyInlineRemoveable();)if(c.push(b),!(b=e?b.getNext():b.getPrevious())||b.type!=CKEDITOR.NODE_ELEMENT)return;if(d.isIdentical(b)){for(var f=e?d.getLast():d.getFirst();c.length;)c.shift().move(d,!e);b.moveChildren(d,!e),b.remove(),f&&f.type==CKEDITOR.NODE_ELEMENT&&f.mergeSiblings()}}}return function(d){(!1===d||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a"))&&(a(this,this.getNext(),!0),a(this,this.getPrevious()))}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var a=function(a,b){return this.$.setAttribute(a,b),this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(d,b){return"class"==d?this.$.className=b:"style"==d?this.$.style.cssText=b:"tabindex"==d?this.$.tabIndex=b:"checked"==d?this.$.checked=b:"contenteditable"==d?a.call(this,"contentEditable",b):a.apply(this,arguments),this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(d,b){if("src"==d&&b.match(/^http:\/\//))try{a.apply(this,arguments)}catch(c){}else a.apply(this,arguments);return this}:a}(),setAttributes:function(a){for(var d in a)this.setAttribute(d,a[d]);return this},setValue:function(a){return this.$.value=a,this},removeAttribute:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(a){"class"==a?a="className":"tabindex"==a?a="tabIndex":"contenteditable"==a&&(a="contentEditable"),this.$.removeAttribute(a)}:function(a){this.$.removeAttribute(a)},removeAttributes:function(a){if(CKEDITOR.tools.isArray(a))for(var b=0;b<a.length;b++)this.removeAttribute(a[b]);else for(b in a)a.hasOwnProperty(b)&&this.removeAttribute(b)},removeStyle:function(a){if((b=this.$.style).removeProperty||"border"!=a&&"margin"!=a&&"padding"!=a)b.removeProperty?b.removeProperty(a):b.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(a)),this.$.style.cssText||this.removeAttribute("style");else{var f,c=["top","left","right","bottom"];"border"==a&&(f=["color","style","width"]);for(var b=[],j=0;j<c.length;j++)if(f)for(var g=0;g<f.length;g++)b.push([a,c[j],f[g]].join("-"));else b.push([a,c[j]].join("-"));for(a=0;a<b.length;a++)this.removeStyle(b[a])}},setStyle:function(a,b){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(a)]=b,this},setStyles:function(a){for(var b in a)this.setStyle(b,a[b]);return this},setOpacity:function(a){CKEDITOR.env.ie&&CKEDITOR.env.version<9?(a=Math.round(100*a),this.setStyle("filter",a>=100?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+a+")")):this.setStyle("opacity",a)},unselectable:function(){if(this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","none")),CKEDITOR.env.ie){this.setAttribute("unselectable","on");for(var b=this.getElementsByTag("*"),c=0,f=b.count();c<f;c++)b.getItem(c).setAttribute("unselectable","on")}},getPositionedAncestor:function(){for(var a=this;"html"!=a.getName();){if("static"!=a.getComputedStyle("position"))return a;a=a.getParent()}return null},getDocumentPosition:function(a){var b=0,c=0,f=this.getDocument(),j=f.getBody(),g=CKEDITOR.env.quirks;if(document.documentElement.getBoundingClientRect){var m=this.$.getBoundingClientRect(),y=f.$.documentElement,s=y.clientTop||j.$.clientTop||0,w=y.clientLeft||j.$.clientLeft||0,q=!0;CKEDITOR.env.ie&&(q=f.getDocumentElement().contains(this),f=f.getBody().contains(this),q=g&&f||!g&&q),q&&(CKEDITOR.env.webkit?(b=j.$.scrollLeft||y.scrollLeft,c=j.$.scrollTop||y.scrollTop):(b=(c=g?j.$:y).scrollLeft,c=c.scrollTop),b=m.left+b-w,c=m.top+c-s)}else for(s=this,w=null;s&&"body"!=s.getName()&&"html"!=s.getName();){for(b+=s.$.offsetLeft-s.$.scrollLeft,c+=s.$.offsetTop-s.$.scrollTop,s.equals(this)||(b+=s.$.clientLeft||0,c+=s.$.clientTop||0);w&&!w.equals(s);)b-=w.$.scrollLeft,c-=w.$.scrollTop,w=w.getParent();w=s,s=(m=s.$.offsetParent)?new CKEDITOR.dom.element(m):null}return a&&(m=this.getWindow(),s=a.getWindow(),!m.equals(s)&&m.$.frameElement&&(b+=(a=new CKEDITOR.dom.element(m.$.frameElement).getDocumentPosition(a)).x,c+=a.y)),document.documentElement.getBoundingClientRect||!CKEDITOR.env.gecko||g||(b+=this.$.clientLeft?1:0,c+=this.$.clientTop?1:0),{x:b,y:c}},scrollIntoView:function(a){var b=this.getParent();if(b)do{if((b.$.clientWidth&&b.$.clientWidth<b.$.scrollWidth||b.$.clientHeight&&b.$.clientHeight<b.$.scrollHeight)&&!b.is("body")&&this.scrollIntoParent(b,a,1),b.is("html")){var c=b.getWindow();try{var f=c.$.frameElement;f&&(b=new CKEDITOR.dom.element(f))}catch(j){}}}while(b=b.getParent())},scrollIntoParent:function(a,b,c){function y(b,d){/body|html/.test(a.getName())?a.getWindow().$.scrollBy(b,d):(a.$.scrollLeft=a.$.scrollLeft+b,a.$.scrollTop=a.$.scrollTop+d)}function s(a,b){var d={x:0,y:0};if(!a.is(q?"body":"html")){var c=a.$.getBoundingClientRect();d.x=c.left,d.y=c.top}return(c=a.getWindow()).equals(b)||(c=s(CKEDITOR.dom.element.get(c.$.frameElement),b),d.x=d.x+c.x,d.y=d.y+c.y),d}function w(a,b){return parseInt(a.getComputedStyle("margin-"+b)||0,10)||0}var f,j,g,m;!a&&(a=this.getWindow());var q="BackCompat"==(g=a.getDocument()).$.compatMode;a instanceof CKEDITOR.dom.window&&(a=q?g.getBody():g.getDocumentElement()),j=s(this,g=a.getWindow());var t=s(a,g),i=this.$.offsetHeight;f=this.$.offsetWidth;var A=a.$.clientHeight,u=a.$.clientWidth;g=j.x-w(this,"left")-t.x||0,m=j.y-w(this,"top")-t.y||0,f=j.x+f+w(this,"right")-(t.x+u)||0,j=j.y+i+w(this,"bottom")-(t.y+A)||0,(m<0||j>0)&&y(0,!0===b?m:!1===b?j:m<0?m:j),c&&(g<0||f>0)&&y(g<0?g:f,0)},setState:function(a,b,c){switch(b=b||"cke",a){case CKEDITOR.TRISTATE_ON:this.addClass(b+"_on"),this.removeClass(b+"_off"),this.removeClass(b+"_disabled"),c&&this.setAttribute("aria-pressed",!0),c&&this.removeAttribute("aria-disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(b+"_disabled"),this.removeClass(b+"_off"),this.removeClass(b+"_on"),c&&this.setAttribute("aria-disabled",!0),c&&this.removeAttribute("aria-pressed");break;default:this.addClass(b+"_off"),this.removeClass(b+"_on"),this.removeClass(b+"_disabled"),c&&this.removeAttribute("aria-pressed"),c&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var a=this.$;try{a.contentWindow.document}catch(b){a.src=a.src}return a&&new CKEDITOR.dom.document(a.contentWindow.document)},copyAttributes:function(a,b){for(var c=this.$.attributes,b=b||{},f=0;f<c.length;f++){var m,j=c[f],g=j.nodeName.toLowerCase();g in b||("checked"==g&&(m=this.getAttribute(g))?a.setAttribute(g,m):CKEDITOR.env.ie&&!this.hasAttribute(g)||(null===(m=this.getAttribute(g))&&(m=j.nodeValue),a.setAttribute(g,m)))}""!==this.$.style.cssText&&(a.$.style.cssText=this.$.style.cssText)},renameNode:function(a){if(this.getName()!=a){var b=this.getDocument(),a=new CKEDITOR.dom.element(a,b);this.copyAttributes(a),this.moveChildren(a),this.getParent()&&this.$.parentNode.replaceChild(a.$,this.$),a.$["data-cke-expando"]=this.$["data-cke-expando"],this.$=a.$,delete this.getName}},getChild:function(){function a(b,c){var e=b.childNodes;if(c>=0&&c<e.length)return e[c]}return function(b){var c=this.$;if(b.slice)for(;b.length>0&&c;)c=a(c,b.shift());else c=a(c,b);return c?new CKEDITOR.dom.node(c):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){this.on("contextmenu",function(a){a.data.getTarget().hasClass("cke_enable_context_menu")||a.data.preventDefault()})},getDirection:function(a){return a?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(a,b){return a="data-"+a,void 0===b?this.getAttribute(a):(!1===b?this.removeAttribute(a):this.setAttribute(a,b),null)},getEditor:function(){var b,c,a=CKEDITOR.instances;for(b in a)if((c=a[b]).element.equals(this)&&c.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO)return c;return null},find:function(b){var c=a(this),b=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(f(this,b)));return c(),b},findOne:function(b){var c=a(this),b=this.$.querySelector(f(this,b));return c(),b?new CKEDITOR.dom.element(b):null},forEach:function(a,b,c){if(!(c||b&&this.type!=b))var f=a(this);if(!1!==f)for(var c=this.getChildren(),j=0;j<c.count();j++)(f=c.getItem(j)).type==CKEDITOR.NODE_ELEMENT?f.forEach(a,b):(!b||f.type==b)&&a(f)}});var c={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(a,c,f){"number"==typeof c&&(!f||CKEDITOR.env.ie&&CKEDITOR.env.quirks||(c-=b.call(this,a)),this.setStyle(a,c+"px"))},CKEDITOR.dom.element.prototype.getSize=function(a,c){var f=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(a)],this.$["client"+CKEDITOR.tools.capitalize(a)])||0;return c&&(f-=b.call(this,a)),f}}(),CKEDITOR.dom.documentFragment=function(a){a=a||CKEDITOR.document,this.$=a.type==CKEDITOR.NODE_DOCUMENT?a.$.createDocumentFragment():a},CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(a){(a=a.$).parentNode.insertBefore(this.$,a.nextSibling)}},!0,{append:1,appendBogus:1,getFirst:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1}),function(){function a(a,b){var c=this.range;if(this._.end)return null;if(!this._.start){if(this._.start=1,c.collapsed)return this.end(),null;c.optimize()}var d,e=c.startContainer;d=c.endContainer;var h,m=c.startOffset,f=c.endOffset,o=this.guard,l=this.type,p=a?"getPreviousSourceNode":"getNextSourceNode";if(!a&&!this._.guardLTR){var r=d.type==CKEDITOR.NODE_ELEMENT?d:d.getParent(),n=d.type==CKEDITOR.NODE_ELEMENT?d.getChild(f):d.getNext();this._.guardLTR=function(a,b){return!(b&&r.equals(a)||n&&a.equals(n)||a.type==CKEDITOR.NODE_ELEMENT&&b&&a.equals(c.root))}}if(a&&!this._.guardRTL){var g=e.type==CKEDITOR.NODE_ELEMENT?e:e.getParent(),C=e.type==CKEDITOR.NODE_ELEMENT?m?e.getChild(m-1):null:e.getPrevious();this._.guardRTL=function(a,b){return!(b&&g.equals(a)||C&&a.equals(C)||a.type==CKEDITOR.NODE_ELEMENT&&b&&a.equals(c.root))}}var j=a?this._.guardRTL:this._.guardLTR;for(h=o?function(a,b){return!1!==j(a,b)&&o(a,b)}:j,this.current?d=this.current[p](!1,l,h):(a?d.type==CKEDITOR.NODE_ELEMENT&&(d=f>0?d.getChild(f-1):!1===h(d,!0)?null:d.getPreviousSourceNode(!0,l,h)):(d=e).type!=CKEDITOR.NODE_ELEMENT||(d=d.getChild(m))||(d=!1===h(e,!0)?null:e.getNextSourceNode(!0,l,h)),d&&!1===h(d)&&(d=null));d&&!this._.end;){if(this.current=d,this.evaluator&&!1===this.evaluator(d)){if(b&&this.evaluator)return!1}else if(!b)return d;d=d[p](!1,l,h)}return this.end(),this.current=null}function f(b){for(var c,d=null;c=a.call(this,b);)d=c;return d}function b(a){if(g(a))return!1;if(a.type==CKEDITOR.NODE_TEXT)return!0;if(a.type==CKEDITOR.NODE_ELEMENT){if(a.is(CKEDITOR.dtd.$inline)||a.is("hr")||"false"==a.getAttribute("contenteditable"))return!0;var b;if((b=!CKEDITOR.env.needsBrFiller)&&(b=a.is(m)))a:{b=0;for(var c=a.getChildCount();b<c;++b)if(!g(a.getChild(b))){b=!1;break a}b=!0}if(b)return!0}return!1}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(a){this.range=a,this._={}},proto:{end:function(){this._.end=1},next:function(){return a.call(this)},previous:function(){return a.call(this,1)},checkForward:function(){return!1!==a.call(this,0,1)},checkBackward:function(){return!1!==a.call(this,1,1)},lastForward:function(){return f.call(this)},lastBackward:function(){return f.call(this,1)},reset:function(){delete this.current,this._={}}}});var c={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},e={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(a){return!("none"!=this.getComputedStyle("float")||this.getComputedStyle("position")in e||!c[this.getComputedStyle("display")])||!!(this.is(CKEDITOR.dtd.$block)||a&&this.is(a))},CKEDITOR.dom.walker.blockBoundary=function(a){return function(b){return!(b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary(a))}},CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})},CKEDITOR.dom.walker.bookmark=function(a,b){function c(a){return a&&a.getName&&"span"==a.getName()&&a.data("cke-bookmark")}return function(d){var e,m;return e=d&&d.type!=CKEDITOR.NODE_ELEMENT&&(m=d.getParent())&&c(m),e=a?e:e||c(d),!!(b^e)}},CKEDITOR.dom.walker.whitespaces=function(a){return function(b){var c;return b&&b.type==CKEDITOR.NODE_TEXT&&(c=!CKEDITOR.tools.trim(b.getText())||CKEDITOR.env.webkit&&""==b.getText()),!!(a^c)}},CKEDITOR.dom.walker.invisible=function(a){var b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.env.webkit?1:0;return function(d){return b(d)?d=1:(d.type==CKEDITOR.NODE_TEXT&&(d=d.getParent()),d=d.$.offsetWidth<=c),!!(a^d)}},CKEDITOR.dom.walker.nodeType=function(a,b){return function(c){return!!(b^c.type==a)}},CKEDITOR.dom.walker.bogus=function(a){function b(a){return!h(a)&&!k(a)}return function(c){var e=CKEDITOR.env.needsBrFiller?c.is&&c.is("br"):c.getText&&d.test(c.getText());return e&&(e=c.getParent(),c=c.getNext(b),e=e.isBlockBoundary()&&(!c||c.type==CKEDITOR.NODE_ELEMENT&&c.isBlockBoundary())),!!(a^e)}},CKEDITOR.dom.walker.temp=function(a){return function(b){return b.type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent()),b=b&&b.hasAttribute("data-cke-temp"),!!(a^b)}};var d=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,h=CKEDITOR.dom.walker.whitespaces(),k=CKEDITOR.dom.walker.bookmark(),j=CKEDITOR.dom.walker.temp();CKEDITOR.dom.walker.ignored=function(a){return function(b){return b=h(b)||k(b)||j(b),!!(a^b)}};var g=CKEDITOR.dom.walker.ignored(),m=function(a){var c,b={};for(c in a)CKEDITOR.dtd[c]["#"]&&(b[c]=1);return b}(CKEDITOR.dtd.$block);CKEDITOR.dom.walker.editable=function(a){return function(c){return!!(a^b(c))}},CKEDITOR.dom.element.prototype.getBogus=function(){var a=this;do{a=a.getPreviousSourceNode()}while(k(a)||h(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.is(CKEDITOR.dtd.$inline)&&!a.is(CKEDITOR.dtd.$empty));return!(!a||!(CKEDITOR.env.needsBrFiller?a.is&&a.is("br"):a.getText&&d.test(a.getText())))&&a}}(),CKEDITOR.dom.range=function(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null,this.collapsed=!0;var f=a instanceof CKEDITOR.dom.document;this.document=f?a:a.getDocument(),this.root=f?a.getBody():a},function(){function a(){var a=!1,b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(!0),e=CKEDITOR.dom.walker.bogus();return function(f){return!(!c(f)&&!b(f))||(e(f)&&!a?a=!0:!(f.type==CKEDITOR.NODE_TEXT&&(f.hasAscendant("pre")||CKEDITOR.tools.trim(f.getText()).length)||f.type==CKEDITOR.NODE_ELEMENT&&!f.is(d)))}}function f(a){var b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(1);return function(d){return!(!c(d)&&!b(d))||(!a&&h(d)||d.type==CKEDITOR.NODE_ELEMENT&&d.is(CKEDITOR.dtd.$removeEmpty))}}function b(a){return function(){var b;return this[a?"getPreviousNode":"getNextNode"](function(a){return!b&&g(a)&&(b=a),j(a)&&!(h(a)&&a.equals(b))})}}var c=function(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer.equals(a.endContainer)&&a.startOffset==a.endOffset},e=function(a,b,c,d){a.optimizeBookmark();var h,o,e=a.startContainer,f=a.endContainer,i=a.startOffset,A=a.endOffset;f.type==CKEDITOR.NODE_TEXT?f=f.split(A):f.getChildCount()>0&&(A>=f.getChildCount()?(f=f.append(a.document.createText("")),o=!0):f=f.getChild(A)),e.type==CKEDITOR.NODE_TEXT?(e.split(i),e.equals(f)&&(f=e.getNext())):i?i>=e.getChildCount()?(e=e.append(a.document.createText("")),h=!0):e=e.getChild(i).getPrevious():(e=e.append(a.document.createText(""),1),h=!0);var l,p,r,i=e.getParents(),A=f.getParents();for(l=0;l<i.length&&(p=i[l],r=A[l],p.equals(r));l++);for(var g,C,j,n=c,F=l;F<i.length;F++){for(g=i[F],n&&!g.equals(e)&&(C=n.append(g.clone())),g=g.getNext();g&&(!g.equals(A[F])&&!g.equals(f));)j=g.getNext(),2==b?n.append(g.clone(!0)):(g.remove(),1==b&&n.append(g)),g=j;n&&(n=C)}for(n=c,c=l;c<A.length;c++){if(g=A[c],b>0&&!g.equals(f)&&(C=n.append(g.clone())),!i[c]||g.$.parentNode!=i[c].$.parentNode)for(g=g.getPrevious();g&&(!g.equals(i[c])&&!g.equals(e));)j=g.getPrevious(),2==b?n.$.insertBefore(g.$.cloneNode(!0),n.$.firstChild):(g.remove(),1==b&&n.$.insertBefore(g.$,n.$.firstChild)),g=j;n&&(n=C)}2==b?((p=a.startContainer).type==CKEDITOR.NODE_TEXT&&(p.$.data=p.$.data+p.$.nextSibling.data,p.$.parentNode.removeChild(p.$.nextSibling)),(a=a.endContainer).type==CKEDITOR.NODE_TEXT&&a.$.nextSibling&&(a.$.data=a.$.data+a.$.nextSibling.data,a.$.parentNode.removeChild(a.$.nextSibling))):(p&&r&&(e.$.parentNode!=p.$.parentNode||f.$.parentNode!=r.$.parentNode)&&(b=r.getIndex(),h&&r.$.parentNode==e.$.parentNode&&b--,d&&p.type==CKEDITOR.NODE_ELEMENT?((d=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',a.document)).insertAfter(p),p.mergeSiblings(!1),a.moveToBookmark({startNode:d})):a.setStart(r.getParent(),b)),a.collapse(!0)),h&&e.remove(),o&&f.$.parentNode&&f.remove()},d={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1},h=CKEDITOR.dom.walker.bogus(),k=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,j=CKEDITOR.dom.walker.editable(),g=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var a=new CKEDITOR.dom.range(this.root);return a._setStartContainer(this.startContainer),a.startOffset=this.startOffset,a._setEndContainer(this.endContainer),a.endOffset=this.endOffset,a.collapsed=this.collapsed,a},collapse:function(a){a?(this._setEndContainer(this.startContainer),this.endOffset=this.startOffset):(this._setStartContainer(this.endContainer),this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(){var a=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||e(this,2,a),a},deleteContents:function(a){this.collapsed||e(this,0,null,a)},extractContents:function(a){var b=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||e(this,1,b,a),b},createBookmark:function(a){var b,c,d,e,f=this.collapsed;return(b=this.document.createElement("span")).data("cke-bookmark",1),b.setStyle("display","none"),b.setHtml("&nbsp;"),a&&(d="cke_bm_"+CKEDITOR.tools.getNextNumber(),b.setAttribute("id",d+(f?"C":"S"))),f||((c=b.clone()).setHtml("&nbsp;"),a&&c.setAttribute("id",d+"E"),(e=this.clone()).collapse(),e.insertNode(c)),(e=this.clone()).collapse(!0),e.insertNode(b),c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,CKEDITOR.POSITION_AFTER_END),{startNode:a?d+(f?"C":"S"):b,endNode:a?d+"E":c,serializable:a,collapsed:f}},createBookmark2:function(){function a(c){var f,d=c.container,e=c.offset,m=e;if((f=(f=d).type!=CKEDITOR.NODE_ELEMENT||0===m||m==f.getChildCount()?0:f.getChild(m-1).type==CKEDITOR.NODE_TEXT&&f.getChild(m).type==CKEDITOR.NODE_TEXT)&&(e=(d=d.getChild(e-1)).getLength()),d.type==CKEDITOR.NODE_ELEMENT&&e>1&&(e=d.getChild(e-1).getIndex(!0)+1),d.type==CKEDITOR.NODE_TEXT){for(f=d,m=0;(f=f.getPrevious())&&f.type==CKEDITOR.NODE_TEXT;)m+=f.getLength();f=m,d.getText()?e+=f:(m=d.getPrevious(b),f?(e=f,d=m?m.getNext():d.getParent().getFirst()):(d=d.getParent(),e=m?m.getIndex(!0)+1:0))}c.container=d,c.offset=e}var b=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,!0);return function(b){var c=this.collapsed,d={container:this.startContainer,offset:this.startOffset},e={container:this.endContainer,offset:this.endOffset};return b&&(a(d),c||a(e)),{start:d.container.getAddress(b),end:c?null:e.container.getAddress(b),startOffset:d.offset,endOffset:e.offset,normalized:b,collapsed:c,is2:!0}}}(),moveToBookmark:function(a){if(a.is2){var b=this.document.getByAddress(a.start,a.normalized),c=a.startOffset,d=a.end&&this.document.getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,c),d?this.setEnd(d,a):this.collapse(!0)}else b=(c=a.serializable)?this.document.getById(a.startNode):a.startNode,a=c?this.document.getById(a.endNode):a.endNode,this.setStartBefore(b),b.remove(),a?(this.setEndBefore(a),a.remove()):this.collapse(!0)},getBoundaryNodes:function(){var e,a=this.startContainer,b=this.endContainer,c=this.startOffset,d=this.endOffset;if(a.type==CKEDITOR.NODE_ELEMENT)if((e=a.getChildCount())>c)a=a.getChild(c);else if(e<1)a=a.getPreviousSourceNode();else{for(a=a.$;a.lastChild;)a=a.lastChild;a=(a=new CKEDITOR.dom.node(a)).getNextSourceNode()||a}if(b.type==CKEDITOR.NODE_ELEMENT)if((e=b.getChildCount())>d)b=b.getChild(d).getPreviousSourceNode(!0);else if(e<1)b=b.getPreviousSourceNode();else{for(b=b.$;b.lastChild;)b=b.lastChild;b=new CKEDITOR.dom.node(b)}return a.getPosition(b)&CKEDITOR.POSITION_FOLLOWING&&(a=b),{startNode:a,endNode:b}},getCommonAncestor:function(a,b){var c=this.startContainer,d=this.endContainer,c=c.equals(d)?a&&c.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?c.getChild(this.startOffset):c:c.getCommonAncestor(d);return b&&!c.is?c.getParent():c},optimize:function(){var a=this.startContainer,b=this.startOffset;a.type!=CKEDITOR.NODE_ELEMENT&&(b?b>=a.getLength()&&this.setStartAfter(a):this.setStartBefore(a)),a=this.endContainer,b=this.endOffset,a.type!=CKEDITOR.NODE_ELEMENT&&(b?b>=a.getLength()&&this.setEndAfter(a):this.setEndBefore(a))},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a.is&&a.is("span")&&a.data("cke-bookmark")&&this.setStartAt(a,CKEDITOR.POSITION_BEFORE_START),b&&b.is&&b.is("span")&&b.data("cke-bookmark")&&this.setEndAt(b,CKEDITOR.POSITION_AFTER_END)},trim:function(a,b){var c=this.startContainer,d=this.startOffset,e=this.collapsed;if((!a||e)&&c&&c.type==CKEDITOR.NODE_TEXT){if(d)if(d>=c.getLength())d=c.getIndex()+1,c=c.getParent();else{var f=c.split(d),d=c.getIndex()+1,c=c.getParent();this.startContainer.equals(this.endContainer)?this.setEnd(f,this.endOffset-this.startOffset):c.equals(this.endContainer)&&(this.endOffset=this.endOffset+1)}else d=c.getIndex(),c=c.getParent();if(this.setStart(c,d),e)return void this.collapse(!0)}c=this.endContainer,d=this.endOffset,b||e||!c||c.type!=CKEDITOR.NODE_TEXT||(d?(d>=c.getLength()||c.split(d),d=c.getIndex()+1):d=c.getIndex(),c=c.getParent(),this.setEnd(c,d))},enlarge:function(a,b){function c(a){return a&&a.type==CKEDITOR.NODE_ELEMENT&&a.hasAttribute("contenteditable")?null:a}var d=RegExp(/[^\s\ufeff]/);switch(a){case CKEDITOR.ENLARGE_INLINE:e=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var h,g,o,l,p,n,j,f=this.getCommonAncestor(),i=this.root,r=!1;n=this.startContainer;C=this.startOffset;for(n.type==CKEDITOR.NODE_TEXT?(C&&(r=!!(n=!CKEDITOR.tools.trim(n.substring(0,C)).length&&n)),n&&!(l=n.getPrevious())&&(o=n.getParent())):(C&&(l=n.getChild(C-1)||n.getLast()),l||(o=n)),o=c(o);o||l;){if(o&&!l){if(!p&&o.equals(f)&&(p=!0),e?o.isBlockBoundary():!i.contains(o))break;r&&"inline"==o.getComputedStyle("display")||(r=!1,p?h=o:this.setStartBefore(o)),l=o.getPrevious()}for(;l;)if(n=!1,l.type==CKEDITOR.NODE_COMMENT)l=l.getPrevious();else{if(l.type==CKEDITOR.NODE_TEXT)j=l.getText(),d.test(j)&&(l=null),n=/[\s\ufeff]$/.test(j);else if((l.$.offsetWidth>(CKEDITOR.env.webkit?1:0)||b&&l.is("br"))&&!l.data("cke-bookmark"))if(r&&CKEDITOR.dtd.$removeEmpty[l.getName()]){if(j=l.getText(),d.test(j))l=null;else for(var F,C=l.$.getElementsByTagName("*"),k=0;F=C[k++];)if(!CKEDITOR.dtd.$removeEmpty[F.nodeName.toLowerCase()]){l=null;break}l&&(n=!!j.length)}else l=null;if(n&&(r?p?h=o:o&&this.setStartBefore(o):r=!0),l){if(n=l.getPrevious(),!o&&!n){o=l,l=null;break}l=n}else o=null}o&&(o=c(o.getParent()))}n=this.endContainer,C=this.endOffset,o=l=null,p=r=!1;var K=function(a,b){var c=new CKEDITOR.dom.range(i);c.setStart(a,b),c.setEndAt(i,CKEDITOR.POSITION_BEFORE_END);var e;for((c=new CKEDITOR.dom.walker(c)).guard=function(a){return!(a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary())};e=c.next();){if(e.type!=CKEDITOR.NODE_TEXT)return!1;if(j=e!=a?e.getText():e.substring(b),d.test(j))return!1}return!0};for(n.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(n.substring(C)).length?r=!0:(r=!n.getLength(),C==n.getLength()?(l=n.getNext())||(o=n.getParent()):K(n,C)&&(o=n.getParent())):(l=n.getChild(C))||(o=n);o||l;){if(o&&!l){if(!p&&o.equals(f)&&(p=!0),e?o.isBlockBoundary():!i.contains(o))break;r&&"inline"==o.getComputedStyle("display")||(r=!1,p?g=o:o&&this.setEndAfter(o)),l=o.getNext()}for(;l;){if(n=!1,l.type==CKEDITOR.NODE_TEXT)j=l.getText(),K(l,0)||(l=null),n=/^[\s\ufeff]/.test(j);else if(l.type==CKEDITOR.NODE_ELEMENT){if((l.$.offsetWidth>0||b&&l.is("br"))&&!l.data("cke-bookmark"))if(r&&CKEDITOR.dtd.$removeEmpty[l.getName()]){if(j=l.getText(),d.test(j))l=null;else for(C=l.$.getElementsByTagName("*"),k=0;F=C[k++];)if(!CKEDITOR.dtd.$removeEmpty[F.nodeName.toLowerCase()]){l=null;break}l&&(n=!!j.length)}else l=null}else n=1;if(n&&r&&(p?g=o:this.setEndAfter(o)),l){if(n=l.getNext(),!o&&!n){o=l,l=null;break}l=n}else o=null}o&&(o=c(o.getParent()))}h&&g&&(f=h.contains(g)?g:h,this.setStartBefore(f),this.setEndAfter(f));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:o=new CKEDITOR.dom.range(this.root),i=this.root,o.setStartAt(i,CKEDITOR.POSITION_AFTER_START),o.setEnd(this.startContainer,this.startOffset),o=new CKEDITOR.dom.walker(o);var I,v,G=CKEDITOR.dom.walker.blockBoundary(a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),z=null,B=function(a){if(a.type==CKEDITOR.NODE_ELEMENT&&"false"==a.getAttribute("contenteditable"))if(z){if(z.equals(a))return void(z=null)}else z=a;else if(z)return;var b=G(a);return b||(I=a),b},e=function(a){var b=B(a);return!b&&a.is&&a.is("br")&&(v=a),b};if(o.guard=B,o=o.lastBackward(),I=I||i,this.setStartAt(I,!I.is("br")&&(!o&&this.checkStartOfBlock()||o&&I.contains(o))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END),a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){o=this.clone(),o=new CKEDITOR.dom.walker(o);var x=CKEDITOR.dom.walker.whitespaces(),E=CKEDITOR.dom.walker.bookmark();if(o.evaluator=function(a){return!x(a)&&!E(a)},(o=o.previous())&&o.type==CKEDITOR.NODE_ELEMENT&&o.is("br"))break}(o=this.clone()).collapse(),o.setEndAt(i,CKEDITOR.POSITION_BEFORE_END),(o=new CKEDITOR.dom.walker(o)).guard=a==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?e:B,I=z=v=null,o=o.lastForward(),I=I||i,this.setEndAt(I,!o&&this.checkEndOfBlock()||o&&I.contains(o)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),v&&this.setEndAfter(v)}},shrink:function(a,b,c){if(!this.collapsed){var a=a||CKEDITOR.SHRINK_TEXT,d=this.clone(),e=this.startContainer,f=this.endContainer,i=this.startOffset,h=this.endOffset,g=1,o=1;e&&e.type==CKEDITOR.NODE_TEXT&&(i?i>=e.getLength()?d.setStartAfter(e):(d.setStartBefore(e),g=0):d.setStartBefore(e)),f&&f.type==CKEDITOR.NODE_TEXT&&(h?h>=f.getLength()?d.setEndAfter(f):(d.setEndAfter(f),o=0):d.setEndBefore(f));var d=new CKEDITOR.dom.walker(d),l=CKEDITOR.dom.walker.bookmark();d.evaluator=function(b){return b.type==(a==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var p;return d.guard=function(b,d){return!!l(b)||!(a==CKEDITOR.SHRINK_ELEMENT&&b.type==CKEDITOR.NODE_TEXT||d&&b.equals(p)||!1===c&&b.type==CKEDITOR.NODE_ELEMENT&&b.isBlockBoundary()||b.type==CKEDITOR.NODE_ELEMENT&&b.hasAttribute("contenteditable"))&&(!d&&b.type==CKEDITOR.NODE_ELEMENT&&(p=b),!0)},g&&(e=d[a==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(e,b?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START),o&&(d.reset(),(d=d[a==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(d,b?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)),!(!g&&!o)}},insertNode:function(a){this.optimizeBookmark(),this.trim(!1,!0);var b=this.startContainer,c=b.getChild(this.startOffset);c?a.insertBefore(c):b.append(a),a.getParent()&&a.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(a)},moveToPosition:function(a,b){this.setStartAt(a,b),this.collapse(!0)},moveToRange:function(a){this.setStart(a.startContainer,a.startOffset),this.setEnd(a.endContainer,a.endOffset)},selectNodeContents:function(a){this.setStart(a,0),this.setEnd(a,a.type==CKEDITOR.NODE_TEXT?a.getLength():a.getChildCount())},setStart:function(a,b){a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]&&(b=a.getIndex(),a=a.getParent()),this._setStartContainer(a),this.startOffset=b,this.endContainer||(this._setEndContainer(a),this.endOffset=b),c(this)},setEnd:function(a,b){a.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[a.getName()]&&(b=a.getIndex()+1,a=a.getParent()),this._setEndContainer(a),this.endOffset=b,this.startContainer||(this._setStartContainer(a),this.startOffset=b),c(this)},setStartAfter:function(a){this.setStart(a.getParent(),a.getIndex()+1)},setStartBefore:function(a){this.setStart(a.getParent(),a.getIndex())},setEndAfter:function(a){this.setEnd(a.getParent(),a.getIndex()+1)},setEndBefore:function(a){this.setEnd(a.getParent(),a.getIndex())},setStartAt:function(a,b){switch(b){case CKEDITOR.POSITION_AFTER_START:this.setStart(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setStart(a,a.getLength()):this.setStart(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(a)}c(this)},setEndAt:function(a,b){switch(b){case CKEDITOR.POSITION_AFTER_START:this.setEnd(a,0);break;case CKEDITOR.POSITION_BEFORE_END:a.type==CKEDITOR.NODE_TEXT?this.setEnd(a,a.getLength()):this.setEnd(a,a.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(a);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(a)}c(this)},fixBlock:function(a,b){var c=this.createBookmark(),d=this.document.createElement(b);return this.collapse(a),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(d),d.trim(),d.appendBogus(),this.insertNode(d),this.moveToBookmark(c),d},splitBlock:function(a){var b=new CKEDITOR.dom.elementPath(this.startContainer,this.root),c=new CKEDITOR.dom.elementPath(this.endContainer,this.root),d=b.block,e=c.block,f=null;return b.blockLimit.equals(c.blockLimit)?("br"!=a&&(d||(d=this.fixBlock(!0,a),e=new CKEDITOR.dom.elementPath(this.endContainer,this.root).block),e||(e=this.fixBlock(!1,a))),a=d&&this.checkStartOfBlock(),b=e&&this.checkEndOfBlock(),this.deleteContents(),d&&d.equals(e)&&(b?(f=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),e=null):a?(f=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(d,CKEDITOR.POSITION_BEFORE_START),d=null):(e=this.splitElement(d),d.is("ul","ol")||d.appendBogus())),{previousBlock:d,nextBlock:e,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:f}):null},splitElement:function(a){if(!this.collapsed)return null;this.setEndAt(a,CKEDITOR.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(!1);return b.appendTo(c),c.insertAfter(a),this.moveToPosition(a,CKEDITOR.POSITION_AFTER_END),c},removeEmptyBlocksAtEnd:function(){function a(d){return function(a){return!(b(a)||c(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.isEmptyInlineRemoveable()||d.is("table")&&a.is("caption"))}}var b=CKEDITOR.dom.walker.whitespaces(),c=CKEDITOR.dom.walker.bookmark(!1);return function(b){for(var f,c=this.createBookmark(),d=this[b?"endPath":"startPath"](),e=d.block||d.blockLimit;e&&!e.equals(d.root)&&!e.getFirst(a(e));)f=e.getParent(),this[b?"setEndAt":"setStartAt"](e,CKEDITOR.POSITION_AFTER_END),e.remove(1),e=f;this.moveToBookmark(c)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(a,b){var c=b==CKEDITOR.START,d=this.clone();return d.collapse(c),d[c?"setStartAt":"setEndAt"](a,c?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),d=new CKEDITOR.dom.walker(d),d.evaluator=f(c),d[c?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var b=this.startContainer,c=this.startOffset;return CKEDITOR.env.ie&&c&&b.type==CKEDITOR.NODE_TEXT&&(b=CKEDITOR.tools.ltrim(b.substring(0,c)),k.test(b)&&this.trim(0,1)),this.trim(),b=new CKEDITOR.dom.elementPath(this.startContainer,this.root),(c=this.clone()).collapse(!0),c.setStartAt(b.block||b.blockLimit,CKEDITOR.POSITION_AFTER_START),b=new CKEDITOR.dom.walker(c),b.evaluator=a(),b.checkBackward()},checkEndOfBlock:function(){var b=this.endContainer,c=this.endOffset;return CKEDITOR.env.ie&&b.type==CKEDITOR.NODE_TEXT&&(b=CKEDITOR.tools.rtrim(b.substring(c)),k.test(b)&&this.trim(1,0)),this.trim(),b=new CKEDITOR.dom.elementPath(this.endContainer,this.root),(c=this.clone()).collapse(!1),c.setEndAt(b.block||b.blockLimit,CKEDITOR.POSITION_BEFORE_END),b=new CKEDITOR.dom.walker(c),b.evaluator=a(),b.checkForward()},getPreviousNode:function(a,b,c){var d=this.clone();return d.collapse(1),d.setStartAt(c||this.root,CKEDITOR.POSITION_AFTER_START),c=new CKEDITOR.dom.walker(d),c.evaluator=a,c.guard=b,c.previous()},getNextNode:function(a,b,c){var d=this.clone();return d.collapse(),d.setEndAt(c||this.root,CKEDITOR.POSITION_BEFORE_END),c=new CKEDITOR.dom.walker(d),c.evaluator=a,c.guard=b,c.next()},checkReadOnly:function(){function a(b,c){for(;b;){if(b.type==CKEDITOR.NODE_ELEMENT){if("false"==b.getAttribute("contentEditable")&&!b.data("cke-editable"))return 0;if(b.is("html")||"true"==b.getAttribute("contentEditable")&&(b.contains(c)||b.equals(c)))break}b=b.getParent()}return 1}return function(){var b=this.startContainer,c=this.endContainer;return!(a(b,c)&&a(c,b))}}(),moveToElementEditablePosition:function(a,b){if(a.type==CKEDITOR.NODE_ELEMENT&&!a.isEditable(!1))return this.moveToPosition(a,b?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;for(var c=0;a;){if(a.type==CKEDITOR.NODE_TEXT){b&&this.endContainer&&this.checkEndOfBlock()&&k.test(a.getText())?this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(a,b?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),c=1;break}if(a.type==CKEDITOR.NODE_ELEMENT)if(a.isEditable())this.moveToPosition(a,b?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),c=1;else if(b&&a.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START);else if("false"==a.getAttribute("contenteditable")&&a.is(CKEDITOR.dtd.$block))return this.setStartBefore(a),this.setEndAfter(a),!0;var d=a,e=c,f=void 0;d.type==CKEDITOR.NODE_ELEMENT&&d.isEditable(!1)&&(f=d[b?"getLast":"getFirst"](g)),!e&&!f&&(f=d[b?"getPrevious":"getNext"](g)),a=f}return!!c},moveToClosestEditablePosition:function(a,b){var e,c=new CKEDITOR.dom.range(this.root),d=0,f=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];return c.moveToPosition(a,f[b?0:1]),a.is(CKEDITOR.dtd.$block)?(e=c[b?"getNextEditableNode":"getPreviousEditableNode"]())&&(d=1,e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$block)&&"false"==e.getAttribute("contenteditable")?(c.setStartAt(e,CKEDITOR.POSITION_BEFORE_START),c.setEndAt(e,CKEDITOR.POSITION_AFTER_END)):c.moveToPosition(e,f[b?1:0])):d=1,d&&this.moveToRange(c),!!d},moveToElementEditStart:function(a){return this.moveToElementEditablePosition(a)},moveToElementEditEnd:function(a){return this.moveToElementEditablePosition(a,!0)},getEnclosedNode:function(){if((a=this.clone()).optimize(),a.startContainer.type!=CKEDITOR.NODE_ELEMENT||a.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var a=new CKEDITOR.dom.walker(a),b=CKEDITOR.dom.walker.bookmark(!1,!0),c=CKEDITOR.dom.walker.whitespaces(!0);a.evaluator=function(a){return c(a)&&b(a)};var d=a.next();return a.reset(),d&&d.equals(a.previous())?d:null},getTouchedStartNode:function(){var a=this.startContainer;return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.startOffset)||a},getTouchedEndNode:function(){var a=this.endContainer;return this.collapsed||a.type!=CKEDITOR.NODE_ELEMENT?a:a.getChild(this.endOffset-1)||a},getNextEditableNode:b(),getPreviousEditableNode:b(1),scrollIntoView:function(){var b,c,d,a=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),e=this.clone();e.optimize(),(d=e.startContainer.type==CKEDITOR.NODE_TEXT)?(c=e.startContainer.getText(),b=e.startContainer.split(e.startOffset),a.insertAfter(e.startContainer)):e.insertNode(a),a.scrollIntoView(),d&&(e.startContainer.setText(c),b.remove()),a.remove()},_setStartContainer:function(a){this.startContainer=a},_setEndContainer:function(a){this.endContainer=a}}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.ENLARGE_INLINE=4,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.SHRINK_ELEMENT=1,CKEDITOR.SHRINK_TEXT=2,function(){function a(a){arguments.length<1||(this.range=a,this.forceBrBreak=0,this.enlargeBr=1,this.enforceRealBlocks=0,this._||(this._={}))}function f(a){var b=[];return a.forEach(function(a){if("true"==a.getAttribute("contenteditable"))return b.push(a),!1},CKEDITOR.NODE_ELEMENT,!0),b}function b(a,c,d,e){a:{null==e&&(e=f(d));for(var h;h=e.shift();)if(h.getDtd().p){e={element:h,remaining:e};break a}e=null}return e?(h=CKEDITOR.filter.instances[e.element.data("cke-filter")])&&!h.check(c)?b(a,c,d,e.remaining):((c=new CKEDITOR.dom.range(e.element)).selectNodeContents(e.element),c=c.createIterator(),c.enlargeBr=a.enlargeBr,c.enforceRealBlocks=a.enforceRealBlocks,c.activeFilter=c.filter=h,a._.nestedEditable={element:e.element,container:d,remaining:e.remaining,iterator:c},1):0}function c(a,b,c){return!!b&&((a=a.clone()).collapse(!c),a.checkBoundaryOfElement(b,c?CKEDITOR.START:CKEDITOR.END))}var e=/^[\r\n\t ]+$/,d=CKEDITOR.dom.walker.bookmark(!1,!0),h=CKEDITOR.dom.walker.whitespaces(!0),k=function(a){return d(a)&&h(a)},j={dd:1,dt:1,li:1};a.prototype={getNextParagraph:function(a){var f,h,s,w,q,a=a||"p";if(this._.nestedEditable){if(f=this._.nestedEditable.iterator.getNextParagraph(a))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,f;if(this.activeFilter=this.filter,b(this,a,this._.nestedEditable.container,this._.nestedEditable.remaining))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,this._.nestedEditable.iterator.getNextParagraph(a);this._.nestedEditable=null}if(!this.range.root.getDtd()[a])return null;if(!this._.started){var t=this.range.clone();h=t.startPath();var i=t.endPath(),A=!t.collapsed&&c(t,h.block),u=!t.collapsed&&c(t,i.block,1);t.shrink(CKEDITOR.SHRINK_ELEMENT,!0),A&&t.setStartAt(h.block,CKEDITOR.POSITION_BEFORE_END),u&&t.setEndAt(i.block,CKEDITOR.POSITION_AFTER_START),h=t.endContainer.hasAscendant("pre",!0)||t.startContainer.hasAscendant("pre",!0),t.enlarge(this.forceBrBreak&&!h||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),t.collapsed||(h=new CKEDITOR.dom.walker(t.clone()),i=CKEDITOR.dom.walker.bookmark(!0,!0),h.evaluator=i,this._.nextNode=h.next(),(h=new CKEDITOR.dom.walker(t.clone())).evaluator=i,h=h.previous(),this._.lastNode=h.getNextSourceNode(!0,null,t.root),this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()&&((i=this.range.clone()).moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END),i.checkEndOfBlock()&&(i=new CKEDITOR.dom.elementPath(i.endContainer,i.root),this._.lastNode=(i.block||i.blockLimit).getNextSourceNode(!0))),this._.lastNode&&t.root.contains(this._.lastNode)||(this._.lastNode=this._.docEndMarker=t.document.createText(""),this._.lastNode.insertAfter(h)),t=null),this._.started=1,h=t}for(i=this._.nextNode,t=this._.lastNode,this._.nextNode=null;i;){var A=0,u=i.hasAscendant("pre"),o=i.type!=CKEDITOR.NODE_ELEMENT,l=0;if(o)i.type==CKEDITOR.NODE_TEXT&&e.test(i.getText())&&(o=0);else{var p=i.getName();if(CKEDITOR.dtd.$block[p]&&"false"==i.getAttribute("contenteditable")){b(this,a,f=i);break}if(i.isBlockBoundary(this.forceBrBreak&&!u&&{br:1})){if("br"==p)o=1;else if(!h&&!i.getChildCount()&&"hr"!=p){f=i,s=i.equals(t);break}h&&(h.setEndAt(i,CKEDITOR.POSITION_BEFORE_START),"br"!=p&&(this._.nextNode=i)),A=1}else{if(i.getFirst()){h||(h=this.range.clone()).setStartAt(i,CKEDITOR.POSITION_BEFORE_START),i=i.getFirst();continue}o=1}}if(o&&!h&&(h=this.range.clone()).setStartAt(i,CKEDITOR.POSITION_BEFORE_START),s=(!A||o)&&i.equals(t),h&&!A)for(;!i.getNext(k)&&!s;){if((p=i.getParent()).isBlockBoundary(this.forceBrBreak&&!u&&{br:1})){A=1,o=0,s||p.equals(t),h.setEndAt(p,CKEDITOR.POSITION_BEFORE_END);break}o=1,s=(i=p).equals(t),l=1}if(o&&h.setEndAt(i,CKEDITOR.POSITION_AFTER_END),i=this._getNextSourceNode(i,l,t),(s=!i)||A&&h)break}if(!f){if(!h)return this._.docEndMarker&&this._.docEndMarker.remove(),this._.nextNode=null;i=(f=new CKEDITOR.dom.elementPath(h.startContainer,h.root)).blockLimit,A={div:1,th:1,td:1},!(f=f.block)&&i&&!this.enforceRealBlocks&&A[i.getName()]&&h.checkStartOfBlock()&&h.checkEndOfBlock()&&!i.equals(h.root)?f=i:!f||this.enforceRealBlocks&&f.is(j)?(f=this.range.document.createElement(a),h.extractContents().appendTo(f),f.trim(),h.insertNode(f),w=q=!0):"li"!=f.getName()?h.checkStartOfBlock()&&h.checkEndOfBlock()||(f=f.clone(!1),h.extractContents().appendTo(f),f.trim(),w=!(q=h.splitBlock()).wasStartOfBlock,q=!q.wasEndOfBlock,h.insertNode(f)):s||(this._.nextNode=f.equals(t)?null:this._getNextSourceNode(h.getBoundaryNodes().endNode,1,t))}return w&&(w=f.getPrevious())&&w.type==CKEDITOR.NODE_ELEMENT&&("br"==w.getName()?w.remove():w.getLast()&&"br"==w.getLast().$.nodeName.toLowerCase()&&w.getLast().remove()),q&&(w=f.getLast())&&w.type==CKEDITOR.NODE_ELEMENT&&"br"==w.getName()&&(!CKEDITOR.env.needsBrFiller||w.getPrevious(d)||w.getNext(d))&&w.remove(),this._.nextNode||(this._.nextNode=s||f.equals(t)||!t?null:this._getNextSourceNode(f,1,t)),f},_getNextSourceNode:function(a,b,c){function e(a){return!(a.equals(c)||a.equals(f))}for(var f=this.range.root,a=a.getNextSourceNode(b,null,e);!d(a);)a=a.getNextSourceNode(b,null,e);return a}},CKEDITOR.dom.range.prototype.createIterator=function(){return new a(this)}}(),CKEDITOR.command=function(a,f){this.uiItems=[],this.exec=function(b){return!(this.state==CKEDITOR.TRISTATE_DISABLED||!this.checkAllowed())&&(this.editorFocus&&a.focus(),!1===this.fire("exec")||!1!==f.exec.call(this,a,b))},this.refresh=function(a,b){return!(this.readOnly||!a.readOnly)||(this.context&&!b.isContextFor(this.context)?(this.disable(),!0):this.checkAllowed(!0)?(this.startDisabled||this.enable(),this.modes&&!this.modes[a.mode]&&this.disable(),!1===this.fire("refresh",{editor:a,path:b})||f.refresh&&!1!==f.refresh.apply(this,arguments)):(this.disable(),!0))};var b;this.checkAllowed=function(c){return c||"boolean"!=typeof b?b=a.activeFilter.checkFeature(this):b},CKEDITOR.tools.extend(this,f,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!f.context,state:CKEDITOR.TRISTATE_DISABLED}),CKEDITOR.event.call(this)},CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(this.preserveState&&void 0!==this.previousState?this.previousState:CKEDITOR.TRISTATE_OFF)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(a){return!(this.state==a||a!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed())&&(this.previousState=this.state,this.state=a,this.fire("state"),!0)},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.event.implementOn(CKEDITOR.command.prototype),CKEDITOR.ENTER_P=1,CKEDITOR.ENTER_BR=2,CKEDITOR.ENTER_DIV=3,CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,width:"",baseFloatZIndex:1e4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85]},function(){function a(a,b,c,d,e){var f,p,a=[];for(f in b){p="boolean"==typeof(p=b[f])?{}:"function"==typeof p?{match:p}:K(p),"$"!=f.charAt(0)&&(p.elements=f),c&&(p.featureName=c.toLowerCase());var i=p;i.elements=h(i.elements,/\s+/)||null,i.propertiesOnly=i.propertiesOnly||!0===i.elements;var l=/\s*,\s*/,r=void 0;for(r in z){i[r]=h(i[r],l)||null;var x=i,n=B[r],v=h(i[B[r]],l),q=i[r],E=[],g=!0,o=void 0;v?g=!1:v={};for(o in q)"!"==o.charAt(0)&&(o=o.slice(1),E.push(o),v[o]=!0,g=!1);for(;o=E.pop();)q[o]=q["!"+o],delete q["!"+o];x[n]=!g&&v||null}i.match=i.match||null,d.push(p),a.push(p)}for(var C,b=e.elements,e=e.generic,c=0,d=a.length;c<d;++c){p=!0===(f=K(a[c])).classes||!0===f.styles||!0===f.attributes,i=f,r=n=l=void 0;for(l in z)i[l]=A(i[l]);x=!0;for(r in B){n=i[l=B[r]],v=[],q=void 0;for(q in n)q.indexOf("*")>-1?v.push(RegExp("^"+q.replace(/\*/g,".*")+"$")):v.push(q);(n=v).length&&(i[l]=n,x=!1)}if(i.nothingRequired=x,i.noProperties=!(i.attributes||i.classes||i.styles),!0===f.elements||null===f.elements)e[p?"unshift":"push"](f);else{i=f.elements,delete f.elements;for(C in i)b[C]?b[C][p?"unshift":"push"](f):b[C]=[f]}}}function f(a,c,d,e){if((!a.match||a.match(c))&&(e||k(a,c))&&(a.propertiesOnly||(d.valid=!0),d.allAttributes||(d.allAttributes=b(a.attributes,c.attributes,d.validAttributes)),d.allStyles||(d.allStyles=b(a.styles,c.styles,d.validStyles)),!d.allClasses)){if(a=a.classes,c=c.classes,e=d.validClasses,a)if(!0===a)a=!0;else{for(var i,f=0,p=c.length;f<p;++f)e[i=c[f]]||(e[i]=a(i));a=!1}else a=!1;d.allClasses=a}}function b(a,b,c){if(!a)return!1;if(!0===a)return!0;for(var d in b)c[d]||(c[d]=a(d));return!1}function c(a,b,c){if(!a.match||a.match(b)){if(a.noProperties)return!1;if(c.hadInvalidAttribute=e(a.attributes,b.attributes)||c.hadInvalidAttribute,c.hadInvalidStyle=e(a.styles,b.styles)||c.hadInvalidStyle,a=a.classes,b=b.classes,a){for(var d=!1,f=!0===a,p=b.length;p--;)(f||a(b[p]))&&(b.splice(p,1),d=!0);a=d}else a=!1;c.hadInvalidClass=a||c.hadInvalidClass}}function e(a,b){if(!a)return!1;var e,c=!1,d=!0===a;for(e in b)(d||a(e))&&(delete b[e],c=!0);return c}function d(a,b,c){return!(a.disabled||a.customConfig&&!c||!b)&&(a._.cachedChecks={},!0)}function h(a,b){if(!a)return!1;if(!0===a)return a;if("string"==typeof a)return"*"==(a=I(a))||CKEDITOR.tools.convertArrayToObject(a.split(b));if(CKEDITOR.tools.isArray(a))return!!a.length&&CKEDITOR.tools.convertArrayToObject(a);var e,c={},d=0;for(e in a)c[e]=a[e],d++;return!!d&&c}function k(a,b){if(a.nothingRequired)return!0;var c,d,e,f;if(e=a.requiredClasses)for(f=b.classes,c=0;c<e.length;++c)if("string"==typeof(d=e[c])){if(-1==CKEDITOR.tools.indexOf(f,d))return!1}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(f,d))return!1;return j(b.styles,a.requiredStyles)&&j(b.attributes,a.requiredAttributes)}function j(a,b){if(!b)return!0;for(var d,c=0;c<b.length;++c)if("string"==typeof(d=b[c])){if(!(d in a))return!1}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(a,d))return!1;return!0}function g(a){if(!a)return{};for(var a=a.split(/\s*,\s*/).sort(),b={};a.length;)b[a.shift()]=v;return b}function m(a){for(var b,c,d,e,f={},p=1,a=I(a);b=a.match(x);)(c=b[2])?(d=y(c,"styles"),e=y(c,"attrs"),c=y(c,"classes")):d=e=c=null,f["$"+p++]={elements:b[1],classes:c,styles:d,attributes:e},a=a.slice(b[0].length);return f}function y(a,b){var c=a.match(E[b]);return c?I(c[1]):null}function s(a){var b=a.styleBackup=a.attributes.style,c=a.classBackup=a.attributes.class;a.styles||(a.styles=CKEDITOR.tools.parseCssText(b||"",1)),a.classes||(a.classes=c?c.split(/\s+/):[])}function w(a,b,d,e){var r,l=0;if(e.toHtml&&(b.name=b.name.replace($,"$1")),e.doCallbacks&&a.elementCallbacks){a:for(var v,x=a.elementCallbacks,h=0,n=x.length;h<n;++h)if(v=x[h](b)){r=v;break a}if(r)return r}if(e.doTransform&&(r=a._.transformations[b.name])){for(s(b),x=0;x<r.length;++x)p(a,b,r[x]);t(b)}if(e.doFilter){a:{x=b.name,a=(h=a._).allowedRules.elements[x],r=h.allowedRules.generic,x=h.disallowedRules.elements[x],h=h.disallowedRules.generic,n=e.skipRequired,v={valid:!1,validAttributes:{},validClasses:{},validStyles:{},allAttributes:!1,allClasses:!1,allStyles:!1,hadInvalidAttribute:!1,hadInvalidClass:!1,hadInvalidStyle:!1};var q,z;if(a||r){if(s(b),x)for(q=0,z=x.length;q<z;++q)if(!1===c(x[q],b,v)){a=null;break a}if(h)for(q=0,z=h.length;q<z;++q)c(h[q],b,v);if(a)for(q=0,z=a.length;q<z;++q)f(a[q],b,v,n);if(r)for(q=0,z=r.length;q<z;++q)f(r[q],b,v,n);a=v}else a=null}if(!a)return d.push(b),F;if(!a.valid)return d.push(b),F;z=a.validAttributes;var E=a.validStyles;r=a.validClasses;var g,B,x=b.attributes,A=b.styles,h=b.classes,n=b.classBackup,o=b.styleBackup,C=[];v=[];var j=/^data-cke-/;if(q=!1,delete x.style,delete x.class,delete b.classBackup,delete b.styleBackup,!a.allAttributes)for(g in x)z[g]||(j.test(g)?g==(B=g.replace(/^data-cke-saved-/,""))||z[B]||(delete x[g],q=!0):(delete x[g],q=!0));if(!a.allStyles||a.hadInvalidStyle){for(g in A)a.allStyles||E[g]?C.push(g+":"+A[g]):q=!0;C.length&&(x.style=C.sort().join("; "))}else o&&(x.style=o);if(!a.allClasses||a.hadInvalidClass){for(g=0;g<h.length;++g)(a.allClasses||r[h[g]])&&v.push(h[g]);v.length&&(x.class=v.sort().join(" ")),n&&v.length<n.split(/\s+/).length&&(q=!0)}else n&&(x.class=n);if(q&&(l=F),!e.skipFinalValidation&&!i(b))return d.push(b),F}return e.toHtml&&(b.name=b.name.replace(aa,"cke:$1")),l}function q(a){var c,b=[];for(c in a)c.indexOf("*")>-1&&b.push(c.replace(/\*/g,".*"));return b.length?RegExp("^(?:"+b.join("|")+")$"):null}function t(a){var c,b=a.attributes;delete b.style,delete b.class,(c=CKEDITOR.tools.writeCssText(a.styles,!0))&&(b.style=c),a.classes.length&&(b.class=a.classes.sort().join(" "))}function i(a){switch(a.name){case"a":if(!a.children.length&&!a.attributes.name)return!1;break;case"img":if(!a.attributes.src)return!1}return!0}function A(a){if(!a)return!1;if(!0===a)return!0;var b=q(a);return function(c){return c in a||b&&c.match(b)}}function u(){return new CKEDITOR.htmlParser.element("br")}function o(a){return a.type==CKEDITOR.NODE_ELEMENT&&("br"==a.name||L.$block[a.name])}function l(a,b,c){d=a.name;if(L.$empty[d]||!a.children.length)"hr"==d&&"br"==b?a.replaceWith(u()):(a.parent&&c.push({check:"it",el:a.parent}),a.remove());else if(L.$block[d]||"tr"==d)if("br"==b)a.previous&&!o(a.previous)&&(b=u()).insertBefore(a),a.next&&!o(a.next)&&(b=u()).insertAfter(a),a.replaceWithChildren();else{var e,d=a.children;b:{e=L[b];for(var i,f=0,p=d.length;f<p;++f)if((i=d[f]).type==CKEDITOR.NODE_ELEMENT&&!e[i.name]){e=!1;break b}e=!0}if(e)a.name=b,a.attributes={},c.push({check:"parent-down",el:a});else{for(var l,r,f=(e=a.parent).type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||"body"==e.name,p=d.length;p>0;)i=d[--p],f&&(i.type==CKEDITOR.NODE_TEXT||i.type==CKEDITOR.NODE_ELEMENT&&L.$inline[i.name])?(l||((l=new CKEDITOR.htmlParser.element(b)).insertAfter(a),c.push({check:"parent-down",el:l})),l.add(i,0)):(l=null,r=L[e.name]||L.span,i.insertAfter(a),e.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&i.type==CKEDITOR.NODE_ELEMENT&&!r[i.name]&&c.push({check:"el-up",el:i}));a.remove()}}else"style"==d?a.remove():(a.parent&&c.push({check:"it",el:a.parent}),a.replaceWithChildren())}function p(a,b,c){var d,e;for(d=0;d<c.length;++d)if((!(e=c[d]).check||a.check(e.check,!1))&&(!e.left||e.left(b))){e.right(b,ba);break}}function r(a,b){var f,p,i,l,c=b.getDefinition(),d=c.attributes,e=c.styles;if(a.name!=c.element)return!1;for(f in d)if("class"==f){for(c=d[f].split(/\s+/),i=a.classes.join("|");l=c.pop();)if(-1==i.indexOf(l))return!1}else if(a.attributes[f]!=d[f])return!1;for(p in e)if(a.styles[p]!=e[p])return!1;return!0}function n(a,b){var c,d;return"string"==typeof a?c=a:a instanceof CKEDITOR.style?d=a:(c=a[0],d=a[1]),[{element:c,left:d,right:function(a,c){c.transform(a,b)}}]}function P(a){return function(b){return r(b,a)}}function C(a){return function(b,c){c[a](b)}}var L=CKEDITOR.dtd,F=1,K=CKEDITOR.tools.copy,I=CKEDITOR.tools.trim,v="cke-test",G=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2,CKEDITOR.filter=function(a){if(this.allowedContent=[],this.disallowedContent=[],this.elementCallbacks=null,this.disabled=!1,this.editor=null,this.id=CKEDITOR.tools.getNextNumber(),this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{}},CKEDITOR.filter.instances[this.id]=this,a instanceof CKEDITOR.editor){a=this.editor=a,this.customConfig=!0;var b=a.config.allowedContent;!0===b?this.disabled=!0:(b||(this.customConfig=!1),this.allow(b,"config",1),this.allow(a.config.extraAllowedContent,"extra",1),this.allow(G[a.enterMode]+" "+G[a.shiftEnterMode],"default",1),this.disallow(a.config.disallowedContent))}else this.customConfig=!1,this.allow(a,"default",1)},CKEDITOR.filter.instances={},CKEDITOR.filter.prototype={allow:function(b,c,e){if(!d(this,b,e))return!1;var f,p;if("string"==typeof b)b=m(b);else if(b instanceof CKEDITOR.style){if(b.toAllowedContentRules)return this.allow(b.toAllowedContentRules(this.editor),c,e);f=b.getDefinition(),b={},e=f.attributes,b[f.element]=f={styles:f.styles,requiredStyles:f.styles&&CKEDITOR.tools.objectKeys(f.styles)},e&&(e=K(e),f.classes=e.class?e.class.split(/\s+/):null,f.requiredClasses=f.classes,delete e.class,f.attributes=e,f.requiredAttributes=e&&CKEDITOR.tools.objectKeys(e))}else if(CKEDITOR.tools.isArray(b)){for(f=0;f<b.length;++f)p=this.allow(b[f],c,e);return p}return a(this,b,c,this.allowedContent,this._.allowedRules),!0},applyTo:function(a,b,c,d){if(this.disabled)return!1;var r,e=this,f=[],p=this.editor&&this.editor.config.protectedSource,x=!1,h={doFilter:!c,doTransform:!0,doCallbacks:!0,toHtml:b};a.forEach(function(a){if(a.type==CKEDITOR.NODE_ELEMENT){if("off"==a.attributes["data-cke-filter"])return!1;if(!b||"span"!=a.name||!~CKEDITOR.tools.objectKeys(a.attributes).join("|").indexOf("data-cke-"))if((r=w(e,a,f,h))&F)x=!0;else if(2&r)return!1}else if(a.type==CKEDITOR.NODE_COMMENT&&a.value.match(/^\{cke_protected\}(?!\{C\})/)){var c;a:{var d=decodeURIComponent(a.value.replace(/^\{cke_protected\}/,""));c=[];var i,l,n;if(p)for(l=0;l<p.length;++l)if((n=d.match(p[l]))&&n[0].length==d.length){c=!0;break a}1==(d=CKEDITOR.htmlParser.fragment.fromHtml(d)).children.length&&(i=d.children[0]).type==CKEDITOR.NODE_ELEMENT&&w(e,i,c,h),c=!c.length}c||f.push(a)}},null,!0),f.length&&(x=!0);for(var n,q,a=[],d=G[d||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)];c=f.pop();)c.type==CKEDITOR.NODE_ELEMENT?l(c,d,a):c.remove();for(;n=a.pop();)if((c=n.el).parent)switch(q=L[c.parent.name]||L.span,n.check){case"it":L.$removeEmpty[c.name]&&!c.children.length?l(c,d,a):i(c)||l(c,d,a);break;case"el-up":c.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!q[c.name]&&l(c,d,a);break;case"parent-down":c.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT&&!q[c.name]&&l(c.parent,d,a)}return x},checkFeature:function(a){return!(!this.disabled&&a)||(a.toFeature&&(a=a.toFeature(this.editor)),!a.requiredContent||this.check(a.requiredContent))},disable:function(){this.disabled=!0},disallow:function(b){return!!d(this,b,!0)&&("string"==typeof b&&(b=m(b)),a(this,b,null,this.disallowedContent,this._.disallowedRules),!0)},addContentForms:function(a){if(!this.disabled&&a){var b,c,e,d=[];for(b=0;b<a.length&&!e;++b)("string"==typeof(c=a[b])||c instanceof CKEDITOR.style)&&this.check(c)&&(e=c);if(e){for(b=0;b<a.length;++b)d.push(n(a[b],e));this.addTransformations(d)}}},addElementCallback:function(a){this.elementCallbacks||(this.elementCallbacks=[]),this.elementCallbacks.push(a)},addFeature:function(a){return!(!this.disabled&&a)||(a.toFeature&&(a=a.toFeature(this.editor)),this.allow(a.allowedContent,a.name),this.addTransformations(a.contentTransformations),this.addContentForms(a.contentForms),!a.requiredContent||!this.customConfig&&!this.disallowedContent.length||this.check(a.requiredContent))},addTransformations:function(a){var b,c;if(!this.disabled&&a){var e,d=this._.transformations;for(e=0;e<a.length;++e){b=a[e];var f=void 0,p=void 0,i=void 0,l=void 0,r=void 0,x=void 0;for(c=[],p=0;p<b.length;++p)"string"==typeof(i=b[p])?(l=(i=i.split(/\s*:\s*/))[0],r=null,x=i[1]):(l=i.check,r=i.left,x=i.right),f||(f=(f=i).element?f.element:l?l.match(/^([a-z0-9]+)/i)[0]:f.left.getDefinition().element),r instanceof CKEDITOR.style&&(r=P(r)),c.push({check:l==f?null:l,left:r,right:"string"==typeof x?C(x):x});d[b=f]||(d[b]=[]),d[b].push(c)}}},check:function(a,b,c){if(this.disabled)return!0;if(CKEDITOR.tools.isArray(a)){for(var d=a.length;d--;)if(this.check(a[d],b,c))return!0;return!1}var e,f;if("string"==typeof a){if((f=a+"<"+(!1===b?"0":"1")+(c?"1":"0")+">")in this._.cachedChecks)return this._.cachedChecks[f];e=(d=m(a).$1).styles;i=d.classes;d.name=d.elements,d.classes=i=i?i.split(/\s*,\s*/):[],d.styles=g(e),d.attributes=g(d.attributes),d.children=[],i.length&&(d.attributes.class=i.join(" ")),e&&(d.attributes.style=CKEDITOR.tools.writeCssText(d.styles)),e=d}else e=(d=a.getDefinition()).styles,i=d.attributes||{},e?(e=K(e),i.style=CKEDITOR.tools.writeCssText(e,!0)):e={},e={name:d.element,attributes:i,classes:i.class?i.class.split(/\s+/):[],styles:e,children:[]};var r,i=CKEDITOR.tools.clone(e),l=[];if(!1!==b&&(r=this._.transformations[e.name])){for(d=0;d<r.length;++d)p(this,e,r[d]);t(e)}return w(this,i,l,{doFilter:!0,doTransform:!1!==b,skipRequired:!c,skipFinalValidation:!c}),b=!(l.length>0)&&!!CKEDITOR.tools.objectCompare(e.attributes,i.attributes,!0),"string"==typeof a&&(this._.cachedChecks[f]=b),b},getAllowedEnterMode:function(){var a=["p","div","br"],b={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(c,d){var f,e=a.slice();if(this.check(G[c]))return c;for(d||(e=e.reverse());f=e.pop();)if(this.check(f))return b[f];return CKEDITOR.ENTER_BR}}(),destroy:function(){delete CKEDITOR.filter.instances[this.id],delete this._,delete this.allowedContent,delete this.disallowedContent}};var z={styles:1,attributes:1,classes:1},B={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},x=/^([a-z0-9\-*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,E={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},$=/^cke:(object|embed|param)$/,aa=/^(object|embed|param)$/,ba=CKEDITOR.filter.transformationsTools={sizeToStyle:function(a){this.lengthToStyle(a,"width"),this.lengthToStyle(a,"height")},sizeToAttribute:function(a){this.lengthToAttribute(a,"width"),this.lengthToAttribute(a,"height")},lengthToStyle:function(a,b,c){if(!((c=c||b)in a.styles)){var d=a.attributes[b];d&&(/^\d+$/.test(d)&&(d+="px"),a.styles[c]=d)}delete a.attributes[b]},lengthToAttribute:function(a,b,c){if(!((c=c||b)in a.attributes)){var d=a.styles[b],e=d&&d.match(/^(\d+)(?:\.\d*)?px$/);e?a.attributes[c]=e[1]:d==v&&(a.attributes[c]=v)}delete a.styles[b]},alignmentToStyle:function(a){if(!("float"in a.styles)){var b=a.attributes.align;"left"!=b&&"right"!=b||(a.styles.float=b)}delete a.attributes.align},alignmentToAttribute:function(a){if(!("align"in a.attributes)){var b=a.styles.float;"left"!=b&&"right"!=b||(a.attributes.align=b)}delete a.styles.float},matchesStyle:r,transform:function(a,b){if("string"==typeof b)a.name=b;else{var f,i,p,l,c=b.getDefinition(),d=c.styles,e=c.attributes;a.name=c.element;for(f in e)if("class"==f)for(c=a.classes.join("|"),p=e[f].split(/\s+/);l=p.pop();)-1==c.indexOf(l)&&a.classes.push(l);else a.attributes[f]=e[f];for(i in d)a.styles[i]=d[i]}}}}(),CKEDITOR.focusManager=function(a){return a.focusManager?a.focusManager:(this.hasFocus=!1,this.currentActive=null,this._={editor:a},this)},CKEDITOR.focusManager._={blurDelay:200},CKEDITOR.focusManager.prototype={focus:function(a){this._.timer&&clearTimeout(this._.timer),a&&(this.currentActive=a),this.hasFocus||this._.locked||((a=CKEDITOR.currentInstance)&&a.focusManager.blur(1),this.hasFocus=!0,(a=this._.editor.container)&&a.addClass("cke_focus"),this._.editor.fire("focus"))},lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(a){function f(){if(this.hasFocus){this.hasFocus=!1;var a=this._.editor.container;a&&a.removeClass("cke_focus"),this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var b=CKEDITOR.focusManager._.blurDelay;a||!b?f.call(this):this._.timer=CKEDITOR.tools.setTimeout(function(){delete this._.timer,f.call(this)},b,this)}},add:function(a,f){if(!(b=a.getCustomData("focusmanager"))||b!=this){b&&b.remove(a);var b="focus",c="blur";f&&(CKEDITOR.env.ie?(b="focusin",c="focusout"):CKEDITOR.event.useCapture=1);var e={blur:function(){a.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(a)}};a.on(b,e.focus,this),a.on(c,e.blur,this),f&&(CKEDITOR.event.useCapture=0),a.setCustomData("focusmanager",this),a.setCustomData("focusmanager_handlers",e)}},remove:function(a){a.removeCustomData("focusmanager");var f=a.removeCustomData("focusmanager_handlers");a.removeListener("blur",f.blur),a.removeListener("focus",f.focus)}},CKEDITOR.keystrokeHandler=function(a){return a.keystrokeHandler?a.keystrokeHandler:(this.keystrokes={},this.blockedKeystrokes={},this._={editor:a},this)},function(){var a,f=function(b){var e=(b=b.data).getKeystroke(),d=this.keystrokes[e],f=this._.editor;return(a=!1===f.fire("key",{keyCode:e,domEvent:b}))||(d&&(a=!1!==f.execCommand(d,{from:"keystrokeHandler"})),a||(a=!!this.blockedKeystrokes[e])),a&&b.preventDefault(!0),!a},b=function(b){a&&(a=!1,b.data.preventDefault(!0))};CKEDITOR.keystrokeHandler.prototype={attach:function(a){a.on("keydown",f,this),CKEDITOR.env.gecko&&CKEDITOR.env.mac&&a.on("keypress",b,this)}}}(),CKEDITOR.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(a,f,b){a&&CKEDITOR.lang.languages[a]||(a=this.detect(f,a));var c=this,f=function(){c[a].dir=c.rtl[a]?"rtl":"ltr",b(a,c[a])};this[a]?f():CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+a+".js"),f,this)},detect:function(a,f){var b=this.languages,e=(c=(f=f||navigator.userLanguage||navigator.language||a).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/))[1],c=c[2];return b[e+"-"+c]?e=e+"-"+c:b[e]||(e=null),CKEDITOR.lang.detect=e?function(){return e}:function(a){return a},e||a}},CKEDITOR.scriptLoader=function(){var a={},f={};return{load:function(b,c,e,d){var h="string"==typeof b;h&&(b=[b]),e||(e=CKEDITOR);var k=b.length,j=[],g=[],m=function(a){c&&(h?c.call(e,a):c.call(e,j,g))};if(0===k)m(!0);else{var y=function(a,b){(b?j:g).push(a),--k<=0&&(d&&CKEDITOR.document.getDocumentElement().removeStyle("cursor"),m(b))},s=function(b,c){a[b]=1;var d=f[b];delete f[b];for(var e=0;e<d.length;e++)d[e](b,c)};d&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var q=0;q<k;q++)!function(b){if(a[b])y(b,!0);else{var d=f[b]||(f[b]=[]);if(d.push(y),!(d.length>1)){var e=new CKEDITOR.dom.element("script");e.setAttributes({type:"text/javascript",src:b}),c&&(CKEDITOR.env.ie&&CKEDITOR.env.version<11?e.$.onreadystatechange=function(){"loaded"!=e.$.readyState&&"complete"!=e.$.readyState||(e.$.onreadystatechange=null,s(b,!0))}:(e.$.onload=function(){setTimeout(function(){s(b,!0)},0)},e.$.onerror=function(){s(b,!1)})),e.appendTo(CKEDITOR.document.getHead())}}}(b[q])}},queue:function(){function a(){var b;(b=c[0])&&this.load(b.scriptUrl,b.callback,CKEDITOR,0)}var c=[];return function(e,d){var f=this;c.push({scriptUrl:e,callback:function(){d&&d.apply(this,arguments),c.shift(),a.call(f)}}),1==c.length&&a.call(this)}}()}}(),CKEDITOR.resourceManager=function(a,f){this.basePath=a,this.fileName=f,this.registered={},this.loaded={},this.externals={},this._={waitingList:{}}},CKEDITOR.resourceManager.prototype={add:function(a,f){if(this.registered[a])throw'[CKEDITOR.resourceManager.add] The resource name "'+a+'" is already registered.';var b=this.registered[a]=f||{};return b.name=a,b.path=this.getPath(a),CKEDITOR.fire(a+CKEDITOR.tools.capitalize(this.fileName)+"Ready",b),this.get(a)},get:function(a){return this.registered[a]||null},getPath:function(a){var f=this.externals[a];return CKEDITOR.getUrl(f&&f.dir||this.basePath+a+"/")},getFilePath:function(a){var f=this.externals[a];return CKEDITOR.getUrl(this.getPath(a)+(f?f.file:this.fileName+".js"))},addExternal:function(a,f,b){for(var a=a.split(","),c=0;c<a.length;c++){var e=a[c];b||(f=f.replace(/[^\/]+$/,function(a){return b=a,""})),this.externals[e]={dir:f,file:b||this.fileName+".js"}}},load:function(a,f,b){CKEDITOR.tools.isArray(a)||(a=a?[a]:[]);for(var c=this.loaded,e=this.registered,d=[],h={},k={},j=0;j<a.length;j++){var g=a[j];if(g)if(c[g]||e[g])k[g]=this.get(g);else{var m=this.getFilePath(g);d.push(m),m in h||(h[m]=[]),h[m].push(g)}}CKEDITOR.scriptLoader.load(d,function(a,d){if(d.length)throw'[CKEDITOR.resourceManager.load] Resource name "'+h[d[0]].join(",")+'" was not found at "'+d[0]+'".';for(var e=0;e<a.length;e++)for(var q=h[a[e]],g=0;g<q.length;g++){var i=q[g];k[i]=this.get(i),c[i]=1}f.call(b,k)},this)}},CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin"),CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,function(a){var f={};return function(b,c,e){var d={},h=function(b){a.call(this,b,function(a){CKEDITOR.tools.extend(d,a);var m,b=[];for(m in a){var k=a[m],s=k&&k.requires;if(!f[m]){if(k.icons)for(var w=k.icons.split(","),q=w.length;q--;)CKEDITOR.skin.addIcon(w[q],k.path+"icons/"+(CKEDITOR.env.hidpi&&k.hidpi?"hidpi/":"")+w[q]+".png");f[m]=1}if(s)for(s.split&&(s=s.split(",")),k=0;k<s.length;k++)d[s[k]]||b.push(s[k])}if(b.length)h.call(this,b);else{for(m in d)(k=d[m]).onLoad&&!k.onLoad._called&&(!1===k.onLoad()&&delete d[m],k.onLoad._called=1);c&&c.call(e||window,d)}},this)};h.call(this,b)}}),CKEDITOR.plugins.setLang=function(a,f,b){var c=this.get(a),a=c.langEntries||(c.langEntries={});(c=c.lang||(c.lang=[])).split&&(c=c.split(",")),-1==CKEDITOR.tools.indexOf(c,f)&&c.push(f),a[f]=b},CKEDITOR.ui=function(a){return a.ui?a.ui:(this.items={},this.instances={},this.editor=a,this._={handlers:{}},this)},CKEDITOR.ui.prototype={add:function(a,f,b){b.name=a.toLowerCase();var c=this.items[a]={type:f,command:b.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(c,b)},get:function(a){return this.instances[a]},create:function(a){var f=this.items[a],b=f&&this._.handlers[f.type],c=f&&f.command&&this.editor.getCommand(f.command),b=b&&b.create.apply(this,f.args);return this.instances[a]=b,c&&c.uiItems.push(b),b&&!b.type&&(b.type=f.type),b},addHandler:function(a,f){this._.handlers[a]=f},space:function(a){return CKEDITOR.document.getById(this.spaceId(a))},spaceId:function(a){return this.editor.id+"_"+a}},CKEDITOR.event.implementOn(CKEDITOR.ui),function(){function a(a,c,d){if(CKEDITOR.event.call(this),a=a&&CKEDITOR.tools.clone(a),void 0!==c){if(!(c instanceof CKEDITOR.dom.element))throw Error("Expect element of type CKEDITOR.dom.element.");if(!d)throw Error("One of the element modes must be specified.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&d==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!(d==CKEDITOR.ELEMENT_MODE_INLINE?c.is(CKEDITOR.dtd.$editable)||c.is("textarea"):d==CKEDITOR.ELEMENT_MODE_REPLACE?!c.is(CKEDITOR.dtd.$nonBodyContent):1))throw Error('The specified element mode is not supported on element: "'+c.getName()+'".');this.element=c,this.elementMode=d,this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(c.getId()||c.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={},this.commands={},this.templates={},this.name=this.name||f(),this.id=CKEDITOR.tools.getNextId(),this.status="unloaded",this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config),this.ui=new CKEDITOR.ui(this),this.focusManager=new CKEDITOR.focusManager(this),this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this),this.on("readOnly",b),this.on("selectionChange",function(a){e(this,a.data.path)}),this.on("activeFilterChange",function(){e(this,this.elementPath(),!0)}),this.on("mode",b),this.on("instanceReady",function(){this.config.startupFocus&&this.focus()}),CKEDITOR.fire("instanceCreated",null,this),CKEDITOR.add(this),CKEDITOR.tools.setTimeout(function(){h(this,a)},0,this)}function f(){do{var a="editor"+ ++s}while(CKEDITOR.instances[a]);return a}function b(){var b,a=this.commands;for(b in a)c(this,a[b])}function c(a,b){b[b.startDisabled?"disable":a.readOnly&&!b.readOnly?"disable":b.modes[a.mode]?"enable":"disable"]()}function e(a,b,c){if(b){var d,e,f=a.commands;for(e in f)d=f[e],(c||d.contextSensitive)&&d.refresh(a,b)}}function d(a){if(!(b=a.config.customConfig))return!1;var b=CKEDITOR.getUrl(b),c=w[b]||(w[b]={});return c.fn?(c.fn.call(a,a.config),(CKEDITOR.getUrl(a.config.customConfig)==b||!d(a))&&a.fireOnce("customConfigLoaded")):CKEDITOR.scriptLoader.queue(b,function(){c.fn=CKEDITOR.editorConfig?CKEDITOR.editorConfig:function(){},d(a)}),!0}function h(a,b){a.on("customConfigLoaded",function(){if(b){if(b.on)for(var c in b.on)a.on(c,b.on[c]);CKEDITOR.tools.extend(a.config,b,!0),delete a.config.on}c=a.config,a.readOnly=!(!c.readOnly&&!(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.is("textarea")?a.element.hasAttribute("disabled"):a.element.isReadOnly():a.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&a.element.hasAttribute("disabled"))),a.blockless=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&!(a.element.is("textarea")||CKEDITOR.dtd[a.element.getName()].p),a.tabIndex=c.tabIndex||a.element&&a.element.getAttribute("tabindex")||0,a.activeEnterMode=a.enterMode=a.blockless?CKEDITOR.ENTER_BR:c.enterMode,a.activeShiftEnterMode=a.shiftEnterMode=a.blockless?CKEDITOR.ENTER_BR:c.shiftEnterMode,c.skin&&(CKEDITOR.skinName=c.skin),a.fireOnce("configLoaded"),a.dataProcessor=new CKEDITOR.htmlDataProcessor(a),a.filter=a.activeFilter=new CKEDITOR.filter(a),k(a)}),b&&null!=b.customConfig&&(a.config.customConfig=b.customConfig),d(a)||a.fireOnce("customConfigLoaded")}function k(a){CKEDITOR.skin.loadPart("editor",function(){j(a)})}function j(a){CKEDITOR.lang.load(a.config.language,a.config.defaultLanguage,function(b,c){var d=a.config.title;a.langCode=b,a.lang=CKEDITOR.tools.prototypedCopy(c),a.title="string"==typeof d||!1===d?d:[a.lang.editor,a.name].join(", "),a.config.contentsLangDirection||(a.config.contentsLangDirection=a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?a.element.getDirection(1):a.lang.dir),a.fire("langLoaded"),g(a)})}function g(a){a.getStylesSet(function(b){a.once("loaded",function(){a.fire("stylesSet",{styles:b})},null,null,1),m(a)})}function m(a){var b=a.config,c=b.plugins,d=b.extraPlugins,e=b.removePlugins;if(d)var f=RegExp("(?:^|,)(?:"+d.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),c=c.replace(f,""),c=c+","+d;if(e)var l=RegExp("(?:^|,)(?:"+e.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),c=c.replace(l,"");CKEDITOR.env.air&&(c+=",adobeair"),CKEDITOR.plugins.load(c.split(","),function(c){var d=[],e=[],f=[];a.plugins=c;for(var i in c){var v,h=c[i],g=h.lang,o=null,A=h.requires;if(CKEDITOR.tools.isArray(A)&&(A=A.join(",")),A&&(v=A.match(l)))for(;A=v.pop();)CKEDITOR.tools.setTimeout(function(a,b){throw Error('Plugin "'+a.replace(",","")+'" cannot be removed from the plugins list, because it\'s required by "'+b+'" plugin.')},0,null,[A,i]);g&&!a.lang[i]&&(g.split&&(g=g.split(",")),o=CKEDITOR.tools.indexOf(g,a.langCode)>=0?a.langCode:(o=a.langCode.replace(/-.*/,""))!=a.langCode&&CKEDITOR.tools.indexOf(g,o)>=0?o:CKEDITOR.tools.indexOf(g,"en")>=0?"en":g[0],h.langEntries&&h.langEntries[o]?(a.lang[i]=h.langEntries[o],o=null):f.push(CKEDITOR.getUrl(h.path+"lang/"+o+".js"))),e.push(o),d.push(h)}CKEDITOR.scriptLoader.load(f,function(){for(var c=["beforeInit","init","afterInit"],f=0;f<c.length;f++)for(var p=0;p<d.length;p++){var i=d[p];0===f&&e[p]&&i.lang&&i.langEntries&&(a.lang[i.name]=i.langEntries[e[p]]),i[c[f]]&&i[c[f]](a)}for(a.fireOnce("pluginsLoaded"),b.keystrokes&&a.setKeystroke(a.config.keystrokes),p=0;p<a.config.blockedKeystrokes.length;p++)a.keystrokeHandler.blockedKeystrokes[a.config.blockedKeystrokes[p]]=1;a.status="loaded",a.fireOnce("loaded"),CKEDITOR.fire("instanceLoaded",null,a)})})}function y(){var a=this.element;if(a&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var b=this.getData();return this.config.htmlEncodeOutput&&(b=CKEDITOR.tools.htmlEncode(b)),a.is("textarea")?a.setValue(b):a.setHtml(b),!0}return!1}a.prototype=CKEDITOR.editor.prototype,CKEDITOR.editor=a;var s=0,w={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{addCommand:function(a,b){b.name=a.toLowerCase();var d=new CKEDITOR.command(this,b);return this.mode&&c(this,d),this.commands[a]=d},_attachToForm:function(){function a(d){b.updateElement(),b._.required&&!c.getValue()&&!1===b.fire("required")&&d.data.preventDefault()}var b=this,c=b.element,d=new CKEDITOR.dom.element(c.$.form);c.is("textarea")&&d&&(d.on("submit",a),d.$.submit&&d.$.submit.call&&d.$.submit.apply&&(d.$.submit=CKEDITOR.tools.override(d.$.submit,function(b){return function(){a(),b.apply?b.apply(this):b()}})),b.on("destroy",function(){d.removeListener("submit",a)}))},destroy:function(a){this.fire("beforeDestroy"),!a&&y.call(this),this.editable(null),this.filter.destroy(),delete this.filter,delete this.activeFilter,this.status="destroyed",this.fire("destroy"),this.removeAllListeners(),CKEDITOR.remove(this),CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(a){if(!a){if(!(a=this.getSelection()))return null;a=a.getStartElement()}return a?new CKEDITOR.dom.elementPath(a,this.editable()):null},createRange:function(){var a=this.editable();return a?new CKEDITOR.dom.range(a):null},execCommand:function(a,b){var c=this.getCommand(a),d={name:a,commandData:b,command:c};return!(!c||c.state==CKEDITOR.TRISTATE_DISABLED||!1===this.fire("beforeCommandExec",d)||(d.returnValue=c.exec(d.commandData),c.async||!1===this.fire("afterCommandExec",d)))&&d.returnValue},getCommand:function(a){return this.commands[a]},getData:function(a){!a&&this.fire("beforeGetData");var b=this._.data;return"string"!=typeof b&&(b=(b=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?b.is("textarea")?b.getValue():b.getHtml():""),b={dataValue:b},!a&&this.fire("getData",b),b.dataValue},getSnapshot:function(){var a=this.fire("getSnapshot");if("string"!=typeof a){var b=this.element;b&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(a=b.is("textarea")?b.getValue():b.getHtml())}return a},loadSnapshot:function(a){this.fire("loadSnapshot",a)},setData:function(a,b,c){var d=!0,e=b;b&&"object"==typeof b&&(c=b.internal,e=b.callback,d=!b.noSnapshot),!c&&d&&this.fire("saveSnapshot"),!e&&c||this.once("dataReady",function(a){!c&&d&&this.fire("saveSnapshot"),e&&e.call(a.editor)}),a={dataValue:a},!c&&this.fire("setData",a),this._.data=a.dataValue,!c&&this.fire("afterSetData",a)},setReadOnly:function(a){a=null==a||a,this.readOnly!=a&&(this.readOnly=a,this.keystrokeHandler.blockedKeystrokes[8]=+a,this.editable().setReadOnly(a),this.fire("readOnly"))},insertHtml:function(a,b){this.fire("insertHtml",{dataValue:a,mode:b})},insertText:function(a){this.fire("insertText",a)},insertElement:function(a){this.fire("insertElement",a)},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return"ready"==this.status&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return y.call(this)},setKeystroke:function(){for(var c,d,a=this.keystrokeHandler.keystrokes,b=CKEDITOR.tools.isArray(arguments[0])?arguments[0]:[[].slice.call(arguments,0)],e=b.length;e--;)c=b[e],d=0,CKEDITOR.tools.isArray(c)&&(d=c[1],c=c[0]),d?a[c]=d:delete a[c]},addFeature:function(a){return this.filter.addFeature(a)},setActiveFilter:function(a){a||(a=this.filter),this.activeFilter!==a&&(this.activeFilter=a,this.fire("activeFilterChange"),a===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(a.getAllowedEnterMode(this.enterMode),a.getAllowedEnterMode(this.shiftEnterMode,!0)))},setActiveEnterMode:function(a,b){a=a?this.blockless?CKEDITOR.ENTER_BR:a:this.enterMode,b=b?this.blockless?CKEDITOR.ENTER_BR:b:this.shiftEnterMode,this.activeEnterMode==a&&this.activeShiftEnterMode==b||(this.activeEnterMode=a,this.activeShiftEnterMode=b,this.fire("activeEnterModeChange"))}})}(),CKEDITOR.ELEMENT_MODE_NONE=0,CKEDITOR.ELEMENT_MODE_REPLACE=1,CKEDITOR.ELEMENT_MODE_APPENDTO=2,CKEDITOR.ELEMENT_MODE_INLINE=3,CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--\>)|(?:([^\/\s>]+)((?:\s+[\w\-:.]+(?:\s*=\s*?(?:(?:"[^"]*")|(?:'[^']*')|[^\s"'\/>]+))?)*)[\S\s]*?(\/?)>))/g}},function(){var a=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,f={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(b){for(var c,e,h,d=0;c=this._.htmlPartsRegex.exec(b);)if((e=c.index)>d&&(d=b.substring(d,e),h?h.push(d):this.onText(d)),d=this._.htmlPartsRegex.lastIndex,!(e=c[1])||(e=e.toLowerCase(),h&&CKEDITOR.dtd.$cdata[e]&&(this.onCDATA(h.join("")),h=null),h))if(h)h.push(c[0]);else if(e=c[3]){if(e=e.toLowerCase(),!/="/.test(e)){var j,k={},g=c[4];if(c=!!c[5],g)for(;j=a.exec(g);){var m=j[1].toLowerCase();j=j[2]||j[3]||j[4]||"",k[m]=!j&&f[m]?m:CKEDITOR.tools.htmlDecodeAttr(j)}this.onTagOpen(e,k,c),!h&&CKEDITOR.dtd.$cdata[e]&&(h=[])}}else(e=c[2])&&this.onComment(e);else this.onTagClose(e);b.length>d&&this.onText(b.substring(d,b.length))}}}(),CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(a){this._.output.push("<",a)},openTagClose:function(a,f){f?this._.output.push(" />"):this._.output.push(">")},attribute:function(a,f){"string"==typeof f&&(f=CKEDITOR.tools.htmlEncodeAttr(f)),this._.output.push(" ",a,'="',f,'"')},closeTag:function(a){this._.output.push("</",a,">")},text:function(a){this._.output.push(a)},comment:function(a){this._.output.push("\x3c!--",a,"--\x3e")},write:function(a){this._.output.push(a)},reset:function(){this._.output=[],this._.indent=!1},getHtml:function(a){var f=this._.output.join("");return a&&this.reset(),f}}}),CKEDITOR.htmlParser.node=function(){},CKEDITOR.htmlParser.node.prototype={remove:function(){var a=this.parent.children,f=CKEDITOR.tools.indexOf(a,this),b=this.previous,c=this.next;b&&(b.next=c),c&&(c.previous=b),a.splice(f,1),this.parent=null},replaceWith:function(a){var f=this.parent.children,b=CKEDITOR.tools.indexOf(f,this),c=a.previous=this.previous,e=a.next=this.next;c&&(c.next=a),e&&(e.previous=a),f[b]=a,a.parent=this.parent,this.parent=null},insertAfter:function(a){var f=a.parent.children,b=CKEDITOR.tools.indexOf(f,a),c=a.next;f.splice(b+1,0,this),this.next=a.next,this.previous=a,a.next=this,c&&(c.previous=this),this.parent=a.parent},insertBefore:function(a){var f=a.parent.children,b=CKEDITOR.tools.indexOf(f,a);f.splice(b,0,this),this.next=a,(this.previous=a.previous)&&(a.previous.next=this),a.previous=this,this.parent=a.parent},getAscendant:function(a){for(var f="function"==typeof a?a:"string"==typeof a?function(b){return b.name==a}:function(b){return b.name in a},b=this.parent;b&&b.type==CKEDITOR.NODE_ELEMENT;){if(f(b))return b;b=b.parent}return null},wrapWith:function(a){return this.replaceWith(a),a.add(this),a},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(a){return a||{}}},CKEDITOR.htmlParser.comment=function(a){this.value=a,this._={isBlockLike:!1}},CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(a,f){var b=this.value;return(b=a.onComment(f,b,this))?"string"!=typeof b?(this.replaceWith(b),!1):(this.value=b,!0):(this.remove(),!1)},writeHtml:function(a,f){f&&this.filter(f),a.comment(this.value)}}),CKEDITOR.htmlParser.text=function(a){this.value=a,this._={isBlockLike:!1}},CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(a,f){if(!(this.value=a.onText(f,this.value,this)))return this.remove(),!1},writeHtml:function(a,f){f&&this.filter(f),a.text(this.value)}}),CKEDITOR.htmlParser.cdata=function(a){this.value=a},CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(){},writeHtml:function(a){a.write(this.value)}}),CKEDITOR.htmlParser.fragment=function(){this.children=[],this.parent=null,this._={isBlockLike:!0,hasInlineStarted:!1}},function(){function a(a){return!a.attributes["data-cke-survive"]&&("a"==a.name&&a.attributes.href||CKEDITOR.dtd.$removeEmpty[a.name])}var f=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),b={ol:1,ul:1},c=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),e={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=function(d,h,k){function j(a){var b;if(i.length>0)for(var c=0;c<i.length;c++){var d=i[c],e=d.name,f=CKEDITOR.dtd[e],l=u.name&&CKEDITOR.dtd[u.name];l&&!l[e]||a&&f&&!f[a]&&CKEDITOR.dtd[a]?e==u.name&&(y(u,u.parent,1),c--):(b||(g(),b=1),(d=d.clone()).parent=u,u=d,i.splice(c,1),c--)}}function g(){for(;A.length;)y(A.shift(),u)}function m(a){if(a._.isBlockLike&&"pre"!=a.name&&"textarea"!=a.name){var d,b=a.children.length,c=a.children[b-1];c&&c.type==CKEDITOR.NODE_TEXT&&((d=CKEDITOR.tools.rtrim(c.value))?c.value=d:a.children.length=b-1)}}function y(b,c,d){var c=c||u||t,e=u;void 0===b.previous&&(s(c,b)&&(u=c,q.onTagOpen(k,{}),b.returnPoint=c=u),m(b),(!a(b)||b.children.length)&&c.add(b),"pre"==b.name&&(l=!1),"textarea"==b.name&&(o=!1)),b.returnPoint?(u=b.returnPoint,delete b.returnPoint):u=d?c:e}function s(a,b){if((a==t||"body"==a.name)&&k&&(!a.name||CKEDITOR.dtd[a.name][k])){var c,d;return(c=b.attributes&&(d=b.attributes["data-cke-real-element-type"])?d:b.name)&&c in CKEDITOR.dtd.$inline&&!(c in CKEDITOR.dtd.head)&&!b.isOrphan||b.type==CKEDITOR.NODE_TEXT}}function w(a,b){return(a in CKEDITOR.dtd.$listItem||a in CKEDITOR.dtd.$tableContent)&&(a==b||"dt"==a&&"dd"==b||"dd"==a&&"dt"==b)}var q=new CKEDITOR.htmlParser,t=h instanceof CKEDITOR.htmlParser.element?h:"string"==typeof h?new CKEDITOR.htmlParser.element(h):new CKEDITOR.htmlParser.fragment,i=[],A=[],u=t,o="textarea"==t.name,l="pre"==t.name;for(q.onTagOpen=function(d,e,h,m){if((e=new CKEDITOR.htmlParser.element(d,e)).isUnknown&&h&&(e.isEmpty=!0),e.isOptionalClose=m,a(e))i.push(e);else{if("pre"==d)l=!0;else{if("br"==d&&l)return void u.add(new CKEDITOR.htmlParser.text("\n"));"textarea"==d&&(o=!0)}if("br"==d)A.push(e);else{for(;m=(h=u.name)?CKEDITOR.dtd[h]||(u._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):c,!(e.isUnknown||u.isUnknown||m[d]);)if(u.isOptionalClose)q.onTagClose(h);else if(d in b&&h in b)(h=(h=u.children)[h.length-1])&&"li"==h.name||y(h=new CKEDITOR.htmlParser.element("li"),u),!e.returnPoint&&(e.returnPoint=u),u=h;else if(d in CKEDITOR.dtd.$listItem&&!w(d,h))q.onTagOpen("li"==d?"ul":"dl",{},0,1);else if(h in f&&!w(d,h))!e.returnPoint&&(e.returnPoint=u),u=u.parent;else{if(h in CKEDITOR.dtd.$inline&&i.unshift(u),!u.parent){e.isOrphan=1;break}y(u,u.parent,1)}j(d),g(),e.parent=u,e.isEmpty?y(e):u=e}}},q.onTagClose=function(a){for(var b=i.length-1;b>=0;b--)if(a==i[b].name)return void i.splice(b,1);for(var c=[],d=[],e=u;e!=t&&e.name!=a;)e._.isBlockLike||d.unshift(e),c.push(e),e=e.returnPoint||e.parent;if(e!=t){for(b=0;b<c.length;b++){var f=c[b];y(f,f.parent)}u=e,e._.isBlockLike&&g(),y(e,e.parent),e==u&&(u=u.parent),i=i.concat(d)}"body"==a&&(k=!1)},q.onText=function(a){if(u._.hasInlineStarted&&!A.length||l||o||0!==(a=CKEDITOR.tools.ltrim(a)).length){var b=u.name,d=b?CKEDITOR.dtd[b]||(u._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):c;!o&&!d["#"]&&b in f?(q.onTagOpen(e[b]||""),q.onText(a)):(g(),j(),!l&&!o&&(a=a.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ")),a=new CKEDITOR.htmlParser.text(a),s(u,a)&&this.onTagOpen(k,{},0,1),u.add(a))}},q.onCDATA=function(a){u.add(new CKEDITOR.htmlParser.cdata(a))},q.onComment=function(a){g(),j(),u.add(new CKEDITOR.htmlParser.comment(a))},q.parse(d),g();u!=t;)y(u,u.parent,1);return m(t),t},CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(a,b){isNaN(b)&&(b=this.children.length);var c=b>0?this.children[b-1]:null;if(c){if(a._.isBlockLike&&c.type==CKEDITOR.NODE_TEXT&&(c.value=CKEDITOR.tools.rtrim(c.value),0===c.value.length))return this.children.pop(),void this.add(a);c.next=a}a.previous=c,a.parent=this,this.children.splice(b,0,a),this._.hasInlineStarted||(this._.hasInlineStarted=a.type==CKEDITOR.NODE_TEXT||a.type==CKEDITOR.NODE_ELEMENT&&!a._.isBlockLike)},filter:function(a,b){b=this.getFilterContext(b),a.onRoot(b,this),this.filterChildren(a,!1,b)},filterChildren:function(a,b,c){if(this.childrenFilteredBy!=a.id)for(c=this.getFilterContext(c),b&&!this.parent&&a.onRoot(c,this),this.childrenFilteredBy=a.id,b=0;b<this.children.length;b++)!1===this.children[b].filter(a,c)&&b--},writeHtml:function(a,b){b&&this.filter(b),this.writeChildrenHtml(a)},writeChildrenHtml:function(a,b,c){var e=this.getFilterContext();for(c&&!this.parent&&b&&b.onRoot(e,this),b&&this.filterChildren(b,!1,e),b=0,e=(c=this.children).length;b<e;b++)c[b].writeHtml(a)},forEach:function(a,b,c){if(!(c||b&&this.type!=b))var e=a(this);if(!1!==e)for(var c=this.children,f=0;f<c.length;f++)(e=c[f]).type==CKEDITOR.NODE_ELEMENT?e.forEach(a,b):(!b||e.type==b)&&a(e)},getFilterContext:function(a){return a||{}}}}(),function(){function a(){this.rules=[]}function f(b,c,e,d){var f,k;for(f in c)(k=b[f])||(k=b[f]=new a),k.add(c[f],e,d)}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(b){this.id=CKEDITOR.tools.getNextNumber(),this.elementNameRules=new a,this.attributeNameRules=new a,this.elementsRules={},this.attributesRules={},this.textRules=new a,this.commentRules=new a,this.rootRules=new a,b&&this.addRules(b,10)},proto:{addRules:function(a,c){var e;"number"==typeof c?e=c:c&&"priority"in c&&(e=c.priority),"number"!=typeof e&&(e=10),"object"!=typeof c&&(c={}),a.elementNames&&this.elementNameRules.addMany(a.elementNames,e,c),a.attributeNames&&this.attributeNameRules.addMany(a.attributeNames,e,c),a.elements&&f(this.elementsRules,a.elements,e,c),a.attributes&&f(this.attributesRules,a.attributes,e,c),a.text&&this.textRules.add(a.text,e,c),a.comment&&this.commentRules.add(a.comment,e,c),a.root&&this.rootRules.add(a.root,e,c)},applyTo:function(a){a.filter(this)},onElementName:function(a,c){return this.elementNameRules.execOnName(a,c)},onAttributeName:function(a,c){return this.attributeNameRules.execOnName(a,c)},onText:function(a,c,e){return this.textRules.exec(a,c,e)},onComment:function(a,c,e){return this.commentRules.exec(a,c,e)},onRoot:function(a,c){return this.rootRules.exec(a,c)},onElement:function(a,c){for(var d,e=[this.elementsRules["^"],this.elementsRules[c.name],this.elementsRules.$],f=0;f<3;f++)if(d=e[f]){if(!1===(d=d.exec(a,c,this)))return null;if(d&&d!=c)return this.onNode(a,d);if(c.parent&&!c.name)break}return c},onNode:function(a,c){var e=c.type;return e==CKEDITOR.NODE_ELEMENT?this.onElement(a,c):e==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(a,c.value)):e==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(a,c.value)):null},onAttribute:function(a,c,e,d){return(e=this.attributesRules[e])?e.exec(a,d,c,this):d}}}),CKEDITOR.htmlParser.filterRulesGroup=a,a.prototype={add:function(a,c,e){this.rules.splice(this.findIndex(c),0,{value:a,priority:c,options:e})},addMany:function(a,c,e){for(var d=[this.findIndex(c),0],f=0,k=a.length;f<k;f++)d.push({value:a[f],priority:c,options:e});this.rules.splice.apply(this.rules,d)},findIndex:function(a){for(var c=this.rules,e=c.length-1;e>=0&&a<c[e].priority;)e--;return e+1},exec:function(a,c){var j,g,m,y,e=c instanceof CKEDITOR.htmlParser.node||c instanceof CKEDITOR.htmlParser.fragment,d=Array.prototype.slice.call(arguments,1),f=this.rules,k=f.length;for(y=0;y<k;y++)if(e&&(j=c.type,g=c.name),m=f[y],!(a.nonEditable&&!m.options.applyToAll||a.nestedEditable&&m.options.excludeNestedEditable)){if(!1===(m=m.value.apply(null,d))||e&&m&&(m.name!=g||m.type!=j))return m;null!=m&&(d[0]=c=m)}return c},execOnName:function(a,c){for(var k,e=0,d=this.rules,f=d.length;c&&e<f;e++)k=d[e],!(a.nonEditable&&!k.options.applyToAll||a.nestedEditable&&k.options.excludeNestedEditable)&&(c=c.replace(k.value[0],k.value[1]));return c}}}(),function(){function a(a,f){function p(a){return a||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(""):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function r(a,e){return function(f){if(f.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var x,r,i=[],l=b(f);if(l)for(v(l,1)&&i.push(l);l;)d(l)&&(x=c(l))&&v(x)&&((r=c(x))&&!d(r)?i.push(x):(p(g).insertAfter(x),x.remove())),l=l.previous;for(l=0;l<i.length;l++)i[l].remove();(i=!a||!1!==("function"==typeof e?e(f):e))&&(i=!(!g&&!CKEDITOR.env.needsBrFiller&&f.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)&&(!(!g&&!CKEDITOR.env.needsBrFiller&&(document.documentMode>7||f.name in CKEDITOR.dtd.tr||f.name in CKEDITOR.dtd.$listItem))&&(!(i=b(f))||"form"==f.name&&"input"==i.name))),i&&f.add(p(a))}}}function v(a,b){if((!g||CKEDITOR.env.needsBrFiller)&&a.type==CKEDITOR.NODE_ELEMENT&&"br"==a.name&&!a.attributes["data-cke-eol"])return!0;var c;if(a.type==CKEDITOR.NODE_TEXT&&(c=a.value.match(i))){if(c.index&&(new CKEDITOR.htmlParser.text(a.value.substring(0,c.index)).insertBefore(a),a.value=c[0]),!CKEDITOR.env.needsBrFiller&&g&&(!b||a.parent.name in z))return!0;if(!g&&((c=a.previous)&&"br"==c.name||!c||d(c)))return!0}return!1}var o,n={elements:{}},g="html"==f,z=CKEDITOR.tools.extend({},l);for(o in z)"#"in u[o]||delete z[o];for(o in z)n.elements[o]=r(g,a.config.fillEmptyBlocks);return n.root=r(g,!1),n.elements.br=function(a){return function(b){if(b.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var f=b.attributes;if("data-cke-bogus"in f||"data-cke-eol"in f)delete f["data-cke-bogus"];else{for(f=b.next;f&&e(f);)f=f.next;var i=c(b);!f&&d(b.parent)?h(b.parent,p(a)):d(f)&&i&&!d(i)&&p(a).insertBefore(f)}}}}(g),n}function f(a,b){return a!=CKEDITOR.ENTER_BR&&!1!==b&&(a==CKEDITOR.ENTER_DIV?"div":"p")}function b(a){for(a=a.children[a.children.length-1];a&&e(a);)a=a.previous;return a}function c(a){for(a=a.previous;a&&e(a);)a=a.previous;return a}function e(a){return a.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(a.value)||a.type==CKEDITOR.NODE_ELEMENT&&a.attributes["data-cke-bookmark"]}function d(a){return a&&(a.type==CKEDITOR.NODE_ELEMENT&&a.name in l||a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function h(a,b){var c=a.children[a.children.length-1];a.children.push(b),b.parent=a,c&&(c.next=b,b.previous=c)}function k(a){"false"!=(a=a.attributes).contenteditable&&(a["data-cke-editable"]=a.contenteditable?"true":1),a.contenteditable="false"}function j(a){switch((a=a.attributes)["data-cke-editable"]){case"true":a.contenteditable="true";break;case"1":delete a.contenteditable}}function g(a){return a.replace(C,function(a,b,c){return"<"+b+c.replace(L,function(a,b){return F.test(b)&&-1==c.indexOf("data-cke-saved-"+b)?" data-cke-saved-"+a+" data-cke-"+CKEDITOR.rnd+"-"+a:a})+">"})}function m(a,b){return a.replace(b,function(a,b,c){return 0===a.indexOf("<textarea")&&(a=b+w(c).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>"),"<cke:encoded>"+encodeURIComponent(a)+"</cke:encoded>"})}function y(a){return a.replace(v,function(a,b){return decodeURIComponent(b)})}function s(a){return a.replace(/<\!--(?!{cke_protected})[\s\S]+?--\>/g,function(a){return"\x3c!--"+A+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\x3e"})}function w(a){return a.replace(/<\!--\{cke_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}function q(a,b){var c=b._.dataStore;return a.replace(/<\!--\{cke_protected\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)}).replace(/\{cke_protected_(\d+)\}/g,function(a,b){return c&&c[b]||""})}function t(a,b){for(var c=[],d=b.config.protectedSource,e=b._.dataStore||(b._.dataStore={id:1}),f=/<\!--\{cke_temp(comment)?\}(\d*?)--\>/g,d=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(d),a=a.replace(/<\!--[\s\S]*?--\>/g,function(a){return"\x3c!--{cke_tempcomment}"+(c.push(a)-1)+"--\x3e"}),i=0;i<d.length;i++)a=a.replace(d[i],function(a){return a=a.replace(f,function(a,b,d){return c[d]}),/cke_temp(comment)?/.test(a)?a:"\x3c!--{cke_temp}"+(c.push(a)-1)+"--\x3e"});return a=a.replace(f,function(a,b,d){return"\x3c!--"+A+(b?"{C}":"")+encodeURIComponent(c[d]).replace(/--/g,"%2D%2D")+"--\x3e"}),a=a.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=>]+))+\s*>/g,function(a){return a.replace(/<\!--\{cke_protected\}([^>]*)--\>/g,function(a,b){return e[e.id]=decodeURIComponent(b),"{cke_protected_"+e.id+++"}"})}),a=a.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,function(a,c,d,e){return"<"+c+d+">"+q(w(e),b)+"</"+c+">"})}CKEDITOR.htmlDataProcessor=function(b){var c,d,e=this;this.editor=b,this.dataFilter=c=new CKEDITOR.htmlParser.filter,this.htmlFilter=d=new CKEDITOR.htmlParser.filter,this.writer=new CKEDITOR.htmlParser.basicWriter,c.addRules(p),c.addRules(r,{applyToAll:!0}),c.addRules(a(b,"data"),{applyToAll:!0}),d.addRules(n),d.addRules(P,{applyToAll:!0}),d.addRules(a(b,"html"),{applyToAll:!0}),b.on("toHtml",function(a){var d,c=(c=(c=(c=(c=m(c=g(c=m(c=t(c=(a=a.data).dataValue,b),I)),K)).replace(G,"$1cke:$2")).replace(B,"<cke:$1$2></cke:$1>")).replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2")).replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+CKEDITOR.rnd+"-$2");d=a.context||b.editable().getName();var e;CKEDITOR.env.ie&&CKEDITOR.env.version<9&&"pre"==d&&(d="div",c="<pre>"+c+"</pre>",e=1),(d=b.document.createElement(d)).setHtml("a"+c),c=(c=d.getHtml().substr(1)).replace(RegExp("data-cke-"+CKEDITOR.rnd+"-","ig"),""),e&&(c=c.replace(/^<pre>|<\/pre>$/gi,"")),c=w(c=y(c=c.replace(z,"$1$2"))),d=!1!==a.fixForBody&&f(a.enterMode,b.config.autoParagraph),c=CKEDITOR.htmlParser.fragment.fromHtml(c,a.context,d),d&&!(e=c).children.length&&CKEDITOR.dtd[e.name][d]&&(d=new CKEDITOR.htmlParser.element(d),e.add(d)),a.dataValue=c},null,null,5),b.on("toHtml",function(a){a.data.filter.applyTo(a.data.dataValue,!0,a.data.dontFilter,a.data.enterMode)&&b.fire("dataFiltered")},null,null,6),b.on("toHtml",function(a){a.data.dataValue.filterChildren(e.dataFilter,!0)},null,null,10),b.on("toHtml",function(a){var b=(a=a.data).dataValue,c=new CKEDITOR.htmlParser.basicWriter;b.writeChildrenHtml(c),b=c.getHtml(!0),a.dataValue=s(b)},null,null,15),b.on("toDataFormat",function(a){var c=a.data.dataValue;a.data.enterMode!=CKEDITOR.ENTER_BR&&(c=c.replace(/^<br *\/?>/i,"")),a.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(c,a.data.context,f(a.data.enterMode,b.config.autoParagraph))},null,null,5),b.on("toDataFormat",function(a){a.data.dataValue.filterChildren(e.htmlFilter,!0)},null,null,10),b.on("toDataFormat",function(a){a.data.filter.applyTo(a.data.dataValue,!1,!0)},null,null,11),b.on("toDataFormat",function(a){var c=a.data.dataValue,d=e.writer;d.reset(),c.writeChildrenHtml(d),c=q(c=w(c=d.getHtml(!0)),b),a.data.dataValue=c},null,null,15)},CKEDITOR.htmlDataProcessor.prototype={toHtml:function(a,b,c,d){var f,i,l,e=this.editor;return b&&"object"==typeof b?(f=b.context,c=b.fixForBody,d=b.dontFilter,i=b.filter,l=b.enterMode):f=b,!f&&null!==f&&(f=e.editable().getName()),e.fire("toHtml",{dataValue:a,context:f,fixForBody:c,dontFilter:d,filter:i||e.filter,enterMode:l||e.enterMode}).dataValue},toDataFormat:function(a,b){var c,d,e;return b&&(c=b.context,d=b.filter,e=b.enterMode),!c&&null!==c&&(c=this.editor.editable().getName()),this.editor.fire("toDataFormat",{dataValue:a,filter:d||this.editor.filter,context:c,enterMode:e||this.editor.enterMode}).dataValue}};var i=/(?:&nbsp;|\xa0)$/,A="{cke_protected}",u=CKEDITOR.dtd,o=["caption","colgroup","col","thead","tfoot","tbody"],l=CKEDITOR.tools.extend({},u.$blockLimit,u.$block),p={elements:{input:k,textarea:k}},r={attributeNames:[[/^on/,"data-cke-pa-on"],[/^data-cke-expando$/,""]]},n={elements:{embed:function(a){if((b=a.parent)&&"object"==b.name){var c=b.attributes.width,b=b.attributes.height;c&&(a.attributes.width=c),b&&(a.attributes.height=b)}},a:function(a){if(!a.children.length&&!a.attributes.name&&!a.attributes["data-cke-saved-name"])return!1}}},P={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(a){var b=a.attributes;if(b){if(b["data-cke-temp"])return!1;for(var c=["name","href","src"],e=0;e<c.length;e++)"data-cke-saved-"+c[e]in b&&delete b[c[e]]}return a},table:function(a){a.children.slice(0).sort(function(a,b){var c,d;return a.type==CKEDITOR.NODE_ELEMENT&&b.type==a.type&&(c=CKEDITOR.tools.indexOf(o,a.name),d=CKEDITOR.tools.indexOf(o,b.name)),c>-1&&d>-1&&c!=d||(c=a.parent?a.getIndex():-1,d=b.parent?b.getIndex():-1),c>d?1:-1})},param:function(a){return a.children=[],a.isEmpty=!0,a},span:function(a){"Apple-style-span"==a.attributes.class&&delete a.name},html:function(a){delete a.attributes.contenteditable,delete a.attributes.class},body:function(a){delete a.attributes.spellcheck,delete a.attributes.contenteditable},style:function(a){var b=a.children[0];b&&b.value&&(b.value=CKEDITOR.tools.trim(b.value)),a.attributes.type||(a.attributes.type="text/css")},title:function(a){var b=a.children[0];!b&&h(a,b=new CKEDITOR.htmlParser.text),b.value=a.attributes["data-cke-title"]||""},input:j,textarea:j},attributes:{class:function(a){return CKEDITOR.tools.ltrim(a.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}}};CKEDITOR.env.ie&&(P.attributes.style=function(a){return a.replace(/(^|;)([^\:]+)/g,function(a){return a.toLowerCase()})});var C=/<(a|area|img|input|source)\b([^>]*)>/gi,L=/([\w-]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,F=/^(href|src|name)$/i,K=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,I=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,v=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,G=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,z=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,B=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi}(),CKEDITOR.htmlParser.element=function(a,f){this.name=a,this.attributes=f||{},this.children=[];var b=a||"",c=b.match(/^cke:(.*)/);c&&(b=c[1]),b=!!(CKEDITOR.dtd.$nonBodyContent[b]||CKEDITOR.dtd.$block[b]||CKEDITOR.dtd.$listItem[b]||CKEDITOR.dtd.$tableContent[b]||CKEDITOR.dtd.$nonEditable[b]||"br"==b),this.isEmpty=!!CKEDITOR.dtd.$empty[a],this.isUnknown=!CKEDITOR.dtd[a],this._={isBlockLike:b,hasInlineStarted:this.isEmpty||!b}},CKEDITOR.htmlParser.cssStyle=function(a){var f={};return((a instanceof CKEDITOR.htmlParser.element?a.attributes.style:a)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,e){"font-family"==c&&(e=e.replace(/["']/g,"")),f[c.toLowerCase()]=e}),{rules:f,populate:function(a){var c=this.toString();c&&(a instanceof CKEDITOR.dom.element?a.setAttribute("style",c):a instanceof CKEDITOR.htmlParser.element?a.attributes.style=c:a.style=c)},toString:function(){var c,a=[];for(c in f)f[c]&&a.push(c,":",f[c],";");return a.join("")}}},function(){function a(a){return function(b){return b.type==CKEDITOR.NODE_ELEMENT&&("string"==typeof a?b.name==a:b.name in a)}}var f=function(a,b){return a=a[0],b=b[0],a<b?-1:a>b?1:0},b=CKEDITOR.htmlParser.fragment.prototype;CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:b.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(a,b){var f,k,d=this;if((b=d.getFilterContext(b)).off)return!0;for(d.parent||a.onRoot(b,d);;){if(f=d.name,!(k=a.onElementName(b,f)))return this.remove(),!1;if(d.name=k,!(d=a.onElement(b,d)))return this.remove(),!1;if(d!==this)return this.replaceWith(d),!1;if(d.name==f)break;if(d.type!=CKEDITOR.NODE_ELEMENT)return this.replaceWith(d),!1;if(!d.name)return this.replaceWithChildren(),!1}f=d.attributes;var j,g;for(j in f){for(g=j,k=f[j];;){if(!(g=a.onAttributeName(b,j))){delete f[j];break}if(g==j)break;delete f[j],j=g}g&&(!1===(k=a.onAttribute(b,d,g,k))?delete f[g]:f[g]=k)}return d.isEmpty||this.filterChildren(a,!1,b),!0},filterChildren:b.filterChildren,writeHtml:function(a,b){b&&this.filter(b);var j,g,d=this.name,h=[],k=this.attributes;a.openTag(d,k);for(j in k)h.push([j,k[j]]);for(a.sortAttributes&&h.sort(f),j=0,g=h.length;j<g;j++)k=h[j],a.attribute(k[0],k[1]);a.openTagClose(d,this.isEmpty),this.writeChildrenHtml(a),this.isEmpty||a.closeTag(d)},writeChildrenHtml:b.writeChildrenHtml,replaceWithChildren:function(){for(var a=this.children,b=a.length;b;)a[--b].insertAfter(this);this.remove()},forEach:b.forEach,getFirst:function(b){if(!b)return this.children.length?this.children[0]:null;"function"!=typeof b&&(b=a(b));for(var e=0,d=this.children.length;e<d;++e)if(b(this.children[e]))return this.children[e];return null},getHtml:function(){var a=new CKEDITOR.htmlParser.basicWriter;return this.writeChildrenHtml(a),a.getHtml()},setHtml:function(a){for(var b=0,d=(a=this.children=CKEDITOR.htmlParser.fragment.fromHtml(a).children).length;b<d;++b)a[b].parent=this},getOuterHtml:function(){var a=new CKEDITOR.htmlParser.basicWriter;return this.writeHtml(a),a.getHtml()},split:function(a){for(var b=this.children.splice(a,this.children.length-a),d=this.clone(),f=0;f<b.length;++f)b[f].parent=d;return d.children=b,b[0]&&(b[0].previous=null),a>0&&(this.children[a-1].next=null),this.parent.add(d,this.getIndex()+1),d},addClass:function(a){if(!this.hasClass(a)){var b=this.attributes.class||"";this.attributes.class=b+(b?" ":"")+a}},removeClass:function(a){var b=this.attributes.class;b&&((b=CKEDITOR.tools.trim(b.replace(RegExp("(?:\\s+|^)"+a+"(?:\\s+|$)")," ")))?this.attributes.class=b:delete this.attributes.class)},hasClass:function(a){var b=this.attributes.class;return!!b&&RegExp("(?:^|\\s)"+a+"(?=\\s|$)").test(b)},getFilterContext:function(a){var b=[];if(a||(a={off:!1,nonEditable:!1,nestedEditable:!1}),!a.off&&"off"==this.attributes["data-cke-processor"]&&b.push("off",!0),a.nonEditable||"false"!=this.attributes.contenteditable?a.nonEditable&&!a.nestedEditable&&"true"==this.attributes.contenteditable&&b.push("nestedEditable",!0):b.push("nonEditable",!0),b.length)for(var a=CKEDITOR.tools.copy(a),d=0;d<b.length;d+=2)a[b[d]]=b[d+1];return a}},!0)}(),function(){var a={},f=/{([^}]+)}/g,b=/([\\'])/g,c=/\n/g,e=/\r/g;CKEDITOR.template=function(d){if(a[d])this.output=a[d];else{var h=d.replace(b,"\\$1").replace(c,"\\n").replace(e,"\\r").replace(f,function(a,b){return"',data['"+b+"']==undefined?'{"+b+"}':data['"+b+"'],'"});this.output=a[d]=Function("data","buffer","return buffer?buffer.push('"+h+"'):['"+h+"'].join('');")}}}(),delete CKEDITOR.loadFullCore,CKEDITOR.instances={},CKEDITOR.document=new CKEDITOR.dom.document(document),CKEDITOR.add=function(a){CKEDITOR.instances[a.name]=a,a.on("focus",function(){CKEDITOR.currentInstance!=a&&(CKEDITOR.currentInstance=a,CKEDITOR.fire("currentInstance"))}),a.on("blur",function(){CKEDITOR.currentInstance==a&&(CKEDITOR.currentInstance=null,CKEDITOR.fire("currentInstance"))}),CKEDITOR.fire("instance",null,a)},CKEDITOR.remove=function(a){delete CKEDITOR.instances[a.name]},function(){var a={};CKEDITOR.addTemplate=function(f,b){var c=a[f];return c||(c={name:f,source:b},CKEDITOR.fire("template",c),a[f]=new CKEDITOR.template(c.source))},CKEDITOR.getTemplate=function(f){return a[f]}}(),function(){var a=[];CKEDITOR.addCss=function(f){a.push(f)},CKEDITOR.getCss=function(){return a.join("\n")}}(),CKEDITOR.on("instanceDestroyed",function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")}),CKEDITOR.TRISTATE_ON=1,CKEDITOR.TRISTATE_OFF=2,CKEDITOR.TRISTATE_DISABLED=0,CKEDITOR.inline=function(a,f){if(!CKEDITOR.env.isCompatible)return null;if((a=CKEDITOR.dom.element.get(a)).getEditor())throw'The editor instance "'+a.getEditor().name+'" is already attached to the provided element.';var b=new CKEDITOR.editor(f,a,CKEDITOR.ELEMENT_MODE_INLINE),c=a.is("textarea")?a:null;return c?(b.setData(c.getValue(),null,!0),(a=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!b.readOnly+'" class="cke_textarea_inline">'+c.getValue()+"</div>",CKEDITOR.document)).insertAfter(c),c.hide(),c.$.form&&b._attachToForm()):b.setData(a.getHtml(),null,!0),b.on("loaded",function(){b.fire("uiReady"),b.editable(a),b.container=a,b.setData(b.getData(1)),b.resetDirty(),b.fire("contentDom"),b.mode="wysiwyg",b.fire("mode"),b.status="ready",b.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,b)},null,null,1e4),b.on("destroy",function(){c&&(b.container.clearCustomData(),b.container.remove(),c.show()),b.element.clearCustomData(),delete b.element}),b},CKEDITOR.inlineAll=function(){var a,f,b;for(b in CKEDITOR.dtd.$editable)for(var c=CKEDITOR.document.getElementsByTag(b),e=0,d=c.count();e<d;e++)"true"==(a=c.getItem(e)).getAttribute("contenteditable")&&(f={element:a,config:{}},!1!==CKEDITOR.fire("inline",f)&&CKEDITOR.inline(a,f.config))},CKEDITOR.domReady(function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()}),CKEDITOR.replaceClass="ckeditor",function(){function a(a,e,d,h){if(!CKEDITOR.env.isCompatible)return null;if((a=CKEDITOR.dom.element.get(a)).getEditor())throw'The editor instance "'+a.getEditor().name+'" is already attached to the provided element.';var k=new CKEDITOR.editor(e,a,h);return h==CKEDITOR.ELEMENT_MODE_REPLACE&&(a.setStyle("visibility","hidden"),k._.required=a.hasAttribute("required"),a.removeAttribute("required")),d&&k.setData(d,null,!0),k.on("loaded",function(){b(k),h==CKEDITOR.ELEMENT_MODE_REPLACE&&k.config.autoUpdateElement&&a.$.form&&k._attachToForm(),k.setMode(k.config.startupMode,function(){k.resetDirty(),k.status="ready",k.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,k)})}),k.on("destroy",f),k}function f(){var a=this.container,b=this.element;a&&(a.clearCustomData(),a.remove()),b&&(b.clearCustomData(),this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(b.show(),this._.required&&b.setAttribute("required","required")),delete this.element)}function b(a){var b=a.name,d=a.element,f=a.elementMode,k=a.fire("uiSpace",{space:"top",html:""}).html,j=a.fire("uiSpace",{space:"bottom",html:""}).html,g=new CKEDITOR.template('<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application"'+(a.title?' aria-labelledby="cke_{name}_arialbl"':"")+">"+(a.title?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':"")+'<{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>'),b=CKEDITOR.dom.element.createFromHtml(g.output({id:a.id,name:b,langDir:a.lang.dir,langCode:a.langCode,voiceLabel:a.title,topHtml:k?'<span id="'+a.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+k+"</span>":"",contentId:a.ui.spaceId("contents"),bottomHtml:j?'<span id="'+a.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+j+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"}));f==CKEDITOR.ELEMENT_MODE_REPLACE?(d.hide(),b.insertAfter(d)):d.append(b),a.container=b,k&&a.ui.space("top").unselectable(),j&&a.ui.space("bottom").unselectable(),d=a.config.width,f=a.config.height,d&&b.setStyle("width",CKEDITOR.tools.cssLength(d)),f&&a.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(f)),b.disableContextMenu(),CKEDITOR.env.webkit&&b.on("focus",function(){a.focus()}),a.fireOnce("uiReady")}CKEDITOR.replace=function(b,e){return a(b,e,null,CKEDITOR.ELEMENT_MODE_REPLACE)},CKEDITOR.appendTo=function(b,e,d){return a(b,e,d,CKEDITOR.ELEMENT_MODE_APPENDTO)},CKEDITOR.replaceAll=function(){for(var a=document.getElementsByTagName("textarea"),b=0;b<a.length;b++){var d=null,f=a[b];if(f.name||f.id){if("string"==typeof arguments[0]){if(!RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(f.className))continue}else if("function"==typeof arguments[0]&&(d={},!1===arguments[0](f,d)))continue;this.replace(f,d)}}},CKEDITOR.editor.prototype.addMode=function(a,b){(this._.modes||(this._.modes={}))[a]=b},CKEDITOR.editor.prototype.setMode=function(a,b){var d=this,f=this._.modes;if(a!=d.mode&&f&&f[a]){if(d.fire("beforeSetMode",a),d.mode){var j,k=d.checkDirty(),f=d._.previousModeData,g=0;d.fire("beforeModeUnload"),d.editable(0),d._.previousMode=d.mode,d._.previousModeData=j=d.getData(1),"source"==d.mode&&f==j&&(d.fire("lockSnapshot",{forceUpdate:!0}),g=1),d.ui.space("contents").setHtml(""),d.mode=""}else d._.previousModeData=d.getData(1);this._.modes[a](function(){d.mode=a,void 0!==k&&!k&&d.resetDirty(),g?d.fire("unlockSnapshot"):"wysiwyg"==a&&d.fire("saveSnapshot"),setTimeout(function(){d.fire("mode"),b&&b.call(d)},0)})}},CKEDITOR.editor.prototype.resize=function(a,b,d,f){var k=this.container,j=this.ui.space("contents"),g=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement;(f=f?this.container.getFirst(function(a){return a.type==CKEDITOR.NODE_ELEMENT&&a.hasClass("cke_inner")}):k).setSize("width",a,!0),g&&(g.style.width="1%"),j.setStyle("height",Math.max(b-(d?0:(f.$.offsetHeight||0)-(j.$.clientHeight||0)),0)+"px"),g&&(g.style.width="100%"),this.fire("resize")},CKEDITOR.editor.prototype.getResizable=function(a){return a?this.ui.space("contents"):this.container},CKEDITOR.domReady(function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)})}(),CKEDITOR.config.startupMode="wysiwyg",function(){function a(a){var r,b=a.editor,d=a.data.path,e=d.blockLimit,l=a.data.selection,p=l.getRanges()[0];(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)&&(l=f(l,d))&&(l.appendBogus(),r=CKEDITOR.env.ie),h(b,d.block,e)&&p.collapsed&&!p.getCommonAncestor().isReadOnly()&&((d=p.clone()).enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),(e=new CKEDITOR.dom.walker(d)).guard=function(a){return!c(a)||a.type==CKEDITOR.NODE_COMMENT||a.isReadOnly()},(!e.checkForward()||d.checkStartOfBlock()&&d.checkEndOfBlock())&&(b=p.fixBlock(!0,b.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"),CKEDITOR.env.needsBrFiller||(b=b.getFirst(c))&&b.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(b.getText()).match(/^(?:&nbsp;|\xa0)$/)&&b.remove(),r=1,a.cancel())),r&&p.select()}function f(a,b){if(a.isFake)return 0;var d=b.block||b.blockLimit,e=d&&d.getLast(c);return!d||!d.isBlockBoundary()||e&&e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary()||d.is("pre")||d.getBogus()?void 0:d}function b(a){var b=a.data.getTarget();b.is("input")&&("submit"==(b=b.getAttribute("type"))||"reset"==b)&&a.data.preventDefault()}function c(a){return s(a)&&w(a)}function e(a,b){return function(c){var d=CKEDITOR.dom.element.get(c.data.$.toElement||c.data.$.fromElement||c.data.$.relatedTarget);(!d||!b.equals(d)&&!b.contains(d))&&a.call(this,c)}}function d(a){function b(a){return function(b,e){if(e&&b.type==CKEDITOR.NODE_ELEMENT&&b.is(f)&&(d=b),!e&&c(b)&&(!a||!m(b)))return!1}}var d,e=a.getRanges()[0],a=a.root,f={table:1,ul:1,ol:1,dl:1};if(e.startPath().contains(f)){var p=e.clone();if(p.collapse(1),p.setStartAt(a,CKEDITOR.POSITION_AFTER_START),a=new CKEDITOR.dom.walker(p),a.guard=b(),a.checkBackward(),d)return(p=e.clone()).collapse(),p.setEndAt(d,CKEDITOR.POSITION_AFTER_END),a=new CKEDITOR.dom.walker(p),a.guard=b(!0),d=!1,a.checkForward(),d}return null}function h(a,b,c){return!1!==a.config.autoParagraph&&a.activeEnterMode!=CKEDITOR.ENTER_BR&&a.editable().equals(c)&&!b||b&&"true"==b.getAttribute("contenteditable")}function k(a){a.editor.focus(),a.editor.fire("saveSnapshot")}function j(a){var b=a.editor;b.getSelection().scrollIntoView(),setTimeout(function(){b.fire("saveSnapshot")},0)}function g(a,b,c){for(var d=a.getCommonAncestor(b),b=a=c?b:a;(a=a.getParent())&&!d.equals(a)&&1==a.getChildCount();)b=a;b.remove()}CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(a,b){this.base(b.$||b),this.editor=a,this.status="unloaded",this.hasFocus=!1,this.setup()},proto:{focus:function(){var a;if(CKEDITOR.env.webkit&&!this.hasFocus&&(a=this.editor._.previousActive||this.getDocument().getActive(),this.contains(a)))a.focus();else{try{this.$[CKEDITOR.env.ie&&this.getDocument().equals(CKEDITOR.document)?"setActive":"focus"]()}catch(b){if(!CKEDITOR.env.ie)throw b}CKEDITOR.env.safari&&!this.isInline()&&((a=CKEDITOR.document.getActive()).equals(this.getWindow().getFrame())||this.getWindow().focus())}},on:function(a,b){var c=Array.prototype.slice.call(arguments,0);return CKEDITOR.env.ie&&/^focus|blur$/.exec(a)&&(a="focus"==a?"focusin":"focusout",b=e(b,this),c[0]=a,c[1]=b),CKEDITOR.dom.element.prototype.on.apply(this,c)},attachListener:function(a){!this._.listeners&&(this._.listeners=[]);var b=Array.prototype.slice.call(arguments,1),b=a.on.apply(a,b);return this._.listeners.push(b),b},clearListeners:function(){var a=this._.listeners;try{for(;a.length;)a.pop().removeListener()}catch(b){}},restoreAttrs:function(){var b,c,a=this._.attrChanges;for(c in a)a.hasOwnProperty(c)&&(null!==(b=a[c])?this.setAttribute(c,b):this.removeAttribute(c))},attachClass:function(a){var b=this.getCustomData("classes");this.hasClass(a)||(!b&&(b=[]),b.push(a),this.setCustomData("classes",b),this.addClass(a))},changeAttr:function(a,b){var c=this.getAttribute(a);b!==c&&(!this._.attrChanges&&(this._.attrChanges={}),a in this._.attrChanges||(this._.attrChanges[a]=c),this.setAttribute(a,b))},insertHtml:function(a,b){k(this),q(this,b||"html",a)},insertText:function(a){k(this);var b=(c=(b=this.editor).getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:b.activeEnterMode)==CKEDITOR.ENTER_BR,d=CKEDITOR.tools,a=(a=d.htmlEncode(a.replace(/\r\n/g,"\n"))).replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),c=c==CKEDITOR.ENTER_P?"p":"div";if(!b){var e=/\n{2}/g;if(e.test(a))var f="<"+c+">",r="</"+c+">",a=f+a.replace(e,function(){return r+f})+r}a=a.replace(/\n/g,"<br>"),b||(a=a.replace(RegExp("<br>(?=</"+c+">)"),function(a){return d.repeat(a,2)})),a=(a=a.replace(/^ | $/g,"&nbsp;")).replace(/(>|\s) /g,function(a,b){return b+"&nbsp;"}).replace(/ (?=<)/g,"&nbsp;"),q(this,"text",a)},insertElement:function(a,b){b?this.insertElementIntoRange(a,b):this.insertElementIntoSelection(a)},insertElementIntoRange:function(a,b){var c=this.editor,d=c.config.enterMode,e=a.getName(),f=CKEDITOR.dtd.$block[e];if(b.checkReadOnly())return!1;b.deleteContents(1),b.startContainer.type==CKEDITOR.NODE_ELEMENT&&b.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})&&t(b);var r,n;if(f)for(;(r=b.getCommonAncestor(0,1))&&(n=CKEDITOR.dtd[r.getName()])&&(!n||!n[e]);)r.getName()in CKEDITOR.dtd.span?b.splitElement(r):b.checkStartOfBlock()&&b.checkEndOfBlock()?(b.setStartBefore(r),b.collapse(!0),r.remove()):b.splitBlock(d==CKEDITOR.ENTER_DIV?"div":"p",c.editable());return b.insertNode(a),!0},insertElementIntoSelection:function(a){k(this);var b=this.editor,d=b.activeEnterMode,e=(b=b.getSelection()).getRanges()[0],f=a.getName(),f=CKEDITOR.dtd.$block[f];this.insertElementIntoRange(a,e)&&(e.moveToPosition(a,CKEDITOR.POSITION_AFTER_END),f&&((f=a.getNext(function(a){return c(a)&&!m(a)}))&&f.type==CKEDITOR.NODE_ELEMENT&&f.is(CKEDITOR.dtd.$block)?f.getDtd()["#"]?e.moveToElementEditStart(f):e.moveToElementEditEnd(a):f||d==CKEDITOR.ENTER_BR||(f=e.fixBlock(!0,d==CKEDITOR.ENTER_DIV?"div":"p"),e.moveToElementEditStart(f)))),b.selectRanges([e]),j(this)},setData:function(a,b){b||(a=this.editor.dataProcessor.toHtml(a)),this.setHtml(a),this.fixInitialSelection(),"unloaded"==this.status&&(this.status="ready"),this.editor.fire("dataReady")},getData:function(a){var b=this.getHtml();return a||(b=this.editor.dataProcessor.toDataFormat(b)),b},setReadOnly:function(a){this.setAttribute("contenteditable",!a)},detach:function(){this.removeClass("cke_editable"),this.status="detached";var a=this.editor;this._.detach(),delete a.document,delete a.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function a(){var e,b=c.getDocument().$,d=b.getSelection();if(d.anchorNode&&d.anchorNode==c.$)e=!0;else if(CKEDITOR.env.webkit){var f=c.getDocument().getActive();f&&f.equals(c)&&!d.anchorNode&&(e=!0)}e&&((e=new CKEDITOR.dom.range(c)).moveToElementEditStart(c),(b=b.createRange()).setStart(e.startContainer.$,e.startOffset),b.collapse(!0),d.removeAllRanges(),d.addRange(b))}var c=this;CKEDITOR.env.ie&&(CKEDITOR.env.version<9||CKEDITOR.env.quirks)?this.hasFocus&&(this.focus(),function(){var a=c.getDocument().$,d=a.selection,e=c.getDocument().getActive();"None"==d.type&&e.equals(c)&&(d=new CKEDITOR.dom.range(c),a=a.body.createTextRange(),d.moveToElementEditStart(c),(d=d.startContainer).type!=CKEDITOR.NODE_ELEMENT&&(d=d.getParent()),a.moveToElementText(d.$),a.collapse(!0),a.select())}()):this.hasFocus?(this.focus(),a()):this.once("focus",function(){a()},null,null,-999)},setup:function(){var a=this.editor;if(this.attachListener(a,"beforeGetData",function(){var b=this.getData();this.is("textarea")||!1!==a.config.ignoreEmptyParagraph&&(b=b.replace(y,function(a,b){return b})),a.setData(b,null,1)},this),this.attachListener(a,"getSnapshot",function(a){a.data=this.getData(1)},this),this.attachListener(a,"afterSetData",function(){this.setData(a.getData(1))},this),this.attachListener(a,"loadSnapshot",function(a){this.setData(a.data,1)},this),this.attachListener(a,"beforeFocus",function(){var b=a.getSelection();(b=b&&b.getNative())&&"Control"==b.type||this.focus()},this),this.attachListener(a,"insertHtml",function(a){this.insertHtml(a.data.dataValue,a.data.mode)},this),this.attachListener(a,"insertElement",function(a){this.insertElement(a.data)},this),this.attachListener(a,"insertText",function(a){this.insertText(a.data)},this),this.setReadOnly(a.readOnly),this.attachClass("cke_editable"),this.attachClass(a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"cke_editable_inline":a.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE||a.elementMode==CKEDITOR.ELEMENT_MODE_APPENDTO?"cke_editable_themed":""),this.attachClass("cke_contents_"+a.config.contentsLangDirection),a.keystrokeHandler.blockedKeystrokes[8]=+a.readOnly,a.keystrokeHandler.attach(this),this.on("blur",function(){this.hasFocus=!1},null,null,-1),this.on("focus",function(){this.hasFocus=!0},null,null,-1),a.focusManager.add(this),this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,a.once("contentDom",function(){a.focusManager.focus(this)},this)),this.isInline()&&this.changeAttr("tabindex",a.tabIndex),!this.is("textarea")){a.document=this.getDocument(),a.window=this.getWindow();var e=a.document;this.changeAttr("spellcheck",!a.config.disableNativeSpellChecker);var f=a.config.contentsLangDirection;this.getDirection(1)!=f&&this.changeAttr("dir",f);var h=CKEDITOR.getCss();h&&((f=e.getHead()).getCustomData("stylesheet")||(h=e.appendStyleText(h),h=new CKEDITOR.dom.element(h.ownerNode||h.owningElement),f.setCustomData("stylesheet",h),h.data("cke-temp",1))),f=e.getCustomData("stylesheet_ref")||0,e.setCustomData("stylesheet_ref",f+1),this.setCustomData("cke_includeReadonly",!a.config.disableReadonlyStyling),this.attachListener(this,"click",function(a){var a=a.data,b=new CKEDITOR.dom.elementPath(a.getTarget(),this).contains("a");b&&2!=a.$.button&&b.isReadOnly()&&a.preventDefault()});var l={8:1,46:1};this.attachListener(a,"key",function(b){if(a.readOnly)return!0;var e;if((c=b.data.domEvent.getKey())in l){var f,o,m,j,h=(b=a.getSelection()).getRanges()[0],g=h.startPath(),c=8==c;CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(f=b.getSelectedElement())||(f=d(b))?(a.fire("saveSnapshot"),h.moveToPosition(f,CKEDITOR.POSITION_BEFORE_START),f.remove(),h.select(),a.fire("saveSnapshot"),e=1):h.collapsed&&((o=g.block)&&(j=o[c?"getPrevious":"getNext"](s))&&j.type==CKEDITOR.NODE_ELEMENT&&j.is("table")&&h[c?"checkStartOfBlock":"checkEndOfBlock"]()?(a.fire("saveSnapshot"),h[c?"checkEndOfBlock":"checkStartOfBlock"]()&&o.remove(),h["moveToElementEdit"+(c?"End":"Start")](j),h.select(),a.fire("saveSnapshot"),e=1):g.blockLimit&&g.blockLimit.is("td")&&(m=g.blockLimit.getAscendant("table"))&&h.checkBoundaryOfElement(m,c?CKEDITOR.START:CKEDITOR.END)&&(j=m[c?"getPrevious":"getNext"](s))?(a.fire("saveSnapshot"),h["moveToElementEdit"+(c?"End":"Start")](j),h.checkStartOfBlock()&&h.checkEndOfBlock()?j.remove():h.select(),a.fire("saveSnapshot"),e=1):(m=g.contains(["td","th","caption"]))&&h.checkBoundaryOfElement(m,c?CKEDITOR.START:CKEDITOR.END)&&(e=1))}return!e}),a.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",function(b){b.data.getKeystroke()in l&&!this.getFirst(c)&&(this.appendBogus(),(b=a.createRange()).moveToPosition(this,CKEDITOR.POSITION_AFTER_START),b.select())}),this.attachListener(this,"dblclick",function(b){if(a.readOnly)return!1;b={element:b.data.getTarget()},a.fire("doubleclick",b)}),CKEDITOR.env.ie&&this.attachListener(this,"click",b),CKEDITOR.env.ie||this.attachListener(this,"mousedown",function(b){var c=b.data.getTarget();c.is("img","hr","input","textarea","select")&&!c.isReadOnly()&&(a.getSelection().selectElement(c),c.is("input","textarea","select")&&b.data.preventDefault())}),CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(b){if(2==b.data.$.button&&!(b=b.data.getTarget()).getOuterHtml().replace(y,"")){var c=a.createRange();c.moveToElementEditStart(b),c.select(!0)}}),CKEDITOR.env.webkit&&(this.attachListener(this,"click",function(a){a.data.getTarget().is("input","select")&&a.data.preventDefault()}),this.attachListener(this,"mouseup",function(a){a.data.getTarget().is("input","textarea")&&a.data.preventDefault()})),CKEDITOR.env.webkit&&this.attachListener(a,"key",function(b){if((b=b.data.domEvent.getKey())in l){var c=8==b,d=a.getSelection().getRanges()[0],b=d.startPath();if(d.collapsed){var e;a:{var f=b.block;if(f)if(d[c?"checkStartOfBlock":"checkEndOfBlock"]())if(d.moveToClosestEditablePosition(f,!c)&&d.collapsed){if(d.startContainer.type==CKEDITOR.NODE_ELEMENT){var h=d.startContainer.getChild(d.startOffset-(c?1:0));if(h&&h.type==CKEDITOR.NODE_ELEMENT&&h.is("hr")){a.fire("saveSnapshot"),h.remove(),e=!0;break a}}if((d=d.startPath().block)&&(!d||!d.contains(f))){a.fire("saveSnapshot");var j;(j=(c?d:f).getBogus())&&j.remove(),j=(e=a.getSelection()).createBookmarks(),(c?f:d).moveChildren(c?d:f,!1),b.lastElement.mergeSiblings(),g(f,d,!c),e.selectBookmarks(j),e=!0}}else e=!1;else e=!1;else e=!1}if(!e)return}else if(c=d,e=b.block,j=c.endPath().block,e&&j&&!e.equals(j)?(a.fire("saveSnapshot"),(f=e.getBogus())&&f.remove(),c.deleteContents(),j.getParent()&&(j.moveChildren(e,!1),b.lastElement.mergeSiblings(),g(e,j,!0)),(c=a.getSelection().getRanges()[0]).collapse(1),c.select(),b=!0):b=!1,!b)return;return a.getSelection().scrollIntoView(),a.fire("saveSnapshot"),!1}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1),this.clearListeners(),this.restoreAttrs();var a;if(a=this.removeCustomData("classes"))for(;a.length;)this.removeClass(a.pop());if(!this.is("textarea")){var b=(a=this.getDocument()).getHead();if(b.getCustomData("stylesheet")){var c=a.getCustomData("stylesheet_ref");--c?a.setCustomData("stylesheet_ref",c):(a.removeCustomData("stylesheet_ref"),b.removeCustomData("stylesheet").remove())}}this.editor.fire("contentDomUnload"),delete this.editor}}}),CKEDITOR.editor.prototype.editable=function(a){var b=this._.editable;return b&&a?0:(arguments.length&&(b=this._.editable=a?a instanceof CKEDITOR.editable?a:new CKEDITOR.editable(this,a):(b&&b.detach(),null)),b)};var m=CKEDITOR.dom.walker.bogus(),y=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,s=CKEDITOR.dom.walker.whitespaces(!0),w=CKEDITOR.dom.walker.bookmark(!1,!0);CKEDITOR.on("instanceLoaded",function(b){var c=b.editor;c.on("insertElement",function(a){(a=a.data).type==CKEDITOR.NODE_ELEMENT&&(a.is("input")||a.is("textarea"))&&("false"!=a.getAttribute("contentEditable")&&a.data("cke-editable",a.hasAttribute("contenteditable")?"true":"1"),a.setAttribute("contentEditable",!1))}),c.on("selectionChange",function(b){if(!c.readOnly){var d=c.getSelection();d&&!d.isLocked&&(d=c.checkDirty(),c.fire("lockSnapshot"),a(b),c.fire("unlockSnapshot"),!d&&c.resetDirty())}})}),CKEDITOR.on("instanceCreated",function(a){var b=a.editor;b.on("mode",function(){var a=b.editable();if(a&&a.isInline()){var c=b.title;if(a.changeAttr("role","textbox"),a.changeAttr("aria-label",c),c&&a.changeAttr("title",c),(d=b.fire("ariaEditorHelpLabel",{}).label)&&(c=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents"))){var e=CKEDITOR.tools.getNextId(),d=CKEDITOR.dom.element.createFromHtml('<span id="'+e+'" class="cke_voice_label">'+d+"</span>");c.append(d),a.changeAttr("aria-describedby",e)}}})}),CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}");var q=function(){function a(b){return b.type==CKEDITOR.NODE_ELEMENT}function b(c,d){var e,f,l,p,h=[],g=d.range.startContainer;e=d.range.startPath();for(var g=r[g.getName()],n=0,j=c.getChildren(),m=j.count(),o=-1,C=-1,k=0,q=e.contains(r.$list);n<m;++n)a(e=j.getItem(n))?(l=e.getName(),q&&l in CKEDITOR.dtd.$list?h=h.concat(b(e,d)):(p=!!g[l],"br"!=l||!e.data("cke-eol")||n&&n!=m-1||(k=(f=n?h[n-1].node:j.getItem(n+1))&&(!a(f)||!f.is("br")),f=f&&a(f)&&r.$block[f.getName()]),-1==o&&!p&&(o=n),p||(C=n),h.push({isElement:1,isLineBreak:k,isBlock:e.isBlockBoundary(),hasBlockSibling:f,node:e,name:l,allowed:p}),f=k=0)):h.push({isElement:0,node:e,allowed:1});return o>-1&&(h[o].firstNotAllowed=1),C>-1&&(h[C].lastNotAllowed=1),h}function d(b,c){var p,e=[],f=b.getChildren(),l=f.count(),h=0,g=r[c],n=!b.is(r.$inline)||b.is("br");for(n&&e.push(" ");h<l;h++)a(p=f.getItem(h))&&!p.is(g)?e=e.concat(d(p,c)):e.push(p);return n&&e.push(" "),e}function e(b){return b&&a(b)&&(b.is(r.$removeEmpty)||b.is("a")&&!b.isBlockBoundary())}function f(b,c,d,e){var h,r,p=b.clone();p.setEndAt(c,CKEDITOR.POSITION_BEFORE_END),(h=new CKEDITOR.dom.walker(p).next())&&a(h)&&g[h.getName()]&&(r=h.getPrevious())&&a(r)&&!r.getParent().equals(b.startContainer)&&d.contains(r)&&e.contains(h)&&h.isIdentical(r)&&(h.moveChildren(r),h.remove(),f(b,c,d,e))}function p(b,c){function d(b,c){if(c.isBlock&&c.isElement&&!c.node.is("br")&&a(b)&&b.is("br"))return b.remove(),1}var e=c.endContainer.getChild(c.endOffset),f=c.endContainer.getChild(c.endOffset-1);e&&d(e,b[b.length-1]),f&&d(f,b[0])&&(c.setEnd(c.endContainer,c.endOffset-1),c.collapse())}var r=CKEDITOR.dtd,g={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},m={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},C=CKEDITOR.tools.extend({},r.$inline);return delete C.br,function(g,n,k){var v=(q=g.editor).getSelection().getRanges()[0],G=!1;if("unfiltered_html"==n&&(n="html",G=!0),!v.checkReadOnly()){var B,x,E,s,q=(n={type:n,dontFilter:G,editable:g,editor:q,range:v,blockLimit:z=new CKEDITOR.dom.elementPath(v.startContainer,v.root).blockLimit||v.root,mergeCandidates:[],zombies:[]}).range,G=n.mergeCandidates;if("text"==n.type&&q.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(B=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",q.document),q.insertNode(B),q.setStartAfter(B)),x=new CKEDITOR.dom.elementPath(q.startContainer),n.endPath=E=new CKEDITOR.dom.elementPath(q.endContainer),!q.collapsed){var z=E.block||E.blockLimit,w=q.getCommonAncestor();z&&!z.equals(w)&&!z.contains(w)&&q.checkEndOfBlock()&&n.zombies.push(z),q.deleteContents()}for(;(s=a(q.startContainer)&&q.startContainer.getChild(q.startOffset-1))&&a(s)&&s.isBlockBoundary()&&x.contains(s);)q.moveToPosition(s,CKEDITOR.POSITION_BEFORE_END);for(f(q,n.blockLimit,x,E),B&&(q.setEndBefore(B),q.collapse(),B.remove()),(z=(B=q.startPath()).contains(e,!1,1))&&(q.splitElement(z),n.inlineStylesRoot=z,n.inlineStylesPeak=B.lastElement),(z=(B=q.createBookmark()).startNode.getPrevious(c))&&a(z)&&e(z)&&G.push(z),(z=B.startNode.getNext(c))&&a(z)&&e(z)&&G.push(z),z=B.startNode;(z=z.getParent())&&e(z);)G.push(z);if(q.moveToBookmark(B),B=k){if(B=n.range,"text"==n.type&&n.inlineStylesRoot){for(q=(s=n.inlineStylesPeak).getDocument().createText("{cke-peak}"),G=n.inlineStylesRoot.getParent();!s.equals(G);)q=q.appendTo(s.clone()),s=s.getParent();k=q.getOuterHtml().split("{cke-peak}").join(k)}if(s=n.blockLimit.getName(),/^\s+|\s+$/.test(k)&&"span"in CKEDITOR.dtd[s])var y='<span data-cke-marker="1">&nbsp;</span>',k=y+k+y;if(k=n.editor.dataProcessor.toHtml(k,{context:null,fixForBody:!1,dontFilter:n.dontFilter,filter:n.editor.activeFilter,enterMode:n.editor.activeEnterMode}),(s=B.document.createElement("body")).setHtml(k),y&&(s.getFirst().remove(),s.getLast().remove()),(y=B.startPath().block)&&(1!=y.getChildCount()||!y.getBogus()))a:{var t;if(1==s.getChildCount()&&a(t=s.getFirst())&&t.is(m)){for(B=0,G=(y=t.getElementsByTag("*")).count();B<G;B++)if(!(q=y.getItem(B)).is(C))break a;t.moveChildren(t.getParent(1)),t.remove()}}n.dataWrapper=s,B=k}if(B){var D,y=(t=n.range).document,k=n.blockLimit;B=0;var J;s=[];var H,Q,M,S,G=q=0;x=t.startContainer;var T;for(E=(z=n.endPath.elements[0]).getPosition(x),w=!(!z.getCommonAncestor(x)||E==CKEDITOR.POSITION_IDENTICAL||E&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED),p(x=b(n.dataWrapper,n),t);B<x.length;B++){if(E=x[B],D=E.isLineBreak){D=t,M=k;var O=void 0,V=void 0;E.hasBlockSibling?D=1:(O=D.startContainer.getAscendant(r.$block,1))&&O.is({div:1,p:1})?(V=O.getPosition(M))==CKEDITOR.POSITION_IDENTICAL||V==CKEDITOR.POSITION_CONTAINS?D=0:(M=D.splitElement(O),D.moveToPosition(M,CKEDITOR.POSITION_AFTER_START),D=1):D=0}if(D)G=B>0;else{if(D=t.startPath(),!E.isBlock&&h(n.editor,D.block,D.blockLimit)&&(Q=n.editor.activeEnterMode!=CKEDITOR.ENTER_BR&&!1!==n.editor.config.autoParagraph&&(n.editor.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"))&&((Q=y.createElement(Q)).appendBogus(),t.insertNode(Q),CKEDITOR.env.needsBrFiller&&(J=Q.getBogus())&&J.remove(),t.moveToPosition(Q,CKEDITOR.POSITION_BEFORE_END)),(D=t.startPath().block)&&!D.equals(H)&&((J=D.getBogus())&&(J.remove(),s.push(D)),H=D),E.firstNotAllowed&&(q=1),q&&E.isElement){for(D=t.startContainer,M=null;D&&!r[D.getName()][E.name];){if(D.equals(k)){D=null;break}M=D,D=D.getParent()}if(D)M&&(S=t.splitElement(M),n.zombies.push(S),n.zombies.push(M));else{M=k.getName(),T=!B,D=B==x.length-1;for(var O=[],V=(M=d(E.node,M)).length,W=0,Y=void 0,Z=0,U=-1;W<V;W++)" "==(Y=M[W])?(Z||T&&!W||(O.push(new CKEDITOR.dom.text(" ")),U=O.length),Z=1):(O.push(Y),Z=0);D&&U==O.length&&O.pop(),T=O}}if(T){for(;D=T.pop();)t.insertNode(D);T=0}else t.insertNode(E.node);E.lastNotAllowed&&B<x.length-1&&((S=w?z:S)&&t.setEndAt(S,CKEDITOR.POSITION_AFTER_START),q=0),t.collapse()}}n.dontMoveCaret=G,n.bogusNeededBlocks=s}J=n.range;var N;for(S=n.bogusNeededBlocks,T=J.createBookmark();H=n.zombies.pop();)H.getParent()&&((Q=J.clone()).moveToElementEditStart(H),Q.removeEmptyBlocksAtEnd());if(S)for(;H=S.pop();)CKEDITOR.env.needsBrFiller?H.appendBogus():H.append(J.document.createText(""));for(;H=n.mergeCandidates.pop();)H.mergeSiblings();if(J.moveToBookmark(T),!n.dontMoveCaret){for(H=a(J.startContainer)&&J.startContainer.getChild(J.startOffset-1);H&&a(H)&&!H.is(r.$empty);){if(H.isBlockBoundary())J.moveToPosition(H,CKEDITOR.POSITION_BEFORE_END);else{if(e(H)&&H.getHtml().match(/(\s|&nbsp;)$/g)){N=null;break}(N=J.clone()).moveToPosition(H,CKEDITOR.POSITION_BEFORE_END)}H=H.getLast(c)}N&&J.moveToRange(N)}v.select(),j(g)}}}(),t=function(){function a(b){return b=new CKEDITOR.dom.walker(b),b.guard=function(a,b){return!b&&(a.type==CKEDITOR.NODE_ELEMENT?a.is(CKEDITOR.dtd.$tableContent):void 0)},b.evaluator=function(a){return a.type==CKEDITOR.NODE_ELEMENT},b}function b(a,c,d){return c=a.getDocument().createElement(c),a.append(c,d),c}function c(a){var d,b=a.count();for(b;b-- >0;)d=a.getItem(b),CKEDITOR.tools.trim(d.getHtml())||(d.appendBogus(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&d.getChildCount()&&d.getFirst().remove())}return function(d){var e=d.startContainer,f=e.getAscendant("table",1),h=!1;c(f.getElementsByTag("td")),c(f.getElementsByTag("th")),(f=d.clone()).setStart(e,0),(f=a(f).lastBackward())||((f=d.clone()).setEndAt(e,CKEDITOR.POSITION_BEFORE_END),f=a(f).lastForward(),h=!0),f||(f=e),f.is("table")?(d.setStartAt(f,CKEDITOR.POSITION_BEFORE_START),d.collapse(!0),f.remove()):(f.is({tbody:1,thead:1,tfoot:1})&&(f=b(f,"tr",h)),f.is("tr")&&(f=b(f,f.getParent().is("thead")?"th":"td",h)),(e=f.getBogus())&&e.remove(),d.moveToPosition(f,h?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END))}}()}(),function(){function a(){var b,a=this._.fakeSelection;a&&((b=this.getSelection(1))&&b.isHidden()||(a.reset(),a=0)),(a||(a=b||this.getSelection(1))&&a.getType()!=CKEDITOR.SELECTION_NONE)&&(this.fire("selectionCheck",a),(b=this.elementPath()).compare(this._.selectionPreviousPath)||(CKEDITOR.env.webkit&&(this._.previousActive=this.document.getActive()),this._.selectionPreviousPath=b,this.fire("selectionChange",{selection:a,path:b})))}function f(){q=!0,w||(b.call(this),w=CKEDITOR.tools.setTimeout(b,200,this))}function b(){w=null,q&&(CKEDITOR.tools.setTimeout(a,0,this),q=!1)}function c(a){return!(!t(a)&&(a.type!=CKEDITOR.NODE_ELEMENT||a.is(CKEDITOR.dtd.$empty)))}function e(a){function b(c,d){return!(!c||c.type==CKEDITOR.NODE_TEXT)&&a.clone()["moveToElementEdit"+(d?"End":"Start")](c)}if(!(a.root instanceof CKEDITOR.editable))return!1;var d=a.startContainer,e=a.getPreviousNode(c,null,d),f=a.getNextNode(c,null,d);return!(!b(e)&&!b(f,1)&&(e||f||d.type==CKEDITOR.NODE_ELEMENT&&d.isBlockBoundary()&&d.getBogus()))}function d(a){return a.getCustomData("cke-fillingChar")}function h(a,b){var c=a&&a.removeCustomData("cke-fillingChar");if(c){if(!1!==b){var d,e=a.getDocument().getSelection().getNative(),f=e&&"None"!=e.type&&e.getRangeAt(0);c.getLength()>1&&f&&f.intersectsNode(c.$)&&(d=j(e),f=e.focusNode==c.$&&e.focusOffset>0,e.anchorNode==c.$&&e.anchorOffset>0&&d[0].offset--,f&&d[1].offset--)}c.setText(k(c.getText())),d&&g(a.getDocument().$,d)}}function k(a){return a.replace(/\u200B( )?/g,function(a){return a[1]?"":""})}function j(a){return[{node:a.anchorNode,offset:a.anchorOffset},{node:a.focusNode,offset:a.focusOffset}]}function g(a,b){var c=a.getSelection(),d=a.createRange();d.setStart(b[0].node,b[0].offset),d.collapse(!0),c.removeAllRanges(),c.addRange(d),c.extend(b[1].node,b[1].offset)}function m(a){var b=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie?"display:none":"position:fixed;top:0;left:-1000px")+'">&nbsp;</div>',a.document);a.fire("lockSnapshot"),a.editable().append(b);var c=a.getSelection(1),d=a.createRange(),e=c.root.on("selectionchange",function(a){a.cancel()},null,null,0);d.setStartAt(b,CKEDITOR.POSITION_AFTER_START),d.setEndAt(b,CKEDITOR.POSITION_BEFORE_END),c.selectRanges([d]),e.removeListener(),a.fire("unlockSnapshot"),a._.hiddenSelectionContainer=b}function y(a){var b={37:1,39:1,8:1,46:1};return function(c){var d=c.data.getKeystroke();if(b[d]){var e=a.getSelection().getRanges(),f=e[0];1==e.length&&f.collapsed&&(d=f[d<38?"getPreviousEditableNode":"getNextEditableNode"]())&&d.type==CKEDITOR.NODE_ELEMENT&&"false"==d.getAttribute("contenteditable")&&(a.getSelection().fake(d),c.data.preventDefault(),c.cancel())}}}function s(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.getCommonAncestor().isReadOnly()&&a.splice(b,1),!c.collapsed){if(c.startContainer.isReadOnly())for(var e,d=c.startContainer;d&&!((e=d.type==CKEDITOR.NODE_ELEMENT)&&d.is("body")||!d.isReadOnly());)e&&"false"==d.getAttribute("contentEditable")&&c.setStartAfter(d),d=d.getParent();d=c.startContainer,e=c.endContainer;var f=c.startOffset,h=c.endOffset,g=c.clone();d&&d.type==CKEDITOR.NODE_TEXT&&(f>=d.getLength()?g.setStartAfter(d):g.setStartBefore(d)),e&&e.type==CKEDITOR.NODE_TEXT&&(h?g.setEndAfter(e):g.setEndBefore(e)),(d=new CKEDITOR.dom.walker(g)).evaluator=function(d){if(d.type==CKEDITOR.NODE_ELEMENT&&d.isReadOnly()){var e=c.clone();return c.setEndBefore(d),c.collapsed&&a.splice(b--,1),d.getPosition(g.endContainer)&CKEDITOR.POSITION_CONTAINS||(e.setStartAfter(d),e.collapsed||a.splice(b+1,0,e)),!0}return!1},d.next()}}return a}var w,q,t=CKEDITOR.dom.walker.invisible(1),i=function(){function a(b){return function(a){var c=a.editor.createRange();return c.moveToClosestEditablePosition(a.selected,b)&&a.editor.getSelection().selectRanges([c]),!1}}function b(a){return function(b){var e,c=b.editor,d=c.createRange();return(e=d.moveToClosestEditablePosition(b.selected,a))||(e=d.moveToClosestEditablePosition(b.selected,!a)),e&&c.getSelection().selectRanges([d]),c.fire("saveSnapshot"),b.selected.remove(),e||(d.moveToElementEditablePosition(c.editable()),c.getSelection().selectRanges([d])),c.fire("saveSnapshot"),!1}}var c=a(),d=a(1);return{37:c,38:c,39:d,40:d,8:b(),46:b(1)}}();CKEDITOR.on("instanceCreated",function(b){function c(){var a=d.getSelection();a&&a.removeAllRanges()}var d=b.editor;d.on("contentDom",function(){function b(){(z=new CKEDITOR.dom.selection(d.getSelection())).lock()}function c(){l.removeListener("mouseup",c),i.removeListener("mouseup",c);var a=CKEDITOR.document.$.selection,b=a.createRange();"None"!=a.type&&b.parentElement().ownerDocument==e.$&&b.select()}var j,z,e=d.document,l=CKEDITOR.document,g=d.editable(),p=e.getBody(),i=e.getDocumentElement(),v=g.isInline();if(CKEDITOR.env.gecko&&g.attachListener(g,"focus",function(a){a.removeListener(),0!==j&&(a=d.getSelection().getNative())&&a.isCollapsed&&a.anchorNode==g.$&&((a=d.createRange()).moveToElementEditStart(g),a.select())},null,null,-2),g.attachListener(g,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){j&&CKEDITOR.env.webkit&&(j=d._.previousActive&&d._.previousActive.equals(e.getActive())),d.unlockSelection(j),j=0},null,null,-1),g.attachListener(g,"mousedown",function(){j=0}),(CKEDITOR.env.ie||v)&&(A?g.attachListener(g,"beforedeactivate",b,null,null,-1):g.attachListener(d,"selectionCheck",b,null,null,-1),g.attachListener(g,CKEDITOR.env.webkit?"DOMFocusOut":"blur",function(){d.lockSelection(z),j=1},null,null,-1),g.attachListener(g,"mousedown",function(){j=0})),CKEDITOR.env.ie&&!v){var B;g.attachListener(g,"mousedown",function(a){2==a.data.$.button&&((a=d.document.getSelection())&&a.getType()!=CKEDITOR.SELECTION_NONE||(B=d.window.getScrollPosition()))}),g.attachListener(g,"mouseup",function(a){2==a.data.$.button&&B&&(d.document.$.documentElement.scrollLeft=B.x,d.document.$.documentElement.scrollTop=B.y),B=null}),"BackCompat"!=e.$.compatMode&&((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&i.on("mousedown",function(a){function b(a){if(a=a.data.$,d){var c=p.$.createTextRange();try{c.moveToPoint(a.clientX,a.clientY)}catch(e){}d.setEndPoint(f.compareEndPoints("StartToStart",c)<0?"EndToEnd":"StartToStart",c),d.select()}}function c(){i.removeListener("mousemove",b),l.removeListener("mouseup",c),i.removeListener("mouseup",c),d.select()}if((a=a.data).getTarget().is("html")&&a.$.y<i.$.clientHeight&&a.$.x<i.$.clientWidth){var d=p.$.createTextRange();try{d.moveToPoint(a.$.clientX,a.$.clientY)}catch(e){}var f=d.duplicate();i.on("mousemove",b),l.on("mouseup",c),i.on("mouseup",c)}}),CKEDITOR.env.version>7&&CKEDITOR.env.version<11&&i.on("mousedown",function(a){a.data.getTarget().is("html")&&(l.on("mouseup",c),i.on("mouseup",c))}))}if(g.attachListener(g,"selectionchange",a,d),g.attachListener(g,"keyup",f,d),g.attachListener(g,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){d.forceNextSelectionCheck(),d.selectionChange(1)}),v&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){var x;g.attachListener(g,"mousedown",function(){x=1}),g.attachListener(e.getDocumentElement(),"mouseup",function(){x&&f.call(d),x=0})}else g.attachListener(CKEDITOR.env.ie?g:e.getDocumentElement(),"mouseup",f,d);CKEDITOR.env.webkit&&g.attachListener(e,"keydown",function(a){switch(a.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:h(g)}},null,null,-1),g.attachListener(g,"keydown",y(d),null,null,-1)}),d.on("setData",function(){d.unlockSelection(),CKEDITOR.env.webkit&&c()}),d.on("contentDomUnload",function(){d.unlockSelection()}),CKEDITOR.env.ie9Compat&&d.on("beforeDestroy",c,null,null,9),d.on("dataReady",function(){delete d._.fakeSelection,delete d._.hiddenSelectionContainer,d.selectionChange(1)}),d.on("loadSnapshot",function(){var a=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT),b=d.editable().getLast(a);b&&b.hasAttribute("data-cke-hidden-sel")&&(b.remove(),CKEDITOR.env.gecko&&(a=d.editable().getFirst(a))&&a.is("br")&&a.getAttribute("_moz_editor_bogus_node")&&a.remove())},null,null,100),d.on("key",function(a){if("wysiwyg"==d.mode){var b=d.getSelection();if(b.isFake){var c=i[a.data.keyCode];if(c)return c({editor:d,selected:b.getSelectedElement(),selection:b,keyEvent:a})}}})}),CKEDITOR.on("instanceReady",function(a){function b(){var a=e.editable();if(a&&(a=d(a))){var c=e.document.$.getSelection();"None"==c.type||c.anchorNode!=a.$&&c.focusNode!=a.$||(i=j(c)),f=a.getText(),a.setText(k(f))}}function c(){var a=e.editable();a&&(a=d(a))&&(a.setText(f),i&&(g(e.document.$,i),i=null))}var f,i,e=a.editor;CKEDITOR.env.webkit&&(e.on("selectionChange",function(){var a=e.editable(),b=d(a);b&&(b.getCustomData("ready")?h(a):b.setCustomData("ready",1))},null,null,-1),e.on("beforeSetMode",function(){h(e.editable())},null,null,-1),e.on("beforeUndoImage",b),e.on("afterUndoImage",c),e.on("beforeGetData",b,null,null,0),e.on("getData",c))}),CKEDITOR.editor.prototype.selectionChange=function(b){(b?a:f).call(this)},CKEDITOR.editor.prototype.getSelection=function(a){return!this._.savedSelection&&!this._.fakeSelection||a?(a=this.editable())&&"wysiwyg"==this.mode?new CKEDITOR.dom.selection(a):null:this._.savedSelection||this._.fakeSelection},CKEDITOR.editor.prototype.lockSelection=function(a){return(a=a||this.getSelection(1)).getType()!=CKEDITOR.SELECTION_NONE&&(!a.isLocked&&a.lock(),this._.savedSelection=a,!0)},CKEDITOR.editor.prototype.unlockSelection=function(a){var b=this._.savedSelection;return!!b&&(b.unlock(a),delete this._.savedSelection,!0)},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)},CKEDITOR.dom.range.prototype.select=function(){var a=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);return a.selectRanges([this]),a},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3;var A="function"!=typeof window.getSelection,u=1;CKEDITOR.dom.selection=function(a){if(a instanceof CKEDITOR.dom.selection)var b=a,a=a.root;var c=a instanceof CKEDITOR.dom.element;if(this.rev=b?b.rev:u++,this.document=a instanceof CKEDITOR.dom.document?a:a.getDocument(),this.root=c?a:this.document.getBody(),this.isLocked=0,this._={cache:{}},b)return CKEDITOR.tools.extend(this._.cache,b._.cache),this.isFake=b.isFake,this.isLocked=b.isLocked,this;var d,e;if(a=this.getNative())if(a.getRangeAt)d=(e=a.rangeCount&&a.getRangeAt(0))&&new CKEDITOR.dom.node(e.commonAncestorContainer);else{try{e=a.createRange()}catch(f){}d=e&&CKEDITOR.dom.element.get(e.item&&e.item(0)||e.parentElement())}return(!d||d.type!=CKEDITOR.NODE_ELEMENT&&d.type!=CKEDITOR.NODE_TEXT||!this.root.equals(d)&&!this.root.contains(d))&&(this._.cache.type=CKEDITOR.SELECTION_NONE,this._.cache.startElement=null,this._.cache.selectedElement=null,this._.cache.selectedText="",this._.cache.ranges=new CKEDITOR.dom.rangeList),this};var o={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:function(){return void 0!==this._.cache.nativeSel?this._.cache.nativeSel:this._.cache.nativeSel=A?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:A?function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_NONE;try{var c=this.getNative(),d=c.type;"Text"==d&&(b=CKEDITOR.SELECTION_TEXT),"Control"==d&&(b=CKEDITOR.SELECTION_ELEMENT),c.createRange().parentElement()&&(b=CKEDITOR.SELECTION_TEXT)}catch(e){}return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=CKEDITOR.SELECTION_TEXT,c=this.getNative();if(c&&c.rangeCount){if(1==c.rangeCount){var d=(c=c.getRangeAt(0)).startContainer;d==c.endContainer&&1==d.nodeType&&c.endOffset-c.startOffset==1&&o[d.childNodes[c.startOffset].nodeName.toLowerCase()]&&(b=CKEDITOR.SELECTION_ELEMENT)}}else b=CKEDITOR.SELECTION_NONE;return a.type=b},getRanges:function(){var a=A?function(){function a(b){return new CKEDITOR.dom.node(b).getIndex()}var b=function(b,c){(b=b.duplicate()).collapse(c);var d=b.parentElement();if(!d.hasChildNodes())return{container:d,offset:0};for(var f,g,j,x,e=d.children,h=b.duplicate(),v=0,l=e.length-1,i=-1;v<=l;)if(i=Math.floor((v+l)/2),f=e[i],h.moveToElementText(f),(j=h.compareEndPoints("StartToStart",b))>0)l=i-1;else{if(!(j<0))return{container:d,offset:a(f)};v=i+1}if(-1==i||i==e.length-1&&j<0){if(h.moveToElementText(d),h.setEndPoint("StartToStart",b),h=h.text.replace(/(\r\n|\r)/g,"\n").length,e=d.childNodes,!h)return(f=e[e.length-1]).nodeType!=CKEDITOR.NODE_TEXT?{container:d,offset:e.length}:{container:f,offset:f.nodeValue.length};for(d=e.length;h>0&&d>0;)(g=e[--d]).nodeType==CKEDITOR.NODE_TEXT&&(x=g,h-=g.nodeValue.length);return{container:x,offset:-h}}if(h.collapse(j>0),h.setEndPoint(j>0?"StartToStart":"EndToStart",b),!(h=h.text.replace(/(\r\n|\r)/g,"\n").length))return{container:d,offset:a(f)+(j>0?0:1)};for(;h>0;)try{(g=f[j>0?"previousSibling":"nextSibling"]).nodeType==CKEDITOR.NODE_TEXT&&(h-=g.nodeValue.length,x=g),f=g}catch(m){return{container:d,offset:a(f)}}return{container:x,offset:j>0?-h:x.nodeValue.length+h}};return function(){var c=(a=this.getNative())&&a.createRange(),d=this.getType();if(!a)return[];if(d==CKEDITOR.SELECTION_TEXT)return a=new CKEDITOR.dom.range(this.root),d=b(c,!0),a.setStart(new CKEDITOR.dom.node(d.container),d.offset),d=b(c),a.setEnd(new CKEDITOR.dom.node(d.container),d.offset),a.endContainer.getPosition(a.startContainer)&CKEDITOR.POSITION_PRECEDING&&a.endOffset<=a.startContainer.getIndex()&&a.collapse(),[a];if(d==CKEDITOR.SELECTION_ELEMENT){for(var d=[],e=0;e<c.length;e++){for(var f=c.item(e),h=f.parentNode,g=0,a=new CKEDITOR.dom.range(this.root);g<h.childNodes.length&&h.childNodes[g]!=f;g++);a.setStart(new CKEDITOR.dom.node(h),g),a.setEnd(new CKEDITOR.dom.node(h),g+1),d.push(a)}return d}return[]}}():function(){var b,a=[],c=this.getNative();if(!c)return a;for(var d=0;d<c.rangeCount;d++){var e=c.getRangeAt(d);(b=new CKEDITOR.dom.range(this.root)).setStart(new CKEDITOR.dom.node(e.startContainer),e.startOffset),b.setEnd(new CKEDITOR.dom.node(e.endContainer),e.endOffset),a.push(b)}return a};return function(b){var c=this._.cache,d=c.ranges;return d||(c.ranges=d=new CKEDITOR.dom.rangeList(a.call(this))),b?s(new CKEDITOR.dom.rangeList(d.slice())):d}}(),getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var b;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var c=this.getRanges()[0];if(c){if(c.collapsed)(b=c.startContainer).type!=CKEDITOR.NODE_ELEMENT&&(b=b.getParent());else{for(c.optimize();b=c.startContainer,c.startOffset==(b.getChildCount?b.getChildCount():b.getLength())&&!b.isBlockBoundary();)c.setStartAfter(b);if((b=c.startContainer).type!=CKEDITOR.NODE_ELEMENT)return b.getParent();if((b=b.getChild(c.startOffset))&&b.type==CKEDITOR.NODE_ELEMENT)for(c=b.getFirst();c&&c.type==CKEDITOR.NODE_ELEMENT;)b=c,c=c.getFirst();else b=c.startContainer}b=b.$}}return a.startElement=b?new CKEDITOR.dom.element(b):null},getSelectedElement:function(){var a=this._.cache;if(void 0!==a.selectedElement)return a.selectedElement;var b=this,c=CKEDITOR.tools.tryThese(function(){return b.getNative().createRange().item(0)},function(){for(var c,d,a=b.getRanges()[0].clone(),e=2;e&&(!(c=a.getEnclosedNode())||c.type!=CKEDITOR.NODE_ELEMENT||!o[c.getName()]||!(d=c));e--)a.shrink(CKEDITOR.SHRINK_ELEMENT);return d&&d.$});return a.selectedElement=c?new CKEDITOR.dom.element(c):null},getSelectedText:function(){var a=this._.cache;if(void 0!==a.selectedText)return a.selectedText;var b=this.getNative(),b=A?"Control"==b.type?"":b.createRange().text:b.toString();return a.selectedText=b},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this.getSelectedText(),this._.cache.nativeSel=null,this.isLocked=1},unlock:function(a){if(this.isLocked){if(a)var b=this.getSelectedElement(),c=!b&&this.getRanges(),d=this.isFake;this.isLocked=0,this.reset(),a&&(a=b||c[0]&&c[0].getCommonAncestor())&&a.getAscendant("body",1)&&(d?this.fake(b):b?this.selectElement(b):this.selectRanges(c))}},reset:function(){this._.cache={},this.isFake=0;var a=this.root.editor;if(a&&a._.fakeSelection&&this.rev==a._.fakeSelection.rev){delete a._.fakeSelection;var b=a._.hiddenSelectionContainer;if(b){var c=a.checkDirty();a.fire("lockSnapshot"),b.remove(),a.fire("unlockSnapshot"),!c&&a.resetDirty()}delete a._.hiddenSelectionContainer}this.rev=u++},selectElement:function(a){var b=new CKEDITOR.dom.range(this.root);b.setStartBefore(a),b.setEndAfter(a),this.selectRanges([b])},selectRanges:function(a){b=(b=this.root.editor)&&b._.hiddenSelectionContainer;if(this.reset(),b)for(var c,b=this.root,d=0;d<a.length;++d)(c=a[d]).endContainer.equals(b)&&(c.endOffset=Math.min(c.endOffset,b.getChildCount()));if(a.length)if(this.isLocked){var f=CKEDITOR.document.getActive();this.unlock(),this.selectRanges(a),this.lock(),f&&!f.equals(this.root)&&f.focus()}else{var g,i,j;if(1==a.length&&!(j=a[0]).collapsed&&(g=j.getEnclosedNode())&&g.type==CKEDITOR.NODE_ELEMENT&&((j=j.clone()).shrink(CKEDITOR.SHRINK_ELEMENT,!0),(i=j.getEnclosedNode())&&i.type==CKEDITOR.NODE_ELEMENT&&(g=i),"false"==g.getAttribute("contenteditable"))||(g=void 0),g)this.fake(g);else{if(A){j=CKEDITOR.dom.walker.whitespaces(!0),i=/\ufeff|\u00a0/,b={table:1,tbody:1,tr:1},a.length>1&&(g=a[a.length-1],a[0].setEnd(g.endContainer,g.endOffset));var m,k,v,a=(g=a[0]).collapsed;if((c=g.getEnclosedNode())&&c.type==CKEDITOR.NODE_ELEMENT&&c.getName()in o&&(!c.is("a")||!c.getText()))try{return(v=c.$.createControlRange()).addElement(c.$),void v.select()}catch(q){}(g.startContainer.type==CKEDITOR.NODE_ELEMENT&&g.startContainer.getName()in b||g.endContainer.type==CKEDITOR.NODE_ELEMENT&&g.endContainer.getName()in b)&&(g.shrink(CKEDITOR.NODE_ELEMENT,!0),a=g.collapsed),b=(v=g.createBookmark()).startNode,a||(f=v.endNode),(v=g.document.$.body.createTextRange()).moveToElementText(b.$),v.moveStart("character",1),f?((i=g.document.$.body.createTextRange()).moveToElementText(f.$),v.setEndPoint("EndToEnd",i),v.moveEnd("character",-1)):(m=b.getNext(j),k=b.hasAscendant("pre"),m=!(m&&m.getText&&m.getText().match(i))&&(k||!b.hasPrevious()||b.getPrevious().is&&b.getPrevious().is("br")),(k=g.document.createElement("span")).setHtml("&#65279;"),k.insertBefore(b),m&&g.document.createText("\ufeff").insertBefore(b)),g.setStartBefore(b),b.remove(),a?(m?(v.moveStart("character",-1),v.select(),g.document.$.selection.clear()):v.select(),g.moveToPosition(k,CKEDITOR.POSITION_BEFORE_START),k.remove()):(g.setEndBefore(f),f.remove(),v.select())}else{if(!(f=this.getNative()))return;for(this.removeAllRanges(),v=0;v<a.length;v++)if(v<a.length-1&&(m=a[v],k=a[v+1],(i=m.clone()).setStart(m.endContainer,m.endOffset),i.setEnd(k.startContainer,k.startOffset),!i.collapsed&&(i.shrink(CKEDITOR.NODE_ELEMENT,!0),g=i.getCommonAncestor(),i=i.getEnclosedNode(),g.isReadOnly()||i&&i.isReadOnly())))k.setStart(m.startContainer,m.startOffset),a.splice(v--,1);else{g=a[v],k=this.document.$.createRange(),g.collapsed&&CKEDITOR.env.webkit&&e(g)&&(h(m=this.root,!1),i=m.getDocument().createText(""),m.setCustomData("cke-fillingChar",i),g.insertNode(i),(m=i.getNext())&&!i.getPrevious()&&m.type==CKEDITOR.NODE_ELEMENT&&"br"==m.getName()?(h(this.root),g.moveToPosition(m,CKEDITOR.POSITION_BEFORE_START)):g.moveToPosition(i,CKEDITOR.POSITION_AFTER_END)),k.setStart(g.startContainer.$,g.startOffset);try{k.setEnd(g.endContainer.$,g.endOffset)}catch(z){if(!(z.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0))throw z;g.collapse(1),k.setEnd(g.endContainer.$,g.endOffset)}f.addRange(k)}}this.reset(),this.root.fire("selectionchange")}}},fake:function(a){var b=this.root.editor;this.reset(),m(b);var c=this._.cache,d=new CKEDITOR.dom.range(this.root);d.setStartBefore(a),d.setEndAfter(a),c.ranges=new CKEDITOR.dom.rangeList(d),c.selectedElement=c.startElement=a,c.type=CKEDITOR.SELECTION_ELEMENT,c.selectedText=c.nativeSel=null,this.isFake=1,this.rev=u++,b._.fakeSelection=this,this.root.fire("selectionchange")},isHidden:function(){var a=this.getCommonAncestor();return a&&a.type==CKEDITOR.NODE_TEXT&&(a=a.getParent()),!(!a||!a.data("cke-hidden-sel"))},createBookmarks:function(a){return a=this.getRanges().createBookmarks(a),this.isFake&&(a.isFake=1),a},createBookmarks2:function(a){return a=this.getRanges().createBookmarks2(a),this.isFake&&(a.isFake=1),a},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var d=new CKEDITOR.dom.range(this.root);d.moveToBookmark(a[c]),b.push(d)}return a.isFake?this.fake(b[0].getEnclosedNode()):this.selectRanges(b),this},getCommonAncestor:function(){var a=this.getRanges();return a.length?a[0].startContainer.getCommonAncestor(a[a.length-1].endContainer):null},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var a=this.getNative();try{a&&a[A?"empty":"removeAllRanges"]()}catch(b){}this.reset()}}}}(),CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function a(a,b){for(var c,d;(a=a.getParent())&&!a.equals(b);)if(a.getAttribute("data-nostyle"))c=a;else if(!d){var e=a.getAttribute("contentEditable");"false"==e?c=a:"true"==e&&(d=1)}return c}function f(b){var d=b.document;if(b.collapsed)d=i(this,d),b.insertNode(d),b.moveToPosition(d,CKEDITOR.POSITION_BEFORE_END);else{var h,e=this.element,g=this._.definition,m=(j=g.ignoreReadonly)||g.includeReadonly;null==m&&(m=b.root.getCustomData("cke_includeReadonly"));var k=CKEDITOR.dtd[e];k||(h=!0,k=CKEDITOR.dtd.span),b.enlarge(CKEDITOR.ENLARGE_INLINE,1),b.trim();var p,l=b.createBookmark(),q=l.startNode,o=l.endNode,n=q;if(!j){var j=a(q,s=b.getCommonAncestor()),s=a(o,s);j&&(n=j.getNextSourceNode(!0)),s&&(o=s)}for(n.getPosition(o)==CKEDITOR.POSITION_FOLLOWING&&(n=0);n;){if(j=!1,n.equals(o))n=null,j=!0;else{var s=(r=n.type==CKEDITOR.NODE_ELEMENT?n.getName():null)&&"false"==n.getAttribute("contentEditable"),t=r&&n.getAttribute("data-nostyle");if(r&&n.data("cke-bookmark")){n=n.getNextSourceNode(!0);continue}if(s&&m&&CKEDITOR.dtd.$block[r])for(var y=n,u=c(y),A=void 0,C=u.length,F=0,y=C&&new CKEDITOR.dom.range(y.getDocument());F<C;++F){var A=u[F],P=CKEDITOR.filter.instances[A.data("cke-filter")];(P?P.check(this):1)&&(y.selectNodeContents(A),f.call(this,y))}if(u=r?!k[r]||t?0:s&&!m?0:(n.getPosition(o)|K)==K&&(!g.childRule||g.childRule(n)):1){if(!(u=n.getParent())||!(u.getDtd()||CKEDITOR.dtd.span)[e]&&!h||g.parentRule&&!g.parentRule(u))j=!0;else if(p||r&&CKEDITOR.dtd.$removeEmpty[r]&&(n.getPosition(o)|K)!=K||(p=b.clone()).setStartBefore(n),(r=n.type)==CKEDITOR.NODE_TEXT||s||r==CKEDITOR.NODE_ELEMENT&&!n.getChildCount()){for(var U,r=n;(j=!r.getNext(L))&&(U=r.getParent(),k[U.getName()])&&(U.getPosition(q)|I)==I&&(!g.childRule||g.childRule(U));)r=U;p.setEndAfter(r)}}else j=!0;n=n.getNextSourceNode(t||s)}if(j&&p&&!p.collapsed){for(var N,R,X,s=(j=i(this,d)).hasAttributes(),t=p.getCommonAncestor(),r={},u={},A={},C={};j&&t;){if(t.getName()==e){for(N in g.attributes)!C[N]&&(X=t.getAttribute(R))&&(j.getAttribute(N)==X?u[N]=1:C[N]=1);for(R in g.styles)!A[R]&&(X=t.getStyle(R))&&(j.getStyle(R)==X?r[R]=1:A[R]=1)}t=t.getParent()}for(N in u)j.removeAttribute(N);for(R in r)j.removeStyle(R);s&&!j.hasAttributes()&&(j=null),j?(p.extractContents().appendTo(j),p.insertNode(j),w.call(this,j),j.mergeSiblings(),CKEDITOR.env.ie||j.$.normalize()):(j=new CKEDITOR.dom.element("span"),p.extractContents().appendTo(j),p.insertNode(j),w.call(this,j),j.remove(!0)),p=null}}b.moveToBookmark(l),b.shrink(CKEDITOR.SHRINK_TEXT),b.shrink(CKEDITOR.NODE_ELEMENT,!0)}}function b(a){function b(){for(var a=new CKEDITOR.dom.elementPath(d.getParent()),c=new CKEDITOR.dom.elementPath(j.getParent()),e=null,f=null,g=0;g<a.elements.length;g++){var h=a.elements[g];if(h==a.block||h==a.blockLimit)break;m.checkElementRemovable(h,!0)&&(e=h)}for(g=0;g<c.elements.length&&((h=c.elements[g])!=c.block&&h!=c.blockLimit);g++)m.checkElementRemovable(h,!0)&&(f=h);f&&j.breakParent(f),e&&d.breakParent(e)}a.enlarge(CKEDITOR.ENLARGE_INLINE,1);var c=a.createBookmark(),d=c.startNode;if(a.collapsed){for(var f,h,e=new CKEDITOR.dom.elementPath(d.getParent(),a.root),g=0;g<e.elements.length&&(h=e.elements[g])&&(h!=e.block&&h!=e.blockLimit);g++)if(this.checkElementRemovable(h)){var i;a.collapsed&&(a.checkBoundaryOfElement(h,CKEDITOR.END)||(i=a.checkBoundaryOfElement(h,CKEDITOR.START)))?(f=h).match=i?"start":"end":(h.mergeSiblings(),h.is(this.element)?s.call(this,h):q(h,o(this)[h.getName()]))}if(f){for(h=d,g=0;!(i=e.elements[g]).equals(f);g++)i.match||((i=i.clone()).append(h),h=i);h["start"==f.match?"insertBefore":"insertAfter"](f)}}else{var j=c.endNode,m=this;for(b(),e=d;!e.equals(j);)f=e.getNextSourceNode(),e.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(e)&&(e.getName()==this.element?s.call(this,e):q(e,o(this)[e.getName()]),f.type==CKEDITOR.NODE_ELEMENT&&f.contains(d)&&(b(),f=d.getNext())),e=f}a.moveToBookmark(c),a.shrink(CKEDITOR.NODE_ELEMENT,!0)}function c(a){var b=[];return a.forEach(function(a){if("true"==a.getAttribute("contenteditable"))return b.push(a),!1},CKEDITOR.NODE_ELEMENT,!0),b}function e(a){var b=a.getEnclosedNode()||a.getCommonAncestor(!1,!0);(a=new CKEDITOR.dom.elementPath(b,a.root).contains(this.element,1))&&!a.isReadOnly()&&A(a,this)}function d(a){var b=a.getCommonAncestor(!0,!0);if(a=new CKEDITOR.dom.elementPath(b,a.root).contains(this.element,1)){var c=(b=this._.definition).attributes;if(c)for(var d in c)a.removeAttribute(d,c[d]);if(b.styles)for(var e in b.styles)b.styles.hasOwnProperty(e)&&a.removeStyle(e)}}function h(a){var b=a.createBookmark(!0),c=a.createIterator();c.enforceRealBlocks=!0,this._.enterMode&&(c.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);for(var d,e=a.document;d=c.getNextParagraph();)!d.isReadOnly()&&(c.activeFilter?c.activeFilter.check(this):1)&&j(d,i(this,e,d));a.moveToBookmark(b)}function k(a){var b=a.createBookmark(1),c=a.createIterator();c.enforceRealBlocks=!0,c.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;for(var d,e;d=c.getNextParagraph();)this.checkElementRemovable(d)&&(d.is("pre")?((e=this._.enterMode==CKEDITOR.ENTER_BR?null:a.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&d.copyAttributes(e),j(d,e)):s.call(this,d));a.moveToBookmark(b)}function j(a,b){var c=!b;c&&(b=a.getDocument().createElement("div"),a.copyAttributes(b));var d=b&&b.is("pre"),e=a.is("pre"),f=!d&&e;if(d&&!e){if(e=b,(f=a.getBogus())&&f.remove(),f=a.getHtml(),f=m(f,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),f=f.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),f=f.replace(/([ \t\n\r]+|&nbsp;)/g," "),f=f.replace(/<br\b[^>]*>/gi,"\n"),CKEDITOR.env.ie){var h=a.getDocument().createElement("div");h.append(e),e.$.outerHTML="<pre>"+f+"</pre>",e.copyAttributes(h.getFirst()),e=h.getFirst().remove()}else e.setHtml(f);b=e}else f?b=y(c?[a.getHtml()]:g(a),b):a.moveChildren(b);if(b.replace(a),d){var i;(i=(c=b).getPrevious(F))&&i.type==CKEDITOR.NODE_ELEMENT&&i.is("pre")&&(d=m(i.getHtml(),/\n$/,"")+"\n\n"+m(c.getHtml(),/^\n/,""),CKEDITOR.env.ie?c.$.outerHTML="<pre>"+d+"</pre>":c.setHtml(d),i.remove())}else c&&t(b)}function g(a){var b=[];return m(a.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(a,c){b.push(c)}),b}function m(a,b,c){var d="",e="",a=a.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,function(a,b,c){return b&&(d=b),c&&(e=c),""});return d+a.replace(b,c)+e}function y(a,b){var c;a.length>1&&(c=new CKEDITOR.dom.documentFragment(b.getDocument()));for(var d=0;d<a.length;d++){var e=(e=(e=m(e=m(e=m(e=(e=a[d]).replace(/(\r\n|\r)/g,"\n"),/^[ \t]*\n/,""),/\n$/,""),/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+CKEDITOR.tools.repeat("&nbsp;",a.length-1):CKEDITOR.tools.repeat("&nbsp;",a.length-1)+" "})).replace(/\n/g,"<br>")).replace(/[ \t]{2,}/g,function(a){return CKEDITOR.tools.repeat("&nbsp;",a.length-1)+" "});if(c){var f=b.clone();f.setHtml(e),c.append(f)}else b.setHtml(e)}return c||b}function s(a,b){var g,d=(c=this._.definition).attributes,c=c.styles,e=o(this)[a.getName()],f=CKEDITOR.tools.isEmpty(d)&&CKEDITOR.tools.isEmpty(c);for(g in d)("class"==g||this._.definition.fullMatch)&&a.getAttribute(g)!=l(g,d[g])||b&&"data-"==g.slice(0,5)||(f=a.hasAttribute(g),a.removeAttribute(g));for(var h in c)this._.definition.fullMatch&&a.getStyle(h)!=l(h,c[h],!0)||(f=f||!!a.getStyle(h),a.removeStyle(h));q(a,e,r[a.getName()]),f&&(this._.definition.alwaysRemoveElement?t(a,1):!CKEDITOR.dtd.$block[a.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!a.hasAttributes()?t(a):a.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function w(a){for(var d,b=o(this),c=a.getElementsByTag(this.element),e=c.count();--e>=0;)(d=c.getItem(e)).isReadOnly()||s.call(this,d,!0);for(var f in b)if(f!=this.element)for(e=(c=a.getElementsByTag(f)).count()-1;e>=0;e--)(d=c.getItem(e)).isReadOnly()||q(d,b[f])}function q(a,b,c){if(b=b&&b.attributes)for(var d=0;d<b.length;d++){var f,e=b[d][0];if(f=a.getAttribute(e)){var g=b[d][1];(null===g||g.test&&g.test(f)||"string"==typeof g&&f==g)&&a.removeAttribute(e)}}c||t(a)}function t(a,b){if(!a.hasAttributes()||b)if(CKEDITOR.dtd.$block[a.getName()]){var c=a.getPrevious(F),d=a.getNext(F);c&&(c.type==CKEDITOR.NODE_TEXT||!c.isBlockBoundary({br:1}))&&a.append("br",1),d&&(d.type==CKEDITOR.NODE_TEXT||!d.isBlockBoundary({br:1}))&&a.append("br"),a.remove(!0)}else c=a.getFirst(),d=a.getLast(),a.remove(!0),c&&(c.type==CKEDITOR.NODE_ELEMENT&&c.mergeSiblings(),d&&!c.equals(d)&&d.type==CKEDITOR.NODE_ELEMENT&&d.mergeSiblings())}function i(a,b,c){var d;return"*"==(d=a.element)&&(d="span"),d=new CKEDITOR.dom.element(d,b),c&&c.copyAttributes(d),d=A(d,a),b.getCustomData("doc_processing_style")&&d.hasAttribute("id")?d.removeAttribute("id"):b.setCustomData("doc_processing_style",1),d}function A(a,b){var d=(c=b._.definition).attributes,c=CKEDITOR.style.getStyleText(c);if(d)for(var e in d)a.setAttribute(e,d[e]);return c&&a.setAttribute("style",c),a}function u(a,b){for(var c in a)a[c]=a[c].replace(C,function(a,c){return b[c]})}function o(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;if(c){CKEDITOR.tools.isArray(c)||(c=[c]);for(var d=0;d<c.length;d++){var f,g;if("string"==typeof(e=c[d])?f=e.toLowerCase():(f=e.element?e.element.toLowerCase():a.element,g=e.attributes),e=b[f]||(b[f]={}),g){var h,e=e.attributes=e.attributes||[];for(h in g)e.push([h.toLowerCase(),g[h]])}}}return b}function l(a,b,c){var d=new CKEDITOR.dom.element("span");return d[c?"setStyle":"setAttribute"](a,b),d[c?"getStyle":"getAttribute"](a)}function p(a,b,c){for(var f,d=a.document,e=a.getRanges(),b=b?this.removeFromRange:this.applyToRange,g=e.createIterator();f=g.getNextRange();)b.call(this,f,c);a.selectRanges(e),d.removeCustomData("doc_processing_style")}var r={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},n={a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},P=/\s*(?:;\s*|$)/,C=/#\((.+?)\)/g,L=CKEDITOR.dom.walker.bookmark(0,1),F=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(a,b){if("string"==typeof a.type)return new CKEDITOR.style.customHandlers[a.type](a);var c=a.attributes;c&&c.style&&(a.styles=CKEDITOR.tools.extend({},a.styles,CKEDITOR.tools.parseCssText(c.style)),delete c.style),b&&(u((a=CKEDITOR.tools.clone(a)).attributes,b),u(a.styles,b)),c=this.element=a.element?"string"==typeof a.element?a.element.toLowerCase():a.element:"*",this.type=a.type||(r[c]?CKEDITOR.STYLE_BLOCK:n[c]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE),"object"==typeof this.element&&(this.type=CKEDITOR.STYLE_OBJECT),this._={definition:a}},CKEDITOR.style.prototype={apply:function(a){if(a instanceof CKEDITOR.dom.document)return p.call(this,a.getSelection());if(this.checkApplicable(a.elementPath(),a)){var b=this._.enterMode;b||(this._.enterMode=a.activeEnterMode),p.call(this,a.getSelection(),0,a),this._.enterMode=b}},remove:function(a){if(a instanceof CKEDITOR.dom.document)return p.call(this,a.getSelection(),1);if(this.checkApplicable(a.elementPath(),a)){var b=this._.enterMode;b||(this._.enterMode=a.activeEnterMode),p.call(this,a.getSelection(),1,a),this._.enterMode=b}},applyToRange:function(a){return this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?f:this.type==CKEDITOR.STYLE_BLOCK?h:this.type==CKEDITOR.STYLE_OBJECT?e:null,this.applyToRange(a)},removeFromRange:function(a){return this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?b:this.type==CKEDITOR.STYLE_BLOCK?k:this.type==CKEDITOR.STYLE_OBJECT?d:null,this.removeFromRange(a)},applyToObject:function(a){A(a,this)},checkActive:function(a,b){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,!0,b);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var e,c=a.elements,d=0;d<c.length;d++)if(e=c[d],this.type!=CKEDITOR.STYLE_INLINE||e!=a.block&&e!=a.blockLimit){if(this.type==CKEDITOR.STYLE_OBJECT){var f=e.getName();if(!("string"==typeof this.element?f==this.element:f in this.element))continue}if(this.checkElementRemovable(e,!0,b))return!0}}return!1},checkApplicable:function(a,b,c){if(b&&b instanceof CKEDITOR.filter&&(c=b),c&&!c.check(this))return!1;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!a.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!a.blockLimit.getDtd()[this.element]}return!0},checkElementMatch:function(a,b){var c=this._.definition;if(!a||!c.ignoreReadonly&&a.isReadOnly())return!1;d=a.getName();if("string"==typeof this.element?d==this.element:d in this.element){if(!b&&!a.hasAttributes())return!0;if(d=c._AC)c=d;else{var d={},e=0,f=c.attributes;if(f)for(var g in f)e++,d[g]=f[g];(g=CKEDITOR.style.getStyleText(c))&&(d.style||e++,d.style=g),d._length=e,c=c._AC=d}if(!c._length)return!0;for(var h in c)if("_length"!=h){if(e=a.getAttribute(h)||"","style"==h)a:{"string"==typeof(d=c[h])&&(d=CKEDITOR.tools.parseCssText(d)),"string"==typeof e&&(e=CKEDITOR.tools.parseCssText(e,!0)),g=void 0;for(g in d)if(!(g in e)||e[g]!=d[g]&&"inherit"!=d[g]&&"inherit"!=e[g]){d=!1;break a}d=!0}else d=c[h]==e;if(d){if(!b)return!0}else if(b)return!1}if(b)return!0}return!1},checkElementRemovable:function(a,b,c){if(this.checkElementMatch(a,b,c))return!0;if(b=o(this)[a.getName()]){var d;if(!(b=b.attributes))return!0;for(c=0;c<b.length;c++)if(d=b[c][0],d=a.getAttribute(d)){var e=b[c][1];if(null===e)return!0;if("string"==typeof e){if(d==e)return!0}else if(e.test(d))return!0}}return!1},buildPreview:function(a){var b=this._.definition,c=[],d=b.element;"bdo"==d&&(d="span");var c=["<",d],e=b.attributes;if(e)for(var f in e)c.push(" ",f,'="',e[f],'"');return(e=CKEDITOR.style.getStyleText(b))&&c.push(' style="',e,'"'),c.push(">",a||b.name,"</",d,">"),c.join("")},getDefinition:function(){return this._.definition}},CKEDITOR.style.getStyleText=function(a){if(b=a._ST)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(P,";"));for(var e in b){var f=b[e],g=(e+":"+f).replace(P,";");"inherit"==f?d+=g:c+=g}return c.length&&(c=CKEDITOR.tools.normalizeCssText(c,!0)),a._ST=c+d},CKEDITOR.style.customHandlers={},CKEDITOR.style.addCustomHandler=function(a){var b=function(a){this._={definition:a},this.setup&&this.setup(a)};return b.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},a,!0),this.customHandlers[a.type]=b};var K=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,I=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED}(),CKEDITOR.styleCommand=function(a,f){this.requiredContent=this.allowedContent=this.style=a,CKEDITOR.tools.extend(this,f,!0)},CKEDITOR.styleCommand.prototype.exec=function(a){a.focus(),this.state==CKEDITOR.TRISTATE_OFF?a.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&a.removeStyle(this.style)},CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet"),CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet),CKEDITOR.loadStylesSet=function(a,f,b){CKEDITOR.stylesSet.addExternal(a,f,""),CKEDITOR.stylesSet.load(a,b)},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(a,f){var b=this._.styleStateChangeCallbacks;b||(b=this._.styleStateChangeCallbacks=[],this.on("selectionChange",function(a){for(var e=0;e<b.length;e++){var d=b[e],f=d.style.checkActive(a.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;d.fn.call(this,f)}})),b.push({style:a,fn:f})},applyStyle:function(a){a.apply(this)},removeStyle:function(a){a.remove(this)},getStylesSet:function(a){if(this._.stylesDefinitions)a(this._.stylesDefinitions);else{var f=this,b=f.config.stylesCombo_stylesSet||f.config.stylesSet;if(!1===b)a(null);else if(b instanceof Array)f._.stylesDefinitions=b,a(b);else{b||(b="default");var c=(b=b.split(":"))[0];CKEDITOR.stylesSet.addExternal(c,b[1]?b.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),""),CKEDITOR.stylesSet.load(c,function(b){f._.stylesDefinitions=b[c],a(f._.stylesDefinitions)})}}}}),CKEDITOR.dom.comment=function(a,f){"string"==typeof a&&(a=(f?f.$:document).createComment(a)),CKEDITOR.dom.domObject.call(this,a)},CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"\x3c!--"+this.$.nodeValue+"--\x3e"}}),function(){var b,a={},f={};for(b in CKEDITOR.dtd.$blockLimit)b in CKEDITOR.dtd.$list||(a[b]=1);for(b in CKEDITOR.dtd.$block)b in CKEDITOR.dtd.$blockLimit||b in CKEDITOR.dtd.$empty||(f[b]=1);CKEDITOR.dom.elementPath=function(b,e){var g,d=null,h=null,k=[],j=b,e=e||b.getDocument().getBody();do{if(j.type==CKEDITOR.NODE_ELEMENT){if(k.push(j),!this.lastElement&&(this.lastElement=j,j.is(CKEDITOR.dtd.$object)||"false"==j.getAttribute("contenteditable")))continue;if(j.equals(e))break;if(!h&&(g=j.getName(),"true"==j.getAttribute("contenteditable")?h=j:!d&&f[g]&&(d=j),a[g])){var m;if(m=!d){if(g="div"==g){a:{m=0;for(var y=(g=j.getChildren()).count();m<y;m++){var s=g.getItem(m);if(s.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[s.getName()]){g=!0;break a}}g=!1}g=!g}m=g}m?d=j:h=j}}}while(j=j.getParent());h||(h=e),this.block=d,this.blockLimit=h,this.root=e,this.elements=k}}(),CKEDITOR.dom.elementPath.prototype={compare:function(a){var f=this.elements;if(!(a=a&&a.elements)||f.length!=a.length)return!1;for(var b=0;b<f.length;b++)if(!f[b].equals(a[b]))return!1;return!0},contains:function(a,f,b){var c;"string"==typeof a&&(c=function(b){return b.getName()==a}),a instanceof CKEDITOR.dom.element?c=function(b){return b.equals(a)}:CKEDITOR.tools.isArray(a)?c=function(b){return CKEDITOR.tools.indexOf(a,b.getName())>-1}:"function"==typeof a?c=a:"object"==typeof a&&(c=function(b){return b.getName()in a});var e=this.elements,d=e.length;for(f&&d--,b&&(e=Array.prototype.slice.call(e,0)).reverse(),f=0;f<d;f++)if(c(e[f]))return e[f];return null},isContextFor:function(a){return!(a in CKEDITOR.dtd.$block)||!!(this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit).getDtd()[a]},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}},CKEDITOR.dom.text=function(a,f){"string"==typeof a&&(a=(f?f.$:document).createTextNode(a)),this.$=a},CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(a){this.$.nodeValue=a},split:function(a){var f=this.$.parentNode,b=f.childNodes.length,c=this.getLength(),e=this.getDocument(),d=new CKEDITOR.dom.text(this.$.splitText(a),e);return f.childNodes.length==b&&(a>=c?(d=e.createText("")).insertAfter(this):((a=e.createText("")).insertAfter(d),a.remove())),d},substring:function(a,f){return"number"!=typeof f?this.$.nodeValue.substr(a):this.$.nodeValue.substring(a,f)}}),function(){function a(a,c,e){var d=a.serializable,f=c[e?"endContainer":"startContainer"],k=e?"endOffset":"startOffset",j=d?c.document.getById(a.startNode):a.startNode,a=d?c.document.getById(a.endNode):a.endNode;return f.equals(j.getPrevious())?(c.startOffset=c.startOffset-f.getLength()-a.getPrevious().getLength(),f=a.getNext()):f.equals(a.getPrevious())&&(c.startOffset=c.startOffset-f.getLength(),f=a.getNext()),f.equals(j.getParent())&&c[k]++,f.equals(a.getParent())&&c[k]++,c[e?"endContainer":"startContainer"]=f,c}CKEDITOR.dom.rangeList=function(a){return a instanceof CKEDITOR.dom.rangeList?a:(a?a instanceof CKEDITOR.dom.range&&(a=[a]):a=[],CKEDITOR.tools.extend(a,f))};var f={createIterator:function(){var d,a=this,c=CKEDITOR.dom.walker.bookmark(),e=[];return{getNextRange:function(f){var k=a[d=void 0===d?0:d+1];if(k&&a.length>1){if(!d)for(j=a.length-1;j>=0;j--)e.unshift(a[j].createBookmark(!0));if(f)for(var g=0;a[d+g+1];){for(var f=0,j=(m=k.document).getById(e[g].endNode),m=m.getById(e[g+1].startNode);;){if(j=j.getNextSourceNode(!1),m.equals(j))f=1;else if(c(j)||j.type==CKEDITOR.NODE_ELEMENT&&j.isBlockBoundary())continue;break}if(!f)break;g++}for(k.moveToBookmark(e.shift());g--;)(j=a[++d]).moveToBookmark(e.shift()),k.setEnd(j.endContainer,j.endOffset)}return k}}},createBookmarks:function(b){for(var e,c=[],d=0;d<this.length;d++){c.push(e=this[d].createBookmark(b,!0));for(var f=d+1;f<this.length;f++)this[f]=a(e,this[f]),this[f]=a(e,this[f],!0)}return c},createBookmarks2:function(a){for(var c=[],e=0;e<this.length;e++)c.push(this[e].createBookmark2(a));return c},moveToBookmarks:function(a){for(var c=0;c<this.length;c++)this[c].moveToBookmark(a[c])}}}(),function(){function a(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function f(b){var c=CKEDITOR.skin["ua_"+b],d=CKEDITOR.env;if(c)for(var f,c=c.split(",").sort(function(a,b){return a>b?-1:1}),e=0;e<c.length;e++)if(f=c[e],d.ie&&(f.replace(/^ie/,"")==d.version||d.quirks&&"iequirks"==f)&&(f="ie"),d[f]){b=b+"_"+c[e];break}return CKEDITOR.getUrl(a()+b+".css")}function b(a,b){d[a]||(CKEDITOR.document.appendStyleSheet(f(a)),d[a]=1),b&&b()}function c(a){var b=a.getById(h);return b||((b=a.getHead().append("style")).setAttribute("id",h),b.setAttribute("type","text/css")),b}function e(a,b,c){var d,e,f;if(CKEDITOR.env.webkit)for(b=b.split("}").slice(0,-1),e=0;e<b.length;e++)b[e]=b[e].split("{");for(var h=0;h<a.length;h++)if(CKEDITOR.env.webkit)for(e=0;e<b.length;e++){for(f=b[e][1],d=0;d<c.length;d++)f=f.replace(c[d][0],c[d][1]);a[h].$.sheet.addRule(b[e][0],f)}else{for(f=b,d=0;d<c.length;d++)f=f.replace(c[d][0],c[d][1]);CKEDITOR.env.ie&&CKEDITOR.env.version<11?a[h].$.styleSheet.cssText=a[h].$.styleSheet.cssText+f:a[h].$.innerHTML=a[h].$.innerHTML+f}}var d={};CKEDITOR.skin={path:a,loadPart:function(c,d){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(a()+"skin.js"),function(){b(c,d)}):b(c,d)},getPath:function(a){return CKEDITOR.getUrl(f(a))},icons:{},addIcon:function(a,b,c,d){a=a.toLowerCase(),this.icons[a]||(this.icons[a]={path:b,offset:c||0,bgsize:d||"16px"})},getIconStyle:function(a,b,c,d,e){var f;return a&&(a=a.toLowerCase(),b&&(f=this.icons[a+"-rtl"]),f||(f=this.icons[a])),a=c||f&&f.path||"",d=d||f&&f.offset,e=e||f&&f.bgsize||"16px",a&&"background-image:url("+CKEDITOR.getUrl(a)+");background-position:0 "+d+"px;background-size:"+e+";"}},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(a){var b=c(CKEDITOR.document);return(this.setUiColor=function(a){this.uiColor=a;var c=CKEDITOR.skin.chameleon,d="",f="";"function"==typeof c&&(d=c(this,"editor"),f=c(this,"panel")),e([b],d,a=[[j,a]]),e(k,f,a)}).call(this,a)}});var h="cke_ui_color",k=[],j=/\$color/g;CKEDITOR.on("instanceLoaded",function(a){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var b=a.editor,a=function(a){if(!(a=(a.data[0]||a.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument()).getById("cke_ui_color")){a=c(a),k.push(a);var d=b.getUiColor();d&&e([a],CKEDITOR.skin.chameleon(b,"panel"),[[j,d]])}};b.on("panelShow",a),b.on("menuShow",a),b.config.uiColor&&b.setUiColor(b.config.uiColor)}})}(),function(){if(CKEDITOR.env.webkit)CKEDITOR.env.hc=!1;else{var a=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);a.appendTo(CKEDITOR.document.getHead());try{var f=a.getComputedStyle("border-top-color"),b=a.getComputedStyle("border-right-color");CKEDITOR.env.hc=!(!f||f!=b)}catch(c){CKEDITOR.env.hc=!1}a.remove()}if(CKEDITOR.env.hc&&(CKEDITOR.env.cssClass=CKEDITOR.env.cssClass+" cke_hc"),CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}"),CKEDITOR.status="loaded",CKEDITOR.fireOnce("loaded"),a=CKEDITOR._.pending)for(delete CKEDITOR._.pending,f=0;f<a.length;f++)CKEDITOR.editor.prototype.constructor.apply(a[f][0],a[f][1]),CKEDITOR.add(a[f][0])}(),CKEDITOR.skin.name="moono",CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko",CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8",CKEDITOR.skin.chameleon=function(){var b=function(b,e){for(var a=b.match(/[^#]./g),c=0;3>c;c++){var d,f=a,h=c;d=parseInt(a[c],16),d=("0"+(0>e?0|d*(1+e):0|d+(255-d)*e).toString(16)).slice(-2),f[h]=d}return"#"+a.join("")},c=function(){var b=new CKEDITOR.template("background:#{to};background-image:-webkit-gradient(linear,lefttop,leftbottom,from({from}),to({to}));background-image:-moz-linear-gradient(top,{from},{to});background-image:-webkit-linear-gradient(top,{from},{to});background-image:-o-linear-gradient(top,{from},{to});background-image:-ms-linear-gradient(top,{from},{to});background-image:linear-gradient(top,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(c,a){return b.output({from:c,to:a})}}(),f={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};return function(g,e){var a=g.uiColor,a={id:"."+g.id,defaultBorder:b(a,-.1),defaultGradient:c(b(a,.9),a),lightGradient:c(b(a,1),b(a,.7)),mediumGradient:c(b(a,.8),b(a,.5)),ckeButtonOn:c(b(a,.6),b(a,.7)),ckeResizer:b(a,-.4),ckeToolbarSeparator:b(a,.5),ckeColorauto:b(a,.8),dialogBody:b(a,.7),dialogTabSelected:c("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:b(a,-.6),elementsPathBg:a,menubuttonIcon:b(a,.5),menubuttonIconHover:b(a,.3)};return f[e].output(a).replace(/\[/g,"{").replace(/\]/g,"}")}}(),CKEDITOR.plugins.add("basicstyles",{init:function(c){var e=0,d=function(g,d,b,a){if(a){var a=new CKEDITOR.style(a),f=h[b];f.unshift(a),c.attachStyleStateChange(a,function(a){!c.readOnly&&c.getCommand(b).setState(a)}),c.addCommand(b,new CKEDITOR.styleCommand(a,{contentForms:f})),c.ui.addButton&&c.ui.addButton(g,{label:d,command:b,toolbar:"basicstyles,"+(e+=10)})}},h={bold:["strong","b",["span",function(a){return"bold"==(a=a.styles["font-weight"])||700<=+a}]],italic:["em","i",["span",function(a){return"italic"==a.styles["font-style"]}]],underline:["u",["span",function(a){return"underline"==a.styles["text-decoration"]}]],strike:["s","strike",["span",function(a){return"line-through"==a.styles["text-decoration"]}]],subscript:["sub"],superscript:["sup"]},b=c.config,a=c.lang.basicstyles;d("Bold",a.bold,"bold",b.coreStyles_bold),d("Italic",a.italic,"italic",b.coreStyles_italic),d("Underline",a.underline,"underline",b.coreStyles_underline),d("Strike",a.strike,"strike",b.coreStyles_strike),d("Subscript",a.subscript,"subscript",b.coreStyles_subscript),d("Superscript",a.superscript,"superscript",b.coreStyles_superscript),c.setKeystroke([[CKEDITOR.CTRL+66,"bold"],[CKEDITOR.CTRL+73,"italic"],[CKEDITOR.CTRL+85,"underline"]])}}),CKEDITOR.config.coreStyles_bold={element:"strong",overrides:"b"},CKEDITOR.config.coreStyles_italic={element:"em",overrides:"i"},CKEDITOR.config.coreStyles_underline={element:"u"},CKEDITOR.config.coreStyles_strike={element:"s",overrides:"strike"},CKEDITOR.config.coreStyles_subscript={element:"sub"},CKEDITOR.config.coreStyles_superscript={element:"sup"},function(){c='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(c+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(c+=' onblur="this.style.cssText = this.style.cssText;"');var c=(c=c+' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}"')+'>&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span>{arrowHtml}</a>',o=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),p=CKEDITOR.addTemplate("button",c);CKEDITOR.plugins.add("button",{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}}),CKEDITOR.UI_BUTTON="button",CKEDITOR.ui.button=function(a){CKEDITOR.tools.extend(this,a,{title:a.label,click:a.click||function(b){b.execCommand(a.command)}}),this._={}},CKEDITOR.ui.button.handler={create:function(a){return new CKEDITOR.ui.button(a)}},CKEDITOR.ui.button.prototype={render:function(a,b){function c(){var e=a.mode;e&&(e=this.modes[e]?void 0!==i[e]?i[e]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,e=a.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:e,this.setState(e),this.refresh&&this.refresh())}var l,j=CKEDITOR.env,k=this._.id=CKEDITOR.tools.getNextId(),f="",g=this.command;this._.editor=a;var d={id:k,button:this,editor:a,focus:function(){CKEDITOR.document.getById(k).focus()},execute:function(){this.button.click(a)},attach:function(a){this.button.attach(a)}},q=CKEDITOR.tools.addFunction(function(a){if(d.onkey)return a=new CKEDITOR.dom.event(a),!1!==d.onkey(d,a.getKeystroke())}),r=CKEDITOR.tools.addFunction(function(a){var b;return d.onfocus&&(b=!1!==d.onfocus(d,new CKEDITOR.dom.event(a))),b}),m=0;if(d.clickFn=l=CKEDITOR.tools.addFunction(function(){m&&(a.unlockSelection(1),m=0),d.execute(),j.iOS&&a.focus()}),this.modes){var i={};a.on("beforeModeUnload",function(){a.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(i[a.mode]=this._.state)},this),a.on("activeFilterChange",c,this),a.on("mode",c,this),!this.readOnly&&a.on("readOnly",c,this)}else g&&(g=a.getCommand(g))&&(g.on("state",function(){this.setState(g.state)},this),f+=g.state==CKEDITOR.TRISTATE_ON?"on":g.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off");this.directional&&a.on("contentDirChanged",function(b){var c=CKEDITOR.document.getById(this._.id),d=c.getFirst();(b=b.data)!=a.lang.dir?c.addClass("cke_"+b):c.removeClass("cke_ltr").removeClass("cke_rtl"),d.setAttribute("style",CKEDITOR.skin.getIconStyle(h,"rtl"==b,this.icon,this.iconOffset))},this),g||(f+="off");var n=this.name||this.command,h=n;return this.icon&&!/\./.test(this.icon)&&(h=this.icon,this.icon=null),f={id:k,name:n,iconName:h,label:this.label,cls:this.className||"",state:f,ariaDisabled:"disabled"==f?"true":"false",title:this.title,titleJs:j.gecko&&!j.hc?"":(this.title||"").replace("'",""),hasArrow:this.hasArrow?"true":"false",keydownFn:q,focusFn:r,clickFn:l,style:CKEDITOR.skin.getIconStyle(h,"rtl"==a.lang.dir,this.icon,this.iconOffset),arrowHtml:this.hasArrow?o.output():""},p.output(f,b),this.onRender&&this.onRender(),d},setState:function(a){if(this._.state==a)return!1;this._.state=a;var b=CKEDITOR.document.getById(this._.id);return!!b&&(b.setState(a,"cke_button"),a==CKEDITOR.TRISTATE_DISABLED?b.setAttribute("aria-disabled",!0):b.removeAttribute("aria-disabled"),this.hasArrow?(a=a==CKEDITOR.TRISTATE_ON?this._.editor.lang.button.selectedLabel.replace(/%1/g,this.label):this.label,CKEDITOR.document.getById(this._.id+"_label").setText(a)):a==CKEDITOR.TRISTATE_ON?b.setAttribute("aria-pressed",!0):b.removeAttribute("aria-pressed"),!0)},getState:function(){return this._.state},toFeature:function(a){if(this._.feature)return this._.feature;var b=this;return!this.allowedContent&&!this.requiredContent&&this.command&&(b=a.getCommand(this.command)||b),this._.feature=b}},CKEDITOR.ui.prototype.addButton=function(a,b){this.add(a,CKEDITOR.UI_BUTTON,b)}}(),function(){CKEDITOR.plugins.add("panel",{beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_PANEL,CKEDITOR.ui.panel.handler)}}),CKEDITOR.UI_PANEL="panel",CKEDITOR.ui.panel=function(a,b){b&&CKEDITOR.tools.extend(this,b),CKEDITOR.tools.extend(this,{className:"",css:[]}),this.id=CKEDITOR.tools.getNextId(),this.document=a,this.isFramed=this.forceIFrame||this.css.length,this._={blocks:{}}},CKEDITOR.ui.panel.handler={create:function(a){return new CKEDITOR.ui.panel(a)}};var f=CKEDITOR.addTemplate("panel",'<div lang="{langCode}" id="{id}" dir={dir} class="cke cke_reset_all {editorId} cke_panel cke_panel {cls} cke_{dir}" style="z-index:{z-index}" role="presentation">{frame}</div>'),g=CKEDITOR.addTemplate("panel-frame",'<iframe id="{id}" class="cke_panel_frame" role="presentation" frameborder="0" src="{src}"></iframe>'),h=CKEDITOR.addTemplate("panel-frame-inner",'<!DOCTYPE html><html class="cke_panel_container {env}" dir="{dir}" lang="{langCode}"><head>{css}</head><body class="cke_{dir}" style="margin:0;padding:0" onload="{onload}"></body></html>');CKEDITOR.ui.panel.prototype={render:function(a,b){this.getHolderElement=function(){if(!(a=this._.holder)){if(this.isFramed){var b=(a=this.document.getById(this.id+"_frame")).getParent(),a=a.getFrameDocument();CKEDITOR.env.iOS&&b.setStyles({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),b=CKEDITOR.tools.addFunction(CKEDITOR.tools.bind(function(){this.isLoaded=!0,this.onLoad&&this.onLoad()},this)),a.write(h.output(CKEDITOR.tools.extend({css:CKEDITOR.tools.buildStyleHtml(this.css),onload:"window.parent.CKEDITOR.tools.callFunction("+b+");"},d))),a.getWindow().$.CKEDITOR=CKEDITOR,a.on("keydown",function(a){var b=a.data.getKeystroke(),c=this.document.getById(this.id).getAttribute("dir");this._.onKeyDown&&!1===this._.onKeyDown(b)?a.data.preventDefault():(27==b||b==("rtl"==c?39:37))&&this.onEscape&&!1===this.onEscape(b)&&a.data.preventDefault()},this),(a=a.getBody()).unselectable(),CKEDITOR.env.air&&CKEDITOR.tools.callFunction(b)}else a=this.document.getById(this.id);this._.holder=a}return a};var d={editorId:a.id,id:this.id,langCode:a.langCode,dir:a.lang.dir,cls:this.className,frame:"",env:CKEDITOR.env.cssClass,"z-index":a.config.baseFloatZIndex+1};if(this.isFramed){var e=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())":"";d.frame=g.output({id:this.id+"_frame",src:e})}return e=f.output(d),b&&b.push(e),e},addBlock:function(a,b){return b=this._.blocks[a]=b instanceof CKEDITOR.ui.panel.block?b:new CKEDITOR.ui.panel.block(this.getHolderElement(),b),this._.currentBlock||this.showBlock(a),b},getBlock:function(a){return this._.blocks[a]},showBlock:function(a){var a=this._.blocks[a],b=this._.currentBlock,d=!this.forceIFrame||CKEDITOR.env.ie?this._.holder:this.document.getById(this.id+"_frame");return b&&b.hide(),this._.currentBlock=a,CKEDITOR.fire("ariaWidget",d),a._.focusIndex=-1,this._.onKeyDown=a.onKeyDown&&CKEDITOR.tools.bind(a.onKeyDown,a),a.show(),a},destroy:function(){this.element&&this.element.remove()}},CKEDITOR.ui.panel.block=CKEDITOR.tools.createClass({$:function(a,b){this.element=a.append(a.getDocument().createElement("div",{attributes:{tabindex:-1,class:"cke_panel_block"},styles:{display:"none"}})),b&&CKEDITOR.tools.extend(this,b),this.element.setAttributes({role:this.attributes.role||"presentation","aria-label":this.attributes["aria-label"],title:this.attributes.title||this.attributes["aria-label"]}),this.keys={},this._.focusIndex=-1,this.element.disableContextMenu()},_:{markItem:function(a){-1!=a&&(a=this.element.getElementsByTag("a").getItem(this._.focusIndex=a),CKEDITOR.env.webkit&&a.getDocument().getWindow().focus(),a.focus(),this.onMark&&this.onMark(a))}},proto:{show:function(){this.element.setStyle("display","")},hide:function(){(!this.onHide||!0!==this.onHide.call(this))&&this.element.setStyle("display","none")},onKeyDown:function(a,b){switch(d=this.keys[a]){case"next":for(var c,e=this._.focusIndex,d=this.element.getElementsByTag("a");c=d.getItem(++e);)if(c.getAttribute("_cke_focus")&&c.$.offsetWidth){this._.focusIndex=e,c.focus();break}return!c&&!b&&(this._.focusIndex=-1,this.onKeyDown(a,1));case"prev":for(e=this._.focusIndex,d=this.element.getElementsByTag("a");0<e&&(c=d.getItem(--e));){if(c.getAttribute("_cke_focus")&&c.$.offsetWidth){this._.focusIndex=e,c.focus();break}c=null}return!c&&!b&&(this._.focusIndex=d.count(),this.onKeyDown(a,1));case"click":case"mouseup":return e=this._.focusIndex,(c=0<=e&&this.element.getElementsByTag("a").getItem(e))&&(c.$[d]?c.$[d]():c.$["on"+d]()),!1}return!0}}})}(),CKEDITOR.plugins.add("floatpanel",{requires:"panel"}),function(){function r(a,b,c,i,f){var f=CKEDITOR.tools.genKey(b.getUniqueId(),c.getUniqueId(),a.lang.dir,a.uiColor||"",i.css||"",f||""),h=g[f];return h||(h=g[f]=new CKEDITOR.ui.panel(b,i),h.element=c.append(CKEDITOR.dom.element.createFromHtml(h.render(a),b)),h.element.setStyles({display:"none",position:"absolute"})),h}var g={};CKEDITOR.ui.floatPanel=CKEDITOR.tools.createClass({$:function(a,b,c,i){function f(){d.hide()}c.forceIFrame=1,c.toolbarRelated&&a.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&(b=CKEDITOR.document.getById("cke_"+a.name));var h=b.getDocument(),j=(i=r(a,h,b,c,i||0)).element,l=j.getFirst(),d=this;j.disableContextMenu(),this.element=j,this._={editor:a,panel:i,parentElement:b,definition:c,document:h,iframe:l,children:[],dir:a.lang.dir},a.on("mode",f),a.on("resize",f),CKEDITOR.env.iOS||h.getWindow().on("resize",f)},proto:{addBlock:function(a,b){return this._.panel.addBlock(a,b)},addListBlock:function(a,b){return this._.panel.addListBlock(a,b)},getBlock:function(a){return this._.panel.getBlock(a)},showBlock:function(a,b,c,i,f,h){var j=this._.panel,l=j.showBlock(a);this.allowBlur(!1),a=this._.editor.editable(),this._.returnFocus=a.hasFocus?a:new CKEDITOR.dom.element(CKEDITOR.document.$.activeElement),this._.hideTimeout=0;var d=this.element,a=this._.iframe,a=CKEDITOR.env.ie?a:new CKEDITOR.dom.window(a.$.contentWindow),g=d.getDocument(),o=this._.parentElement.getPositionedAncestor(),p=b.getDocumentPosition(g),g=o?o.getDocumentPosition(g):{x:0,y:0},m="rtl"==this._.dir,e=p.x+(i||0)-g.x,k=p.y+(f||0)-g.y;!m||1!=c&&4!=c?m||2!=c&&3!=c||(e+=b.$.offsetWidth-1):e+=b.$.offsetWidth,3!=c&&4!=c||(k+=b.$.offsetHeight-1),this._.panel._.offsetParentId=b.getId(),d.setStyles({top:k+"px",left:0,display:""}),d.setOpacity(0),d.getFirst().removeStyle("width"),this._.editor.focusManager.add(a),this._.blurSet||(CKEDITOR.event.useCapture=!0,a.on("blur",function(a){function q(){delete this._.returnFocus,this.hide()}this.allowBlur()&&a.data.getPhase()==CKEDITOR.EVENT_PHASE_AT_TARGET&&this.visible&&!this._.activeChild&&(CKEDITOR.env.iOS?this._.hideTimeout||(this._.hideTimeout=CKEDITOR.tools.setTimeout(q,0,this)):q.call(this))},this),a.on("focus",function(){this._.focused=!0,this.hideChild(),this.allowBlur(!0)},this),CKEDITOR.env.iOS&&(a.on("touchstart",function(){clearTimeout(this._.hideTimeout)},this),a.on("touchend",function(){this._.hideTimeout=0,this.focus()},this)),CKEDITOR.event.useCapture=!1,this._.blurSet=1),j.onEscape=CKEDITOR.tools.bind(function(a){if(this.onEscape&&!1===this.onEscape(a))return!1},this),CKEDITOR.tools.setTimeout(function(){var a=CKEDITOR.tools.bind(function(){if(d.removeStyle("width"),l.autoSize){var a=l.element.getDocument(),a=(CKEDITOR.env.webkit?l.element:a.getBody()).$.scrollWidth;CKEDITOR.env.ie&&CKEDITOR.env.quirks&&a>0&&(a+=(d.$.offsetWidth||0)-(d.$.clientWidth||0)+3),d.setStyle("width",a+10+"px"),a=l.element.$.scrollHeight,CKEDITOR.env.ie&&CKEDITOR.env.quirks&&a>0&&(a+=(d.$.offsetHeight||0)-(d.$.clientHeight||0)+3),d.setStyle("height",a+"px"),j._.currentBlock.element.setStyle("display","none").removeStyle("display")}else d.removeStyle("height");m&&(e-=d.$.offsetWidth),d.setStyle("left",e+"px");var b=j.element.getWindow(),a=d.$.getBoundingClientRect(),b=b.getViewPaneSize(),c=a.width||a.right-a.left,f=a.height||a.bottom-a.top,i=m?a.right:b.width-a.left,g=m?b.width-a.right:a.left;m?i<c&&(e=g>c?e+c:b.width>c?e-a.left:e-a.right+b.width):i<c&&(e=g>c?e-c:b.width>c?e-a.right+b.width:e-a.left),c=a.top,b.height-a.top<f&&(k=c>f?k-f:b.height>f?k-a.bottom+b.height:k-a.top),CKEDITOR.env.ie&&("html"==(b=a=new CKEDITOR.dom.element(d.$.offsetParent)).getName()&&(b=b.getDocument().getBody()),"rtl"==b.getComputedStyle("direction")&&(e=CKEDITOR.env.ie8Compat?e-2*d.getDocument().getDocumentElement().$.scrollLeft:e-(a.$.scrollWidth-a.$.clientWidth)));var n;(n=(a=d.getFirst()).getCustomData("activePanel"))&&n.onHide&&n.onHide.call(this,1),a.setCustomData("activePanel",this),d.setStyles({top:k+"px",left:e+"px"}),d.setOpacity(1),h&&h()},this);j.isLoaded?a():j.onLoad=a,CKEDITOR.tools.setTimeout(function(){var a=CKEDITOR.env.webkit&&CKEDITOR.document.getWindow().getScrollPosition().y;this.focus(),l.element.focus(),CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=a),this.allowBlur(!0),this._.editor.fire("panelShow",this)},0,this)},CKEDITOR.env.air?200:0,this),this.visible=1,this.onShow&&this.onShow.call(this)},focus:function(){if(CKEDITOR.env.webkit){var a=CKEDITOR.document.getActive();a&&!a.equals(this._.iframe)&&a.$.blur()}(this._.lastFocused||this._.iframe.getFrameDocument().getWindow()).focus()},blur:function(){var a=this._.iframe.getFrameDocument().getActive();a&&a.is("a")&&(this._.lastFocused=a)},hide:function(a){!this.visible||this.onHide&&!0===this.onHide.call(this)||(this.hideChild(),CKEDITOR.env.gecko&&this._.iframe.getFrameDocument().$.activeElement.blur(),this.element.setStyle("display","none"),this.visible=0,this.element.getFirst().removeCustomData("activePanel"),(a=a&&this._.returnFocus)&&(CKEDITOR.env.webkit&&a.type&&a.getWindow().$.focus(),a.focus()),delete this._.lastFocused,this._.editor.fire("panelHide",this))},allowBlur:function(a){var b=this._.panel;return void 0!==a&&(b.allowBlur=a),b.allowBlur},showAsChild:function(a,b,c,g,f,h){this._.activeChild==a&&a._.panel._.offsetParentId==c.getId()||(this.hideChild(),a.onHide=CKEDITOR.tools.bind(function(){CKEDITOR.tools.setTimeout(function(){this._.focused||this.hide()},0,this)},this),this._.activeChild=a,this._.focused=!1,a.showBlock(b,c,g,f,h),this.blur(),(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&setTimeout(function(){a.element.getChild(0).$.style.cssText+=""},100))},hideChild:function(a){var b=this._.activeChild;b&&(delete b.onHide,delete this._.activeChild,b.hide(),a&&this.focus())}}}),CKEDITOR.on("instanceDestroyed",function(){var b,a=CKEDITOR.tools.isEmpty(CKEDITOR.instances);for(b in g){var c=g[b];a?c.destroy():c.element.hide()}a&&(g={})})}(),CKEDITOR.plugins.add("menu",{requires:"floatpanel",beforeInit:function(g){for(var h=g.config.menu_groups.split(","),m=g._.menuGroups={},l=g._.menuItems={},a=0;a<h.length;a++)m[h[a]]=a+1;g.addMenuGroup=function(b,a){m[b]=a||100},g.addMenuItem=function(a,c){m[c.group]&&(l[a]=new CKEDITOR.menuItem(this,a,c))},g.addMenuItems=function(a){for(var c in a)this.addMenuItem(c,a[c])},g.getMenuItem=function(a){return l[a]},g.removeMenuItem=function(a){delete l[a]}}}),function(){function g(a){a.sort(function(a,c){return a.group<c.group?-1:a.group>c.group?1:a.order<c.order?-1:a.order>c.order?1:0})}h='<span class="cke_menuitem"><a id="{id}" class="cke_menubutton cke_menubutton__{name} cke_menubutton_{state} {cls}" href="{href}" title="{title}" tabindex="-1"_cke_focus=1 hidefocus="true" role="{role}" aria-haspopup="{hasPopup}" aria-disabled="{disabled}" {ariaChecked}';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(h+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(h+=' onblur="this.style.cssText = this.style.cssText;"');var h=h+' onmouseover="CKEDITOR.tools.callFunction({hoverFn},{index});" onmouseout="CKEDITOR.tools.callFunction({moveOutFn},{index});" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},{index}); return false;">',m=CKEDITOR.addTemplate("menuItem",h+'<span class="cke_menubutton_inner"><span class="cke_menubutton_icon"><span class="cke_button_icon cke_button__{iconName}_icon" style="{iconStyle}"></span></span><span class="cke_menubutton_label">{label}</span>{arrowHtml}</span></a></span>'),l=CKEDITOR.addTemplate("menuArrow",'<span class="cke_menuarrow"><span>{label}</span></span>');CKEDITOR.menu=CKEDITOR.tools.createClass({$:function(a,b){b=this._.definition=b||{},this.id=CKEDITOR.tools.getNextId(),this.editor=a,this.items=[],this._.listeners=[],this._.level=b.level||1;var c=CKEDITOR.tools.extend({},b.panel,{css:[CKEDITOR.skin.getPath("editor")],level:this._.level-1,block:{}}),k=c.block.attributes=c.attributes||{};!k.role&&(k.role="menu"),this._.panelDefinition=c},_:{onShow:function(){var a=this.editor.getSelection(),b=a&&a.getStartElement(),c=this.editor.elementPath(),k=this._.listeners;this.removeAll();for(var e=0;e<k.length;e++){var j=k[e](b,a,c);if(j)for(var i in j){var f=this.editor.getMenuItem(i);!f||f.command&&!this.editor.getCommand(f.command).state||(f.state=j[i],this.add(f))}}},onClick:function(a){this.hide(),a.onClick?a.onClick():a.command&&this.editor.execCommand(a.command)},onEscape:function(a){var b=this.parent;return b?b._.panel.hideChild(1):27==a&&this.hide(1),!1},onHide:function(){this.onHide&&this.onHide()},showSubMenu:function(a){var b=this._.subMenu,c=this.items[a];if(c=c.getItems&&c.getItems()){b?b.removeAll():(b=this._.subMenu=new CKEDITOR.menu(this.editor,CKEDITOR.tools.extend({},this._.definition,{level:this._.level+1},!0)),b.parent=this,b._.onClick=CKEDITOR.tools.bind(this._.onClick,this));for(var k in c){var e=this.editor.getMenuItem(k);e&&(e.state=c[k],b.add(e))}var j=this._.panel.getBlock(this.id).element.getDocument().getById(this.id+""+a);setTimeout(function(){b.show(j,2)},0)}else this._.panel.hideChild(1)}},proto:{add:function(a){a.order||(a.order=this.items.length),this.items.push(a)},removeAll:function(){this.items=[]},show:function(a,b,c,k){if(this.parent||(this._.onShow(),this.items.length)){var b=b||("rtl"==this.editor.lang.dir?2:1),e=this.items,j=this.editor,i=this._.panel,f=this._.element;i||((i=this._.panel=new CKEDITOR.ui.floatPanel(this.editor,CKEDITOR.document.getBody(),this._.panelDefinition,this._.level)).onEscape=CKEDITOR.tools.bind(function(a){if(!1===this._.onEscape(a))return!1},this),i.onShow=function(){i._.panel.getHolderElement().getParent().addClass("cke cke_reset_all")},i.onHide=CKEDITOR.tools.bind(function(){this._.onHide&&this._.onHide()},this),(f=i.addBlock(this.id,this._.panelDefinition.block)).autoSize=!0,(d=f.keys)[40]="next",d[9]="next",d[38]="prev",d[CKEDITOR.SHIFT+9]="prev",d["rtl"==j.lang.dir?37:39]=CKEDITOR.env.ie?"mouseup":"click",d[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(d[13]="mouseup"),(d=(f=this._.element=f.element).getDocument()).getBody().setStyle("overflow","hidden"),d.getElementsByTag("html").getItem(0).setStyle("overflow","hidden"),this._.itemOverFn=CKEDITOR.tools.addFunction(function(a){clearTimeout(this._.showSubTimeout),this._.showSubTimeout=CKEDITOR.tools.setTimeout(this._.showSubMenu,j.config.menu_subMenuDelay||400,this,[a])},this),this._.itemOutFn=CKEDITOR.tools.addFunction(function(){clearTimeout(this._.showSubTimeout)},this),this._.itemClickFn=CKEDITOR.tools.addFunction(function(a){var b=this.items[a];b.state==CKEDITOR.TRISTATE_DISABLED?this.hide(1):b.getItems?this._.showSubMenu(a):this._.onClick(b)},this)),g(e);for(var d=['<div class="cke_menu'+((d=j.elementPath())&&d.direction()!=j.lang.dir?" cke_mixed_dir_content":"")+'" role="presentation">'],h=e.length,m=h&&e[0].group,l=0;l<h;l++){var n=e[l];m!=n.group&&(d.push('<div class="cke_menuseparator" role="separator"></div>'),m=n.group),n.render(this,l,d)}d.push("</div>"),f.setHtml(d.join("")),CKEDITOR.ui.fire("ready",this),this.parent?this.parent._.panel.showAsChild(i,this.id,a,b,c,k):i.showBlock(this.id,a,b,c,k),j.fire("menuShow",[i])}},addListener:function(a){this._.listeners.push(a)},hide:function(a){this._.onHide&&this._.onHide(),this._.panel&&this._.panel.hide(a)}}}),CKEDITOR.menuItem=CKEDITOR.tools.createClass({$:function(a,b,c){CKEDITOR.tools.extend(this,c,{order:0,className:"cke_menubutton__"+b}),this.group=a._.menuGroups[this.group],this.editor=a,this.name=b},proto:{render:function(a,b,c){var h=a.id+""+b,e=void 0===this.state?CKEDITOR.TRISTATE_OFF:this.state,j="",i=e==CKEDITOR.TRISTATE_ON?"on":e==CKEDITOR.TRISTATE_DISABLED?"disabled":"off";this.role in{menuitemcheckbox:1,menuitemradio:1}&&(j=' aria-checked="'+(e==CKEDITOR.TRISTATE_ON?"true":"false")+'"');var f=this.getItems,d="&#"+("rtl"==this.editor.lang.dir?"9668":"9658")+";",g=this.name;this.icon&&!/\./.test(this.icon)&&(g=this.icon),a={id:h,name:this.name,iconName:g,label:this.label,cls:this.className||"",state:i,hasPopup:f?"true":"false",disabled:e==CKEDITOR.TRISTATE_DISABLED,title:this.label,href:"javascript:void('"+(this.label||"").replace("'")+"')",hoverFn:a._.itemOverFn,moveOutFn:a._.itemOutFn,clickFn:a._.itemClickFn,index:b,iconStyle:CKEDITOR.skin.getIconStyle(g,"rtl"==this.editor.lang.dir,g==this.icon?null:this.icon,this.iconOffset),arrowHtml:f?l.output({label:d}):"",role:this.role?this.role:"menuitem",ariaChecked:j},m.output(a,c)}}})}(),CKEDITOR.config.menu_groups="clipboard,form,tablecell,tablecellproperties,tablerow,tablecolumn,table,anchor,link,image,flash,checkbox,radio,textfield,hiddenfield,imagebutton,button,select,textarea,div",CKEDITOR.plugins.add("contextmenu",{requires:"menu",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(a){this.base.call(this,a,{panel:{className:"cke_menu_panel",attributes:{"aria-label":a.lang.contextmenu.options}}})},proto:{addTarget:function(a,e){if(a.on("contextmenu",function(a){var a=a.data,c=CKEDITOR.env.webkit?f:CKEDITOR.env.mac?a.$.metaKey:a.$.ctrlKey;if(!e||!c){if(a.preventDefault(),CKEDITOR.env.mac&&CKEDITOR.env.webkit){c=this.editor;(b=new CKEDITOR.dom.elementPath(a.getTarget(),c.editable()).contains(function(a){return a.hasAttribute("contenteditable")},!0))&&"false"==b.getAttribute("contenteditable")&&c.getSelection().fake(b)}var b=a.getTarget().getDocument(),d=a.getTarget().getDocument().getDocumentElement(),c=!b.equals(CKEDITOR.document),b=b.getWindow().getScrollPosition(),g=c?a.$.clientX:a.$.pageX||b.x+a.$.clientX,h=c?a.$.clientY:a.$.pageY||b.y+a.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(d,null,g,h)},CKEDITOR.env.ie?200:0,this)}},this),CKEDITOR.env.webkit){var f,d=function(){f=0};a.on("keydown",function(a){f=CKEDITOR.env.mac?a.data.$.metaKey:a.data.$.ctrlKey}),a.on("keyup",d),a.on("contextmenu",d)}},open:function(a,e,f,d){this.editor.focus(),a=a||CKEDITOR.document.getDocumentElement(),this.editor.selectionChange(1),this.show(a,e,f,d)}}})},beforeInit:function(a){var e=a.contextMenu=new CKEDITOR.plugins.contextMenu(a);a.on("contentDom",function(){e.addTarget(a.editable(),!1!==a.config.browserContextMenuOnCtrl)}),a.addCommand("contextMenu",{exec:function(){a.contextMenu.open(a.document.getBody())}}),a.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu"),a.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}}),CKEDITOR.plugins.add("dialogui",{onLoad:function(){var h=function(b){this._||(this._={}),this._.default=this._.initValue=b.default||"",this._.required=b.required||!1;for(var a=[this._],d=1;d<arguments.length;d++)a.push(arguments[d]);return a.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,a),this._},r={build:function(b,a,d){return new CKEDITOR.ui.dialog.textInput(b,a,d)}},l={build:function(b,a,d){return new CKEDITOR.ui.dialog[a.type](b,a,d)}},n={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(b){this.setValue(this.getInitValue(),b)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._.default},getInitValue:function(){return this._.initValue}},o=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(b,a){this._.domOnChangeRegistered||(b.on("load",function(){this.getInputElement().on("change",function(){b.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",a)}},!0),s=/^on([A-Z]\w+)/,p=function(b){for(var a in b)(s.test(a)||"title"==a||"type"==a)&&delete b[a];return b};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(b,a,d,f){if(!(4>arguments.length)){var c=h.call(this,a);c.labelId=CKEDITOR.tools.getNextId()+"_label",this._.children=[];var e={role:a.role||"presentation"};a.includeLabel&&(e["aria-labelledby"]=c.labelId),CKEDITOR.ui.dialog.uiElement.call(this,b,a,d,"div",null,e,function(){var e=[],g=a.required?" cke_required":"";return"horizontal"!=a.labelLayout?e.push('<label class="cke_dialog_ui_labeled_label'+g+'" ',' id="'+c.labelId+'"',c.inputId?' for="'+c.inputId+'"':"",(a.labelStyle?' style="'+a.labelStyle+'"':"")+">",a.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',a.controlStyle?' style="'+a.controlStyle+'"':"",' role="presentation">',f.call(this,b,a),"</div>"):(g={type:"hbox",widths:a.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+g+'" id="'+c.labelId+'" for="'+c.inputId+'"'+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(a.label)+"</span>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(a.controlStyle?' style="'+a.controlStyle+'"':"")+">"+f.call(this,b,a)+"</span>"}]},CKEDITOR.dialog._.uiElementBuilders.hbox.build(b,g,e)),e.join("")})}},textInput:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",c={class:"cke_dialog_ui_input_"+a.type,id:f,type:a.type};a.validate&&(this.validate=a.validate),a.maxLength&&(c.maxlength=a.maxLength),a.size&&(c.size=a.size),a.inputStyle&&(c.style=a.inputStyle);var e=this,k=!1;b.on("load",function(){e.getInputElement().on("keydown",function(a){13==a.data.getKeystroke()&&(k=!0)}),e.getInputElement().on("keyup",function(a){13==a.data.getKeystroke()&&k&&(b.getButton("ok")&&setTimeout(function(){b.getButton("ok").click()},0),k=!1)},null,null,1e3)}),CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){var b=['<div class="cke_dialog_ui_input_',a.type,'" role="presentation"'];a.width&&b.push('style="width:'+a.width+'" '),b.push("><input "),c["aria-labelledby"]=this._.labelId,this._.required&&(c["aria-required"]=this._.required);for(var e in c)b.push(e+'="'+c[e]+'" ');return b.push(" /></div>"),b.join("")})}},textarea:function(b,a,d){if(!(3>arguments.length)){h.call(this,a);var f=this,c=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",e={};a.validate&&(this.validate=a.validate),e.rows=a.rows||5,e.cols=a.cols||20,e.class="cke_dialog_ui_input_textarea "+(a.class||""),void 0!==a.inputStyle&&(e.style=a.inputStyle),a.dir&&(e.dir=a.dir),CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){e["aria-labelledby"]=this._.labelId,this._.required&&(e["aria-required"]=this._.required);var b,a=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',c,'" '];for(b in e)a.push(b+'="'+CKEDITOR.tools.htmlEncode(e[b])+'" ');return a.push(">",CKEDITOR.tools.htmlEncode(f._.default),"</textarea></div>"),a.join("")})}},checkbox:function(b,a,d){if(!(3>arguments.length)){var f=h.call(this,a,{default:!!a.default});a.validate&&(this.validate=a.validate),CKEDITOR.ui.dialog.uiElement.call(this,b,a,d,"span",null,null,function(){var c=CKEDITOR.tools.extend({},a,{id:a.id?a.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),e=[],d=CKEDITOR.tools.getNextId()+"_label",g={class:"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":d};return p(c),a.default&&(g.checked="checked"),void 0!==c.inputStyle&&(c.style=c.inputStyle),f.checkbox=new CKEDITOR.ui.dialog.uiElement(b,c,e,"input",null,g),e.push(' <label id="',d,'" for="',g.id,'"'+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(a.label),"</label>"),e.join("")})}},radio:function(b,a,d){if(!(3>arguments.length)){h.call(this,a),this._.default||(this._.default=this._.initValue=a.items[0][1]),a.validate&&(this.validate=a.valdiate);var f=[],c=this;a.role="radiogroup",a.includeLabel=!0,CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){for(var e=[],d=[],g=(a.id?a.id:CKEDITOR.tools.getNextId())+"_radio",i=0;i<a.items.length;i++){var j=a.items[i],h=void 0!==j[2]?j[2]:j[0],l=void 0!==j[1]?j[1]:j[0],n=(m=CKEDITOR.tools.getNextId()+"_radio_input")+"_label",m=CKEDITOR.tools.extend({},a,{id:m,title:null,type:null},!0),h=CKEDITOR.tools.extend({},m,{title:h},!0),o={type:"radio",class:"cke_dialog_ui_radio_input",name:g,value:l,"aria-labelledby":n},q=[];c._.default==l&&(o.checked="checked"),p(m),p(h),void 0!==m.inputStyle&&(m.style=m.inputStyle),m.keyboardFocusable=!0,f.push(new CKEDITOR.ui.dialog.uiElement(b,m,q,"input",null,o)),q.push(" "),new CKEDITOR.ui.dialog.uiElement(b,h,q,"label",null,{id:n,for:o.id},j[0]),e.push(q.join(""))}return new CKEDITOR.ui.dialog.hbox(b,f,e,d),d.join("")}),this._.children=f}},button:function(b,a,d){if(arguments.length){"function"==typeof a&&(a=a(b.getParentEditor())),h.call(this,a,{disabled:a.disabled||!1}),CKEDITOR.event.implementOn(this);var f=this;b.on("load",function(){var a=this.getElement();a.on("click",function(a){f.click(),a.data.preventDefault()}),a.on("keydown",function(a){a.data.getKeystroke()in{32:1}&&(f.click(),a.data.preventDefault())}),a.unselectable()},this);var c=CKEDITOR.tools.extend({},a);delete c.style;var e=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,b,c,d,"a",null,{style:a.style,href:"javascript:void(0)",title:a.label,hidefocus:"true",class:a.class,role:"button","aria-labelledby":e},'<span id="'+e+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(a.label)+"</span>")}},select:function(b,a,d){if(!(3>arguments.length)){var f=h.call(this,a);a.validate&&(this.validate=a.validate),f.inputId=CKEDITOR.tools.getNextId()+"_select",CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){var c=CKEDITOR.tools.extend({},a,{id:a.id?a.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),e=[],d=[],g={id:f.inputId,class:"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};e.push('<div class="cke_dialog_ui_input_',a.type,'" role="presentation"'),a.width&&e.push('style="width:'+a.width+'" '),e.push(">"),void 0!==a.size&&(g.size=a.size),void 0!==a.multiple&&(g.multiple=a.multiple),p(c);for(var j,i=0;i<a.items.length&&(j=a.items[i]);i++)d.push('<option value="',CKEDITOR.tools.htmlEncode(void 0!==j[1]?j[1]:j[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(j[0]));return void 0!==c.inputStyle&&(c.style=c.inputStyle),f.select=new CKEDITOR.ui.dialog.uiElement(b,c,e,"select",null,g,d.join("")),e.push("</div>"),e.join("")})}},file:function(b,a,d){if(!(3>arguments.length)){void 0===a.default&&(a.default="");var f=CKEDITOR.tools.extend(h.call(this,a),{definition:a,buttons:[]});a.validate&&(this.validate=a.validate),b.on("load",function(){CKEDITOR.document.getById(f.frameId).getParent().addClass("cke_dialog_ui_input_file")}),CKEDITOR.ui.dialog.labeledElement.call(this,b,a,d,function(){f.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var b=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',f.frameId,'" title="',a.label,'" src="javascript:void('];return b.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0"),b.push(')"></iframe>'),b.join("")})}},fileButton:function(b,a,d){var f=this;if(!(3>arguments.length)){h.call(this,a),a.validate&&(this.validate=a.validate);var c=CKEDITOR.tools.extend({},a),e=c.onClick;c.className=(c.className?c.className+" ":"")+"cke_dialog_ui_button",c.onClick=function(c){var d=a.for;e&&!1===e.call(this,c)||(b.getContentElement(d[0],d[1]).submit(),this.disable())},b.on("load",function(){b.getContentElement(a.for[0],a.for[1])._.buttons.push(f)}),CKEDITOR.ui.dialog.button.call(this,b,c,d)}},html:function(){var b=/^\s*<[\w:]+\s+([^>]*)?>/,a=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,d=/\/$/;return function(f,c,e){if(!(3>arguments.length)){var k=[],g=c.html;"<"!=g.charAt(0)&&(g="<span>"+g+"</span>");var i=c.focus;if(i){var j=this.focus;this.focus=function(){("function"==typeof i?i:j).call(this),this.fire("focus")},c.isFocusable&&(this.isFocusable=this.isFocusable),this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,f,c,k,"span",null,null,""),k=k.join("").match(b),g=g.match(a)||["","",""],d.test(g[1])&&(g[1]=g[1].slice(0,-1),g[2]="/"+g[2]),e.push([g[1]," ",k[1]||"",g[2]].join(""))}}}(),fieldset:function(b,a,d,f,c){var e=c.label;this._={children:a},CKEDITOR.ui.dialog.uiElement.call(this,b,c,f,"fieldset",null,null,function(){var a=[];e&&a.push("<legend"+(c.labelStyle?' style="'+c.labelStyle+'"':"")+">"+e+"</legend>");for(var b=0;b<d.length;b++)a.push(d[b]);return a.join("")})}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(b){var a=CKEDITOR.document.getById(this._.labelId);return 1>a.getChildCount()?new CKEDITOR.dom.text(b,CKEDITOR.document).appendTo(a):a.getChild(0).$.nodeValue=b,this},getLabel:function(){var b=CKEDITOR.document.getById(this._.labelId);return!b||1>b.getChildCount()?"":b.getChild(0).getText()},eventProcessors:o},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return!this._.disabled&&this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var b=this.getElement();b&&b.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(b,a){this.on("click",function(){a.apply(this,arguments)})}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var b=this.selectParentTab();setTimeout(function(){var a=b.getInputElement();a&&a.$.focus()},0)},select:function(){var b=this.selectParentTab();setTimeout(function(){var a=b.getInputElement();a&&(a.$.focus(),a.$.select())},0)},accessKeyUp:function(){this.select()},setValue:function(b){return!b&&(b=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(b,a,d){var f=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),c=this.getInputElement().$;return f.$.text=b,f.$.value=void 0===a||null===a?b:a,void 0===d||null===d?CKEDITOR.env.ie?c.add(f.$):c.add(f.$,null):c.add(f.$,d),this},remove:function(b){return this.getInputElement().$.remove(b),this},clear:function(){for(var b=this.getInputElement().$;0<b.length;)b.remove(0);return this},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(b,a){this.getInputElement().$.checked=b,!a&&this.fire("change",{value:b})},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(b,a){return!CKEDITOR.env.ie||8<CKEDITOR.env.version?o.onChange.apply(this,arguments):(b.on("load",function(){var a=this._.checkbox.getElement();a.on("propertychange",function(b){"checked"==(b=b.data.$).propertyName&&this.fire("change",{value:a.$.checked})},this)},this),this.on("change",a),null)}},keyboardFocusable:!0},n,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setValue:function(b,a){for(var f,d=this._.children,c=0;c<d.length&&(f=d[c]);c++)f.getElement().$.checked=f.getValue()==b;!a&&this.fire("change",{value:b})},getValue:function(){for(var b=this._.children,a=0;a<b.length;a++)if(b[a].getElement().$.checked)return b[a].getValue();return null},accessKeyUp:function(){var a,b=this._.children;for(a=0;a<b.length;a++)if(b[a].getElement().$.checked)return void b[a].getElement().focus();b[0].getElement().focus()},eventProcessors:{onChange:function(b,a){return CKEDITOR.env.ie?(b.on("load",function(){for(var a=this._.children,b=this,c=0;c<a.length;c++)a[c].getElement().on("propertychange",function(a){"checked"==(a=a.data.$).propertyName&&this.$.checked&&b.fire("change",{value:this.getAttribute("value")})})},this),this.on("change",a),null):o.onChange.apply(this,arguments)}}},n,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,n,{getInputElement:function(){var b=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return 0<b.$.forms.length?new CKEDITOR.dom.element(b.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(b){var d,c,a=/^on([A-Z]\w+)/;for(c in b)(d=c.match(a))&&(this.eventProcessors[c]?this.eventProcessors[c].call(this,this._.dialog,b[c]):function(a,b,c,d){a.on("formLoaded",function(){a.getInputElement().on(c,d,a)})}(this,this._.dialog,d[1].toLowerCase(),b[c]));return this},reset:function(){function b(){d.$.open();var b="";f.size&&(b=f.size-(CKEDITOR.env.ie?7:0));var h=a.frameId+"_input";for(d.$.write(['<html dir="'+g+'" lang="'+i+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+g+'" lang="'+i+'" action="',CKEDITOR.tools.htmlEncode(f.action),'"><label id="',a.labelId,'" for="',h,'" style="display:none">',CKEDITOR.tools.htmlEncode(f.label),'</label><input style="width:100%" id="',h,'" aria-labelledby="',a.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(f.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(0<b?b:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+e+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+k+")}","<\/script>"].join("")),d.$.close(),b=0;b<c.length;b++)c[b].enable()}var a=this._,d=CKEDITOR.document.getById(a.frameId).getFrameDocument(),f=a.definition,c=a.buttons,e=this.formLoadedNumber,k=this.formUnloadNumber,g=a.dialog._.editor.lang.dir,i=a.dialog._.editor.langCode;e||(e=this.formLoadedNumber=CKEDITOR.tools.addFunction(function(){this.fire("formLoaded")},this),k=this.formUnloadNumber=CKEDITOR.tools.addFunction(function(){this.getInputElement().clearCustomData()},this),this.getDialog()._.editor.on("destroy",function(){CKEDITOR.tools.removeFunction(e),CKEDITOR.tools.removeFunction(k)})),CKEDITOR.env.gecko?setTimeout(b,500):b()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(b,a){this._.domOnChangeRegistered||(this.on("formLoaded",function(){this.getInputElement().on("change",function(){this.fire("change",{value:this.getValue()})},this)},this),this._.domOnChangeRegistered=!0),this.on("change",a)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",r),CKEDITOR.dialog.addUIElement("password",r),CKEDITOR.dialog.addUIElement("textarea",l),CKEDITOR.dialog.addUIElement("checkbox",l),CKEDITOR.dialog.addUIElement("radio",l),CKEDITOR.dialog.addUIElement("button",l),CKEDITOR.dialog.addUIElement("select",l),CKEDITOR.dialog.addUIElement("file",l),CKEDITOR.dialog.addUIElement("fileButton",l),CKEDITOR.dialog.addUIElement("html",l),CKEDITOR.dialog.addUIElement("fieldset",{build:function(b,a,d){for(var c,f=a.children,e=[],h=[],g=0;g<f.length&&(c=f[g]);g++){var i=[];e.push(i),h.push(CKEDITOR.dialog._.uiElementBuilders[c.type].build(b,c,i))}return new CKEDITOR.ui.dialog[a.type](b,h,e,d,a)}})}}),CKEDITOR.DIALOG_RESIZE_NONE=0,CKEDITOR.DIALOG_RESIZE_WIDTH=1,CKEDITOR.DIALOG_RESIZE_HEIGHT=2,CKEDITOR.DIALOG_RESIZE_BOTH=3,function(){function t(){for(var a=this._.tabIdList.length,b=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+a,c=b-1;c>b-a;c--)if(this._.tabs[this._.tabIdList[c%a]][0].$.offsetHeight)return this._.tabIdList[c%a];return null}function u(){for(var a=this._.tabIdList.length,b=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),c=b+1;c<b+a;c++)if(this._.tabs[this._.tabIdList[c%a]][0].$.offsetHeight)return this._.tabIdList[c%a];return null}function G(a,b){for(var c=a.$.getElementsByTagName("input"),e=0,d=c.length;e<d;e++){var g=new CKEDITOR.dom.element(c[e]);"text"==g.getAttribute("type").toLowerCase()&&(b?(g.setAttribute("value",g.getCustomData("fake_value")||""),g.removeCustomData("fake_value")):(g.setCustomData("fake_value",g.getAttribute("value")),g.setAttribute("value","")))}}function P(a,b){var c=this.getInputElement();c&&(a?c.removeAttribute("aria-invalid"):c.setAttribute("aria-invalid",!0)),a||(this.select?this.select():this.focus()),b&&alert(b),this.fire("validated",{valid:a,msg:b})}function Q(){var a=this.getInputElement();a&&a.removeAttribute("aria-invalid")}function R(a){var b=(a=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",S).output({id:CKEDITOR.tools.getNextNumber(),editorId:a.id,langDir:a.lang.dir,langCode:a.langCode,editorDialogClass:"cke_editor_"+a.name.replace(/\./g,"\\.")+"_dialog",closeTitle:a.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""}))).getChild([0,0,0,0,0]),c=b.getChild(0),e=b.getChild(1);if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var d="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())";CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+d+'" tabIndex="-1"></iframe>').appendTo(b.getParent())}return c.unselectable(),e.unselectable(),{element:a,parts:{dialog:a.getChild(0),title:c,close:e,tabs:b.getChild(2),contents:b.getChild([3,0,0,0]),footer:b.getChild([3,0,1,0])}}}function H(a,b,c){this.element=b,this.focusIndex=c,this.tabIndex=0,this.isFocusable=function(){return!b.getAttribute("disabled")&&b.isVisible()},this.focus=function(){a._.currentFocusIndex=this.focusIndex,this.element.focus()},b.on("keydown",function(a){a.data.getKeystroke()in{32:1,13:1}&&this.fire("click")}),b.on("focus",function(){this.fire("mouseover")}),b.on("blur",function(){this.fire("mouseout")})}function T(a){function b(){a.layout()}var c=CKEDITOR.document.getWindow();c.on("resize",b),a.on("hide",function(){c.removeListener("resize",b)})}function I(a,b){this._={dialog:a},CKEDITOR.tools.extend(this,b)}function U(a){function b(b){var c=a.getSize(),i=CKEDITOR.document.getWindow().getViewPaneSize(),o=b.data.$.screenX,j=b.data.$.screenY,n=o-e.x,l=j-e.y;e={x:o,y:j},d.x+=n,d.y+=l,a.move(d.x+h[3]<f?-h[3]:d.x-h[1]>i.width-c.width-f?i.width-c.width+("rtl"==g.lang.dir?0:h[1]):d.x,d.y+h[0]<f?-h[0]:d.y-h[2]>i.height-c.height-f?i.height-c.height+h[2]:d.y,1),b.data.preventDefault()}function c(){if(CKEDITOR.document.removeListener("mousemove",b),CKEDITOR.document.removeListener("mouseup",c),CKEDITOR.env.ie6Compat){var a=q.getChild(0).getFrameDocument();a.removeListener("mousemove",b),a.removeListener("mouseup",c)}}var e=null,d=null,g=a.getParentEditor(),f=g.config.dialog_magnetDistance,h=CKEDITOR.skin.margins||[0,0,0,0];void 0===f&&(f=20),a.parts.title.on("mousedown",function(f){if(e={x:f.data.$.screenX,y:f.data.$.screenY},CKEDITOR.document.on("mousemove",b),CKEDITOR.document.on("mouseup",c),d=a.getPosition(),CKEDITOR.env.ie6Compat){var h=q.getChild(0).getFrameDocument();h.on("mousemove",b),h.on("mouseup",c)}f.data.preventDefault()},a)}function V(a){function e(d){var e="rtl"==h.lang.dir,j=o.width,C=o.height,D=j+(d.data.$.screenX-b)*(e?-1:1)*(a._.moved?1:2),n=C+(d.data.$.screenY-c)*(a._.moved?1:2),x=a._.element.getFirst(),x=e&&x.getComputedStyle("right"),y=a.getPosition();y.y+n>i.height&&(n=i.height-y.y),(e?x:y.x)+D>i.width&&(D=i.width-(e?x:y.x)),f!=CKEDITOR.DIALOG_RESIZE_WIDTH&&f!=CKEDITOR.DIALOG_RESIZE_BOTH||(j=Math.max(g.minWidth||0,D-m)),f!=CKEDITOR.DIALOG_RESIZE_HEIGHT&&f!=CKEDITOR.DIALOG_RESIZE_BOTH||(C=Math.max(g.minHeight||0,n-k)),a.resize(j,C),a._.moved||a.layout(),d.data.preventDefault()}function d(){if(CKEDITOR.document.removeListener("mouseup",d),CKEDITOR.document.removeListener("mousemove",e),j&&(j.remove(),j=null),CKEDITOR.env.ie6Compat){var a=q.getChild(0).getFrameDocument();a.removeListener("mouseup",d),a.removeListener("mousemove",e)}}var b,c,g=a.definition,f=g.resizable;if(f!=CKEDITOR.DIALOG_RESIZE_NONE){var m,k,i,o,j,h=a.getParentEditor(),n=CKEDITOR.tools.addFunction(function(f){o=a.getSize();var h=a.parts.contents;h.$.getElementsByTagName("iframe").length&&(j=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%;"></div>'),h.append(j)),k=o.height-a.parts.contents.getSize("height",!(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.quirks)),m=o.width-a.parts.contents.getSize("width",1),b=f.screenX,c=f.screenY,i=CKEDITOR.document.getWindow().getViewPaneSize(),CKEDITOR.document.on("mousemove",e),CKEDITOR.document.on("mouseup",d),CKEDITOR.env.ie6Compat&&((h=q.getChild(0).getFrameDocument()).on("mousemove",e),h.on("mouseup",d)),f.preventDefault&&f.preventDefault()});a.on("load",function(){var b="";f==CKEDITOR.DIALOG_RESIZE_WIDTH?b=" cke_resizer_horizontal":f==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(b=" cke_resizer_vertical"),b=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+b+" cke_resizer_"+h.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(h.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+n+', event )">'+("ltr"==h.lang.dir?"":"")+"</div>"),a.parts.footer.append(b,1)}),h.on("destroy",function(){CKEDITOR.tools.removeFunction(n)})}}function E(a){a.data.preventDefault(1)}function J(a){var b=CKEDITOR.document.getWindow(),e=(c=a.config).dialog_backgroundCoverColor||"white",d=c.dialog_backgroundCoverOpacity,g=c.baseFloatZIndex,c=CKEDITOR.tools.genKey(e,d,g),f=w[c];f?f.show():(g=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?"absolute":"fixed","; z-index: ",g,"; top: 0px; left: 0px; ",CKEDITOR.env.ie6Compat?"":"background-color: "+e,'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(e="<html><body style=\\'background-color:"+e+";\\'></body></html>",g.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),g.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+e+"' );document.close();")+"})())"),g.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),g.push("</div>"),(f=CKEDITOR.dom.element.createFromHtml(g.join(""))).setOpacity(void 0!==d?d:.5),f.on("keydown",E),f.on("keypress",E),f.on("keyup",E),f.appendTo(CKEDITOR.document.getBody()),w[c]=f),a.focusManager.add(f),q=f;var h=function(){var a=b.getScrollPosition(),c=CKEDITOR.dialog._.currentTop;if(f.setStyles({left:a.x+"px",top:a.y+"px"}),c)do{a=c.getPosition(),c.move(a.x,a.y)}while(c=c._.parentDialog)};if(F=a=function(){var a=b.getViewPaneSize();f.setStyles({width:a.width+"px",height:a.height+"px"})},b.on("resize",a),a(),(!CKEDITOR.env.mac||!CKEDITOR.env.webkit)&&f.focus(),CKEDITOR.env.ie6Compat){var m=function(){h(),arguments.callee.prevScrollHandler.apply(this,arguments)};b.$.setTimeout(function(){m.prevScrollHandler=window.onscroll||function(){},window.onscroll=m},0),h()}}function K(a){q&&(a.focusManager.remove(q),a=CKEDITOR.document.getWindow(),q.hide(),a.removeListener("resize",F),CKEDITOR.env.ie6Compat&&a.$.setTimeout(function(){window.onscroll=window.onscroll&&window.onscroll.prevScrollHandler||null},0),F=null)}var r=CKEDITOR.tools.cssLength,S='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="position:absolute" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';CKEDITOR.dialog=function(a,b){function c(){var a=l._.focusList;a.sort(function(a,b){return a.tabIndex!=b.tabIndex?b.tabIndex-a.tabIndex:a.focusIndex-b.focusIndex});for(var b=a.length,c=0;c<b;c++)a[c].focusIndex=c}function e(a){var b=l._.focusList,a=a||0;if(!(1>b.length)){var c=l._.currentFocusIndex;try{b[c].getInputElement().$.blur()}catch(f){}for(var d=c=(c+a+b.length)%b.length;a&&!b[d].isFocusable()&&(d=(d+a+b.length)%b.length)!=c;);b[d].focus(),"text"==b[d].type&&b[d].select()}}function d(b){if(l==CKEDITOR.dialog._.currentTop){var c=b.data.getKeystroke(),d="rtl"==a.lang.dir;if(o=j=0,9==c||c==CKEDITOR.SHIFT+9)c=c==CKEDITOR.SHIFT+9,l._.tabBarMode?(c=c?t.call(l):u.call(l),l.selectPage(c),l._.tabs[c][0].focus()):e(c?-1:1),o=1;else if(c==CKEDITOR.ALT+121&&!l._.tabBarMode&&1<l.getPageCount())l._.tabBarMode=!0,l._.tabs[l._.currentTabId][0].focus(),o=1;else if(37!=c&&39!=c||!l._.tabBarMode)if(13!=c&&32!=c||!l._.tabBarMode)if(13==c)(c=b.data.getTarget()).is("a","button","select","textarea")||c.is("input")&&"button"==c.$.type||((c=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(c.click,0,c),o=1),j=1;else{if(27!=c)return;(c=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(c.click,0,c):!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),j=1}else this.selectPage(this._.currentTabId),this._.tabBarMode=!1,this._.currentFocusIndex=-1,e(1),o=1;else c=c==(d?39:37)?t.call(l):u.call(l),l.selectPage(c),l._.tabs[c][0].focus(),o=1;g(b)}}function g(a){o?a.data.preventDefault(1):j&&a.data.stopPropagation()}var o,j,f=CKEDITOR.dialog._.dialogDefinitions[b],h=CKEDITOR.tools.clone(W),m=a.config.dialog_buttonsOrder||"OS",k=a.lang.dir,i={};if(("OS"==m&&CKEDITOR.env.mac||"rtl"==m&&"ltr"==k||"ltr"==m&&"rtl"==k)&&h.buttons.reverse(),f=CKEDITOR.tools.extend(f(a),h),f=CKEDITOR.tools.clone(f),f=new L(this,f),h=R(a),this._={editor:a,element:h.element,name:b,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],currentFocusIndex:0,hasFocus:!1},this.parts=h.parts,CKEDITOR.tools.setTimeout(function(){a.fire("ariaWidget",this.parts.contents)},0,this),h={position:CKEDITOR.env.ie6Compat?"absolute":"fixed",top:0,visibility:"hidden"},h["rtl"==k?"right":"left"]=0,this.parts.dialog.setStyles(h),CKEDITOR.event.call(this),this.definition=f=CKEDITOR.fire("dialogDefinition",{name:b,definition:f},a).definition,!("removeDialogTabs"in a._)&&a.config.removeDialogTabs){for(h=a.config.removeDialogTabs.split(";"),k=0;k<h.length;k++)if(2==(m=h[k].split(":")).length){var n=m[0];i[n]||(i[n]=[]),i[n].push(m[1])}a._.removeDialogTabs=i}if(a._.removeDialogTabs&&(i=a._.removeDialogTabs[b]))for(k=0;k<i.length;k++)f.removeContents(i[k]);f.onLoad&&this.on("load",f.onLoad),f.onShow&&this.on("show",f.onShow),f.onHide&&this.on("hide",f.onHide),f.onOk&&this.on("ok",function(b){a.fire("saveSnapshot"),setTimeout(function(){a.fire("saveSnapshot")},0),!1===f.onOk.call(this,b)&&(b.data.hide=!1)}),f.onCancel&&this.on("cancel",function(a){!1===f.onCancel.call(this,a)&&(a.data.hide=!1)});var l=this,p=function(a){var d,b=l._.contents;for(d in b)for(var f in b[d])if(a.call(this,b[d][f]))return};this.on("ok",function(a){p(function(b){if(b.validate){var c=b.validate(this),d="string"==typeof c||!1===c;return d&&(a.data.hide=!1,a.stop()),P.call(b,!d,"string"==typeof c?c:void 0),d}})},this,null,0),this.on("cancel",function(b){p(function(c){if(c.isChanged())return!a.config.dialog_noConfirmCancel&&!confirm(a.lang.common.confirmCancel)&&(b.data.hide=!1),!0})},this,null,0),this.parts.close.on("click",function(a){!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),a.data.preventDefault()},this),this.changeFocus=e;var v=this._.element;for(a.focusManager.add(v,1),this.on("show",function(){v.on("keydown",d,this),CKEDITOR.env.gecko&&v.on("keypress",g,this)}),this.on("hide",function(){v.removeListener("keydown",d),CKEDITOR.env.gecko&&v.removeListener("keypress",g),p(function(a){Q.apply(a)})}),this.on("iframeAdded",function(a){new CKEDITOR.dom.document(a.data.iframe.$.contentWindow.document).on("keydown",d,this,null,0)}),this.on("show",function(){if(c(),a.config.dialog_startupFocusTab&&1<l._.pageCount)l._.tabBarMode=!0,l._.tabs[l._.currentTabId][0].focus();else if(!this._.hasFocus)if(this._.currentFocusIndex=-1,f.onFocus){var b=f.onFocus.call(this);b&&b.focus()}else e(1)},this,null,4294967295),CKEDITOR.env.ie6Compat&&this.on("load",function(){var a=this.getElement(),b=a.getFirst();b.remove(),b.appendTo(a)},this),U(this),V(this),new CKEDITOR.dom.text(f.title,CKEDITOR.document).appendTo(this.parts.title),k=0;k<f.contents.length;k++)(i=f.contents[k])&&this.addPage(i);for(this.parts.tabs.on("click",function(a){var b=a.data.getTarget();b.hasClass("cke_dialog_tab")&&(b=b.$.id,this.selectPage(b.substring(4,b.lastIndexOf("_"))),this._.tabBarMode&&(this._.tabBarMode=!1,this._.currentFocusIndex=-1,e(1)),a.data.preventDefault())},this),k=[],i=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:f.buttons},k).getChild(),this.parts.footer.setHtml(k.join("")),k=0;k<i.length;k++)this._.buttons[i[k].id]=i[k]},CKEDITOR.dialog.prototype={destroy:function(){this.hide(),this._.element.remove()},resize:function(a,b){this._.contentSize&&this._.contentSize.width==a&&this._.contentSize.height==b||(CKEDITOR.dialog.fire("resize",{dialog:this,width:a,height:b},this._.editor),this.fire("resize",{width:a,height:b},this._.editor),this.parts.contents.setStyles({width:a+"px",height:b+"px"}),"rtl"==this._.editor.lang.dir&&this._.position&&(this._.position.x=CKEDITOR.document.getWindow().getViewPaneSize().width-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)),this._.contentSize={width:a,height:b})},getSize:function(){var a=this._.element.getFirst();return{width:a.$.offsetWidth||0,height:a.$.offsetHeight||0}},move:function(a,b,c){var e=this._.element.getFirst(),d="rtl"==this._.editor.lang.dir,g="fixed"==e.getComputedStyle("position");CKEDITOR.env.ie&&e.setStyle("zoom","100%"),g&&this._.position&&this._.position.x==a&&this._.position.y==b||(this._.position={x:a,y:b},g||(g=CKEDITOR.document.getWindow().getScrollPosition(),a+=g.x,b+=g.y),d&&(g=this.getSize(),a=CKEDITOR.document.getWindow().getViewPaneSize().width-g.width-a),b={top:(0<b?b:0)+"px"},b[d?"right":"left"]=(0<a?a:0)+"px",e.setStyles(b),c&&(this._.moved=1))},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var a=this._.element,b=this.definition;a.getParent()&&a.getParent().equals(CKEDITOR.document.getBody())?a.setStyle("display","block"):a.appendTo(CKEDITOR.document.getBody()),this.resize(this._.contentSize&&this._.contentSize.width||b.width||b.minWidth,this._.contentSize&&this._.contentSize.height||b.height||b.minHeight),this.reset(),this.selectPage(this.definition.contents[0].id),null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=this._.editor.config.baseFloatZIndex),this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex+=10),null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,this._.parentDialog=null,J(this._.editor)):(this._.parentDialog=CKEDITOR.dialog._.currentTop,this._.parentDialog.getElement().getFirst().$.style.zIndex-=Math.floor(this._.editor.config.baseFloatZIndex/2),CKEDITOR.dialog._.currentTop=this),a.on("keydown",M),a.on("keyup",N),this._.hasFocus=!1;for(var c in b.contents)if(b.contents[c]){var a=b.contents[c],e=this._.tabs[a.id],d=a.requiredContent,g=0;if(e){for(var f in this._.contents[a.id]){var h=this._.contents[a.id][f];"hbox"==h.type||"vbox"==h.type||!h.getInputElement()||(h.requiredContent&&!this._.editor.activeFilter.check(h.requiredContent)?h.disable():(h.enable(),g++))}!g||d&&!this._.editor.activeFilter.check(d)?e[0].addClass("cke_dialog_tab_disabled"):e[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout(function(){this.layout(),T(this),this.parts.dialog.setStyle("visibility",""),this.fireOnce("load",{}),CKEDITOR.ui.fire("ready",this),this.fire("show",{}),this._.editor.fire("dialogShow",this),this._.parentDialog||this._.editor.focusManager.lock(),this.foreach(function(a){a.setInitValue&&a.setInitValue()})},100,this)},layout:function(){var a=this.parts.dialog,b=this.getSize(),c=CKEDITOR.document.getWindow().getViewPaneSize(),e=(c.width-b.width)/2,d=(c.height-b.height)/2;CKEDITOR.env.ie6Compat||(b.height+(0<d?d:0)>c.height||b.width+(0<e?e:0)>c.width?a.setStyle("position","absolute"):a.setStyle("position","fixed")),this.move(this._.moved?this._.position.x:e,this._.moved?this._.position.y:d)},foreach:function(a){for(var b in this._.contents)for(var c in this._.contents[b])a.call(this,this._.contents[b][c]);return this},reset:function(){var a=function(a){a.reset&&a.reset(1)};return function(){return this.foreach(a),this}}(),setupContent:function(){var a=arguments;this.foreach(function(b){b.setup&&b.setup.apply(b,a)})},commitContent:function(){var a=arguments;this.foreach(function(b){CKEDITOR.env.ie&&this._.currentFocusIndex==b.focusIndex&&b.getInputElement().$.blur(),b.commit&&b.commit.apply(b,a)})},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{}),this._.editor.fire("dialogHide",this),this.selectPage(this._.tabIdList[0]);var a=this._.element;for(a.setStyle("display","none"),this.parts.dialog.setStyle("visibility","hidden"),X(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var b=this._.parentDialog.getElement().getFirst();b.setStyle("z-index",parseInt(b.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2))}else K(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex-=10;else{CKEDITOR.dialog._.currentZIndex=null,a.removeListener("keydown",M),a.removeListener("keyup",N);var c=this._.editor;c.focus(),setTimeout(function(){c.focusManager.unlock(),CKEDITOR.env.iOS&&c.window.focus()},0)}delete this._.parentDialog,this.foreach(function(a){a.resetInitValue&&a.resetInitValue()})}},addPage:function(a){if(!a.requiredContent||this._.editor.filter.check(a.requiredContent)){for(var b=[],c=a.label?' title="'+CKEDITOR.tools.htmlEncode(a.label)+'"':"",e=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:a.elements,expand:!!a.expand,padding:a.padding,style:a.style||"width: 100%;"},b),d=this._.contents[a.id]={},g=e.getChild(),f=0;e=g.shift();)!e.notAllowed&&"hbox"!=e.type&&"vbox"!=e.type&&f++,d[e.id]=e,"function"==typeof e.getChild&&g.push.apply(g,e.getChild());f||(a.hidden=!0),(b=CKEDITOR.dom.element.createFromHtml(b.join(""))).setAttribute("role","tabpanel"),e=CKEDITOR.env,d="cke_"+a.id+"_"+CKEDITOR.tools.getNextNumber(),c=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',0<this._.pageCount?" cke_last":"cke_first",c,a.hidden?' style="display:none"':"",' id="',d,'"',e.gecko&&!e.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',a.label,"</a>"].join("")),b.setAttribute("aria-labelledby",d),this._.tabs[a.id]=[c,b],this._.tabIdList.push(a.id),!a.hidden&&this._.pageCount++,this._.lastTab=c,this.updateStyle(),b.setAttribute("name",a.id),b.appendTo(this.parts.contents),c.unselectable(),this.parts.tabs.append(c),a.accessKey&&(O(this,this,"CTRL+"+a.accessKey,Y,Z),this._.accessKeyMap["CTRL+"+a.accessKey]=a.id)}},selectPage:function(a){if(this._.currentTabId!=a&&!this._.tabs[a][0].hasClass("cke_dialog_tab_disabled")&&!1!==this.fire("selectPage",{page:a,currentPage:this._.currentTabId})){for(var b in this._.tabs){var c=this._.tabs[b][0],e=this._.tabs[b][1];b!=a&&(c.removeClass("cke_dialog_tab_selected"),e.hide()),e.setAttribute("aria-hidden",b!=a)}var d=this._.tabs[a];d[0].addClass("cke_dialog_tab_selected"),CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?(G(d[1]),d[1].show(),setTimeout(function(){G(d[1],1)},0)):d[1].show(),this._.currentTabId=a,this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,a)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(a){var b=this._.tabs[a]&&this._.tabs[a][0];b&&1!=this._.pageCount&&b.isVisible()&&(a==this._.currentTabId&&this.selectPage(t.call(this)),b.hide(),this._.pageCount--,this.updateStyle())},showPage:function(a){(a=this._.tabs[a]&&this._.tabs[a][0])&&(a.show(),this._.pageCount++,this.updateStyle())},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(a,b){var c=this._.contents[a];return c&&c[b]},getValueOf:function(a,b){return this.getContentElement(a,b).getValue()},setValueOf:function(a,b,c){return this.getContentElement(a,b).setValue(c)},getButton:function(a){return this._.buttons[a]},click:function(a){return this._.buttons[a].click()},disableButton:function(a){return this._.buttons[a].disable()},enableButton:function(a){return this._.buttons[a].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(a,b){if(void 0===b)b=this._.focusList.length,this._.focusList.push(new H(this,a,b));else{this._.focusList.splice(b,0,new H(this,a,b));for(var c=b+1;c<this._.focusList.length;c++)this._.focusList[c].focusIndex++}}},CKEDITOR.tools.extend(CKEDITOR.dialog,{add:function(a,b){this._.dialogDefinitions[a]&&"function"!=typeof b||(this._.dialogDefinitions[a]=b)},exists:function(a){return!!this._.dialogDefinitions[a]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(a,b,c){return!((a=a.config.removeDialogTabs)&&a.match(RegExp("(?:^|;)"+b+":"+c+"(?:$|;)","i")))},okButton:function(){var a=function(a,c){return c=c||{},CKEDITOR.tools.extend({id:"ok",type:"button",label:a.lang.common.ok,class:"cke_dialog_ui_button_ok",onClick:function(a){!1!==(a=a.data.dialog).fire("ok",{hide:!0}).hide&&a.hide()}},c,!0)};return a.type="button",a.override=function(b){return CKEDITOR.tools.extend(function(c){return a(c,b)},{type:"button"},!0)},a}(),cancelButton:function(){var a=function(a,c){return c=c||{},CKEDITOR.tools.extend({id:"cancel",type:"button",label:a.lang.common.cancel,class:"cke_dialog_ui_button_cancel",onClick:function(a){!1!==(a=a.data.dialog).fire("cancel",{hide:!0}).hide&&a.hide()}},c,!0)};return a.type="button",a.override=function(b){return CKEDITOR.tools.extend(function(c){return a(c,b)},{type:"button"},!0)},a}(),addUIElement:function(a,b){this._.uiElementBuilders[a]=b}}),CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null},CKEDITOR.event.implementOn(CKEDITOR.dialog),CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype);var W={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]},z=function(a,b,c){for(var d,e=0;d=a[e];e++)if(d.id==b||c&&d[c]&&(d=z(d[c],b,c)))return d;return null},A=function(a,b,c,e,d){if(c){for(var f,g=0;f=a[g];g++){if(f.id==c)return a.splice(g,0,b),b;if(e&&f[e]&&(f=A(f[e],b,c,e,!0)))return f}if(d)return null}return a.push(b),b},B=function(a,b,c){for(var d,e=0;d=a[e];e++){if(d.id==b)return a.splice(e,1);if(c&&d[c]&&(d=B(d[c],b,c)))return d}return null},L=function(a,b){this.dialog=a;for(var d,c=b.contents,e=0;d=c[e];e++)c[e]=d&&new I(a,d);CKEDITOR.tools.extend(this,b)};L.prototype={getContents:function(a){return z(this.contents,a)},getButton:function(a){return z(this.buttons,a)},addContents:function(a,b){return A(this.contents,a,b)},addButton:function(a,b){return A(this.buttons,a,b)},removeContents:function(a){B(this.contents,a)},removeButton:function(a){B(this.buttons,a)}},I.prototype={get:function(a){return z(this.elements,a,"children")},add:function(a,b){return A(this.elements,a,b,"children")},remove:function(a){B(this.elements,a,"children")}};var F,q,w={},s={},M=function(a){var b=a.data.$.ctrlKey||a.data.$.metaKey,c=a.data.$.altKey,e=a.data.$.shiftKey,d=String.fromCharCode(a.data.$.keyCode);(b=s[(b?"CTRL+":"")+(c?"ALT+":"")+(e?"SHIFT+":"")+d])&&b.length&&((b=b[b.length-1]).keydown&&b.keydown.call(b.uiElement,b.dialog,b.key),a.data.preventDefault())},N=function(a){var b=a.data.$.ctrlKey||a.data.$.metaKey,c=a.data.$.altKey,e=a.data.$.shiftKey,d=String.fromCharCode(a.data.$.keyCode);(b=s[(b?"CTRL+":"")+(c?"ALT+":"")+(e?"SHIFT+":"")+d])&&b.length&&(b=b[b.length-1]).keyup&&(b.keyup.call(b.uiElement,b.dialog,b.key),a.data.preventDefault())},O=function(a,b,c,e,d){(s[c]||(s[c]=[])).push({uiElement:a,dialog:b,key:c,keyup:d||a.accessKeyUp,keydown:e||a.accessKeyDown})},X=function(a){for(var b in s){for(var c=s[b],e=c.length-1;0<=e;e--)(c[e].dialog==a||c[e].uiElement==a)&&c.splice(e,1);0===c.length&&delete s[b]}},Z=function(a,b){a._.accessKeyMap[b]&&a.selectPage(a._.accessKeyMap[b])},Y=function(){};CKEDITOR.ui.dialog={uiElement:function(a,b,c,e,d,g,f){if(!(4>arguments.length)){var h=(e.call?e(b):e)||"div",m=["<",h," "],k=(d&&d.call?d(b):d)||{},i=(g&&g.call?g(b):g)||{},o=(f&&f.call?f.call(this,a,b):f)||"",j=this.domId=i.id||CKEDITOR.tools.getNextId()+"_uiElement";b.requiredContent&&!a.getParentEditor().filter.check(b.requiredContent)&&(k.display="none",this.notAllowed=!0),i.id=j;var n={};b.type&&(n["cke_dialog_ui_"+b.type]=1),b.className&&(n[b.className]=1),b.disabled&&(n.cke_disabled=1);for(var l=i.class&&i.class.split?i.class.split(" "):[],j=0;j<l.length;j++)l[j]&&(n[l[j]]=1);l=[];for(j in n)l.push(j);i.class=l.join(" "),b.title&&(i.title=b.title),n=(b.style||"").split(";"),b.align&&(l=b.align,k["margin-left"]="left"==l?0:"auto",k["margin-right"]="right"==l?0:"auto");for(j in k)n.push(j+":"+k[j]);for(b.hidden&&n.push("display:none"),j=n.length-1;0<=j;j--)""===n[j]&&n.splice(j,1);0<n.length&&(i.style=(i.style?i.style+"; ":"")+n.join("; "));for(j in i)m.push(j+'="'+CKEDITOR.tools.htmlEncode(i[j])+'" ');m.push(">",o,"</",h,">"),c.push(m.join("")),(this._||(this._={})).dialog=a,"boolean"==typeof b.isChanged&&(this.isChanged=function(){return b.isChanged}),"function"==typeof b.isChanged&&(this.isChanged=b.isChanged),"function"==typeof b.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,function(a){return function(c){a.call(this,b.setValue.call(this,c))}})),"function"==typeof b.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,function(a){return function(){return b.getValue.call(this,a.call(this))}})),CKEDITOR.event.implementOn(this),this.registerEvents(b),this.accessKeyUp&&this.accessKeyDown&&b.accessKey&&O(this,a,"CTRL+"+b.accessKey);var p=this;a.on("load",function(){var b=p.getInputElement();if(b){var c=p.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?"cke_dialog_ui_focused":"";b.on("focus",function(){a._.tabBarMode=!1,a._.hasFocus=!0,p.fire("focus"),c&&this.addClass(c)}),b.on("blur",function(){p.fire("blur"),c&&this.removeClass(c)})}}),CKEDITOR.tools.extend(this,b),this.keyboardFocusable&&(this.tabIndex=b.tabIndex||0,this.focusIndex=a._.focusList.push(this)-1,this.on("focus",function(){a._.currentFocusIndex=p.focusIndex}))}},hbox:function(a,b,c,e,d){if(!(4>arguments.length)){this._||(this._={});var m,g=this._.children=b,f=d&&d.widths||null,h=d&&d.height||null,k={role:"presentation"};d&&d.align&&(k.align=d.align),CKEDITOR.ui.dialog.uiElement.call(this,a,d||{type:"hbox"},e,"table",{},k,function(){var a=['<tbody><tr class="cke_dialog_ui_hbox">'];for(m=0;m<c.length;m++){var b="cke_dialog_ui_hbox_child",e=[];0===m&&(b="cke_dialog_ui_hbox_first"),m==c.length-1&&(b="cke_dialog_ui_hbox_last"),a.push('<td class="',b,'" role="presentation" '),f?f[m]&&e.push("width:"+r(f[m])):e.push("width:"+Math.floor(100/c.length)+"%"),h&&e.push("height:"+r(h)),d&&void 0!==d.padding&&e.push("padding:"+r(d.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&g[m].align&&e.push("text-align:"+g[m].align),0<e.length&&a.push('style="'+e.join("; ")+'" '),a.push(">",c[m],"</td>")}return a.push("</tr></tbody>"),a.join("")})}},vbox:function(a,b,c,e,d){if(!(3>arguments.length)){this._||(this._={});var g=this._.children=b,f=d&&d.width||null,h=d&&d.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,a,d||{type:"vbox"},e,"div",null,{role:"presentation"},function(){var b=['<table role="presentation" cellspacing="0" border="0" '];b.push('style="'),d&&d.expand&&b.push("height:100%;"),b.push("width:"+r(f||"100%"),";"),CKEDITOR.env.webkit&&b.push("float:none;"),b.push('"'),b.push('align="',CKEDITOR.tools.htmlEncode(d&&d.align||("ltr"==a.getParentEditor().lang.dir?"left":"right")),'" '),b.push("><tbody>");for(var e=0;e<c.length;e++){var i=[];b.push('<tr><td role="presentation" '),f&&i.push("width:"+r(f||"100%")),h?i.push("height:"+r(h[e])):d&&d.expand&&i.push("height:"+Math.floor(100/c.length)+"%"),d&&void 0!==d.padding&&i.push("padding:"+r(d.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&g[e].align&&i.push("text-align:"+g[e].align),0<i.length&&b.push('style="',i.join("; "),'" '),b.push(' class="cke_dialog_ui_vbox_child">',c[e],"</td></tr>")}return b.push("</tbody></table>"),b.join("")})}}},CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(a,b){return this.getInputElement().setValue(a),!b&&this.fire("change",{value:a}),this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var a=this.getInputElement();(a=a.getParent())&&-1==a.$.className.search("cke_dialog_page_contents"););return a?(a=a.getAttribute("name"),this._.dialog._.currentTabId!=a&&this._.dialog.selectPage(a),this):this},focus:function(){return this.selectParentTab().getInputElement().focus(),this},registerEvents:function(a){var c,d,b=/^on([A-Z]\w+)/;for(d in a)(c=d.match(b))&&(this.eventProcessors[d]?this.eventProcessors[d].call(this,this._.dialog,a[d]):function(a,b,c,d){b.on("load",function(){a.getInputElement().on(c,d,a)})}(this,this._.dialog,c[1].toLowerCase(),a[d]));return this},eventProcessors:{onLoad:function(a,b){a.on("load",b,this)},onShow:function(a,b){a.on("show",b,this)},onHide:function(a,b){a.on("hide",b,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var a=this.getElement();this.getInputElement().setAttribute("disabled","true"),a.addClass("cke_disabled")},enable:function(){var a=this.getElement();this.getInputElement().removeAttribute("disabled"),a.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return!(!this.isEnabled()||!this.isVisible())}},CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(a){return 1>arguments.length?this._.children.concat():(a.splice||(a=[a]),2>a.length?this._.children[a[0]]:this._.children[a[0]]&&this._.children[a[0]].getChild?this._.children[a[0]].getChild(a.slice(1,a.length)):null)}},!0),CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox,function(){var a={build:function(a,c,e){for(var g,d=c.children,f=[],h=[],m=0;m<d.length&&(g=d[m]);m++){var k=[];f.push(k),h.push(CKEDITOR.dialog._.uiElementBuilders[g.type].build(a,g,k))}return new CKEDITOR.ui.dialog[c.type](a,h,f,e,c)}};CKEDITOR.dialog.addUIElement("hbox",a),CKEDITOR.dialog.addUIElement("vbox",a)}(),CKEDITOR.dialogCommand=function(a,b){this.dialogName=a,CKEDITOR.tools.extend(this,b,!0)},CKEDITOR.dialogCommand.prototype={exec:function(a){a.openDialog(this.dialogName)},canUndo:!1,editorFocus:1},function(){var a=/^([a]|[^a])+$/,b=/^\d*$/,c=/^\d*(?:\.\d+)?$/,e=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,d=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,g=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/;CKEDITOR.VALIDATE_OR=1,CKEDITOR.VALIDATE_AND=2,CKEDITOR.dialog.validate={functions:function(){var a=arguments;return function(){var c,g,b=this&&this.getValue?this.getValue():a[0],d=CKEDITOR.VALIDATE_AND,e=[];for(g=0;g<a.length&&"function"==typeof a[g];g++)e.push(a[g]);g<a.length&&"string"==typeof a[g]&&(c=a[g],g++),g<a.length&&"number"==typeof a[g]&&(d=a[g]);var j=d==CKEDITOR.VALIDATE_AND;for(g=0;g<e.length;g++)j=d==CKEDITOR.VALIDATE_AND?j&&e[g](b):j||e[g](b);return!!j||c}},regex:function(a,b){return function(c){return c=this&&this.getValue?this.getValue():c,!!a.test(c)||b}},notEmpty:function(b){return this.regex(a,b)},integer:function(a){return this.regex(b,a)},number:function(a){return this.regex(c,a)},cssLength:function(a){return this.functions(function(a){return d.test(CKEDITOR.tools.trim(a))},a)},htmlLength:function(a){return this.functions(function(a){return e.test(CKEDITOR.tools.trim(a))},a)},inlineStyle:function(a){return this.functions(function(a){return g.test(CKEDITOR.tools.trim(a))},a)},equals:function(a,b){return this.functions(function(b){return b==a},b)},notEqual:function(a,b){return this.functions(function(b){return b!=a},b)}},CKEDITOR.on("instanceDestroyed",function(a){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var b;b=CKEDITOR.dialog._.currentTop;)b.hide();for(var c in w)w[c].remove();w={}}var d,a=a.editor._.storedDialogs;for(d in a)a[d].destroy()})}(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(a,b){var c=null,e=CKEDITOR.dialog._.dialogDefinitions[a];if(null===CKEDITOR.dialog._.currentTop&&J(this),"function"==typeof e)c=this._.storedDialogs||(this._.storedDialogs={}),c=c[a]||(c[a]=new CKEDITOR.dialog(this,a)),b&&b.call(c,c),c.show();else{if("failed"==e)throw K(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+a+'" failed when loading definition.');"string"==typeof e&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e),function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[a]&&(CKEDITOR.dialog._.dialogDefinitions[a]="failed"),this.openDialog(a,b)},this,0,1)}return CKEDITOR.skin.loadPart("dialog"),c}})}(),CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(t){t.on("doubleclick",function(u){u.data.dialog&&t.openDialog(u.data.dialog)},null,null,999)}}),CKEDITOR.plugins.add("divarea",{afterInit:function(a){a.addMode("wysiwyg",function(c){var b=CKEDITOR.dom.element.createFromHtml('<div class="cke_wysiwyg_div cke_reset" hidefocus="true"></div>');a.ui.space("contents").append(b),(b=a.editable(b)).detach=CKEDITOR.tools.override(b.detach,function(a){return function(){a.apply(this,arguments),this.remove()}}),a.setData(a.getData(1),c),a.fire("contentDom")})}}),function(){function m(b,d,a){a=b.config.forceEnterMode||a,"wysiwyg"==b.mode&&(d||(d=b.activeEnterMode),b.elementPath().isContextFor("p")||(d=CKEDITOR.ENTER_BR,a=1),b.fire("saveSnapshot"),d==CKEDITOR.ENTER_BR?p(b,d,null,a):q(b,d,null,a),b.fire("saveSnapshot"))}function r(b){for(var d=(b=b.getSelection().getRanges(!0)).length-1;0<d;d--)b[d].deleteContents();return b[0]}function u(b){var d=b.startContainer.getAscendant(function(a){return a.type==CKEDITOR.NODE_ELEMENT&&"true"==a.getAttribute("contenteditable")},!0);return b.root.equals(d)?b:((d=new CKEDITOR.dom.range(d)).moveToRange(b),d)}CKEDITOR.plugins.add("enterkey",{init:function(b){b.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(b){m(b)}}),b.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(b){m(b,b.activeShiftEnterMode,1)}}),b.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var v=CKEDITOR.dom.walker.whitespaces(),w=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(b,d,a,h){if(a=a||r(b)){var e,f=(a=u(a)).document,i=a.checkStartOfBlock(),k=a.checkEndOfBlock(),j=b.elementPath(a.startContainer),c=j.block,l=d==CKEDITOR.ENTER_DIV?"div":"p";if(i&&k){if(c&&(c.is("li")||c.getParent().is("li"))){c.is("li")||(c=c.getParent()),e=(a=c.getParent()).getParent();var h=!c.hasPrevious(),n=!c.hasNext(),g=(l=b.getSelection()).createBookmarks(),i=c.getDirection(1),k=c.getAttribute("class"),o=c.getAttribute("style"),m=e.getDirection(1)!=i,b=b.enterMode!=CKEDITOR.ENTER_BR||m||o||k;if(e.is("li"))h||n?c[h?"insertBefore":"insertAfter"](e):c.breakParent(e);else{if(b)j.block.is("li")?(e=f.createElement(d==CKEDITOR.ENTER_P?"p":"div"),m&&e.setAttribute("dir",i),o&&e.setAttribute("style",o),k&&e.setAttribute("class",k),c.moveChildren(e)):e=j.block,h||n?e[h?"insertBefore":"insertAfter"](a):(c.breakParent(a),e.insertAfter(a));else if(c.appendBogus(!0),h||n)for(;f=c[h?"getFirst":"getLast"]();)f[h?"insertBefore":"insertAfter"](a);else for(c.breakParent(a);f=c.getLast();)f.insertAfter(a);c.remove()}return void l.selectBookmarks(g)}if(c&&c.getParent().is("blockquote"))return c.breakParent(c.getParent()),c.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||c.getPrevious().remove(),c.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||c.getNext().remove(),a.moveToElementEditStart(c),void a.select()}else if(c&&c.is("pre")&&!k)return void p(b,d,a,h);if(i=a.splitBlock(l)){if(d=i.previousBlock,c=i.nextBlock,j=i.wasStartOfBlock,b=i.wasEndOfBlock,c?(g=c.getParent()).is("li")&&(c.breakParent(g),c.move(c.getNext(),1)):d&&(g=d.getParent())&&g.is("li")&&(d.breakParent(g),g=d.getNext(),a.moveToElementEditStart(g),d.move(d.getPrevious())),j||b){if(d?(d.is("li")||!s.test(d.getName())&&!d.is("pre"))&&(e=d.clone()):c&&(e=c.clone()),e?h&&!e.is("li")&&e.renameNode(l):g&&g.is("li")?e=g:(e=f.createElement(l),d&&(n=d.getDirection())&&e.setAttribute("dir",n)),f=i.elementPath)for(h=0,l=f.elements.length;h<l&&(!(g=f.elements[h]).equals(f.block)&&!g.equals(f.blockLimit));h++)CKEDITOR.dtd.$removeEmpty[g.getName()]&&(g=g.clone(),e.moveChildren(g),e.append(g));e.appendBogus(),e.getParent()||a.insertNode(e),e.is("li")&&e.removeAttribute("value"),!CKEDITOR.env.ie||!j||b&&d.getChildCount()||(a.moveToElementEditStart(b?d:e),a.select()),a.moveToElementEditStart(j&&!b?c:e)}else c.is("li")&&((e=a.clone()).selectNodeContents(c),e=new CKEDITOR.dom.walker(e),e.evaluator=function(a){return!(w(a)||v(a)||a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in CKEDITOR.dtd.$inline&&!(a.getName()in CKEDITOR.dtd.$empty))},(g=e.next())&&g.type==CKEDITOR.NODE_ELEMENT&&g.is("ul","ol")&&(CKEDITOR.env.needsBrFiller?f.createElement("br"):f.createText("")).insertBefore(g)),c&&a.moveToElementEditStart(c);a.select(),a.scrollIntoView()}}},enterBr:function(b,d,a,h){if(a=a||r(b)){var f=a.document,i=a.checkEndOfBlock(),k=new CKEDITOR.dom.elementPath(b.getSelection().getStartElement()),j=k.block,c=j&&k.block.getName();h||"li"!=c?(!h&&i&&s.test(c)?(i=j.getDirection())?((f=f.createElement("div")).setAttribute("dir",i),f.insertAfter(j),a.setStart(f,0)):(f.createElement("br").insertAfter(j),CKEDITOR.env.gecko&&f.createText("").insertAfter(j),a.setStartAt(j.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(b="pre"==c&&CKEDITOR.env.ie&&8>CKEDITOR.env.version?f.createText("\r"):f.createElement("br"),a.deleteContents(),a.insertNode(b),CKEDITOR.env.needsBrFiller?(f.createText("\ufeff").insertAfter(b),i&&(j||k.blockLimit).appendBogus(),b.getNext().$.nodeValue="",a.setStartAt(b.getNext(),CKEDITOR.POSITION_AFTER_START)):a.setStartAt(b,CKEDITOR.POSITION_AFTER_END)),a.collapse(!0),a.select(),a.scrollIntoView()):q(b,d,a,h)}}};var t=CKEDITOR.plugins.enterkey,p=t.enterBr,q=t.enterBlock,s=/^h[1-6]$/}(),function(){function i(b,f){var g={},c=[],e={nbsp:"",shy:"",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},b=b.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(b,a){var d=f?"&"+a+";":e[a];return g[d]=f?e[a]:"&"+a+";",c.push(d),""});if(!f&&b){var d,b=b.split(","),a=document.createElement("div");for(a.innerHTML="&"+b.join(";&")+";",d=a.innerHTML,a=null,a=0;a<d.length;a++){var h=d.charAt(a);g[h]="&"+b[a]+";",c.push(h)}}return g.regex=c.join(f?"|":""),g}CKEDITOR.plugins.add("entities",{afterInit:function(b){function f(a){return h[a]}function g(b){return"force"!=c.entities_processNumerical&&a[b]?a[b]:"&#"+b.charCodeAt(0)+";"}var c=b.config;if(b=(b=b.dataProcessor)&&b.htmlFilter){var e=[];!1!==c.basicEntities&&e.push("nbsp,gt,lt,amp"),c.entities&&(e.length&&e.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),c.entities_latin&&e.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),c.entities_greek&&e.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),c.entities_additional&&e.push(c.entities_additional));var a=i(e.join(",")),d=a.regex?"["+a.regex+"]":"a^";delete a.regex,c.entities&&c.entities_processNumerical&&(d="[^ -~]|"+d);var d=RegExp(d,"g"),h=i("nbsp,gt,lt,amp,shy",!0),j=RegExp(h.regex,"g");b.addRules({text:function(a){return a.replace(j,f).replace(d,g)}},{applyToAll:!0,excludeNestedEditable:!0})}}})}(),CKEDITOR.config.basicEntities=!0,CKEDITOR.config.entities=!0,CKEDITOR.config.entities_latin=!0,CKEDITOR.config.entities_greek=!0,CKEDITOR.config.entities_additional="#39",function(){function k(a,b){var e,f;b.on("refresh",function(a){var c,b=[i];for(c in a.data.states)b.push(a.data.states[c]);this.setState(CKEDITOR.tools.search(b,m)?m:i)},b,null,100),b.on("exec",function(b){e=a.getSelection(),f=e.createBookmarks(1),b.data||(b.data={}),b.data.done=!1},b,null,0),b.on("exec",function(){a.forceNextSelectionCheck(),e.selectBookmarks(f)},b,null,100)}var i=CKEDITOR.TRISTATE_DISABLED,m=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indent",{init:function(a){var b=CKEDITOR.plugins.indent.genericDefinition;k(a,a.addCommand("indent",new b(!0))),k(a,a.addCommand("outdent",new b)),a.ui.addButton&&(a.ui.addButton("Indent",{label:a.lang.indent.indent,command:"indent",directional:!0,toolbar:"indent,20"}),a.ui.addButton("Outdent",{label:a.lang.indent.outdent,command:"outdent",directional:!0,toolbar:"indent,10"})),a.on("dirChanged",function(b){var f=a.createRange(),j=b.data.node;f.setStartBefore(j),f.setEndAfter(j);for(var c,l=new CKEDITOR.dom.walker(f);c=l.next();)if(c.type==CKEDITOR.NODE_ELEMENT)if(!c.equals(j)&&c.getDirection())f.setStartAfter(c),l=new CKEDITOR.dom.walker(f);else{var d=a.config.indentClasses;if(d)for(var g="ltr"==b.data.dir?["_rtl",""]:["","_rtl"],h=0;h<d.length;h++)c.hasClass(d[h]+g[0])&&(c.removeClass(d[h]+g[0]),c.addClass(d[h]+g[1]));d=c.getStyle("margin-right"),g=c.getStyle("margin-left"),d?c.setStyle("margin-left",d):c.removeStyle("margin-left"),g?c.setStyle("margin-right",g):c.removeStyle("margin-right")}})}}),CKEDITOR.plugins.indent={genericDefinition:function(a){this.isIndent=!!a,this.startDisabled=!this.isIndent},specificDefinition:function(a,b,e){this.name=b,this.editor=a,this.jobs={},this.enterBr=a.config.enterMode==CKEDITOR.ENTER_BR,this.isIndent=!!e,this.relatedGlobal=e?"indent":"outdent",this.indentKey=e?9:CKEDITOR.SHIFT+9,this.database={}},registerCommands:function(a,b){a.on("pluginsLoaded",function(){for(var a in b)!function(a,b){var c,e=a.getCommand(b.relatedGlobal);for(c in b.jobs)e.on("exec",function(d){d.data.done||(a.fire("lockSnapshot"),b.execJob(a,c)&&(d.data.done=!0),a.fire("unlockSnapshot"),CKEDITOR.dom.element.clearAllMarkers(b.database))},this,null,c),e.on("refresh",function(d){d.data.states||(d.data.states={}),d.data.states[b.name+"@"+c]=b.refreshJob(a,c,d.data.path)},this,null,c);a.addFeature(b)}(this,b[a])})}},CKEDITOR.plugins.indent.genericDefinition.prototype={context:"p",exec:function(){}},CKEDITOR.plugins.indent.specificDefinition.prototype={execJob:function(a,b){var e=this.jobs[b];if(e.state!=i)return e.exec.call(this,a)},refreshJob:function(a,b,e){return b=this.jobs[b],b.state=a.activeFilter.checkFeature(this)?b.refresh.call(this,a,e):i,b.state},getContext:function(a){return a.contains(this.context)}}}(),function(){function f(b,d,a){if(!b.getCustomData("indent_processed")){var e=this.editor,j=this.isIndent;if(d){if(e=b.$.className.match(this.classNameRegex),a=0,e&&(e=e[1],a=CKEDITOR.tools.indexOf(d,e)+1),0>(a+=j?1:-1))return;a=Math.min(a,d.length),a=Math.max(a,0),b.$.className=CKEDITOR.tools.ltrim(b.$.className.replace(this.classNameRegex,"")),0<a&&b.addClass(d[a-1])}else{var d=k(b,a),a=parseInt(b.getStyle(d),10),g=e.config.indentOffset||40;if(isNaN(a)&&(a=0),0>(a+=(j?1:-1)*g))return;a=Math.max(a,0),a=Math.ceil(a/g)*g,b.setStyle(d,a?a+(e.config.indentUnit||"px"):""),""===b.getAttribute("style")&&b.removeAttribute("style")}CKEDITOR.dom.element.setMarker(this.database,b,"indent_processed",1)}}function k(b,d){return"ltr"==(d||b.getComputedStyle("direction"))?"margin-left":"margin-right"}var h=CKEDITOR.dtd.$listItem,m=CKEDITOR.dtd.$list,i=CKEDITOR.TRISTATE_DISABLED,l=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentblock",{requires:"indent",init:function(b){function d(){a.specificDefinition.apply(this,arguments),this.allowedContent={"div h1 h2 h3 h4 h5 h6 ol p pre ul":{propertiesOnly:!0,styles:e?null:"margin-left,margin-right",classes:e||null}},this.enterBr&&(this.allowedContent.div=!0),this.requiredContent=(this.enterBr?"div":"p")+(e?"("+e.join(",")+")":"{margin-left}"),this.jobs={20:{refresh:function(a,b){if((c=b.block||b.blockLimit).is(h)||(c=c.getAscendant(h)||c),c.is(h)&&(c=c.getParent()),!this.enterBr&&!this.getContext(b))return i;if(e){var d;d=e;var c=c.$.className.match(this.classNameRegex),f=this.isIndent;return(d=c?!f||c[1]!=d.slice(-1):f)?l:i}return this.isIndent?l:c?CKEDITOR[(parseInt(c.getStyle(k(c)),10)||0)<=0?"TRISTATE_DISABLED":"TRISTATE_OFF"]:i},exec:function(a){var c,b=(b=a.getSelection())&&b.getRanges()[0];if(c=a.elementPath().contains(m))f.call(this,c,e);else for(b=b.createIterator(),a=a.config.enterMode,b.enforceRealBlocks=!0,b.enlargeBr=a!=CKEDITOR.ENTER_BR;c=b.getNextParagraph(a==CKEDITOR.ENTER_P?"p":"div");)c.isReadOnly()||f.call(this,c,e);return!0}}}}var a=CKEDITOR.plugins.indent,e=b.config.indentClasses;a.registerCommands(b,{indentblock:new d(b,"indentblock",!0),outdentblock:new d(b,"outdentblock")}),CKEDITOR.tools.extend(d.prototype,a.specificDefinition.prototype,{context:{div:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,p:1,pre:1,table:1},classNameRegex:e?RegExp("(?:^|\\s+)("+e.join("|")+")(?=$|\\s)"):null})}})}(),function(){function s(c){for(var d,j=this,n=this.database,m=this.context,l=((l=c.getSelection())&&l.getRanges()).createIterator();d=l.getNextRange();){for(var b=d.getCommonAncestor();b&&(b.type!=CKEDITOR.NODE_ELEMENT||!m[b.getName()]);)b=b.getParent();if(b||(b=d.startPath().contains(m))&&d.setEndAt(b,CKEDITOR.POSITION_BEFORE_END),!b){var h=d.getEnclosedNode();h&&h.type==CKEDITOR.NODE_ELEMENT&&h.getName()in m&&(d.setStartAt(h,CKEDITOR.POSITION_AFTER_START),d.setEndAt(h,CKEDITOR.POSITION_BEFORE_END),b=h)}if(b&&d.startContainer.type==CKEDITOR.NODE_ELEMENT&&d.startContainer.getName()in m&&(h=new CKEDITOR.dom.walker(d),h.evaluator=p,d.startContainer=h.next()),b&&d.endContainer.type==CKEDITOR.NODE_ELEMENT&&d.endContainer.getName()in m&&(h=new CKEDITOR.dom.walker(d),h.evaluator=p,d.endContainer=h.previous()),b)return function(b){for(var e=d.startContainer,a=d.endContainer;e&&!e.getParent().equals(b);)e=e.getParent();for(;a&&!a.getParent().equals(b);)a=a.getParent();if(!e||!a)return!1;for(var g=e,e=[],i=!1;!i;)g.equals(a)&&(i=!0),e.push(g),g=g.getNext();if(1>e.length)return!1;for(g=b.getParents(!0),a=0;a<g.length;a++)if(g[a].getName&&m[g[a].getName()]){b=g[a];break}for(var g=j.isIndent?1:-1,a=e[0],e=e[e.length-1],l=(i=CKEDITOR.plugins.list.listToArray(b,n))[e.getCustomData("listarray_index")].indent,a=a.getCustomData("listarray_index");a<=e.getCustomData("listarray_index");a++)if(i[a].indent+=g,0<g){var h=i[a].parent;i[a].parent=new CKEDITOR.dom.element(h.getName(),h.getDocument())}for(a=e.getCustomData("listarray_index")+1;a<i.length&&i[a].indent>l;a++)i[a].indent+=g;if(e=CKEDITOR.plugins.list.arrayToList(i,n,null,c.config.enterMode,b.getDirection()),!j.isIndent){var f;if((f=b.getParent())&&f.is("li"))for(var k,g=e.listNode.getChildren(),o=[],a=g.count()-1;0<=a;a--)(k=g.getItem(a))&&k.is&&k.is("li")&&o.push(k)}if(e&&e.listNode.replace(b),o&&o.length)for(a=0;a<o.length;a++){for(k=b=o[a];(k=k.getNext())&&k.is&&k.getName()in m;)CKEDITOR.env.needsNbspFiller&&!b.getFirst(t)&&b.append(d.document.createText("")),b.append(k);b.insertAfter(f)}return e&&c.fire("contentDomInvalidated"),!0}(b)}return 0}function p(c){return c.type==CKEDITOR.NODE_ELEMENT&&c.is("li")}function t(c){return u(c)&&v(c)}var u=CKEDITOR.dom.walker.whitespaces(!0),v=CKEDITOR.dom.walker.bookmark(!1,!0),q=CKEDITOR.TRISTATE_DISABLED,r=CKEDITOR.TRISTATE_OFF;CKEDITOR.plugins.add("indentlist",{requires:"indent",init:function(c){function f(c){j.specificDefinition.apply(this,arguments),this.requiredContent=["ul","ol"],c.on("key",function(f){if("wysiwyg"==c.mode&&f.data.keyCode==this.indentKey){var l=this.getContext(c.elementPath());!l||this.isIndent&&CKEDITOR.plugins.indentList.firstItemInPath(this.context,c.elementPath(),l)||(c.execCommand(this.relatedGlobal),f.cancel())}},this),this.jobs[this.isIndent?10:30]={refresh:this.isIndent?function(c,f){var d=this.getContext(f),b=CKEDITOR.plugins.indentList.firstItemInPath(this.context,f,d);return d&&this.isIndent&&!b?r:q}:function(c,f){return!this.getContext(f)||this.isIndent?q:r},exec:CKEDITOR.tools.bind(s,this)}}var j=CKEDITOR.plugins.indent;j.registerCommands(c,{indentlist:new f(c,"indentlist",!0),outdentlist:new f(c,"outdentlist")}),CKEDITOR.tools.extend(f.prototype,j.specificDefinition.prototype,{context:{ol:1,ul:1}})}}),CKEDITOR.plugins.indentList={},CKEDITOR.plugins.indentList.firstItemInPath=function(c,f,j){var n=f.contains(p);return j||(j=f.contains(c)),j&&n&&n.equals(j.getFirst(p))}}(),function(){function E(b,k,e){function d(d){!(a=c[d?"getFirst":"getLast"]())||a.is&&a.isBlockBoundary()||!(m=k.root[d?"getPrevious":"getNext"](CKEDITOR.dom.walker.invisible(!0)))||m.is&&m.isBlockBoundary({br:1})||b.document.createElement("br")[d?"insertBefore":"insertAfter"](a)}for(var f=CKEDITOR.plugins.list.listToArray(k.root,e),g=[],i=0;i<k.contents.length;i++){var h=k.contents[i];(h=h.getAscendant("li",!0))&&!h.getCustomData("list_item_processed")&&(g.push(h),CKEDITOR.dom.element.setMarker(e,h,"list_item_processed",!0))}for(h=null,i=0;i<g.length;i++)h=g[i].getCustomData("listarray_index"),f[h].indent=-1;for(i=h+1;i<f.length;i++)if(f[i].indent>f[i-1].indent+1){for(g=f[i-1].indent+1-f[i].indent,h=f[i].indent;f[i]&&f[i].indent>=h;)f[i].indent+=g,i++;i--}var a,m,c=CKEDITOR.plugins.list.arrayToList(f,e,null,b.config.enterMode,k.root.getAttribute("dir")).listNode;d(!0),d(),c.replace(k.root),b.fire("contentDomInvalidated")}function x(b,k){this.name=b,this.context=this.type=k,this.allowedContent=k+" li",this.requiredContent=k}function A(b,k,e,d){for(var f,g;f=b[d?"getLast":"getFirst"](F);)(g=f.getDirection(1))!==k.getDirection(1)&&f.setAttribute("dir",g),f.remove(),e?f[d?"insertBefore":"insertAfter"](e):k.append(f,d)}function B(b){function k(e){var d=b[e?"getPrevious":"getNext"](q);d&&d.type==CKEDITOR.NODE_ELEMENT&&d.is(b.getName())&&(A(b,d,null,!e),b.remove(),b=d)}k(),k(1)}function C(b){return b.type==CKEDITOR.NODE_ELEMENT&&(b.getName()in CKEDITOR.dtd.$block||b.getName()in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[b.getName()]["#"]}function y(b,k,e){b.fire("saveSnapshot"),e.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var d=e.extractContents();k.trim(!1,!0);var f=k.createBookmark(),i=(g=new CKEDITOR.dom.elementPath(k.startContainer)).block,g=g.lastElement.getAscendant("li",1)||i,c=(h=new CKEDITOR.dom.elementPath(e.startContainer)).contains(CKEDITOR.dtd.$listItem),h=h.contains(CKEDITOR.dtd.$list);for(i?(i=i.getBogus())&&i.remove():h&&(i=h.getPrevious(q))&&v(i)&&i.remove(),(i=d.getLast())&&i.type==CKEDITOR.NODE_ELEMENT&&i.is("br")&&i.remove(),(i=k.startContainer.getChild(k.startOffset))?d.insertBefore(i):k.startContainer.append(d),c&&(d=w(c))&&(g.contains(c)?(A(d,c.getParent(),c),d.remove()):g.append(d));e.checkStartOfBlock()&&e.checkEndOfBlock()&&(h=e.startPath(),d=h.block);)d.is("li")&&(g=d.getParent(),d.equals(g.getLast(q))&&d.equals(g.getFirst(q))&&(d=g)),e.moveToPosition(d,CKEDITOR.POSITION_BEFORE_START),d.remove();e=e.clone(),d=b.editable(),e.setEndAt(d,CKEDITOR.POSITION_BEFORE_END),(e=new CKEDITOR.dom.walker(e)).evaluator=function(a){return q(a)&&!v(a)},(e=e.next())&&e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in CKEDITOR.dtd.$list&&B(e),k.moveToBookmark(f),k.select(),b.fire("saveSnapshot")}function w(b){return(b=b.getLast(q))&&b.type==CKEDITOR.NODE_ELEMENT&&b.getName()in r?b:null}var r={ol:1,ul:1},G=CKEDITOR.dom.walker.whitespaces(),D=CKEDITOR.dom.walker.bookmark(),q=function(b){return!(G(b)||D(b))},v=CKEDITOR.dom.walker.bogus();CKEDITOR.plugins.list={listToArray:function(b,k,e,d,f){if(!r[b.getName()])return[];d||(d=0),e||(e=[]);for(var g=0,i=b.getChildCount();g<i;g++){var h=b.getChild(g);if(h.type==CKEDITOR.NODE_ELEMENT&&h.getName()in CKEDITOR.dtd.$list&&CKEDITOR.plugins.list.listToArray(h,k,e,d+1),"li"==h.$.nodeName.toLowerCase()){var c={parent:b,indent:d,element:h,contents:[]};f?c.grandparent=f:(c.grandparent=b.getParent(),c.grandparent&&"li"==c.grandparent.$.nodeName.toLowerCase()&&(c.grandparent=c.grandparent.getParent())),k&&CKEDITOR.dom.element.setMarker(k,h,"listarray_index",e.length),e.push(c);for(var j,a=0,m=h.getChildCount();a<m;a++)(j=h.getChild(a)).type==CKEDITOR.NODE_ELEMENT&&r[j.getName()]?CKEDITOR.plugins.list.listToArray(j,k,e,d+1,c.grandparent):c.contents.push(j)}}return e},arrayToList:function(b,k,e,d,f){if(e||(e=0),!b||b.length<e+1)return null;for(var g,n,l,i=b[e].parent.getDocument(),h=new CKEDITOR.dom.documentFragment(i),c=null,a=e,m=Math.max(b[e].indent,0),j=null,p=d==CKEDITOR.ENTER_P?"p":"div";;){var o=b[a];if(g=o.grandparent,n=o.element.getDirection(1),o.indent==m){for(c&&b[a].parent.getName()==c.getName()||(c=b[a].parent.clone(!1,1),f&&c.setAttribute("dir",f),h.append(c)),j=c.append(o.element.clone(0,1)),n!=c.getDirection(1)&&j.setAttribute("dir",n),g=0;g<o.contents.length;g++)j.append(o.contents[g].clone(1,1));a++}else if(o.indent==Math.max(m,0)+1)o=b[a-1].element.getDirection(1),a=CKEDITOR.plugins.list.arrayToList(b,null,a,d,o!=n?n:null),!j.getChildCount()&&CKEDITOR.env.needsNbspFiller&&7>=i.$.documentMode&&j.append(i.createText("")),j.append(a.listNode),a=a.nextIndex;else{if(-1!=o.indent||e||!g)return null;r[g.getName()]?(j=o.element.clone(!1,!0),n!=g.getDirection(1)&&j.setAttribute("dir",n)):j=new CKEDITOR.dom.documentFragment(i);var s,t,c=g.getDirection(1)!=n,u=o.element,z=u.getAttribute("class"),v=u.getAttribute("style"),w=j.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(d!=CKEDITOR.ENTER_BR||c||v||z),x=o.contents.length;for(g=0;g<x;g++)if(s=o.contents[g],D(s)&&1<x)w?t=s.clone(1,1):j.append(s.clone(1,1));else if(s.type==CKEDITOR.NODE_ELEMENT&&s.isBlockBoundary()){c&&!s.getDirection()&&s.setAttribute("dir",n),l=s;var y=u.getAttribute("style");y&&l.setAttribute("style",y.replace(/([^;])$/,"$1;")+(l.getAttribute("style")||"")),z&&s.addClass(z),l=null,t&&(j.append(t),t=null),j.append(s.clone(1,1))}else w?(l||(l=i.createElement(p),j.append(l),c&&l.setAttribute("dir",n)),v&&l.setAttribute("style",v),z&&l.setAttribute("class",z),t&&(l.append(t),t=null),l.append(s.clone(1,1))):j.append(s.clone(1,1));t&&((l||j).append(t),t=null),j.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&a!=b.length-1&&(CKEDITOR.env.needsBrFiller&&(n=j.getLast())&&n.type==CKEDITOR.NODE_ELEMENT&&n.is("br")&&n.remove(),(!(n=j.getLast(q))||!(n.type==CKEDITOR.NODE_ELEMENT&&n.is(CKEDITOR.dtd.$block)))&&j.append(i.createElement("br"))),("div"==(n=j.$.nodeName.toLowerCase())||"p"==n)&&j.appendBogus(),h.append(j),c=null,a++}if(l=null,b.length<=a||Math.max(b[a].indent,0)<m)break}if(k)for(b=h.getFirst();b;){if(b.type==CKEDITOR.NODE_ELEMENT&&(CKEDITOR.dom.element.clearMarkers(k,b),b.getName()in CKEDITOR.dtd.$listItem&&(e=b,i=f=d=void 0,d=e.getDirection()))){for(f=e.getParent();f&&!(i=f.getDirection());)f=f.getParent();d==i&&e.removeAttribute("dir")}b=b.getNextSourceNode()}return{listNode:h,nextIndex:a}}};var H=/^h[1-6]$/,F=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);x.prototype={exec:function(b){this.refresh(b,b.elementPath());var k=b.config,e=b.getSelection(),d=e&&e.getRanges();if(this.state==CKEDITOR.TRISTATE_OFF)if((f=b.editable()).getFirst(q)){var g=1==d.length&&d[0];(k=g&&g.getEnclosedNode())&&k.is&&this.type==k.getName()&&this.setState(CKEDITOR.TRISTATE_ON)}else k.enterMode==CKEDITOR.ENTER_BR?f.appendBogus():d[0].fixBlock(1,k.enterMode==CKEDITOR.ENTER_P?"p":"div"),e.selectRanges(d);for(var k=e.createBookmarks(!0),f=[],i={},d=d.createIterator(),h=0;(g=d.getNextRange())&&++h;){var a=(c=g.getBoundaryNodes()).startNode,m=c.endNode;for(a.type==CKEDITOR.NODE_ELEMENT&&"td"==a.getName()&&g.setStartAt(c.startNode,CKEDITOR.POSITION_AFTER_START),m.type==CKEDITOR.NODE_ELEMENT&&"td"==m.getName()&&g.setEndAt(c.endNode,CKEDITOR.POSITION_BEFORE_END),(g=g.createIterator()).forceBrBreak=this.state==CKEDITOR.TRISTATE_OFF;c=g.getNextParagraph();)if(!c.getCustomData("list_block")){CKEDITOR.dom.element.setMarker(i,c,"list_block",1);for(var n,a=(j=b.elementPath(c)).elements,m=0,j=j.blockLimit,l=a.length-1;0<=l&&(n=a[l]);l--)if(r[n.getName()]&&j.contains(n)){j.removeCustomData("list_group_object_"+h),(a=n.getCustomData("list_group_object"))?a.contents.push(c):(a={root:n,contents:[c]},f.push(a),CKEDITOR.dom.element.setMarker(i,n,"list_group_object",a)),m=1;break}m||((m=j).getCustomData("list_group_object_"+h)?m.getCustomData("list_group_object_"+h).contents.push(c):(a={root:m,contents:[c]},CKEDITOR.dom.element.setMarker(i,m,"list_group_object_"+h,a),f.push(a)))}}for(n=[];0<f.length;)if(a=f.shift(),this.state==CKEDITOR.TRISTATE_OFF)if(r[a.root.getName()]){for(d=b,h=a,a=i,g=n,m=CKEDITOR.plugins.list.listToArray(h.root,a),j=[],c=0;c<h.contents.length;c++)l=h.contents[c],(l=l.getAscendant("li",!0))&&!l.getCustomData("list_item_processed")&&(j.push(l),CKEDITOR.dom.element.setMarker(a,l,"list_item_processed",!0));for(var l=h.root.getDocument(),p=void 0,o=void 0,c=0;c<j.length;c++){var u=j[c].getCustomData("listarray_index");(p=m[u].parent).is(this.type)||(o=l.createElement(this.type),p.copyAttributes(o,{start:1,type:1}),o.removeStyle("list-style-type"),m[u].parent=o)}for(a=CKEDITOR.plugins.list.arrayToList(m,a,null,d.config.enterMode),m=void 0,j=a.listNode.getChildCount(),c=0;c<j&&(m=a.listNode.getChild(c));c++)m.getName()==this.type&&g.push(m);a.listNode.replace(h.root),d.fire("contentDomInvalidated")}else{for(m=b,g=n,j=(c=a).contents,d=c.root.getDocument(),h=[],1==j.length&&j[0].equals(c.root)&&(a=d.createElement("div"),j[0].moveChildren&&j[0].moveChildren(a),j[0].append(a),j[0]=a),c=c.contents[0].getParent(),l=0;l<j.length;l++)c=c.getCommonAncestor(j[l].getParent());for(p=m.config.useComputedState,m=a=void 0,p=void 0===p||p,l=0;l<j.length;l++)for(o=j[l];u=o.getParent();){if(u.equals(c)){h.push(o),!m&&o.getDirection()&&(m=1),o=o.getDirection(p),null!==a&&(a=a&&a!=o?null:o);break}o=u}if(!(1>h.length)){for(j=h[h.length-1].getNext(),l=d.createElement(this.type),g.push(l),p=g=void 0;h.length;)g=h.shift(),p=d.createElement("li"),g.is("pre")||H.test(g.getName())||"false"==g.getAttribute("contenteditable")?g.appendTo(p):(g.copyAttributes(p),a&&g.getDirection()&&(p.removeStyle("direction"),p.removeAttribute("dir")),g.moveChildren(p),g.remove()),p.appendTo(l);a&&m&&l.setAttribute("dir",a),j?l.insertBefore(j):l.appendTo(c)}}else this.state==CKEDITOR.TRISTATE_ON&&r[a.root.getName()]&&E.call(this,b,a,i);for(l=0;l<n.length;l++)B(n[l]);CKEDITOR.dom.element.clearAllMarkers(i),e.selectBookmarks(k),b.focus()},refresh:function(b,k){var e=k.contains(r,1),d=k.blockLimit||k.root;e&&d.contains(e)?this.setState(e.is(this.type)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.plugins.add("list",{requires:"indentlist",init:function(b){b.blockless||(b.addCommand("numberedlist",new x("numberedlist","ol")),b.addCommand("bulletedlist",new x("bulletedlist","ul")),b.ui.addButton&&(b.ui.addButton("NumberedList",{label:b.lang.list.numberedlist,command:"numberedlist",directional:!0,toolbar:"list,10"}),b.ui.addButton("BulletedList",{label:b.lang.list.bulletedlist,command:"bulletedlist",directional:!0,toolbar:"list,20"})),b.on("key",function(k){var d,e=k.data.domEvent.getKey();if("wysiwyg"==b.mode&&e in{8:1,46:1}){var f=b.getSelection().getRanges()[0],g=f&&f.startPath();if(f&&f.collapsed){var i=8==e,h=b.editable(),c=new CKEDITOR.dom.walker(f.clone());if(c.evaluator=function(a){return q(a)&&!v(a)},c.guard=function(a,b){return!(b&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("table"))},e=f.clone(),i){var a;(a=g.contains(r))&&f.checkBoundaryOfElement(a,CKEDITOR.START)&&(a=a.getParent())&&a.is("li")&&(a=w(a))?(d=a,a=a.getPrevious(q),e.moveToPosition(a&&v(a)?a:d,CKEDITOR.POSITION_BEFORE_START)):(c.range.setStartAt(h,CKEDITOR.POSITION_AFTER_START),c.range.setEnd(f.startContainer,f.startOffset),(a=c.previous())&&a.type==CKEDITOR.NODE_ELEMENT&&(a.getName()in r||a.is("li"))&&(a.is("li")||(c.range.selectNodeContents(a),c.reset(),c.evaluator=C,a=c.previous()),d=a,e.moveToElementEditEnd(d))),d?(y(b,e,f),k.cancel()):(e=g.contains(r))&&f.checkBoundaryOfElement(e,CKEDITOR.START)&&(d=e.getFirst(q),f.checkBoundaryOfElement(d,CKEDITOR.START)&&(a=e.getPrevious(q),w(d)?a&&(f.moveToElementEditEnd(a),f.select()):b.execCommand("outdent"),k.cancel()))}else(d=g.contains("li"))?(c.range.setEndAt(h,CKEDITOR.POSITION_BEFORE_END),d=(g=d.getLast(q))&&C(g)?g:d,h=0,(a=c.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in r&&a.equals(g)?(h=1,a=c.next()):f.checkBoundaryOfElement(d,CKEDITOR.END)&&(h=1),h&&a&&((f=f.clone()).moveToElementEditStart(a),y(b,e,f),k.cancel())):(c.range.setEndAt(h,CKEDITOR.POSITION_BEFORE_END),(a=c.next())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is(r)&&(a=a.getFirst(q),g.block&&f.checkStartOfBlock()&&f.checkEndOfBlock()?(g.block.remove(),f.moveToElementEditStart(a),f.select()):w(a)?(f.moveToElementEditStart(a),f.select()):((f=f.clone()).moveToElementEditStart(a),y(b,e,f)),k.cancel()));setTimeout(function(){b.selectionChange(1)})}}}))}})}(),CKEDITOR.plugins.add("listblock",{requires:"panel",onLoad:function(){var f=CKEDITOR.addTemplate("panel-list",'<ul role="presentation" class="cke_panel_list">{items}</ul>'),g=CKEDITOR.addTemplate("panel-list-item",'<li id="{id}" class="cke_panel_listItem" role=presentation><a id="{id}_option" _cke_focus=1 hidefocus=true title="{title}" href="javascript:void(\'{val}\')"  {onclick}="CKEDITOR.tools.callFunction({clickFn},\'{val}\'); return false;" role="option">{text}</a></li>'),h=CKEDITOR.addTemplate("panel-list-group",'<h1 id="{id}" class="cke_panel_grouptitle" role="presentation" >{label}</h1>'),i=/\'/g;CKEDITOR.ui.panel.prototype.addListBlock=function(a,b){return this.addBlock(a,new CKEDITOR.ui.listBlock(this.getHolderElement(),b))},CKEDITOR.ui.listBlock=CKEDITOR.tools.createClass({base:CKEDITOR.ui.panel.block,$:function(a,b){var c=(b=b||{}).attributes||(b.attributes={});(this.multiSelect=!!b.multiSelect)&&(c["aria-multiselectable"]=!0),!c.role&&(c.role="listbox"),this.base.apply(this,arguments),this.element.setAttribute("role",c.role),(c=this.keys)[40]="next",c[9]="next",c[38]="prev",c[CKEDITOR.SHIFT+9]="prev",c[32]=CKEDITOR.env.ie?"mouseup":"click",CKEDITOR.env.ie&&(c[13]="mouseup"),this._.pendingHtml=[],this._.pendingList=[],this._.items={},this._.groups={}},_:{close:function(){if(this._.started){var a=f.output({items:this._.pendingList.join("")});this._.pendingList=[],this._.pendingHtml.push(a),delete this._.started}},getClick:function(){return this._.click||(this._.click=CKEDITOR.tools.addFunction(function(a){var b=this.toggle(a);this.onClick&&this.onClick(a,b)},this)),this._.click}},proto:{add:function(a,b,c){var d=CKEDITOR.tools.getNextId();this._.started||(this._.started=1,this._.size=this._.size||0),this._.items[a]=d;a={id:d,val:CKEDITOR.tools.htmlEncodeAttr(a).replace(i,"\\'"),onclick:CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick",clickFn:this._.getClick(),title:CKEDITOR.tools.htmlEncodeAttr(c||a),text:b||a},this._.pendingList.push(g.output(a))},startGroup:function(a){this._.close();var b=CKEDITOR.tools.getNextId();this._.groups[a]=b,this._.pendingHtml.push(h.output({id:b,label:a}))},commit:function(){this._.close(),this.element.appendHtml(this._.pendingHtml.join("")),delete this._.size,this._.pendingHtml=[]},toggle:function(a){var b=this.isMarked(a);return b?this.unmark(a):this.mark(a),!b},hideGroup:function(a){var b=(a=this.element.getDocument().getById(this._.groups[a]))&&a.getNext();a&&(a.setStyle("display","none"),b&&"ul"==b.getName()&&b.setStyle("display","none"))},hideItem:function(a){this.element.getDocument().getById(this._.items[a]).setStyle("display","none")},showAll:function(){var d,a=this._.items,b=this._.groups,c=this.element.getDocument();for(d in a)c.getById(a[d]).setStyle("display","");for(var e in b)a=c.getById(b[e]),d=a.getNext(),a.setStyle("display",""),d&&"ul"==d.getName()&&d.setStyle("display","")},mark:function(a){this.multiSelect||this.unmarkAll();var a=this._.items[a],b=this.element.getDocument().getById(a);b.addClass("cke_selected"),this.element.getDocument().getById(a+"_option").setAttribute("aria-selected",!0),this.onMark&&this.onMark(b)},unmark:function(a){var b=this.element.getDocument(),a=this._.items[a],c=b.getById(a);c.removeClass("cke_selected"),b.getById(a+"_option").removeAttribute("aria-selected"),this.onUnmark&&this.onUnmark(c)},unmarkAll:function(){var c,a=this._.items,b=this.element.getDocument();for(c in a){var d=a[c];b.getById(d).removeClass("cke_selected"),b.getById(d+"_option").removeAttribute("aria-selected")}this.onUnmark&&this.onUnmark()},isMarked:function(a){return this.element.getDocument().getById(this._.items[a]).hasClass("cke_selected")},focus:function(a){this._.focusIndex=-1;var c,b=this.element.getElementsByTag("a"),d=-1;if(a){for(c=this.element.getDocument().getById(this._.items[a]).getFirst();a=b.getItem(++d);)if(a.equals(c)){this._.focusIndex=d;break}}else this.element.focus();c&&setTimeout(function(){c.focus()},0)}}})}}),CKEDITOR.plugins.add("removeformat",{init:function(a){a.addCommand("removeFormat",CKEDITOR.plugins.removeformat.commands.removeformat),a.ui.addButton&&a.ui.addButton("RemoveFormat",{label:a.lang.removeformat.toolbar,command:"removeFormat",toolbar:"cleanup,10"})}}),CKEDITOR.plugins.removeformat={commands:{removeformat:{exec:function(a){for(var c,h=a._.removeFormatRegex||(a._.removeFormatRegex=RegExp("^(?:"+a.config.removeFormatTags.replace(/,/g,"|")+")$","i")),e=a._.removeAttributes||(a._.removeAttributes=a.config.removeFormatAttributes.split(",")),f=CKEDITOR.plugins.removeformat.filter,k=a.getSelection().getRanges(),l=k.createIterator();c=l.getNextRange();){c.collapsed||c.enlarge(CKEDITOR.ENLARGE_ELEMENT);var j=c.createBookmark(),b=j.startNode,d=j.endNode,i=function(b){for(var g,c=a.elementPath(b),e=c.elements,d=1;(g=e[d])&&!g.equals(c.block)&&!g.equals(c.blockLimit);d++)h.test(g.getName())&&f(a,g)&&b.breakParent(g)};if(i(b),d)for(i(d),b=b.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT);b&&!b.equals(d);)if(b.isReadOnly()){if(b.getPosition(d)&CKEDITOR.POSITION_CONTAINS)break;b=b.getNext(function(a){return a.type==CKEDITOR.NODE_ELEMENT})}else i=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT),!("img"==b.getName()&&b.data("cke-realelement"))&&f(a,b)&&(h.test(b.getName())?b.remove(1):(b.removeAttributes(e),a.fire("removeFormatCleanup",b))),b=i;c.moveToBookmark(j)}a.forceNextSelectionCheck(),a.getSelection().selectRanges(k)}}},filter:function(a,h){for(var e=a._.removeFormatFilters||[],f=0;f<e.length;f++)if(!1===e[f](h))return!1;return!0}},CKEDITOR.editor.prototype.addRemoveFormatFilter=function(a){this._.removeFormatFilters||(this._.removeFormatFilters=[]),this._.removeFormatFilters.push(a)},CKEDITOR.config.removeFormatTags="b,big,cite,code,del,dfn,em,font,i,ins,kbd,q,s,samp,small,span,strike,strong,sub,sup,tt,u,var",CKEDITOR.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign",CKEDITOR.plugins.add("richcombo",{requires:"floatpanel,listblock,button",beforeInit:function(d){d.ui.addHandler(CKEDITOR.UI_RICHCOMBO,CKEDITOR.ui.richCombo.handler)}}),function(){d='<span id="{id}" class="cke_combo cke_combo__{name} {cls}" role="presentation"><span id="{id}_label" class="cke_combo_label">{label}</span><a class="cke_combo_button" title="{title}" tabindex="-1"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' hidefocus="true" role="button" aria-labelledby="{id}_label" aria-haspopup="true"';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(d+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(d+=' onblur="this.style.cssText = this.style.cssText;"');var d=d+' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event,this);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" '+(CKEDITOR.env.ie?'onclick="return false;" onmouseup':"onclick")+'="CKEDITOR.tools.callFunction({clickFn},this);return false;"><span id="{id}_text" class="cke_combo_text cke_combo_inlinelabel">{label}</span><span class="cke_combo_open"><span class="cke_combo_arrow">'+(CKEDITOR.env.hc?"&#9660;":CKEDITOR.env.air?"&nbsp;":"")+"</span></span></a></span>",i=CKEDITOR.addTemplate("combo",d);CKEDITOR.UI_RICHCOMBO="richcombo",CKEDITOR.ui.richCombo=CKEDITOR.tools.createClass({$:function(a){CKEDITOR.tools.extend(this,a,{canGroup:!1,title:a.label,modes:{wysiwyg:1},editorFocus:1}),a=this.panel||{},delete this.panel,this.id=CKEDITOR.tools.getNextNumber(),this.document=a.parent&&a.parent.getDocument()||CKEDITOR.document,a.className="cke_combopanel",a.block={multiSelect:a.multiSelect,attributes:a.attributes},a.toolbarRelated=!0,this._={panelDefinition:a,items:{}}},proto:{renderHtml:function(a){var b=[];return this.render(a,b),b.join("")},render:function(a,b){function g(){if(this.getState()!=CKEDITOR.TRISTATE_ON){var c=this.modes[a.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;a.readOnly&&!this.readOnly&&(c=CKEDITOR.TRISTATE_DISABLED),this.setState(c),this.setValue(""),c!=CKEDITOR.TRISTATE_DISABLED&&this.refresh&&this.refresh()}}var d=CKEDITOR.env,h="cke_"+this.id,e=CKEDITOR.tools.addFunction(function(b){j&&(a.unlockSelection(1),j=0),c.execute(b)},this),f=this,c={id:h,combo:this,focus:function(){CKEDITOR.document.getById(h).getChild(1).focus()},execute:function(c){var b=f._;if(b.state!=CKEDITOR.TRISTATE_DISABLED)if(f.createPanel(a),b.on)b.panel.hide();else{f.commit();var d=f.getValue();d?b.list.mark(d):b.list.unmarkAll(),b.panel.showBlock(f.id,new CKEDITOR.dom.element(c),4)}},clickFn:e};a.on("activeFilterChange",g,this),a.on("mode",g,this),a.on("selectionChange",g,this),!this.readOnly&&a.on("readOnly",g,this);var k=CKEDITOR.tools.addFunction(function(b,d){var g=(b=new CKEDITOR.dom.event(b)).getKeystroke();switch(40==g&&a.once("panelShow",function(a){a.data._.panel._.currentBlock.onKeyDown(40)}),g){case 13:case 32:case 40:CKEDITOR.tools.callFunction(e,d);break;default:c.onkey(c,g)}b.preventDefault()}),l=CKEDITOR.tools.addFunction(function(){c.onfocus&&c.onfocus()}),j=0;return c.keyDownFn=k,d={id:h,name:this.name||this.command,label:this.label,title:this.title,cls:this.className||"",titleJs:d.gecko&&!d.hc?"":(this.title||"").replace("'",""),keydownFn:k,focusFn:l,clickFn:e},i.output(d,b),this.onRender&&this.onRender(),c},createPanel:function(a){if(!this._.panel){var b=this._.panelDefinition,d=this._.panelDefinition.block,i=b.parent||CKEDITOR.document.getBody(),h="cke_combopanel__"+this.name,e=new CKEDITOR.ui.floatPanel(a,i,b),f=e.addListBlock(this.id,d),c=this;e.onShow=function(){this.element.addClass(h),c.setState(CKEDITOR.TRISTATE_ON),c._.on=1,c.editorFocus&&!a.focusManager.hasFocus&&a.focus(),c.onOpen&&c.onOpen(),a.once("panelShow",function(){f.focus(!f.multiSelect&&c.getValue())})},e.onHide=function(b){this.element.removeClass(h),c.setState(c.modes&&c.modes[a.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),c._.on=0,!b&&c.onClose&&c.onClose()},e.onEscape=function(){e.hide(1)},f.onClick=function(a,b){c.onClick&&c.onClick.call(c,a,b),e.hide()},this._.panel=e,this._.list=f,e.getBlock(this.id).onHide=function(){c._.on=0,c.setState(CKEDITOR.TRISTATE_OFF)},this.init&&this.init()}},setValue:function(a,b){this._.value=a;var d=this.document.getById("cke_"+this.id+"_text");d&&(a||b?d.removeClass("cke_combo_inlinelabel"):(b=this.label,d.addClass("cke_combo_inlinelabel")),d.setText(void 0!==b?b:a))},getValue:function(){return this._.value||""},unmarkAll:function(){this._.list.unmarkAll()},mark:function(a){this._.list.mark(a)},hideItem:function(a){this._.list.hideItem(a)},hideGroup:function(a){this._.list.hideGroup(a)},showAll:function(){this._.list.showAll()},add:function(a,b,d){this._.items[a]=d||a,this._.list.add(a,b,d)},startGroup:function(a){this._.list.startGroup(a)},commit:function(){this._.committed||(this._.list.commit(),this._.committed=1,CKEDITOR.ui.fire("ready",this)),this._.committed=1},setState:function(a){if(this._.state!=a){var b=this.document.getById("cke_"+this.id);b.setState(a,"cke_combo"),a==CKEDITOR.TRISTATE_DISABLED?b.setAttribute("aria-disabled",!0):b.removeAttribute("aria-disabled"),this._.state=a}},getState:function(){return this._.state},enable:function(){this._.state==CKEDITOR.TRISTATE_DISABLED&&this.setState(this._.lastState)},disable:function(){this._.state!=CKEDITOR.TRISTATE_DISABLED&&(this._.lastState=this._.state,this.setState(CKEDITOR.TRISTATE_DISABLED))}},statics:{handler:{create:function(a){return new CKEDITOR.ui.richCombo(a)}}}}),CKEDITOR.ui.prototype.addRichCombo=function(a,b){this.add(a,CKEDITOR.UI_RICHCOMBO,b)}}(),function(){function f(a,b,c){var d,e=CKEDITOR.document.getById(c);e&&(c=a.fire("uiSpace",{space:b,html:""}).html)&&(a.on("uiSpace",function(a){a.data.space==b&&a.cancel()},null,null,1),d=e.append(CKEDITOR.dom.element.createFromHtml(g.output({id:a.id,name:a.name,langDir:a.lang.dir,langCode:a.langCode,space:b,spaceId:a.ui.spaceId(b),content:c}))),e.getCustomData("cke_hasshared")?d.hide():e.setCustomData("cke_hasshared",1),d.unselectable(),d.on("mousedown",function(a){(a=a.data).getTarget().hasAscendant("a",1)||a.preventDefault()}),a.focusManager.add(d,1),a.on("focus",function(){for(var b,a=0,c=e.getChildren();b=c.getItem(a);a++)b.type==CKEDITOR.NODE_ELEMENT&&!b.equals(d)&&b.hasClass("cke_shared")&&b.hide();d.show()}),a.on("destroy",function(){d.remove()}))}var g=CKEDITOR.addTemplate("sharedcontainer",'<div id="cke_{name}" class="cke {id} cke_reset_all cke_chrome cke_editor_{name} cke_shared cke_detached cke_{langDir} '+CKEDITOR.env.cssClass+'" dir="{langDir}" title="'+(CKEDITOR.env.gecko?" ":"")+'" lang="{langCode}" role="presentation"><div class="cke_inner"><div id="{spaceId}" class="cke_{space}" role="presentation">{content}</div></div></div>');CKEDITOR.plugins.add("sharedspace",{init:function(a){a.on("loaded",function(){var b=a.config.sharedSpaces;if(b)for(var c in b)f(a,c,b[c])},null,null,9)}})}(),function(){function i(c){return{editorFocus:!1,canUndo:!1,modes:{wysiwyg:1},exec:function(d){if(d.editable().hasFocus){var b,e=d.getSelection();if(b=new CKEDITOR.dom.elementPath(e.getCommonAncestor(),e.root).contains({td:1,th:1},1)){e=d.createRange();if((a=CKEDITOR.tools.tryThese(function(){var a=b.getParent().$.cells[b.$.cellIndex+(c?-1:1)];return a.parentNode.parentNode,a},function(){var a=b.getParent();return(a=a.getAscendant("table").$.rows[a.$.rowIndex+(c?-1:1)]).cells[c?a.cells.length-1:0]}))||c){if(!a)return!0;a=new CKEDITOR.dom.element(a),e.moveToElementEditStart(a),(!e.checkStartOfBlock()||!e.checkEndOfBlock())&&e.selectNodeContents(a)}else{for(var f=b.getAscendant("table").$,a=b.getParent().$.cells,f=new CKEDITOR.dom.element(f.insertRow(-1),d.document),g=0,h=a.length;g<h;g++)f.append(new CKEDITOR.dom.element(a[g],d.document).clone(!1,!1)).appendBogus();e.moveToElementEditStart(f)}return e.select(!0),!0}}return!1}}}var h={editorFocus:!1,modes:{wysiwyg:1,source:1}},g={exec:function(c){c.container.focusNext(!0,c.tabIndex)}},f={exec:function(c){c.container.focusPrevious(!0,c.tabIndex)}};CKEDITOR.plugins.add("tab",{init:function(c){for(var d=!1!==c.config.enableTabKeyTools,e=c.config.tabSpaces||0,b="";e--;)b+="";b&&c.on("key",function(a){9==a.data.keyCode&&(c.insertText(b),a.cancel())}),d&&c.on("key",function(a){(9==a.data.keyCode&&c.execCommand("selectNextCell")||a.data.keyCode==CKEDITOR.SHIFT+9&&c.execCommand("selectPreviousCell"))&&a.cancel()}),c.addCommand("blur",CKEDITOR.tools.extend(g,h)),c.addCommand("blurBack",CKEDITOR.tools.extend(f,h)),c.addCommand("selectNextCell",i()),c.addCommand("selectPreviousCell",i(!0))}})}(),CKEDITOR.dom.element.prototype.focusNext=function(i,h){var f,c,d,e,b,a,g=void 0===h?this.getTabIndex():h;if(0>=g)for(b=this.getNextSourceNode(i,CKEDITOR.NODE_ELEMENT);b;){if(b.isVisible()&&0===b.getTabIndex()){d=b;break}b=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT)}else for(b=this.getDocument().getBody().getFirst();b=b.getNextSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!f)if(!c&&b.equals(this)){if(c=!0,i){if(!(b=b.getNextSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;f=1}}else c&&!this.contains(b)&&(f=1);if(b.isVisible()&&!(0>(a=b.getTabIndex()))){if(f&&a==g){d=b;break}a>g&&(!d||!e||a<e)?(d=b,e=a):!d&&0===a&&(d=b,e=a)}}d&&d.focus()},CKEDITOR.dom.element.prototype.focusPrevious=function(i,h){for(var f,c,d,b,g=void 0===h?this.getTabIndex():h,e=0,a=this.getDocument().getBody().getLast();a=a.getPreviousSourceNode(!1,CKEDITOR.NODE_ELEMENT);){if(!f)if(!c&&a.equals(this)){if(c=!0,i){if(!(a=a.getPreviousSourceNode(!0,CKEDITOR.NODE_ELEMENT)))break;f=1}}else c&&!this.contains(a)&&(f=1);if(a.isVisible()&&!(0>(b=a.getTabIndex())))if(0>=g){if(f&&0===b){d=a;break}b>e&&(d=a,e=b)}else{if(f&&b==g){d=a;break}b<g&&(!d||b>e)&&(d=a,e=b)}}d&&d.focus()},CKEDITOR.plugins.add("table",{requires:"dialog",init:function(a){function e(a){return CKEDITOR.tools.extend(a||{},{contextSensitive:1,refresh:function(a,f){this.setState(f.contains("table",1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}if(!a.blockless){var c=a.lang.table;a.addCommand("table",new CKEDITOR.dialogCommand("table",{context:"table",allowedContent:"table{width,height}[align,border,cellpadding,cellspacing,summary];caption tbody thead tfoot;th td tr[scope];"+(a.plugins.dialogadvtab?"table"+a.plugins.dialogadvtab.allowedContent():""),requiredContent:"table",contentTransformations:[["table{width}: sizeToStyle","table[width]: sizeToAttribute"]]})),a.addCommand("tableProperties",new CKEDITOR.dialogCommand("tableProperties",e())),a.addCommand("tableDelete",e({exec:function(a){var b=a.elementPath().contains("table",1);if(b){var d=b.getParent(),c=a.editable();1==d.getChildCount()&&!d.is("td","th")&&!d.equals(c)&&(b=d),(a=a.createRange()).moveToPosition(b,CKEDITOR.POSITION_BEFORE_START),b.remove(),a.select()}}})),a.ui.addButton&&a.ui.addButton("Table",{label:c.toolbar,command:"table",toolbar:"insert,30"}),CKEDITOR.dialog.add("table",this.path+"dialogs/table.js"),CKEDITOR.dialog.add("tableProperties",this.path+"dialogs/table.js"),a.addMenuItems&&a.addMenuItems({table:{label:c.menu,command:"tableProperties",group:"table",order:5},tabledelete:{label:c.deleteTable,command:"tableDelete",group:"table",order:1}}),a.on("doubleclick",function(a){a.data.element.is("table")&&(a.data.dialog="tableProperties")}),a.contextMenu&&a.contextMenu.addListener(function(){return{tabledelete:CKEDITOR.TRISTATE_OFF,table:CKEDITOR.TRISTATE_OFF}})}}}),function(){function p(e){for(var e=e.getRanges(),b=[],c={},a=0;a<e.length;a++){var f=e[a];if(f.collapsed)f=f.getCommonAncestor(),(f=f.getAscendant("td",!0)||f.getAscendant("th",!0))&&b.push(f);else{var g;for((f=new CKEDITOR.dom.walker(f)).guard=function(a){!(0<b.length)&&a.type==CKEDITOR.NODE_ELEMENT&&y.test(a.getName())&&!a.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(c,a,"selected_cell",!0),b.push(a))};g=f.next();)g.type==CKEDITOR.NODE_ELEMENT&&g.is(CKEDITOR.dtd.table)||(g=g.getAscendant("td",!0)||g.getAscendant("th",!0))&&!g.getCustomData("selected_cell")&&(CKEDITOR.dom.element.setMarker(c,g,"selected_cell",!0),b.push(g))}}return CKEDITOR.dom.element.clearAllMarkers(c),b}function o(e,d){for(var a=(c=(b=p(e))[0]).getAscendant("table"),c=c.getDocument(),g=(f=b[0].getParent()).$.rowIndex,h=(b=b[b.length-1]).getParent().$.rowIndex+b.$.rowSpan-1,b=new CKEDITOR.dom.element(a.$.rows[h]),g=d?g:h,f=d?f:b,a=(b=CKEDITOR.tools.buildTableMap(a))[g],g=d?b[g-1]:b[g+1],b=b[0].length,c=c.createElement("tr"),h=0;a[h]&&h<b;h++){var i;1<a[h].rowSpan&&g&&a[h]==g[h]?(i=a[h],i.rowSpan+=1):((i=new CKEDITOR.dom.element(a[h]).clone()).removeAttribute("rowSpan"),i.appendBogus(),c.append(i),i=i.$),h+=i.colSpan-1}d?c.insertBefore(f):c.insertAfter(f)}function q(e){if(e instanceof CKEDITOR.dom.selection){for(var b=(d=p(e))[0].getAscendant("table"),c=CKEDITOR.tools.buildTableMap(b),e=d[0].getParent().$.rowIndex,a=(d=d[d.length-1]).getParent().$.rowIndex+d.$.rowSpan-1,d=[],f=e;f<=a;f++){for(var g=c[f],h=new CKEDITOR.dom.element(b.$.rows[f]),i=0;i<g.length;i++){var j=new CKEDITOR.dom.element(g[i]),l=j.getParent().$.rowIndex;1==j.$.rowSpan?j.remove():(j.$.rowSpan-=1,l==f&&((l=c[f+1])[i-1]?j.insertAfter(new CKEDITOR.dom.element(l[i-1])):new CKEDITOR.dom.element(b.$.rows[f+1]).append(j,1))),i+=j.$.colSpan-1}d.push(h)}for(c=b.$.rows,b=new CKEDITOR.dom.element(c[a+1]||(0<e?c[e-1]:null)||b.$.parentNode),f=d.length;0<=f;f--)q(d[f]);return b}return e instanceof CKEDITOR.dom.element&&(1==(b=e.getAscendant("table")).$.rows.length?b.remove():e.remove()),null}function r(e,d){for(var b=d?1/0:0,c=0;c<e.length;c++){for(var a,f=d,g=(a=e[c]).getParent().$.cells,h=0,i=0;i<g.length;i++){var j=g[i],h=h+(f?1:j.colSpan);if(j==a.$)break}a=h-1,(d?a<b:a>b)&&(b=a)}return b}function k(e,d){for(var c=(b=p(e))[0].getAscendant("table"),a=r(b,1),b=r(b),a=d?a:b,f=CKEDITOR.tools.buildTableMap(c),c=[],b=[],g=f.length,h=0;h<g;h++)c.push(f[h][a]),b.push(d?f[h][a-1]:f[h][a+1]);for(h=0;h<g;h++)c[h]&&(1<c[h].colSpan&&b[h]==c[h]?(a=c[h],a.colSpan+=1):((a=new CKEDITOR.dom.element(c[h]).clone()).removeAttribute("colSpan"),a.appendBogus(),a[d?"insertBefore":"insertAfter"].call(a,new CKEDITOR.dom.element(c[h])),a=a.$),h+=a.rowSpan-1)}function u(e,d){var b=e.getStartElement();if(b=b.getAscendant("td",1)||b.getAscendant("th",1)){var c=b.clone();c.appendBogus(),d?c.insertBefore(b):c.insertAfter(b)}}function t(e){if(e instanceof CKEDITOR.dom.selection){var b,d=(e=p(e))[0]&&e[0].getAscendant("table");a:{var c=0;b=e.length-1;for(var f,g,a={};f=e[c++];)CKEDITOR.dom.element.setMarker(a,f,"delete_cell",!0);for(c=0;f=e[c++];)if((g=f.getPrevious())&&!g.getCustomData("delete_cell")||(g=f.getNext())&&!g.getCustomData("delete_cell")){CKEDITOR.dom.element.clearAllMarkers(a),b=g;break a}CKEDITOR.dom.element.clearAllMarkers(a),(g=(g=e[0].getParent()).getPrevious())?b=g.getLast():(g=e[b].getParent(),b=(g=g.getNext())?g.getChild(0):null)}for(g=e.length-1;0<=g;g--)t(e[g]);b?m(b,!0):d&&d.remove()}else e instanceof CKEDITOR.dom.element&&(1==(d=e.getParent()).getChildCount()?d.remove():e.remove())}function m(e,d){var b=e.getDocument(),c=CKEDITOR.document;CKEDITOR.env.ie&&10==CKEDITOR.env.version&&(c.focus(),b.focus()),(b=new CKEDITOR.dom.range(b))["moveToElementEdit"+(d?"End":"Start")](e)||(b.selectNodeContents(e),b.collapse(!d)),b.select(!0)}function v(e,d,b){if(e=e[d],void 0===b)return e;for(d=0;e&&d<e.length;d++){if(b.is&&e[d]==b.$)return d;if(d==b)return new CKEDITOR.dom.element(e[d])}return b.is?-1:null}function s(e,d,b){var a,c=p(e);if((d?1!=c.length:2>c.length)||(a=e.getCommonAncestor())&&a.type==CKEDITOR.NODE_ELEMENT&&a.is("table"))return!1;var f;a=(e=c[0]).getAscendant("table");var g=CKEDITOR.tools.buildTableMap(a),h=g.length,i=g[0].length,j=e.getParent().$.rowIndex,l=v(g,j,e);if(d){var n;try{m=parseInt(e.getAttribute("rowspan"),10)||1;f=parseInt(e.getAttribute("colspan"),10)||1,n=g["up"==d?j-m:"down"==d?j+m:j]["left"==d?l-f:"right"==d?l+f:l]}catch(z){return!1}if(!n||e.$==n)return!1;c["up"==d||"left"==d?"unshift":"push"](new CKEDITOR.dom.element(n))}for(var d=e.getDocument(),o=j,m=n=0,q=!b&&new CKEDITOR.dom.documentFragment(d),s=0,d=0;d<c.length;d++){var k=(f=c[d]).getParent(),t=f.getFirst(),r=f.$.colSpan,u=f.$.rowSpan,w=v(g,k=k.$.rowIndex,f),s=s+r*u,m=Math.max(m,w-l+r);n=Math.max(n,k-j+u),b||((u=(r=f).getBogus())&&u.remove(),r.trim(),f.getChildren().count()&&(k==o||!t||t.isBlockBoundary&&t.isBlockBoundary({br:1})||(o=q.getLast(CKEDITOR.dom.walker.whitespaces(!0)))&&(!o.is||!o.is("br"))&&q.append("br"),f.moveChildren(q)),d?f.remove():f.setHtml("")),o=k}if(b)return n*m==s;for(q.moveChildren(e),e.appendBogus(),m>=i?e.removeAttribute("rowSpan"):e.$.rowSpan=n,n>=h?e.removeAttribute("colSpan"):e.$.colSpan=m,d=(c=(b=new CKEDITOR.dom.nodeList(a.$.rows)).count())-1;0<=d;d--)(a=b.getItem(d)).$.cells.length||(a.remove(),c++);return e}function w(e,d){var b=p(e);if(1<b.length)return!1;if(d)return!0;var j,a=(c=(b=b[0]).getParent()).getAscendant("table"),h=v(f=CKEDITOR.tools.buildTableMap(a),g=c.$.rowIndex,b);if(1<(i=b.$.rowSpan)){j=Math.ceil(i/2);for(var l,i=Math.floor(i/2),c=g+j,a=new CKEDITOR.dom.element(a.$.rows[c]),f=v(f,c),c=b.clone(),g=0;g<f.length;g++){if((l=f[g]).parentNode==a.$&&g>h){c.insertBefore(new CKEDITOR.dom.element(l));break}l=null}l||a.append(c)}else for(i=j=1,(a=c.clone()).insertAfter(c),a.append(c=b.clone()),l=v(f,g),h=0;h<l.length;h++)l[h].rowSpan++;return c.appendBogus(),b.$.rowSpan=j,c.$.rowSpan=i,1==j&&b.removeAttribute("rowSpan"),1==i&&c.removeAttribute("rowSpan"),c}function x(e,d){var b=p(e);if(1<b.length)return!1;if(d)return!0;var c=(b=b[0]).getParent(),a=c.getAscendant("table"),f=v(a=CKEDITOR.tools.buildTableMap(a),c.$.rowIndex,b);if(1<(g=b.$.colSpan))c=Math.ceil(g/2),g=Math.floor(g/2);else{for(var g=c=1,h=[],i=0;i<a.length;i++){var j=a[i];h.push(j[f]),1<j[f].rowSpan&&(i+=j[f].rowSpan-1)}for(a=0;a<h.length;a++)h[a].colSpan++}return(a=b.clone()).insertAfter(b),a.appendBogus(),b.$.colSpan=c,a.$.colSpan=g,1==c&&b.removeAttribute("colSpan"),1==g&&a.removeAttribute("colSpan"),a}var y=/^(?:td|th)$/;CKEDITOR.plugins.tabletools={requires:"table,dialog,contextmenu",init:function(e){function d(a){return CKEDITOR.tools.extend(a||{},{contextSensitive:1,refresh:function(a,b){this.setState(b.contains({td:1,th:1},1)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)}})}function b(a,b){var c=e.addCommand(a,b);e.addFeature(c)}var c=e.lang.table;b("cellProperties",new CKEDITOR.dialogCommand("cellProperties",d({allowedContent:"td th{width,height,border-color,background-color,white-space,vertical-align,text-align}[colspan,rowspan]",requiredContent:"table"}))),CKEDITOR.dialog.add("cellProperties",this.path+"dialogs/tableCell.js"),b("rowDelete",d({requiredContent:"table",exec:function(a){m(q(a=a.getSelection()))}})),b("rowInsertBefore",d({requiredContent:"table",exec:function(a){o(a=a.getSelection(),!0)}})),b("rowInsertAfter",d({requiredContent:"table",exec:function(a){o(a=a.getSelection())}})),b("columnDelete",d({requiredContent:"table",exec:function(a){for(var e,j,b=(a=p(a=a.getSelection()))[0],c=a[a.length-1],a=b.getAscendant("table"),d=CKEDITOR.tools.buildTableMap(a),l=[],n=0,o=d.length;n<o;n++)for(var k=0,q=d[n].length;k<q;k++)d[n][k]==b.$&&(e=k),d[n][k]==c.$&&(j=k);for(n=e;n<=j;n++)for(k=0;k<d.length;k++)c=d[k],b=new CKEDITOR.dom.element(a.$.rows[k]),(c=new CKEDITOR.dom.element(c[n])).$&&(1==c.$.colSpan?c.remove():c.$.colSpan-=1,k+=c.$.rowSpan-1,b.$.cells.length||l.push(b));j=a.$.rows[0]&&a.$.rows[0].cells,e=new CKEDITOR.dom.element(j[e]||(e?j[e-1]:a.$.parentNode)),l.length==o&&a.remove(),e&&m(e,!0)}})),b("columnInsertBefore",d({requiredContent:"table",exec:function(a){k(a=a.getSelection(),!0)}})),b("columnInsertAfter",d({requiredContent:"table",exec:function(a){k(a=a.getSelection())}})),b("cellDelete",d({requiredContent:"table",exec:function(a){t(a=a.getSelection())}})),b("cellMerge",d({allowedContent:"td[colspan,rowspan]",requiredContent:"td[colspan,rowspan]",exec:function(a){m(s(a.getSelection()),!0)}})),b("cellMergeRight",d({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(a){m(s(a.getSelection(),"right"),!0)}})),b("cellMergeDown",d({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(a){m(s(a.getSelection(),"down"),!0)}})),b("cellVerticalSplit",d({allowedContent:"td[rowspan]",requiredContent:"td[rowspan]",exec:function(a){m(w(a.getSelection()))}})),b("cellHorizontalSplit",d({allowedContent:"td[colspan]",requiredContent:"td[colspan]",exec:function(a){m(x(a.getSelection()))}})),b("cellInsertBefore",d({requiredContent:"table",exec:function(a){u(a=a.getSelection(),!0)}})),b("cellInsertAfter",d({requiredContent:"table",exec:function(a){u(a=a.getSelection())}})),e.addMenuItems&&e.addMenuItems({tablecell:{label:c.cell.menu,group:"tablecell",order:1,getItems:function(){var a=e.getSelection(),b=p(a);return{tablecell_insertBefore:CKEDITOR.TRISTATE_OFF,tablecell_insertAfter:CKEDITOR.TRISTATE_OFF,tablecell_delete:CKEDITOR.TRISTATE_OFF,tablecell_merge:s(a,null,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_right:s(a,"right",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_merge_down:s(a,"down",!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_vertical:w(a,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_split_horizontal:x(a,!0)?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,tablecell_properties:0<b.length?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED}}},tablecell_insertBefore:{label:c.cell.insertBefore,group:"tablecell",command:"cellInsertBefore",order:5},tablecell_insertAfter:{label:c.cell.insertAfter,group:"tablecell",command:"cellInsertAfter",order:10},tablecell_delete:{label:c.cell.deleteCell,group:"tablecell",command:"cellDelete",order:15},tablecell_merge:{label:c.cell.merge,group:"tablecell",command:"cellMerge",order:16},tablecell_merge_right:{label:c.cell.mergeRight,group:"tablecell",command:"cellMergeRight",order:17},tablecell_merge_down:{label:c.cell.mergeDown,group:"tablecell",command:"cellMergeDown",order:18},tablecell_split_horizontal:{label:c.cell.splitHorizontal,group:"tablecell",command:"cellHorizontalSplit",order:19},tablecell_split_vertical:{label:c.cell.splitVertical,group:"tablecell",command:"cellVerticalSplit",order:20},tablecell_properties:{label:c.cell.title,group:"tablecellproperties",command:"cellProperties",order:21},tablerow:{label:c.row.menu,group:"tablerow",order:1,getItems:function(){return{tablerow_insertBefore:CKEDITOR.TRISTATE_OFF,tablerow_insertAfter:CKEDITOR.TRISTATE_OFF,tablerow_delete:CKEDITOR.TRISTATE_OFF}}},tablerow_insertBefore:{label:c.row.insertBefore,group:"tablerow",command:"rowInsertBefore",order:5},tablerow_insertAfter:{label:c.row.insertAfter,group:"tablerow",command:"rowInsertAfter",order:10},tablerow_delete:{label:c.row.deleteRow,group:"tablerow",command:"rowDelete",order:15},tablecolumn:{label:c.column.menu,group:"tablecolumn",order:1,getItems:function(){return{tablecolumn_insertBefore:CKEDITOR.TRISTATE_OFF,tablecolumn_insertAfter:CKEDITOR.TRISTATE_OFF,tablecolumn_delete:CKEDITOR.TRISTATE_OFF}}},tablecolumn_insertBefore:{label:c.column.insertBefore,group:"tablecolumn",command:"columnInsertBefore",order:5},tablecolumn_insertAfter:{label:c.column.insertAfter,group:"tablecolumn",command:"columnInsertAfter",order:10},tablecolumn_delete:{label:c.column.deleteColumn,group:"tablecolumn",command:"columnDelete",order:15}}),e.contextMenu&&e.contextMenu.addListener(function(a,b,c){return(a=c.contains({td:1,th:1},1))&&!a.isReadOnly()?{tablecell:CKEDITOR.TRISTATE_OFF,tablerow:CKEDITOR.TRISTATE_OFF,tablecolumn:CKEDITOR.TRISTATE_OFF}:null})},getSelectedCells:p},CKEDITOR.plugins.add("tabletools",CKEDITOR.plugins.tabletools)}(),CKEDITOR.tools.buildTableMap=function(p){for(var p=p.$.rows,o=-1,q=[],r=0;r<p.length;r++){!q[++o]&&(q[o]=[]);for(var k=-1,u=0;u<p[r].cells.length;u++){t=p[r].cells[u];for(k++;q[o][k];)k++;for(var m=isNaN(t.colSpan)?1:t.colSpan,t=isNaN(t.rowSpan)?1:t.rowSpan,v=0;v<t;v++){q[o+v]||(q[o+v]=[]);for(var s=0;s<m;s++)q[o+v][k+s]=p[r].cells[u]}k+=m-1}}return q},function(){function t(a){return CKEDITOR.env.ie?a.$.clientWidth:parseInt(a.getComputedStyle("width"),10)}function n(a,h){var b=a.getComputedStyle("border-"+h+"-width"),j={thin:"0px",medium:"1px",thick:"2px"};return 0>b.indexOf("px")&&(b=b in j&&"none"!=a.getComputedStyle("border-style")?j[b]:0),parseInt(b,10)}function w(a){for(var c,g,d,e,h=[],b=-1,j="rtl"==a.getComputedStyle("direction"),p=0,i=0,o=(c=a.$.rows).length;i<o;i++)e=c[i],(g=e.cells.length)>p&&(p=g,d=e);for(c=d,g=(p=new CKEDITOR.dom.element(a.$.tBodies[0])).getDocumentPosition(),d=0,e=c.cells.length;d<e;d++){var k,f,i=new CKEDITOR.dom.element(c.cells[d]),o=c.cells[d+1]&&new CKEDITOR.dom.element(c.cells[d+1]),b=b+(i.$.colSpan||1),l=i.getDocumentPosition().x;j?f=l+n(i,"left"):k=l+i.$.offsetWidth-n(i,"right"),o?(l=o.getDocumentPosition().x,j?k=l+o.$.offsetWidth-n(o,"right"):f=l+n(o,"left")):(l=a.getDocumentPosition().x,j?k=l:f=l+a.$.offsetWidth),i=Math.max(f-k,3),h.push({table:a,index:b,x:k,y:g.y,width:i,height:p.$.offsetHeight,rtl:j})}return h}function u(a){(a.data||a).preventDefault()}function A(a){function h(){i=0,e.setOpacity(0),k&&b();var v=g.table;setTimeout(function(){v.removeCustomData("_cke_table_pillars")},0),d.removeListener("dragstart",u)}function b(){for(var v=g.rtl,a=v?l.length:x.length,c=0;c<a;c++){var b=x[c],d=l[c],e=g.table;CKEDITOR.tools.setTimeout(function(a,c,b,d,g,j){a&&a.setStyle("width",f(Math.max(c+j,1))),b&&b.setStyle("width",f(Math.max(d-j,1))),g&&e.setStyle("width",f(g+j*(v?-1:1)))},0,this,[b,b&&t(b),d,d&&t(d),(!b||!d)&&t(e)+n(e,"left")+n(e,"right"),k])}}function j(a){u(a);for(var a=g.index,b=CKEDITOR.tools.buildTableMap(g.table),j=[],h=[],f=Number.MAX_VALUE,n=f,s=g.rtl,r=0,w=b.length;r<w;r++){var q=(m=b[r])[a+(s?1:0)],m=m[a+(s?0:1)],q=q&&new CKEDITOR.dom.element(q),m=m&&new CKEDITOR.dom.element(m);q&&m&&q.equals(m)||(q&&(f=Math.min(f,t(q))),m&&(n=Math.min(n,t(m))),j.push(q),h.push(m))}x=j,l=h,y=g.x-f,z=g.x+n,e.setOpacity(.5),o=parseInt(e.getStyle("left"),10),k=0,i=1,e.on("mousemove",p),d.on("dragstart",u),d.on("mouseup",c,this)}function c(a){a.removeListener(),h()}function p(a){r(a.data.getPageOffset().x)}var g,d,e,i,o,k,x,l,y,z;d=a.document,e=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',d),a.on("destroy",function(){e.remove()}),s||d.getDocumentElement().append(e),this.attachTo=function(a){i||(s&&(d.getBody().append(e),k=0),g=a,e.setStyles({width:f(a.width),height:f(a.height),left:f(a.x),top:f(a.y)}),s&&e.setOpacity(.25),e.on("mousedown",j,this),d.getBody().setStyle("cursor","col-resize"),e.show())};var r=this.move=function(a){if(!g)return 0;if(!i&&(a<g.x||a>g.x+g.width))return g=null,i=k=0,d.removeListener("mouseup",c),e.removeListener("mousedown",j),e.removeListener("mousemove",p),d.getBody().setStyle("cursor","auto"),s?e.remove():e.hide(),0;if(a-=Math.round(e.$.offsetWidth/2),i){if(a==y||a==z)return 1;a=Math.max(a,y),a=Math.min(a,z),k=a-o}return e.setStyle("left",f(a)),1}}function r(a){var h=a.data.getTarget();if("mouseout"==a.name){if(!h.is("table"))return;for(var b=new CKEDITOR.dom.element(a.data.$.relatedTarget||a.data.$.toElement);b&&b.$&&!b.equals(h)&&!b.is("body");)b=b.getParent();if(!b||b.equals(h))return}h.getAscendant("table",1).removeCustomData("_cke_table_pillars"),a.removeListener()}var f=CKEDITOR.tools.cssLength,s=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks);CKEDITOR.plugins.add("tableresize",{requires:"tabletools",init:function(a){a.on("contentDom",function(){var h,b=a.editable();b.attachListener(b.isInline()?b:a.document,"mousemove",function(b){if((c=(b=b.data).getTarget()).type==CKEDITOR.NODE_ELEMENT){var f=b.getPageOffset().x;if(h&&h.move(f))u(b);else if((c.is("table")||c.getAscendant("tbody",1))&&(c=c.getAscendant("table",1),a.editable().contains(c))){(b=c.getCustomData("_cke_table_pillars"))||(c.setCustomData("_cke_table_pillars",b=w(c)),c.on("mouseout",r),c.on("mousedown",r));a:{for(var c=0,g=b.length;c<g;c++){var d=b[c];if(f>=d.x&&f<=d.x+d.width){f=d;break a}}f=null}f&&(!h&&(h=new A(a)),h.attachTo(f))}}})})}})}(),function(){function w(a){function g(){var c,f,e,b={};for(c in a.ui.items)f=a.ui.items[c],e=f.toolbar||"others",e=e.split(","),f=e[0],e=parseInt(e[1]||-1,10),b[f]||(b[f]=[]),b[f].push({name:c,order:e});for(f in b)b[f]=b[f].sort(function(b,a){return b.order==a.order?0:0>a.order?-1:0>b.order?1:b.order<a.order?-1:1});return b}function c(c,e){if(e.length){c.items?c.items.push(a.ui.create("-")):c.items=[];for(var f;f=e.shift();)f="string"==typeof f?f:f.name,b&&-1!=CKEDITOR.tools.indexOf(b,f)||(f=a.ui.create(f))&&a.addFeature(f)&&c.items.push(f)}}var b=(b=a.config.removeButtons)&&b.split(","),e=a.config.toolbar;return"string"==typeof e&&(e=a.config["toolbar_"+e]),a.toolbar=e?function(b){var e,d,h,a=[];for(e=0;e<b.length;++e)d=b[e],h={},"/"==d?a.push(d):CKEDITOR.tools.isArray(d)?(c(h,CKEDITOR.tools.clone(d)),a.push(h)):d.items&&(c(h,CKEDITOR.tools.clone(d.items)),h.name=d.name,a.push(h));return a}(e):function(){for(var b=g(),e=CKEDITOR.tools.clone(a.config.toolbarGroups)||n(a),f=0;f<e.length;f++){var k=e[f];if("/"!=k){"string"==typeof k&&(k=e[f]={name:k});var i,d=k.groups;if(d)for(var h=0;h<d.length;h++)i=d[h],(i=b[i])&&c(k,i);(i=b[k.name])&&c(k,i)}}return e}()}function n(a){return a._.toolbarGroups||(a._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var u=function(){this.toolbars=[],this.focusCommandExecuted=!1};u.prototype.focus=function(){for(var d,a=0;d=this.toolbars[a++];)for(var c,g=0;c=d.items[g++];)if(c.focus)return void c.focus()};var x={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(a){a.toolbox&&(a.toolbox.focusCommandExecuted=!0,CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout(function(){a.toolbox.focus()},100):a.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(a){var d,g=function(c,h){var b,e="rtl"==a.lang.dir,j=a.config.toolbarGroupCycling,o=e?37:39,e=e?39:37,j=void 0===j||j;switch(h){case 9:case CKEDITOR.SHIFT+9:for(;!b||!b.items.length;)if((b=9==h?(b?b.next:c.toolbar.next)||a.toolbox.toolbars[0]:(b?b.previous:c.toolbar.previous)||a.toolbox.toolbars[a.toolbox.toolbars.length-1]).items.length)for(c=b.items[d?b.items.length-1:0];c&&!c.focus;)(c=d?c.previous:c.next)||(b=0);return c&&c.focus(),!1;case o:b=c;do{!(b=b.next)&&j&&(b=c.toolbar.items[0])}while(b&&!b.focus);return b?b.focus():g(c,9),!1;case 40:return c.button&&c.button.hasArrow?(a.once("panelShow",function(b){b.data._.panel._.currentBlock.onKeyDown(40)}),c.execute()):g(c,40==h?o:e),!1;case e:case 38:b=c;do{!(b=b.previous)&&j&&(b=c.toolbar.items[c.toolbar.items.length-1])}while(b&&!b.focus);return b?b.focus():(d=1,g(c,CKEDITOR.SHIFT+9),d=0),!1;case 27:return a.focus(),!1;case 13:case 32:return c.execute(),!1}return!0};a.on("uiSpace",function(c){if(c.data.space==a.config.toolbarLocation){c.removeListener(),a.toolbox=new u;var e,j,b=['<span id="',d=CKEDITOR.tools.getNextId(),'" class="cke_voice_label">',a.lang.toolbar.toolbars,"</span>",'<span id="'+a.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',d,'" onmousedown="return false;">'],d=!1!==a.config.toolbarStartupExpanded;a.config.toolbarCanCollapse&&a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&b.push('<span class="cke_toolbox_main"'+(d?">":' style="display:none">'));for(var o=a.toolbox.toolbars,f=w(a),k=0;k<f.length;k++){var i,r,s,l=0,m=f[k];if(m)if(e&&(b.push("</span>"),j=e=0),"/"===m)b.push('<span class="cke_toolbar_break"></span>');else{s=m.items||m;for(var t=0;t<s.length;t++){var n,p=s[t];if(p)if(p.type==CKEDITOR.UI_SEPARATOR)j=e&&p;else{if(n=!1!==p.canGroup,!l){i=CKEDITOR.tools.getNextId(),l={id:i,items:[]},r=m.name&&(a.lang.toolbar.toolbarGroups[m.name]||m.name),b.push('<span id="',i,'" class="cke_toolbar"',r?' aria-labelledby="'+i+'_label"':"",' role="toolbar">'),r&&b.push('<span id="',i,'_label" class="cke_voice_label">',r,"</span>"),b.push('<span class="cke_toolbar_start"></span>');var q=o.push(l)-1;0<q&&(l.previous=o[q-1],l.previous.next=l)}n?e||(b.push('<span class="cke_toolgroup" role="presentation">'),e=1):e&&(b.push("</span>"),e=0),i=function(c){c=c.render(a,b),(q=l.items.push(c)-1)>0&&(c.previous=l.items[q-1],c.previous.next=c),c.toolbar=l,c.onkey=g,c.onfocus=function(){a.toolbox.focusCommandExecuted||a.focus()}},j&&(i(j),j=0),i(p)}}e&&(b.push("</span>"),j=e=0),l&&b.push('<span class="cke_toolbar_end"></span></span>')}}if(a.config.toolbarCanCollapse&&b.push("</span>"),a.config.toolbarCanCollapse&&a.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var v=CKEDITOR.tools.addFunction(function(){a.execCommand("toolbarCollapse")});a.on("destroy",function(){CKEDITOR.tools.removeFunction(v)}),a.addCommand("toolbarCollapse",{readOnly:1,exec:function(b){var a=b.ui.space("toolbar_collapser"),c=a.getPrevious(),e=b.ui.space("contents"),d=c.getParent(),f=parseInt(e.$.style.height,10),h=d.$.offsetHeight,g=a.hasClass("cke_toolbox_collapser_min");g?(c.show(),a.removeClass("cke_toolbox_collapser_min"),a.setAttribute("title",b.lang.toolbar.toolbarCollapse)):(c.hide(),a.addClass("cke_toolbox_collapser_min"),a.setAttribute("title",b.lang.toolbar.toolbarExpand)),a.getFirst().setText(g?"":""),e.setStyle("height",f-(d.$.offsetHeight-h)+"px"),b.fire("resize")},modes:{wysiwyg:1,source:1}}),a.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse"),b.push('<a title="'+(d?a.lang.toolbar.toolbarCollapse:a.lang.toolbar.toolbarExpand)+'" id="'+a.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser'),d||b.push(" cke_toolbox_collapser_min"),b.push('" onclick="CKEDITOR.tools.callFunction('+v+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}b.push("</span>"),c.data.html+=b.join("")}}),a.on("destroy",function(){if(this.toolbox){var a,b,e,g,d=0;for(a=this.toolbox.toolbars;d<a.length;d++)for(e=a[d].items,b=0;b<e.length;b++)(g=e[b]).clickFn&&CKEDITOR.tools.removeFunction(g.clickFn),g.keyDownFn&&CKEDITOR.tools.removeFunction(g.keyDownFn)}}),a.on("uiReady",function(){var c=a.ui.space("toolbox");c&&a.focusManager.add(c,1)}),a.addCommand("toolbarFocus",x),a.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus"),a.ui.add("-",CKEDITOR.UI_SEPARATOR,{}),a.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(a,d){return d.push('<span class="cke_toolbar_separator" role="separator"></span>'),{}}}}})}}),CKEDITOR.ui.prototype.addToolbarGroup=function(a,d,g){var c=n(this.editor),h=0===d,b={name:a};if(g){if(g=CKEDITOR.tools.search(c,function(a){return a.name==g}))return!g.groups&&(g.groups=[]),d&&0<=(d=CKEDITOR.tools.indexOf(g.groups,d))?void g.groups.splice(d+1,0,a):void(h?g.groups.splice(0,0,a):g.groups.push(a));d=null}d&&(d=CKEDITOR.tools.indexOf(c,function(a){return a.name==d})),h?c.splice(0,0,a):"number"==typeof d?c.splice(d+1,0,b):c.push(a)}}(),CKEDITOR.UI_SEPARATOR="separator",CKEDITOR.config.toolbarLocation="top",function(){var g=[CKEDITOR.CTRL+90,CKEDITOR.CTRL+89,CKEDITOR.CTRL+CKEDITOR.SHIFT+90],l={8:1,46:1};CKEDITOR.plugins.add("undo",{init:function(a){function b(a){d.enabled&&!1!==a.data.command.canUndo&&d.save()}function c(){d.enabled=!a.readOnly&&"wysiwyg"==a.mode,d.onChange()}var d=a.undoManager=new e(a),j=d.editingHandler=new i(d),f=a.addCommand("undo",{exec:function(){d.undo()&&(a.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),h=a.addCommand("redo",{exec:function(){d.redo()&&(a.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1});a.setKeystroke([[g[0],"undo"],[g[1],"redo"],[g[2],"redo"]]),d.onChange=function(){f.setState(d.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),h.setState(d.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},a.on("beforeCommandExec",b),a.on("afterCommandExec",b),a.on("saveSnapshot",function(a){d.save(a.data&&a.data.contentOnly)}),a.on("contentDom",j.attachListeners,j),a.on("instanceReady",function(){a.fire("saveSnapshot")}),a.on("beforeModeUnload",function(){"wysiwyg"==a.mode&&d.save(!0)}),a.on("mode",c),a.on("readOnly",c),a.ui.addButton&&(a.ui.addButton("Undo",{label:a.lang.undo.undo,command:"undo",toolbar:"undo,10"}),a.ui.addButton("Redo",{label:a.lang.undo.redo,command:"redo",toolbar:"undo,20"})),a.resetUndo=function(){d.reset(),a.fire("saveSnapshot")},a.on("updateSnapshot",function(){d.currentImage&&d.update()}),a.on("lockSnapshot",function(a){a=a.data,d.lock(a&&a.dontUpdate,a&&a.forceUpdate)}),a.on("unlockSnapshot",d.unlock,d)}}),CKEDITOR.plugins.undo={};var e=CKEDITOR.plugins.undo.UndoManager=function(a){this.strokesRecorded=[0,0],this.locked=null,this.previousKeyGroup=-1,this.limit=a.config.undoStackSize||20,this.strokesLimit=25,this.editor=a,this.reset()};e.prototype={type:function(a,b){var c=e.getKeyGroup(a),d=this.strokesRecorded[c]+1,b=b||d>=this.strokesLimit;this.typing||(this.hasUndo=this.typing=!0,this.hasRedo=!1,this.onChange()),b?(d=0,this.editor.fire("saveSnapshot")):this.editor.fire("change"),this.strokesRecorded[c]=d,this.previousKeyGroup=c},keyGroupChanged:function(a){return e.getKeyGroup(a)!=this.previousKeyGroup},reset:function(){this.snapshots=[],this.index=-1,this.currentImage=null,this.hasRedo=this.hasUndo=!1,this.locked=null,this.resetType()},resetType:function(){this.strokesRecorded=[0,0],this.typing=!1,this.previousKeyGroup=-1},refreshState:function(){this.hasUndo=!!this.getNextImage(!0),this.hasRedo=!!this.getNextImage(!1),this.resetType(),this.onChange()},save:function(a,b,c){var d=this.editor;if(this.locked||"ready"!=d.status||"wysiwyg"!=d.mode)return!1;var e=d.editable();if(!e||"ready"!=e.status)return!1;if(e=this.snapshots,b||(b=new f(d)),!1===b.contents)return!1;if(this.currentImage)if(b.equalsContent(this.currentImage)){if(a||b.equalsSelection(this.currentImage))return!1}else!1!==c&&d.fire("change");return e.splice(this.index+1,e.length-this.index-1),e.length==this.limit&&e.shift(),this.index=e.push(b)-1,this.currentImage=b,!1!==c&&this.refreshState(),!0},restoreImage:function(a){var c,b=this.editor;a.bookmarks&&(b.focus(),c=b.getSelection()),this.locked={level:999},this.editor.loadSnapshot(a.contents),a.bookmarks?c.selectBookmarks(a.bookmarks):CKEDITOR.env.ie&&((c=this.editor.document.getBody().$.createTextRange()).collapse(!0),c.select()),this.locked=null,this.index=a.index,this.currentImage=this.snapshots[this.index],this.update(),this.refreshState(),b.fire("change")},getNextImage:function(a){var d,b=this.snapshots,c=this.currentImage;if(c)if(a){for(d=this.index-1;0<=d;d--)if(a=b[d],!c.equalsContent(a))return a.index=d,a}else for(d=this.index+1;d<b.length;d++)if(a=b[d],!c.equalsContent(a))return a.index=d,a;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var a=this.getNextImage(!0);if(a)return this.restoreImage(a),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var a=this.getNextImage(!1);if(a)return this.restoreImage(a),!0}return!1},update:function(a){if(!this.locked){a||(a=new f(this.editor));for(var b=this.index,c=this.snapshots;0<b&&this.currentImage.equalsContent(c[b-1]);)b-=1;c.splice(b,this.index-b+1,a),this.index=b,this.currentImage=a}},updateSelection:function(a){if(!this.snapshots.length)return!1;var b=this.snapshots,c=b[b.length-1];return!(!c.equalsContent(a)||c.equalsSelection(a))&&(this.currentImage=b[b.length-1]=a,!0)},lock:function(a,b){if(this.locked)this.locked.level++;else if(a)this.locked={level:1};else{var c=null;if(b)c=!0;else{var d=new f(this.editor,!0);this.currentImage&&this.currentImage.equalsContent(d)&&(c=d)}this.locked={update:c,level:1}}},unlock:function(){if(this.locked&&!--this.locked.level){var a=this.locked.update;if(this.locked=null,!0===a)this.update();else if(a){var b=new f(this.editor,!0);a.equalsContent(b)||this.update()}}}},e.navigationKeyCodes={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1},e.keyGroups={PRINTABLE:0,FUNCTIONAL:1},e.isNavigationKey=function(a){return!!e.navigationKeyCodes[a]},e.getKeyGroup=function(a){var b=e.keyGroups;return l[a]?b.FUNCTIONAL:b.PRINTABLE},e.getOppositeKeyGroup=function(a){var b=e.keyGroups;return a==b.FUNCTIONAL?b.PRINTABLE:b.FUNCTIONAL},e.ieFunctionalKeysBug=function(a){return CKEDITOR.env.ie&&e.getKeyGroup(a)==e.keyGroups.FUNCTIONAL};var f=CKEDITOR.plugins.undo.Image=function(a,b){this.editor=a,a.fire("beforeUndoImage");var c=a.getSnapshot();CKEDITOR.env.ie&&c&&(c=c.replace(/\s+data-cke-expando=".*?"/g,"")),this.contents=c,b||(this.bookmarks=(c=c&&a.getSelection())&&c.createBookmarks2(!0)),a.fire("afterUndoImage")},h=/\b(?:href|src|name)="[^"]*?"/gi;f.prototype={equalsContent:function(a){var b=this.contents,a=a.contents;return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)&&(b=b.replace(h,""),a=a.replace(h,"")),b==a},equalsSelection:function(a){var b=this.bookmarks,a=a.bookmarks;if(b||a){if(!b||!a||b.length!=a.length)return!1;for(var c=0;c<b.length;c++){var d=b[c],e=a[c];if(d.startOffset!=e.startOffset||d.endOffset!=e.endOffset||!CKEDITOR.tools.arrayCompare(d.start,e.start)||!CKEDITOR.tools.arrayCompare(d.end,e.end))return!1}}return!0}};var i=CKEDITOR.plugins.undo.NativeEditingHandler=function(a){this.undoManager=a,this.ignoreInputEvent=!1,this.keyEventsStack=new k,this.lastKeydownImage=null};i.prototype={onKeydown:function(a){var b=a.data.getKey();229!==b&&(-1<CKEDITOR.tools.indexOf(g,a.data.getKeystroke())?a.data.preventDefault():(this.keyEventsStack.cleanUp(a),a=this.undoManager,this.keyEventsStack.getLast(b)||this.keyEventsStack.push(b),this.lastKeydownImage=new f(a.editor),(e.isNavigationKey(b)||this.undoManager.keyGroupChanged(b))&&(a.strokesRecorded[0]||a.strokesRecorded[1])&&(a.save(!1,this.lastKeydownImage,!1),a.resetType())))},onInput:function(){if(this.ignoreInputEvent)this.ignoreInputEvent=!1;else{var a=this.keyEventsStack.getLast();a||(a=this.keyEventsStack.push(0)),this.keyEventsStack.increment(a.keyCode),this.keyEventsStack.getTotalInputs()>=this.undoManager.strokesLimit&&(this.undoManager.type(a.keyCode,!0),this.keyEventsStack.resetInputs())}},onKeyup:function(a){var b=this.undoManager,a=a.data.getKey(),c=this.keyEventsStack.getTotalInputs();this.keyEventsStack.remove(a),e.ieFunctionalKeysBug(a)&&this.lastKeydownImage&&this.lastKeydownImage.equalsContent(new f(b.editor,!0))||(0<c?b.type(a):e.isNavigationKey(a)&&this.onNavigationKey(!0))},onNavigationKey:function(a){var b=this.undoManager;(a||!b.save(!0,null,!1))&&b.updateSelection(new f(b.editor)),b.resetType()},ignoreInputEventListener:function(){this.ignoreInputEvent=!0},attachListeners:function(){var a=this.undoManager.editor,b=a.editable(),c=this;b.attachListener(b,"keydown",function(a){c.onKeydown(a),e.ieFunctionalKeysBug(a.data.getKey())&&c.onInput()},null,null,999),b.attachListener(b,CKEDITOR.env.ie?"keypress":"input",c.onInput,c,null,999),b.attachListener(b,"keyup",c.onKeyup,c,null,999),b.attachListener(b,"paste",c.ignoreInputEventListener,c,null,999),b.attachListener(b,"drop",c.ignoreInputEventListener,c,null,999),b.attachListener(b.isInline()?b:a.document.getDocumentElement(),"click",function(){c.onNavigationKey()},null,null,999),b.attachListener(this.undoManager.editor,"blur",function(){c.keyEventsStack.remove(9)},null,null,999)}};var k=CKEDITOR.plugins.undo.KeyEventsStack=function(){this.stack=[]};k.prototype={push:function(a){return this.stack[this.stack.push({keyCode:a,inputs:0})-1]},getLastIndex:function(a){if("number"!=typeof a)return this.stack.length-1;for(var b=this.stack.length;b--;)if(this.stack[b].keyCode==a)return b;return-1},getLast:function(a){return-1!=(a=this.getLastIndex(a))?this.stack[a]:null},increment:function(a){this.getLast(a).inputs++},remove:function(a){-1!=(a=this.getLastIndex(a))&&this.stack.splice(a,1)},resetInputs:function(a){if("number"==typeof a)this.getLast(a).inputs=0;else for(a=this.stack.length;a--;)this.stack[a].inputs=0},getTotalInputs:function(){for(var a=this.stack.length,b=0;a--;)b+=this.stack[a].inputs;return b},cleanUp:function(a){!(a=a.data.$).ctrlKey&&!a.metaKey&&this.remove(17),a.shiftKey||this.remove(16),a.altKey||this.remove(18)}}}(),function(){function k(a){var e=this.editor,b=a.document,c=b.body,d=b.getElementById("cke_actscrpt");d&&d.parentNode.removeChild(d),(d=b.getElementById("cke_shimscrpt"))&&d.parentNode.removeChild(d),(d=b.getElementById("cke_basetagscrpt"))&&d.parentNode.removeChild(d),c.contentEditable=!0,CKEDITOR.env.ie&&(c.hideFocus=!0,c.disabled=!0,c.removeAttribute("disabled")),delete this._.isLoadingData,this.$=c,b=new CKEDITOR.dom.document(b),this.setup(),this.fixInitialSelection(),CKEDITOR.env.ie&&(b.getDocumentElement().addClass(b.$.compatMode),e.config.enterMode!=CKEDITOR.ENTER_P&&this.attachListener(b,"selectionchange",function(){var a=b.getBody(),c=e.getSelection(),d=c&&c.getRanges()[0];d&&a.getHtml().match(/^<p>(?:&nbsp;|<br>)<\/p>$/i)&&d.startContainer.equals(a)&&setTimeout(function(){(d=e.getSelection().getRanges()[0]).startContainer.equals("body")||(a.getFirst().remove(1),d.moveToElementEditEnd(a),d.select())},0)})),(CKEDITOR.env.webkit||CKEDITOR.env.ie&&10<CKEDITOR.env.version)&&b.getDocumentElement().on("mousedown",function(a){a.data.getTarget().is("html")&&setTimeout(function(){e.editable().focus()})}),l(e);try{e.document.$.execCommand("2D-position",!1,!0)}catch(g){}(CKEDITOR.env.gecko||CKEDITOR.env.ie&&"CSS1Compat"==e.document.$.compatMode)&&this.attachListener(this,"keydown",function(a){var b=a.data.getKeystroke();if(33==b||34==b)if(CKEDITOR.env.ie)setTimeout(function(){e.getSelection().scrollIntoView()},0);else if(e.window.$.innerHeight>this.$.offsetHeight){var c=e.createRange();c[33==b?"moveToElementEditStart":"moveToElementEditEnd"](this),c.select(),a.data.preventDefault()}}),CKEDITOR.env.ie&&this.attachListener(b,"blur",function(){try{b.$.selection.empty()}catch(a){}}),CKEDITOR.env.iOS&&this.attachListener(b,"touchend",function(){a.focus()}),(c=e.document.getElementsByTag("title").getItem(0)).data("cke-title",c.getText()),CKEDITOR.env.ie&&(e.document.$.title=this._.docTitle),CKEDITOR.tools.setTimeout(function(){"unloaded"==this.status&&(this.status="ready"),e.fire("contentDom"),this._.isPendingFocus&&(e.focus(),this._.isPendingFocus=!1),setTimeout(function(){e.fire("dataReady")},0),CKEDITOR.env.ie&&setTimeout(function(){if(e.document){var a=e.document.$.body;a.runtimeStyle.marginBottom="0px",a.runtimeStyle.marginBottom=""}},1e3)},0,this)}function l(a){function b(a){a.returnValue=!1}if(CKEDITOR.env.gecko)try{var c=a.document.$;c.execCommand("enableObjectResizing",!1,!a.config.disableObjectResizing),c.execCommand("enableInlineTableEditing",!1,!a.config.disableNativeTableHandles)}catch(d){}else CKEDITOR.env.ie&&11>CKEDITOR.env.version&&a.config.disableObjectResizing&&function(){var c;a.editable().attachListener(a,"selectionChange",function(){var d=a.getSelection().getSelectedElement();d&&(c&&(c.detachEvent("onresizestart",b),c=null),d.$.attachEvent("onresizestart",b),c=d.$)})}()}function m(){var a=[];if(8<=CKEDITOR.document.$.documentMode){a.push("html.CSS1Compat [contenteditable=false]{min-height:0 !important}");var b,e=[];for(b in CKEDITOR.dtd.$removeEmpty)e.push("html.CSS1Compat "+b+"[contenteditable=false]");a.push(e.join(",")+"{display:inline-block}")}else CKEDITOR.env.gecko&&(a.push("html{height:100% !important}"),a.push("img:-moz-broken{-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}"));return a.push("html{cursor:text;*cursor:auto}"),a.push("img,input,textarea{cursor:default}"),a.join("\n")}CKEDITOR.plugins.add("wysiwygarea",{init:function(a){a.config.fullPage&&a.addFeature({allowedContent:"html head title; style [media,type]; body (*)[id]; meta link [*]",requiredContent:"body"}),a.addMode("wysiwyg",function(e){function b(b){b&&b.removeListener(),a.editable(new j(a,d.$.contentWindow.document.body)),a.setData(a.getData(1),e)}var c="document.open();"+(CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"")+"document.close();",c=CKEDITOR.env.air?"javascript:void(0)":CKEDITOR.env.ie?"javascript:void(function(){"+encodeURIComponent(c)+"}())":"",d=CKEDITOR.dom.element.createFromHtml('<iframe src="'+c+'" frameBorder="0"></iframe>');d.setStyles({width:"100%",height:"100%"}),d.addClass("cke_wysiwyg_frame cke_reset");var g=a.ui.space("contents");g.append(d),(c=CKEDITOR.env.ie||CKEDITOR.env.gecko)&&d.on("load",b);var f=a.title,h=a.fire("ariaEditorHelpLabel",{}).label;if(f&&(CKEDITOR.env.ie&&h&&(f+=", "+h),d.setAttribute("title",f)),h){var f=CKEDITOR.tools.getNextId(),i=CKEDITOR.dom.element.createFromHtml('<span id="'+f+'" class="cke_voice_label">'+h+"</span>");g.append(i,1),d.setAttribute("aria-describedby",f)}a.on("beforeModeUnload",function(a){a.removeListener(),i&&i.remove()}),d.setAttributes({tabIndex:a.tabIndex,allowTransparency:"true"}),!c&&b(),CKEDITOR.env.webkit&&(c=function(){g.setStyle("width","100%"),d.hide(),d.setSize("width",g.getSize("width")),g.removeStyle("width"),d.show()},d.setCustomData("onResize",c),CKEDITOR.document.getWindow().on("resize",c)),a.fire("ariaWidget",d)})}}),CKEDITOR.editor.prototype.addContentsCss=function(a){var e=this.config,b=e.contentsCss;CKEDITOR.tools.isArray(b)||(e.contentsCss=b?[b]:[]),e.contentsCss.push(a)};var j=CKEDITOR.tools.createClass({$:function(){this.base.apply(this,arguments),this._.frameLoadedHandler=CKEDITOR.tools.addFunction(function(a){CKEDITOR.tools.setTimeout(k,0,this,a)},this),this._.docTitle=this.getWindow().getFrame().getAttribute("title")},base:CKEDITOR.editable,proto:{setData:function(a,e){var b=this.editor;if(e)this.setHtml(a),this.fixInitialSelection(),b.fire("dataReady");else{this._.isLoadingData=!0,b._.dataStore={id:1};var c=b.config,d=c.fullPage,g=c.docType,f=CKEDITOR.tools.buildStyleHtml(m()).replace(/<style>/,'<style data-cke-temp="1">');d||(f+=CKEDITOR.tools.buildStyleHtml(b.config.contentsCss));var h=c.baseHref?'<base href="'+c.baseHref+'" data-cke-temp="1" />':"";d&&(a=a.replace(/<!DOCTYPE[^>]*>/i,function(a){return b.docType=g=a,""}).replace(/<\?xml\s[^\?]*\?>/i,function(a){return b.xmlDeclaration=a,""})),a=b.dataProcessor.toHtml(a),d?(/<body[\s|>]/.test(a)||(a="<body>"+a),/<html[\s|>]/.test(a)||(a="<html>"+a+"</html>"),/<head[\s|>]/.test(a)?/<title[\s|>]/.test(a)||(a=a.replace(/<head[^>]*>/,"$&<title></title>")):a=a.replace(/<html[^>]*>/,"$&<head><title></title></head>"),h&&(a=a.replace(/<head[^>]*?>/,"$&"+h)),a=a.replace(/<\/head\s*>/,f+"$&"),a=g+a):a=c.docType+'<html dir="'+c.contentsLangDirection+'" lang="'+(c.contentsLanguage||b.langCode)+'"><head><title>'+this._.docTitle+"</title>"+h+f+"</head><body"+(c.bodyId?' id="'+c.bodyId+'"':"")+(c.bodyClass?' class="'+c.bodyClass+'"':"")+">"+a+"</body></html>",CKEDITOR.env.gecko&&(a=a.replace(/<body/,'<body contenteditable="true" '),2e4>CKEDITOR.env.version&&(a=a.replace(/<body[^>]*>/,"$&\x3c!-- cke-content-start --\x3e"))),c='<script id="cke_actscrpt" type="text/javascript"'+(CKEDITOR.env.ie?' defer="defer" ':"")+">var wasLoaded=0;function onload(){if(!wasLoaded)window.parent.CKEDITOR.tools.callFunction("+this._.frameLoadedHandler+",window);wasLoaded=1;}"+(CKEDITOR.env.ie?"onload();":'document.addEventListener("DOMContentLoaded", onload, false );')+"<\/script>",CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(c+='<script id="cke_shimscrpt">window.parent.CKEDITOR.tools.enableHtml5Elements(document)<\/script>'),h&&CKEDITOR.env.ie&&10>CKEDITOR.env.version&&(c+='<script id="cke_basetagscrpt">var baseTag = document.querySelector( "base" );baseTag.href = baseTag.href;<\/script>'),a=a.replace(/(?=\s*<\/(:?head)>)/,c),this.clearCustomData(),this.clearListeners(),b.fire("contentDomUnload");var i=this.getDocument();try{i.write(a)}catch(j){setTimeout(function(){i.write(a)},0)}}},getData:function(a){if(a)return this.getHtml();var e=(a=this.editor).config,c=(b=e.fullPage)&&a.docType,d=b&&a.xmlDeclaration,g=this.getDocument(),b=b?g.getDocumentElement().getOuterHtml():g.getBody().getHtml();return CKEDITOR.env.gecko&&e.enterMode!=CKEDITOR.ENTER_BR&&(b=b.replace(/<br>(?=\s*(:?$|<\/body>))/,"")),b=a.dataProcessor.toDataFormat(b),d&&(b=d+"\n"+b),c&&(b=c+"\n"+b),b},focus:function(){this._.isLoadingData?this._.isPendingFocus=!0:j.baseProto.focus.call(this)},detach:function(){var e=(a=this.editor).document,a=a.window.getFrame();j.baseProto.detach.call(this),this.clearCustomData(),e.getDocumentElement().clearCustomData(),a.clearCustomData(),CKEDITOR.tools.removeFunction(this._.frameLoadedHandler),(e=a.removeCustomData("onResize"))&&e.removeListener(),a.remove()}}})}(),CKEDITOR.config.disableObjectResizing=!1,CKEDITOR.config.disableNativeTableHandles=!0,CKEDITOR.config.disableNativeSpellChecker=!0,CKEDITOR.config.contentsCss=CKEDITOR.getUrl("contents.css"),CKEDITOR.config.plugins="basicstyles,button,panel,floatpanel,menu,contextmenu,dialogui,dialog,divarea,enterkey,entities,indent,indentblock,indentlist,list,listblock,removeformat,richcombo,sharedspace,tab,table,tabletools,tableresize,toolbar,undo,wysiwygarea",CKEDITOR.config.skin="moono",function(){var setIcons=function(icons,strip){var path=CKEDITOR.getUrl("plugins/"+strip);icons=icons.split(",");for(var i=0;i<icons.length;i++)CKEDITOR.skin.icons[icons[i]]={path:path,offset:-icons[++i],bgsize:icons[++i]}};CKEDITOR.env.hidpi?setIcons("bold,0,,italic,24,,strike,48,,subscript,72,,superscript,96,,underline,120,,indent-rtl,144,,indent,168,,outdent-rtl,192,,outdent,216,,bulletedlist-rtl,240,,bulletedlist,264,,numberedlist-rtl,288,,numberedlist,312,,removeformat,336,,table,360,,redo-rtl,384,,redo,408,,undo-rtl,432,,undo,456,","icons_hidpi.png"):setIcons("bold,0,auto,italic,24,auto,strike,48,auto,subscript,72,auto,superscript,96,auto,underline,120,auto,indent-rtl,144,auto,indent,168,auto,outdent-rtl,192,auto,outdent,216,auto,bulletedlist-rtl,240,auto,bulletedlist,264,auto,numberedlist-rtl,288,auto,numberedlist,312,auto,removeformat,336,auto,table,360,auto,redo-rtl,384,auto,redo,408,auto,undo-rtl,432,auto,undo,456,auto","icons.png")}(),CKEDITOR.lang.languages={en:1,es:1}),CKEDITOR.lang.en={editor:"Rich Text Editor",editorPanel:"Rich Text Editor panel",common:{editorHelp:"Press ALT 0 for help",browseServer:"Browse Server",url:"URL",protocol:"Protocol",upload:"Upload",uploadSubmit:"Send it to the Server",image:"Image",flash:"Flash",form:"Form",checkbox:"Checkbox",radio:"Radio Button",textField:"Text Field",textarea:"Textarea",hiddenField:"Hidden Field",button:"Button",select:"Selection Field",imageButton:"Image Button",notSet:"<not set>",id:"Id",name:"Name",langDir:"Language Direction",langDirLtr:"Left to Right (LTR)",langDirRtl:"Right to Left (RTL)",langCode:"Language Code",longDescr:"Long Description URL",cssClass:"Stylesheet Classes",advisoryTitle:"Advisory Title",cssStyle:"Style",ok:"OK",cancel:"Cancel",close:"Close",preview:"Preview",resize:"Resize",generalTab:"General",advancedTab:"Advanced",validateNumberFailed:"This value is not a number.",confirmNewPage:"Any unsaved changes to this content will be lost. Are you sure you want to load new page?",confirmCancel:"You have changed some options. Are you sure you want to close the dialog window?",options:"Options",target:"Target",targetNew:"New Window (_blank)",targetTop:"Topmost Window (_top)",targetSelf:"Same Window (_self)",targetParent:"Parent Window (_parent)",langDirLTR:"Left to Right (LTR)",langDirRTL:"Right to Left (RTL)",styles:"Style",cssClasses:"Stylesheet Classes",width:"Width",height:"Height",align:"Alignment",alignLeft:"Left",alignRight:"Right",alignCenter:"Center",alignJustify:"Justify",alignTop:"Top",alignMiddle:"Middle",alignBottom:"Bottom",alignNone:"None",invalidValue:"Invalid value.",invalidHeight:"Height must be a number.",invalidWidth:"Width must be a number.",invalidCssLength:'Value specified for the "%1" field must be a positive number with or without a valid CSS measurement unit (px, %, in, cm, mm, em, ex, pt, or pc).',invalidHtmlLength:'Value specified for the "%1" field must be a positive number with or without a valid HTML measurement unit (px or %).',invalidInlineStyle:'Value specified for the inline style must consist of one or more tuples with the format of "name : value", separated by semi-colons.',cssLengthTooltip:"Enter a number for a value in pixels or a number with a valid CSS unit (px, %, in, cm, mm, em, ex, pt, or pc).",unavailable:'%1<span class="cke_accessibility">, unavailable</span>'},basicstyles:{bold:"Bold",italic:"Italic",strike:"Strikethrough",subscript:"Subscript",superscript:"Superscript",underline:"Underline"},button:{selectedLabel:"%1 (Selected)"},contextmenu:{options:"Context Menu Options"},indent:{indent:"Increase Indent",outdent:"Decrease Indent"},list:{bulletedlist:"Insert/Remove Bulleted List",numberedlist:"Insert/Remove Numbered List"},removeformat:{toolbar:"Remove Format"},table:{border:"Border size",caption:"Caption",cell:{menu:"Cell",insertBefore:"Insert Cell Before",insertAfter:"Insert Cell After",deleteCell:"Delete Cells",merge:"Merge Cells",mergeRight:"Merge Right",mergeDown:"Merge Down",splitHorizontal:"Split Cell Horizontally",splitVertical:"Split Cell Vertically",title:"Cell Properties",cellType:"Cell Type",rowSpan:"Rows Span",colSpan:"Columns Span",wordWrap:"Word Wrap",hAlign:"Horizontal Alignment",vAlign:"Vertical Alignment",alignBaseline:"Baseline",bgColor:"Background Color",borderColor:"Border Color",data:"Data",header:"Header",yes:"Yes",no:"No",invalidWidth:"Cell width must be a number.",invalidHeight:"Cell height must be a number.",invalidRowSpan:"Rows span must be a whole number.",invalidColSpan:"Columns span must be a whole number.",chooseColor:"Choose"},cellPad:"Cell padding",cellSpace:"Cell spacing",column:{menu:"Column",insertBefore:"Insert Column Before",insertAfter:"Insert Column After",deleteColumn:"Delete Columns"},columns:"Columns",deleteTable:"Delete Table",headers:"Headers",headersBoth:"Both",headersColumn:"First column",headersNone:"None",headersRow:"First Row",invalidBorder:"Border size must be a number.",invalidCellPadding:"Cell padding must be a positive number.",invalidCellSpacing:"Cell spacing must be a positive number.",invalidCols:"Number of columns must be a number greater than 0.",invalidHeight:"Table height must be a number.",invalidRows:"Number of rows must be a number greater than 0.",invalidWidth:"Table width must be a number.",menu:"Table Properties",row:{menu:"Row",insertBefore:"Insert Row Before",insertAfter:"Insert Row After",deleteRow:"Delete Rows"},rows:"Rows",summary:"Summary",title:"Table Properties",toolbar:"Table",widthPc:"percent",widthPx:"pixels",widthUnit:"width unit"},toolbar:{toolbarCollapse:"Collapse Toolbar",toolbarExpand:"Expand Toolbar",toolbarGroups:{document:"Document",clipboard:"Clipboard/Undo",editing:"Editing",forms:"Forms",basicstyles:"Basic Styles",paragraph:"Paragraph",links:"Links",insert:"Insert",styles:"Styles",colors:"Colors",tools:"Tools"},toolbars:"Editor toolbars"},undo:{redo:"Redo",undo:"Undo"}},CKEDITOR.stylesSet.add("default",[{name:"Italic Title",element:"h2",styles:{"font-style":"italic"}},{name:"Subtitle",element:"h3",styles:{color:"#aaa","font-style":"italic"}},{name:"Special Container",element:"div",styles:{padding:"5px 10px",background:"#eee",border:"1px solid #ccc"}},{name:"Marker",element:"span",attributes:{class:"marker"}},{name:"Big",element:"big"},{name:"Small",element:"small"},{name:"Typewriter",element:"tt"},{name:"Computer Code",element:"code"},{name:"Keyboard Phrase",element:"kbd"},{name:"Sample Text",element:"samp"},{name:"Variable",element:"var"},{name:"Deleted Text",element:"del"},{name:"Inserted Text",element:"ins"},{name:"Cited Work",element:"cite"},{name:"Inline Quotation",element:"q"},{name:"Language: RTL",element:"span",attributes:{dir:"rtl"}},{name:"Language: LTR",element:"span",attributes:{dir:"ltr"}},{name:"Styled image (left)",element:"img",attributes:{class:"left"}},{name:"Styled image (right)",element:"img",attributes:{class:"right"}},{name:"Compact table",element:"table",attributes:{cellpadding:"5",cellspacing:"0",border:"1",bordercolor:"#ccc"},styles:{"border-collapse":"collapse"}},{name:"Borderless Table",element:"table",styles:{"border-style":"hidden","background-color":"#E6E6FA"}},{name:"Square Bulleted List",element:"ul",styles:{"list-style-type":"square"}}]),function(){function r(a){for(var m,e=0,l=0,k=0,g=a.$.rows.length;k<g;k++){for(var c,d=e=0,b=(m=a.$.rows[k]).cells.length;d<b;d++)c=m.cells[d],e+=c.colSpan;e>l&&(l=e)}return l}function o(a){return function(){var e=this.getValue();return(e=!!(CKEDITOR.dialog.validate.integer()(e)&&0<e))||(alert(a),this.select()),e}}function n(a,e){var l=function(g){return new CKEDITOR.dom.element(g,a.document)},n=a.editable(),m=a.plugins.dialogadvtab;return{title:a.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var g=this,a=g.getContentElement("advanced","advStyles");a&&a.on("change",function(){var a=this.getStyle("width",""),b=g.getContentElement("info","txtWidth");b&&b.setValue(a,!0),a=this.getStyle("height",""),(b=g.getContentElement("info","txtHeight"))&&b.setValue(a,!0)})},onShow:function(){var c,g=a.getSelection(),d=g.getRanges(),b=this.getContentElement("info","txtRows"),h=this.getContentElement("info","txtCols"),p=this.getContentElement("info","txtWidth"),f=this.getContentElement("info","txtHeight");"tableProperties"==e&&((g=g.getSelectedElement())&&g.is("table")?c=g:0<d.length&&(CKEDITOR.env.webkit&&d[0].shrink(CKEDITOR.NODE_ELEMENT),c=a.elementPath(d[0].getCommonAncestor(!0)).contains("table",1)),this._.selectedElement=c),c?(this.setupContent(c),b&&b.disable(),h&&h.disable()):(b&&b.enable(),h&&h.enable()),p&&p.onChange(),f&&f.onChange()},onOk:function(){var g=a.getSelection(),d=this._.selectedElement&&g.createBookmarks(),c=this._.selectedElement||l("table"),b={};if(this.commitContent(b,c),b.info){if(b=b.info,!this._.selectedElement)for(var h=c.append(l("tbody")),e=parseInt(b.txtRows,10)||0,f=parseInt(b.txtCols,10)||0,i=0;i<e;i++)for(var j=h.append(l("tr")),k=0;k<f;k++)j.append(l("td")).appendBogus();if(e=b.selHeaders,!c.$.tHead&&("row"==e||"both"==e)){for(j=new CKEDITOR.dom.element(c.$.createTHead()),h=(h=c.getElementsByTag("tbody").getItem(0)).getElementsByTag("tr").getItem(0),i=0;i<h.getChildCount();i++)(f=h.getChild(i)).type==CKEDITOR.NODE_ELEMENT&&!f.data("cke-bookmark")&&(f.renameNode("th"),f.setAttribute("scope","col"));j.append(h.remove())}if(null!==c.$.tHead&&"row"!=e&&"both"!=e){for(j=new CKEDITOR.dom.element(c.$.tHead),k=(h=c.getElementsByTag("tbody").getItem(0)).getFirst();0<j.getChildCount();){for(h=j.getFirst(),i=0;i<h.getChildCount();i++)(f=h.getChild(i)).type==CKEDITOR.NODE_ELEMENT&&(f.renameNode("td"),f.removeAttribute("scope"));h.insertBefore(k)}j.remove()}if(!this.hasColumnHeaders&&("col"==e||"both"==e))for(j=0;j<c.$.rows.length;j++)(f=new CKEDITOR.dom.element(c.$.rows[j].cells[0])).renameNode("th"),f.setAttribute("scope","row");if(this.hasColumnHeaders&&"col"!=e&&"both"!=e)for(i=0;i<c.$.rows.length;i++)"tbody"==(j=new CKEDITOR.dom.element(c.$.rows[i])).getParent().getName()&&((f=new CKEDITOR.dom.element(j.$.cells[0])).renameNode("td"),f.removeAttribute("scope"));b.txtHeight?c.setStyle("height",b.txtHeight):c.removeStyle("height"),b.txtWidth?c.setStyle("width",b.txtWidth):c.removeStyle("width"),c.getAttribute("style")||c.removeAttribute("style")}if(this._.selectedElement)try{g.selectBookmarks(d)}catch(m){}else a.insertElement(c),setTimeout(function(){var g=new CKEDITOR.dom.element(c.$.rows[0].cells[0]),b=a.createRange();b.moveToPosition(g,CKEDITOR.POSITION_AFTER_START),b.select()},0)},contents:[{id:"info",label:a.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows",default:3,label:a.lang.table.rows,required:!0,controlStyle:"width:5em",validate:o(a.lang.table.invalidRows),setup:function(a){this.setValue(a.$.rows.length)},commit:k},{type:"text",id:"txtCols",default:2,label:a.lang.table.columns,required:!0,controlStyle:"width:5em",validate:o(a.lang.table.invalidCols),setup:function(a){this.setValue(r(a))},commit:k},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders",requiredContent:"th",default:"",label:a.lang.table.headers,items:[[a.lang.table.headersNone,""],[a.lang.table.headersRow,"row"],[a.lang.table.headersColumn,"col"],[a.lang.table.headersBoth,"both"]],setup:function(a){var d=this.getDialog();d.hasColumnHeaders=!0;for(var c=0;c<a.$.rows.length;c++){var b=a.$.rows[c].cells[0];if(b&&"th"!=b.nodeName.toLowerCase()){d.hasColumnHeaders=!1;break}}null!==a.$.tHead?this.setValue(d.hasColumnHeaders?"both":"row"):this.setValue(d.hasColumnHeaders?"col":"")},commit:k},{type:"text",id:"txtBorder",requiredContent:"table[border]",default:a.filter.check("table[border]")?1:0,label:a.lang.table.border,controlStyle:"width:3em",validate:CKEDITOR.dialog.validate.number(a.lang.table.invalidBorder),setup:function(a){this.setValue(a.getAttribute("border")||"")},commit:function(a,d){this.getValue()?d.setAttribute("border",this.getValue()):d.removeAttribute("border")}},{id:"cmbAlign",type:"select",requiredContent:"table[align]",default:"",label:a.lang.common.align,items:[[a.lang.common.notSet,""],[a.lang.common.alignLeft,"left"],[a.lang.common.alignCenter,"center"],[a.lang.common.alignRight,"right"]],setup:function(a){this.setValue(a.getAttribute("align")||"")},commit:function(a,d){this.getValue()?d.setAttribute("align",this.getValue()):d.removeAttribute("align")}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",requiredContent:"table{width}",controlStyle:"width:5em",label:a.lang.common.width,title:a.lang.common.cssLengthTooltip,default:a.filter.check("table{width}")?500>n.getSize("width")?"100%":500:0,getValue:q,validate:CKEDITOR.dialog.validate.cssLength(a.lang.common.invalidCssLength.replace("%1",a.lang.common.width)),onChange:function(){var a=this.getDialog().getContentElement("advanced","advStyles");a&&a.updateStyle("width",this.getValue())},setup:function(a){this.setValue(a.getStyle("width"))},commit:k}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",requiredContent:"table{height}",controlStyle:"width:5em",label:a.lang.common.height,title:a.lang.common.cssLengthTooltip,default:"",getValue:q,validate:CKEDITOR.dialog.validate.cssLength(a.lang.common.invalidCssLength.replace("%1",a.lang.common.height)),onChange:function(){var a=this.getDialog().getContentElement("advanced","advStyles");a&&a.updateStyle("height",this.getValue())},setup:function(a){(a=a.getStyle("height"))&&this.setValue(a)},commit:k}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",requiredContent:"table[cellspacing]",controlStyle:"width:3em",label:a.lang.table.cellSpace,default:a.filter.check("table[cellspacing]")?1:0,validate:CKEDITOR.dialog.validate.number(a.lang.table.invalidCellSpacing),setup:function(a){this.setValue(a.getAttribute("cellSpacing")||"")},commit:function(a,d){this.getValue()?d.setAttribute("cellSpacing",this.getValue()):d.removeAttribute("cellSpacing")}},{type:"text",id:"txtCellPad",requiredContent:"table[cellpadding]",controlStyle:"width:3em",label:a.lang.table.cellPad,default:a.filter.check("table[cellpadding]")?1:0,validate:CKEDITOR.dialog.validate.number(a.lang.table.invalidCellPadding),setup:function(a){this.setValue(a.getAttribute("cellPadding")||"")},commit:function(a,d){this.getValue()?d.setAttribute("cellPadding",this.getValue()):d.removeAttribute("cellPadding")}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",requiredContent:"caption",label:a.lang.table.caption,setup:function(a){if(this.enable(),0<(a=a.getElementsByTag("caption")).count()){var d=(a=a.getItem(0)).getFirst(CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT));d&&!d.equals(a.getBogus())?(this.disable(),this.setValue(a.getText())):(a=CKEDITOR.tools.trim(a.getText()),this.setValue(a))}},commit:function(e,d){if(this.isEnabled()){var c=this.getValue(),b=d.getElementsByTag("caption");if(c)0<b.count()?(b=b.getItem(0)).setHtml(""):(b=new CKEDITOR.dom.element("caption",a.document),d.getChildCount()?b.insertBefore(d.getFirst()):b.appendTo(d)),b.append(new CKEDITOR.dom.text(c,a.document));else if(0<b.count())for(c=b.count()-1;0<=c;c--)b.getItem(c).remove()}}},{type:"text",id:"txtSummary",requiredContent:"table[summary]",label:a.lang.table.summary,setup:function(a){this.setValue(a.getAttribute("summary")||"")},commit:function(a,d){this.getValue()?d.setAttribute("summary",this.getValue()):d.removeAttribute("summary")}}]}]},m&&m.createAdvancedTab(a,null,"table")]}}var q=CKEDITOR.tools.cssLength,k=function(a){var e=this.id;a.info||(a.info={}),a.info[e]=this.getValue()};CKEDITOR.dialog.add("table",function(a){return n(a,"table")}),CKEDITOR.dialog.add("tableProperties",function(a){return n(a,"tableProperties")})}(),function(CKEDITOR){function createSpellCheck(editor){editor.spellCheck||(editor.spellCheck=new SpellCheck(SpellCheckManager,editor.contentDom),$(editor.contentDom).click(function(evt){editor.commands.spellchecker.enabled&&$(evt.target).hasClass("spellcheck-word")&&clickedWord(editor,evt)}))}function disableSpellChecks(){Util.Object.values(CKEDITOR.instances).forEach(function(editor){var cmdSC=editor.commands.spellchecker;cmdSC.enabled&&cmdSC.exec()})}function resetSelection(editor){editor.getSelection().removeAllRanges();var range=editor.createRange();range.moveToPosition(range.root.getFirst()?range.root.getFirst():range.root,CKEDITOR.POSITION_AFTER_START),editor.getSelection().selectRanges([range])}function enableSpellCheck(editor){if(!this.enabled){console.log('SpellCheck Enabled "'+editor.name+'": '+this.language),resetSelection(editor),disableSpellChecks(),this.enabled=!0,createSpellCheck(editor),SpellCheckManager.setLanguage(this.language),Util.Dom.blur(editor.contentDom),editor.setReadOnly(!0);var bookmarks=editor.getSelection().createBookmarks2();editor.spellCheck.check(),editor.getSelection().selectBookmarks(bookmarks),this.setState(CKEDITOR.TRISTATE_ON)}}function disableSpellCheck(editor){if(this.enabled){console.log('SpellCheck Disabled "'+editor.name+'"'),resetSelection(editor),this.enabled=!1;var bookmarks=editor.getSelection().createBookmarks2();editor.spellCheck.done(),editor.getSelection().selectBookmarks(bookmarks),editor.setReadOnly(!1),this.setState(CKEDITOR.TRISTATE_OFF),editor.focusManager.hasFocus&&Util.Dom.blur(editor.contentDom),setTimeout(function(){Util.Dom.focus(editor.contentDom)},0)}}function replaceWord(editor,node,word,replacement){editor.spellCheck.replaceWord(node,word,replacement)}function clickedWord(editor,evt){var node=evt.target,word=Util.Dom.getTextContent(node);if(word){var suggestions=SpellCheckManager.getSuggestions(word),menuItems=[];if(suggestions.length>0)for(var i=0;i<suggestions.length;i++){var suggestion=suggestions[i];menuItems.push({text:suggestion,onclick:{fn:replaceWord.bind(null,editor,node,word,suggestion)}})}else menuItems.push({text:"No suggestions"});var menuXY=YUD.getXY(node);menuXY=ContentManager.getEventXY(evt,menuXY);var region=YAHOO.util.Region.getRegion(node);menuXY[1]+=region.height,ContentManager.Menu.show({custom:menuItems,evt:evt,xy:menuXY})}}function initLanguages(editor){var lookup={ESN:"Espaol",ENU:"English"},languages=window.ContentManager?ContentManager.getAccommodationProperties().getLanguages():["ENU","ESN"],defaultLang=window.ContentManager?ContentManager.getAccommodationProperties().getLanguage():"ENU";-1!=languages.indexOf("ESN")&&-1==languages.indexOf("ENU")&&languages.push("ENU"),-1!=languages.indexOf("ENU-Braille")&&(-1==languages.indexOf("ENU")&&languages.push("ENU"),"ENU-Braille"==defaultLang&&(defaultLang="ENU"));var cmdSC=editor.commands.spellchecker;cmdSC.language=defaultLang,languages.length>1&&(editor.ui.addRichCombo("Languages",{toolbar:"spellchecker,20",label:lookup[defaultLang],value:defaultLang,onClick:function(selectedLang){this.setValue(selectedLang,lookup[selectedLang]),this.label=lookup[selectedLang],cmdSC.language=selectedLang},panel:{css:[CKEDITOR.skin.getPath("editor")].concat(editor.config.contentsCss),multiSelect:!1,attributes:{"aria-label":"Spellcheck language",name:"Languages"}},init:function(){this.startGroup("Language");for(var i=0;i<languages.length;++i)lookup[languages[i]]&&this.add(languages[i],lookup[languages[i]]);this.commit()}}),editor.accessibility&&editor.on("panelHide",function(e){var editor=e.editor;if("Languages"===e.data._.definition.attributes.name){var elEditor=editor.element.$,$Editor=$(elEditor);setTimeout(function(){editor.execCommand("toolbarFocus"),$Editor.find(".cke_combo__languages a").focus()},0)}}))}var cmdName="spellchecker";CKEDITOR.plugins.add("spellchecker",{requires:"richcombo",config:{parser:"html"},init:function(editor){editor.addCommand(cmdName,{canUndo:!0,async:!1,modes:{wysiwyg:1,spellcheck:1},exec:function(){this.enabled?disableSpellCheck.call(this,editor):enableSpellCheck.call(this,editor)},enabled:!1}),editor.ui.addButton("SpellChecker",{label:"SpellCheck",icon:"spellchecker",command:cmdName,toolbar:"spellchecker,10"});if(initLanguages(editor),editor.contextMenu){var spellcheckOn=!1;editor.config.toolbar.forEach(function(elements){elements.forEach(function(element){"SpellChecker"==element&&(spellcheckOn=!0)})}),spellcheckOn&&(editor.addMenuGroup("spellCheckGroup"),editor.addMenuItem("spellCheckItem",{label:"Spell Check",icon:"spellchecker",command:cmdName,group:"spellCheckGroup"})),editor.contextMenu.addListener(function(element){return{spellCheckItem:CKEDITOR.TRISTATE_ON}})}}})}(CKEDITOR),function(){"use strict";function initClipboard(editor){function pasteHtml(){if(BUFFER){var rng=editor.getSelection().getRanges();rng&&rng.length>0&&editor.insertHtml(BUFFER,"html")}}function cutCopyHtml(type){var sel=editor.getSelection(),rng=sel.getRanges();if(rng&&0!=rng.length){var contents;"cut"==type?contents=rng[0].extractContents():(contents=rng[0].cloneContents(),sel.selectRanges(rng));var commonParent=rng[0].getCommonAncestor(),parentNodes=[];if(commonParent){(commonParent=commonParent.$).nodeType===Util.Dom.NodeType.TEXT&&(commonParent=commonParent.parentNode);for(var tableCellContent=!1;!tableCellContent&&!YUD.hasClass(commonParent,"cke_editable");){switch(commonParent.tagName.toLowerCase()){case"strong":case"em":case"u":parentNodes.push(commonParent);break;case"td":tableCellContent=!0}commonParent=commonParent.parentNode}}if(parentNodes.length>0){for(var bufferRoot=document.createDocumentFragment(),bufferNode=bufferRoot,nodeIndex=parentNodes.length-1;nodeIndex>=0;--nodeIndex)bufferNode.appendChild(parentNodes[nodeIndex].cloneNode(!1)),bufferNode=bufferNode.firstChild;bufferNode.appendChild(contents.$.cloneNode(!0)),contents.$=bufferRoot}var div=document.createElement("div");div.appendChild(contents.$),BUFFER=div.innerHTML,setToolbarStates()}}function isSelectionReadOnly(selection){var rng=selection.getRanges();return!(rng&&rng[0]&&rng[0].checkReadOnly)||rng[0].checkReadOnly()}function addListenersToEditable(){var mouseupTimeout,editable=editor.editable();editable.attachListener(CKEDITOR.env.ie?editable:editor.document.getDocumentElement(),"mouseup",function(){clearTimeout(mouseupTimeout),mouseupTimeout=setTimeout(function(){setToolbarStates()},0)}),"ontouchend"in window&&editable.attachListener(CKEDITOR.env.ie?editable:editor.document.getDocumentElement(),"touchend",function(){clearTimeout(mouseupTimeout),mouseupTimeout=setTimeout(function(){setToolbarStates()},0)}),editor.on("destroy",function(){clearTimeout(mouseupTimeout)}),editable.on("keyup",setToolbarStates)}function createCutCopyCmd(type){return{type:type,canUndo:"cut"==type,startDisabled:!0,exec:function(data){cutCopyHtml(type)}}}function createPasteCmd(){return{canUndo:!1,startDisabled:!0,exec:function(){pasteHtml()}}}function onKey(event){if("wysiwyg"==editor.mode)switch(event.data.keyCode){case CKEDITOR.CTRL+86:return pasteHtml(),void event.cancel();case CKEDITOR.CTRL+67:return cutCopyHtml("copy"),void event.cancel();case CKEDITOR.CTRL+88:return editor.fire("saveSnapshot"),cutCopyHtml("cut"),void event.cancel()}}function setToolbarStates(){"wysiwyg"==editor.mode&&(editor.getCommand("cut").setState(stateFromNamedCommand("Cut")),editor.getCommand("copy").setState(stateFromNamedCommand("Copy")),editor.getCommand("paste").setState(stateFromNamedCommand("Paste")))}function stateFromNamedCommand(command){if(editor.readOnly)return CKEDITOR.TRISTATE_DISABLED;if(inReadOnly&&command in{Paste:1,Cut:1})return CKEDITOR.TRISTATE_DISABLED;if("Paste"==command)return BUFFER?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED;var sel=editor.getSelection(),ranges=sel.getRanges();return sel.getType()==CKEDITOR.SELECTION_NONE||1==ranges.length&&ranges[0].collapsed?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF}var BUFFER=null,inReadOnly=0;editor.on("key",onKey),editor.on("contentDom",addListenersToEditable),editor.on("selectionChange",function(evt){inReadOnly=isSelectionReadOnly(evt.data.selection),setToolbarStates()}),editor.contextMenu&&editor.contextMenu.addListener(function(element,selection){return inReadOnly=isSelectionReadOnly(selection),{cut:stateFromNamedCommand("Cut"),copy:stateFromNamedCommand("Copy"),paste:stateFromNamedCommand("Paste")}}),function(){function addButtonCommand(buttonName,commandName,command,toolbarOrder,ctxMenuOrder){var lang=editor.lang.clipboard[commandName];editor.addCommand(commandName,command),editor.ui.addButton&&editor.ui.addButton(buttonName,{label:lang,command:commandName,toolbar:"clipboard,"+toolbarOrder}),editor.addMenuItems&&editor.addMenuItem(commandName,{label:lang,command:commandName,group:"clipboard",order:ctxMenuOrder})}addButtonCommand("Cut","cut",createCutCopyCmd("cut"),10,1),addButtonCommand("Copy","copy",createCutCopyCmd("copy"),20,4),addButtonCommand("Paste","paste",createPasteCmd(),30,8)}()}CKEDITOR.plugins.add("clipboard",{requires:"dialog",icons:"copy,cut,paste",init:function(editor){initClipboard(editor)}})}(),CKEDITOR.plugins.setLang("clipboard","en",{copy:"Copy",copyError:"Your browser security settings don't permit the editor to automatically execute copying operations. Please use the keyboard for that (Ctrl/Cmd+C).",cut:"Cut",cutError:"Your browser security settings don't permit the editor to automatically execute cutting operations. Please use the keyboard for that (Ctrl/Cmd+X).",paste:"Paste",pasteArea:"Paste Area",pasteMsg:"Please paste inside the following box using the keyboard (<strong>Ctrl/Cmd+V</strong>) and hit OK",securityMsg:"Because of your browser security settings, the editor is not able to access your clipboard data directly. You are required to paste it again in this window.",title:"Paste"}),CKEDITOR.plugins.add("keymaphelp",{requires:"dialog",availableLangs:{ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,sr:1,"sr-latn":1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},init:function(editor){var plugin=this;editor.addCommand("keymapHelp",{exec:function(){var langCode=editor.langCode;langCode=plugin.availableLangs[langCode]?langCode:plugin.availableLangs[langCode.replace(/-.*/,"")]?langCode.replace(/-.*/,""):"en",CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(plugin.path+"dialogs/lang/"+langCode+".js"),function(){editor.lang.keymaphelp=plugin.langEntries[langCode],editor.openDialog("keymapHelp")})},modes:{wysiwyg:1,source:1},readOnly:1,canUndo:!1}),editor.ui.addButton("KeyMapHelp",{label:"KeyMapHelp",icon:"keymaphelp",command:"keymapHelp",toolbar:"keymaphelp,11"}),CKEDITOR.dialog.add("keymapHelp",plugin.path+"keymaphelp.js"),editor.on("ariaEditorHelpLabel",function(evt){evt.data.label=editor.lang.common.editorHelp}),editor.accessibility&&editor.on("dialogHide",function(e){var editor=e.editor;if("keymapHelp"===e.data._.name){var elEditor=editor.element.$,$Editor=$(elEditor);setTimeout(function(){editor.execCommand("toolbarFocus"),$Editor.find(".cke_button__keymaphelp").focus()},0)}})}}),CKEDITOR.dialog.add("keymapHelp",function(editor){function representKeyStroke(keystroke){for(var quotient,modifier,presentation=[],i=0;i<modifiers.length;i++)modifier=modifiers[i],(quotient=keystroke/modifiers[i])>1&&quotient<=2&&(keystroke-=modifier,presentation.push(keyMap[modifier]));return presentation.push(keyMap[keystroke]||String.fromCharCode(keystroke)),presentation.join("+")}var lang=editor.lang.keymaphelp,id=CKEDITOR.tools.getNextId(),keyMap={8:lang.backspace,9:lang.tab,13:lang.enter,16:lang.shift,17:lang.ctrl,18:lang.alt,19:lang.pause,20:lang.capslock,27:lang.escape,33:lang.pageUp,34:lang.pageDown,35:lang.end,36:lang.home,37:lang.leftArrow,38:lang.upArrow,39:lang.rightArrow,40:lang.downArrow,45:lang.insert,46:lang.delete,91:lang.leftWindowKey,92:lang.rightWindowKey,93:lang.selectKey,96:lang.numpad0,97:lang.numpad1,98:lang.numpad2,99:lang.numpad3,100:lang.numpad4,101:lang.numpad5,102:lang.numpad6,103:lang.numpad7,104:lang.numpad8,105:lang.numpad9,106:lang.multiply,107:lang.add,109:lang.subtract,110:lang.decimalPoint,111:lang.divide,112:lang.f1,113:lang.f2,114:lang.f3,115:lang.f4,116:lang.f5,117:lang.f6,118:lang.f7,119:lang.f8,120:lang.f9,121:lang.f10,122:lang.f11,123:lang.f12,144:lang.numLock,145:lang.scrollLock,186:lang.semiColon,187:lang.equalSign,188:lang.comma,189:lang.dash,190:lang.period,191:lang.forwardSlash,192:lang.graveAccent,219:lang.openBracket,220:lang.backSlash,221:lang.closeBracket,222:lang.singleQuote};keyMap[CKEDITOR.ALT]=lang.alt,keyMap[CKEDITOR.SHIFT]=lang.shift,keyMap[CKEDITOR.CTRL]=lang.ctrl;var modifiers=[CKEDITOR.ALT,CKEDITOR.SHIFT,CKEDITOR.CTRL],variablesPattern=/\$\{(.*?)\}/g,replaceVariables=function(){var keystrokesByCode=editor.keystrokeHandler.keystrokes,keystrokesByName={};for(var i in keystrokesByCode)keystrokesByName[keystrokesByCode[i]]=i;return function(match,name){return keystrokesByName[name]?representKeyStroke(keystrokesByName[name]):match}}();return{title:lang.title,minWidth:600,minHeight:400,contents:[{id:"info",label:editor.lang.common.generalTab,expand:!0,elements:[{type:"html",id:"legends",style:"white-space:normal;",focus:function(){this.getElement().focus()},html:function(){for(var pageTpl='<div class="cke_accessibility_legend" role="document" aria-labelledby="'+id+'_arialbl" tabIndex="-1">%1</div><span id="'+id+'_arialbl" class="cke_voice_label">'+lang.contents+" </span>",pageHtml=[],sections=lang.legend,sectionLength=sections.length,i=0;i<sectionLength;i++){for(var section=sections[i],sectionHtml=[],items=section.items,itemsLength=items.length,j=0;j<itemsLength;j++){var item=items[j],itemLegend=item.legend.replace(variablesPattern,replaceVariables);itemLegend.match(variablesPattern)||sectionHtml.push("<dt>%1</dt><dd>%2</dd>".replace("%1",item.name).replace("%2",itemLegend))}pageHtml.push("<h4>%1</h4><dl>%2</dl>".replace("%1",section.name).replace("%2",sectionHtml.join("")))}return pageTpl.replace("%1",pageHtml.join(""))}()+'<style type="text/css">.cke_accessibility_legend{width:600px;height:400px;padding-right:5px;overflow-y:auto;overflow-x:hidden;}.cke_browser_quirks .cke_accessibility_legend,{height:390px}.cke_accessibility_legend *{white-space:normal;}.cke_accessibility_legend h4{font-size: 20px;border-bottom: 1px solid #AAA;margin: 5px 0px 15px;}.cke_accessibility_legend dl{margin-left: 5px;}.cke_accessibility_legend dt{font-size: 13px;font-weight: bold;}.cke_accessibility_legend dd{margin:10px}</style>'}]}],buttons:[CKEDITOR.dialog.cancelButton]}}),function(){var pluginName="tdsspecialchar";CKEDITOR.plugins.add(pluginName,{availableLangs:{af:1,ar:1,bg:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,en:1,"en-gb":1,eo:1,es:1,et:1,fa:1,fi:1,fr:1,"fr-ca":1,gl:1,he:1,hr:1,hu:1,id:1,it:1,ja:1,km:1,ku:1,lt:1,lv:1,nb:1,nl:1,no:1,pl:1,pt:1,"pt-br":1,ru:1,si:1,sk:1,sl:1,sq:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,zh:1,"zh-cn":1},requires:"dialog",hidpi:!0,init:function(editor){var plugin=this;CKEDITOR.dialog.add(pluginName,plugin.path+"dialogs/tdsspecialchar.js"),editor.addCommand(pluginName,{exec:function(){var langCode=editor.langCode;langCode=plugin.availableLangs[langCode]?langCode:plugin.availableLangs[langCode.replace(/-.*/,"")]?langCode.replace(/-.*/,""):"en",CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(plugin.path+"dialogs/lang/"+langCode+".js"),function(){CKEDITOR.tools.extend(editor.lang.tdsspecialchar,plugin.langEntries[langCode]),editor.openDialog(pluginName)})},modes:{wysiwyg:1},canUndo:!1}),editor.ui.addButton&&editor.ui.addButton("TDSSpecialChar",{label:editor.lang.tdsspecialchar.toolbar,icon:pluginName,command:pluginName,toolbar:"insert,50"})}}),CKEDITOR.config.specialChars=["!","&quot;","#","$","%","&amp;","'","(",")","*","+","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","&lt;","=","&gt;","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","&euro;","&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;","&sbquo;","&#8219;","&bdquo;","&hellip;","&trade;","&#9658;","&bull;","&rarr;","&rArr;","&hArr;","&diams;","&asymp;"]}(),CKEDITOR.plugins.setLang("tdsspecialchar","en",{options:"Special Character Options",title:"Select Special Character",toolbar:"Insert Special Character"}),CKEDITOR.plugins.setLang("tdsspecialchar","es",{options:"Opciones de caracteres especiales",title:"Seleccione un caracter especial",toolbar:"Insertar Caracter Especial"}),CKEDITOR.dialog.add("tdsspecialchar",function(editor){var dialog,focusedNode,lang=editor.lang.tdsspecialchar,pluginInstructions=Messages.get("TDSCKE.Label.SpecialCharIntro"),onChoice=function(evt){var target,value;if("a"==(target=evt.data?evt.data.getTarget():new CKEDITOR.dom.element(evt)).getName()&&(value=target.getChild(0).getHtml())){target.removeClass("cke_light_background"),dialog.hide();var span=editor.document.createElement("span");span.setHtml(value),editor.insertText(span.getText())}},onClick=CKEDITOR.tools.addFunction(onChoice),onFocus=function(evt,target){var value;if("span"==(target=target||evt.data.getTarget()).getName()&&(target=target.getParent()),"a"==target.getName()&&(value=target.getChild(0).getHtml())){focusedNode&&onBlur(null,focusedNode);var htmlPreview=dialog.getContentElement("info","htmlPreview").getElement();dialog.getContentElement("info","charPreview").getElement().setHtml(value),htmlPreview.setHtml(CKEDITOR.tools.htmlEncode(value)),target.getParent().addClass("cke_light_background"),focusedNode=target}},onBlur=function(evt,target){"span"==(target=target||evt.data.getTarget()).getName()&&(target=target.getParent()),"a"==target.getName()&&(dialog.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),dialog.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),target.getParent().removeClass("cke_light_background"),focusedNode=void 0)},onKeydown=CKEDITOR.tools.addFunction(function(ev){var relative,nodeToMove,element=(ev=new CKEDITOR.dom.event(ev)).getTarget(),keystroke=ev.getKeystroke(),rtl="rtl"==editor.lang.dir;switch(keystroke){case 38:(relative=element.getParent().getParent().getPrevious())&&((nodeToMove=relative.getChild([element.getParent().getIndex(),0])).focus(),onBlur(null,element),onFocus(null,nodeToMove)),ev.preventDefault();break;case 40:(relative=element.getParent().getParent().getNext())&&(nodeToMove=relative.getChild([element.getParent().getIndex(),0]))&&1==nodeToMove.type&&(nodeToMove.focus(),onBlur(null,element),onFocus(null,nodeToMove)),ev.preventDefault();break;case 32:onChoice({data:ev}),ev.preventDefault();break;case rtl?37:39:(relative=element.getParent().getNext())?1==(nodeToMove=relative.getChild(0)).type?(nodeToMove.focus(),onBlur(null,element),onFocus(null,nodeToMove),ev.preventDefault(!0)):onBlur(null,element):(relative=element.getParent().getParent().getNext())&&((nodeToMove=relative.getChild([0,0]))&&1==nodeToMove.type?(nodeToMove.focus(),onBlur(null,element),onFocus(null,nodeToMove),ev.preventDefault(!0)):onBlur(null,element));break;case rtl?39:37:(relative=element.getParent().getPrevious())?((nodeToMove=relative.getChild(0)).focus(),onBlur(null,element),onFocus(null,nodeToMove),ev.preventDefault(!0)):(relative=element.getParent().getParent().getPrevious())?((nodeToMove=relative.getLast().getChild(0)).focus(),onBlur(null,element),onFocus(null,nodeToMove),ev.preventDefault(!0)):onBlur(null,element);break;default:return}});return{title:lang.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){for(var character,charDesc,columns=this.definition.charColumns,chars=(editor.config.extraSpecialChars,editor.config.specialChars),charsTableLabel=CKEDITOR.tools.getNextId()+"_specialchar_table_label",html=['<table role="listbox" aria-labelledby="'+charsTableLabel+'" style="width: 320px; height: 100%; border-collapse: separate;" align="center" cellspacing="2" cellpadding="2" border="0">'],i=0,size=chars.length;i<size;){html.push('<tr role="presentation">');for(var j=0;j<columns;j++,i++){if(character=chars[i]){if(charDesc="",character instanceof Array)charDesc=character[1],character=character[0];else{var _tmpName=character.replace("&","").replace(";","").replace("#","");charDesc=lang[_tmpName]||character}var charLabelId="cke_specialchar_label_"+i+"_"+CKEDITOR.tools.getNextNumber();html.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(i+1)+'"',' aria-setsize="'+size+'"',' aria-labelledby="'+charLabelId+'"',' class="cke_specialchar" title="',CKEDITOR.tools.htmlEncode(charDesc),'" onkeydown="CKEDITOR.tools.callFunction( '+onKeydown+', event, this )" onclick="CKEDITOR.tools.callFunction('+onClick+', this); return false;" tabindex="-1"><span style="margin: 0 auto;cursor: inherit">'+character+'</span><span class="cke_voice_label" id="'+charLabelId+'">'+charDesc+"</span></a>")}else html.push('<td class="cke_dark_background">&nbsp;');html.push("</td>")}html.push("</tr>")}html.push("</tbody></table>",'<span id="'+charsTableLabel+'" class="cke_voice_label">'+lang.options+"</span>");var instruction=new CKEDITOR.dom.element("span");instruction.addClass("cke_tdsspecialchar_instruction"),instruction.appendText(pluginInstructions),this.getContentElement("info","contentContainer").getElement().insertBeforeMe(instruction),this.getContentElement("info","charContainer").getElement().setHtml(html.join(""))},contents:[{id:"info",label:editor.lang.common.generalTab,title:editor.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",id:"contentContainer",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:onFocus,onMouseout:onBlur,focus:function(){var firstChar=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){firstChar.focus(),onFocus(null,firstChar)},0)},onShow:function(){var firstChar=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){firstChar.focus(),onFocus(null,firstChar)},0)},onLoad:function(event){dialog=event.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"}]}]}]}]}]}}),function(CKEDITOR){function fixPaths(config){var rootPath=HTMLEditor.resolveBaseUrl(""),basePath=rootPath+"Scripts/Libraries/ckeditor/4.4.7/",pluginsPath=basePath+"plugins/",customPath=rootPath+"Scripts/HTMLEditor2/plugins/";CKEDITOR.basePath!=basePath&&(CKEDITOR.basePath=basePath),CKEDITOR.plugins.basePath!=pluginsPath&&(CKEDITOR.plugins.basePath=pluginsPath),CKEDITOR.plugins.customPath=customPath;var pluginName;for(pluginName in CKEDITOR.plugins.registered){var plugin=CKEDITOR.plugins.registered[pluginName];-1==plugin.path.indexOf(pluginsPath)&&(plugin.path=CKEDITOR.plugins.getPath(pluginName)),config.extraPlugins.indexOf(pluginName)&&(plugin.path=customPath+pluginName+"/")}var iconName;for(iconName in CKEDITOR.skin.icons){var icon=CKEDITOR.skin.icons[iconName],fileName=icon.path.split("/").pop();-1==icon.path.indexOf(customPath)&&(icon.path=pluginsPath+fileName)}}function createToolbar(responseType,addGroups,removeGroups){var toolGroups={};"HTMLEditorCustom"==responseType?addGroups&&addGroups.forEach(function(groupName){toolGroups[groupName]=DEFAULT_GROUPS[groupName]}):Object.keys(DEFAULT_GROUPS).forEach(function(groupName){toolGroups[groupName]=DEFAULT_GROUPS[groupName]});var toolbar=[["KeyMapHelp"],["Bold","Italic","Underline","RemoveFormat"],["NumberedList","BulletedList","Outdent","Indent"],["Cut","Copy","Paste","Undo","Redo"],["SpellChecker","Languages"],["Table","TDSSpecialChar"]];"HTMLEditorTable"!=responseType&&"HTMLEditorCustom"!=responseType&&delete toolGroups.table,"PlainTextSpell"==responseType&&Object.keys(toolGroups).forEach(function(groupName){"spellchecker"!=groupName&&delete toolGroups[groupName]}),window.Accommodations&&(Accommodations.Manager.getCurrentProps().isStreamlinedMode()||delete toolGroups.help),removeGroups&&removeGroups.forEach(function(groupName){delete toolGroups[groupName]});var buttons=Util.Array.flatten(Util.Object.values(toolGroups));return toolbar=toolbar.map(function(group){return group.filter(function(button){return-1!=buttons.indexOf(button)})}).filter(function(group){return group.length})}function createConfig(responseType,addGroups,removeGroups){var config={title:"",customConfig:"",readOnly:!0,startupFocus:!1,baseFloatZIndex:50,dialog_noConfirmCancel:!0,extraPlugins:"clipboard,spellchecker,keymaphelp,tdsspecialchar",removePlugins:"sharedSpaces,floatingspace,resize,tableresize,wordcount,specialchar",disableNativeSpellChecker:!0,disableNativeTableHandles:!0,height:""};if(window.Accommodations){var accProps=Accommodations.Manager.getCurrentProps();accProps.isStreamlinedMode()||accProps.hasBraille()||(config.tabSpaces=4)}if(config.toolbar=createToolbar(responseType,addGroups,removeGroups),config.removePlugins+=useInline?",wysiwygarea":",divarea",!useInline){var styles=[];styles.push(HTMLEditor.resolveBaseUrl("Shared/CSS/accommodations.css")),styles.push(HTMLEditor.resolveBaseUrl("Scripts/HTMLEditor2/frame.css")),config.contentsCss=styles}return config}function onInstanceReady(editor){var editable=editor.editable();editor.isReady=!0,editor.container.addClass("editor"),editor.contentDom=useInline?editable.$:editor.document.$.body;var editorEl=editor.element.$;editorEl.removeAttribute&&editorEl.removeAttribute("title"),Util.Browser.supportsModifierKeys()||editable.attachListener(editable,"keydown",function(evt){evt.data.$.ctrlKey&&evt.stop()},null,null,1),!0!==editor.config.disabled&&setTimeout(function(){editor.setReadOnly(!1)},0)}if(null!=CKEDITOR){CKEDITOR.disableAutoInline=!0;var useInline=!1,mode=Util.QueryString.parse().ckeditor;mode?useInline="inline"==mode:(Util.Browser.isIOS()||Util.Browser.isAndroid())&&(useInline=!0),CKEDITOR.on("instanceCreated",function(ev){var clipPath=HTMLEditor.resolveBaseUrl("Scripts/HTMLEditor2/plugins/clipboard/icons/"),spellPath=HTMLEditor.resolveBaseUrl("Scripts/HTMLEditor2/plugins/spellchecker/icons/"),keymapPath=HTMLEditor.resolveBaseUrl("Scripts/HTMLEditor2/plugins/keymaphelp/dialogs/icons/"),specharPath=HTMLEditor.resolveBaseUrl("Scripts/HTMLEditor2/plugins/tdsspecialchar/icons/");CKEDITOR.skin.addIcon("cut",clipPath+"cut.png",0,!0),CKEDITOR.skin.addIcon("copy",clipPath+"copy.png",0,!0),CKEDITOR.skin.addIcon("paste",clipPath+"paste.png",0,!0),CKEDITOR.skin.addIcon("spellchecker",spellPath+"spellchecker.png",0,!0),CKEDITOR.skin.addIcon("keymaphelp",keymapPath+"keymaphelp.png",0,!0),CKEDITOR.skin.addIcon("tdsspecialchar",specharPath+"tdsspecialchar.png",0,!0)});var DEFAULT_GROUPS={help:["KeyMapHelp"],basicstyles:["Bold","Italic","Underline"],cleanup:["RemoveFormat"],list:["NumberedList","BulletedList"],indent:["Outdent","Indent"],clipboard:["Cut","Copy","Paste"],undo:["Undo","Redo"],spellchecker:["SpellChecker","Languages"],table:["Table"],specialchar:["TDSSpecialChar"]},HTMLEditor={};HTMLEditor.create=function(containerEl,responseType,configOverride){window.ContentManager&&ContentManager.isPrintMode()&&!mode&&(useInline=!0),containerEl.innerHTML="";var config=createConfig(responseType,configOverride.addGroups,configOverride.removeGroups);if(fixPaths(config),configOverride)for(var property in configOverride)config[property]=configOverride[property];CKEDITOR.env.isCompatible=!0;var editor=CKEDITOR.appendTo(containerEl,config);if(!editor)throw new Error("CKEditor failed to be created.");return editor.isReady=!1,editor.on("instanceReady",onInstanceReady.bind(null,editor)),editor},HTMLEditor.resolveBaseUrl=function(url){return url},HTMLEditor.getLanguage=function(){return"ENU"},window.HTMLEditor=HTMLEditor}}(window.CKEDITOR),function(CKEDITOR){CKEDITOR.on("dialogDefinition",function(e){e.data.name;var dialog=e.data.definition.dialog;dialog.on("show",TDS.Dialog.onShow),dialog.on("hide",TDS.Dialog.onHide)}),CKEDITOR.on("instanceCreated",function(ev){ev.editor.on("contentDom",function(){var element=document!=ev.editor.document?ev.editor.document:ev.editor.element;element.on("dragstart",function(ev){ev.data.preventDefault(!0)}),element.on("drop",function(ev){ev.data.preventDefault(!0)}),element.on("contextmenu",function(ev){ev.data.preventDefault(!0)}),Util.Browser.isIOS()&&ev.editor.element.on("touchstart",function(evt){evt.data.stopPropagation()})})}),CKEDITOR.on("ariaWidget",function(e){var menuCKEditorEl=e.data;if(menuCKEditorEl.hasClass&&!menuCKEditorEl.hasClass("dragDisabled")){var doc,menuBody,tag=menuCKEditorEl.$.tagName.toLowerCase();if("iframe"===tag)menuBody=(doc=menuCKEditorEl.getFrameDocument()).getBody();else{if("body"!==tag)return;doc=menuCKEditorEl.getDocument(),menuBody=menuCKEditorEl}doc&&menuBody&&(menuBody.setAttribute("ondragstart","return false;"),menuCKEditorEl.addClass("dragDisabled"))}}),Util.Browser.getFirefoxVersion()&&Util.Browser.getFirefoxVersion()<10&&(CKEDITOR.editor.prototype.getSelection=function(forceRealSelection){if((this._.savedSelection||this._.fakeSelection)&&!forceRealSelection)return this._.savedSelection||this._.fakeSelection;var editable=this.editable();if(editable&&(void 0===this.mode||"wysiwyg"==this.mode)){var sel=new CKEDITOR.dom.selection(editable);return void 0===this.mode&&(sel.isLocked=1),sel}return null}),CKEDITOR.dom.range.prototype.moveToBookmark=function(bookmark){if(bookmark.is2){var startContainer=this.document.getByAddress(bookmark.start,bookmark.normalized),startOffset=bookmark.startOffset,endContainer=bookmark.end&&this.document.getByAddress(bookmark.end,bookmark.normalized),endOffset=bookmark.endOffset;this.setStart(startContainer,startOffset),endContainer?this.setEnd(endContainer,endOffset):this.collapse(!0)}else{var serializable=bookmark.serializable,startNode=serializable?this.document.getById(bookmark.startNode):bookmark.startNode,endNode=serializable?this.document.getById(bookmark.endNode):bookmark.endNode;startNode&&(this.setStartBefore(startNode),startNode.remove()),endNode?(this.setEndBefore(endNode),endNode.remove()):this.collapse(!0)}}}(CKEDITOR),CKEDITOR.on("template",function(e){var data=e.data;"dialog"==data.name&&(data.source='<div class="cke_reset_all {editorId} {editorDialogClass} {hidpi} overridetest" dir="{langDir}" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><div class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}"><div><div><div><div class="cke_dialog_body"><div id="cke_dialog_title_{id}" class="cke_dialog_title"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><div class="cke_dialog_contents"><div><div><div id="cke_dialog_contents_{id}" class="cke_dialog_contents_body"></div></div><div><div id="cke_dialog_footer_{id}" class="cke_dialog_footer"></div></div></div></div></div></div></div></div></div></div>')}),function(CKEDITOR,HTMLEditor){function validateNum(msg,max){return function(){var value=this.getValue(),pass=!!(CKEDITOR.dialog.validate.integer()(value)&&value>0&&value<=max);if(!pass){var invalidValue=this.getInputElement().$;TDS.Dialog.showAlert(msg,function(){invalidValue.select()})}return pass}}function validateSize(msg){return function(){var value=this.getValue(),pass=/^((0*\.\d*[1-9]\d*|0*[1-9]\d*(\.\d+)?)(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i.test(value);if(!pass){var invalidValue=this.getInputElement().$;TDS.Dialog.showAlert(msg,function(){invalidValue.select()})}return pass}}var lang=HTMLEditor.getLanguage(),invalidRowsMsg="TDSCKE.Alert.InvalidRows."+lang,invalidColsMsg="TDSCKE.Alert.InvalidCols."+lang,invalidWidthMsg="TDSCKE.Alert.InvalidWidth."+lang,invalidHeightMsg="TDSCKE.Alert.InvalidHeight."+lang;CKEDITOR.on("dialogDefinition",function(e){var dialogName=e.data.name,def=(e.data.definition.dialog,e.data.definition);if(dialogName&&def)if("table"==dialogName||"tableProperties"==dialogName){var tableTab=def.getContents("info");if(tableTab){tableTab.remove("txtBorder"),tableTab.remove("txtCellSpace"),tableTab.remove("txtCellPad"),tableTab.remove("txtSummary"),tableTab.get("txtRows").validate=validateNum(invalidRowsMsg,100),tableTab.get("txtCols").validate=validateNum(invalidColsMsg,10),tableTab.get("txtWidth").validate=validateSize(invalidWidthMsg),tableTab.get("txtHeight").validate=validateSize(invalidHeightMsg);var cmbAlign=tableTab.get("cmbAlign");cmbAlign.setup=function(selectedTable){this.setValue($(selectedTable.$).css("text-align")||"")},cmbAlign.commit=function(data,selectedTable){this.getValue()?$(selectedTable.$).css("text-align",this.getValue()):$(selectedTable.$).css("text-align","")}}}else if("cellProperties"==dialogName){var cellTab=def.getContents("info");cellTab&&(cellTab.remove("rowSpan"),cellTab.remove("colSpan"),cellTab.remove("txtSummary"))}})}(CKEDITOR,HTMLEditor),function(HTMLEditor,CM){function Widget_CK(page,item,config){this._editor=null}HTMLEditor.resolveBaseUrl=CM.resolveBaseUrl.bind(CM),HTMLEditor.getLanguage=CM.getLanguage.bind(CM),CM.registerWidget("htmleditor",Widget_CK,function(page,item,content){if("12"==page.layout)return!1;var id="editor_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el)}),Widget_CK.prototype.load=function(){var item=this.entity,addGroups=[];if("HTMLEditorCustom"===item.responseType&&item.rendererSpec){var xmlButtonGroupsDoc=$.parseXML(item.rendererSpec);$(xmlButtonGroupsDoc).find("htmlEditor toolbarGroups group").each(function(index,groupEl){addGroups.push($(groupEl).attr("name"))})}var removeGroups=[],accProps=this.page.getAccProps(),buttonGroups=accProps.getHTMLEditorButtonGroups();buttonGroups.length&&"TDS_HEBG_None"!=buttonGroups[0]&&buttonGroups.forEach(function(groupName){removeGroups.push(groupName.substring(9).toLowerCase())});var containerEl=this.element,editor=HTMLEditor.create(containerEl,item.responseType,{addGroups:addGroups,removeGroups:removeGroups,disabled:item.isReadOnly()});accProps.isStreamlinedMode()&&(editor.accessibility=!0),this._editor=editor,editor.parentItem=item,item.value&&(editor._.data=item.value)},Widget_CK.prototype.showMenu=function(contentMenu,evt){var targetNode=YUE.getTarget(evt);if(targetNode){if("HTML"==targetNode.tagName)for(var children=targetNode.childNodes,i=0;i<children.length&&"BODY"!=(targetNode=children[i]).tagName;++i);for(;targetNode;){if(YUD.hasClass(targetNode,"cke_editable")){contentMenu.cancel=!0;break}targetNode=targetNode.parentNode}}},Widget_CK.prototype.hide=function(){var editor=this._editor;editor&&editor.commands&&editor.commands.spellchecker&&editor.commands.spellchecker.enabled&&editor.commands.spellchecker.exec()},Widget_CK.prototype.isResponseAvailable=function(){return this._editor&&this._editor.isReady},Widget_CK.prototype.getResponse=function(){return this.entity.isResponseType("PlainTextSpell")?this.getResponseText():this.getResponseHtml()},Widget_CK.prototype.getResponseHtml=function(){var value=this._editor.getData(),isValid=value.length>0;return this.createResponse(value,isValid)},Widget_CK.prototype.getResponseText=function(){var value=this._editor.element.$,isValid=(value=Util.Dom.getTextContent(value)).length>0;return this.createResponse(value,isValid)},Widget_CK.prototype.setResponse=function(value){var editable=this._editor.editable();editable&&editable.setHtml(value)},CKEDITOR.on("instanceReady",function(ev){var charNumDiff=TDS.getAppSetting("editor.contentDeletedCharThreshold",50),charPctDiff=TDS.getAppSetting("editor.contentDeletedPctThreshold",10),deleteLogging=TDS.getAppSetting("editor.contentDeletedLogging","none");0!=charNumDiff&&(charNumDiff=Math.max(charNumDiff,30)),0!=charPctDiff&&(charPctDiff=Math.max(charPctDiff,5))>100&&(charPctDiff=100),charPctDiff/=100;var editor=ev.editor;if(editor){var item=editor.parentItem;if(item){var page=item.getPage();editor.on("focus",function(ev){ContentManager.Menu.hide(),item.setActiveComponent(editor)}),function(){if(!editor.config.disabled){var lastHtmlContent="",lastTextLength=0,deleteLogger=function(contentDeleted,num,pct,prevContent,content){var msg="EDITOR DELETE NOTIFICATION ("+contentDeleted+")",detail="";contentDeleted&&(detail=num+" ["+100*pct+"%] CHARACTERS DELETED"),(!contentDeleted||"yes"!=deleteLogging&&"all"!=deleteLogging)&&(contentDeleted||"no"!=deleteLogging&&"all"!=deleteLogging)||(TDS.Diagnostics.logServerError(msg,detail),console.warn(msg+" ("+detail+")"))},checkContentChanged=function(){var editable=editor.editable(),html=editable.getHtml();if(html!=lastHtmlContent){var text=editable.getText(),diffNum=lastTextLength-text.length,diffPct=0;lastTextLength>0&&diffNum>0&&(diffPct=diffNum/lastTextLength),charNumDiff>0&&diffNum>charNumDiff||charPctDiff>0&&diffPct>charPctDiff&&diffNum>10?TDS.Dialog.showPrompt(Messages.getAlt("TDSEditorEventsJS.Label.EditorContentDeleted","You have removed/deleted a large portion of your content. If this is intentional (e.g. cutting a paragraph of text for pasting somewhere else) then please click 'Yes' and we will proceed, otherwise please click 'No' and your content will be restored. Are you sure you want to do this?"),function(){deleteLogger(!0,diffNum,diffPct),lastHtmlContent=html,lastTextLength=text.length,editor.focus()},function(){deleteLogger(!1,diffNum,diffPct),editable.setHtml(lastHtmlContent),editor.focus()}).blurButtons():(lastHtmlContent=html,lastTextLength=text.length)}},editable=editor.editable();editable.attachListener(editable,"input",checkContentChanged),editor.on("beforeUndoImage",function(event){setTimeout(checkContentChanged,1)},editor,null,100)}}();var accProps=page.getAccProps();if(accProps&&accProps.isStreamlinedMode()){var elEditor=editor.element.$,$Editor=$(elEditor);$Editor.find(".cke_toolbox a").attr("tabindex","0"),$Editor.find(".cke_top").prepend('<a href="#" class="skipTools" tabindex="0">Skip Formatting tool bar</a>'),$Editor.find(".cke_combo__languages").parent().addClass("spellcheckGroup"),$Editor.find(".skipTools").keydown(function(event){if(!(event.shiftKey||event.ctrlKey||event.altKey||event.metaKey))switch(event.keyCode){case 9:return editor.execCommand("toolbarFocus"),!1;case 32:case 13:return editor.focus(),!1}return!0}),editor.setKeystroke(CKEDITOR.SHIFT+9,"toolbarFocus"),editor.toolbox.toolbars.forEach(function(toolbar){toolbar.items.forEach(function(tbItem){var oldOnkeyHandler=tbItem.onkey;tbItem.onkey=function(tbButton,keycode){var $toolbar=$Editor.find(".cke_toolbox .cke_toolbar");return 2228233===keycode&&$toolbar.first().find("#"+tbButton.id).length>0?($Editor.find(".skipTools").focus(),!1):(9===keycode&&$toolbar.last().find("#"+tbButton.id).length>0&&(keycode=27),oldOnkeyHandler(tbButton,keycode))}})})}item.addComponent(editor);var doc=editor.document.$,win=editor.document.getWindow().$;if(doc!=document){CM.Menu.applyDocFix(win);var $iFrame=$(editor.container.$).find("iframe");$iFrame.attr("title","Rich Text Editor"),CM.registerFrame($iFrame[0]),CM.addMouseEvents(item,doc),CM.addKeyEvents(doc),Util.Browser.isTouchDevice()&&CM.listenForFocus(doc),doc.body&&page.getAccommodations().applyCSS(doc.body);var zoom=page.getZoom();zoom.addDocument(doc),zoom.refresh()}}}})}(HTMLEditor,ContentManager),function(CM,CKEDITOR){function countHTMLWords(html){if(!html)return 0;var text=html.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," "),tmp=document.createElement("div");tmp.innerHTML=text;for(var words=(text=Util.Dom.getTextContent(tmp)).split(/\s+/),wordIndex=words.length-1;wordIndex>=0;wordIndex--)words[wordIndex].match(/^([\s\t\r\n]*)$/)&&words.splice(wordIndex,1);return words.length}function updateWordCount(item,warning){var editor=item.editor,isEditorReady=editor&&editor.isReady,wordsCount=countHTMLWords(isEditorReady?editor.getData():item.value),wordCountLabel=0==wordsCount?"":wordsCount+" out of "+wordsAllowed+" words used.",pageEl=item.getPage().getElement();if(pageEl&&$("div.writeNav2",pageEl).text(wordCountLabel),wordsCount>0){var promptCountLabel=wordsCount+" words",itemEl=item.getElement();itemEl&&$("span.inlineCount",itemEl).text(promptCountLabel)}if(isEditorReady&&warning&&wordsCount>wordsAllowed){var message="Your response cannot exceed "+wordsAllowed+" words.";TDS.Dialog.showAlert(message,function(){CM.focus(editor)})}}function createEditor(writing,item){var editorDiv=YUD.get("Item_"+item.position).getElementsByClassName("writingBlock")[0],editor=HTMLEditor.create(editorDiv,item.responseType,{disabled:item.isReadOnly()});item.editor=editor,editor.parentItem=item,item.value&&(editor._.data=item.value),item.addComponent(editor),editor.on("change",function(){updateWordCount(item,!0)}),editor.on("instanceReady",function(){updateWordCount(item,!1)})}function processItem(writing,item){var unit=new WritingUnit(item.getElement());return unit.item=item,unit.writing=writing,writing.units.push(unit),unit.isSelected()&&(unit.select(),YUD.removeClass(writing.linkStart,"inactive"),item.setActive()),YUE.addListener(unit.linkSelect,"click",function(){CM.Menu.isShowing()||writing.selectUnit(unit)}),YUE.addListener(unit.linkExpandPrompt,"click",unit.toggleExpand,unit,!0),item.isVisible=function(){return Util.Dom.isVisible(unit.divPrompt)},unit.onOpenEdit.subscribe(function(){updateWordCount(item,!1),item.editor||createEditor(writing,item)}),updateWordCount(item,!1),unit}function processPage(page){var divWriting=page.getElement(),writing=new WritingLayout(divWriting),wordCountDiv=divWriting.getElementsByClassName("writeNav2")[0];YUD.addClass(wordCountDiv,"writeNav2"),divWriting.getElementsByClassName("bigTable")[0].appendChild(wordCountDiv),writing.wordCountEl=wordCountDiv;var items=page.getItems();return Util.Array.each(items,function(item){var unit=processItem(writing,item),unitEl=item.getElement(),config=new CM.WidgetConfig(unitEl.id,unitEl),widget=CM.createWidget(Widget_Writing,page,item,config);widget.unit=unit,item.widgets.add("writing",widget)}),1==writing.units.length?(writing.units[0].select(),writing.enableEditing()):writing.toggleEdit(),writing}function Plugin_Writing(){this.writing=null}function Widget_Writing(page,item){this.unit=null}var wordsAllowed=850;CM.registerPagePlugin("writing",Plugin_Writing,function(page){return"12"==page.layout}),Plugin_Writing.prototype.load=function(){this.writing=processPage(this.page)},CM.extendWidget(Widget_Writing),Widget_Writing.prototype.keyEvent=function(evt){var unit=this.unit,writing=unit.writing;"keydown"!=evt.type||evt.ctrlKey||evt.altKey||"Enter"!=evt.key||writing.isEditing()||(unit.isSelected()?writing.enableEditing():writing.selectUnit(unit))},Widget_Writing.prototype.showMenu=function(menu){var item=this.entity,writing=this.unit.writing;item.getActiveComponent()==item.getStemElement()&&writing.isEditing()&&menu._entity.push({text:"Change Prompt",classname:"changePrompt",onclick:{fn:writing.toggleEdit,scope:writing}})},Widget_Writing.prototype.isResponseAvailable=function(){return this.entity.editor&&this.entity.editor.isReady},Widget_Writing.prototype.getResponse=function(){var editor=this.entity.editor,unit=this.unit,value=editor.getData(),isValid=value.length>0,isEmpty=!isValid,isSelected=unit.isSelected();return this.createResponse(value,isValid,isEmpty,isSelected)},Widget_Writing.prototype.setResponse=function(value){this.entity.editor.setData(value)}}(window.ContentManager,window.CKEDITOR);var Lang=YAHOO.util.Lang,ErrorHandler={report:function(name,ex){"object"==typeof console&&console.error(name+" "+ex.name+": "+ex.message+" - "+ex.fileName+" (line "+ex.lineNumber+")")},wrapFunction:function(context,name){var fn=context[name];YAHOO.lang.isObject(context)&&YAHOO.lang.isFunction(fn)&&(context[name]=function(){try{return fn.apply(context,arguments)}catch(ex){throw ErrorHandler.report(name,ex),ex}})},wrapFunctions:function(context,names){if(YAHOO.lang.isArray(names))for(var i=0;i<names.length;i++)ErrorHandler.wrapFunction(context,names[i])}},EventLazyProvider=function(){};EventLazyProvider.prototype={_scope:null,setScope:function(obj){this._scope=obj},fireLazy:function(name,obj){return this.hasEvent(name)||(this._scope?this.createEvent(name,{scope:this._scope}):this.createEvent(name)),this.fireEvent(name,obj)}},YAHOO.lang.augmentProto(EventLazyProvider,YAHOO.util.EventProvider),function(){var con;try{con=top.console}catch(ex){con=console}window.Logger=function(prefix){function log(level,message,params){if(enabled&&("error"==level&&(level="warn"),con&&con[level])){prefix&&(message=prefix+message),params&&(message=YAHOO.lang.substitute(message,params));try{con[level](message)}catch(ex){}}}var enabled=!0;this.enable=function(){enabled=!0},this.disable=function(){enabled=!1},this.debug=function(message,params){log("debug",message,params)},this.info=function(message,params){log("info",message,params)},this.warn=function(message,params){log("warn",message,params)},this.error=function(message,params){log("error",message,params)}}}();var logger=new Logger("GRID: "),Grid=function(element,svgFile){this._element=YAHOO.util.Dom.get(element),this._svgFile=svgFile,this.view=null,this.ui=null,this.model=null,this.question=null,this.importexport=null,this.palette=null,this.toolbar=null,this.feedback=null,this.canvas=null,this._currentPanel=null,this._currentMode=null,this._state=Grid.State.Uninitialized,this._canvasComponents=[],this.showCoordinates=!1,this.allowTab=!0,this._debug=!1,this.view=this.ui=new Grid.View(this._svgFile),this.model=this.question=new Grid.Model,this.importexport=new Grid.ImportExport(this.model),this.palette=new Grid.Palette(this),this.toolbar=new Grid.Toolbar(this),this.canvas=new Grid.Canvas(this),Grid.Utils.hasSVGWeb()&&ErrorHandler.wrapFunctions(this,["_svgRendered","init","update","loadItemXml","loadResponseXml","getResponseXml"]),Grid.Events.fireLazy("onNew",this)};Grid.Events=new EventLazyProvider,YAHOO.lang.augmentProto(Grid,EventLazyProvider),Grid.State={Error:-1,Uninitialized:0,Initialized:1,Created:2,Ready:3,Loading:4,Loaded:5},GridState=Grid.State,Grid.prototype.isReadOnly=function(){return!1},Grid.prototype._setState=function(state,data){this._state=state;var stateName="Unknown";switch(this._state){case Grid.State.Error:stateName="Error";break;case Grid.State.Uninitialized:stateName="Uninitialized";break;case Grid.State.Initialized:stateName="Initialized";break;case Grid.State.Created:stateName="Created";break;case Grid.State.Ready:stateName="Ready";break;case Grid.State.Loading:stateName="Loading";break;case Grid.State.Loaded:stateName="Loaded"}this.fireLazy("onStateChange",{grid:this,state:state,name:stateName,data:data})},Grid.prototype.getState=function(){return this._state},Grid.prototype.reportError=function(msg,ex,silent){if(this.fireLazy("onError",{message:msg,exception:ex}),ex&&!silent)throw ex},Grid.prototype._processKeyEvent=function(evt){if(evt.preventDefault(),!this.isReadOnly()){var key="";switch(evt.keyCode){case 9:key="tab";break;case 13:key="enter";break;case 27:key="esc";break;case 32:key="space";break;case 37:key="left";break;case 38:key="up";break;case 39:key="right";break;case 40:key="down"}var keyEvent={dom:evt,key:key},area=this.getArea();if(this.allowTab&&evt.ctrlKey&&"tab"==key)return this.view._svgWin.focus(),void("canvas"==area?this.model.options.showPalette?this.setArea("palette"):this.model.options.showButtons.length>0&&this.setArea("toolbar"):"palette"==area?this.setArea("toolbar"):"toolbar"==area&&this.setArea("canvas"));"canvas"==area&&"function"==typeof this.canvas.processKeyEvent?this.canvas.processKeyEvent(keyEvent):"palette"==area&&"function"==typeof this.palette.processKeyEvent?this.palette.processKeyEvent(keyEvent):"toolbar"==area&&"function"==typeof this.toolbar.processKeyEvent&&this.toolbar.processKeyEvent(keyEvent)}},Grid.prototype._svgRendered=function(){var grid=this,groupPalette=this.view.getElementById("groupPalette"),groupToolbar=this.view.getElementById("groupToolbar"),groupCanvas=this.view.getElementById("groupCanvas");groupPalette&&Grid.Utils.addMouseListener(groupPalette,"mousedown",function(evt){grid.isReadOnly()||grid.setArea("palette")}),groupToolbar&&Grid.Utils.addMouseListener(groupToolbar,"mousedown",function(evt){grid.isReadOnly()||grid.setArea("toolbar")}),Grid.Utils.addMouseListener(groupCanvas,"mousedown",function(evt){grid.isReadOnly()||grid.setArea("canvas")}),this.view._svgRoot.addEventListener("keyup",function(evt){evt.preventDefault()},!1),this.view._svgRoot.addEventListener("keypress",function(evt){evt.preventDefault()},!1),this.view._svgRoot.addEventListener("keydown",function(evt){try{grid._processKeyEvent(evt)}catch(ex){grid.reportError("Error processing key event",ex)}},!1),grid.view._svgRoot.addEventListener("contextmenu",function(evt){evt.preventDefault()},!1),this.addMouseListener("groupCanvas",function(evt){if(!grid.isReadOnly())try{for(var i=grid._canvasComponents.length;i--;){var success,canvasComponent=grid._canvasComponents[i];if("function"==typeof canvasComponent.processMouseEvent&&(success=canvasComponent.processMouseEvent(evt)),!1===success)return}}catch(ex){grid.reportError("Error processing canvas mouse event",ex)}}),this.registerCanvasComponent(grid.canvas),this.addMouseListener("groupWrapper",function(evt){if(!grid.isReadOnly())try{grid.palette.processMouseEvent(evt)}catch(ex){grid.reportError("Error processing palette mouse event",ex)}}),this.addMouseListener("groupCanvas",function(evt){grid.showCoordinates&&grid.view.setCoordinatesText("("+evt.currentPosition.x+","+(grid.model.options.canvasHeight-evt.currentPosition.y)+")")}),grid.palette.subscribeToModelEvents(),grid.canvas.subscribeToModelEvents(),groupToolbar&&this.toolbar.init(),this.setMode("move"),YAHOO.env.ua.gecko<1.91&&(this.view._suspendRedrawEnabled=!0,this.view._attributeBatchEnabled=!0),setTimeout(function(){grid._setState(Grid.State.Ready)},0)},Grid.prototype.registerCanvasComponent=function(obj){this._canvasComponents.push(obj)},Grid.prototype.getArea=function(){return this._currentPanel},Grid.prototype.setArea=function(panelName){if(this._currentPanel==panelName)return!1;if(this.canvas.stopAction(),this.canvas.clearFocused(),null!=this._currentPanel)switch(this._currentPanel){case"canvas":this.view.setAttributes("backgroundCanvas",{stroke:"black"});break;case"palette":this.view.setAttributes("backgroundPalette",{stroke:"black"});break;case"toolbar":this.view.setAttributes("backgroundToolbar",{stroke:"white"})}if(this._currentPanel=panelName,null!=this._currentPanel)switch(this._currentPanel){case"canvas":this.view.setAttributes("backgroundCanvas",{stroke:"blue"});break;case"palette":this.view.setAttributes("backgroundPalette",{stroke:"blue"});break;case"toolbar":this.view.setAttributes("backgroundToolbar",{stroke:"blue"})}return this.fireLazy("onAreaChange",{grid:this,name:panelName}),!0},Grid.prototype.getMode=function(){return this._currentMode},Grid.prototype.setMode=function(mode){if(!this.palette.moving&&(null==this._currentMode||mode!=this._currentMode||"move"!=mode)){mode==this._currentMode&&(mode="move");var currentButton;this._currentMode&&(currentButton=this.toolbar.getButton(this._currentMode))&&currentButton.deselect(),this._currentMode=mode,(currentButton=this.toolbar.getButton(this._currentMode))&&currentButton.select(),this.canvas.stopAction(),this.setModeCursor(),this.setModeHint(),this.fireLazy("onModeChange",{grid:this,name:mode})}},Grid.prototype.init=function(){var grid=this;if(this.getState()!=Grid.State.Uninitialized)throw Error("Grid has already been initialized.");this.view.subscribe("loaded",function(){grid._setState(Grid.State.Created),grid._svgRendered()}),this._setState(Grid.State.Initialized),this.view.render(this._element)},Grid.prototype.getLayout=function(){if(null==this.model||null==this.model.options)return null;var options=this.model.options,layout=new Grid.Layout;return layout.setContainerPadding(options.containerPaddingTop,options.containerPaddingRight,options.containerPaddingBottom,options.containerPaddingLeft),layout.setPaletteWidth(options.paletteWidth,options.paletteGutter),layout.setToolbarHeight(options.toolbarHeight,options.toolbarGutter),layout.setCanvasWidth(options.canvasWidth+options.canvasWidthExt),layout.setCanvasHeight(options.canvasHeight+options.canvasHeightExt),layout.setCanvasBorderOffset(options.canvasBorderOffset),layout.setFeedbackHeight(options.feedbackHeight,options.feedbackGutter),layout},Grid.prototype.update=function(){var options=this.model.options;if(options.updateLayout){var layout=this.getLayout();this.view.updateLayout(layout)}if(options.showGridLines?this.view.createGridLines(options.gridSpacing):this.view.clearGridLines(),options.showPalette?this.view.showPalette():this.view.hidePalette(),options.showFeedback?this.view.showFeedback():this.view.hideFeedback(),options.showToolbar&&options.showButtons.length>0){this.view.showToolbar();for(var buttonNames=["move"],i=0;i<options.showButtons.length;i++){var buttonName=options.showButtons[i];buttonNames.push(buttonName)}this.toolbar.enableButtons(buttonNames)}else this.view.hideToolbar(),this.toolbar.resetButtons();this.view.updateCenterScaleImage(options.paletteCenter,options.paletteScale),this.setMode("move")},Grid.prototype.loadXml=function(itemXml,responseXml){if(this._debug&&logger.info("LOAD ITEM XML = "+itemXml),this.getState()<Grid.State.Ready)throw Error("Grid is not ready to load (make sure to call init first).");this._setState(Grid.State.Loading);var grid=this,callbackFailure=function(message,values){grid._setState(Grid.State.Error,{message:message,values:values})},callbackLoaded=function(){grid.update(),responseXml&&(grid._debug&&logger.info("LOAD RESPONSE XML = "+responseXml),grid.importexport.loadAnswer(responseXml)),grid._setState(Grid.State.Loaded),grid.view.zoom(1)};this.importexport.loadItem(itemXml,function(){var svgImages=grid.view.getElementsByTagName("image");if(YAHOO.env.ua.gecko&&"function"==typeof ResourceLoader&&svgImages&&svgImages.length>0){for(var imageLoader=new ResourceLoader.ImageCollection,i=0;i<svgImages.length;i++)imageLoader.addImage(svgImages[i]);imageLoader.load(callbackLoaded,function(){var imageErrors=imageLoader.getErrors();callbackFailure("Error loading SVG images",imageErrors)})}else callbackLoaded()},callbackFailure)},Grid.prototype.getResponseXml=function(){return this.isLoaded()?this.importexport.getAnswerXml():null},Grid.prototype.isLoaded=function(){return this.getState()==Grid.State.Loaded},Grid.prototype.hasChanged=function(xml){if(!this.isLoaded())return!1;var cleanXml=function(xml){if(null==xml)return"";var values=xml.split("DOCTYPE");return values.length>1?values[1].split(" ").join("").split("\r").join(""):xml};return cleanXml(this.getResponseXml())!=cleanXml(xml)},Grid.prototype.isValid=function(){return!!(this.isLoaded()&&this.importexport&&this.importexport.isStudentResponseValid())},Grid.Hints={SetPoint:"Select locations of points",Connect:"Select 2 points to connect or press & drag to create & connect points.",Arrow:"Select 2 points to connect with arrow.",DoubleArrow:"Select 2 points to connect with double arrow.",Delete:"Select object to delete.",AddValue:"Select point or edge to add value",AddLabel:"Select location of label",AddComponent:"",MotionPending:"Move object to new location and click where you want it.",DraggingObject:"Release the mouse button to drop it where you want it.",WaitForDropDragging:"Release the mouse button to drop it where you want it.",WaitForDrop:"Click to drop the object where you want it.",None:" "},Grid.getHint=function(key){return"object"==typeof window.Messages?window.Messages.get("GridJS.Label.Hint"+key):Grid.Hints[key]||""},Grid.prototype.setHint=function(key){this.view.setFeedbackText(Grid.getHint(key))},Grid.prototype.setModeHint=function(){switch(this.getMode()){case"move":this.setHint("None");break;case"delete":this.setHint("Delete");break;case"point":this.setHint("SetPoint");break;case"connect":this.setHint("Connect");break;case"arrow":this.setHint("Arrow");break;case"arrw2":this.setHint("DoubleArrow");break;default:this.setHint("")}},Grid.prototype.setModeCursor=function(){switch(this.getMode()){case"move":this.view.setCanvasCursor("default");break;case"delete":this.view.setCanvasCursor("crosshair");break;case"arrow":case"arrw2":case"point":case"connect":this.view.setCanvasCursor("pointer");break;default:this.view.setCanvasCursor("default")}},Grid.prototype.addMouseListener=function(id,handler){var group=this.view.getElementById(id);if(!group)return!1;var grid=this,isClicked=!1,isDragging=!1,clickedPosition=null,mouseEventHandler=function(name,evt){evt.preventDefault();var clientX=evt.clientX-.5,clientY=evt.clientY-.5,currentPosition=grid.view.translateElement(group,clientX,clientY);(YAHOO.env.ua.ie||YAHOO.env.ua.ios)&&(currentPosition.x=Math.round(currentPosition.x),currentPosition.y=Math.round(currentPosition.y)),"mousedown"==name&&(clickedPosition=currentPosition);var callHandler=function(eventName){var svgEvent={name:eventName,target:evt.target,raw:evt,currentPosition:currentPosition,clickedPosition:clickedPosition,touch:!0===evt.touch};handler(svgEvent)};"mousedown"==name?isDragging?(callHandler("dragend"),isClicked=!1,isDragging=!1):(isClicked=!0,callHandler("mousedown")):"mousemove"==name?isClicked?(isDragging||(clickedPosition.x!=currentPosition.x||clickedPosition.y!=currentPosition.y)&&(callHandler("dragbegin"),isDragging=!0),isDragging&&callHandler("drag")):callHandler("mousemove"):"mouseup"==name&&(isDragging?(callHandler("dragend"),isDragging=!1):isClicked&&callHandler("mouseup"),isClicked=!1,clickedPosition=null),"mousedown"==name&&grid.view._svgWin.focus()};return Grid.Utils.addMouseListener(group,"mousedown",function(evt){mouseEventHandler("mousedown",evt)}),Grid.Utils.addMouseListener(group,"mousemove",function(evt){mouseEventHandler("mousemove",evt)}),Grid.Utils.addMouseListener(group,"mouseup",function(evt){mouseEventHandler("mouseup",evt)}),!0},Grid.prototype.dispose=function(){this.view&&this.view.dispose(),Grid.Events.fireLazy("onDispose",this)},Grid.prototype.validate=function(){if(0==YAHOO.env.ua.gecko)return!0;var setError=Util.bind(function(msg,modelImage){return"object"==typeof console&&console.error("GRID: "+msg),this._setState(GridState.Error,{message:msg,values:[modelImage]}),!1},this),modelImages=[];modelImages=(modelImages=(modelImages=modelImages.concat(this.model.getBackgroundImages())).concat(this.model.getImages())).concat(this.model.getRegionsImages());for(var i=0;i<modelImages.length;i++){var modelImage=modelImages[i],modelRect=modelImage.getBoundingRect();if(!(modelRect.left>=-1&&modelRect.left<=this.view.width&&modelRect.top>=-1&&modelRect.top<=this.view.height))return setError("Error with position of image out of bounds",modelImage);var svgImage=this.view.getElementById(modelImage.getID());if(!svgImage)return setError("Error finding the svg image",modelImage);if(modelImage.isVisible()){if("none"==svgImage.getAttribute("display"))return setError("Error with image it should be visible but it is hidden",modelImage)}else if("none"!=svgImage.getAttribute("display"))return setError("Error with image it should be hidden but it is visible",modelImage);var imgAttribs={x:1*svgImage.getAttribute("x"),y:1*svgImage.getAttribute("y"),width:1*svgImage.getAttribute("width"),height:1*svgImage.getAttribute("height")};if(modelRect.width!=imgAttribs.width||modelRect.height!=imgAttribs.height)return setError("Error with the attributes width/height of image",modelImage);if(modelRect.left!=imgAttribs.x||modelRect.top!=imgAttribs.y)return setError("Error with the attributes position of image",modelImage);var imgRect=null;if(modelImage.isVisible()&&"function"==typeof svgImage.getBBox)try{imgRect=svgImage.getBBox()}catch(ex){return setError("Error with image bounding box",modelImage)}if(imgRect){if(modelRect.width!=imgRect.width||modelRect.height!=imgRect.height)return setError("Error with the bounding box width/height of image",modelImage);if(modelRect.left!=imgRect.x||modelRect.top!=imgRect.y)return setError("Error with the bounding box position of image",modelImage)}}return!0},Grid.Utils={},Grid.Utils.hasSVGNative=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")},Grid.Utils.hasSVGWeb=function(){return"object"==typeof svgweb},Grid.Utils.isSVGFlash=function(){return Grid.Utils.hasSVGWeb()&&"flash"==svgweb.getHandlerType()},function(Utils){var touchScreen="ontouchstart"in window,touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},mouseEvents={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove"},getWindowsNTVersion=function(){var value,matches=navigator.userAgent.match(/Windows NT (\d+\.\d+)/);return matches&&matches[1]&&(value=parseFloat(matches[1])),value||0},supportsTouchAndMouse=function(){return touchScreen&&(getWindowsNTVersion()>=6.1||window.navigator.userAgent.indexOf("CrOS")>-1)},normalizeTouchEvent=function(evt){if(evt.changedTouches)for(var touches=evt.changedTouches,i=0,ii=touches.length;i<ii;i++)if(touches[i].target==evt.target){var oldevt=evt;return evt=touches[i],evt.preventDefault=function(){return oldevt.preventDefault()},evt.stopPropagation=function(){return oldevt.stopPropagation()},evt.touch=!0,evt}return evt};Utils.addMouseListener=function(target,name,fn){var eventName,altEventName,touchAndMouse=supportsTouchAndMouse();touchScreen?(eventName=touchEvents[name]||name,touchAndMouse&&(altEventName=mouseEvents[name]||name)):eventName=mouseEvents[name]||name;var processEvent=function(evt){touchAndMouse&&evt.preventDefault(),touchScreen&&(evt=normalizeTouchEvent(evt)),fn(evt)};eventName&&(target.addEventListener(eventName,processEvent,!1),altEventName&&target.addEventListener(altEventName,processEvent,!1))}}(Grid.Utils),Grid.Utils.importNode=function(doc,importedNode,deep){doc||(doc=document);var node=null;switch(importedNode.nodeType){case 1:var nodeNS=importedNode.namespaceURI;if(node="function"==typeof doc.createElementNS&&null!=nodeNS?doc.createElementNS(nodeNS,importedNode.nodeName):doc.createElement(importedNode.nodeName),Grid.Utils.importAttributes(importedNode,node),deep&&importedNode.childNodes&&importedNode.childNodes.length>0)for(var i=0,il=importedNode.childNodes.length;i<il;i++){var childNode=Grid.Utils.importNode(doc,importedNode.childNodes[i],deep);childNode&&node.appendChild(childNode)}break;case 3:node=doc.createTextNode(importedNode.nodeValue,!0)}return node},Grid.Utils.importAttributes=function(importedNode,node){if(importedNode.attributes&&importedNode.attributes.length>0)for(var i=0,il=importedNode.attributes.length;i<il;i++){var attrNS=importedNode.attributes[i].namespaceURI,attrName=importedNode.attributes[i].nodeName;if(null==node.getAttribute(attrName)){var attrValue=importedNode.getAttribute(attrName);"function"==typeof node.setAttributeNS&&null!=attrNS?node.setAttributeNS(attrNS,attrName,attrValue):node.setAttribute(attrName,attrValue)}}},Grid.Utils.getOffset=function(element){var hasClientRects=!1;try{hasClientRects=element&&"function"==typeof element.getClientRects}catch(ex){}return hasClientRects?{top:element.getClientRects()[0].top,left:element.getClientRects()[0].left}:{top:0,left:0}},Grid.Utils.getOffsetAdv=function(elem){if(!("getBoundingClientRect"in document.documentElement))return{top:0,left:0};var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0;return{top:box.top+(self.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,left:box.left+(self.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft}},Grid.Utils.fixOffset=function(svgObject){var element=svgObject,elements=[];do{elements.push(element)}while(element=function(){var doc;try{doc=element.ownerDocument}catch(ex){return null}var win=doc.parentWindow||doc.defaultView;try{return win.frameElement}catch(ex){return null}}());elements.reverse();for(var top=0,left=0,i=0;i<elements.length;i++){var offset=Grid.Utils.getOffset(elements[i]);offset&&(top+=Math.ceil(offset.top)-offset.top,left+=Math.ceil(offset.left)-offset.left)}top>0&&YAHOO.util.Dom.setStyle(svgObject,"margin-top",top+"px"),left>0&&YAHOO.util.Dom.setStyle(svgObject,"margin-left",left+"px")},Grid.Utils.parseElementXY=function(el){var getFloat=function(attrib){var value=el.getAttribute(attrib);return null==value?0:parseFloat(value)},data={};return"circle"==el.nodeName?(data.x=getFloat("cx"),data.y=getFloat("cy"),data.radius=getFloat("r")):"line"==el.nodeName?(data.x1=getFloat("x1"),data.y1=getFloat("y1"),data.x2=getFloat("x2"),data.y2=getFloat("y2")):"image"==el.nodeName||"rect"==el.nodeName?(data.x=getFloat("x"),data.y=getFloat("y"),data.width=getFloat("width"),data.height=getFloat("height")):(data.x=getFloat("x"),data.y=getFloat("y")),data.thickness=getFloat("stroke-width"),data},Grid.Utils.getNearestPointAlongLine=function(px,py,x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;if(0==dx&&0==dy)return{x:x1,y:y1};var t=((px-x1)*dx+(py-y1)*dy)/(dx*dx+dy*dy);return t<0?(dx=x1,dy=y1):t>1?(dx=x2,dy=y2):(dx=x1+t*dx,dy=y1+t*dy),new Point2D(dx,dy)};var crToolMouseDownPoint={x:-1,y:-1},crToolMouseDragPoint={x:-1,y:-1},crToolMouseUpPoint={x:-1,y:-1},CRToolMode={Test:0,Question:1,Dot:2,Rectangle:3,Circle:4,NoAction:5,Hotspots:6};CRTool.prototype.setMode=function(mode){this.mode=mode,this.resetCRToolData(),this.clearCRToolUI(),this.paletteAndSnapPointUIControl()},CRTool.prototype.getMode=function(){return this.mode},CRTool.prototype.processBackgroundImage=function(evt){if("mousedown"==evt.name&&null!=evt.target){if((entity=this.grid.model.getEntity(evt.target.id))&&"backgroundimage"==entity.getType()){this.grid.canvas.setFocused(entity);id=this.grid.canvas._currentFocus.getID();return this._selectedBackgroundImage=this.grid.canvas._currentFocus,!0}return this.grid.canvas.clearFocused(),!1}if("drag"==evt.name){if(this._selectedBackgroundImage){var x=evt.currentPosition.x,y=evt.currentPosition.y;this._selectedBackgroundImage.moveTo(x,y,!0);var id=this._selectedBackgroundImage.getID(),entity=this._selectedBackgroundImage;return this.grid.view.moveImage(id,entity.x,entity.y,entity.width,entity.height,!0),!0}}else if("dragend"==evt.name&&this._selectedBackgroundImage){id=this._selectedBackgroundImage.getID();return this.grid.view.deselectImage(id),this._selectedBackgroundImage.x=this._selectedBackgroundImage.x-this._selectedBackgroundImage.width/2,this._selectedBackgroundImage.y=this._selectedBackgroundImage.y-this._selectedBackgroundImage.height,this._selectedBackgroundImage=null,!0}return!1},CRTool.prototype.resetCRToolData=function(){crToolMouseUpPoint.x=-1,crToolMouseUpPoint.y=-1,crToolMouseDragPoint.x=-1,crToolMouseDragPoint.y=-1,crToolMouseDownPoint.x=-1,crToolMouseDownPoint.y=-1},CRTool.prototype.clearCRToolUI=function(){for(var crtoolShapes=["crtool_rectangle","crtool_circle"],i=0;i<crtoolShapes.length;i++)removeChildren(crtoolShapes[i])},CRTool.prototype.paletteAndSnapPointUIControl=function(){this.getMode()==CRToolMode.Question?this.grid.model.options.paletteWidth>0&&!this.grid.model.options.showPalette&&this.grid.view.showPalette():(this.clearSnapPointsUI(),this.grid.model.options.showPalette?this.grid.view.showPalette():this.grid.view.hidePalette()),this.getMode()!=CRToolMode.Test&&this.showSnapPoints()},CRTool.prototype.setMouseDownPoint=function(x,y){crToolMouseUpPoint.x=-1,crToolMouseUpPoint.y=-1,crToolMouseDragPoint.x=-1,crToolMouseDragPoint.y=-1,crToolMouseDownPoint.x=x,crToolMouseDownPoint.y=y},CRTool.prototype.setMouseDragPoint=function(x,y){crToolMouseDragPoint.x=x,crToolMouseDragPoint.y=y},CRTool.prototype.setMouseUpPoint=function(x,y){crToolMouseUpPoint.x=x,crToolMouseUpPoint.y=y},CRTool.prototype.getCRToolData=function(type){return"mousedown"==type?crToolMouseDownPoint.x+","+crToolMouseDownPoint.y:"drag"==type?crToolMouseDragPoint.x+","+crToolMouseDragPoint.y:"dragend"==type?crToolMouseUpPoint.x+","+crToolMouseUpPoint.y:"-1,-1"},CRTool.prototype.setCRToolMouseLocation=function(evt){var x=Math.round(evt.currentPosition.x),y=Math.round(evt.currentPosition.y);"mousedown"==evt.name?this.setMouseDownPoint(x,y):"drag"==evt.name?this.setMouseDragPoint(x,y):"mouseup"!=evt.name&&"dragend"!=evt.name||this.setMouseUpPoint(x,y)},CRTool.prototype.updateCRToolUI=function(evt){if("mousemove"!=evt.name)if(this.mode==CRToolMode.Rectangle)this.dataReady("mousedown")&&this.dataReady("mouseup")?this.drawCRToolRectangle(crToolMouseDownPoint.x,crToolMouseDownPoint.y,crToolMouseUpPoint.x,crToolMouseUpPoint.y):this.dataReady("mousedown")&&this.dataReady("drag")&&this.drawCRToolRectangle(crToolMouseDownPoint.x,crToolMouseDownPoint.y,crToolMouseDragPoint.x,crToolMouseDragPoint.y);else if(this.mode==CRToolMode.Circle){if(this.dataReady("mousedown")&&this.dataReady("mouseup")){r=Math.sqrt(Math.pow(crToolMouseDownPoint.x-crToolMouseUpPoint.x,2)+Math.pow(crToolMouseDownPoint.y-crToolMouseUpPoint.y,2));this.drawCRToolCircle(crToolMouseDownPoint.x,crToolMouseDownPoint.y,r)}else if(this.dataReady("mousedown")&&this.dataReady("drag")){var r=Math.sqrt(Math.pow(crToolMouseDownPoint.x-crToolMouseDragPoint.x,2)+Math.pow(crToolMouseDownPoint.y-crToolMouseDragPoint.y,2));this.drawCRToolCircle(crToolMouseDownPoint.x,crToolMouseDownPoint.y,r)}}else if(this.mode==CRToolMode.Question){if(!this.getSnapToPointFlag())return;if(this.dataReady("mousedown")&&this.dataReady("mouseup")&&crToolMouseDownPoint.x==crToolMouseUpPoint.x&&crToolMouseDownPoint.y==crToolMouseUpPoint.y){this.grid.model.addSnapPoint(crToolMouseDownPoint.x,crToolMouseDownPoint.y,this.getSnapToPointRadius());this.resetCRToolData(),this.showSnapPoints()}}},CRTool.prototype.showSnapPoints=function(){var snapPnts=this.grid.model.getSnapPoints();if(this.clearSnapPointsUI(),snapPnts&&snapPnts.length>0)for(var i=0;i<snapPnts.length;i++){var id=snapPnts[i].getID();this.grid.view.createSnapToPointAndCircle(snapPnts[i].x,snapPnts[i].y,this.getSnapToPointRadius(),id)}},CRTool.prototype.clearSnapPointsUI=function(){removeChildren("crtool_snapcenter"),removeChildren("crtool_snapcircle")},CRTool.prototype.drawCRToolCircle=function(x,y,r){this.clearCRToolUI(),this.grid.view.createCRToolCircle(x,y,r)},CRTool.prototype.drawCRToolRectangle=function(x1,y1,x2,y2){this.clearCRToolUI(),this.grid.view.createCRToolRectangle(x1,y1,x2,y2)},CRTool.prototype.crToolDrawDot=function(x,y){},CRTool.prototype.getSnapToPointFlag=function(){return document.getElementById("snapToPoint").checked},CRTool.prototype.getSnapToPointRadius=function(){return document.getElementById("snapPointRadius").value},CRTool.prototype.deleteSnapPoint=function(evt){for(var snapPoints=this.grid.model.getSnapPoints(),i=0;i<snapPoints.length;i++)if("snapPointCenter_snappoint_"+snapPoints[i]._id==evt.target.id)return this.grid.view.removeElement(evt.target.id),this.grid.view.removeElement("snapPointCircle_snappoint_"+snapPoints[i]._id),this.grid.model.deleteSnapPoint(snapPoints[i]),this.showSnapPoints(),!0;return!1},CRTool.prototype.dataReady=function(type){return"mousedown"==type&&crToolMouseDownPoint.x>=0&&crToolMouseDownPoint.y>=0||("drag"==type&&crToolMouseDragPoint.x>=0&&crToolMouseDragPoint.y>=0||"mouseup"==type&&crToolMouseUpPoint.x>=0&&crToolMouseUpPoint.y>=0)},CRTool.prototype.listStaticGridImages=function(){for(var bkgImages=this.grid.model.getBackgroundImages(),imageList="",i=0;i<bkgImages.length;i++)imageList+=translateImageLinkToDisplayName(function(urlFile){if(-1==urlFile.indexOf("localhost"))return index=urlFile.lastIndexOf("/"),"../NET/WebGraphicReview/"+urlFile.substring(index+1);var pathname=window.location.pathname,index=pathname.lastIndexOf("/");return pathname=pathname.substring(0,index),pathname=window.location.protocol+"//"+window.location.host+pathname,-1!=(index=urlFile.indexOf(pathname))?urlFile.substring(pathname.length+1):urlFile}(bkgImages[i].url)+"|"+bkgImages[i].x+","+bkgImages[i].y),i!=bkgImages.length-1&&(imageList+=";");return imageList},CRTool.prototype.crToolGetGridPoint=function(){var CanvasHeight=this.grid.model.options.canvasHeight;return-1==crToolMouseDownPoint.x||-1==crToolMouseUpPoint.x?"0,0":crToolMouseDownPoint.x==crToolMouseUpPoint.x&&crToolMouseDownPoint.y==crToolMouseUpPoint.y?crToolMouseDownPoint.x+","+(CanvasHeight-crToolMouseDownPoint.y):"0,0"},CRTool.prototype.crToolGetCenterAndTolerance=function(){var CanvasHeight=this.grid.model.options.canvasHeight;if(-1!=crToolMouseDownPoint.x&&-1!=crToolMouseUpPoint.x){var tol=Math.sqrt(Math.pow(crToolMouseDownPoint.x-crToolMouseUpPoint.x,2)+Math.pow(crToolMouseDownPoint.y-crToolMouseUpPoint.y,2));return tol=Math.round(tol),Math.round(crToolMouseDownPoint.x)+","+(CanvasHeight-Math.round(crToolMouseDownPoint.y))+","+tol}return"0,0,0"},CRTool.prototype.crToolGetArea=function(){var CanvasHeight=this.grid.model.options.canvasHeight;return-1!=crToolMouseDownPoint.x&&-1!=crToolMouseUpPoint.x?crToolMouseDownPoint.x+","+(CanvasHeight-crToolMouseDownPoint.y)+","+crToolMouseUpPoint.x+","+(CanvasHeight-crToolMouseUpPoint.y):"0,0,0,0"},CRTool.prototype.SetSnapToPointRadius=function(radius){for(var snapPoints=this.grid.model.getSnapPoints(),i=0;i<snapPoints.length;i++)snapPoints[i].snapRadius=radius},CRTool.prototype.setCenterImage=function(onoff){this.grid.view.paletteCenter=onoff,this.grid.model.options.paletteCenter=onoff,this.grid.view._updatePaletteLayout()},CRTool.prototype.setScaleImage=function(onoff){this.grid.view.paletteScale=onoff,this.grid.model.options.paletteScale=onoff,this.grid.view._updatePaletteLayout()};var crToolCanvsComponent={processMouseEvent:function(evt){var crtool=getGridCRtoolObject();if(null!=crtool)if(crtool.getMode()==CRToolMode.Question){var btnMode=getGridObject().getMode();"move"==btnMode?crtool.getSnapToPointFlag()&&(crtool.setCRToolMouseLocation(evt),crtool.updateCRToolUI(evt)):"delete"==btnMode&&"mousedown"==evt.name&&crtool.deleteSnapPoint(evt)}else crtool.setCRToolMouseLocation(evt),crtool.updateCRToolUI(evt)}};Point2D.prototype.clone=function(){return new Point2D(this.x,this.y)},Point2D.prototype.add=function(that){return new Point2D(this.x+that.x,this.y+that.y)},Point2D.prototype.addEquals=function(that){return this.x+=that.x,this.y+=that.y,this},Point2D.prototype.offset=function(a,b){var result=0;if(!(b.x<=this.x||this.x+a.x<=0)){var s,d;b.x*a.y-a.x*b.y>0?d=this.x<0?(s=this.x*a.y)/a.x-this.y:this.x>0?(s=this.x*b.y)/b.x-this.y:-this.y:b.x<this.x+a.x?(s=(b.x-this.x)*a.y,d=b.y-(this.y+s/a.x)):d=b.x>this.x+a.x?(s=(a.x+this.x)*b.y)/b.x-(this.y+a.y):b.y-(this.y+a.y),d>0&&(result=d)}return result},Point2D.prototype.rmoveto=function(dx,dy){this.x+=dx,this.y+=dy},Point2D.prototype.scalarAdd=function(scalar){return new Point2D(this.x+scalar,this.y+scalar)},Point2D.prototype.scalarAddEquals=function(scalar){return this.x+=scalar,this.y+=scalar,this},Point2D.prototype.subtract=function(that){return new Point2D(this.x-that.x,this.y-that.y)},Point2D.prototype.subtractEquals=function(that){return this.x-=that.x,this.y-=that.y,this},Point2D.prototype.scalarSubtract=function(scalar){return new Point2D(this.x-scalar,this.y-scalar)},Point2D.prototype.scalarSubtractEquals=function(scalar){return this.x-=scalar,this.y-=scalar,this},Point2D.prototype.multiply=function(scalar){return new Point2D(this.x*scalar,this.y*scalar)},Point2D.prototype.multiplyEquals=function(scalar){return this.x*=scalar,this.y*=scalar,this},Point2D.prototype.divide=function(scalar){return new Point2D(this.x/scalar,this.y/scalar)},Point2D.prototype.divideEquals=function(scalar){return this.x/=scalar,this.y/=scalar,this},Point2D.prototype.compare=function(that){return this.x-that.x||this.y-that.y},Point2D.prototype.eq=function(that){return this.x==that.x&&this.y==that.y},Point2D.prototype.lt=function(that){return this.x<that.x&&this.y<that.y},Point2D.prototype.lte=function(that){return this.x<=that.x&&this.y<=that.y},Point2D.prototype.gt=function(that){return this.x>that.x&&this.y>that.y},Point2D.prototype.gte=function(that){return this.x>=that.x&&this.y>=that.y},Point2D.prototype.distanceFrom=function(that){var dx=this.x-that.x,dy=this.y-that.y;return Math.sqrt(dx*dx+dy*dy)},Point2D.prototype.min=function(that){return new Point2D(Math.min(this.x,that.x),Math.min(this.y,that.y))},Point2D.prototype.max=function(that){return new Point2D(Math.max(this.x,that.x),Math.max(this.y,that.y))},Point2D.prototype.toString=function(){return this.x+","+this.y},Point2D.prototype.setXY=function(x,y){this.x=x,this.y=y},Point2D.prototype.setFromPoint=function(that){this.x=that.x,this.y=that.y},Point2D.prototype.swap=function(that){var x=this.x,y=this.y;this.x=that.x,this.y=that.y,that.x=x,that.y=y},Point2D.prototype.lerp=function(that,t){return new Point2D(this.x+(that.x-this.x)*t,this.y+(that.y-this.y)*t)},Intersection.prototype.init=function(status){this.status=status,this.points=new Array},Intersection.prototype.appendPoint=function(point){this.points.push(point)},Intersection.prototype.appendPoints=function(points){this.points=this.points.concat(points)},Intersection.intersectCircleCircle=function(c1,r1,c2,r2){var result,r_max=r1+r2,r_min=Math.abs(r1-r2),c_dist=c1.distanceFrom(c2);if(c_dist>r_max)result=new Intersection("Outside");else if(c_dist<r_min)result=new Intersection("Inside");else{result=new Intersection("Intersection");var a=(r1*r1-r2*r2+c_dist*c_dist)/(2*c_dist),h=Math.sqrt(r1*r1-a*a),p=c1.lerp(c2,a/c_dist),b=h/c_dist;result.points.push(new Point2D(p.x-b*(c2.y-c1.y),p.y+b*(c2.x-c1.x))),result.points.push(new Point2D(p.x+b*(c2.y-c1.y),p.y-b*(c2.x-c1.x)))}return result},Intersection.intersectCircleLine=function(c,r,a1,a2){var result,a=(a2.x-a1.x)*(a2.x-a1.x)+(a2.y-a1.y)*(a2.y-a1.y),b=2*((a2.x-a1.x)*(a1.x-c.x)+(a2.y-a1.y)*(a1.y-c.y)),deter=b*b-4*a*(c.x*c.x+c.y*c.y+a1.x*a1.x+a1.y*a1.y-2*(c.x*a1.x+c.y*a1.y)-r*r);if(deter<0)result=new Intersection("Outside");else if(0==deter)result=new Intersection("Tangent");else{var e=Math.sqrt(deter),u1=(-b+e)/(2*a),u2=(-b-e)/(2*a);(u1<0||u1>1)&&(u2<0||u2>1)?result=new Intersection(u1<0&&u2<0||u1>1&&u2>1?"Outside":"Inside"):(result=new Intersection("Intersection"),0<=u1&&u1<=1&&result.points.push(a1.lerp(a2,u1)),0<=u2&&u2<=1&&result.points.push(a1.lerp(a2,u2)))}return result},Intersection.intersectLineLine=function(a1,a2,b1,b2){var result,ua_t=(b2.x-b1.x)*(a1.y-b1.y)-(b2.y-b1.y)*(a1.x-b1.x),ub_t=(a2.x-a1.x)*(a1.y-b1.y)-(a2.y-a1.y)*(a1.x-b1.x),u_b=(b2.y-b1.y)*(a2.x-a1.x)-(b2.x-b1.x)*(a2.y-a1.y);if(0!=u_b){var ua=ua_t/u_b,ub=ub_t/u_b;0<=ua&&ua<=1&&0<=ub&&ub<=1?(result=new Intersection("Intersection")).points.push(new Point2D(a1.x+ua*(a2.x-a1.x),a1.y+ua*(a2.y-a1.y))):result=new Intersection("No Intersection")}else result=new Intersection(0==ua_t||0==ub_t?"Coincident":"Parallel");return result},Intersection.intersectRectangleRectangle=function(a1,a2,b1,b2){var min=a1.min(a2),max=a1.max(a2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectLineRectangle(min,topRight,b1,b2),inter2=Intersection.intersectLineRectangle(topRight,max,b1,b2),inter3=Intersection.intersectLineRectangle(max,bottomLeft,b1,b2),inter4=Intersection.intersectLineRectangle(bottomLeft,min,b1,b2),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Intersection.intersectCircleRectangle=function(c,r,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectCircleLine(c,r,min,topRight),inter2=Intersection.intersectCircleLine(c,r,topRight,max),inter3=Intersection.intersectCircleLine(c,r,max,bottomLeft),inter4=Intersection.intersectCircleLine(c,r,bottomLeft,min),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0?result.status="Intersection":result.status=inter1.status,result},Intersection.intersectLineRectangle=function(a1,a2,r1,r2){var min=r1.min(r2),max=r1.max(r2),topRight=new Point2D(max.x,min.y),bottomLeft=new Point2D(min.x,max.y),inter1=Intersection.intersectLineLine(min,topRight,a1,a2),inter2=Intersection.intersectLineLine(topRight,max,a1,a2),inter3=Intersection.intersectLineLine(max,bottomLeft,a1,a2),inter4=Intersection.intersectLineLine(bottomLeft,min,a1,a2),result=new Intersection("No Intersection");return result.appendPoints(inter1.points),result.appendPoints(inter2.points),result.appendPoints(inter3.points),result.appendPoints(inter4.points),result.points.length>0&&(result.status="Intersection"),result},Grid.Model=function(id,options){this.id=id||"",this.options=options||new Grid.Model.Options,this._uuid=0,this.questionPartID=1,this.description="",this.defaultRadius=5,this._collection=[],this._cache={},this._addCache=function(id,obj){this._cache[id]=obj},this._removeCache=function(id){this._cache[id]=null},this._points=[],this._snappoints=[],this._lines=[],this._paletteimages=[],this._canvasimages=[],this._staticimages=[],this._backgroundimages=[],this._labels=[],this._rectangles=[],this._circles=[],this._regions=[],this._regionGroups=[],this.importing=!1,this._listenForCacheEvents(),this._instance=++Grid.Model._instances},YAHOO.lang.augmentProto(Grid.Model,EventLazyProvider),Grid.Model.arrayRemoveAt=function(arr,i){return 1==Array.prototype.splice.call(arr,i,1).length},Grid.Model.arrayRemove=function(arr,obj){var rv,i=arr.indexOf(obj);return(rv=i>=0)&&Grid.Model.arrayRemoveAt(arr,i),rv},Grid.Model._instances=0,Grid.Model.getEmptyStyles=function(){return{fill:"white","fill-opacity":"0",stroke:"white","stroke-width":"0","stroke-opacity":"","stroke-dasharray":""}},Grid.Model.getDefaultStyles=function(){return{fill:"white","fill-opacity":"0",stroke:"red","stroke-width":"1","stroke-opacity":"","stroke-dasharray":""}},Grid.Model.prototype._createUUID=function(){(new Date).getTime(),Math.random().toString().split(".")[1];return++this._uuid},Grid.Model.prototype._listenForCacheEvents=function(){var model=this;this.subscribe("onAdd",function(entity){var id=entity.getID();model._cache[id]=entity,model._collection.push(entity)}),this.subscribe("onDelete",function(entity){var id=entity.getID();delete model._cache[id],Grid.Model.arrayRemove(model._collection,entity)})},Grid.Model.prototype._hasString=function(id){return Lang.isString(id)&&id.length>0},Grid.Model.prototype.deleteEntity=function(entityToDelete){var collectionName="_"+entityToDelete.getType()+"s";null!=this[collectionName]&&Grid.Model.arrayRemove(this[collectionName],entityToDelete),this.fireLazy("onDelete",entityToDelete)},Grid.Model.prototype.clearResponse=function(){for(;this._snappoints.length>0;)this.deleteSnapPoint(this._snappoints[0]);for(;this._points.length>0;)this.deletePoint(this._points[0]);for(;this._canvasimages.length>0;)this.deleteImage(this._canvasimages[0]);for(;this._circles.length>0;)this.deleteCircle(this._circles[0]);for(var i=0;i<this._regions.length;i++){var region=this._regions[i];region.isSelected()&&region.deselect()}},Grid.Model.prototype.clearQuestion=function(){for(this.clearResponse();this._snappoints.length>0;)this.deleteSnapPoint(this._snappoints[0]);for(;this._paletteimages.length>0;)this.deletePaletteImage(this._paletteimages[0]);for(;this._backgroundimages.length>0;)this.deleteBackgroundImage(this._backgroundimages[0]);for(;this._staticimages.length>0;)this.deleteStaticImage(this._staticimages[0]);for(;this._regionGroups.length>0;)this.deleteRegionGroup(this._regionGroups[0],!0);this.options=new Grid.Model.Options},Grid.Model.prototype.getEntity=function(id){return null==id||""==id?null:this._cache[id]||null},Grid.Model.prototype.getEntities=function(){return this._collection},Grid.Model.prototype.addEntity=function(entity){this.fireLazy("onAdd",entity)},Grid.Model.prototype.addPoint=function(x,y){var radius=arguments[2]>0?arguments[2]:this.defaultRadius,point=new Grid.Model.Point(this,x,y,radius);return this._points.push(point),this.fireLazy("onAdd",point),point},Grid.Model.prototype.getPoints=function(){return this._points},Grid.Model.prototype.deletePoint=function(point){for(var i=0;i<this._points.length;i++)if(point==this._points[i]){for(var pointLines=point.getLines(),j=0;j<pointLines.length;j++){var line=pointLines[j];this.deleteLine(line)}return Grid.Model.arrayRemoveAt(this._points,i),this.fireLazy("onDelete",point),!0}return!1},Grid.Model.prototype.getLines=function(){return this._lines},Grid.Model.prototype.addLine=function(source,target,dirType,style){if(!source||!target)throw new Error("Invalid source or target point");if(source==target)return null;for(var i=0;i<this._lines.length;i++){var existingLine=this._lines[i];if(source==existingLine.source&&target==existingLine.target)return existingLine;if(target==existingLine.source&&source==existingLine.target)return existingLine}var line=new Grid.Model.Line(this,source,target,dirType,style,this.options.properLineGeometry);return this._lines.push(line),this.fireLazy("onAdd",line),line},Grid.Model.prototype.getLinesByDir=function(dirType){for(var lineDirections=[],i=0;i<this._lines.length;i++){var line=this._lines[i];line.dirType==dirType&&lineDirections.push(line)}return lineDirections},Grid.Model.prototype.deleteLine=function(line){return this.deleteEntity(line)},Grid.Model.prototype.getSnapPoints=function(){return this._snappoints},Grid.Model.prototype.addSnapPoint=function(x,y,snapRadius){var snapPoint=new Grid.Model.SnapPoint(this,x,y,this.defaultRadius,snapRadius);return this._snappoints.push(snapPoint),this.fireLazy("onAdd",snapPoint),snapPoint},Grid.Model.prototype.deleteSnapPoint=function(snapPoint){return this.deleteEntity(snapPoint)},Grid.Model.prototype.getPaletteImages=function(){return this._paletteimages},Grid.Model.prototype.addPaletteImage=function(name,url,width,height){var paletteImage=new Grid.Model.PaletteImage(this,name,url,width,height);return this._paletteimages.push(paletteImage),this.fireLazy("onAdd",paletteImage),paletteImage},Grid.Model.prototype.deletePaletteImage=function(paletteImage){var canvasImages=paletteImage.getImages();this.deleteEntity(paletteImage);for(var i=0;i<canvasImages.length;i++)this.deleteEntity(canvasImages[0])},Grid.Model.prototype.getImages=function(){return this._canvasimages},Grid.Model.prototype.addImage=function(name,x,y){if(!Lang.isString(name)||0==name.length)return null;for(var paletteImage=null,i=0;i<this._paletteimages.length;i++)if(name==this._paletteimages[i].name){paletteImage=this._paletteimages[i];break}if(null==paletteImage)throw new Error("Cannot add the image "+name+" because the palette image does not exist.");var image=new Grid.Model.Image(this,name,x,y,paletteImage.width,paletteImage.height);return this._canvasimages.push(image),this.fireLazy("onAdd",image),image},Grid.Model.prototype.deleteImage=function(image){return this.deleteEntity(image)},Grid.Model.prototype.getStaticImages=function(){return this._staticimages},Grid.Model.prototype.addStaticImage=function(url,x,y,width,height){var staticImage=new Grid.Model.StaticImage(this,url,x,y,width,height);return this._staticimages.push(staticImage),this.fireLazy("onAdd",staticImage),staticImage},Grid.Model.prototype.deleteStaticImage=function(staticImage){return this.deleteEntity(staticImage)},Grid.Model.prototype.getBackgroundImages=function(){return this._backgroundimages},Grid.Model.prototype.addBackgroundImage=function(url,x,y,width,height){var backgroundImage=new Grid.Model.BackgroundImage(this,url,x,y,width,height);return this._backgroundimages.push(backgroundImage),this.fireLazy("onAdd",backgroundImage),backgroundImage},Grid.Model.prototype.deleteBackgroundImage=function(backgroundImage){return this.deleteEntity(backgroundImage)},Grid.Model.prototype.getRectangles=function(){return this._rectangles},Grid.Model.prototype.createRectangle=function(x1,y1,x2,y2){var width=x2-x1,height=y2-y1;return new Grid.Model.Rectangle(this,x1,y1,width,height)},Grid.Model.prototype.addRectangle=function(rect){if(!(rect instanceof Grid.Model.Rectangle))throw new Error("Can only add valid rectangle objects.");return this._rectangles.push(rect),this.fireLazy("onAdd",rect),rect},Grid.Model.prototype.getCircles=function(){return this._circles},Grid.Model.prototype.createCircle=function(x,y,radius){return new Grid.Model.Circle(this,x,y,radius)},Grid.Model.prototype.addCircle=function(circle){if(!(circle instanceof Grid.Model.Circle))throw new Error("Can only add valid circle objects.");return this._circles.push(circle),this.fireLazy("onAdd",circle),circle},Grid.Model.prototype.deleteCircle=function(circle){return this.deleteEntity(circle)},Grid.Model.prototype.getLabels=function(){return this._labels},Grid.Model.prototype.addLabel=function(x,y,text,fontSize,fontFamily){var label=new Grid.Model.Label(this,x,y,text,fontSize,fontFamily);return this._labels.push(label),this.fireLazy("onAdd",label),label},Grid.Model.prototype.getRegionGroups=function(){return this._regionGroups},Grid.Model.prototype.getRegionGroup=function(name){for(var regionGroups=grid.model.getRegionGroups(),i=0;i<regionGroups.length;i++){var group=regionGroups[i];if(group.name==name)return group}return null},Grid.Model.prototype.createRegionGroup=function(name,min,max){var regionGroup=new Grid.Model.RegionGroup(this,name,min,max);return this._regionGroups.push(regionGroup),regionGroup},Grid.Model.prototype.deleteRegionGroup=function(group,deleteOrphans){for(var regions=group.getRegions();regions.length>0;)group.removeRegion(regions[0],deleteOrphans);Grid.Model.arrayRemove(this._regionGroups,group)},Grid.Model.prototype.createRegion=function(name,shape,coords){var region=null;switch(shape){case"rect":region=this._buildRegionRect(name);break;case"circle":region=this._buildRegionCircle(name);break;case"poly":region=this._buildRegionPolygon(name)}return null!=region&&(region.setHoverable(!0),region.setFocusable(Grid.Model.Focusable.Auto),region.setSelectable(!0),region.setMoveable(!1),this.addEntity(region),this._regions.push(region),YAHOO.lang.isString(coords)&&region.setCoords(coords)),region},Grid.Model.prototype._buildRegionRect=function(name){return new(Grid.Model.buildRegion(Grid.Model.Rectangle,name))(this,0,0,0,0)},Grid.Model.prototype._buildRegionCircle=function(name){return new(Grid.Model.buildRegion(Grid.Model.Circle,name))(this,0,0,0)},Grid.Model.prototype._buildRegionPolygon=function(name){return new(Grid.Model.buildRegion(Grid.Model.Polygon,name))(this)},Grid.Model.prototype.deleteRegion=function(region){for(var events=region.getEvents(),i=0;i<events.length;i++){var event=events[i];region.deleteEvent(event)}Grid.Model.arrayRemove(this._regions,region),this.deleteEntity(region)},Grid.Model.prototype.getRegions=function(){return this._regions},Grid.Model.prototype.getRegion=function(name){for(var i=0;i<this._regions.length;i++){var region=this._regions[i];if(region.name==name)return region}return null},Grid.Model.prototype.getRegionsImages=function(){for(var regionImages=[],regions=this.getRegions(),i=0;i<regions.length;i++)for(var regionEvents=regions[i].getEvents(),j=0;j<regionEvents.length;j++){var eventImage=regionEvents[j].getImage();null!=eventImage&&regionImages.push(eventImage)}return regionImages},Grid.Model.Options=function(){this.updateLayout=!0,this.containerPaddingTop=0,this.containerPaddingRight=1,this.containerPaddingBottom=1,this.containerPaddingLeft=0,this.showPalette=!1,this.paletteWidth=75,this.paletteGutter=5,this.paletteCenter=!1,this.paletteScale=!1,this.showToolbar=!0,this.toolbarHeight=21,this.toolbarGutter=4,this.showButtons=[],this.canvasWidth=500,this.canvasWidthExt=2,this.canvasHeight=410,this.canvasHeightExt=1,this.canvasBorderOffset=-1,this.properLineGeometry=!1,this.showGridLines=!1,this.gridColor="None",this.gridSpacing=0,this.snapToGrid=!1,this.snapRadius=0,this.selectionTolerance=10,this.showFeedback=!0,this.feedbackHeight=30,this.feedbackGutter=4},Grid.Model.Options.prototype.addButton=function(button){"delete"!=button&&"point"!=button&&"connect"!=button&&"arrow"!=button&&"arrw2"!=button&&"dash"!=button&&"circle"!=button||this.showButtons.push(button)},Grid.Model.Options.prototype.clearButtons=function(){this.showButtons=[]},Grid.Model.Base=function(model){if(!(model instanceof Grid.Model))throw new Error("The base class does not have a valid model.");this.model=model,this._id=model._instance+"_"+model._createUUID(),this._visible=!0,this._hoverable=!1,this._hovering=!1,this._focusable=Grid.Model.Focusable.Never,this._focused=!1,this._moveable=!1,this._deletable=!1,this._selectable=!1,this._selected=!1},Grid.Model.Focusable={Never:0,Manual:1,Auto:2},Grid.Model.Base.prototype.getType=function(){return this instanceof Grid.Model.BackgroundImage?"backgroundimage":this instanceof Grid.Model.StaticImage?"staticimage":this instanceof Grid.Model.PaletteImage?"paletteimage":this instanceof Grid.Model.Image?"canvasimage":this instanceof Grid.Model.Line?"line":this instanceof Grid.Model.SnapPoint?"snappoint":this instanceof Grid.Model.Point?"point":this instanceof Grid.Model.Circle?"circle":this instanceof Grid.Model.Rectangle?"rect":this instanceof Grid.Model.Polygon?"poly":this instanceof Grid.Model.Path?"path":this instanceof Grid.Model.Base?"base":"unknown"},Grid.Model.Base.prototype.getID=function(){return this.getType()+"_"+this._id},Grid.Model.Base.prototype.setVisible=function(visible){this._visible=visible},Grid.Model.Base.prototype.isVisible=function(){return this._visible},Grid.Model.Base.prototype.show=function(){this.setVisible(!0),this.update()},Grid.Model.Base.prototype.hide=function(){this.setVisible(!1),this.update()},Grid.Model.Base.prototype.setHoverable=function(hoverable){this._hoverable=hoverable},Grid.Model.Base.prototype.isHoverable=function(){return!!this.isVisible()&&this._hoverable},Grid.Model.Base.prototype.setHovering=function(hovering){this._hovering=hovering},Grid.Model.Base.prototype.isHovering=function(){return this._hovering},Grid.Model.Base.prototype.setFocusable=function(focusable){this._focusable=focusable},Grid.Model.Base.prototype.isFocusable=function(){return!!this.isVisible()&&this._focusable},Grid.Model.Base.prototype.setFocused=function(focused){this._focused=focused},Grid.Model.Base.prototype.isFocused=function(){return this._focused},Grid.Model.Base.prototype.setSelectable=function(selectable){this._selectable=selectable},Grid.Model.Base.prototype.isSelectable=function(){return this._selectable},Grid.Model.Base.prototype.isSelected=function(){return this._selected},Grid.Model.Base.prototype.select=function(){return!this.isSelected()&&(!!this.isSelectable()&&(this._selected=!0,this.update(),!0))},Grid.Model.Base.prototype.deselect=function(){return!!this.isSelected()&&(this._selected=!1,this.update(),!0)},Grid.Model.Base.prototype.setMoveable=function(moveable){this._moveable=moveable},Grid.Model.Base.prototype.isMoveable=function(){return this._moveable},Grid.Model.Base.prototype.setDeletable=function(deletable){this._deletable=deletable},Grid.Model.Base.prototype.isDeletable=function(){return this._deletable},Grid.Model.Base.prototype.update=function(){this.model.fireLazy("onUpdate",this)},Grid.Model.Base.prototype.setCoords=function(){},Grid.Model.Base.prototype.getStyles=function(){return Grid.Model.getDefaultStyles()},Grid.Model.Base.prototype.getElement=function(view){var id=this.getID();return view.getElementById(id)},Grid.Model.Base.prototype.createElement=function(view){return null},Grid.Model.Base.prototype.getElementGroup=function(){return"shapes"},Grid.Model.Base.prototype.appendElement=function(view,element){var groupId=this.getElementGroup();view.appendChild(groupId,element)},Grid.Model.Base.prototype.moveElement=function(view){},Grid.Model.Base.prototype.removeElement=function(view){var id=this.getID();view.removeElement(id)},Grid.Model.Base.prototype.updateElement=function(view){var element=this.getElement(view);if(null!=element){var styles=this.getStyles();view.setAttributes(element,styles);var visible=this.isVisible();view.setAttributes(element,{display:visible?"inline":"none"})}},Grid.Model.Position=function(model,x,y){Grid.Model.Position.superclass.constructor.call(this,model),this.x=x,this.y=y,this._boundsEnabled=!0,this._snapEnabled=!0},Lang.extend(Grid.Model.Position,Grid.Model.Base),Grid.Model.Position.prototype.get2D=function(){return new Point2D(this.x,this.y)},Grid.Model.Position.prototype.isBoundsEnabled=function(){return this._boundsEnabled},Grid.Model.Position.prototype.setBoundsEnabled=function(boundsEnabled){this._boundsEnabled=boundsEnabled},Grid.Model.Position.prototype.isSnapEnabled=function(){return this._snapEnabled},Grid.Model.Position.prototype.setSnapEnabled=function(snapEnabled){this._snapEnabled=snapEnabled},Grid.Model.Position.prototype.getFixedCoords=function(x,y){return{x:x,y:y}},Grid.Model.Position.prototype.moveTo=function(moveX,moveY,preventSnap){if(this.isBoundsEnabled()){var fixedCoords=this.getFixedCoords(moveX,moveY);moveX=fixedCoords.x,moveY=fixedCoords.y}return(moveX!=this.x||moveY!=this.y)&&(this.x=moveX,this.y=moveY,this.isSnapEnabled()&&!preventSnap&&this.snapToGrid(),this.model.fireLazy("onMove",this),!0)},Grid.Model.Position.prototype._moveBy=function(moveSize){var options=this.model.options;return options.snapToGrid&&options.gridSpacing>0?options.gridSpacing:moveSize},Grid.Model.Position.prototype.moveLeft=function(moveSize){return this.moveTo(this.x-this._moveBy(moveSize),this.y)},Grid.Model.Position.prototype.moveUp=function(moveSize){return this.moveTo(this.x,this.y-this._moveBy(moveSize))},Grid.Model.Position.prototype.moveRight=function(moveSize){return this.moveTo(this.x+this._moveBy(moveSize),this.y)},Grid.Model.Position.prototype.moveDown=function(moveSize){return this.moveTo(this.x,this.y+this._moveBy(moveSize))},Grid.Model.Position.prototype.distanceFrom=function(that){var p1=this.get2D(),p2=that.get2D();return p1.distanceFrom(p2)},Grid.Model.Position.prototype._getNearestSnapPoint=function(){for(var snapPoints=this.model.getSnapPoints(),closestSnapPoint=null,closestDistance=1/0,i=0;i<snapPoints.length;i++){var snapPoint=snapPoints[i],distance=this.distanceFrom(snapPoint);distance<=snapPoint.snapRadius&&distance<closestDistance&&(closestDistance=distance,closestSnapPoint=snapPoint)}return closestSnapPoint},Grid.Model.Position.prototype.snapToPoint=function(){var snapPoint=this._getNearestSnapPoint();return null!=snapPoint&&this.moveTo(snapPoint.x,snapPoint.y,!0)},Grid.Model.Position.prototype.snapToGrid=function(){var spacing=1,options=this.model.options;options.snapToGrid&&options.gridSpacing>0&&(spacing=options.gridSpacing);var fixedX=this.x,fixedY=this.y;this instanceof Grid.Model.Image&&(fixedX-=Math.round(this.width/2),fixedY-=this.height);var snappedX=Math.round(fixedX/spacing)*spacing,snappedY=Math.round(fixedY/spacing)*spacing;return this instanceof Grid.Model.Image&&(snappedX+=Math.round(this.width/2),snappedY+=this.height),this.moveTo(snappedX,snappedY,!0)},Grid.Model.Position.prototype.snap=function(){this.snapToPoint()||this.snapToGrid()},Grid.Model.Position.prototype.moveElement=function(view){var element=this.getElement(view);view.setAttributes(element,{x:this.x,y:this.y})},Grid.Model.Circle=function(model,x,y,radius){Grid.Model.Circle.superclass.constructor.call(this,model,x,y),this.radius=radius,this.setHoverable(!1),this.setFocusable(Grid.Model.Focusable.Manual),this.setMoveable(!0),this.setSelectable(!1)},Lang.extend(Grid.Model.Circle,Grid.Model.Position),Grid.Model.Circle.prototype.getList=function(){return this.model.getPoints()},Grid.Model.Circle.prototype.getBoundingRect=function(x,y){YAHOO.lang.isNumber(x)||(x=this.x),YAHOO.lang.isNumber(y)||(y=this.y);var width=2*this.radius,height=2*this.radius,topLeftX=x-this.radius,topLeftY=y-this.radius;return{width:width,height:height,left:topLeftX,top:topLeftY,right:topLeftX+width,bottom:topLeftY+height}},Grid.Model.Circle.prototype.getFixedCoords=function(moveX,moveY){var rect=this.getBoundingRect(moveX,moveY),canvasWidth=this.model.options.canvasWidth,canvasHeight=this.model.options.canvasHeight;return rect.left<0&&(moveX=this.radius),rect.top<0&&(moveY=this.radius),rect.right>canvasWidth&&(moveX=canvasWidth-this.radius),rect.bottom>canvasHeight&&(moveY=canvasHeight-this.radius),{x:moveX,y:moveY}},Grid.Model.Circle.prototype.intersect=function(that){var c1=this.get2D(),r1=this.radius,c2=that.get2D(),r2=that.radius;return"Outside"!=Intersection.intersectCircleCircle(c1,r1,c2,r2).status},Grid.Model.Circle.prototype.getIntersections=function(){for(var intersectingPoints=[],points=this.getList(),i=0;i<points.length;i++){var point=points[i];this!=point&&this.intersect(point)&&intersectingPoints.push(point)}return intersectingPoints},Grid.Model.Circle.prototype.setCoords=function(coords){coords=coords.split(",");for(var i=0;i<coords.length;i++)coords[i]=1*coords[i];this.x=coords[0],this.y=coords[1],this.radius=coords[2],this.update()},Grid.Model.Circle.prototype.getCoords=function(){return YAHOO.lang.substitute("{x}, {y}, {radius}",this)},Grid.Model.Circle.prototype.createElement=function(view){var id=this.getID(),circleElement=view.createElement("circle",{id:id});return this.appendElement(view,circleElement),circleElement},Grid.Model.Circle.prototype.updateElement=function(view){var circleElement=this.getElement(view);view.setAttributes(circleElement,{cx:this.x,cy:this.y,r:this.radius-.4}),Grid.Model.Circle.superclass.updateElement.call(this,view)},Grid.Model.Circle.prototype.moveElement=function(view){var circleElement=this.getElement(view);view.setAttributes(circleElement,{cx:this.x,cy:this.y})},Grid.Model.PolygonPoint=function(model,x,y){Grid.Model.PolygonPoint.superclass.constructor.call(this,model,x,y)},Lang.extend(Grid.Model.PolygonPoint,Grid.Model.Position),Grid.Model.PolygonPoint.prototype.toString=function(){return this.x+","+this.y},Grid.Model.Polygon=function(model){Grid.Model.Polygon.superclass.constructor.call(this,model,0,0),this._points=[],this._focusable=Grid.Model.Focusable.Manual,this._moveable=!0},Lang.extend(Grid.Model.Polygon,Grid.Model.Position),Grid.Model.Polygon.prototype.getPoints=function(){return this._points},Grid.Model.Polygon.prototype.addPoint=function(x,y){var point=new Grid.Model.PolygonPoint(this.model,x,y);this._points.push(point)},Grid.Model.Polygon.prototype.getCoords=function(){return this._points.join(" ")},Grid.Model.Polygon._path_regexp=new RegExp("-?[0-9.]+s*[, \t]s*-?[0-9.]+","ig"),Grid.Model.Polygon._parsePath=function(path){var points=[],tokens=path.match(Grid.Model.Polygon._path_regexp);if(YAHOO.lang.isArray(tokens))for(var i=0;i<tokens.length;i++){var xy=tokens[i].replace(/^\s+|\s+$/g,"").split(/[, \t]+/),x=parseFloat(xy[0]),y=parseFloat(xy[1]);points.push([x,y])}return points},Grid.Model.Polygon.prototype.setCoords=function(coords){this._points=[];for(var parsedPoints=Grid.Model.Polygon._parsePath(coords),i=0;i<parsedPoints.length;i++){var parsedPoint=parsedPoints[i];this.addPoint(parsedPoint[0],parsedPoint[1])}this._points.length>0&&(this.x=parsedPoints[0][0],this.y=parsedPoints[0][1]),this.update()},Grid.Model.Polygon.prototype.createElement=function(view){var id=this.getID(),polyElement=view.createElement("polygon",{id:id,points:this._points.join(" ")});return this.appendElement(view,polyElement),polyElement},Grid.Model.Polygon.prototype.moveElement=function(view){for(var polyElement=this.getElement(view),xDiff=0,yDiff=0,i=0;i<this._points.length;i++){var point=this._points[i];0==i?(xDiff=this.x-point.x,yDiff=this.y-point.y,point.x=this.x,point.y=this.y):(point.x+=xDiff,point.y+=yDiff)}view.setAttributes(polyElement,{points:this._points.join(" ")})},Grid.Model.Polygon.prototype.updateElement=function(view){this.moveElement(view),Grid.Model.Polygon.superclass.updateElement.call(this,view)},Grid.Model.Path=function(model,pathData){Grid.Model.Path.superclass.constructor.call(this,model),this.pathData=pathData,this._focusable=Grid.Model.Focusable.Manual},Lang.extend(Grid.Model.Path,Grid.Model.Base),Grid.Model.Path.prototype.createElement=function(view){var id=this.getID(),polyElement=view.createElement("path",{id:id});return this.appendElement(view,polyElement),this.updateElement(view),polyElement},Grid.Model.Path.prototype.updateElement=function(view){var polyElement=this.getElement(view);view.setAttributes(polyElement,{d:this.pathData}),Grid.Model.Path.superclass.updateElement.call(this,view)},Grid.Model.Point=function(model,x,y,radius){Grid.Model.Point.superclass.constructor.call(this,model,x,y,radius),this.radius=radius,this._transparent=!1},Lang.extend(Grid.Model.Point,Grid.Model.Circle),Grid.Model.Point.prototype.makeTransparent=function(transparent){this._transparent=transparent,this.update()},Grid.Model.Point.prototype.isTransparent=function(){return this._transparent},Grid.Model.Point.prototype.getBoundingRect=function(x,y){var rect=Grid.Model.Point.superclass.getBoundingRect.call(this,x,y);return rect.top-=this.radius,rect.bottom-=this.radius,rect},Grid.Model.Point.prototype.getFixedCoords=function(moveX,moveY){var rect=this.getBoundingRect(moveX,moveY),canvasWidth=this.model.options.canvasWidth,canvasHeight=this.model.options.canvasHeight;return rect.left<0&&(moveX=0),rect.top<0&&(moveY=0),rect.right>canvasWidth&&(moveX=canvasWidth),rect.bottom>canvasHeight&&(moveY=canvasHeight),{x:moveX,y:moveY}},Grid.Model.Point.prototype.moveTo=function(moveX,moveY,preventSnap){var moved=Grid.Model.Point.superclass.moveTo.call(this,moveX,moveY,preventSnap);if(moved)for(var lines=this.getLines(),i=0;i<lines.length;i++)this.model.fireLazy("onMove",lines[i]);return moved},Grid.Model.Point.prototype.getLines=function(){for(var pointLines=[],lines=this.model.getLines(),i=0;i<lines.length;i++){var line=lines[i];this!=line.source&&this!=line.target||pointLines.push(line)}return pointLines},Grid.Model.Point.prototype.moveLines=function(toPoint){if(!toPoint)return!1;for(var fromLines=this.getLines(),i=0;i<fromLines.length;i++){var fromLine=fromLines[i],isSource=fromLine.source==this;this.model.deleteLine(fromLine),isSource?this.model.addLine(toPoint,fromLine.target,fromLine.dirType):this.model.addLine(fromLine.source,toPoint,fromLine.dirType)}return!0},Grid.Model.Point.prototype._intersectLine=function(line){var c=this.get2D(),r=this.radius,a1=line.source.get2D(),a2=line.target.get2D();return"Outside"!=Intersection.intersectCircleLine(c,r,a1,a2).source},Grid.Model.Point.prototype.distanceFromLine=function(line){var px=this.x,py=this.y,x1=line.source.x,y1=line.source.y,x2=line.target.x,y2=line.target.y,nearestPoint=Grid.Utils.getNearestPointAlongLine(px,py,x1,y1,x2,y2);return this.get2D().distanceFrom(nearestPoint)},Grid.Model.Point.prototype.getStyles=function(){var styles={fill:"red",stroke:"blue","stroke-width":"0","stroke-dasharray":""};return this.isFocused()?styles["stroke-width"]="1":styles["stroke-width"]="0",this._transparent&&(styles.opacity="0"),styles},Grid.Model.Point.prototype.getElementGroup=function(){return"points"},Grid.Model.Point.prototype.updateElement=function(view){var pointElement=this.getElement(view);this.isFocused()&&view.bringToFront(pointElement),Grid.Model.Point.superclass.updateElement.call(this,view)},Grid.Model.SnapPoint=function(model,x,y,radius,snapRadius){Grid.Model.SnapPoint.superclass.constructor.call(this,model,x,y,radius),this.snapRadius=snapRadius,this.setHoverable(!1),this.setFocusable(Grid.Model.Focusable.Never),this.setMoveable(!1),this.setSelectable(!1),this.setVisible(!1)},Lang.extend(Grid.Model.SnapPoint,Grid.Model.Circle),Grid.Model.SnapPoint.prototype.getList=function(){return this.model.getSnapPoints()},Grid.Model.SnapPoint.prototype.getStyles=function(){return Grid.Model.getEmptyStyles()},Grid.Model.Line=function(model,source,target,dirType,style,transparent){if(Grid.Model.Line.superclass.constructor.call(this,model),this.source=source,this.target=target,this.style=style||"solid",Lang.isBoolean(dirType))dirType=dirType?"forward":"none";else if(Lang.isString(dirType)){if("none"!=(dirType=dirType.toLowerCase())&&"forward"!=dirType&&"back"!=dirType&&"both"!=dirType)throw new Error("Invalid line direction")}else dirType="none";transparent&&(source.makeTransparent("both"==dirType||"back"==dirType),target.makeTransparent("both"==dirType||"forward"==dirType)),this.dirType=dirType},Lang.extend(Grid.Model.Line,Grid.Model.Base),Grid.Model.Line.prototype.getLength=function(){var p1=this.source.get2D(),p2=this.target.get2D();return p1.distanceFrom(p2)},Grid.Model.Line.prototype.intersect=function(line){var a1=this.source.get2D(),a2=this.target.get2D(),b1=line.source.get2D(),b2=line.target.get2D();return"Intersection"==Intersection.intersectLineLine(a1,a2,b1,b2).status},Grid.Model.Line.prototype.distanceFromPoint=function(point){var px=point.x,py=point.y,x1=this.source.x,y1=this.source.y,x2=this.target.x,y2=this.target.y,nearestPoint=Grid.Utils.getNearestPointAlongLine(px,py,x1,y1,x2,y2);return point.distanceFrom(nearestPoint)},Grid.Model.Line.prototype.distanceFrom=function(line){if(this.intersect(line))return 0;var distances=[];return distances.push(this.source.distanceFromLine(line)),distances.push(this.target.distanceFromLine(line)),distances.push(line.source.distanceFromLine(this)),distances.push(line.target.distanceFromLine(this)),Math.min.apply(Math,distances)},Grid.Model.Line.prototype.getSlope=function(){var denom=this.target.x-this.source.x,num=this.target.y-this.source.y;return 0==denom?1/0:0==num?0:num/denom},Grid.Model.Line.prototype.getAngle=function(){var x1=this.source.x,y1=this.source.y,x2=this.target.x,y2=this.target.y;return 180*Math.atan2(y2-y1,x2-x1)/Math.PI},Grid.Model.Line.prototype.getAngle2=function(){var x1=this.source.x,y1=this.source.y,x2=this.target.x,y2=this.target.y;return 180*(x1<=x2?Math.atan2(y2-y1,x2-x1):Math.atan2(y1-y2,x1-x2))/Math.PI},Grid.Model.Line.prototype.isParallelTo=function(line,tolerance){var line1Vertical=!1,line1Horizontal=!1,line2Vertical=!1,line2Horizontal=!1,line1=this,line2=line;if(line1.source.x>=line1.target.x?Math.abs(line1.source.x-line1.target.x)<.25&&(line1Vertical=!0):Math.abs(line1.target.x-line1.source.x)<.25&&(line1Vertical=!0),line2.source.x>=line2.target.x?Math.abs(line2.source.x-line2.target.x)<.25&&(line2Vertical=!0):Math.abs(line2.target.x-line2.source.x)<.25&&(line2Vertical=!0),line1.source.y>=line1.target.y?Math.abs(line1.source.y-line1.target.y)<.25&&(line1Horizontal=!0):Math.abs(line1.target.y-line1.source.y)<.25&&(line1Horizontal=!0),line2.source.y>=line2.target.y?Math.abs(line2.source.y-line2.target.y)<.25&&(line2Horizontal=!0):Math.abs(line2.target.y-line2.source.y)<.25&&(line2Horizontal=!0),line1Vertical&&line2Vertical||line1Horizontal&&line2Horizontal)return!0;if(!line1Vertical&&!line2Vertical&&(line1.target.y-line1.source.y)/(line1.target.x-line1.source.x)==(line2.target.y-line2.source.y)/(line2.target.x-line2.source.x))return!0;var distance=function(x,y){return Math.sqrt(Math.pow(x,2)+Math.pow(y,2))},newX1=line1.target.x-line1.source.x,newY1=line1.target.y-line1.source.y,newX2=line2.target.x-line2.source.x,newY2=line2.target.y-line2.source.y,dotProd=newX1*newX2+newY1*newY2,lengthProd=distance(newX1,newY1)*distance(newX2,newY2);if(Math.abs(dotProd)==Math.abs(lengthProd))return!0;var theta=1.05;return 0!=lengthProd&&(theta=Math.acos(Math.abs(dotProd/lengthProd))),theta<=.05},Grid.Model.Line.prototype.getLongestLine=function(line){var start,end,lines=[];this.source.distanceFrom(line.source)<this.source.distanceFrom(line.target)?(start=line.source,end=line.target):(start=line.target,end=line.source),lines[0]=new Grid.Model.Line(this.model,start,end),lines[1]=new Grid.Model.Line(this.model,this.source,end),lines[2]=new Grid.Model.Line(this.model,start,this.target),lines[3]=new Grid.Model.Line(this.model,end,this.target);for(var length=this.getLength(),longest=this,i=0;i<4;i++){var l=lines[i].getLength();lines[i].getLength()>length&&(longest=lines[i],length=l)}return longest},Grid.Model.Line.prototype.getInfo=function(){var x1=this.source.x,y1=this.source.y,r1=this.source.radius,x2=this.target.x,y2=this.target.y,r2=this.target.radius,radians=Math.atan2(y2-y1,x2-x1),targetOffset="none"==this.dirType?-2:-1;return this.source.isTransparent()||(x1+=Math.cos(radians)*(r1+1+-2),y1+=Math.sin(radians)*(r1+1+-2)),this.target.isTransparent()||(x2-=Math.cos(radians)*(r2+1+targetOffset),y2-=Math.sin(radians)*(r2+1+targetOffset)),{x1:x1,y1:y1,x2:x2,y2:y2,angle:radians/(2*Math.PI)*360}},Grid.Model.Line.prototype.getStyles=function(){return{fill:"none",stroke:"red","stroke-width":"1","stroke-dasharray":"dashed"==this.style?"5, 5":""}},Grid.Model.Line.prototype.getArrowStyles=function(){return{"stroke-width":"1.3"}},Grid.Model.Line.prototype.getElementGroup=function(){return"lines"},Grid.Model.Line.prototype.createElement=function(view){var id=this.getID(),lineInfo=this.getInfo(),lineElement=view.createElement("line",{id:id,x1:lineInfo.x1,y1:lineInfo.y1,x2:lineInfo.x2,y2:lineInfo.y2});return this.appendElement(view,lineElement),"forward"!=this.dirType&&"both"!=this.dirType||this._createArrowElement(view,id+"_arrow1",lineInfo.x2,lineInfo.y2,lineInfo.angle),"both"==this.dirType&&this._createArrowElement(view,id+"_arrow2",lineInfo.x1,lineInfo.y1,lineInfo.angle-180),lineElement},Grid.Model.Line.prototype._getArrowPath=function(x,y){return"M"+x+" "+y+" L"+(x-6)+" "+(y-6)+" M"+(x-6)+" "+(y+6)+" L"+x+" "+y},Grid.Model.Line.prototype._createArrowElement=function(view,id,x,y,angle){var path=this._getArrowPath(x,y),arrowElement=view.createElement("path",{id:id,d:path,transform:"rotate("+angle+", "+x+", "+y+")"}),lineStyles=this.getStyles(),arrowStyles=this.getArrowStyles();return YAHOO.lang.augmentObject(arrowStyles,lineStyles,!1),view.setAttributes(arrowElement,arrowStyles),view.appendChild("arrows",arrowElement),arrowElement},Grid.Model.Line.prototype.moveElement=function(view){var id=this.getID(),lineInfo=this.getInfo(),lineElement=view.getElementById(id);if(!lineElement)throw new Error("Cannot move the line "+id+" because it does not exist");view.setAttributes(lineElement,{x1:lineInfo.x1,y1:lineInfo.y1,x2:lineInfo.x2,y2:lineInfo.y2}),"forward"!=this.dirType&&"both"!=this.dirType||this._updateArrowElement(view,id+"_arrow1",lineInfo.x2,lineInfo.y2,lineInfo.angle),"both"==this.dirType&&this._updateArrowElement(view,id+"_arrow2",lineInfo.x1,lineInfo.y1,lineInfo.angle-180)},Grid.Model.Line.prototype._updateArrowElement=function(view,id,x,y,angle){var arrowElement=view.getElementById(id);if(!arrowElement)throw new Error("Cannot move the arrow "+id+" because it does not exist");var path=this._getArrowPath(x,y);view.setAttributes(arrowElement,{d:path,transform:"rotate("+angle+", "+x+", "+y+")"})},Grid.Model.Line.prototype.removeElement=function(view){var id=this.getID();Grid.Model.Line.superclass.removeElement.call(this,view),"forward"!=this.dirType&&"both"!=this.dirType||view.removeElement(id+"_arrow1"),"both"==this.dirType&&view.removeElement(id+"_arrow2")},Grid.Model.Line.prototype.getElementGroup=function(){return"lines"},Grid.Model.Line.prototype.createElement=function(view){var id=this.getID(),lineInfo=this.getInfo(),lineElement=view.createElement("line",{id:id,x1:lineInfo.x1,y1:lineInfo.y1,x2:lineInfo.x2,y2:lineInfo.y2});return this.appendElement(view,lineElement),"forward"!=this.dirType&&"both"!=this.dirType||this._createArrowElement(view,id+"_arrow1",lineInfo.x2,lineInfo.y2,lineInfo.angle),"both"==this.dirType&&this._createArrowElement(view,id+"_arrow2",lineInfo.x1,lineInfo.y1,lineInfo.angle-180),lineElement},Grid.Model.Line.prototype._getArrowPath=function(x,y){return"M"+x+" "+y+" L"+(x-6)+" "+(y-6)+" M"+(x-6)+" "+(y+6)+" L"+x+" "+y},Grid.Model.Line.prototype._createArrowElement=function(view,id,x,y,angle){var path=this._getArrowPath(x,y),arrowElement=view.createElement("path",{id:id,d:path,transform:"rotate("+angle+", "+x+", "+y+")"}),lineStyles=this.getStyles(),arrowStyles=this.getArrowStyles();return YAHOO.lang.augmentObject(arrowStyles,lineStyles,!1),view.setAttributes(arrowElement,arrowStyles),view.appendChild("arrows",arrowElement),arrowElement},Grid.Model.Line.prototype.moveElement=function(view){var id=this.getID(),lineInfo=this.getInfo(),lineElement=view.getElementById(id);if(!lineElement)throw new Error("Cannot move the line "+id+" because it does not exist");view.setAttributes(lineElement,{x1:lineInfo.x1,y1:lineInfo.y1,x2:lineInfo.x2,y2:lineInfo.y2}),"forward"!=this.dirType&&"both"!=this.dirType||this._updateArrowElement(view,id+"_arrow1",lineInfo.x2,lineInfo.y2,lineInfo.angle),"both"==this.dirType&&this._updateArrowElement(view,id+"_arrow2",lineInfo.x1,lineInfo.y1,lineInfo.angle-180)},Grid.Model.Line.prototype._updateArrowElement=function(view,id,x,y,angle){var arrowElement=view.getElementById(id);if(!arrowElement)throw new Error("Cannot move the arrow "+id+" because it does not exist");var path=this._getArrowPath(x,y);view.setAttributes(arrowElement,{d:path,transform:"rotate("+angle+", "+x+", "+y+")"})},Grid.Model.Line.prototype.removeElement=function(view){var id=this.getID();Grid.Model.Line.superclass.removeElement.call(this,view),"forward"!=this.dirType&&"both"!=this.dirType||view.removeElement(id+"_arrow1"),"both"==this.dirType&&view.removeElement(id+"_arrow2")},Grid.Model.Rectangle=function(model,x,y,width,height){Grid.Model.Rectangle.superclass.constructor.call(this,model,x,y),this.width=width||0,this.height=height||0,this.setHoverable(!1),this.setFocusable(Grid.Model.Focusable.Manual),this.setMoveable(!0),this.setSelectable(!1)},Lang.extend(Grid.Model.Rectangle,Grid.Model.Position),Grid.Model.Rectangle.prototype.getSize=function(){return this.width*this.height},Grid.Model.Rectangle.prototype.getBoundingRect=function(x,y){YAHOO.lang.isNumber(x)||(x=this.x),YAHOO.lang.isNumber(y)||(y=this.y);var topLeftX=x,topLeftY=y,bottomRightX=topLeftX+this.width,bottomRightY=topLeftY+this.height;return{width:this.width,height:this.height,left:topLeftX,top:topLeftY,right:bottomRightX,bottom:bottomRightY}},Grid.Model.Rectangle.prototype.getFixedCoords=function(moveX,moveY){var rect=this.getBoundingRect(moveX,moveY),canvasWidth=this.model.options.canvasWidth,canvasHeight=this.model.options.canvasHeight;return rect.left<0&&(moveX=0),rect.top<0&&(moveY=0),rect.right>canvasWidth&&(moveX=canvasWidth-this.width),rect.bottom>canvasHeight&&(moveY=canvasHeight-this.height),{x:moveX,y:moveY}},Grid.Model.Rectangle.prototype.setCoords=function(coords){coords=coords.split(",");for(var i=0;i<coords.length;i++)coords[i]=1*coords[i];var x1=coords[0],y1=coords[1],x2=coords[2],y2=coords[3];this.x=x1,this.y=y1,this.width=x2-x1,this.height=y2-y1,this.update()},Grid.Model.Rectangle.prototype.getCoords=function(){var boundingRect=this.getBoundingRect();return YAHOO.lang.substitute("{left}, {top}, {right}, {bottom}",boundingRect)},Grid.Model.Rectangle.prototype.createElement=function(view){var id=this.getID(),element=view.createElement("rect",{id:id});return this.appendElement(view,element),element},Grid.Model.Rectangle.prototype.updateElement=function(view){var element=this.getElement(view),boundingRect=this.getBoundingRect();view.setAttributes(element,{x:boundingRect.left,y:boundingRect.top,width:boundingRect.width,height:boundingRect.height}),Grid.Model.Rectangle.superclass.updateElement.call(this,view)},Grid.Model.Rectangle.prototype.moveElement=function(view){var element=this.getElement(view),boundingRect=this.getBoundingRect();view.setAttributes(element,{x:boundingRect.left,y:boundingRect.top})},Grid.Model.Image=function(model,name,x,y,width,height){Grid.Model.Image.superclass.constructor.call(this,model,x,y,width,height),this.name=name,this.setHoverable(!1),this.setFocusable(Grid.Model.Focusable.Manual),this.setMoveable(!0),this.setSelectable(!1)},Lang.extend(Grid.Model.Image,Grid.Model.Rectangle),Grid.Model.Image.prototype.getBoundingRect=function(x,y){YAHOO.lang.isNumber(x)||(x=this.x),YAHOO.lang.isNumber(y)||(y=this.y);var topLeftX=x-Math.round(this.width/2),topLeftY=y-this.height,bottomRightX=topLeftX+this.width,bottomRightY=topLeftY+this.height;return{width:this.width,height:this.height,left:topLeftX,top:topLeftY,right:bottomRightX,bottom:bottomRightY}},Grid.Model.Image.prototype.getFixedCoords=function(moveX,moveY){var rect=this.getBoundingRect(moveX,moveY),canvasWidth=this.model.options.canvasWidth,canvasHeight=this.model.options.canvasHeight;rect.left<0&&(moveX=Math.round(this.width/2)),rect.top<0&&(moveY=this.height),rect.right>canvasWidth&&(moveX=canvasWidth-Math.round(this.width/2)),rect.bottom>canvasHeight&&(moveY=canvasHeight);for(var rec=this.otherImageInSamePlace(moveX,moveY,4);null!=rec;)moveX=rec.x+4,moveY=rec.y+4,rec=this.otherImageInSamePlace(moveX,moveY,4);return{x:moveX,y:moveY}},Grid.Model.Image.prototype.getPaletteImage=function(){for(var paletteImages=this.model.getPaletteImages(),i=0;i<paletteImages.length;i++){var paletteImage=paletteImages[i];if(paletteImage.name==this.name)return paletteImage}return null},Grid.Model.Image.prototype.otherImageInSamePlace=function(realX,realY,tolerance){for(var p=new Point2D(realX,realY),size=this.getSize(),images=this.model.getImages(),i=0;i<images.length;i++){var rec=images[i];if(rec!=this&&(rec.get2D().distanceFrom(p)<tolerance&&Math.abs(rec.getSize()-size)<.15*size))return rec}return null},Grid.Model.Image.prototype.getStyles=function(){return null},Grid.Model.Image.prototype.getBorderStyles=function(){return{stroke:"blue","stroke-width":"2",fill:"none"}},Grid.Model.Image.prototype.toString=function(){return this.name},Grid.Model.Image.prototype.getElementGroup=function(){return"images"},Grid.Model.Image.prototype.createElement=function(view){var id=this.getID(),imageElement=view.createElement("image",{id:id,transform:"translate(-0.5, -0.5)"}),paletteImage=this.getPaletteImage();return imageElement.setAttributeNS(XLINK_NS,"xlink:href",paletteImage.url),this.appendElement(view,imageElement),imageElement},Grid.Model.Image.prototype.moveElement=function(view){Grid.Model.Image.superclass.moveElement.call(this,view),this.isFocused()&&this._updateBorderElement(view)},Grid.Model.Image.prototype.updateElement=function(view){Grid.Model.Image.superclass.updateElement.call(this,view),this.isFocused()?this._updateBorderElement(view):this._removeBorderElement(view)},Grid.Model.Image.prototype.removeElement=function(view){this.isFocused()&&this._removeBorderElement(view),Grid.Model.Image.superclass.removeElement.call(this,view)},Grid.Model.Image.prototype._updateBorderElement=function(view){var id=this.getID(),imageElement=view.getElementById(id),rect=this.getBoundingRect(),borderID=imageElement.id+"_border",borderElement=view.getElementById(borderID);if(null==borderElement){borderElement=view.createElement("rect",{id:borderID});var borderStyles=this.getBorderStyles();view.setAttributes(borderElement,borderStyles),view.appendChild("imageborders",borderElement)}view.setAttributes(borderElement,{x:rect.left-2,y:rect.top-2,width:rect.width+4,height:rect.height+4})},Grid.Model.Image.prototype._removeBorderElement=function(view){var id=this.getID();view.removeElement(id+"_border")},Grid.Model.StaticImage=function(model,url,x,y,width,height){Grid.Model.StaticImage.superclass.constructor.call(this,model,x,y,width,height),this.url=url,this.setHoverable(!1),this.setFocusable(Grid.Model.Focusable.None),this.setMoveable(!1),this.setSelectable(!1)},Lang.extend(Grid.Model.StaticImage,Grid.Model.Rectangle),Grid.Model.StaticImage.prototype.getStyles=function(){return null},Grid.Model.BackgroundImage=function(model,url,x,y,width,height){Grid.Model.BackgroundImage.superclass.constructor.call(this,model,url,x,y,width,height)},Lang.extend(Grid.Model.BackgroundImage,Grid.Model.StaticImage),Grid.Model.StaticImage.prototype.getElementGroup=function(){return"staticimages"},Grid.Model.StaticImage.prototype.createElement=function(view){var id=this.getID(),element=view.createElement("image",{id:id,transform:"translate(-0.5, -0.5)"});return element.setAttributeNS(XLINK_NS,"xlink:href",this.url),this.appendElement(view,element),element},Grid.Model.Label=function(model,x,y,text,fontSize,fontFamily){Grid.Model.Label.superclass.constructor.call(this,model,x,y),this.text=text,this.fontSize=fontSize||"12",this.fontFamily=fontFamily||"Arial"},Lang.extend(Grid.Model.Label,Grid.Model.Position),Grid.Model.Label.prototype.getStyles=function(){return{"font-size":this.fontSize,"font-family":this.fontFamily,fill:"black"}},Grid.Model.Label.prototype.getElementGroup=function(){return"labels"},Grid.Model.Label.prototype.createElement=function(view){var id=this.getID(),label=view.createElement("text",{id:id,x:this.x,y:this.y});this.appendElement(view,label)},Grid.Model.Label.prototype.updateElement=function(view){var labelElement=this.getElement(view);view.setText(labelElement.id,this.text),Grid.Model.Label.superclass.updateElement.call(this,view)},Grid.Model.buildRegion=function(entityClass,regionName){var regionClass=function(){var args=Array.prototype.slice.call(arguments,0);regionClass.superclass.constructor.apply(this,args),this.name=regionName,this._currentEvent=null,this._events={}};return Lang.extend(regionClass,entityClass,Grid.Model.Region),regionClass.prototype.isSelectable=function(){if(this.isSelected())return!0;for(var regionGroups=this.getGroups(),i=0;i<regionGroups.length;i++)if(regionGroups[i].isMaxMet())return!1;return regionClass.superclass.isSelectable.call(this)},regionClass.prototype.select=function(){return this.isSelected()||this.deselectConflicts(),regionClass.superclass.select.call(this)},regionClass},Grid.Model.Region={},Grid.Model.Region.getGroups=function(){for(var refGroups=[],regionGroups=this.model.getRegionGroups(),i=0;i<regionGroups.length;i++){var regionGroup=regionGroups[i];regionGroup.containsRegion(this)&&refGroups.push(regionGroup)}return refGroups},Grid.Model.Region.isOrphan=function(){return 0==this.getGroups().length},Grid.Model.Region.deselectConflicts=function(){for(var refGroups=this.getGroups(),deselectRegions=[],i=0;i<refGroups.length;i++){var refGroup=refGroups[i],selectedRegions=refGroup.getSelectedRegions();if(selectedRegions.length>0)if(1==refGroup.max)deselectRegions.push(selectedRegions[0]);else if(refGroup.isMaxMet())return!1}for(i=0;i<deselectRegions.length;i++)deselectRegions[i].deselect();return!0},Grid.Model.Region.getEvent=function(name){return this._events[name]},Grid.Model.Region.hasEvent=function(name){return null!=this.getEvent(name)},Grid.Model.Region.createEvent=function(name){return this._events[name]=new Grid.Model.RegionEvent(this,name),this.getEvent(name)},Grid.Model.Region.deleteEvent=function(event){event.deleteImage(),event.deleteLabel(),this._currentEvent==event&&(this._currentEvent=null),delete this._events[event.name]},Grid.Model.Region.getCurrentEvent=function(){return this._currentEvent},Grid.Model.Region.setCurrentEvent=function(name){if(null!=this._currentEvent){for(var entities=this._currentEvent.getEntities(),i=0;i<entities.length;i++)entities[i].hide();this._currentEvent=null}if(this._currentEvent=this.getEvent(name),null!=this._currentEvent){for(var entities=this._currentEvent.getEntities(),i=0;i<entities.length;i++)entities[i].show();return!0}return!1},Grid.Model.Region.getEvents=function(){var eventList=[];for(var evt in this._events)eventList.push(this._events[evt]);return eventList},Grid.Model.Region.getStyles=function(){var regionEvent=this.getCurrentEvent();return null!=regionEvent?regionEvent.getStyles():Grid.Model.getEmptyStyles()},Grid.Model.Region.updateElement=function(view){this.isSelected()&&this.isFocused()&&this.hasEvent("hoverselect")?this.setCurrentEvent("hoverselect"):this.isSelected()&&this.hasEvent("select")?this.setCurrentEvent("select"):this.isFocused()&&this.hasEvent("hover")?this.setCurrentEvent("hover"):this.hasEvent("unselect")?this.setCurrentEvent("unselect"):this.setCurrentEvent(null),this.constructor.superclass.updateElement.call(this,view)},Grid.Model.RegionGroup=function(model,name,min,max){this.model=model,this.name=name||"",this.min=min||0,this.max=max||0,this._regions=[]},Grid.Model.RegionGroup.prototype.getRegions=function(){return this._regions},Grid.Model.RegionGroup.prototype.getRegion=function(name){for(var regions=this.getRegions(),i=0;i<regions.length;i++){var region=regions[i];if(region.name==name)return region}return null},Grid.Model.RegionGroup.prototype.getSelectedRegions=function(){for(var regions=this.getRegions(),selectedRegions=[],i=0;i<regions.length;i++){var region=regions[i];region.isSelected()&&selectedRegions.push(region)}return selectedRegions},Grid.Model.RegionGroup.prototype.addRegion=function(region){this._regions.push(region)},Grid.Model.RegionGroup.prototype.containsRegion=function(region){return this._regions.indexOf(region)>-1},Grid.Model.RegionGroup.prototype.removeRegion=function(region,deleteOrphan){Grid.Model.arrayRemove(this._regions,region),deleteOrphan&&0==region.getGroups().length&&this.model.deleteRegion(region)},Grid.Model.RegionGroup.prototype.isMaxMet=function(){var selectedRegions=this.getSelectedRegions();return this.max>0&&selectedRegions.length>=this.max},Grid.Model.RegionEvent=function(region,name){this.region=region,this.name=name,this._image=null,this._label=null,this._styles=Grid.Model.getEmptyStyles()},Grid.Model.RegionEvent.prototype.getStyles=function(){return this._styles},Grid.Model.RegionEvent.prototype.setStyles=function(newStyles){YAHOO.lang.augmentObject(this._styles,newStyles,!0)},Grid.Model.RegionEvent.prototype.getEntities=function(){var entities=[];return null!=this._image&&entities.push(this._image),null!=this._label&&entities.push(this._label),entities},Grid.Model.RegionEvent.prototype.getImage=function(){return this._image},Grid.Model.RegionEvent.prototype.setImage=function(url,x,y,width,height){null!=this._image&&this.deleteImage(),this._image=this.region.model.addStaticImage(url,x,y,width,height),this._image.hide()},Grid.Model.RegionEvent.prototype.deleteImage=function(){return null!=this._image&&(this.region.model.deleteStaticImage(this._image),this._image=null,!0)},Grid.Model.RegionEvent.prototype.getLabel=function(){return this._label},Grid.Model.RegionEvent.prototype.setLabel=function(x,y,text){null!=this._label&&this.deleteLabel(),this._label=this.region.model.addLabel(x,y,text),this._label.hide()},Grid.Model.RegionEvent.prototype.deleteLabel=function(){return null!=this._label&&(this.region.model.deleteEntity(this._label),this._label=null,!0)},function(){if(!(YAHOO.env.ua.gecko>0)){Grid.Model.getEmptyStyles=function(){return{fill:"white","fill-opacity":"0",stroke:"white","stroke-width":"0","stroke-opacity":"0","stroke-dasharray":""}},Grid.Model.getDefaultStyles=function(){return{fill:"white","fill-opacity":"0",stroke:"red","stroke-width":"1","stroke-opacity":"1","stroke-dasharray":""}};var fixStyles=function(styles){if(null==styles["stroke-opacity"]||""==styles["stroke-opacity"]){var strokeWidth=parseInt(styles["stroke-width"]);strokeWidth>0?styles["stroke-opacity"]="1":0===strokeWidth&&(styles["stroke-opacity"]="0")}};Grid.Model.RegionEvent.prototype.setStyles=function(newStyles){YAHOO.lang.augmentObject(this._styles,newStyles,!0),fixStyles(this._styles)}}}(),Grid.Model.PaletteImage=function(model,name,url,width,height){Grid.Model.PaletteImage.superclass.constructor.call(this,model),this.name=name,this.url=url,this.width=width||0,this.height=height||0,this.loaded=!1},Lang.extend(Grid.Model.PaletteImage,Grid.Model.Base),Grid.Model.PaletteImage.prototype.getImages=function(){for(var paletteCanvasImages=[],images=this.model.getImages(),i=0;i<images.length;i++){var image=images[i];image.name==this.name&&paletteCanvasImages.push(image)}return paletteCanvasImages},Grid.Model.PaletteImage.prototype.toString=function(){return this.name};var SVG_NS="http://www.w3.org/2000/svg",XLINK_NS="http://www.w3.org/1999/xlink",GRID_NS="http://www.air.org/2010/grid/";if(Grid.View=function(svgFile){this.svgFile=svgFile,this.paletteImgIndex=0,this.paletteCenter=!1,this.paletteScale=!1,this.width=600,this.height=500,this._svgObject=null,this._svgDoc=null,this._svgWin=null,this._svgRoot=null,this._svgElement=null,this._zoomLevel=1,this._domCache={},this.svgReady=!1,this.svgLoaded=!1,this._suspendRedrawEnabled=!1,this._debug=!1,this._fixedOffset=!1,this._layout=null,Grid.Utils.hasSVGWeb()&&ErrorHandler.wrapFunctions(this,["setAttributes","createElement","createPoint","createSnapPoint","movePoint","createLine","moveLine"])},Grid.View.prototype.render=function(id){var parent=YAHOO.util.Dom.get(id),view=this,ready=function(){view.svgReady=!0,view._create(parent)};if(Grid.Utils.hasSVGWeb())svgweb.pageLoaded?ready():window.onsvgload=function(){ready()};else{if(!Grid.Utils.hasSVGNative())throw new Error("This browser does not have support for SVG");ready()}},Grid.View.prototype._fixOffset=function(){this._fixedOffset||(Grid.Utils.fixOffset(this._svgObject),this._fixedOffset=!0)},Grid.View.prototype._addCache=function(element){"string"==typeof element.id&&(this._domCache[element.id]=element)},Grid.View.prototype._removeCache=function(element){"string"==typeof element.id&&delete this._domCache[element.id]},Grid.View.prototype.getElementById=function(id){if(null==this._svgDoc)return null;if(!id)return null;if(id.nodeType)return id;if("string"==typeof id){var element=this._domCache[id];return element||this._svgDoc.getElementById(id)}return null},Grid.View.prototype.getElementsByTagName=function(tagName){return null==this._svgDoc?null:this._svgDoc.getElementsByTagNameNS(SVG_NS,tagName)},Grid.View.prototype.createElement=function(name,attrs){if("string"!=typeof name)return!1;var element=null;return null!=attrs&&"string"==typeof attrs.id&&(element=this.getElementById(attrs.id)),null==element&&(element=this._svgDoc.createElementNS(SVG_NS,name)),this.setAttributes(element,attrs),this._debug&&element.id&&logger.debug("Created '{nodeName}' with id '{id}'",element),this._addCache(element),element},Grid.View.prototype.setAttributes=function(node,attrs){if("string"==typeof node&&(node=this.getElementById(node)),null==node)return!1;if(null==attrs)return!1;var handle=null;if(!0===this._suspendRedrawEnabled)try{handle=this._svgRoot.suspendRedraw(1e4)}catch(ex){}for(var name in attrs)if(attrs.hasOwnProperty(name)){var value=attrs[name];node.setAttribute(name,value)}return null!=handle&&this._svgRoot.unsuspendRedraw(handle),!0},Grid.View.prototype.setAttribute=function(node,name,value){return"string"==typeof node&&(node=this.getElementById(node)),null!=node&&(node.setAttribute(name,value),!0)},Grid.View.prototype.appendChild=function(parent,element){return"string"==typeof parent&&(parent=this.getElementById(parent)),null==parent?(logger.warn("Failed to append the element '"+element.id+"' because the parent was not found."),!1):(parent.appendChild(element),Grid.Utils.isSVGFlash()&&""!=parent.getAttribute("style")&&this.setAttributes(element,{style:parent.getAttribute("style")}),!0)},Grid.View.prototype.removeChild=function(parent,element){parent.removeChild(element),YAHOO.lang.isObject(element._fakeNode)&&YAHOO.lang.isArray(element._fakeNode._listeners)&&(element._fakeNode._listeners={})},Grid.View.prototype.removeChildren=function(parent){for("string"==typeof parent&&(parent=this.getElementById(parent));parent&&parent.firstChild;)this.removeChild(parent,parent.firstChild)},Grid.View.prototype.removeElement=function(id){var element=this.getElementById(id);return null==element?(logger.warn("Cannot remove the element '"+id+"' because it does not exist"),!1):(this._removeCache(element),null!=element.parentNode&&this.removeChild(element.parentNode,element),this._debug&&logger.debug("Removed '{nodeName}' with id '{id}'",element),!0)},Grid.View.prototype.setText=function(id,text){var element=this.getElementById(id);if(null==element)return!1;this.removeChildren(element);var textNode=this._svgDoc.createTextNode(text);return element.appendChild(textNode),!0},Grid.View.prototype.bringToFront=function(id){var element=this.getElementById(id);if(null==element)return!1;var parent=element.parentNode;return null!=parent&&(this.removeChild(parent,element),parent.appendChild(element),!0)},Grid.View.prototype.zoom=function(scale){this._zoomLevel=scale=scale||this._zoomLevel||1;var zoomedWidth=Math.round(this.width*scale),zoomedHeight=Math.round(this.height*scale);this._svgElement&&(this._svgElement.width.baseVal&&(this._svgElement.width.baseVal.value=zoomedWidth,this._svgElement.height.baseVal.value=zoomedHeight),(YAHOO.env.ua.android>0||YAHOO.env.ua.webkit>=534)&&(this._svgElement.setAttribute("width",zoomedWidth),this._svgElement.setAttribute("height",zoomedHeight))),this._svgObject&&(this._svgObject.width=zoomedWidth,this._svgObject.height=zoomedHeight);var groupWrapper=this.getElementById("groupWrapper");if(groupWrapper){var groupTranslate=groupWrapper.getAttribute("transform").split(" scale")[0];this.setAttributes(groupWrapper,{transform:groupTranslate+" scale("+scale+")"})}},Grid.View.prototype.translateElement=function(element,x,y){if("string"==typeof element&&(element=this.getElementById(element)),null==element)return null;var matrix=element.getCTM().inverse();return x=matrix.a*x+matrix.c*y+matrix.e,y=matrix.b*x+matrix.d*y+matrix.f,{x:x,y:y}},Grid.View.prototype.dispose=function(){if(this._svgObject&&this._svgObject.parentNode&&this._svgObject.parentNode.removeChild(this._svgObject),this._svgObject=null,this._svgDoc=null,this._svgWin=null,this._svgRoot=null,this._svgElement=null,this._domCache=null,Grid.Utils.hasSVGWeb()&&null!=svgweb._removedNodes){for(var i=0;i<svgweb._removedNodes.length;i++){var node=svgweb._removedNodes[i];node._fakeNode&&(node._fakeNode._htcNode=null),node._fakeNode=null,node._handler=null,svgweb._removedNodes[i]=null}svgweb._removedNodes=[]}},YAHOO.lang.augmentProto(Grid.View,EventLazyProvider),window.svgweb&&top!=window&&(top.svgweb=window.svgweb),Grid.Layout=function(){var containerPaddingTop=0,containerPaddingRight=0,containerPaddingBottom=0,containerPaddingLeft=0,canvasWidth=0,canvasHeight=0,canvasBorderOffset=0,paletteWidth=0,toolbarHeight=0,feedbackHeight=0,paletteGutter=0,toolbarGutter=0,feedbackGutter=0;this.setContainerPadding=function(top,right,bottom,left){containerPaddingTop=top,containerPaddingRight=right,containerPaddingBottom=bottom,containerPaddingLeft=left},this.setCanvasWidth=function(width){canvasWidth=width},this.setCanvasHeight=function(height){canvasHeight=height},this.setCanvasBorderOffset=function(offset){canvasBorderOffset=offset},this.setPaletteWidth=function(width,gutter){paletteWidth=width,paletteGutter=gutter},this.setToolbarHeight=function(height,gutter){toolbarHeight=height,toolbarGutter=gutter},this.setFeedbackHeight=function(height,gutter){feedbackHeight=height,feedbackGutter=gutter},this.getCanvasWidth=function(){return canvasWidth},this.getCanvasHeight=function(){return canvasHeight},this.getCanvasBorderOffset=function(){return canvasBorderOffset},this.getToolbarWidth=function(){return this.getToolbarHeight()>0?this.getCanvasWidth():0},this.getToolbarHeight=function(){return toolbarHeight},this.getToolbarGutter=function(){return toolbarHeight>0?toolbarGutter:0},this.getFeedbackWidth=function(){return this.getFeedbackHeight()>0?this.getCanvasWidth():0},this.getFeedbackHeight=function(){return feedbackHeight},this.getFeedbackGutter=function(){return feedbackHeight>0?feedbackGutter:0},this._getWidth=function(){return this.getPaletteWidth()+this.getPaletteGutter()+this.getCanvasWidth()},this._getHeight=function(){return this.getToolbarHeight()+this.getToolbarGutter()+this.getCanvasHeight()+this.getFeedbackGutter()+this.getFeedbackHeight()},this.getPaletteWidth=function(){return paletteWidth},this.getPaletteHeight=function(){return this._getHeight()},this.getPaletteGutter=function(){return paletteWidth>0?paletteGutter:0},this.getGridWidth=function(){return this._getWidth()+containerPaddingLeft+containerPaddingRight},this.getGridHeight=function(){return this._getHeight()+containerPaddingTop+containerPaddingBottom},this.getContainerPaddingTop=function(){return containerPaddingTop},this.getContainerPaddingLeft=function(){return containerPaddingLeft},this.getContainerPaddingBottom=function(){return containerPaddingBottom},this.getContainerPaddingRight=function(){return containerPaddingRight},this.getPaletteX=function(){return 0},this.getPaletteY=function(){return 0},this.getToolbarX=function(){return this.getPaletteWidth()+this.getPaletteGutter()},this.getToolbarY=function(){return 0},this.getCanvasX=function(){return this.getPaletteWidth()+this.getPaletteGutter()},this.getCanvasY=function(){return this.getToolbarHeight()+this.getToolbarGutter()},this.getFeedbackX=function(){return this.getPaletteWidth()+this.getPaletteGutter()},this.getFeedbackY=function(){return this.getToolbarHeight()+this.getToolbarGutter()+this.getCanvasHeight()+this.getFeedbackGutter()}},Grid.Layout.debug=function(layout){console.log("Palette: width=%d height=%d x=%d y=%d visible=%s",layout.getPaletteWidth(),layout.getPaletteHeight(),layout.getPaletteX(),layout.getPaletteY()),console.log("Toolbar: width=%d height=%d x=%d y=%d visible=%s",layout.getToolbarWidth(),layout.getToolbarHeight(),layout.getToolbarX(),layout.getToolbarY()),console.log("Canvas: width=%d height=%d x=%d y=%d",layout.getCanvasWidth(),layout.getCanvasHeight(),layout.getCanvasX(),layout.getCanvasY()),console.log("Feedback: width=%d height=%d x=%d y=%d visible=%s",layout.getFeedbackWidth(),layout.getFeedbackHeight(),layout.getFeedbackX(),layout.getFeedbackY())},Grid.View.prototype.updateLayout=function(layout){this.setAttribute("groupPalette","transform","translate("+layout.getPaletteX()+","+layout.getPaletteY()+")"),this.setAttributes("backgroundPalette",{width:layout.getPaletteWidth(),height:layout.getPaletteHeight()}),this.setAttribute("groupToolbar","transform","translate("+layout.getToolbarX()+","+layout.getToolbarY()+")"),this.setAttributes("backgroundToolbar",{width:layout.getToolbarWidth(),height:layout.getToolbarHeight()}),this.setAttribute("groupCanvas","transform","translate("+layout.getCanvasX()+","+layout.getCanvasY()+")"),this.setAttributes("backgroundCanvas",{width:layout.getCanvasWidth(),height:layout.getCanvasHeight(),x:layout.getCanvasBorderOffset(),y:layout.getCanvasBorderOffset()}),this.setAttribute("groupFeedback","transform","translate("+layout.getFeedbackX()+","+layout.getFeedbackY()+")"),this.setAttributes("backgroundFeedback",{width:layout.getFeedbackWidth(),height:layout.getFeedbackHeight()}),this.setAttribute("groupWrapper","transform","translate("+(layout.getContainerPaddingLeft()+.5)+","+(layout.getContainerPaddingTop()+.5)+")"),this.width=layout.getGridWidth(),this.height=layout.getGridHeight(),this.zoom()},Grid.View.prototype._create=function(parentEl){var view=this,elementDoc=parentEl.ownerDocument,elementWin=elementDoc.parentWindow||elementDoc.defaultView;window;Grid.Utils.hasSVGWeb()&&elementWin&&!elementWin.svgweb&&(elementWin.svgweb=window.svgweb);elementWin.addEventListener("unload",function(){view.dispose()},!1),this._inlineHtml?this._createInline(parentEl):this._createObject(parentEl)},Grid.View.prototype._createObject=function(parentEl){var svgID=parentEl.id+"Container",svgObject=document.createElement("object",!0);svgObject.setAttribute("id",svgID),svgObject.setAttribute("name",svgID),svgObject.setAttribute("type","image/svg+xml"),svgObject.setAttribute("data",this.svgFile);var view=this,loaded=function(){view._loadedObject(this)};Grid.Utils.hasSVGWeb()?(svgObject.addEventListener("SVGLoad",loaded,!1),svgweb.appendChild(svgObject,parentEl)):(svgObject.addEventListener("load",loaded,!1),parentEl.appendChild(svgObject))},Grid.View.prototype._loadedObject=function(svgObject){this._svgObject=svgObject,this._svgDoc=this._svgObject.contentDocument,this._svgWin=this._svgDoc.defaultView,this._svgElement=this._svgDoc.documentElement,this._svgRoot=this._svgDoc.rootElement,this.svgLoaded=!0,this.fireLazy("loaded")},Grid.View.prototype._createInline=function(parentEl){var callback={success:this._loadedInline,failure:this._failedInline,scope:this,argument:parentEl};YAHOO.util.Connect.asyncRequest("GET",this.svgFile,callback)},Grid.View.prototype._loadedInline=function(xhrObj){var parentEl=xhrObj.argument,svgText=xhrObj.responseText;parentEl.innerHTML=svgText,this._svgElement=YAHOO.util.Dom.getChildren(parentEl)[0],this._svgRoot=this._svgElement,this._svgObject=this._svgElement,this._svgDoc=this._svgElement.ownerDocument,this._svgWin=this._svgDoc.parentWindow||this._svgDoc.defaultView,this.svgLoaded=!0,this.fireLazy("loaded")},Grid.View.prototype.getCanvasResolution=function(){var backgroundCanvas=this.getElementById("backgroundCanvas");return{width:1*backgroundCanvas.getAttribute("width"),height:1*backgroundCanvas.getAttribute("height")}},Grid.View.prototype.createGridLines=function(spacing){if(this.clearGridLines(),!YAHOO.lang.isNumber(spacing)||0==spacing)return!1;for(var gridLines=this.getElementById("gridlines"),createLine=function(x1,y1,x2,y2){var lineElement=this.createElement("line",{x1:x1,y1:y1,x2:x2,y2:y2});gridLines.appendChild(lineElement)},res=this.getCanvasResolution(),x=0;x<=res.width;x+=spacing)createLine.call(this,x,0,x,res.height);for(var y=0;y<=res.height;y+=spacing)createLine.call(this,0,y,res.width,y);return!0},Grid.View.prototype.clearGridLines=function(){this.removeChildren("gridlines")},Grid.View.prototype.setCanvasCursor=function(type){var groupCanvas=this.getElementById("groupCanvas");this.setAttributes(groupCanvas,{cursor:type})},Grid.View.prototype.setCanvasCustomCursor=function(url,x,y){var groupCanvas=this.getElementById("groupCanvas");x=x||0,y=y||0,this.setAttributes(groupCanvas,{cursor:"url('"+url+"') "+x+" "+y+" , crosshair"})},Grid.View.prototype._updatePaletteImgIndex=function(panup){panup?this.paletteImgIndex--:this.paletteImgIndex++,this._updatePalettePaning()},Grid.View.prototype._getPaletteContainerWidth=function(){var paletteContainer=this.getElementById("backgroundPalette");return Grid.Utils.parseElementXY(paletteContainer).width},Grid.View.prototype.updateCenterScaleImage=function(paletteCenter,paletteScale){this.paletteCenter=paletteCenter,this.paletteScale=paletteScale,this._updatePaletteLayout()},Grid.View.prototype._updatePaletteLayout=function(){for(var paletteContainer=this.getElementById("backgroundPalette"),paletteContainerXY=Grid.Utils.parseElementXY(paletteContainer),paletteImages=this.getElementById("paletteImages").childNodes,paletteWidth=paletteContainerXY.width,x=2,spacing=this.getPaletteSpacing(),y=spacing,i=0;i<paletteImages.length;i++){var paletteImage=paletteImages[i],imageXY=Grid.Utils.parseElementXY(paletteImage);if(this.paletteCenter&&(x=paletteWidth-imageXY.width>=0?(paletteWidth-imageXY.width)/2:this.paletteScale?0:(paletteWidth-imageXY.width)/2),this.setAttributes(paletteImage,{x:x,y:y},0),paletteImage.scale=paletteWidth/imageXY.width,this.paletteScale&&paletteImage.scale<1){paletteImage.scaled=!0;transform="matrix("+paletteImage.scale+",0,0,"+paletteImage.scale+",0,"+y*(1-paletteImage.scale)+")";paletteImage.setAttribute("transform",transform)}else if(paletteImage.scaled){paletteImage.scaled=!1;var transform="matrix(1,0,0,1,0,0)";paletteImage.setAttribute("transform",transform)}y=this.paletteScale?y+imageXY.height*paletteImage.scale+spacing:y+imageXY.height+spacing}this._updatePalettePaning()},Grid.View.prototype._updatePalettePaning=function(){var panYoffset=this.getPalettePanOffset();this.setAttributes(this.getElementById("paletteImages"),{transform:"translate(0, "+(0-panYoffset)+")"},0),this.setAttributes(this.getElementById("palettecliprect"),{x:0,y:this.getPaletteClipOffset(panYoffset),height:this.getPaletteClipHeight()},0)},Grid.View.prototype.getPaletteClipOffset=function(panYoffset){var topClipAdjust=this.getPalettePanHeight();return 0==panYoffset&&(topClipAdjust=0),panYoffset+topClipAdjust},Grid.View.prototype.getPalettePanOffset=function(){var paletteContainer=this.getElementById("backgroundPalette"),paletteImages=(Grid.Utils.parseElementXY(paletteContainer),this.getElementById("paletteImages").childNodes),panYoffset=0;if(this.paletteImgIndex>0){this.getElementById("panup").style.display="block";for(var i=0;i<this.paletteImgIndex;i++){var paletteImage=paletteImages[i],imageXY=Grid.Utils.parseElementXY(paletteImage);this.paletteScale?panYoffset+=imageXY.height*paletteImage.scale+this.getPaletteSpacing():panYoffset+=imageXY.height+this.getPaletteSpacing()}panYoffset-=this.getPalettePanHeight()}else this.getElementById("panup").style.display="none";return panYoffset},Grid.View.prototype.getPaletteClipHeight=function(){var paletteContainer=this.getElementById("backgroundPalette"),paletteContainerXY=Grid.Utils.parseElementXY(paletteContainer),paletteImages=this.getElementById("paletteImages").childNodes,availableHeight=paletteContainerXY.height;this.paletteImgIndex>0&&(availableHeight-=this.getPalettePanHeight());for(var totalHeight=0,i=this.paletteImgIndex;i<paletteImages.length;i++){var paletteImage=paletteImages[i],scale=1;this.paletteScale&&(scale=paletteImage.scale);var imageXY=Grid.Utils.parseElementXY(paletteImage);if(i==paletteImages.length-1?totalHeight+=imageXY.height*scale:totalHeight+=imageXY.height*scale+this.getPaletteSpacing(),availableHeight<totalHeight){availableHeight-=this.getPalettePanHeight(),this.getElementById("pandown").style.display="block";for(var j=i;totalHeight>availableHeight;){var preimage=paletteImages[j--],preXY=Grid.Utils.parseElementXY(preimage);totalHeight-=this.paletteScale?preXY.height*preimage.scale+this.getPaletteSpacing():preXY.height+this.getPaletteSpacing()}return totalHeight}}return this.getElementById("pandown").style.display="none",availableHeight},Grid.View.prototype.getPalettePanHeight=function(){return 15},Grid.View.prototype.getPaletteSpacing=function(){return 3},Grid.View.prototype.showPalette=function(){this.setAttributes("groupPalette",{display:"inline"})},Grid.View.prototype.hidePalette=function(){this.setAttributes("groupPalette",{display:"none"})},Grid.View.prototype.createPaletteImage=function(id,width,height,url){var paletteElement=this.createElement("image",{id:id,width:width,height:height,transform:"translate(-0.5, -0.5)"});return paletteElement.setAttributeNS(XLINK_NS,"xlink:href",url),this.appendChild("paletteImages",paletteElement),this._updatePaletteLayout(),paletteElement},Grid.View.prototype.clonePaletteImage=function(id,cloneID){var paletteElement=this.getElementById(id),clonedElement=paletteElement.cloneNode(!0);if(clonedElement.id=cloneID,this.appendChild("paletteDragging",clonedElement),paletteElement.scaled){paletteElement.getAttribute("x"),paletteElement.getAttribute("y");clonedElement.setAttribute("transform","matrix(1,0,0,1,0,0)")}return clonedElement},Grid.View.prototype.movePaletteImage=function(id,x,y){var clonedElement=this.getElementById(id);this.setAttributes(clonedElement,{x:x,y:y})},Grid.View.prototype.removePaletteImage=function(id){this.removeElement(id),this._updatePaletteLayout()},Grid.View.prototype.selectPaletteImage=function(paletteID){var paletteElement=this.getElementById(paletteID),imageXY=Grid.Utils.parseElementXY(paletteElement),selectedPalette=this.getElementById("selectedPalette"),height=imageXY.height+4;this.paletteScale&&(height=imageXY.height*paletteElement.scale+4),this.setAttributes(selectedPalette,{x:0,y:imageXY.y-this.getPalettePanOffset(),width:75,height:height},0),selectedPalette.style.display=""},Grid.View.prototype.deselectPaletteImage=function(){this.getElementById("selectedPalette").style.display="none"},Grid.View.prototype.showToolbar=function(){this.setAttributes("groupToolbar",{display:"inline"})},Grid.View.prototype.hideToolbar=function(){this.setAttributes("groupToolbar",{display:"none"})},Grid.View.prototype.setFeedbackText=function(text){this.setText("feedback",text)},Grid.View.prototype.setCoordinatesText=function(text){this.setText("coordinates",text)},Grid.View.prototype.showFeedback=function(){this.setAttributes("groupFeedback",{display:"inline"})},Grid.View.prototype.hideFeedback=function(){this.setAttributes("groupFeedback",{display:"none"})},Grid.View.prototype.createSnapToPointAndCircle=function(x,y,r,id){var center=this.createElement("circle",{id:"snapPointCenter_"+id,cx:x,cy:y,r:4});this.appendChild("crtool_snapcenter",center);var circle=this.createElement("circle",{id:"snapPointCircle_"+id,cx:x,cy:y,r:r});this.appendChild("crtool_snapcircle",circle)},Grid.View.prototype.createCRToolCircle=function(x,y,r){var center=this.createElement("circle",{id:"crToolCircleCenter",cx:x,cy:y,r:4});this.appendChild("crtool_circle",center);var circle=this.createElement("circle",{id:"crToolCircle",cx:x,cy:y,r:r});this.appendChild("crtool_circle",circle)},Grid.View.prototype.createCRToolRectangle=function(x1,y1,x2,y2){var rect=this.createElement("rect",{id:"crToolRectangle",x:x1,y:y1,width:x2-x1,height:y2-y1});this.appendChild("crtool_rectangle",rect)},Grid.View.prototype.updateHelperLine=function(id,x1,y1,x2,y2){var mergeLine=this.getElementById(id);mergeLine||(mergeLine=this.createElement("line",{id:id,fill:"none",stroke:"green","stroke-width":"1",opacity:"0.7","stroke-dasharray":"3, 3"}),this.appendChild("mergeLines",mergeLine)),this.setAttributes(mergeLine,{x1:x1,y1:y1,x2:x2,y2:y2})},Grid.Action={},Grid.Action.actions={},Grid.Action.registerAction=function(modeName,action){Grid.Action.actions[modeName]=action},Grid.Action.Base=function(grid){this.grid=grid,this.canvas=grid.canvas,this.model=grid.model,this._completed=!1},Grid.Action.Base.prototype.isCompleted=function(){return this._completed},Grid.Action.Base.prototype.onMouseEvent=function(evt){},Grid.Action.Base.prototype.onKeyEvent=function(evt){},Grid.Action.Base.prototype.dispose=function(){},Grid.Action.Base.prototype.finalize=function(){this.dispose(),this._completed=!0},Grid.Action.Move=function(grid){Grid.Action.Move.superclass.constructor.call(this,grid),this.moveObject=null},YAHOO.lang.extend(Grid.Action.Move,Grid.Action.Base),Grid.Action.Move.prototype.dispose=function(){this.moveObject instanceof Grid.Model.Point?this.canvas.finalizePoint(this.moveObject):this.moveObject instanceof Grid.Model.Image&&this.canvas.finalizeImage(this.moveObject)},Grid.Action.Move.prototype.onMouseEvent=function(evt){var focusedObject=this.canvas.getFocused();if("mousedown"==evt.name&&(this.moveObject||null==focusedObject||!focusedObject.isMoveable()?this.finalize():(this.moveObject=focusedObject,this.grid.setHint("DraggingObject"))),null!=this.moveObject){if("mousemove"==evt.name||"drag"==evt.name){var x=evt.currentPosition.x,y=evt.currentPosition.y;"function"==typeof this.moveObject.moveTo&&this.moveObject.moveTo(x,y)}"dragend"==evt.name&&this.finalize(),"mouseup"==evt.name&&focusedObject instanceof Grid.Model.Point&&this.finalize()}},Grid.Action.Move.prototype.onKeyEvent=function(evt){if(null!=this.moveObject)this.canvas.clearFocused(),this.finalize();else{var focusedObject=this.canvas.getFocused();null!=focusedObject&&focusedObject.isMoveable()?this.moveObject=focusedObject:this.finalize()}},Grid.Action.Point=function(grid){Grid.Action.Point.superclass.constructor.call(this,grid),this.createdPoint=null},YAHOO.lang.extend(Grid.Action.Point,Grid.Action.Base),Grid.Action.Point.prototype.dispose=function(){this.createdPoint&&(this.createdPoint=this.canvas.finalizePoint(this.createdPoint))},Grid.Action.Point.prototype.onMouseEvent=function(evt){var x=evt.currentPosition.x,y=evt.currentPosition.y;if("mousedown"==evt.name){var entity=this.model.getEntity(evt.target.id);entity&&"point"==entity.getType()?this.createdPoint=entity:this.createdPoint=this.model.addPoint(x,y),null==this.createdPoint&&this.finalize()}"drag"==evt.name&&this.createdPoint.isMoveable()&&this.createdPoint.moveTo(x,y),"mouseup"!=evt.name&&"dragend"!=evt.name||this.finalize()},Grid.Action.Point.prototype.onKeyEvent=function(evt){this.createdPoint?this.finalize():(this.createdPoint=this.model.addPoint(30,30),this.createdPoint.snapToGrid())},Grid.Action.Line=function(grid){Grid.Action.Line.superclass.constructor.call(this,grid),this.pointType="none",this.sourcePoint=null,this.targetPoint=null,this.line=null,this.moved=!1},YAHOO.lang.extend(Grid.Action.Line,Grid.Action.Base),Grid.Action.Line.prototype.dispose=function(){"source"==this.pointType?this.canvas.finalizePoint(this.sourcePoint):"target"==this.pointType&&(this.targetPoint=this.canvas.finalizePoint(this.targetPoint),this.sourcePoint==this.targetPoint&&this.model.deleteLine(this.line))},Grid.Action.Line.prototype.getPoint=function(){return this[this.pointType+"Point"]},Grid.Action.Line.prototype.setPoint=function(point){this[this.pointType+"Point"]=point},Grid.Action.Line.prototype.movePoint=function(x,y){this.getPoint().moveTo(x,y)},Grid.Action.Line.prototype.createLine=function(){this.line=this.model.addLine(this.sourcePoint,this.targetPoint)},Grid.Action.Line.prototype.canLineBeFinalized=function(){if(null==this.sourcePoint||null==this.targetPoint)return!1;if(!this.targetPoint.isMoveable())return!0;if(!this.moved)return!1;for(var intersectedPoints=this.targetPoint.getIntersections(),i=0;i<intersectedPoints.length;i++)if(this.sourcePoint==intersectedPoints[i])return!1;return!0},Grid.Action.Line.prototype.onMouseEvent=function(evt){var x=evt.currentPosition.x,y=evt.currentPosition.y;if("mousedown"==evt.name){var clickedEntity=this.model.getEntity(evt.target.id);if(this.sourcePoint&&this.sourcePoint==clickedEntity)return;null==this.sourcePoint&&(this.pointType="source",clickedEntity&&"point"==clickedEntity.getType?this.setPoint(clickedEntity):(this.setPoint(this.model.addPoint(x,y)),this.sourcePoint=this.canvas.finalizePoint(this.sourcePoint))),null==this.targetPoint&&(this.pointType="target",this.setPoint(this.model.addPoint(x,y)),this.createLine()),this.canLineBeFinalized()&&this.finalize()}"mousemove"!=evt.name&&"drag"!=evt.name||!this.targetPoint.isMoveable()||(this.moved=!0,this.movePoint(x,y)),"dragend"==evt.name&&this.canLineBeFinalized()&&this.finalize()},Grid.Action.Line.prototype.onKeyEvent=function(evt){var selected=this.canvas.getFocused();selected&&"none"==this.pointType&&(this.pointType="source",this.setPoint(selected)),selected||"none"!=this.pointType?"source"==this.pointType?(this.sourcePoint=this.canvas.finalizePoint(this.sourcePoint),this.pointType="target",this.setPoint(this.model.addPoint(this.sourcePoint.x,this.sourcePoint.y)),this.createLine()):(this.targetPoint=this.canvas.finalizePoint(this.targetPoint),this.sourcePoint==this.targetPoint&&this.model.deleteLine(this.line),this.finalize()):(this.pointType="source",this.setPoint(this.model.addPoint(30,30)))},Grid.Action.LineDash=function(grid){Grid.Action.LineDash.superclass.constructor.call(this,grid)},YAHOO.lang.extend(Grid.Action.LineDash,Grid.Action.Line),Grid.Action.LineDash.prototype.createLine=function(){this.line=this.model.addLine(this.sourcePoint,this.targetPoint,"none","dashed")},Grid.Action.ArrowSingle=function(grid){Grid.Action.ArrowSingle.superclass.constructor.call(this,grid)},YAHOO.lang.extend(Grid.Action.ArrowSingle,Grid.Action.Line),Grid.Action.ArrowSingle.prototype.createLine=function(){this.line=this.model.addLine(this.sourcePoint,this.targetPoint,"forward")},Grid.Action.ArrowDouble=function(grid){Grid.Action.ArrowDouble.superclass.constructor.call(this,grid)},YAHOO.lang.extend(Grid.Action.ArrowDouble,Grid.Action.Line),Grid.Action.ArrowDouble.prototype.createLine=function(){this.line=this.model.addLine(this.sourcePoint,this.targetPoint,"both")},Grid.Action.Delete=function(grid){Grid.Action.Delete.superclass.constructor.call(this,grid),this.deletedPoint=null},YAHOO.lang.extend(Grid.Action.Delete,Grid.Action.Base),Grid.Action.Delete.prototype.onMouseEvent=function(evt){if("mouseup"==evt.name){var selected=this.canvas.getFocused();if(selected){switch(selected.getType()){case"point":this.model.deletePoint(selected);break;case"canvasimage":this.model.deleteImage(selected);break;case"circle":this.model.deleteEntity(selected)}this.finalize()}else{var targetEntity=this.model.getEntity(evt.target.id);if(targetEntity&&"line"==targetEntity.getType())this.model.deleteLine(targetEntity);else if(evt.touch){var closestLine=this.canvas.getNearestLineFromEvent(evt);closestLine&&this.model.deleteLine(closestLine)}}}"mouseup"!=evt.name&&"dragend"!=evt.name||this.finalize()},Grid.Action.Delete.prototype.onKeyEvent=function(evt){var selected=this.canvas.getFocused();if(selected){switch(selected.getType()){case"point":this.model.deletePoint(selected);break;case"canvasimage":this.model.deleteImage(selected)}this.finalize()}},Grid.Action.Circle=function(grid){Grid.Action.Circle.superclass.constructor.call(this,grid),this.createdCircle=null},YAHOO.lang.extend(Grid.Action.Circle,Grid.Action.Base),Grid.Action.Circle.prototype.create=function(x,y){var circle=this.model.createCircle(x,y,10);return this.model.addCircle(circle),circle},Grid.Action.Circle.prototype.dispose=function(){this.createdCircle.snap(),this.createdCircle=null},Grid.Action.Circle.prototype.onMouseEvent=function(evt){var x=evt.currentPosition.x,y=evt.currentPosition.y;if("mousedown"==evt.name){var entity=this.model.getEntity(evt.target.id);entity&&"circle"==entity.getType()?this.createdCircle=entity:this.createdCircle=this.create(x,y),null==this.createdCircle&&this.finalize()}if("drag"==evt.name){var radius=evt.currentPosition.x-evt.clickedPosition.x;this.createdCircle.radius=radius<10?this.createdCircle.radius:radius,this.createdCircle.update()}"mouseup"!=evt.name&&"dragend"!=evt.name||this.finalize()},Grid.Action.Circle.prototype.onKeyEvent=function(evt){this.createdPoint?this.finalize():(this.createdPoint=this.create(30,30),this.createdPoint.snapToGrid())},Grid.Toolbar=function(grid){this.grid=grid,this.view=grid.view,this._buttonHash={},this._buttons=[]},Grid.Toolbar.prototype.init=function(){for(var buttonNames=["move","delete","point","connect","arrow","arrw2","dash","circle"],grid=this.grid,i=0;i<buttonNames.length;i++){var buttonName=buttonNames[i],button=null;switch(buttonName){case"move":button=new Grid.Toolbar.Button.Circle(this,buttonName);break;default:button=new Grid.Toolbar.Button(this,buttonName)}button.hide(),this._buttons.push(button),this._buttonHash[buttonName]=button,function(button){var buttonGroup=button.getGroup();Grid.Utils.addMouseListener(buttonGroup,"mousedown",function(){grid.isReadOnly()||grid.setMode(button.name)},!1)}(button)}},Grid.Toolbar.prototype.getButton=function(buttonName){return this._buttonHash[buttonName]},Grid.Toolbar.prototype.getButtons=function(){return this._buttons},Grid.Toolbar.prototype.getVisibleButtons=function(){for(var visibleButtons=[],i=0;i<this._buttons.length;i++){var button=this._buttons[i];button.isVisible()&&visibleButtons.push(button)}return visibleButtons},Grid.Toolbar.prototype.resetButtons=function(){for(var i=0;i<this._buttons.length;i++)this._buttons[i].hide()},Grid.Toolbar.prototype.enableButtons=function(buttonNames){this.resetButtons();for(i=0;i<buttonNames.length;i++)(button=this._buttonHash[buttonNames[i]]).show();for(var x=5,i=0;i<this._buttons.length;i++){var button=this._buttons[i];if(button.isVisible()){var buttonGroup=button.getGroup();this.view.setAttributes(buttonGroup,{transform:"translate("+x+", 2)"}),x=x+button.width+5}}},Grid.Toolbar.prototype.processKeyEvent=function(evt){if("enter"!=evt.key){if("left"==evt.key||"right"==evt.key){var selectedButton=this.getButton(this.grid.getMode()),visibleButtons=this.getVisibleButtons();if(0!=visibleButtons.length){for(var i=0;i<visibleButtons.length;i++)if(visibleButtons[i]==selectedButton){"left"==evt.key?selectedButton=0==i?visibleButtons[visibleButtons.length-1]:visibleButtons[i-1]:"right"==evt.key&&(selectedButton=i==visibleButtons.length-1?visibleButtons[0]:visibleButtons[i+1]);break}this.grid.setMode(selectedButton.name)}}}else this.grid.setArea("canvas")},Grid.Action.registerAction("move",Grid.Action.Move),Grid.Action.registerAction("delete",Grid.Action.Delete),Grid.Action.registerAction("point",Grid.Action.Point),Grid.Action.registerAction("connect",Grid.Action.Line),Grid.Action.registerAction("arrow",Grid.Action.ArrowSingle),Grid.Action.registerAction("arrw2",Grid.Action.ArrowDouble),Grid.Action.registerAction("dash",Grid.Action.LineDash),Grid.Action.registerAction("circle",Grid.Action.Circle),Grid.Toolbar.Button=function(toolbar,name){this.name=name,this.width=100,this.toolbar=toolbar,this.grid=toolbar.grid,this.view=toolbar.view,this._visible=!0,this._state=Grid.Toolbar.Button.State.Up,this._iconFillElements=[],this._iconStrokeElements=[],this._init()},Grid.Toolbar.Button.State={Up:0,Selected:1,Over:2,SelectedOver:3},Grid.Toolbar.Button.prototype._init=function(){for(var buttonGroup=this.getGroup(),i=0;i<buttonGroup.childNodes.length;i++){var element=buttonGroup.childNodes[i];if(1==element.nodeType&&("#ffffff"==element.getAttribute("fill")&&this._iconFillElements.push(element),"#ffffff"==element.getAttribute("stroke")&&this._iconStrokeElements.push(element)),"object"==typeof window.Messages&&"text"==element.nodeName){var key="GridSVG.Label.button_"+element.textContent.replace(" ","_"),alternateLabel=window.Messages.get(key);alternateLabel!=key&&(element.textContent=alternateLabel)}}},Grid.Toolbar.Button.prototype.getGroup=function(){return this.view.getElementById("button_"+this.name)},Grid.Toolbar.Button.prototype.getContainer=function(){for(var buttonGroup=this.getGroup(),path=null,i=0;i<buttonGroup.childNodes.length;i++){var node=buttonGroup.childNodes[i];if("path"==node.nodeName){path=node;break}}return path},Grid.Toolbar.Button.prototype.show=function(){this.getGroup().style.display="",this._visible=!0},Grid.Toolbar.Button.prototype.hide=function(){this.getGroup().style.display="none",this._visible=!1},Grid.Toolbar.Button.prototype.isVisible=function(){return this._visible},Grid.Toolbar.Button.prototype._setIconColor=function(color){for(i=0;i<this._iconFillElements.length;i++)(element=this._iconFillElements[i]).setAttribute("fill",color);for(var i=0;i<this._iconStrokeElements.length;i++){var element=this._iconStrokeElements[i];element.setAttribute("stroke",color)}},Grid.Toolbar.Button.prototype.deselect=function(){this._state=Grid.Toolbar.Button.State.Up,this._setIconColor("#ffffff"),this.getContainer().setAttribute("fill","url(#buttons_background_up)")},Grid.Toolbar.Button.prototype.select=function(){this._state=Grid.Toolbar.Button.State.Selected,this._setIconColor("#1f5181"),this.getContainer().setAttribute("fill","url(#buttons_background_selected)")},Grid.Toolbar.Button.Circle=function(toolbar,name){Grid.Toolbar.Button.Circle.superclass.constructor.call(this,toolbar,name),this.width=18},Lang.extend(Grid.Toolbar.Button.Circle,Grid.Toolbar.Button),Grid.Toolbar.Button.Circle.prototype.getContainer=function(){for(var buttonGroup=this.getGroup(),circle=null,i=0;i<buttonGroup.childNodes.length;i++){var node=buttonGroup.childNodes[i];if("circle"==node.nodeName){circle=node;break}}return circle},Grid.Palette=function(grid){this.grid=grid,this.view=grid.view,this.model=grid.model,this.canvas=grid.canvas,this._selectedImage=null,this.moving=!1,Grid.Utils.hasSVGWeb()&&ErrorHandler.wrapFunctions(this,["processMouseEvent","subscribeToModelEvents"])},Grid.Palette.prototype.clearMoving=function(){this.moving=!1;var cloneID=this._selectedImage.getID()+"_clone";this.view.removeElement(cloneID),this.grid.setModeHint()},Grid.Palette.prototype.getSelected=function(){return this._selectedImage},Grid.Palette.prototype.hasSelected=function(){return null!=this._selectedImage},Grid.Palette.prototype.setSelected=function(paletteImage){if(this.moving&&this.clearMoving(),this._selectedImage&&this._selectedImage==paletteImage)return!1;if(this._selectedImage){id=this._selectedImage.getID()+"_border";this.view.deselectPaletteImage(),logger.debug("palette unselected: "+id)}if(this._selectedImage=paletteImage||null,paletteImage){var id=paletteImage.getID();this.view.selectPaletteImage(id),logger.debug("palette selected: "+id),this.grid.setMode("move"),this.grid.canvas.clearFocused()}return!0},Grid.Palette.prototype.clearSelected=function(){return this.setSelected(null)},Grid.Palette.prototype.processMouseEvent=function(evt){if(!this.moving&&"mousedown"==evt.name){if("panup"==evt.target.id||"pandown"==evt.target.id)return void("panup"==evt.target.id?this.grid.view._updatePaletteImgIndex(!0):this.grid.view._updatePaletteImgIndex(!1));"image"==evt.target.nodeName&&-1!=evt.target.id.indexOf("paletteimage_")?this.setSelected(this.model.getEntity(evt.target.id)):this.clearSelected()}var paletteImage=this.getSelected();if(null!=paletteImage){var imageID=paletteImage.getID(),cloneID=imageID+"_clone",gridX=evt.currentPosition.x-Math.round(paletteImage.width/2),gridY=evt.currentPosition.y-paletteImage.height;if(this.moving||"mousedown"!=evt.name&&"dragbegin"!=evt.name)if(!this.moving||"mousemove"!=evt.name&&"drag"!=evt.name){if(this.moving&&("mousedown"==evt.name||"dragend"==evt.name)){this.clearMoving(),this.clearSelected();var canvasPosition=this.view.translateElement("groupCanvas",evt.raw.clientX,evt.raw.clientY);if(canvasPosition&&canvasPosition.x>0&&canvasPosition.y>0){var image=this.model.addImage(paletteImage.name,canvasPosition.x,canvasPosition.y);this.grid.canvas.finalizeImage(image),this.grid.setArea("canvas")}}}else this.view.movePaletteImage(cloneID,gridX,gridY);else this.moving=!0,this.view.clonePaletteImage(imageID,cloneID),this.view.movePaletteImage(cloneID,gridX,gridY),this.grid.setHint("DraggingPaletteObject")}},Grid.Palette.prototype.processKeyEvent=function(evt){var selected=this.getSelected(),paletteImages=this.model.getPaletteImages();if("space"==evt.key){var image=this.model.addImage(selected.name,0,0);this.grid.canvas.finalizeImage(image),this.grid.canvas.setFocused(image),this.grid.setArea("canvas"),this.grid.setMode("move"),this.clearSelected(),this.grid.canvas.processKeyEvent(evt)}if(null!=selected||"up"!=evt.key&&"down"!=evt.key){if("up"==evt.key||"down"==evt.key){if(0==paletteImages.length)return;for(var paletteIndex=-1,i=0;i<paletteImages.length;i++)if(paletteImages[i]==selected){paletteIndex=i;break}"down"==evt.key&&(paletteIndex<paletteImages.length-1?this.setSelected(paletteImages[paletteIndex+1]):this.setSelected(paletteImages[0])),"up"==evt.key&&(0==paletteIndex?this.setSelected(paletteImages[paletteImages.length-1]):this.setSelected(paletteImages[paletteIndex-1]))}}else this.setSelected(paletteImages[0])},Grid.Palette.prototype.subscribeToModelEvents=function(){var view=this.view;this.model;this.model.subscribe("onAdd",function(entity){var id=entity.getID();entity instanceof Grid.Model.PaletteImage&&view.createPaletteImage(id,entity.width,entity.height,entity.url)}),this.model.subscribe("onDelete",function(entity){var id=entity.getID();entity instanceof Grid.Model.PaletteImage&&view.removePaletteImage(id)})},Grid.Canvas=function(grid){this.grid=grid,this.view=grid.view,this.model=grid.model,this._currentHover=null,this._currentFocus=null,this._currentAction=null,Grid.Utils.hasSVGWeb()&&ErrorHandler.wrapFunctions(this,["finalizePoint","finalizeLines","processMouseEvent","processKeyEvent","subscribeToModelEvents"]),this.init()},YAHOO.lang.augmentProto(Grid.Canvas,EventLazyProvider),Grid.Canvas.prototype.init=function(){var canvas=this,view=this.view,onEntityEvent=function(name,entity){logger.debug("EVENT - {name} ({id})",{name:name,id:entity.getID()}),entity.updateElement(view)};this.subscribe("onHover",function(entity){onEntityEvent("onHover",entity)}),this.subscribe("onHoverOut",function(entity){onEntityEvent("onHoverOut",entity)}),this.subscribe("onFocus",function(entity){onEntityEvent("onFocus",entity)}),this.subscribe("onFocusOut",function(entity){onEntityEvent("onFocusOut",entity)}),this.subscribe("onActionStart",function(action){var mode=this.grid.getMode(),focusedEntity=canvas.getFocused();"move"==mode&&null!=focusedEntity&&(focusedEntity.isSelected()?focusedEntity.deselect():focusedEntity.select())})},Grid.Canvas.prototype.getHovering=function(){return this._currentHover},Grid.Canvas.prototype.clearHovering=function(){if(null==this._currentHover)return!1;var entity=this._currentHover;return this._currentHover=null,entity.setHovering(!1),this.fireLazy("onHoverOut",entity),entity.isFocusable()===Grid.Model.Focusable.Auto&&this.clearFocused(entity),!0},Grid.Canvas.prototype.setHovering=function(entity){if(this._currentHover==entity)return!1;if(this.clearHovering(),null==entity)return!1;if(!entity.isHoverable())return!1;if(this.performingAction())return!1;var allowHover=this.fireLazy("onBeforeHover",entity);return allowHover&&(this._currentHover=entity,entity.setHovering(!0),this.fireLazy("onHover",entity),entity.isFocusable()===Grid.Model.Focusable.Auto&&this.setFocused(entity)),allowHover},Grid.Canvas.prototype.getFocused=function(){return this._currentFocus},Grid.Canvas.prototype.clearFocused=function(entity){return null!=this._currentFocus&&((null==entity||entity==this._currentFocus)&&(entity=this._currentFocus,this._currentFocus=null,entity.setFocused(!1),this.fireLazy("onFocusOut",entity),!0))},Grid.Canvas.prototype.setFocused=function(entity){if(entity==this._currentFocus)return!1;if(this.clearFocused(),null==entity)return!1;if(1==this.grid.palette.moving)return!1;if(!entity.isFocusable())return!1;var allowFocus=this.fireLazy("onBeforeFocus",entity);return allowFocus&&(this._currentFocus=entity,entity.setFocused(!0),this.fireLazy("onFocus",entity)),allowFocus},Grid.Canvas.prototype.performingAction=function(){return null!=this._currentAction},Grid.Canvas.prototype.startAction=function(){if(null!=this._currentAction)return!1;var focusedEntity=this.getFocused();null!=focusedEntity&&focusedEntity.isMoveable()&&this.clearHovering();var mode=this.grid.getMode(),actionClass=Grid.Action.actions[mode];return null!=actionClass&&(this._currentAction=new actionClass(this.grid),this.fireLazy("onActionStart",this._currentAction),!0)},Grid.Canvas.prototype.stopAction=function(){if(null==this._currentAction)return!1;this._currentAction.isCompleted()||this._currentAction.finalize(),this.grid.setModeHint();var action=this._currentAction;return this._currentAction=null,this.fireLazy("onActionEnd",action),!0},Grid.Canvas.prototype.getNearestPoint=function(x,y,tolerance){tolerance=tolerance>0?tolerance:this.model.options.selectionTolerance;for(var targetPoint=new Point2D(x,y),closestPoint=null,closestDistance=1/0,points=this.model.getPoints(),i=0;i<points.length;i++){var point=points[i],distance=targetPoint.distanceFrom(point);distance<=tolerance&&distance<closestDistance&&(closestDistance=distance,closestPoint=point)}return closestPoint},Grid.Canvas.prototype.getNearestPointFromEvent=function(evt){var x=evt.clickedPosition.x,y=evt.clickedPosition.y;return this.getNearestPoint(x,y)},Grid.Canvas.prototype.getNearestLine=function(x,y,tolerance){tolerance=tolerance>0?tolerance:this.model.options.selectionTolerance;for(var targetPoint=new Point2D(x,y),closestLine=null,closestDistance=1/0,lines=this.model.getLines(),i=0;i<lines.length;i++){var line=lines[i],distance=line.distanceFromPoint(targetPoint);distance<=tolerance&&distance<closestDistance&&(closestDistance=distance,closestLine=line)}return closestLine},Grid.Canvas.prototype.getNearestLineFromEvent=function(evt){var x=evt.clickedPosition.x,y=evt.clickedPosition.y;return this.getNearestLine(x,y)},Grid.Canvas.prototype.getFocusableEntity=function(evt){var entity=this.model.getEntity(evt.target.id);return entity&&entity.isFocusable()?entity:evt.touch?this.getNearestPointFromEvent(evt):null},Grid.Canvas.prototype.finalizePoint=function(point){var lines=point.getLines();point.snap();var intersectedPoints=point.getIntersections();if(0==intersectedPoints.length)return this.finalizeLines(lines),point;var mergePoint=intersectedPoints[0];return point.moveLines(mergePoint),point==this.getFocused()&&this.setFocused(mergePoint),this.model.deletePoint(point),this.finalizeLines(mergePoint.getLines()),mergePoint},Grid.Canvas.prototype.finalizeLines=function(pointLines){if(!(this._currentAction instanceof Grid.Action.Line&&null==this._currentAction.targetPoint))for(var i=0;i<pointLines.length;i++)for(var pointLine=pointLines[i],lines=this.model.getLinesByDir(pointLine.dirType),j=0;j<lines.length;j++){var line=lines[j];if(pointLine!=line&&(pointLine.isParallelTo(line,10)&&!(pointLine.distanceFrom(line)>4))){var newLine=pointLine.getLongestLine(line);this.model.deleteLine(line),this.model.deleteLine(pointLine);var mergedLine=this.model.addLine(newLine.source,newLine.target,pointLine.dirType,pointLine.style);0==line.source.getLines().length&&this.model.deletePoint(line.source),0==line.target.getLines().length&&this.model.deletePoint(line.target),0==pointLine.source.getLines().length&&this.model.deletePoint(pointLine.source),0==pointLine.target.getLines().length&&this.model.deletePoint(pointLine.target);var mergedLines=[];return mergedLines.push(mergedLine),void this.finalizeLines(mergedLines)}}},Grid.Canvas.prototype.finalizeImage=function(image){image.snap()},Grid.Canvas.prototype.processMouseEvent=function(evt){this._checkForMouseHover(evt),this._checkForMouseFocus(evt),this._processMouseAction(evt)},Grid.Canvas.prototype._checkForMouseHover=function(evt){if("mousemove"==evt.name&&!this.performingAction()&&null!=evt.target&&null!=evt.target.id){var entity=this.model.getEntity(evt.target.id);entity&&entity.isHoverable()?this.setHovering(entity):this.clearHovering()}},Grid.Canvas.prototype._checkForMouseFocus=function(evt){if("mousedown"==evt.name&&null!=evt.target){var entity=this.getFocusableEntity(evt);entity&&entity.isFocusable()?this.setFocused(entity):this.clearFocused()}},Grid.Canvas.prototype._processMouseAction=function(evt){this.grid.getMode();if(null==this._currentAction){if("mousedown"!=evt.name)return;this.startAction()}try{this._currentAction.onMouseEvent(evt)}catch(ex){throw this._currentAction=null,ex}null!=this._currentAction&&this._currentAction.isCompleted()&&this.stopAction()},Grid.Canvas.prototype.getFocusableObjects=function(typeFilter){for(var focusableEntities=[],entities=this.model.getEntities(),i=0;i<entities.length;i++){var entity=entities[i];("function"!=typeof typeFilter||entity instanceof typeFilter)&&entity.isFocusable()&&focusableEntities.push(entities[i])}return focusableEntities},Grid.Canvas.prototype.processKeyEvent=function(evt){var focusedObject=this.getFocused();if("esc"==evt.key&&(this.clearFocused(),this.stopAction()),"enter"==evt.key&&null==this._currentAction){var objects;objects="move"==this.grid.getMode()||"delete"==this.grid.getMode()?this.getFocusableObjects(Grid.Model.Base):this.getFocusableObjects(Grid.Model.Point);var nextObject=this._nextObjectInFocusableOrder(focusedObject,objects);return focusedObject!=nextObject&&this.stopAction(),void this.setFocused(nextObject)}if("space"==evt.key&&this._processKeyAction("keydown",evt),null!=this._currentAction){var moveKey=!evt.dom.ctrlKey&&("left"==evt.key||"right"==evt.key||"up"==evt.key||"down"==evt.key);if(focusedObject&&moveKey){focusedObject.x,focusedObject.y;var moveSize=evt.dom.shiftKey?1:10;"left"==evt.key&&focusedObject.moveLeft(moveSize),"right"==evt.key&&focusedObject.moveRight(moveSize),"up"==evt.key&&focusedObject.moveUp(moveSize),"down"==evt.key&&focusedObject.moveDown(moveSize)}}},Grid.Canvas.prototype._processKeyAction=function(name,evt){var mode=this.grid.getMode();null==this._currentAction&&this.startAction();try{this._currentAction.onKeyEvent(evt)}catch(ex){throw this._currentAction.finalize(),this._currentAction=null,ex}this._currentAction.isCompleted()&&(this._currentAction=null,logger.debug("Action - {mode} completed",{mode:mode}))},Grid.Canvas.prototype._firstObjectInFocusableOrder=function(positions){for(var firstPosition=null,i=0;i<positions.length;i++){var existingPosition=positions[i];null==firstPosition?firstPosition=existingPosition:(existingPosition.y<firstPosition.y||existingPosition.y==firstPosition.y&&existingPosition.x<firstPosition.x)&&(firstPosition=existingPosition)}return firstPosition},Grid.Canvas.prototype._nextObjectInFocusableOrder=function(currentPosition,positions){if(null==currentPosition)return this._firstObjectInFocusableOrder(positions);for(var nextPosition=null,i=0;i<positions.length;i++){var existingPosition=positions[i];existingPosition.y<currentPosition.y||existingPosition.y==currentPosition.y&&existingPosition.x<=currentPosition.x||(null==nextPosition?nextPosition=existingPosition:(existingPosition.y<nextPosition.y||existingPosition.y==nextPosition.y&&existingPosition.x<nextPosition.x)&&(nextPosition=existingPosition))}return null==nextPosition&&(nextPosition=this._firstObjectInFocusableOrder(positions)),nextPosition},Grid.Canvas.prototype.reorderImages=function(){var images=this.model.getImages();images.sort(function(imageA,imageB){var sizeA=imageA.getSize(),sizeB=imageB.getSize();return sizeA>sizeB?-1:sizeA<sizeB?1:0});for(var i=0;i<images.length;i++){var image=images[i];this.view.bringToFront(image.getID())}},Grid.Canvas.prototype.subscribeToModelEvents=function(){var canvas=this,view=this.view;this.model.subscribe("onAdd",function(entity){entity.createElement(view),entity.updateElement(view),entity instanceof Grid.Model.Point&&canvas.setFocused(entity),entity instanceof Grid.Model.Image&&canvas.reorderImages()}),this.model.subscribe("onDelete",function(entity){canvas.clearHovering(),canvas.clearFocused(entity),entity.removeElement(view)}),this.model.subscribe("onMove",function(entity){entity.moveElement(view)}),this.model.subscribe("onUpdate",function(entity){entity.updateElement(view)})},Grid.ImportExport=function(gquestion){function translateCoordinate(y){return gridquestion.options.canvasHeight-y}var answerSpaceXml,gridquestion=gquestion;this.isStudentResponseValid=function(){function edgesEqual(edges1,edges2){if(edges1.length!=edges2.length)return!1;if(0==edges1.length)return!0;for(var i=0;i<edges1.length;i++){for(var found=!1,j=0;j<edges2.length;j++)(edges1[i].source.x==edges2[j].source.x&&edges1[i].source.y==edges2[j].source.y&&edges1[i].target.x==edges2[j].target.x&&edges1[i].target.y==edges2[j].target.y||edges1[i].source.x==edges2[j].target.x&&edges1[i].source.y==edges2[j].target.y&&edges1[i].target.x==edges2[j].source.x&&edges1[i].target.y==edges2[j].source.y)&&(found=!0);if(!found)return!1}return!0}if(null==answerSpaceXml)return!1;var xmlobject=Grid.ImportExport.parseFromString(answerSpaceXml),originalquestion=new Grid.Model;originalquestion._paletteimages=gridquestion._paletteimages;var imageLoader=new Grid.ImportExport.ImageLoader;Grid.ImportExport.loadHotspots(xmlobject,originalquestion,imageLoader);var presetAnswerList=xmlobject.getElementsByTagName("PreSetAnswerPart");if(presetAnswerList&&presetAnswerList[0]&&presetAnswerList[0].childNodes[0]){var presetAnswerXml=Grid.ImportExport.serializeToString(presetAnswerList[0]);this.loadAnswer(presetAnswerXml,originalquestion)}if(!function(points1,points2){if(points1.length!=points2.length)return!1;if(0==points1.length)return!0;for(var i=0;i<points1.length;i++){for(var found=!1,j=0;j<points2.length;j++)points1[i].x==points2[j].x&&points1[i].y==points2[j].y&&(found=!0);if(!found)return!1}return!0}(originalquestion.getPoints(),gridquestion.getPoints()))return!0;if(!edgesEqual(originalquestion.getLines(),gridquestion.getLines()))return!0;if(!function(images1,images2){if(images1.length!=images2.length)return!1;if(0==images1.length)return!0;for(var i=0;i<images1.length;i++){for(var found=!1,j=0;j<images2.length;j++)images1[i].name==images2[j].name&&images1[i].x==images2[j].x&&images1[i].y==images2[j].y&&(found=!0);if(!found)return!1}return!0}(originalquestion.getImages(),gridquestion.getImages()))return!0;if(!function(arrows1,arrows2){if(arrows1.length!=arrows2.length)return!1;if(0==arrows1.length)return!0;for(var i=0;i<arrows1.length;i++){for(var found=!1,j=0;j<arrows2.length;j++)arrows1[i].source.x==arrows2[j].source.x&&arrows1[i].source.y==arrows2[j].source.y&&arrows1[i].target.x==arrows2[j].target.x&&arrows1[i].target.y==arrows2[j].target.y&&(found=!0);if(!found)return!1}return!0}(originalquestion.getLinesByDir("forward"),gridquestion.getLinesByDir("forward")))return!0;if(!function(da1,da2){return edgesEqual(da1,da2)}(originalquestion.getLinesByDir("both"),gridquestion.getLinesByDir("both")))return!0;for(var regions=gridquestion.getRegions(),i=0;i<regions.length;i++){var originalRegion=originalquestion.getRegion(regions[i].name);if(originalRegion&&regions[i].isSelected()!=originalRegion.isSelected())return!0}return!1},this.getAnswerXml=function(){function createAtomicObject(xmlDoc,ObjectSetNode){for(var images=gridquestion.getImages(),i=0;i<images.length;i++){var AtomicObjectNode=xmlDoc.createElement("AtomicObject"),pointXY=images[i].x+","+translateCoordinate(images[i].y),str="{"+images[i].name+"("+pointXY+")}",TextNode=xmlDoc.createTextNode(str);AtomicObjectNode.appendChild(TextNode),ObjectSetNode.appendChild(AtomicObjectNode)}}function createRegionGroupObjects(xmlDoc,ObjectSetNode){for(var regionGroupsList=gridquestion.getRegionGroups(),i=0;i<regionGroupsList.length;i++){var regionGroupObj=regionGroupsList[i],regionGroupNode=xmlDoc.createElement("RegionGroupObject");regionGroupNode.setAttribute("name",regionGroupObj.name),regionGroupNode.setAttribute("numselected",regionGroupObj.getSelectedRegions().length);for(var regionsList=regionGroupObj.getRegions(),j=0;j<regionsList.length;j++){var regionObj=regionsList[j],regionNode=xmlDoc.createElement("RegionObject");regionNode.setAttribute("name",regionObj.name),regionNode.setAttribute("isselected",regionObj.isSelected().toString()),regionGroupNode.appendChild(regionNode)}ObjectSetNode.appendChild(regionGroupNode)}}function createPointObject(xmlDoc,ObjectSetNode,points){if(points)for(var i=0;i<points.length;i++){var ObjectNode=xmlDoc.createElement("Object"),PointVectorNode=xmlDoc.createElement("PointVector"),EdgeVectorNode=xmlDoc.createElement("EdgeVector"),LabelListNode=xmlDoc.createElement("LabelList"),ValueListNode=xmlDoc.createElement("ValueList"),pointStr="{("+points[i].x+","+translateCoordinate(points[i].y)+")}",PointTextNode=xmlDoc.createTextNode(pointStr);PointVectorNode.appendChild(PointTextNode);var EdgeTextNode=xmlDoc.createTextNode(" {} ");EdgeVectorNode.appendChild(EdgeTextNode);var LabelTextNode=xmlDoc.createTextNode(" {} ");LabelListNode.appendChild(LabelTextNode);var ValueTextNode=xmlDoc.createTextNode(" {} ");ValueListNode.appendChild(ValueTextNode),ObjectNode.appendChild(PointVectorNode),ObjectNode.appendChild(EdgeVectorNode),ObjectNode.appendChild(LabelListNode),ObjectNode.appendChild(ValueListNode),ObjectSetNode.appendChild(ObjectNode)}}function createConnectedLinesObj(xmlDoc,ObjectSetNode,thisWorkingLines){for(var ObjectNode=xmlDoc.createElement("Object"),PointVectorNode=xmlDoc.createElement("PointVector"),EdgeVectorNode=xmlDoc.createElement("EdgeVector"),LabelListNode=xmlDoc.createElement("LabelList"),ValueListNode=xmlDoc.createElement("ValueList"),pointsStr="{",linesStr="{",linePoints=[],i=0;i<thisWorkingLines.length;i++){var sourceXY=thisWorkingLines[i].source.x+","+translateCoordinate(thisWorkingLines[i].source.y),targetXY=thisWorkingLines[i].target.x+","+translateCoordinate(thisWorkingLines[i].target.y);linesStr+=" {("+sourceXY+"),("+targetXY+")}",0==i?(linePoints.push(sourceXY),linePoints.push(targetXY)):(findExistingItem(linePoints,sourceXY)||linePoints.push(sourceXY),findExistingItem(linePoints,targetXY)||linePoints.push(targetXY))}for(i=0;i<linePoints.length;i++)pointsStr+="("+linePoints[i]+")";pointsStr+="}";var PointVectorTextNode=xmlDoc.createTextNode(pointsStr);PointVectorNode.appendChild(PointVectorTextNode),linesStr+="}";var EdgeVectorTextNode=xmlDoc.createTextNode(linesStr);EdgeVectorNode.appendChild(EdgeVectorTextNode);var LabelTextNode=xmlDoc.createTextNode(" {} ");LabelListNode.appendChild(LabelTextNode);var ValueTextNode=xmlDoc.createTextNode(" {} ");ValueListNode.appendChild(ValueTextNode),ObjectNode.appendChild(PointVectorNode),ObjectNode.appendChild(EdgeVectorNode),ObjectNode.appendChild(LabelListNode),ObjectNode.appendChild(ValueListNode),ObjectSetNode.appendChild(ObjectNode)}function findExistingItem(array,item){for(var i=0;i<array.length;i++)if(item==array[i])return!0;return!1}function addLinePointsToQueue(pointQueue,line){var rtnPointQueue=pointQueue;return pointExistsInQueue(pointQueue,line.source)||rtnPointQueue.push(line.source),pointExistsInQueue(pointQueue,line.target)||rtnPointQueue.push(line.target),rtnPointQueue}function pointExistsInQueue(pointQueue,point){for(var i=0;i<pointQueue.length;i++)if(point==pointQueue[i])return!0;return!1}function getNewLinesConnectedToPoint(remainingLines,workingLines,pointQueue,point){for(var newLines=[],i=0;i<remainingLines.length;i++)if(remainingLines[i].source==point||remainingLines[i].target==point){for(var found=!1,j=0;j<workingLines.length;j++)if(workingLines[j]==remainingLines[i]){found=!0;break}found||newLines.push(remainingLines[i])}return newLines}function getRemainingLines(remainingLines,thisWorkingLines){for(var rLines=[],i=0;i<remainingLines.length;i++){for(var found=!1,j=0;j<thisWorkingLines.length;j++)if(remainingLines[i]==thisWorkingLines[j]){found=!0;break}found||rLines.push(remainingLines[i])}return rLines}function getIsolatedPoints(){for(var lines=gridquestion.getLines(),points=gridquestion.getPoints(),iPoints=[],i=0;i<points.length;i++){for(var found=!1,j=0;j<lines.length;j++)if(points[i]==lines[j].source||points[i]==lines[j].target){found=!0;break}found||iPoints.push(points[i])}return iPoints}var xmlDoc=Grid.ImportExport.parseFromString("<root></root>"),AnswerSetNode=xmlDoc.createElement("AnswerSet"),QuestionNode=xmlDoc.createElement("Question");QuestionNode.setAttribute("id",gridquestion.id),AnswerSetNode.appendChild(QuestionNode);var QuestionPartNode=xmlDoc.createElement("QuestionPart");QuestionPartNode.setAttribute("id",1),QuestionNode.appendChild(QuestionPartNode);var ObjectSetNode=xmlDoc.createElement("ObjectSet");QuestionPartNode.appendChild(ObjectSetNode),function(xmlDoc,ObjectSetNode){gridquestion.getLinesByDir("none"),gridquestion.getPoints();for(var remainingLines=gridquestion.getLinesByDir("none");remainingLines.length>0;){var thisWorkingLines=[],thisPointQueue=[];for(thisWorkingLines.push(remainingLines[0]),thisPointQueue=addLinePointsToQueue(thisPointQueue,remainingLines[0]);thisPointQueue&&thisPointQueue.length>0;){var newLines=getNewLinesConnectedToPoint(remainingLines,thisWorkingLines,thisPointQueue,thisPointQueue.shift());if(newLines)for(var i=0;i<newLines.length;i++)thisWorkingLines.push(newLines[i]),addLinePointsToQueue(thisPointQueue,newLines[i])}remainingLines=getRemainingLines(remainingLines,thisWorkingLines),thisWorkingLines.length>0&&createConnectedLinesObj(xmlDoc,ObjectSetNode,thisWorkingLines)}var iPoints=getIsolatedPoints();iPoints.length>0&&createPointObject(xmlDoc,ObjectSetNode,iPoints),createAtomicObject(xmlDoc,ObjectSetNode),createRegionGroupObjects(xmlDoc,ObjectSetNode)}(xmlDoc,ObjectSetNode);xmlDoc.createElement("TerminatedEdgeObject");!function(xmlDoc,ObjectSetNode){for(var arrows=gridquestion.getLinesByDir("forward"),i=0;i<arrows.length;i++){var tNode=xmlDoc.createElement("TerminatedEdgeObject"),str="("+(sourceXY=arrows[i].source.x+","+translateCoordinate(arrows[i].source.y))+"),("+(targetXY=arrows[i].target.x+","+translateCoordinate(arrows[i].target.y))+"),Type-1",textNode=xmlDoc.createTextNode(str);tNode.appendChild(textNode),ObjectSetNode.appendChild(tNode)}for(var doubleArrows=gridquestion.getLinesByDir("both"),i=0;i<doubleArrows.length;i++){var tNode=xmlDoc.createElement("TerminatedEdgeObject"),sourceXY=doubleArrows[i].source.x+","+translateCoordinate(doubleArrows[i].source.y),targetXY=doubleArrows[i].target.x+","+translateCoordinate(doubleArrows[i].target.y),str="("+sourceXY+"),("+targetXY+"),Type-2",textNode=xmlDoc.createTextNode(str);tNode.appendChild(textNode),ObjectSetNode.appendChild(tNode)}}(xmlDoc,ObjectSetNode),function(xmlDoc,QuestionPartNode){for(var SnapPointNode=xmlDoc.createElement("SnapPoint"),snapPoints=gridquestion.getSnapPoints(),str="",i=0;i<snapPoints.length;i++)0==i&&(str=snapPoints[0].snapRadius+"@"),str+=snapPoints[i].x+","+snapPoints[i].y,i!=snapPoints.length-1&&(str+=";");var textNode=xmlDoc.createTextNode(str);SnapPointNode.appendChild(textNode),QuestionPartNode.appendChild(SnapPointNode)}(xmlDoc,QuestionPartNode),Grid.ImportExport.writeShapes(QuestionPartNode,gridquestion);var header='<?xml version="1.0" encoding="UTF-8"?>';if("undefined"!=typeof XMLSerializer)return header+(new XMLSerializer).serializeToString(AnswerSetNode);if(AnswerSetNode.xml)return header+AnswerSetNode.xml;throw Error("This browser does not support serializing XML nodes")};var parseImageFiles=function(questionXml){var getTextContent=function(node){return node&&node.childNodes&&node.childNodes.length?node.childNodes[0].nodeValue:null},imageFiles=[],xmlDoc=Grid.ImportExport.parseFromString(questionXml),imageNodes=xmlDoc.getElementsByTagName("FileSpec");return Grid.ImportExport.eachNode(imageNodes,function(imageNode){var imageFile=getTextContent(imageNode);-1==imageFiles.indexOf(imageFile)&&imageFiles.push(imageFile)}),imageNodes=xmlDoc.getElementsByTagName("Image"),Grid.ImportExport.eachNode(imageNodes,function(imageNode){var imageFile=imageNode.getAttribute("src");-1==imageFiles.indexOf(imageFile)&&imageFiles.push(imageFile)}),imageFiles};this.loadItem=function(questionXml,callbackCreated,callbackFailure){var imageFiles=parseImageFiles(questionXml),imageLoader=new Grid.ImportExport.ImageLoader;if(0!=imageFiles.length){for(var i=0;i<imageFiles.length;i++){var url=Grid.ImportExport.resolveUrl(imageFiles[i]);imageLoader.addImage(url)}var self=this;imageLoader.load(function(){var imageErrors=imageLoader.getErrors();0==imageErrors.length?self.loadItem2.call(self,questionXml,callbackCreated,imageLoader):callbackFailure("Error loading DOM images",imageErrors)})}else this.loadItem2(questionXml,callbackCreated,imageLoader)},this.loadItem2=function(questionXml,callback,imageLoader){function removeQuotes(str){var first=str.indexOf('"');if(-1==first)return str;var second=(str=str.substring(first+1)).lastIndexOf('"');return-1==second?str:str.substring(0,second)}answerSpaceXml=questionXml,gridquestion.clearQuestion();var xmlobject=Grid.ImportExport.parseFromString(questionXml);Grid.ImportExport.loadOptions(xmlobject,gridquestion);var backgroundImageList=xmlobject.getElementsByTagName("ImageSpec");if(backgroundImageList&&backgroundImageList[0]&&backgroundImageList[0].childNodes[0])for(i=0;i<backgroundImageList.length;i++)!function(bkgNode){for(var node=bkgNode.firstChild,fileSpec="",position="";node;){if("FileSpec"==node.nodeName?fileSpec=removeQuotes(node.childNodes[0].nodeValue):"Position"==node.nodeName&&(position=removeQuotes(node.childNodes[0].nodeValue)),""!=fileSpec&&""!=position){var xy=position.split(","),url=Grid.ImportExport.resolveUrl(fileSpec),htmlImage=imageLoader.getImage(url);return void(null!=htmlImage&&gridquestion.addBackgroundImage(htmlImage.src,1*xy[0],1*xy[1],htmlImage.width,htmlImage.height))}node=node.nextSibling}}(backgroundImageList[i]);var palleteImageList=xmlobject.getElementsByTagName("IconSpec");if(palleteImageList&&palleteImageList[0]&&palleteImageList[0].childNodes[0])for(var i=0;i<palleteImageList.length;i++)!function(palleteNode){for(var node=palleteNode.firstChild,labelName="",fileName="";node;){if("FileSpec"==node.nodeName?fileName=removeQuotes(node.childNodes[0].nodeValue):"Label"==node.nodeName&&(labelName=removeQuotes(node.childNodes[0].nodeValue),labelName=YAHOO.lang.trim(labelName)),""!=fileName&&""!=labelName){var url=Grid.ImportExport.resolveUrl(fileName),htmlImage=imageLoader.getImage(url);return void(null!=htmlImage&&gridquestion.addPaletteImage(labelName,htmlImage.src,htmlImage.width,htmlImage.height))}node=node.nextSibling}}(palleteImageList[i]);Grid.ImportExport.loadHotspots(xmlobject,gridquestion,imageLoader);var presetAnswerList=xmlobject.getElementsByTagName("PreSetAnswerPart");presetAnswerList&&presetAnswerList[0]&&presetAnswerList[0].childNodes[0]&&this.loadAnswer(Grid.ImportExport.serializeToString(presetAnswerList[0])),gridquestion.getPaletteImages().length>0&&0==gridquestion.getPoints().length&&0==gridquestion.getImages().length?gridquestion.options.showPalette=!0:gridquestion.options.showPalette=!1,"function"==typeof callback&&callback()},this.loadAnswer=function(response,gridq){function parsePointVectorString(pointsStr,gridq){for(var indexLeft=pointsStr.indexOf("("),indexRight=pointsStr.indexOf(")");-1!=indexLeft&&-1!=indexRight;){var pntStr=pointsStr.substring(indexLeft+1,indexRight);pointsStr=pointsStr.substring(indexRight+1);var indexComma=pntStr.indexOf(","),x=parseInt(pntStr.substring(0,indexComma)),y=parseInt(pntStr.substring(indexComma+1));null==gridq?gridquestion.addPoint(x,translateCoordinate(y)):gridq.addPoint(x,translateCoordinate(y)),indexLeft=pointsStr.indexOf("("),indexRight=pointsStr.indexOf(")")}}function parseEdgeVectorString(edgesStr,gridq){for(var firstLeft=edgesStr.indexOf("{"),lastRight=edgesStr.lastIndexOf("}"),indexLeft=(edgesStr=edgesStr.substring(firstLeft+1,lastRight)).indexOf("{"),indexRight=edgesStr.indexOf("}");-1!=indexLeft&&-1!=indexRight;)parseSingleLine(edgesStr.substring(indexLeft+1,indexRight),"none",gridq),indexLeft=(edgesStr=edgesStr.substring(indexRight+1)).indexOf("{"),indexRight=edgesStr.indexOf("}")}function parseSingleLine(eStr,dirType,gridq){var point1,indexLeft=eStr.indexOf("("),indexRight=eStr.indexOf(")"),pntStr=eStr.substring(indexLeft+1,indexRight),indexComma=pntStr.indexOf(","),x=parseInt(pntStr.substring(0,indexComma)),y=parseInt(pntStr.substring(indexComma+1));point1=null==gridq?"none"!=dirType?gridquestion.addPoint(x,translateCoordinate(y)):getExistingPoint(x,translateCoordinate(y),gridq):"none"!=dirType?gridq.addPoint(x,translateCoordinate(y)):getExistingPoint(x,translateCoordinate(y),gridq),indexLeft=(pntStr=eStr.substring(indexRight+1)).indexOf("("),indexRight=pntStr.indexOf(")"),indexComma=(pntStr=pntStr.substring(indexLeft+1,indexRight)).indexOf(","),x=parseInt(pntStr.substring(0,indexComma)),y=parseInt(pntStr.substring(indexComma+1));var point2;null==gridq?(point2="none"!=dirType?gridquestion.addPoint(x,translateCoordinate(y)):getExistingPoint(x,translateCoordinate(y),gridq),point1&&point2&&gridquestion.addLine(point1,point2,dirType)):(point2="none"!=dirType?gridq.addPoint(x,translateCoordinate(y)):getExistingPoint(x,translateCoordinate(y),gridq),point1&&point2&&gridq.addLine(point1,point2,dirType))}function getExistingPoint(x,y,gridq){var points;points=null==gridq?gridquestion.getPoints():gridq.getPoints();for(var i=0;i<points.length;i++)if(points[i].x==x&&points[i].y==y)return points[i];return null}null==gridq?gridquestion.clearResponse():gridq.clearResponse();var xmlobject=Grid.ImportExport.parseFromString(response),objectList=xmlobject.getElementsByTagName("Object");if(objectList&&objectList[0]&&objectList[0].childNodes[0])for(i=0;i<objectList.length;i++)!function(obj,gridq){for(var node=obj.firstChild;node;)"PointVector"==node.nodeName?parsePointVectorString(node.childNodes[0].nodeValue,gridq):"EdgeVector"==node.nodeName&&parseEdgeVectorString(node.childNodes[0].nodeValue,gridq),node=node.nextSibling}(objectList[i],gridq);var atomicObjList=xmlobject.getElementsByTagName("AtomicObject");if(atomicObjList&&atomicObjList[0]&&atomicObjList[0].childNodes[0])for(i=0;i<atomicObjList.length;i++)!function(obj,gridq){var atomicStr=obj.childNodes[0].nodeValue,first=atomicStr.indexOf("{"),second=atomicStr.indexOf("("),third=atomicStr.indexOf(")"),labelName=atomicStr.substring(first+1,second),pntStr=atomicStr.substring(second+1,third),indexComma=pntStr.indexOf(","),x=parseInt(pntStr.substring(0,indexComma)),y=parseInt(pntStr.substring(indexComma+1));null==gridq?gridquestion.addImage(YAHOO.lang.trim(labelName),x,translateCoordinate(y)):gridq.addImage(YAHOO.lang.trim(labelName),x,translateCoordinate(y))}(atomicObjList[i],gridq);var terminatedEdgeList=xmlobject.getElementsByTagName("TerminatedEdgeObject");if(terminatedEdgeList&&terminatedEdgeList[0]&&terminatedEdgeList[0].childNodes[0])for(i=0;i<terminatedEdgeList.length;i++)!function(obj,gridq){var arrowStr=obj.childNodes[0].nodeValue,index=arrowStr.indexOf(",Type-"),dirType="both";"1"==arrowStr.substring(index+6)&&(dirType="forward"),parseSingleLine(arrowStr.substring(0,index),dirType,gridq)}(terminatedEdgeList[i],gridq);var snapPointList=xmlobject.getElementsByTagName("SnapPoint");if(snapPointList&&snapPointList[0]&&snapPointList[0].childNodes[0])for(var i=0;i<snapPointList.length;i++)!function(snapPoint,gridq){if(0!=snapPoint.childNodes.length)for(var snapStr=snapPoint.childNodes[0].nodeValue,first=snapStr.indexOf("@"),snapRadius=parseInt(snapStr.substring(0,first)),index=(snapStr=snapStr.substring(first+1)+";").indexOf(";");-1!=index;){var pntStr=snapStr.substring(0,index),indexComma=pntStr.indexOf(","),x=parseInt(pntStr.substring(0,indexComma)),y=parseInt(pntStr.substring(indexComma+1));null==gridq?gridquestion.addSnapPoint(x,y,snapRadius):gridq.addSnapPoint(x,y,snapRadius),index=(snapStr=snapStr.substring(index+1)).indexOf(";")}}(snapPointList[i],gridq);var model=null!=gridq?gridq:gridquestion;Grid.ImportExport.loadRegionGroupObjects(xmlobject,model),Grid.ImportExport.loadShapes(xmlobject,model),null==gridq&&(gridquestion.importing=!0)}},Grid.ImportExport.parseFromString=function(text){if("string"!=typeof text)return text;var xmlDoc;window.DOMParser?xmlDoc=(new window.DOMParser).parseFromString(text,"text/xml"):((xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async="false",xmlDoc.validateOnParse="false",xmlDoc.loadXML(text));var errorMsg=null;if(xmlDoc.parseError&&0!=xmlDoc.parseError.errorCode?errorMsg="XML Parsing Error: "+xmlDoc.parseError.reason+" at line "+xmlDoc.parseError.line+" at position "+xmlDoc.parseError.linepos:xmlDoc.documentElement?"parsererror"==xmlDoc.documentElement.nodeName&&(errorMsg=xmlDoc.documentElement.childNodes[0].nodeValue):errorMsg="XML Parsing Error",errorMsg)throw new Error(errorMsg);return xmlDoc},Grid.ImportExport.serializeToString=function(node){return node.xml||(new XMLSerializer).serializeToString(node)},Grid.ImportExport.eachNode=function(nodeList,func){for(var nodes=[],i=0;i<nodeList.length;i++){var node=nodeList[i]||nodeList.item(i);nodes.push(node)}YAHOO.util.Dom.batch(nodes,func)},Grid.ImportExport.resolveUrl=function(url){url=(url=url.replace(/&amp;/g,"&")).split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var el=document.createElement("div");return el.innerHTML='<a href="'+url+'">x</a>',el.firstChild.href},Grid.ImportExport.getFilename=function(path){return path.substr(path.lastIndexOf("/")+1)},Grid.ImportExport.ImageLoader=function(){this._requests=[],this._completedCount=0,this._completedCallback=null,this.getRequests=function(){return this._requests},this.addImage=function(url,callback,label){var request={url:url,callback:callback,image:null,label:label};this._requests.push(request)},this.getImage=function(url){for(var i=0;i<this._requests.length;i++){var request=this._requests[i];if(request.url==url)return request.image}return null},this.isCompleted=function(){return this._completedCount==this._requests.length},this.getErrors=function(){for(var imageErrors=[],i=0;i<this._requests.length;i++){var request=this._requests[i];1!=request.image.state&&imageErrors.push(request.image)}return imageErrors},this.load=function(callback){this._completedCallback=callback;for(var i=0;i<this._requests.length;i++){var request=this._requests[i];this._requestImage(request)}},this._requestImage=function(request){var self=this;request.image=new Image,request.image.state=0,request.image.name=request.label;var completed=function(){"function"==typeof request.callback&&request.callback(request.image),self._requestCompleted()};request.image.onload=function(){request.image.state=1,completed()},request.image.onerror=function(){request.image.state=-1,completed()},request.image.onabort=function(){request.image.state=-1,completed()},request.image.src=request.url},this._requestCompleted=function(){if(++this._completedCount==this._requests.length&&"function"==typeof this._completedCallback){for(var images=[],i=0;i<this._requests.length;i++)images.push(this._requests[i].image);this._completedCallback(images)}}},String.prototype.startsWith=function(str){return this.match("^"+str)==str},Grid.ImportExport.removeQuotes=function(str){var first=str.indexOf('"');if(-1==first)return str;var second=(str=str.substring(first+1)).lastIndexOf('"');return-1==second?str:str.substring(0,second)},Grid.ImportExport.hasElementValue=function(xml,id){var el=xml.getElementsByTagName(id);return el&&el[0]&&el[0].childNodes[0]},Grid.ImportExport.getElementString=function(xml,id){var el=xml.getElementsByTagName(id);return el&&el[0]&&el[0].childNodes[0]?this.removeQuotes(el[0].childNodes[0].nodeValue):null},Grid.ImportExport.getElementBool=function(xml,id){var value=Grid.ImportExport.getElementString(xml,id);return value&&"true"===value},Grid.ImportExport.getElementInt=function(xml,id){var value=Grid.ImportExport.getElementString(xml,id);return value?parseInt(value):0},Grid.ImportExport.loadOptions=function(gridXml,model){var options=model.options;this.hasElementValue(gridXml,"UpdateLayout")&&(options.updateLayout=this.getElementBool(gridXml,"UpdateLayout")),this.hasElementValue(gridXml,"ContainerPaddingTop")&&(options.containerPaddingTop=this.getElementInt(gridXml,"ContainerPaddingTop")),this.hasElementValue(gridXml,"ContainerPaddingRight")&&(options.containerPaddingRight=this.getElementInt(gridXml,"ContainerPaddingRight")),this.hasElementValue(gridXml,"ContainerPaddingBottom")&&(options.containerPaddingBottom=this.getElementInt(gridXml,"ContainerPaddingBottom")),this.hasElementValue(gridXml,"ContainerPaddingLeft")&&(options.containerPaddingLeft=this.getElementInt(gridXml,"ContainerPaddingLeft")),this.hasElementValue(gridXml,"PaletteWidth")&&(options.paletteWidth=this.getElementInt(gridXml,"PaletteWidth")),this.hasElementValue(gridXml,"PaletteGutter")&&(options.paletteGutter=this.getElementInt(gridXml,"PaletteGutter"));var centerImageNode=gridXml.getElementsByTagName("CenterImage");centerImageNode&&centerImageNode[0]&&centerImageNode[0].childNodes[0]&&(options.paletteCenter="true"==centerImageNode[0].childNodes[0].nodeValue);var scaleImageNode=gridXml.getElementsByTagName("ScaleImage");scaleImageNode&&scaleImageNode[0]&&scaleImageNode[0].childNodes[0]&&(options.paletteScale="true"==scaleImageNode[0].childNodes[0].nodeValue),this.hasElementValue(gridXml,"ShowToolbar")&&(options.showToolbar=this.getElementBool(gridXml,"ShowToolbar")),this.hasElementValue(gridXml,"ToolbarHeight")&&(options.toolbarHeight=this.getElementInt(gridXml,"ToolbarHeight")),this.hasElementValue(gridXml,"ToolbarGutter")&&(options.toolbarGutter=this.getElementInt(gridXml,"ToolbarGutter"));var buttonNode=gridXml.getElementsByTagName("ShowButtons");if(buttonNode&&buttonNode[0]&&buttonNode[0].childNodes[0]&&buttonNode[0].childNodes[0].nodeValue)for(var buttons=this.removeQuotes(buttonNode[0].childNodes[0].nodeValue).split(","),i=0;i<buttons.length;i++)options.addButton(buttons[i]);this.hasElementValue(gridXml,"CanvasWidth")&&(options.canvasWidth=this.getElementInt(gridXml,"CanvasWidth")),this.hasElementValue(gridXml,"CanvasWidthExt")&&(options.canvasWidthExt=this.getElementInt(gridXml,"CanvasWidthExt")),this.hasElementValue(gridXml,"CanvasHeight")&&(options.canvasHeight=this.getElementInt(gridXml,"CanvasHeight")),this.hasElementValue(gridXml,"CanvasHeightExt")&&(options.canvasHeightExt=this.getElementInt(gridXml,"CanvasHeightExt")),this.hasElementValue(gridXml,"CanvasBorderOffset")&&(options.canvasBorderOffset=this.getElementInt(gridXml,"CanvasBorderOffset")),this.hasElementValue(gridXml,"ProperLineGeometry")&&(options.properLineGeometry=this.getElementBool(gridXml,"ProperLineGeometry"));var selectionToleranceNode=gridXml.getElementsByTagName("SelectionTolerance");selectionToleranceNode&&selectionToleranceNode[0]&&selectionToleranceNode[0].childNodes[0]&&(options.selectionTolerance=parseInt(this.removeQuotes(selectionToleranceNode[0].childNodes[0].nodeValue)));var gridSpacingNode=gridXml.getElementsByTagName("GridSpacing");if(gridSpacingNode&&gridSpacingNode[0]&&gridSpacingNode[0].childNodes[0]){var spacingStr=gridSpacingNode[0].childNodes[0].nodeValue,strSplit=(spacingStr=this.removeQuotes(spacingStr.replace(/^\s+|\s+$/g,""))).split(",");options.gridSpacing=parseInt(strSplit[0].replace(/^\s+|\s+$/g,"")),"Y"==strSplit[1].replace(/^\s+|\s+$/g,"")?options.snapToGrid=!0:options.snapToGrid=!1}var gridColorNode=gridXml.getElementsByTagName("GridColor");gridColorNode&&gridColorNode[0]&&gridColorNode[0].childNodes[0]&&(options.gridColor=this.removeQuotes(gridColorNode[0].childNodes[0].nodeValue),options.showGridLines="None"!=options.gridColor),this.hasElementValue(gridXml,"ShowFeedback")&&(options.showFeedback=this.getElementBool(gridXml,"ShowFeedback")),this.hasElementValue(gridXml,"FeedbackHeight")&&(options.feedbackHeight=this.getElementInt(gridXml,"FeedbackHeight")),this.hasElementValue(gridXml,"FeedbackGutter")&&(options.feedbackGutter=this.getElementInt(gridXml,"FeedbackGutter"))},Grid.ImportExport.parseRegion=function(regionNode){var region={name:regionNode.getAttribute("name"),shape:regionNode.getAttribute("shape"),coords:regionNode.getAttribute("coords"),events:[]},eventNodes=regionNode.getElementsByTagName("Event");return Grid.ImportExport.eachNode(eventNodes,function(eventNode){var regionEvent={name:eventNode.getAttribute("name"),styles:{},image:null,label:null},stylesNode=eventNode.getElementsByTagName("Styles");1==stylesNode.length&&Grid.ImportExport.eachNode(stylesNode[0].attributes,function(styleAttrib){regionEvent.styles[styleAttrib.name]=styleAttrib.value});var imageNode=eventNode.getElementsByTagName("Image");1==imageNode.length&&(imageNode=imageNode[0],regionEvent.image={src:imageNode.getAttribute("src"),x:1*imageNode.getAttribute("x"),y:1*imageNode.getAttribute("y")});var labelNode=eventNode.getElementsByTagName("Label");1==labelNode.length&&(labelNode=labelNode[0],regionEvent.label={text:labelNode.getAttribute("text"),x:1*labelNode.getAttribute("x"),y:1*labelNode.getAttribute("y")}),region.events.push(regionEvent)}),region},Grid.ImportExport.parseRegionGroup=function(regionGroupNode){var regionGroup={name:regionGroupNode.getAttribute("name"),min:1*regionGroupNode.getAttribute("min"),max:1*regionGroupNode.getAttribute("max"),includes:[]},regionNodes=regionGroupNode.getElementsByTagName("Region");Grid.ImportExport.eachNode(regionNodes,function(regionNode){var regionName=regionNode.getAttribute("name");regionGroup.includes.push(regionName)});var includeNodes=regionGroupNode.getElementsByTagName("Include");return Grid.ImportExport.eachNode(includeNodes,function(includeNode){var regionName=includeNode.getAttribute("region");regionGroup.includes.push(regionName)}),regionGroup},Grid.ImportExport.loadHotspots=function(xmlobject,model,imageLoader){var hotspots={regions:[],groups:[]},regionNodes=xmlobject.getElementsByTagName("Region");Grid.ImportExport.eachNode(regionNodes,function(regionNode){var regionJson=Grid.ImportExport.parseRegion(regionNode);hotspots.regions.push(regionJson)});var regionGroupNodes=xmlobject.getElementsByTagName("RegionGroup");Grid.ImportExport.eachNode(regionGroupNodes,function(regionGroupNode){var groupJson=Grid.ImportExport.parseRegionGroup(regionGroupNode);hotspots.groups.push(groupJson)}),Grid.ImportExport.eachNode(hotspots.regions,function(regionJson){var region=model.createRegion(regionJson.name,regionJson.shape,regionJson.coords);null!=region&&(Grid.ImportExport.eachNode(regionJson.events,function(eventJson){var event=region.createEvent(eventJson.name);if(event.setStyles(eventJson.styles),null!=eventJson.label&&event.setLabel(eventJson.label.x,eventJson.label.y,eventJson.label.text),null!=eventJson.image){var url=Grid.ImportExport.resolveUrl(eventJson.image.src),htmlImage=imageLoader.getImage(url);null!=htmlImage&&event.setImage(url,eventJson.image.x,eventJson.image.y,htmlImage.width,htmlImage.height)}}),region.update())}),Grid.ImportExport.eachNode(hotspots.groups,function(groupJson){for(var regionGroup=model.createRegionGroup(groupJson.name,groupJson.min,groupJson.max),i=0;i<groupJson.includes.length;i++){var region=model.getRegion(groupJson.includes[i]);null!=region&&regionGroup.addRegion(region)}})},Grid.ImportExport.parseRegionGroupObjects=function(xmlobject){var regionObjects=[],regionObjNodes=xmlobject.getElementsByTagName("RegionObject");return Grid.ImportExport.eachNode(regionObjNodes,function(regionObjNode){var regionObject={name:regionObjNode.getAttribute("name"),selected:"true"==regionObjNode.getAttribute("isselected")};regionObjects.push(regionObject)}),regionObjects},Grid.ImportExport.loadRegionGroupObjects=function(xmlobject,model){for(var regionObjects=Grid.ImportExport.parseRegionGroupObjects(xmlobject),i=0;i<regionObjects.length;i++){var regionObject=regionObjects[i],region=model.getRegion(regionObject.name);null!=region&&(regionObject.selected?region.select():region.deselect())}},Grid.ImportExport.getRegionGroupsXmlString=function(model){var xmlDoc=Grid.ImportExport.getRegionGroupsXmlDoc(model);return Grid.ImportExport.serializeToString(xmlDoc)},Grid.ImportExport.getRegionGroupsXmlDoc=function(model){var xmlDoc=Grid.ImportExport.parseFromString("<HotSpots></HotSpots>"),appendEvent=function(event,parentNode){var eventNode=xmlDoc.createElement("Event");eventNode.setAttribute("name",event.name);var styles=event.getStyles(),stylesNode=xmlDoc.createElement("Styles");for(var styleName in styles){var styleValue=styles[styleName];stylesNode.setAttribute(styleName,styleValue)}eventNode.appendChild(stylesNode);var image=event.getImage();if(null!=image){var imageNode=xmlDoc.createElement("Image");imageNode.setAttribute("src",image.url),imageNode.setAttribute("x",image.x),imageNode.setAttribute("y",image.y),eventNode.appendChild(imageNode)}var label=event.getLabel();if(null!=label){var labelNode=xmlDoc.createElement("Label");labelNode.setAttribute("text",label.text),labelNode.setAttribute("x",label.x),labelNode.setAttribute("y",label.y),eventNode.appendChild(labelNode)}parentNode.appendChild(eventNode)},regions=model.getRegions(),regionsNode=xmlDoc.createElement("Regions");xmlDoc.documentElement.appendChild(regionsNode);for(i=0;i<regions.length;i++)!function(region,parentNode){var regionNode=xmlDoc.createElement("Region"),shapeName=region.getType(),shapeCoords=region.getCoords();regionNode.setAttribute("name",region.name),regionNode.setAttribute("shape",shapeName),regionNode.setAttribute("coords",shapeCoords);for(var events=region.getEvents(),i=0;i<events.length;i++)appendEvent(events[i],regionNode);parentNode.appendChild(regionNode)}(regions[i],regionsNode);var regionGroups=model.getRegionGroups(),regionGroupsNode=xmlDoc.createElement("RegionGroups");xmlDoc.documentElement.appendChild(regionGroupsNode);for(var i=0;i<regionGroups.length;i++)!function(regionGroup,parentNode){var regionGroupNode=xmlDoc.createElement("RegionGroup");regionGroupNode.setAttribute("name",regionGroup.name),regionGroupNode.setAttribute("min",regionGroup.min),regionGroupNode.setAttribute("max",regionGroup.max);for(var regions=regionGroup.getRegions(),i=0;i<regions.length;i++){var region=regions[i],includeNode=xmlDoc.createElement("Include");includeNode.setAttribute("region",region.name),regionGroupNode.appendChild(includeNode)}parentNode.appendChild(regionGroupNode)}(regionGroups[i],regionGroupsNode);return xmlDoc},Grid.ImportExport.translateCoordinate=function(model,y){return model.options.canvasHeight-y},Grid.ImportExport.writeShapes=function(rootNode,model){var xmlDoc=rootNode.ownerDocument,circles=model.getCircles();if(circles&&circles.length>0){var circlesNode=this.createCirclesElement(xmlDoc,circles);rootNode.appendChild(circlesNode)}var lines=model.getLines();if(lines&&lines.length>0){var linesNode=this.createLinesElement(xmlDoc,lines);rootNode.appendChild(linesNode)}},Grid.ImportExport.createCirclesElement=function(xmlDoc,circles){for(var circlesNode=xmlDoc.createElement("Circles"),i=0;i<circles.length;i++){var circle=circles[i],circleNode=xmlDoc.createElement("Circle");circleNode.setAttribute("x",circle.x),circleNode.setAttribute("y",circle.y),circleNode.setAttribute("r",circle.radius),circlesNode.appendChild(circleNode)}return circlesNode},Grid.ImportExport.createLinesElement=function(xmlDoc,lines){for(var linesNode=xmlDoc.createElement("Lines"),i=0;i<lines.length;i++){var line=lines[i],lineNode=xmlDoc.createElement("Line");lineNode.setAttribute("sourceX",line.source.x),lineNode.setAttribute("sourceY",line.source.y),lineNode.setAttribute("targetX",line.target.x),lineNode.setAttribute("targetY",line.target.y),lineNode.setAttribute("dir",line.dirType),lineNode.setAttribute("style",line.style),linesNode.appendChild(lineNode)}return linesNode},Grid.ImportExport.loadShapes=function(xmlDoc,model){var circlesNode=xmlDoc.getElementsByTagName("Circles")[0];circlesNode&&this.loadCircles(circlesNode,model);var linesNode=xmlDoc.getElementsByTagName("Lines")[0];linesNode&&this.loadLines(linesNode,model)},Grid.ImportExport.loadCircles=function(circlesNode,model){for(var circleList=circlesNode.getElementsByTagName("Circle"),i=0;i<circleList.length;i++){var circleNode=circleList[i],x=parseInt(circleNode.getAttribute("x")),y=parseInt(circleNode.getAttribute("y")),r=parseInt(circleNode.getAttribute("r")),circle=model.createCircle(x,y,r);model.addCircle(circle)}},Grid.ImportExport.loadLines=function(linesNode,model){for(var lineList=linesNode.getElementsByTagName("Line"),lines=model.getLines(),i=0;i<lineList.length;i++){var lineNode=lineList[i],sourceX=parseInt(lineNode.getAttribute("sourceX")),sourceY=parseInt(lineNode.getAttribute("sourceY")),targetX=parseInt(lineNode.getAttribute("targetX")),targetY=parseInt(lineNode.getAttribute("targetY")),dir=lineNode.getAttribute("dir"),style=lineNode.getAttribute("style");if("dashed"==style)for(var j=0;j<lines.length;j++){var line=lines[j];sourceX==line.source.x&&sourceY==line.source.y&&targetX==line.target.x&&targetY==line.target.y&&dir==line.dirType&&(line.style=style,line.update())}}},Grid.QtiImportExport=function(model){var answerSpaceXml,gridquestion=model,defaultEvents=[{name:"select",styles:{fill:"white","fill-opacity":"0",stroke:"red","stroke-dasharray":"","stroke-opacity":"","stroke-width":"6"},image:null,label:null},{name:"hover",styles:{fill:"white","fill-opacity":"0",stroke:"blue","stroke-dasharray":"","stroke-opacity":"","stroke-width":"4"},image:null,label:null}];this._importexport=new Grid.ImportExport(model),this.loadItem=function(qtiXmlStr,callbackCreated,callbackFailure){var imageFiles=parseImageFiles(qtiXmlStr),imageLoader=new Grid.ImportExport.ImageLoader;if(0!=imageFiles.length){for(var i=0;i<imageFiles.length;i++){var url=Grid.ImportExport.resolveUrl(imageFiles[i].url);imageLoader.addImage(url)}var self=this;imageLoader.load(function(){var imageErrors=imageLoader.getErrors();0==imageErrors.length?loadItem2.call(self,qtiXmlStr,callbackCreated,imageLoader,imageFiles):callbackFailure("Error loading DOM images",imageErrors)})}else loadItem2(qtiXmlStr,callbackCreated,imageLoader,imageFiles)},this.loadAnswer=function(response,gridq){this._importexport.loadAnswer.call(this,response,gridq)},this.getAnswerXml=function(){this._importexport.getAnswerXml.call(this)},this.isStudentResponseValid=function(){this._importexport.isStudentResponseValid.call(this)};var parseImageFiles=function(qtiXmlStr){var imageFiles=[],nodes=Grid.ImportExport.parseFromString(qtiXmlStr).getElementsByTagName("object");return Grid.ImportExport.eachNode(nodes,function(node){if(-1!=node.getAttribute("type").indexOf("image")){var imageFile={url:node.getAttribute("data"),height:node.getAttribute("height"),width:node.getAttribute("width")};-1==imageFiles.indexOf(imageFile)&&imageFiles.push(imageFile)}}),imageFiles},addBackgroundImage=function(imageFiles,imageLoader){for(var i=0;i<imageFiles.length;i++){var img=imageFiles[i],url=Grid.ImportExport.resolveUrl(img.url),htmlImage=imageLoader.getImage(url);null!=htmlImage&&null!=img.height&&null!=img.width&&gridquestion.addBackgroundImage(htmlImage.src,0,0,htmlImage.width,htmlImage.height)}},parseHotspotChoice=function(regionNode){return{name:regionNode.getAttribute("identifier"),shape:regionNode.getAttribute("shape"),coords:regionNode.getAttribute("coords"),events:defaultEvents}},loadHotspots=function(xmlDoc,localModel,imageLoader){var hotspots=[],qtiObject=xmlDoc.getElementsByTagName("hotspotInteraction")[0],minChoices=qtiObject.getAttribute("minChoices"),maxChoices=qtiObject.getAttribute("maxChoices"),regionGroup=localModel.createRegionGroup("All",minChoices,maxChoices),regionNodes=xmlDoc.getElementsByTagName("hotspotChoice");Grid.ImportExport.eachNode(regionNodes,function(regionNode){var regionJson=parseHotspotChoice(regionNode);hotspots.push(regionJson)}),Grid.ImportExport.eachNode(hotspots,function(regionJson){var region=localModel.createRegion(regionJson.name,regionJson.shape,regionJson.coords);null!=region&&(regionGroup.addRegion(region),null==regionJson.events&&(regionJson.events=defaultEvents),Grid.ImportExport.eachNode(regionJson.events,function(eventJson){var event=region.createEvent(eventJson.name);if(event.setStyles(eventJson.styles),null!=eventJson.label&&event.setLabel(eventJson.label.x,eventJson.label.y,eventJson.label.text),null!=eventJson.image){var url=Grid.ImportExport.resolveUrl(eventJson.image.src),htmlImage=imageLoader.getImage(url);null!=htmlImage&&event.setImage(url,eventJson.image.x,eventJson.image.y,htmlImage.width,htmlImage.height)}}),region.update())})},loadItem2=function(qtiXmlStr,callback,imageLoader,imageFiles){answerSpaceXml=qtiXmlStr;var xmlDoc=Grid.ImportExport.parseFromString(qtiXmlStr);addBackgroundImage(imageFiles,imageLoader),loadHotspots(xmlDoc,gridquestion,imageLoader),"function"==typeof callback&&callback()}},function(CM){function isQTI(item){return item.isResponseType("hotspot")}function create(page,item,containerEl,gridAnswerSpace){page.getDoc();if(null==containerEl)return null;var gridSvg=CM.resolveBaseUrl("Scripts/Grid2/grid.svg"),grid=new Grid(containerEl,gridSvg);isQTI(item)&&(CM.QTI.loadStem(item),grid.importexport=new Grid.QtiImportExport(grid.model)),item.grid=grid,YUD.addClass(containerEl,"loading"),grid.allowTab=!1,grid.isReadOnly=item.isReadOnly;var GridComponent=function(panelName){this.id=panelName,this.getXY=function(){return[0,0]},this.focus=function(){grid.setArea(panelName),Util.Dom.focus(grid.ui._svgWin)},this.blur=function(){grid.setArea(null),Util.Browser.isIE()||Util.Dom.blur(grid.ui._svgWin)},this.toString=function(){return panelName}},gridComponents={};return gridComponents.canvas=new GridComponent("canvas"),gridComponents.palette=new GridComponent("palette"),gridComponents.toolbar=new GridComponent("toolbar"),grid.subscribe("onStateChange",function(gridEvt){if(gridEvt.state==GridState.Ready&&(CM.addKeyEvents(grid.ui._svgRoot),"object"==typeof KeyManager&&KeyManager.attachListener(grid.ui._svgRoot),setTimeout(function(){var gridResponse=null;gridResponse="object"==typeof window.TestShell&&"object"==typeof window.TestShell.PageManager?window.TestShell.PageManager.getResponse(item.position).getLastValue():item.value,Grid.QtiImportExport&&grid.importexport instanceof Grid.QtiImportExport?grid.loadXml(item.qti.xml,gridResponse):grid.loadXml(gridAnswerSpace,gridResponse)},0)),gridEvt.state==GridState.Loaded){YUD.removeClass(containerEl,"loading"),grid.question.options.showPalette&&item.addComponent(gridComponents.palette),grid.question.options.showButtons.length>0&&item.addComponent(gridComponents.toolbar),item.addComponent(gridComponents.canvas);var zoomFactor=page.getZoomFactor();setTimeout(function(){grid.ui.zoom(zoomFactor)},0),page.isShowing()&&grid.ui._fixOffset()}gridEvt.state==GridState.Error&&(YUD.removeClass(containerEl,"loading"),YUD.addClass(containerEl,"failed"),grid.ui&&grid.ui._svgObject&&YUD.setStyle(grid.ui._svgObject,"display","none")),CM.log("GRID "+item.position+": STATE - "+gridEvt.name)}),grid.subscribe("onModeChange",function(gridEvt){CM.log("GRID "+item.position+": MODE - "+gridEvt.name)}),grid.subscribe("onAreaChange",function(gridEvt){null!=gridEvt.name&&(item.setActive(),grid.getState()==GridState.Loaded&&item.setActiveComponent(gridComponents[gridEvt.name])),CM.log("GRID "+item.position+": AREA - "+gridEvt.name)}),"object"==typeof TDS.Diagnostics&&(grid.subscribe("onStateChange",function(gridEvt){gridEvt.state==GridState.Created&&TDS.Diagnostics.addErrorHandler(grid.view._svgWin)}),grid.subscribe("onError",function(evt){evt.exception&&TDS.Diagnostics.report(evt.exception)})),grid.init(),grid}function Widget_Grid(page,item,config){this.grid=null}CM.registerWidget("grid",Widget_Grid,function(page,item,content){var id="GridContainer_"+item.position,el=document.getElementById(id),gridSpec=item.gridAnswerSpace||item.rendererSpec;return!(!el||!gridSpec)&&new CM.WidgetConfig(id,el,gridSpec)});var match_QTI=CM.QTI.createWidgetMatch("customInteraction","grid");CM.registerWidget("qti.grid",Widget_Grid,match_QTI),Widget_Grid.prototype.init=function(){Grid.Utils.loadImageFiles(this.page,this.config)},Widget_Grid.prototype.load=function(){this.grid=create(this.page,this.entity,this.element,this.config)},Widget_Grid.prototype.show=function(){this.grid.ui._svgObject&&this.grid.ui._fixOffset()},Widget_Grid.prototype.zoom=function(level){this.grid.ui.zoom(level)},Widget_Grid.prototype.isResponseAvailable=function(){return this.grid&&this.grid.isLoaded()},Widget_Grid.prototype.getResponse=function(){var value=this.grid.getResponseXml(),isValid=this.grid.isValid();return this.createResponse(value,isValid)},Widget_Grid.prototype.setResponse=function(value){this.grid.importexport.loadAnswer(value)}}(window.ContentManager),void 0===Grid.Utils&&(Grid.Utils={}),Grid.Utils.parseImageFiles=function(xmlStr){var xmlDoc,eachNode=function(nodeList,func){for(var nodes=[],i=0;i<nodeList.length;i++)nodes.push(nodeList[i]||nodeList.item(i));YAHOO.util.Dom.batch(nodes,func)},getTextContent=function(node){return node&&node.childNodes&&node.childNodes.length?node.childNodes[0].nodeValue:null},imageFiles=[],imageNodes=(xmlDoc="string"==typeof xmlStr?Util.Xml.parseFromString(xmlStr):xmlStr).getElementsByTagName("FileSpec");return eachNode(imageNodes,function(imageNode){var imageFile=getTextContent(imageNode);-1==imageFiles.indexOf(imageFile)&&imageFiles.push(imageFile)}),imageNodes=xmlDoc.getElementsByTagName("Image"),eachNode(imageNodes,function(imageNode){var imageFile=imageNode.getAttribute("src");-1==imageFiles.indexOf(imageFile)&&imageFiles.push(imageFile)}),imageFiles},Grid.Utils.loadImageFiles=function(page,questionXml){for(var imageFiles=Grid.Utils.parseImageFiles(questionXml),i=0;i<imageFiles.length;i++){var imageFile=imageFiles[i],imageUrl=Grid.ImportExport.resolveUrl(imageFile),img=new Image;page.getRenderer().addImage(img),img.src=imageUrl}},void 0===TDS)var TDS={};if(TDS.Interaction=function(responseIdentifier,config){this._responseIdentifier=responseIdentifier,this._config=config||{}},YAHOO.lang.augmentProto(TDS.Interaction,YAHOO.util.EventProvider),TDS.Interaction.prototype.getResponseIdentifier=function(){return this._responseIdentifier},TDS.Interaction.prototype.init=function(){},TDS.Interaction.prototype.validateResponse=function(){return!1},TDS.Interaction.prototype.getResponse=function(){return null},TDS.Interaction.prototype.resetResponse=function(){},TDS.Interaction.prototype.loadResponse=function(){},TDS.Interaction.parseIdentifier=function(el){return YUD.getAttribute(el,"data-its-identifier")},TDS.Interaction.compareOrder=function(obj1,obj2){return Util.Dom.compareNodeOrder(obj1.getElement(),obj2.getElement())},TDS.Interaction.parseXmlRoot=function(xml){var xmlDoc;return(xmlDoc="string"==typeof xml?Util.Xml.parseFromString(xml):xml).documentElement?xmlDoc.documentElement:xml},TDS.ChoiceInteraction=function(responseIdentifier){TDS.ChoiceInteraction.superclass.constructor.call(this,responseIdentifier),this._choices=[]},YAHOO.lang.extend(TDS.ChoiceInteraction,TDS.Interaction),TDS.ChoiceInteraction.prototype.getChoices=function(){return this._choices},TDS.ChoiceInteraction.prototype.getChoice=function(identifier){for(var i=0;i<this._choices.length;i++){var choice=this._choices[i];if(identifier==choice.getIdentifier())return choice}return null},TDS.ChoiceInteraction.prototype.removeChoice=function(choice){Util.Array.remove(this._choices,choice)},TDS.ChoiceInteraction.prototype.addChoice=function(choice){this._choices.push(choice)},TDS.Choice=function(identifier,element,config){this._identifier=identifier||"",this._element=element||null,this._config=config||{},this.init()},YAHOO.lang.augmentProto(TDS.Choice,YAHOO.util.EventProvider),TDS.Choice.prototype.getIdentifier=function(){return this._identifier},TDS.Choice.prototype.getElement=function(){return this._element},TDS.Choice.prototype.getDoc=function(){var element=this.getElement();return Util.Dom.getOwnerDocument(element)},TDS.Choice.prototype.getWin=function(){var elementDoc=this.getDoc();return Util.Dom.getWindow(elementDoc)},TDS.Choice.prototype.getRegions=function(){var choiceEl=this.getElement();return Util.Dom.getElementRegions(choiceEl)},TDS.Choice.prototype.init=function(){},TDS.Choice.prototype.toString=function(){return this.getIdentifier()},TDS.SelectInteraction=function(responseIdentifier){TDS.SelectInteraction.superclass.constructor.call(this,responseIdentifier),this._selectElements=[],this._cardinalityLookup=new Util.Structs.Map},YAHOO.lang.extend(TDS.SelectInteraction,TDS.ChoiceInteraction),TDS.SelectInteraction.prototype.setCardinality=function(id,min,max){this._cardinalityLookup.set(id,{id:id,min:min,max:max})},TDS.SelectInteraction.prototype.getCardinality=function(id){return this._cardinalityLookup.get(id)||{id:id,min:0,max:0}},TDS.SelectInteraction.prototype.addChoice=function(choice){TDS.SelectInteraction.superclass.addChoice.call(this,choice),choice.subscribe("beforeSelectEvent",this._validateSelection,choice,this)},TDS.SelectInteraction.prototype.removeChoice=function(choice){TDS.SelectInteraction.superclass.removeChoice.call(this,choice),choice.unsubscribe("beforeSelectEvent",this._validateSelection,choice,this)},TDS.SelectInteraction.prototype.getSelectedChoices=function(){return this.getChoices().filter(function(choice){return choice.isSelected()})},TDS.SelectInteraction.prototype.getChoicesInGroup=function(id){return this.getChoices().filter(function(choice){return id==choice.getGroupIdentifier()})},TDS.SelectInteraction.prototype.getSelectedInGroup=function(id){return this.getSelectedChoices().filter(function(choice){return id==choice.getGroupIdentifier()})},TDS.SelectInteraction.prototype.getGroups=function(){return Util.Array.unique(this.getChoices().map(function(choice){return choice.getGroupIdentifier()}))},TDS.SelectInteraction.prototype._validateSelection=function(id,choice){var groupId=choice.getGroupIdentifier(),cardinality=this.getCardinality(groupId),choices=this.getSelectedInGroup(groupId);return 1==cardinality.max&&choices.length>0?(choices[0].deselect(),!0):!(cardinality.max>0&&cardinality.max<=choices.length)},TDS.SelectInteraction.prototype.validateResponse=function(){for(var totalMin=0,totalSelected=0,groupIds=this.getGroups(),i=0;i<groupIds.length;i++){var groupId=groupIds[i],cardinality=this.getCardinality(groupId),choices=this.getSelectedInGroup(groupId);if(choices.length<cardinality.min)return!1;totalMin+=cardinality.min,totalSelected+=choices.length}return 0!=totalMin||0!=totalSelected},TDS.SelectInteraction.prototype.getResponseArray=function(){for(var selectedIdentifiers=[],selectedChoices=this.getSelectedChoices(),i=0;i<selectedChoices.length;i++){var choice=selectedChoices[i];selectedIdentifiers.push(choice.getIdentifier())}return selectedIdentifiers},TDS.SelectInteraction.prototype.getResponseJson=function(){var groupList=[],groupLookup={},selectedChoices=this.getSelectedChoices();return Util.Array.each(selectedChoices,function(choice){var selectIdent=choice.getIdentifier(),selectEl=choice.getElement(),selectGroupIdent=YUD.getAttribute(selectEl,"data-its-group")||"",selectGroup=groupLookup[selectGroupIdent];null==selectGroup&&(selectGroup={responses:[],identifier:selectGroupIdent},groupLookup[selectGroupIdent]=selectGroup,groupList.push(selectGroup)),selectGroup.responses.push(selectIdent)}),groupList},TDS.SelectInteraction.prototype.getResponseXml=function(){var responseXml=Util.Xml.createDocument("interaction"),interactionEl=responseXml.documentElement;interactionEl.setAttribute("identifier",this.getResponseIdentifier()),interactionEl.setAttribute("type","selectable");var groupsList=this.getResponseJson();return Util.Array.each(groupsList,function(groupJson){var groupNode=responseXml.createElement("group");groupNode.setAttribute("identifier",groupJson.identifier),interactionEl.appendChild(groupNode),Util.Array.each(groupJson.responses,function(response){var responseNode=responseXml.createElement("response");responseNode.setAttribute("identifier",response),groupNode.appendChild(responseNode)})}),responseXml},TDS.SelectInteraction.prototype.getResponse=function(){var responseXml=this.getResponseXml();return Util.Xml.serializeToString(responseXml)},TDS.SelectInteraction.prototype.resetResponse=function(){for(var choices=this.getChoices(),i=0;i<choices.length;i++)choices[i].deselect()},TDS.SelectInteraction.prototype.setResponse=function(identifier){var choice=this.getChoice(identifier);return!!choice&&choice.select()},TDS.SelectInteraction.prototype.loadResponseIDs=function(responseIdentifiers){this.resetResponse(),responseIdentifiers.forEach(function(id){this.setResponse(id)}.bind(this))},TDS.SelectInteraction.prototype.loadResponseXml=function(xml){var interactionNode=TDS.Interaction.parseXmlRoot(xml),responseIdentifiers=[];Util.Dom.queryTagsBatch("response",interactionNode,function(responseNode){var responseIdentifier=responseNode.getAttribute("identifier");responseIdentifiers.push(responseIdentifier)}),this.loadResponseIDs(responseIdentifiers)},TDS.SelectInteraction.prototype.getSelectElements=function(){return this._selectElements},TDS.SelectInteraction.prototype.load=function(parent){parent=YUD.get(parent);var interactionElements=YUD.getElementsByClassName("interaction",null,parent),selectElements=[];YUD.batch(interactionElements,function(interactionEl){YUD.hasClass(interactionEl,"selectable")&&selectElements.push(interactionEl)}),this._selectElements=selectElements;for(var i=0;i<selectElements.length;i++){var selectElement=selectElements[i],responseIdentifier=TDS.Interaction.parseIdentifier(selectElement),choice=new TDS.SelectChoice(responseIdentifier,selectElement);this.addChoice(choice)}},TDS.SelectChoice=function(identifier,element,config){this._selected=!1,TDS.SelectChoice.superclass.constructor.call(this,identifier,element,config),this.createEvent("beforeSelectEvent"),this.createEvent("selectEvent"),this.createEvent("deselectEvent")},YAHOO.extend(TDS.SelectChoice,TDS.Choice),TDS.SelectChoice.prototype.isSelected=function(){return this._selected},TDS.SelectChoice.prototype.getGroupIdentifier=function(){return this._element.getAttribute("data-its-group")},TDS.SelectChoice.prototype.select=function(){return!this._selected&&(!1!==this.fireEvent("beforeSelectEvent",this._identifier)&&(this._selected=!0,this.onSelect(),this.fireEvent("selectEvent",this._identifier),!0))},TDS.SelectChoice.prototype.deselect=function(){return!!this._selected&&(this._selected=!1,this.onDeselect(),this.fireEvent("deselectEvent",this._identifier),!0)},TDS.SelectChoice.prototype.onSelect=function(){YUD.addClass(this._element,"selected"),this._element.setAttribute("aria-checked","true")},TDS.SelectChoice.prototype.onDeselect=function(){YUD.removeClass(this._element,"selected"),this._element.setAttribute("aria-checked","false")},TDS.SelectChoice.prototype.onClick=function(ev){this.isSelected()?this.deselect():this.select()},TDS.SelectChoice.prototype.init=function(){var el=this._element;el.setAttribute("tabindex","0"),el.setAttribute("role","checkbox"),el.setAttribute("aria-checked","false"),YAHOO.util.Event.on(el,"click",this.onClick,this,!0),new YAHOO.util.KeyListener(el,{keys:[13]},{fn:this.onClick,scope:this,correctScope:!0}).enable()},TDS.DDInteraction=function(responseIdentifier){this._groupLookup=new Util.Structs.Map,this._dragLookup=new Util.Structs.Map,this._dragSource=null,this._dropTarget=null,this._defaultResponse=null,TDS.DDInteraction.superclass.constructor.call(this,responseIdentifier)},YAHOO.lang.extend(TDS.DDInteraction,TDS.Interaction),TDS.DDInteraction.CSS={INTERACTION:"interaction",DRAGGABLE:"draggable",DRAG_GROUP:"drag-group",DROP_TARGET:"drop-target",DROP_TARGET_COLLAPSED:"drop-target-collapsed",DRAG_SOURCE:"drag-source",DRAG_OVER:"drag-over",DRAG_PROXY:"drag-proxy",DRAG_PROXY_OVER:"drag-proxy-over",DROP_MARKER:"drop-marker",DRAG_LOCKED:"drag-locked"},TDS.DDInteraction.prototype.getGroups=function(){return this._groupLookup.getValues()},TDS.DDInteraction.prototype.getGroup=function(responseIdentifier){return this._groupLookup.get(responseIdentifier)},TDS.DDInteraction.prototype.addGroup=function(group){var responseIdentifier=group.getIdentifier();this._groupLookup.set(responseIdentifier,group)},TDS.DDInteraction.prototype.getDraggables=function(){return this._dragLookup.getValues()},TDS.DDInteraction.prototype.getDraggable=function(responseIdentifier){return this._dragLookup.get(responseIdentifier)},TDS.DDInteraction.prototype.addDraggable=function(draggable){var responseIdentifier=draggable.getIdentifier();this._dragLookup.set(responseIdentifier,draggable)},TDS.DDInteraction.prototype.getSource=function(){return this._dragSource},TDS.DDInteraction.prototype.hasSource=function(){return null!=this._dragSource},TDS.DDInteraction.prototype.setSource=function(draggable){if(this._dragSource!=draggable&&(this.clearSource(),draggable instanceof TDS.Choice)){var dragEl=draggable.getElement();YUD.addClass(dragEl,TDS.DDInteraction.CSS.DRAG_SOURCE),this._dragSource=draggable}},TDS.DDInteraction.prototype.clearSource=function(){if(null!=this._dragSource){var dropEl=this._dragSource.getElement();YUD.removeClass(dropEl,TDS.DDInteraction.CSS.DRAG_SOURCE),this._dragSource=null}},TDS.DDInteraction.prototype.getTarget=function(){return this._dropTarget},TDS.DDInteraction.prototype.hasTarget=function(){return null!=this._dropTarget},TDS.DDInteraction.prototype.setTarget=function(droppable){if(this.clearTarget(),droppable instanceof TDS.Choice){var dropEl=droppable.getElement();YUD.addClass(dropEl,TDS.DDInteraction.CSS.DRAG_OVER);var dragSource=this.getSource();if(dragSource){var proxyEl=dragSource.getProxy().getDragEl();YUD.addClass(proxyEl,TDS.DDInteraction.CSS.DRAG_PROXY_OVER)}this.addMarker(droppable),this._dropTarget=droppable}},TDS.DDInteraction.prototype.clearTarget=function(){if(null!=this._dropTarget){var dropEl=this._dropTarget.getElement();YUD.removeClass(dropEl,TDS.DDInteraction.CSS.DRAG_OVER);var dragSource=this.getSource();if(dragSource){var proxyEl=dragSource.getProxy().getDragEl();YUD.removeClass(proxyEl,TDS.DDInteraction.CSS.DRAG_PROXY_OVER)}this.removeMarker(this._dropTarget),this._dropTarget=null}},TDS.DDInteraction.prototype.addMarker=function(draggable){if(null!=draggable&&draggable instanceof TDS.DragDrop){var dropEl=draggable.getElement(),dropDoc=Util.Dom.getOwnerDocument(dropEl),markerId=YUD.getAttribute(dropEl,"id"),markerEl=dropDoc.createElement("span");YUD.setAttribute(markerEl,"id",markerId+"-marker"),YUD.addClass(markerEl,TDS.DDInteraction.CSS.DROP_MARKER),YUD.insertBefore(markerEl,dropEl)}},TDS.DDInteraction.prototype.removeMarker=function(draggable){if(null!=draggable&&draggable instanceof TDS.DragDrop){var dropEl=draggable.getElement(),dropDoc=Util.Dom.getOwnerDocument(dropEl),markerId=YUD.getAttribute(dropEl,"id"),markerEl=dropDoc.getElementById(markerId+"-marker");null!=markerEl&&Util.Dom.removeNode(markerEl)}},TDS.DDInteraction.prototype.onStartDrag=function(dragSource){this.setSource(dragSource);for(var draggables=this.getDraggables(),i=0;i<draggables.length;i++){var droppable=draggables[i];if(droppable!=dragSource){var dropElement=droppable.getElement();YUD.addClass(dropElement,TDS.DDInteraction.CSS.DROP_TARGET)}}for(var groups=this.getGroups(),i=0;i<groups.length;i++){var group=groups[i];if(group.isDroppable()){var groupEl=group.getElement();YUD.addClass(groupEl,TDS.DDInteraction.CSS.DROP_TARGET),0!=groupEl.offsetHeight&&0!=groupEl.offsetWidth||YUD.addClass(groupEl,TDS.DDInteraction.CSS.DROP_TARGET_COLLAPSED)}}},TDS.DDInteraction.prototype.onDrag=function(ev,dragSource){var srcEl=dragSource.getElement(),targetEl=TDS.DDInteraction.getElementInEvent(ev,this.getDraggables());if(null==targetEl&&(targetEl=TDS.DDInteraction.getElementInEvent(ev,this.getGroups())),targetEl!=dragSource.getProxy().getDragEl()&&(!this._dropTarget||this._dropTarget.getElement()!=targetEl)&&(this.clearTarget(),null!=targetEl&&targetEl!=srcEl)){var targetIdent=TDS.Interaction.parseIdentifier(targetEl);if(targetIdent)if(YUD.hasClass(targetEl,TDS.DDInteraction.CSS.DRAGGABLE)){var droppable=this.getDraggable(targetIdent);droppable&&this.setTarget(droppable)}else if(YUD.hasClass(targetEl,TDS.DDInteraction.CSS.DRAG_GROUP)){var group=this.getGroup(targetIdent);group&&group.isDroppable()&&this.setTarget(group)}}},TDS.DDInteraction.prototype.onEndDrag=function(dragSource){var dropTarget=this.getTarget();null!=dropTarget&&this.onDrop(dragSource,dropTarget),this.clearTarget(),this.clearSource();for(var draggables=this.getDraggables(),i=0;i<draggables.length;i++){var droppable=draggables[i];if(droppable!=dragSource){var dropElement=droppable.getElement();YUD.removeClass(dropElement,TDS.DDInteraction.CSS.DROP_TARGET)}}for(var groups=this.getGroups(),i=0;i<groups.length;i++){var groupEl=groups[i].getElement();YUD.removeClass(groupEl,TDS.DDInteraction.CSS.DROP_TARGET),YUD.removeClass(groupEl,TDS.DDInteraction.CSS.DROP_TARGET_COLLAPSED)}},TDS.DDInteraction.prototype.onDrop=function(dragSource,dropTarget){dropTarget instanceof TDS.DragGroup?dragSource.setGroup(dropTarget):dropTarget instanceof TDS.DragDrop&&dragSource.setGroup(dropTarget.getGroup());var srcEl=dragSource.getElement(),dropEl=dropTarget.getElement();Util.Dom.removeNode(srcEl),dropTarget instanceof TDS.DragGroup?dropEl.appendChild(srcEl):dropTarget instanceof TDS.DragDrop&&YUD.insertBefore(srcEl,dropEl)},TDS.DDInteraction.prototype.validateResponse=function(){return this._defaultResponse!=this.getResponse()},TDS.DDInteraction.prototype.getResponseJson=function(){var groupsList=[],groups=this.getGroups();return Util.Array.sort(groups,TDS.Interaction.compareOrder),Util.Array.each(groups,function(group){var draggables=group.getChildren();Util.Array.sort(draggables,TDS.Interaction.compareOrder);var jsonGroup={responses:[],identifier:group.getIdentifier()};Util.Array.each(draggables,function(draggable){jsonGroup.responses.push(draggable.getIdentifier())}),groupsList.push(jsonGroup)}),groupsList},TDS.DDInteraction.prototype.getResponseXml=function(){var responseXml=Util.Xml.createDocument("interaction"),interactionEl=responseXml.documentElement;interactionEl.setAttribute("identifier",this.getResponseIdentifier()),interactionEl.setAttribute("type","draggable");var groupsList=this.getResponseJson();return Util.Array.each(groupsList,function(groupJson){var groupNode=responseXml.createElement("group");groupNode.setAttribute("identifier",groupJson.identifier),interactionEl.appendChild(groupNode),Util.Array.each(groupJson.responses,function(response){var responseNode=responseXml.createElement("response");responseNode.setAttribute("identifier",response),groupNode.appendChild(responseNode)})}),responseXml},TDS.DDInteraction.prototype.getResponse=function(){var responseXml=this.getResponseXml();return Util.Xml.serializeToString(responseXml)},TDS.DDInteraction.prototype.loadResponseXml=function(xml){var interactionNode=TDS.Interaction.parseXmlRoot(xml),dd=this;Util.Dom.queryTagsBatch("group",interactionNode,function(groupNode){var groupIdentifier=groupNode.getAttribute("identifier"),group=dd.getGroup(groupIdentifier);Util.Dom.queryTagsBatch("response",groupNode,function(responseNode){var responseIdentifier=responseNode.getAttribute("identifier"),draggable=dd.getDraggable(responseIdentifier);dd.onDrop(draggable,group)})})},TDS.DDInteraction.prototype.load=function(parentEl,opts){(opts=opts||{}).createGroups=opts.createGroups||!0,opts.moveDraggables=opts.moveDraggables||!1,parentEl=YUD.get(parentEl);var interactionElements=YUD.getElementsByClassName(TDS.DDInteraction.CSS.INTERACTION,null,parentEl),dragElements=[],groupElements=[];YUD.batch(interactionElements,function(interactionEl){YUD.hasClass(interactionEl,TDS.DDInteraction.CSS.DRAGGABLE)?dragElements.push(interactionEl):YUD.hasClass(interactionEl,TDS.DDInteraction.CSS.DRAG_GROUP)&&groupElements.push(interactionEl)});for(i=0;i<groupElements.length;i++){var groupElement=groupElements[i],groupIdent=TDS.Interaction.parseIdentifier(groupElement),group=new TDS.DragGroup(this,groupIdent,groupElement);this.addGroup(group)}for(var i=0;i<dragElements.length;i++){var dragEl=dragElements[i],responseIdent=TDS.Interaction.parseIdentifier(dragEl),draggable=new TDS.DragDrop(this,responseIdent,dragEl);this.addDraggable(draggable);for(var groups=this.getGroups(),j=0;j<groups.length;j++){var groupEl=(group=groups[j]).getElement();if(dragEl.parentNode==groupEl){draggable.setGroup(group);break}}}opts.createGroups&&this._createGroupContainers(opts),this._defaultResponse=this.getResponse()},TDS.DDInteraction.prototype._createGroupContainers=function(opts){for(var getGroupIdent=function(el){return YUD.getAttribute(el,"data-its-group")},draggables=this.getDraggables(),groupMapping={},i=0;i<draggables.length;i++)if(!(draggable=draggables[i]).getGroup()){dragEl=draggable.getElement();null!=(groupIdent=getGroupIdent(dragEl))&&((groupDraggables=groupMapping[groupIdent])||(groupDraggables=[],groupMapping[groupIdent]=groupDraggables),groupDraggables.push(draggable))}for(var groupIdent in groupMapping){var groupDraggables=groupMapping[groupIdent],dragStartEl=groupDraggables[0].getElement(),groupEl=dragStartEl.parentNode,groupChildren=YUD.getChildren(groupEl),groupUsingParent=Util.Array.every(groupChildren,function(child){return groupIdent==getGroupIdent(child)});groupUsingParent||(groupEl=Util.Dom.getOwnerDocument(dragStartEl).createElement("span"),YUD.insertBefore(groupEl,dragStartEl)),groupEl.setAttribute("data-its-identifier",groupIdent),groupEl.className=TDS.DDInteraction.CSS.INTERACTION+" "+TDS.DDInteraction.CSS.DRAG_GROUP;var group=new TDS.DragGroup(this,groupIdent,groupEl);this.addGroup(group);for(i=0;i<groupDraggables.length;i++){var groupDraggable=groupDraggables[i],dragEl=groupDraggable.getElement();!opts.moveDraggables&&groupUsingParent||(console.log("DDI: Moving draggable into group: ",dragEl,group.getElement()),Util.Dom.removeNode(dragEl),group.getElement().appendChild(dragEl)),groupDraggable.setGroup(group)}}for(i=0;i<draggables.length;i++){var draggable=draggables[i],dragEl=draggable.getElement(),dragText=Util.Dom.getTextContent(dragEl);dragText=YAHOO.lang.trim(dragText),Util.String.startsWith(dragText,"#")&&Util.String.endsWith(dragText,"#")&&(dragText=(dragText=dragText.substr(1)).substring(0,dragText.length-1),Util.Dom.setTextContent(dragEl,dragText),draggable.getGroup().setDroppable(!0),draggable.lock())}},TDS.DDInteraction.getElementInRegion=function(region,choices){for(var i=0,ii=choices.length;i<ii;i++)for(var choice=choices[i],regions=choice.getRegions(),j=0,jj=regions.length;j<jj;j++)if(regions[j].contains(region))return choice.getElement();return null},TDS.DDInteraction.getElementInEvent=function(evt,choices){var point=new YAHOO.util.Point(evt.clientX,evt.clientY);return TDS.DDInteraction.getElementInRegion(point,choices)},TDS.DDInteraction.drawLine=function(x1,y1,x2,y2){if(y1<y2){var pom=y1;y1=y2,y2=pom,pom=x1,x1=x2,x2=pom}var c,a=Math.abs(x1-x2),b=Math.abs(y1-y2),sx=(x1+x2)/2,sy=(y1+y2)/2,width=Math.sqrt(a*a+b*b),x=sx-width/2,y=sy;a=width/2;var cosb=((b=Math.sqrt(Math.abs(x1-x)*Math.abs(x1-x)+Math.abs(y1-y)*Math.abs(y1-y)))*b-a*a-(c=Math.abs(sx-x))*c)/(2*a*c),deg=180*Math.acos(cosb)/Math.PI,div=document.createElementNS("http://www.w3.org/1999/xhtml","div");div.setAttribute("style","border:1px solid red;width:"+width+"px;height:0px;-moz-transform:rotate("+deg+"deg);-webkit-transform:rotate("+deg+"deg);position:absolute;top:"+y+"px;left:"+x+"px;"),document.body.appendChild(div)},TDS.DragDrop=function(parentInteraction,responseIdentifier,element){this._parentInteraction=parentInteraction,this._group=null,this._proxy=null,TDS.DragDrop.superclass.constructor.call(this,responseIdentifier,element)},YAHOO.extend(TDS.DragDrop,TDS.Choice),TDS.DragDrop.prototype.getProxy=function(){return this._proxy},TDS.DragDrop.prototype.getGroup=function(){return this._group},TDS.DragDrop.prototype.setGroup=function(group){this.getElement().setAttribute("data-its-group",group.getIdentifier()),this._group=group},TDS.DragDrop.prototype.init=function(){var element=this.getElement(),proxy=new(this.getWin().YAHOO.util.DDProxy)(element);this._proxy=proxy,proxy.startDrag=Util.bind(this.onStartDrag,this),proxy.onDrag=Util.bind(this.onDrag,this),proxy.endDrag=Util.bind(this.onEndDrag,this)},TDS.DragDrop.prototype.onStartDrag=function(x,y){var srcEl=this._proxy.getEl(),proxyEl=this._proxy.getDragEl();YUD.addClass(proxyEl,TDS.DDInteraction.CSS.DRAG_PROXY),YUD.setStyle(proxyEl,"width",""),YUD.setStyle(proxyEl,"height",""),YUD.setStyle(proxyEl,"border",""),proxyEl.innerHTML=srcEl.innerHTML,this._proxy.setDelta(0,0),this._parentInteraction.onStartDrag(this)},TDS.DragDrop.prototype.onDrag=function(ev){this._parentInteraction.onDrag(ev,this)},TDS.DragDrop.prototype.onDragDrop=function(ev,id){},TDS.DragDrop.prototype.onEndDrag=function(ev){this._proxy.getEl();var proxyEl=this._proxy.getDragEl();YUD.removeClass(proxyEl,TDS.DDInteraction.CSS.DRAG_PROXY),this._parentInteraction.onEndDrag(this)},TDS.DragDrop.prototype.lock=function(){var dragEl=this.getElement();YUD.addClass(dragEl,TDS.DDInteraction.CSS.DRAG_LOCKED),this.getProxy().lock()},TDS.DragDrop.prototype.unlock=function(){var dragEl=this.getElement();YUD.removeClass(dragEl,TDS.DDInteraction.CSS.DRAG_LOCKED),this.getProxy().unlock()},TDS.DragGroup=function(parentInteraction,responseIdentifier,element){this._parentInteraction=parentInteraction,this._droppable=!1,TDS.DragGroup.superclass.constructor.call(this,responseIdentifier,element)},YAHOO.extend(TDS.DragGroup,TDS.Choice),TDS.DragGroup.prototype.getChildren=function(){for(var groupDraggables=[],draggables=this._parentInteraction.getDraggables(),i=0;i<draggables.length;i++){var draggable=draggables[i];draggable.getGroup()==this&&groupDraggables.push(draggable)}return groupDraggables},TDS.DragGroup.prototype.setDroppable=function(droppable){this._droppable=droppable},TDS.DragGroup.prototype.isDroppable=function(){return!!this._droppable||0==this.getChildren().length},TDS.DragGroup.prototype.init=function(){var element=this.getElement();YUE.on(element,"mouseenter",this.onEnter,this,!0),YUE.on(element,"mouseleave",this.onLeave,this,!0)},TDS.DragGroup.prototype.onEnter=function(ev){var dragSource=this._parentInteraction.getSource();dragSource&&dragSource!=this&&this.isDroppable()&&this._parentInteraction.setTarget(this)},TDS.DragGroup.prototype.onLeave=function(ev){var dragSource=this._parentInteraction.getSource();if(dragSource){var dragProxy=dragSource.getProxy();if(dragProxy&&ev.relatedTarget===dragProxy.getDragEl())return;this._parentInteraction.clearTarget()}},function(TDS){function OI(responseIdentifier,orientation){this._orientation=orientation||Orientation.Vertical,this._groups=new Util.Structs.Map,this._defaultResponse=null,OI.superclass.constructor.call(this,responseIdentifier)}var Orientation={Vertical:"vertical",Horizontal:"horizontal"},CSS={INTERACTION:"interaction",ORDER_CHOICE:"order-choice",ORDER_GROUP:"order-group",ORDER_SOURCE:"order-source",ORDER_HOVER:"order-hover",ORDER_PROXY:"order-proxy"};YAHOO.lang.extend(OI,TDS.Interaction),OI.Orientation=Orientation,OI.CSS=CSS,OI.prototype.getOrientation=function(){return this._orientation},OI.prototype.createGroup=function(id,el){var group=new TDS.OrderGroup(this,id,el);return this._groups.set(id,group),group},OI.prototype.removeGroup=function(id){return this._groups.remove(id)},OI.prototype.getGroup=function(id){return this._groups.get(id)},OI.prototype.getGroups=function(sort){var groups=this._groups.getValues();return sort&&Util.Array.sort(groups,TDS.Interaction.compareOrder),groups},OI.prototype.getGroupIdentifiers=function(sort){return this._groups.getValues(sort).map(function(group){return group.getIdentifier()})},OI.prototype.load=function(parentEl){parentEl=YUD.get(parentEl),$(".interaction.order-group",parentEl).each(function(groupIdx,groupEl){var groupId=TDS.Interaction.parseIdentifier(groupEl),group=this.createGroup(groupId,groupEl);$(".interaction.order-choice",groupEl).each(function(choiceIdx,choiceEl){var choiceId=TDS.Interaction.parseIdentifier(choiceEl);group.createChoice(choiceId,choiceEl)}.bind(this))}.bind(this)),this._defaultResponse=this.getResponse()},OI.prototype.prepareForShow=function(){this.getGroups().forEach(function(group){group.getChoices().forEach(function(choice){choice.getProxy().resetConstraints()})})},OI.prototype.validateResponse=function(){return this._defaultResponse!=this.getResponse()},OI.prototype.getResponseJson=function(){var groupsList=[];return this.getGroups(!0).forEach(function(group){var jsonGroup={identifier:group.getIdentifier(),responses:[]};group.getChoices(!0).forEach(function(choice){jsonGroup.responses.push(choice.getIdentifier())}),groupsList.push(jsonGroup)},this),groupsList},OI.prototype.getResponseXml=function(){var responseXml=Util.Xml.createDocument("interaction"),interactionEl=responseXml.documentElement;interactionEl.setAttribute("identifier",this.getResponseIdentifier()),interactionEl.setAttribute("type","order");var groupsList=this.getResponseJson();return Util.Array.each(groupsList,function(groupJson){var groupNode=responseXml.createElement("group");groupNode.setAttribute("identifier",groupJson.identifier),interactionEl.appendChild(groupNode),Util.Array.each(groupJson.responses,function(response){var responseNode=responseXml.createElement("response");responseNode.setAttribute("identifier",response),groupNode.appendChild(responseNode)})}),responseXml},OI.prototype.getResponse=function(){var responseXml=this.getResponseXml();return Util.Xml.serializeToString(responseXml)},OI.prototype.loadResponseXml=function(xml){var interactionNode=TDS.Interaction.parseXmlRoot(xml),interaction=this;Util.Dom.queryTagsBatch("group",interactionNode,function(groupNode){var groupIdentifier=groupNode.getAttribute("identifier"),group=interaction.getGroup(groupIdentifier);if(group){var identifiers=[];Util.Dom.queryTagsBatch("response",groupNode,function(responseNode){var responseIdentifier=responseNode.getAttribute("identifier");identifiers.push(responseIdentifier)}),group.sort(identifiers)}})},OI.prototype.loadResponse=function(xmlStr){var xmlDoc=Util.Xml.parseFromString(xmlStr);this.loadResponseXml(xmlDoc)},TDS.OrderInteraction=OI}(TDS),function(TDS){function OG(parentInteraction,responseIdentifier,element){this._parentInteraction=parentInteraction,this._lookup={},this._list=[],OG.superclass.constructor.call(this,responseIdentifier,element)}YAHOO.extend(OG,TDS.Choice),OG.prototype.getParentInteraction=function(){return this._parentInteraction},OG.prototype.toggleLockDrag=function(identifier,lock){for(var i=0;i<this._list.length;++i){var choice=this._list[i];choice._identifier!=identifier&&(choice._preventDrag=lock)}},OG.prototype.createChoice=function(id,el){var choice=new TDS.OrderChoice(this,id,el);return this._lookup[id]=choice,this._list.push(choice),choice},OG.prototype.getChoices=function(sort){var choices=this._list.concat();return sort&&Util.Array.sort(choices,TDS.Interaction.compareOrder),choices},OG.prototype.getIdentifiers=function(sort){return this.getChoices(sort).map(function(choice){return choice.getIdentifier()})},OG.prototype.getChoice=function(id){return this._lookup[id]},OG.prototype.removeChoice=function(id){var choice=this.getChoice(id);choice&&(delete this._lookup[id],Util.Array.remove(this._list,choice))},OG.prototype._syncDom=function(){var elements=this.getChoices().map(function(choice){return choice.getElement()}),groupEl=this.getElement();$(groupEl).append(elements)},OG.prototype.sort=function(identifiers){Util.Array.sort(this._list,function(recA,recB){var idxA=identifiers.indexOf(recA.getIdentifier()),idxB=identifiers.indexOf(recB.getIdentifier());return idxA>idxB?1:idxA<idxB?-1:0}),this._syncDom()},OG.prototype.dispose=function(){this._parentInteraction=null,this.getChoices().forEach(function(choice){choice.dispose()})},TDS.OrderGroup=OG}(TDS),function(TDS){function OC(parentGroup,responseIdentifier,element){this._parentGroup=parentGroup,this._parentInteraction=parentGroup.getParentInteraction(),this._proxy=null,this._dragging=!1,this._dragBack=!1,this._lastX=0,this._lastY=0,this._preventDrag=!1,OC.superclass.constructor.call(this,responseIdentifier,element)}var OI=TDS.OrderInteraction,Orientation=OI.Orientation,CSS=OI.CSS;YAHOO.extend(OC,TDS.Choice),OC.prototype.getGroup=function(){return this._parentGroup},OC.prototype.getParentInteraction=function(){return this._parentInteraction},OC.prototype.getProxy=function(){return this._proxy},OC.prototype.isDragging=function(){return this._dragging},OC.prototype.init=function(){var element=this.getElement(),proxy=new element.ownerDocument.defaultView.YAHOO.util.DDProxy(element);this._proxy=proxy,this._parentInteraction.getOrientation()==Orientation.Vertical?proxy.setXConstraint(0,0):proxy.setYConstraint(0,0),proxy.startDrag=this.onStartDrag.bind(this),proxy.onDrag=this.onDrag.bind(this),proxy.onDragOver=this.onDragOver.bind(this),proxy.onDragDrop=this.onDragDrop.bind(this),proxy.endDrag=this.onEndDrag.bind(this),proxy.b4MouseDown=this.onBeforeMouseDown.bind(this)},OC.prototype.refreshCache=function(){this.getElement().ownerDocument.defaultView.YAHOO.util.DragDropMgr.refreshCache()},OC.prototype.onBeforeMouseDown=function(ev){if(this._preventDrag)return!1},OC.prototype.onStartDrag=function(x,y){this._dragging=!0,this._parentGroup.toggleLockDrag(this._identifier,!0);var $srcEl=$(this._proxy.getEl()),$proxyEl=$(this._proxy.getDragEl());$srcEl.addClass(CSS.ORDER_SOURCE),$proxyEl.addClass(CSS.ORDER_PROXY),$proxyEl.css("width",""),$proxyEl.css("height",""),$proxyEl.css("border",""),$proxyEl.html($srcEl.html()),this._proxy.setDelta(0,$proxyEl.height()/2)},OC.prototype.onDrag=function(ev){if(this._parentInteraction.getOrientation()==Orientation.Horizontal){var x=YUE.getPageX(ev);x<this._lastX?this._dragBack=!0:x>this._lastX&&(this._dragBack=!1),this._lastX=x}else{var y=YUE.getPageY(ev);y<this._lastY?this._dragBack=!0:y>this._lastY&&(this._dragBack=!1),this._lastY=y}},OC.prototype.onDragOver=function(ev,id){var $src=$(this.getElement()),$dest=$(YUD.get(id));$src.parent().is($dest.parent())&&(this._dragBack?$src.insertBefore($dest):$src.insertAfter($dest),this.refreshCache())},OC.prototype.onDragDrop=function(ev,id){},OC.prototype.onEndDrag=function(){this._dragging=!1,this._parentGroup.toggleLockDrag(this._identifier,!1);var $srcEl=$(this._proxy.getEl()),$proxyEl=$(this._proxy.getDragEl());$srcEl.removeClass(CSS.ORDER_SOURCE),$proxyEl.removeClass(CSS.ORDER_PROXY)},OC.prototype.dispose=function(){this._parentGroup=null,this._parentInteraction=null,this._proxy=null},TDS.OrderChoice=OC}(TDS),function(CM){function Widget_HT(page,item,config){this.dataType=CM.DataType.Array,this.options={autoLoad:!0},this.interaction=null}var QTI=CM.QTI,match=QTI.createWidgetMatch("hottextInteraction");CM.registerWidget("qti.hottext",Widget_HT,match),Widget_HT.prototype.load=function(){var containerEl=this.element,interactionNode=this.config,interactionDoc=interactionNode.ownerDocument,interactionId=this.id;QTI.replaceNodes(interactionNode,"hottext",function(htNode){var span=interactionDoc.createElement("span");return span.setAttribute("class","interaction selectable"),span.setAttribute("data-its-group",interactionId),span.setAttribute("data-its-identifier",htNode.getAttribute("identifier")),span});var interactionEl=QTI.createInteractionElement(interactionNode);this.interaction=new TDS.SelectInteraction("select-"+this.id),this.interaction.load(interactionEl),containerEl.appendChild(interactionEl)},Widget_HT.prototype.getResponse=function(){var values=this.interaction.getResponseArray(),isValid=this.interaction.validateResponse();return this.createResponse(values,isValid)},Widget_HT.prototype.setResponse=function(values){this.interaction.loadResponseIDs(values)}}(window.ContentManager),function(CM){function Widget_Order(page,item,config){this.dataType=CM.DataType.Array,this.options={autoLoad:!0},this.interaction=null}var QTI=CM.QTI,match=QTI.createWidgetMatch("orderInteraction");CM.registerWidget("qti.order",Widget_Order,match),Widget_Order.prototype.load=function(){var containerEl=this.element,interactionNode=this.config,interactionDoc=interactionNode.ownerDocument,interactionId=this.id;QTI.replacePrompt(interactionNode);var listEl=interactionDoc.createElement("ul");listEl.setAttribute("class","interaction order-group"),listEl.setAttribute("data-its-identifier",this.id);var choiceSpans=QTI.replaceNodes(interactionNode,"simpleChoice",function(simpleNode){var span=interactionDoc.createElement("li");return span.setAttribute("class","interaction order-choice"),span.setAttribute("data-its-group",interactionId),span.setAttribute("data-its-identifier",simpleNode.getAttribute("identifier")),span});$(choiceSpans).appendTo(listEl),$(listEl).appendTo(interactionNode);var interactionEl=QTI.createInteractionElement(interactionNode);this.interaction=new TDS.OrderInteraction("order-"+this.id),this.interaction.load(interactionEl),containerEl.appendChild(interactionEl)},Widget_Order.prototype.show=function(){this.interaction.prepareForShow()},Widget_Order.prototype.getResponse=function(){var values=this.interaction.getResponseJson()[0].responses,isValid=this.interaction.validateResponse();return this.createResponse(values,isValid)},Widget_Order.prototype.setResponse=function(values){this.interaction.getGroup(this.id).sort(values)}}(window.ContentManager),function(CM){function Container(){}CM.registerResponseContainer("Interactions",Container),Container.prototype.create=function(responses){var xmlDoc=Util.Xml.parseFromString("<interactions></interactions>"),rootNode=xmlDoc.documentElement;return responses.forEach(function(response){var interactionNode=response.value.documentElement;rootNode.appendChild(interactionNode)}),Util.Xml.serializeToString(xmlDoc)},Container.prototype.load=function(value,widgets){var rootNode=Util.Xml.parseFromString(value).documentElement;$("interaction",rootNode).each(function(idx,node){var id=node.getAttribute("identifier"),widget=Util.Array.find(widgets,function(widget){return widget.id==id});widget&&widget.setResponse(node)})},CM.mapResponseContainer("HT","Interactions"),CM.mapResponseContainer("HTQ","QTI")}(window.ContentManager),function(CM){function isQTIResponse(item){return"HTQ"==item.format.toUpperCase()}function Widget_Select(page,item,config){this.dataType=isQTIResponse(item)?CM.DataType.Array:CM.DataType.Xml,this.options={autoLoad:!0},this.interaction=null}CM.registerWidget("select",Widget_Select,function(page,item){if(!item.isResponseType("Hottext"))return!1;var stemEl=item.getStemElement(),$selectables=$("span.interaction.selectable",stemEl);if($selectables.length>0){var groupId=$selectables.attr("data-its-group");return new CM.WidgetConfig(groupId,stemEl)}return!1}),Widget_Select.prototype.load=function(){var item=this.entity,stemEl=this.element,interaction=new TDS.SelectInteraction(this.id);interaction.load(stemEl),this.interaction=interaction;var constraints=Util.Array.find(item.specs,function(spec){return"constraints"==spec.nodeName});constraints&&Util.Dom.queryTagsBatch("cardinality",constraints,function(el){var id=Util.Xml.getAttribute(el,"target"),min=Util.Xml.getAttributeInt(el,"min"),max=Util.Xml.getAttributeInt(el,"max");interaction.setCardinality(id,min,max)})},Widget_Select.prototype.getComponents=function(){return this.interaction.getChoices().map(function(choice){return choice.getElement()})},Widget_Select.prototype.getResponse=function(){var data;data=isQTIResponse(this.entity)?this.interaction.getResponseArray():this.interaction.getResponseXml();var isValid=this.interaction.validateResponse();return this.createResponse(data,isValid)},Widget_Select.prototype.setResponse=function(data){isQTIResponse(this.entity)?this.interaction.loadResponseIDs(data):this.interaction.loadResponseXml(data)}}(window.ContentManager),function(CM){function isQTIResponse(item){return"HTQ"==item.format.toUpperCase()}function Widget_Order_ITS(page,item,config){this.dataType=isQTIResponse(item)?CM.DataType.Array:CM.DataType.Xml,this.options={autoLoad:!0},this.interaction=null}CM.registerWidget("order",Widget_Order_ITS,function(page,item){if(!item.isResponseType("Hottext"))return!1;var stemEl=item.getStemElement(),$groups=$("ul.interaction.order-group",stemEl);if($groups.length>0){var groupId=$groups.attr("data-its-identifier");if(!groupId)throw new Error("Order interaction missing group id: "+$groups.html().split(">")[0]+">");return new CM.WidgetConfig(groupId,stemEl)}return!1}),Widget_Order_ITS.prototype.load=function(){var stemEl=this.element;this.interaction=new TDS.OrderInteraction(this.id),this.interaction.load(stemEl)},Widget_Order_ITS.prototype.show=function(){this.interaction.prepareForShow()},Widget_Order_ITS.prototype.getResponseDataType=function(){return isQTIResponse(this.entity)?CM.DataType.Array:CM.DataType.Xml},Widget_Order_ITS.prototype.getResponse=function(){var data;data=isQTIResponse(this.entity)?this.interaction.getResponseJson()[0].responses:this.interaction.getResponseXml();var isValid=this.interaction.validateResponse();return this.createResponse(data,isValid)},Widget_Order_ITS.prototype.setResponse=function(data){isQTIResponse(this.entity)?this.interaction.getGroup(this.id).sort(data):this.interaction.loadResponseXml(data)}}(window.ContentManager),function(CM){function isQTIResponse(item){return"HTQ"==item.format.toUpperCase()}function Widget_DD(page,item,config){this.dataType=isQTIResponse(item)?CM.DataType.Array:CM.DataType.Xml,this.options={autoLoad:!0},this.interaction=null}CM.registerWidget("dragdrop",Widget_DD,function(page,item){if(!item.isResponseType("Hottext"))return!1;var stemEl=item.getStemElement(),$draggables=$("span.interaction.draggable",stemEl);if($draggables.length>0){var id;if(isQTIResponse(item)){var groupId=$draggables.attr("data-its-group");if(!groupId)throw new Error("Drag interaction missing group id: "+$draggables.html().split(">")[0]+">");id=groupId}else id="dd-"+item.getID();return new CM.WidgetConfig(id,stemEl)}return!1}),Widget_DD.prototype.load=function(){var page=this.page,stemEl=this.element,dd=new TDS.DDInteraction(this.id);this.interaction=dd,dd.load(stemEl);var draggables=dd.getDraggables();if(draggables.length>0){var pageElement=page.getElement(),scrollContainer=Util.Dom.getElementByClassName("theQuestions","div",pageElement);if(scrollContainer)for(var i=0;i<draggables.length;i++){var ddProxy=draggables[i].getProxy();ddProxy.setScrollDirection(!0,!0),ddProxy.setParentScroll(scrollContainer)}}},Widget_DD.prototype.getResponse=function(){var dd=this.interaction,data=null;data=isQTIResponse(this.entity)?dd.getResponseJson()[0].responses:dd.getResponseXml();var isValid=dd.validateResponse();return this.createResponse(data,isValid)},Widget_DD.prototype.setResponse=function(data){var dd=this.interaction;if(isQTIResponse(this.entity)){var group=dd.getGroup(this.id);group&&data.forEach(function(responseIdentifier){var draggable=dd.getDraggable(responseIdentifier);draggable&&dd.onDrop(draggable,group)})}else dd.loadResponseXml(data)}}(window.ContentManager),MatchItem="undefined"==typeof MatchItem?{}:MatchItem,MatchItem.ListHtmlGenerator=function(discriminator){var getDivId=function(str){return discriminator?discriminator+str:str},self=this;this.cellFactory=MatchItem.ListCellHtml.Create;var lineUl=document.createElement("ul");this.tabbableSpans=[];var choiceItems=[];this.getClickableHeader=function(choiceItem){return choiceItem.elementContainer},this.createHeaderElement=function(choiceItem,scope){choiceItem.elementContainer=document.createElement("li");var divId=getDivId("li-"+choiceItem.identifier+"-"+scope);choiceItem.elementContainer.setAttribute("id",divId),choiceItem.element=document.createElement("div"),YUD.setAttribute(choiceItem.element,"tabindex","0"),YUD.addClass(choiceItem.element,"innerContainer"),choiceItem.element.innerHTML=choiceItem.value,choiceItem.elementContainer.appendChild(choiceItem.element),choiceItem.lineUl=lineUl,this.tabbableSpans.push(choiceItem.elementContainer),choiceItems[divId]=choiceItem},this.createTableHeaderRows=function(prompt){self.headerDiv=document.createElement("div"),YUD.addClass(self.headerDiv,"matchItemLines"),YUD.setAttribute(self.headerDiv,"id",getDivId("matchItemLinesId")),self.headerRow=document.createElement("ul"),YUD.addClass(self.headerRow,"matchColumn matchFirstColumn"),self.headerColumn=document.createElement("ul"),YUD.addClass(self.headerColumn,"matchColumn matchSecondColumn"),YUD.addClass(lineUl,"matchConnections"),self.headerDiv.appendChild(self.headerRow),self.headerDiv.appendChild(self.headerColumn),self.headerDiv.appendChild(lineUl)},this.addColumnToHeaderRow=function(column){self.headerColumn.appendChild(column.elementContainer)},this.createTable=function(table,captionText){var caption=document.createElement("div");Util.Dom.setTextContent(caption,captionText),table.appendChild(self.headerDiv)},this.attachRowToTable=function(row){self.headerRow.appendChild(row.elementContainer)},this.setSelected=function(val,choiceItem){val?YUD.addClass(choiceItem.elementContainer,"matchSelected"):YUD.removeClass(choiceItem.elementContainer,"matchSelected")},this.setHeaderCallback=function(choiceItem,func){YUE.addListener(choiceItem.element,"click",function(evt){func(choiceItem)})},this.setItemChecked=function(header,val){val?YUD.addClass(header.elementContainer,"matchMade"):YUD.removeClass(header.elementContainer,"matchMade")}},MatchItem.TableHtmlGenerator=function(discriminator){var self=this;this.cellFactory=MatchItem.TableCellHtml.Create,this.getClickableHeader=function(choiceItem){return null},this.createHeaderElement=function(choiceItem,scope){choiceItem.element=document.createElement("th"),choiceItem.element.setAttribute("scope",scope),choiceItem.element.innerHTML=choiceItem.value,"row"==scope&&(choiceItem.elementContainer=document.createElement("tr"),choiceItem.elementContainer.appendChild(choiceItem.element))},this.createTableHeaderRows=function(prompt){self.headerRow=document.createElement("tr"),self.promptCell=document.createElement("td"),self.promptCell.innerHTML=prompt,YUD.addClass(self.promptCell,"matchItem_cellSpacer"),self.headerRow.appendChild(self.promptCell)},this.addColumnToHeaderRow=function(column){self.headerRow.appendChild(column.element)},this.setSelected=function(val,choiceItem){},this.setHeaderCallback=function(choiceItem){},this.createTable=function(parentDiv,captionText){var table=document.createElement("table"),thead=document.createElement("THEAD");if(self.tbody=document.createElement("TBODY"),captionText&&captionText.length>0){var caption=document.createElement("caption");Util.Dom.setTextContent(caption,captionText),table.appendChild(caption)}thead.appendChild(self.headerRow),table.appendChild(thead),table.appendChild(self.tbody),parentDiv.appendChild(table)},this.setItemChecked=function(header,val){},this.attachRowToTable=function(row){self.tbody.appendChild(row.elementContainer)}},MatchItem.TableCellHtml=function(id,label,discriminator){var cellElement,checkboxElement;this.getCheckbox=function(){return checkboxElement},cellElement=document.createElement("td"),(checkboxElement=document.createElement("input")).type="checkbox";var lelem=document.createElement("label");lelem.setAttribute("for",id),lelem.innerHTML=label;for(var spanNode,spanNodes=lelem.getElementsByTagName("span"),spanNodesToRemove=[],spanIndex=0;spanIndex<spanNodes.length;++spanIndex)if((spanNode=spanNodes[spanIndex]).hasAttribute("data-tag-boundary")){var spanAttrValue=spanNode.getAttribute("data-tag-boundary");"start"!==spanAttrValue&&"end"!==spanAttrValue||spanNodesToRemove.push(spanNode)}for(var removeIndex=0;removeIndex<spanNodesToRemove.length;++removeIndex)(spanNode=spanNodesToRemove[removeIndex]).parentNode.removeChild(spanNode);for(var par=lelem.getElementsByTagName("p");null!=par&&par.length>0;){var p=par[0],span=document.createElement("span");span.innerHTML=p.innerHTML,p.parentNode.replaceChild(span,p),par=lelem.getElementsByTagName("p")}cellElement.appendChild(checkboxElement),cellElement.appendChild(lelem),YUD.setAttribute(checkboxElement,"id",id),this.attachToRow=function(rowElement){rowElement.appendChild(cellElement)},this.isChecked=function(){return checkboxElement.checked},this.setChecked=function(val){checkboxElement.checked=val;var td=checkboxElement.parentNode;val?YUD.addClass(td,"matchItem_cellChecked"):YUD.removeClass(td,"matchItem_cellChecked")};var listenerFuncs=[];this.addClickListener=function(func){listenerFuncs.push(func)},YUE.addListener(checkboxElement,"click",function(ev){for(var cancelEvent=!1,i=0;i<listenerFuncs.length;++i)listenerFuncs[i](ev)||(cancelEvent=!0);if(cancelEvent)ev.preventDefault();else{var td=checkboxElement.parentNode;checkboxElement.checked?YUD.addClass(td,"matchItem_cellChecked"):YUD.removeClass(td,"matchItem_cellChecked")}})},MatchItem.ListCellHtml=function(id,label,parentCell,discriminator){var cellElement,line;cellElement=document.createElement("li"),this.attachToRow=function(rowElement){},this.isChecked=function(){return null!=line},this.getCheckbox=function(){return null},this.setChecked=function(val,parentSelected){if(0==val)line&&(cellElement.parentNode.removeChild(cellElement),line.parentNode.removeChild(line),line=null);else{if(null==line){var row=parentCell.getRowItem().elementContainer,column=parentCell.getColumnItem().elementContainer;if(row.offsetLeft>column.offsetLeft){var rrr=row;row=column,column=rrr}var container=parentCell.getRowItem().lineUl,r1=YUD.getRegion(row),r2=YUD.getRegion(column),x1=row.offsetLeft,y1=row.offsetTop,x2=column.offsetLeft,y2=column.offsetTop;x1+=r1.width,y1+=r1.height/2,y2+=r2.height/2,line=createLine(x1,y1,x2,y2),Util.Dom.setTextContent(line,label),container.appendChild(cellElement),cellElement.appendChild(line)}parentSelected?YUD.addClass(line,"matchParentSelected"):YUD.removeClass(line,"matchParentSelected")}};var listenerFuncs=[];this.addClickListener=function(func){listenerFuncs.push(func)}},MatchItem.TableCellHtml.Create=function(id,label,parentCell,discriminator){return new MatchItem.TableCellHtml(id,label,parentCell,discriminator)},MatchItem.ListCellHtml.Create=function(id,label,parentCell,discriminator){return new MatchItem.ListCellHtml(id,label,parentCell,discriminator)},MatchItem="undefined"==typeof MatchItem?{}:MatchItem,MatchItem.Cell=function(id,rowIndex,colIndex,matrix,cellFactory){var row=rowIndex,column=colIndex;this.getRow=function(){return row},this.getColumn=function(){return column},this.getRowItem=function(){return matrix.getRow(row)},this.getColumnItem=function(){return matrix.getColumn(column)},this.getCheckbox=function(){return presentation.getCheckbox()};var presentation=cellFactory(id,matrix.getRow(row).value+" and "+matrix.getColumn(column).value,this),onCheckFuncs=[];this.onCheck=function(func){onCheckFuncs.push(func)},this.attachToRow=function(rowElement){presentation.attachToRow(rowElement)},this.isChecked=function(){return presentation.isChecked()},this.setChecked=function(val,parentSelected){presentation.setChecked(val,parentSelected),checked=val},this.redraw=function(){checked&&(self.setChecked(!1),self.setChecked(!0))},this.erase=function(){checked&&presentation.setChecked(!1)};var checked=!1,self=this;return presentation.addClickListener(function(ev){if(matrix.isReadOnly())return!1;1==checked&&self.setChecked(!1);for(var i=0;i<onCheckFuncs.length;++i)onCheckFuncs[i](self);return!0}),this},MatchItem="undefined"==typeof MatchItem?{}:MatchItem,MatchItem.Parse=function(id){this.mid=id,this.createFromFile=function(xmlUrl){var xmlhttp;(xmlhttp="function"==typeof window.XMLHttpRequest||"object"==typeof window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",xmlUrl,!1),xmlhttp.send();var xmlDoc=xmlhttp.responseText;return this.createFromXml(xmlDoc)},this.createFromXml=function(xmlDoc){for(var nodes=Util.Xml.parseFromString(xmlDoc),spanNodes=nodes.getElementsByTagName("span"),spanIndex=0;spanIndex<spanNodes.length;++spanIndex){var spanNode=spanNodes[spanIndex];if(0===spanNode.childNodes.length&&spanNode.hasAttribute("data-tag-boundary")){var spanAttrValue=spanNode.getAttribute("data-tag-boundary");"start"!==spanAttrValue&&"end"!==spanAttrValue||spanNode.appendChild(document.createTextNode(""))}}var choiceXml,docElement=nodes.documentElement;if("matchInteraction"==docElement.tagName)choiceXml=docElement;else{var matchInteraction=docElement.getElementsByTagName("matchInteraction");if(null==matchInteraction||1!=matchInteraction.length)return;choiceXml=matchInteraction[0]}var readContent=function(choice){for(var rv="",k=0;k<choice.childNodes.length;++k)1==choice.childNodes[k].nodeType?rv+=Util.Xml.serializeToString(choice.childNodes[k]):3==choice.childNodes[k].nodeType&&(rv+=Util.Dom.getTextContent(choice.childNodes[k]));return rv},processItemSet=function(choices){for(var itemAr=[],choiceItems=choices.getElementsByTagName("simpleAssociableChoice"),j=0;j<choiceItems.length;++j){var choice=choiceItems[j],choiceItem={identifier:choice.getAttribute("identifier"),matchMax:choice.getAttribute("matchMax"),content:readContent(choice)};itemAr.push(choiceItem)}return itemAr};this.maxAssociations=parseInt(choiceXml.getAttribute("maxAssociations")),this.title=choiceXml.getAttribute("title"),this.forceTable=choiceXml.getAttribute("forceTable"),this.responseId=choiceXml.getAttribute("responseIdentifier"),this.shuffle="true"===choiceXml.getAttribute("shuffle");var choiceSets=choiceXml.getElementsByTagName("simpleMatchSet"),promptNodes=choiceXml.getElementsByTagName("prompt");this.prompt=promptNodes&&promptNodes.length>0?Util.Dom.getTextContent(promptNodes[0]):"",this.rows=processItemSet(choiceSets[0]),this.columns=processItemSet(choiceSets[1])}},MatchItem.PermutationArray=function(size,shuffle){for(var ar=[],i=0;i<size;++i)if(ar.push(i),shuffle&&i>0){var ix=Math.floor(Math.random()*(i+1)),p=ar[i];ar[i]=ar[ix],ar[ix]=p}return ar},MatchItem.Matrix=function(parseResult,htmlGenerator,discriminator){var rowHeaders=[],columnHeaders=[],cells=[],onChangedFuncs=[],addComponentArray=[],keyEventHandlerArray=[],prompt="";null!=parseResult.prompt&&(prompt=parseResult.prompt);var maxAssociations=parseResult.maxAssociations,shuffle=parseResult.shuffle,title=parseResult.title,cs=parseResult.columns,rs=parseResult.rows;this.responseId=parseResult.responseId;var self=this;this.onChanged=function(func){onChangedFuncs.push(func)},this.getRow=function(index){return rowHeaders[index]},this.getColumn=function(index){return columnHeaders[index]},this.getRowCount=function(){return rowHeaders.length},this.getColumnCount=function(){return columnHeaders.length},this.getCell=function(r,c){return cells[this.index(rowHeaders[r].identifier,columnHeaders[c].identifier)]},this.violatesMatchMax=function(cell){var orow,ocol,column=columnHeaders[cell.getColumn()],rmax=rowHeaders[cell.getRow()].matchMax,cmax=column.matchMax;if(cmax&&self.checksInColumn(cell.getColumn())>cmax)cell.setChecked(!1),1==cmax&&(ocol=getOnlyCheckInColumn(cell.getColumn()),1==rmax&&(orow=getOnlyCheckInRow(cell.getRow())),cell.setChecked(!0));else if(rmax&&self.checksInRow(cell.getRow())>rmax)cell.setChecked(!1),1==rmax&&(orow=getOnlyCheckInRow(cell.getRow()),1==cmax&&(ocol=getOnlyCheckInColumn(cell.getColumn())),cell.setChecked(!0));else if(maxAssociations&&self.countAssociations()>maxAssociations)cell.setChecked(!1);else for(var i=0;i<onChangedFuncs.length;++i)onChangedFuncs[i](self);orow&&orow.setChecked(!1),ocol&&ocol.setChecked(!1)},this.isResponseValid=function(){var value=this.getResult();return value&&value.length>0},this.getResponseXML=function(){var value=this.getResult(),xmlDoc=Util.Xml.createDocument("itemResponse"),xmlEl=xmlDoc.documentElement,responseXML=xmlDoc.createElement("response");if(responseXML.setAttribute("id",this.responseId),xmlEl.appendChild(responseXML),value&&value.length>0)for(var i=0;i<value.length;i++){var valueXML=xmlDoc.createElement("value");valueXML.textContent=value[i],responseXML.appendChild(valueXML)}return Util.Xml.serializeToString(xmlDoc)},this.getResult=function(){var result=[];return this.forEachCell(function(cell){if(cell.isChecked()){var str=rowHeaders[cell.getRow()].identifier+" "+columnHeaders[cell.getColumn()].identifier;result.push(str)}}),result},this.setResultXML=function(resultXML){var values=Util.Xml.parseFromString(resultXML).documentElement.getElementsByTagName("value"),result=[];if(values&&values.length>0)for(var i=0;i<values.length;i++)result.push(values[i].textContent);this.setResult(result)},this.setResult=function(ar){var i;this.forEachCell(function(cell){var row=rowHeaders[cell.getRow()],col=columnHeaders[cell.getColumn()];cell.setChecked(!1),htmlGenerator.setItemChecked(row,!1),htmlGenerator.setItemChecked(col,!1)}),null!=ar&&this.forEachCell(function(cell){for(i=0;i<ar.length;++i){var ar2=ar[i].split(" "),row=rowHeaders[cell.getRow()],col=columnHeaders[cell.getColumn()],rowid=row.identifier,colid=col.identifier;ar2[0]==rowid&&ar2[1]==colid&&(cell.setChecked(!0),htmlGenerator.setItemChecked(row,!0),htmlGenerator.setItemChecked(col,!0))}})},this.forEachCell=function(func){for(var i=0;i<this.getRowCount();++i)for(var j=0;j<this.getColumnCount();++j)func(this.getCell(i,j))},this.forEachRow=function(func){for(var i=0;i<self.getRowCount();++i)func(self.getRow(i))},this.forEachColumn=function(func){for(var j=0;j<self.getColumnCount();++j)func(self.getColumn(j))};var handleHeaderClick=function(header){var iterator,otherIterator,selectedRow=null,selectedCol=null;if(header.isSelected)return htmlGenerator.setSelected(!1,header),header.isSelected=!1,void updateParentSelected(header);"row"==header.scope?(otherIterator=self.forEachColumn,iterator=self.forEachRow,selectedRow=header):(otherIterator=self.forEachRow,iterator=self.forEachColumn,selectedCol=header),iterator(function(entity){entity.identifier!=header.identifier&&1==entity.isSelected&&(entity.isSelected=!1,htmlGenerator.setSelected(!1,entity))}),otherIterator(function(entity){entity.isSelected&&(null==selectedRow?selectedRow=entity:selectedCol=entity)}),selectedRow&&selectedCol?self.forEachCell(function(cell){cell.getRowItem().identifier==selectedRow.identifier&&cell.getColumnItem().identifier==selectedCol.identifier&&(selectedRow.isSelected=!1,htmlGenerator.setSelected(!1,selectedRow),selectedCol.isSelected=!1,htmlGenerator.setSelected(!1,selectedCol),0==cell.isChecked()?(cell.setChecked(!0),self.violatesMatchMax(cell)):cell.setChecked(!1))}):(header.isSelected=!0,htmlGenerator.setSelected(!0,header)),updateParentSelected(header)},updateParentSelected=function(header){self.forEachCell(function(cell){1==cell.isChecked()&&(1==rowHeaders[cell.getRow()].isSelected||1==columnHeaders[cell.getColumn()].isSelected?cell.setChecked(!0,!0):cell.setChecked(!0,!1))}),self.forEachRow(function(row){self.checksInRow(row.index)>0?htmlGenerator.setItemChecked(row,!0):htmlGenerator.setItemChecked(row,!1)}),self.forEachColumn(function(column){self.checksInColumn(column.index)>0?htmlGenerator.setItemChecked(column,!0):htmlGenerator.setItemChecked(column,!1)})},addHeader=function(xHeader,scopeString){var choiceItem={identifier:xHeader.identifier,matchMax:parseInt(xHeader.matchMax),value:xHeader.content,element:null,elementContainer:null,isSelected:!1,scope:scopeString};return htmlGenerator.createHeaderElement(choiceItem,scopeString),htmlGenerator.setHeaderCallback(choiceItem,handleHeaderClick),choiceItem};this.index=function(rowid,colid){return parseResult.mid+"-"+rowid+"-"+colid};this.checksInColumn=function(ix){var rv=0;return this.forEachCell(function(cell){cell.getColumn()==ix&&cell.isChecked()&&++rv}),rv};var getOnlyCheckInColumn=function(ix){var rv=null;return self.forEachCell(function(cell){cell.getColumn()==ix&&cell.isChecked()&&1==columnHeaders[cell.getColumn()].matchMax&&(rv=cell)}),rv},getOnlyCheckInRow=function(ix){var rv=null;return self.forEachCell(function(cell){cell.getRow()==ix&&cell.isChecked()&&1==rowHeaders[cell.getRow()].matchMax&&(rv=cell)}),rv};this.checksInRow=function(ix){var rv=0;return this.forEachCell(function(cell){cell.getRow()==ix&&cell.isChecked()&&++rv}),rv},this.countAssociations=function(){var rv=0;return this.forEachCell(function(cell){cell.isChecked()&&++rv}),rv},this.attachTable=function(table){htmlGenerator.createTable(table,title);for(var i=0;i<rowHeaders.length;++i)htmlGenerator.attachRowToTable(rowHeaders[i])},this.eraseChecks=function(){this.forEachCell(function(cell){cell.erase()})},this.reDrawChecks=function(){window.setTimeout(function(){self.forEachCell(function(cell){cell.redraw()})},1)};htmlGenerator.createTableHeaderRows(prompt);for(var colperms=MatchItem.PermutationArray(cs.length,parseResult.shuffle),colix=0;colix<cs.length;++colix)!function(xHeader){var acol=addHeader(xHeader,"col");acol.index=columnHeaders.length,columnHeaders.push(acol)}(cs[colperms[colix]]),htmlGenerator.addColumnToHeaderRow(columnHeaders[colix]);for(var rowperms=MatchItem.PermutationArray(rs.length,shuffle),rowix=0;rowix<rs.length;++rowix)for(function(xHeader){var arow=addHeader(xHeader,"row");arow.index=rowHeaders.length,rowHeaders.push(arow)}(rs[rowperms[rowix]]),colix=0;colix<columnHeaders.length;++colix)!function(row,col){var identifier=self.index(rowHeaders[row].identifier,columnHeaders[col].identifier),tmpCell=new MatchItem.Cell("micell-"+identifier,row,col,self,htmlGenerator.cellFactory,discriminator);cells[identifier]=tmpCell,tmpCell.attachToRow(rowHeaders[row].elementContainer),tmpCell.onCheck(self.violatesMatchMax)}(rowix,colix);this.getComponentArray=function(){return addComponentArray},this.handleKeyEvent=function(spanId,evt){if(spanId){var handleEnterKey=keyEventHandlerArray[spanId];handleEnterKey&&"function"==typeof handleEnterKey&&handleEnterKey()}};var headerNavIterator=function(iterator){iterator(function(entity){var span=htmlGenerator.getClickableHeader(entity);null!=span&&span.id&&(addComponentArray.push(span),keyEventHandlerArray[span.id]=function(){handleHeaderClick(entity)})})};headerNavIterator(this.forEachRow),headerNavIterator(this.forEachColumn),this.forEachCell(function(cell){var checkbox=cell.getCheckbox();checkbox&&checkbox.id&&(addComponentArray.push(checkbox),keyEventHandlerArray[checkbox.id]=function(){cell.setChecked(!cell.isChecked()),self.violatesMatchMax(cell)})})},MatchItem.Matrix.prototype.isReadOnly=function(){return!1},function(CM,MatchItem){function create(item,containerEl){var parseResult=new MatchItem.Parse(item.itemKey),qtiXml=item.qti?item.qti.xml:item.rendererSpec;if(null==qtiXml)return null;parseResult.createFromXml(qtiXml);var presentation;presentation=item.isResponseType("TableMatch")||CM.isAccessibilityEnabled()?new MatchItem.TableHtmlGenerator(item.position):new MatchItem.ListHtmlGenerator(item.position);var discriminator=item.position,m1=new MatchItem.Matrix(parseResult,presentation,discriminator);m1.isReadOnly=item.isReadOnly.bind(item);for(var componentArray=m1.getComponentArray(),i=0;i<componentArray.length;++i)item.addComponent(componentArray[i]);containerEl.innerHTML="",YUD.removeClass(containerEl,"loading"),m1.attachTable(containerEl);var onresize=window.onresize;return YUE.on(window,"scroll",function(){null!=onresize&&onresize(),item.isVisible()&&m1.reDrawChecks()}),item.value&&m1.setResultXML(item.value),m1}function Widget_MI(page,item){this.matchItem=null}MatchItem&&(CM.registerWidget("matchitem",Widget_MI,function(page,item){var id="MatchContainer_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el)}),Widget_MI.prototype.load=function(){this.matchItem=create(this.entity,this.element)},Widget_MI.prototype.keyEvent=function(evt){if("keydown"==evt.type&&!evt.ctrlKey&&!evt.altKey){var item=this.entity,matches=this.matchItem;if("Enter"==evt.key){if(item.isReadOnly())return;evt.stopPropagation();var matchId=item.getActiveComponent().id;matchId&&matches.handleKeyEvent(matchId,evt)}}},Widget_MI.prototype.zoom=function(level){this.matchItem.reDrawChecks()},Widget_MI.prototype.show=function(){this.matchItem.reDrawChecks()},Widget_MI.prototype.getResponse=function(){var value=this.matchItem.getResponseXML(),isValid=this.matchItem.isResponseValid();return this.createResponse(value,isValid)},Widget_MI.prototype.setResponse=function(value){this.matchItem.setResultXML(value)})}(window.ContentManager,window.MatchItem),function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,h=function(){},i=function(a,b){return a-b},j={n:{}},k=function(a,d){a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=k.listeners(a),j=0,l=[],m={},n=[],o=b;b=a,c=0;for(var p=0,q=h.length;q>p;p++)"zIndex"in h[p]&&(l.push(h[p].zIndex),h[p].zIndex<0&&(m[h[p].zIndex]=h[p]));for(l.sort(i);l[j]<0;)if(e=m[l[j++]],n.push(e.apply(d,g)),c)return c=f,n;for(p=0;q>p;p++)if("zIndex"in(e=h[p]))if(e.zIndex==l[j]){if(n.push(e.apply(d,g)),c)break;do{if(j++,(e=m[l[j]])&&n.push(e.apply(d,g)),c)break}while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,g)),c)break;return c=f,b=o,n.length?n:null};k._events=j,k.listeners=function(a){var b,c,d,e,h,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,h=m.length;h>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n["*"]],d=2;d--;)(b=c[d])&&(l.push(b),p=p.concat(b.f||[]));o=l}return p},k.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(f),d=j,e=0,g=c.length;g>e;e++)d=d.n,d=d.hasOwnProperty(c[e])&&d[c[e]]||(d[c[e]]={n:{}});for(d.f=d.f||[],e=0,g=d.f.length;g>e;e++)if(d.f[e]==b)return h;return d.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.f=function(a){var b=[].slice.call(arguments,1);return function(){k.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},k.stop=function(){c=1},k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},k.nts=function(){return b.split(f)},k.off=k.unbind=function(a,b){if(a){var c,d,h,i,l,m,n,o=a.split(f),p=[j];for(i=0,l=o.length;l>i;i++)for(m=0;m<p.length;m+=h.length-2){if(h=[m,1],c=p[m].n,"*"!=o[i])c[o[i]]&&h.push(c[o[i]]);else for(d in c)c[e](d)&&h.push(c[d]);p.splice.apply(p,h)}for(i=0,l=p.length;l>i;i++)for(c=p[i];c.n;){if(b){if(c.f){for(m=0,n=c.f.length;n>m;m++)if(c.f[m]==b){c.f.splice(m,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[e](d)&&c.n[d].f){var q=c.n[d].f;for(m=0,n=q.length;n>m;m++)if(q[m]==b){q.splice(m,1);break}!q.length&&delete c.n[d].f}}else{delete c.f;for(d in c.n)c.n[e](d)&&c.n[d].f&&delete c.n[d].f}c=c.n}}else k._events=j={n:{}}},k.once=function(a,b){var c=function(){return k.unbind(a,c),b.apply(this,arguments)};return k.on(a,c)},k.version=d,k.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=k:"undefined"!=typeof define?define("eve",[],function(){return k}):a.eve=k}(window||this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){function c(a){if(c.is(a,"function"))return u?a():b.on("raphael.DOMload",a);if(c.is(a,V))return c._engine.create[D](c,a.splice(0,3+c.is(a[0],T))).add(a);var d=Array.prototype.slice.call(arguments,0);if(c.is(d[d.length-1],"function")){var e=d.pop();return u?e.call(c._engine.create[D](c,d)):b.on("raphael.DOMload",function(){e.call(c._engine.create[D](c,d))})}return c._engine.create[D](c,arguments)}function d(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[z](c)&&(b[c]=d(a[c]));return b}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function f(a,b,c){function d(){var f=Array.prototype.slice.call(arguments,0),g=f.join(""),h=d.cache=d.cache||{},i=d.count=d.count||[];return h[z](g)?(e(i,g),c?c(h[g]):h[g]):(i.length>=1e3&&delete h[i.shift()],i.push(g),h[g]=a[D](b,f),c?c(h[g]):h[g])}return d}function g(){return this.hex}function h(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function i(a,b,c,d,e){return a*(a*(-3*b+9*c-9*d+3*e)+6*b-12*c+6*d)-3*b+3*c}function j(a,b,c,d,e,f,g,h,j){null==j&&(j=1);for(var k=(j=j>1?1:0>j?0:j)/2,m=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;12>p;p++){var q=k*m[p]+k,r=i(q,a,c,e,g),s=i(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return k*o}function k(a,b,c,d,e,f,g,h,i){if(!(0>i||j(a,b,c,d,e,f,g,h)<i)){var k,m=.5,n=1-m;for(k=j(a,b,c,d,e,f,g,h,n);Q(k-i)>.01;)m/=2,n+=(i>k?1:-1)*m,k=j(a,b,c,d,e,f,g,h,n);return n}}function l(a,b,c,d,e,f,g,h){if(!(O(a,c)<P(e,g)||P(a,c)>O(e,g)||O(b,d)<P(f,h)||P(b,d)>O(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+P(a,c).toFixed(2)||n>+O(a,c).toFixed(2)||n<+P(e,g).toFixed(2)||n>+O(e,g).toFixed(2)||o<+P(b,d).toFixed(2)||o>+O(b,d).toFixed(2)||o<+P(f,h).toFixed(2)||o>+O(f,h).toFixed(2)))return{x:l,y:m}}}}function m(a,b,d){var e=c.bezierBBox(a),f=c.bezierBBox(b);if(!c.isBBoxIntersect(e,f))return d?0:[];for(var g=j.apply(0,a),h=j.apply(0,b),i=O(~~(g/5),1),k=O(~~(h/5),1),m=[],n=[],o={},p=d?0:[],q=0;i+1>q;q++){var r=c.findDotsAtSegment.apply(c,a.concat(q/i));m.push({x:r.x,y:r.y,t:q/i})}for(q=0;k+1>q;q++)r=c.findDotsAtSegment.apply(c,b.concat(q/k)),n.push({x:r.x,y:r.y,t:q/k});for(q=0;i>q;q++)for(var s=0;k>s;s++){var t=m[q],u=m[q+1],v=n[s],w=n[s+1],x=Q(u.x-t.x)<.001?"y":"x",y=Q(w.x-v.x)<.001?"y":"x",z=l(t.x,t.y,u.x,u.y,v.x,v.y,w.x,w.y);if(z){if(o[z.x.toFixed(4)]==z.y.toFixed(4))continue;o[z.x.toFixed(4)]=z.y.toFixed(4);var A=t.t+Q((z[x]-t[x])/(u[x]-t[x]))*(u.t-t.t),B=v.t+Q((z[y]-v[y])/(w[y]-v[y]))*(w.t-v.t);A>=0&&1.001>=A&&B>=0&&1.001>=B&&(d?p++:p.push({x:z.x,y:z.y,t1:P(A,1),t2:P(B,1)}))}}return p}function n(a,b,d){a=c._path2curve(a),b=c._path2curve(b);for(var e,f,g,h,i,j,k,l,n,o,p=d?0:[],q=0,r=a.length;r>q;q++){var s=a[q];if("M"==s[0])e=i=s[1],f=j=s[2];else{"C"==s[0]?(n=[e,f].concat(s.slice(1)),e=n[6],f=n[7]):(n=[e,f,e,f,i,j,i,j],e=i,f=j);for(var t=0,u=b.length;u>t;t++){var v=b[t];if("M"==v[0])g=k=v[1],h=l=v[2];else{"C"==v[0]?(o=[g,h].concat(v.slice(1)),g=o[6],h=o[7]):(o=[g,h,g,h,k,l,k,l],g=k,h=l);var w=m(n,o,d);if(d)p+=w;else{for(var x=0,y=w.length;y>x;x++)w[x].segment1=q,w[x].segment2=t,w[x].bez1=n,w[x].bez2=o;p=p.concat(w)}}}}}return p}function o(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function p(){return this.x+H+this.y+H+this.width+"  "+this.height}function q(a,b,c,d,e,f){function g(a){return((l*a+k)*a+j)*a}function i(a,b){var c,d,e,f,h,i;for(e=a,i=0;8>i;i++){if(f=g(e)-a,Q(f)<b)return e;if(h=(3*l*e+2*k)*e+j,Q(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),Q(f-a)<b)return e;a>f?c=e:d=e,e=(d-c)/2+c}return e}var j=3*b,k=3*(d-b)-j,l=1-j-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return function(a,b){var c=i(a,b);return((o*c+n)*c+m)*c}(a,1/(200*f))}function r(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[z](e)&&(d[_(e)]=a[e],c.push(_(e)));c.sort(lb)}this.anim=d,this.top=c[c.length-1],this.percents=c}function s(a,d,e,f,g,h){e=_(e);var i,j,k,l,m,n,p=a.ms,r={},s={},t={};if(f)for(v=0,x=ic.length;x>v;v++){var u=ic[v];if(u.el.id==d.id&&u.anim==a){u.percent!=e?(ic.splice(v,1),k=1):j=u,d.attr(u.totalOrigin);break}}else f=+s;for(var v=0,x=a.percents.length;x>v;v++){if(a.percents[v]==e||a.percents[v]>f*a.top){e=a.percents[v],m=a.percents[v-1]||0,p=p/a.top*(e-m),l=a.percents[v+1],i=a.anim[e];break}f&&d.attr(a.anim[a.percents[v]])}if(i){if(j)j.initstatus=f,j.start=new Date-j.ms*f;else{for(var y in i)if(i[z](y)&&(db[z](y)||d.paper.customAttributes[z](y)))switch(r[y]=d.attr(y),null==r[y]&&(r[y]=cb[y]),s[y]=i[y],db[y]){case T:t[y]=(s[y]-r[y])/p;break;case"colour":r[y]=c.getRGB(r[y]);var A=c.getRGB(s[y]);t[y]={r:(A.r-r[y].r)/p,g:(A.g-r[y].g)/p,b:(A.b-r[y].b)/p};break;case"path":var B=Kb(r[y],s[y]),C=B[1];for(r[y]=B[0],t[y]=[],v=0,x=r[y].length;x>v;v++){t[y][v]=[0];for(var D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(C[v][D]-r[y][v][D])/p}break;case"transform":var G=d._,H=Pb(G[y],s[y]);if(H)for(r[y]=H.from,s[y]=H.to,t[y]=[],t[y].real=!0,v=0,x=r[y].length;x>v;v++)for(t[y][v]=[r[y][v][0]],D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(s[y][v][D]-r[y][v][D])/p;else{var K=d.matrix||new o,L={_:{transform:G.transform},getBBox:function(){return d.getBBox(1)}};r[y]=[K.a,K.b,K.c,K.d,K.e,K.f],Nb(L,s[y]),s[y]=L._.transform,t[y]=[(L.matrix.a-K.a)/p,(L.matrix.b-K.b)/p,(L.matrix.c-K.c)/p,(L.matrix.d-K.d)/p,(L.matrix.e-K.e)/p,(L.matrix.f-K.f)/p]}break;case"csv":var M=I(i[y])[J](w),N=I(r[y])[J](w);if("clip-rect"==y)for(r[y]=N,t[y]=[],v=N.length;v--;)t[y][v]=(M[v]-r[y][v])/p;s[y]=M;break;default:for(M=[][E](i[y]),N=[][E](r[y]),t[y]=[],v=d.paper.customAttributes[y].length;v--;)t[y][v]=((M[v]||0)-(N[v]||0))/p}var O=i.easing,P=c.easing_formulas[O];if(!P)if((P=I(O).match(Z))&&5==P.length){var Q=P;P=function(a){return q(a,+Q[1],+Q[2],+Q[3],+Q[4],p)}}else P=nb;if(n=i.start||a.start||+new Date,u={anim:a,percent:e,timestamp:n,start:n+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:p,easing:P,from:r,diff:t,to:s,el:d,callback:i.callback,prev:m,next:l,repeat:h||a.times,origin:d.attr(),totalOrigin:g},ic.push(u),f&&!j&&!k&&(u.stop=!0,u.start=new Date-p*f,1==ic.length))return kc();k&&(u.start=new Date-u.ms*f),1==ic.length&&jc(kc)}b("raphael.anim.start."+d.id,d,a)}}function t(a){for(var b=0;b<ic.length;b++)ic[b].el.paper==a&&ic.splice(b--,1)}c.version="2.1.2",c.eve=b;var u,v,w=/[, ]+/,x={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},y=/\{(\d+)\}/g,z="hasOwnProperty",A={doc:document,win:a},B={was:Object.prototype[z].call(A.win,"Raphael"),is:A.win.Raphael},C=function(){this.ca=this.customAttributes={}},D="apply",E="concat",F="ontouchstart"in A.win||A.win.DocumentTouch&&A.doc instanceof DocumentTouch,G="",H=" ",I=String,J="split",K="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](H),L={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M=I.prototype.toLowerCase,N=Math,O=N.max,P=N.min,Q=N.abs,R=N.pow,S=N.PI,T="number",U="string",V="array",W=Object.prototype.toString,X=(c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},Z=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=N.round,_=parseFloat,ab=parseInt,bb=I.prototype.toUpperCase,cb=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},db=c._availableAnimAttrs={blur:T,"clip-rect":"csv",cx:T,cy:T,fill:"colour","fill-opacity":T,"font-size":T,height:T,opacity:T,path:"path",r:T,rx:T,ry:T,stroke:"colour","stroke-opacity":T,"stroke-width":T,transform:"transform",width:T,x:T,y:T},eb=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,fb={hs:1,rg:1},gb=/,?([achlmqrstvxz]),?/gi,hb=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ib=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,jb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,kb=(c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),lb=function(a,b){return _(a)-_(b)},nb=function(a){return a},ob=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},pb=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},qb=c._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)},set:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)}},rb=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(e=0,g=(a=Kb(a)).length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=A,c.type=A.win.SVGAngle||A.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){var sb,tb=A.doc.createElement("div");if(tb.innerHTML='<v:shape adj="1"/>',sb=tb.firstChild,sb.style.behavior="url(#default#VML)",!sb||"object"!=typeof sb.adj)return c.type=G;tb=null}c.svg=!(c.vml="VML"==c.type),c._Paper=C,c.fn=v=C.prototype=c.prototype,c._id=0,c._oid=0,c.is=function(a,b){return"finite"==(b=M.call(b))?!Y[z](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||W.call(a).slice(8,-1).toLowerCase()==b},c.angle=function(a,b,d,e,f,g){if(null==f){var h=a-d,i=b-e;return h||i?(180+180*N.atan2(-i,-h)/S+360)%360:0}return c.angle(a,b,f,g)-c.angle(d,e,f,g)},c.rad=function(a){return a%360*S/180},c.deg=function(a){return 180*a/S%360},c.snapTo=function(a,b,d){if(d=c.is(d,"finite")?d:10,c.is(a,V)){for(var e=a.length;e--;)if(Q(a[e]-b)<=d)return a[e]}else{var f=b%(a=+a);if(d>f)return b-f;if(f>a-d)return b-f+a}return b},c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*N.random()|0;return("x"==a?b:3&b|8).toString(16)}),c.setWindow=function(a){b("raphael.setWindow",c,A.win,a),A.win=a,A.doc=A.win.document,c._engine.initWin&&c._engine.initWin(A.win)};var ub=function(a){if(c.vml){var b,d=/^\s+|\s+$/g;try{var e=new ActiveXObject("htmlfile");e.write("<body>"),e.close(),b=e.body}catch(g){b=createPopup().document.body}var h=b.createTextRange();ub=f(function(a){try{b.style.color=I(a).replace(d,G);var c=h.queryCommandValue("ForeColor");return"#"+("000000"+(c=(255&c)<<16|65280&c|(16711680&c)>>>16).toString(16)).slice(-6)}catch(e){return"none"}})}else{var i=A.doc.createElement("i");i.title="Raphal Colour Picker",i.style.display="none",A.doc.body.appendChild(i),ub=f(function(a){return i.style.color=a,A.doc.defaultView.getComputedStyle(i,G).getPropertyValue("color")})}return ub(a)},vb=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},xb=function(){return this.hex},yb=function(a,b,d){if(null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,U)){var e=c.getRGB(a);a=e.r,b=e.g,d=e.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},zb=function(a,b,d,e){var f={r:a*=255,g:b*=255,b:d*=255,hex:c.rgb(a,b,d),toString:xb};return c.is(e,"finite")&&(f.opacity=e),f};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=xb,a},c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o);var e,f,g,h,i;return a=(a*=360)%360/60,i=c*b,h=i*(1-Q(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100);var e,f,g,h,i;return a=(a*=360)%360/60,i=2*b*(.5>c?c:1-c),h=i*(1-Q(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.rgb2hsb=function(a,b,c){a=(c=yb(a,b,c))[0],b=c[1],c=c[2];var d,e,f,g;return f=O(a,b,c),g=f-P(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6*60/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:vb}},c.rgb2hsl=function(a,b,c){a=(c=yb(a,b,c))[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=O(a,b,c),h=P(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6*60/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:wb}},c._path2string=function(){return this.join(",").replace(gb,"$1")},c._preload=function(a,b){var c=A.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,A.doc.body.removeChild(this)},c.onerror=function(){A.doc.body.removeChild(this)},A.doc.body.appendChild(c),c.src=a},c.getRGB=f(function(a){if(!a||(a=I(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!(fb[z](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=ub(a));var b,d,e,f,h,i,j=a.match(X);return j?(j[2]&&(e=ab(j[2].substring(5),16),d=ab(j[2].substring(3,5),16),b=ab(j[2].substring(1,3),16)),j[3]&&(e=ab((h=j[3].charAt(3))+h,16),d=ab((h=j[3].charAt(2))+h,16),b=ab((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100)),j[5]?(i=j[5][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||""==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsb2rgb(b,d,e,f)):j[6]?(i=j[6][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||""==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsl2rgb(b,d,e,f)):(j={r:b,g:d,b:e,toString:g},j.hex="#"+(16777216|e|d<<8|b<<16).toString(16).slice(1),c.is(f,"finite")&&(j.opacity=f),j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},c),c.hsb=f(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=f(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=f(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),c.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex},c.getColor.reset=function(){delete this.start},c.parsePathString=function(a){if(!a)return null;var b=Ab(a);if(b.arr)return Cb(b.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];return c.is(a,V)&&c.is(a[0],V)&&(e=Cb(a)),e.length||I(a).replace(hb,function(a,b,c){var f=[],g=b.toLowerCase();if(c.replace(jb,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b][E](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)e.push([b][E](f));else for(;f.length>=d[g]&&(e.push([b][E](f.splice(0,d[g]))),d[g]););}),e.toString=c._path2string,b.arr=Cb(e),e},c.parseTransformString=f(function(a){if(!a)return null;var b=[];return c.is(a,V)&&c.is(a[0],V)&&(b=Cb(a)),b.length||I(a).replace(ib,function(a,c,d){var e=[];M.call(c),d.replace(jb,function(a,b){b&&e.push(+b)}),b.push([c][E](e))}),b.toString=c._path2string,b});var Ab=function(a){var b=Ab.ps=Ab.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[z](c)&&c!=a&&(b[c].sleep--,!b[c].sleep&&delete b[c])}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/S;return(q>s||t>r)&&(y+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}},c.bezierBBox=function(a,b,d,e,f,g,h,i){c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]);var j=Jb.apply(null,a);return{x:j.min.x,y:j.min.y,x2:j.max.x,y2:j.max.y,width:j.max.x-j.min.x,height:j.max.y-j.min.y}},c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},c.pathIntersection=function(a,b){return n(a,b)},c.pathIntersectionNumber=function(a,b){return n(a,b,1)},c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&n(a,[["M",b,d],["H",e.x2+10]],1)%2==1},c._removedFactory=function(a){return function(){b("raphael.log",null,"Raphal: you are calling to method "+a+" of removed object",a)}};var Bb=c.pathBBox=function(a){var b=Ab(a);if(b.bbox)return d(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var c,e=0,f=0,g=[],h=[],i=0,j=(a=Kb(a)).length;j>i;i++)if("M"==(c=a[i])[0])e=c[1],f=c[2],g.push(e),h.push(f);else{var k=Jb(e,f,c[1],c[2],c[3],c[4],c[5],c[6]);g=g[E](k.min.x,k.max.x),h=h[E](k.min.y,k.max.y),e=c[5],f=c[6]}var l=P[D](0,g),m=P[D](0,h),n=O[D](0,g),o=O[D](0,h),p=n-l,q=o-m,r={x:l,y:m,x2:n,y2:o,width:p,height:q,cx:l+p/2,cy:m+q/2};return b.bbox=d(r),r},Cb=function(a){var b=d(a);return b.toString=c._path2string,b},Db=c._pathToRelative=function(a){var b=Ab(a);if(b.rel)return Cb(b.rel);c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f]));for(var j=i,k=a.length;k>j;j++){var l=d[j]=[],m=a[j];if(m[0]!=M.call(m[0]))switch(l[0]=M.call(m[0]),l[0]){case"a":l[1]=m[1],l[2]=m[2],l[3]=m[3],l[4]=m[4],l[5]=m[5],l[6]=+(m[6]-e).toFixed(3),l[7]=+(m[7]-f).toFixed(3);break;case"v":l[1]=+(m[1]-f).toFixed(3);break;case"m":g=m[1],h=m[2];default:for(var n=1,o=m.length;o>n;n++)l[n]=+(m[n]-(n%2?e:f)).toFixed(3)}else{l=d[j]=[],"m"==m[0]&&(g=m[1]+e,h=m[2]+f);for(var p=0,q=m.length;q>p;p++)d[j][p]=m[p]}var r=d[j].length;switch(d[j][0]){case"z":e=g,f=h;break;case"h":e+=+d[j][r-1];break;case"v":f+=+d[j][r-1];break;default:e+=+d[j][r-2],f+=+d[j][r-1]}}return d.toString=c._path2string,b.rel=Cb(d),d},Eb=c._pathToAbsolute=function(a){var b=Ab(a);if(b.abs)return Cb(b.abs);if(c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,g=0,i=0,j=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],g=e,i=f,j++,d[0]=["M",e,f]);for(var k,l,m=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),n=j,o=a.length;o>n;n++){if(d.push(k=[]),(l=a[n])[0]!=bb.call(l[0]))switch(k[0]=bb.call(l[0]),k[0]){case"A":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]+e),k[7]=+(l[7]+f);break;case"V":k[1]=+l[1]+f;break;case"H":k[1]=+l[1]+e;break;case"R":for(var p=[e,f][E](l.slice(1)),q=2,r=p.length;r>q;q++)p[q]=+p[q]+e,p[++q]=+p[q]+f;d.pop(),d=d[E](h(p,m));break;case"M":g=+l[1]+e,i=+l[2]+f;default:for(q=1,r=l.length;r>q;q++)k[q]=+l[q]+(q%2?e:f)}else if("R"==l[0])p=[e,f][E](l.slice(1)),d.pop(),d=d[E](h(p,m)),k=["R"][E](l.slice(-2));else for(var s=0,t=l.length;t>s;s++)k[s]=l[s];switch(k[0]){case"Z":e=g,f=i;break;case"H":e=k[1];break;case"V":f=k[1];break;case"M":g=k[k.length-2],i=k[k.length-1];default:e=k[k.length-2],f=k[k.length-1]}}return d.toString=c._path2string,b.abs=Cb(d),d},Fb=function(a,b,c,d){return[a,b,c,d,c,d]},Gb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Hb=function(a,b,c,d,e,g,h,i,j,k){var l,m=120*S/180,n=S/180*(+e||0),o=[],p=f(function(a,b,c){return{x:a*N.cos(c)-b*N.sin(c),y:a*N.sin(c)+b*N.cos(c)}});if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{a=(l=p(a,b,-n)).x,b=l.y,i=(l=p(i,j,-n)).x,j=l.y;var q=(N.cos(S/180*e),N.sin(S/180*e),(a-i)/2),r=(b-j)/2,s=q*q/(c*c)+r*r/(d*d);s>1&&(s=N.sqrt(s),c*=s,d*=s);var t=c*c,u=d*d,v=(g==h?-1:1)*N.sqrt(Q((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*c*r/d+(a+i)/2,x=v*-d*q/c+(b+j)/2,y=N.asin(((b-x)/d).toFixed(9)),z=N.asin(((j-x)/d).toFixed(9));y=w>a?S-y:y,z=w>i?S-z:z,0>y&&(y=2*S+y),0>z&&(z=2*S+z),h&&y>z&&(y-=2*S),!h&&z>y&&(z-=2*S)}var A=z-y;if(Q(A)>m){var B=z,C=i,D=j;z=y+m*(h&&z>y?1:-1),i=w+c*N.cos(z),j=x+d*N.sin(z),o=Hb(i,j,c,d,e,0,h,C,D,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),K=N.tan(A/4),L=4/3*c*K,M=4/3*d*K,O=[a,b],P=[a+L*G,b-M*F],R=[i+L*I,j-M*H],T=[i,j];if(P[0]=2*O[0]-P[0],P[1]=2*O[1]-P[1],k)return[P,R,T][E](o);for(var U=[],V=0,W=(o=[P,R,T][E](o).join()[J](",")).length;W>V;V++)U[V]=V%2?p(o[V-1],o[V],n).y:p(o[V],o[V+1],n).x;return U},Ib=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:R(j,3)*a+3*R(j,2)*i*c+3*j*i*i*e+R(i,3)*g,y:R(j,3)*b+3*R(j,2)*i*d+3*j*i*i*f+R(i,3)*h}},Jb=f(function(a,b,c,d,e,f,g,h){var i,j=e-2*c+a-(g-2*e+c),k=2*(c-a)-2*(e-c),l=a-c,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,o=[b,h],p=[a,g];return Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),j=f-2*d+b-(h-2*f+d),k=2*(d-b)-2*(f-d),l=b-d,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),{min:{x:P[D](0,p),y:P[D](0,o)},max:{x:O[D](0,p),y:O[D](0,o)}}}),Kb=c._path2curve=f(function(a,b){var c=!b&&Ab(a);if(!b&&c.curve)return Cb(c.curve);for(var d=Eb(a),e=b&&Eb(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=function(a,b,c){var d,e,f={T:1,Q:1};if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in f)&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][E](Hb[D](0,[b.x,b.y][E](a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e][E](a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"][E](Gb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][E](Gb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][E](Fb(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][E](Fb(b.x,b.y,a[1],b.y));break;case"V":a=["C"][E](Fb(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][E](Fb(b.x,b.y,b.X,b.Y))}return a},i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][E](c.splice(0,6)));a.splice(b,1),l=O(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=O(d.length,e&&e.length||0))},k=0,l=O(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2],f.y=m[o-1],f.bx=_(m[o-4])||f.x,f.by=_(m[o-3])||f.y,g.bx=e&&(_(n[p-4])||g.x),g.by=e&&(_(n[p-3])||g.y),g.x=e&&n[p-2],g.y=e&&n[p-1]}return e||(c.curve=Cb(d)),e?[d,e]:d},null,Cb),Lb=(c._parseDots=f(function(a){for(var b=[],d=0,e=a.length;e>d;d++){var f={},g=a[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex,g[2]&&(f.offset=g[2]+"%"),b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(var h=_(b[d-1].offset||0),i=0,j=d+1;e>j;j++)if(b[j].offset){i=b[j].offset;break}i||(i=100,j=e);for(var k=((i=_(i))-h)/(j-d+1);j>d;d++)h+=k,b[d].offset=h+"%"}return b}),c._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)}),Mb=(c._tofront=function(a,b){b.top!==a&&(Lb(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Lb(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Lb(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},c._insertbefore=function(a,b,c){Lb(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b},c.toMatrix=function(a,b){var c=Bb(a),d={_:{transform:G},getBBox:function(){return c}};return Nb(d,b),d.matrix}),Nb=(c.transformPath=function(a,b){return rb(a,Mb(a,b))},c._extractTransform=function(a,b){if(null==b)return a._.transform;b=I(b).replace(/\.{3}|\u2026/g,a._.transform||G);var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,k=new o;if(j.transform=d||[],d)for(var l=0,m=d.length;m>l;l++){var n,p,q,r,s,t=d[l],u=t.length,v=I(t[0]).toLowerCase(),w=t[0]!=v,x=w?k.invert():0;"t"==v&&3==u?w?(n=x.x(0,0),p=x.y(0,0),q=x.x(t[1],t[2]),r=x.y(t[1],t[2]),k.translate(q-n,r-p)):k.translate(t[1],t[2]):"r"==v?2==u?(s=s||a.getBBox(1),k.rotate(t[1],s.x+s.width/2,s.y+s.height/2),e+=t[1]):4==u&&(w?(q=x.x(t[2],t[3]),r=x.y(t[2],t[3]),k.rotate(t[1],q,r)):k.rotate(t[1],t[2],t[3]),e+=t[1]):"s"==v?2==u||3==u?(s=s||a.getBBox(1),k.scale(t[1],t[u-1],s.x+s.width/2,s.y+s.height/2),h*=t[1],i*=t[u-1]):5==u&&(w?(q=x.x(t[3],t[4]),r=x.y(t[3],t[4]),k.scale(t[1],t[2],q,r)):k.scale(t[1],t[2],t[3],t[4]),h*=t[1],i*=t[2]):"m"==v&&7==u&&k.add(t[1],t[2],t[3],t[4],t[5],t[6]),j.dirtyT=1,a.matrix=k}a.matrix=k,j.sx=h,j.sy=i,j.deg=e,j.dx=f=k.e,j.dy=g=k.f,1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1}),Ob=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Pb=c._equaliseTransform=function(a,b){b=I(b).replace(/\.{3}|\u2026/g,a),a=c.parseTransformString(a)||[],b=c.parseTransformString(b)||[];for(var d,e,f,g,h=O(a.length,b.length),i=[],j=[],k=0;h>k;k++){if(f=a[k]||Ob(b[k]),g=b[k]||Ob(f),f[0]!=g[0]||"r"==f[0].toLowerCase()&&(f[2]!=g[2]||f[3]!=g[3])||"s"==f[0].toLowerCase()&&(f[3]!=g[3]||f[4]!=g[4]))return;for(i[k]=[],j[k]=[],d=0,e=O(f.length,g.length);e>d;d++)d in f&&(i[k][d]=f[d]),d in g&&(j[k][d]=g[d])}return{from:i,to:j}};c._getContainer=function(a,b,d,e){var f;return null!=(f=null!=e||c.is(a,"object")?a:A.doc.getElementById(a))?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0},c.pathToRelative=Db,c._engine={},c.path2curve=Kb,c.matrix=function(a,b,c,d,e,f){return new o(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=N.sqrt(b(a));a[0]&&(a[0]/=c),a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var g,h,i,j,k=[[],[],[]],l=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],m=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof o&&(m=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),g=0;3>g;g++)for(h=0;3>h;h++){for(j=0,i=0;3>i;i++)j+=l[g][i]*m[i][h];k[g][h]=j}this.a=k[0][0],this.b=k[1][0],this.c=k[0][1],this.d=k[1][1],this.e=k[0][2],this.f=k[1][2]},a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new o(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)},a.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,d){a=c.rad(a),b=b||0,d=d||0;var e=+N.cos(a).toFixed(9),f=+N.sin(a).toFixed(9);this.add(e,f,-f,e,b,d),this.add(1,0,0,1,-b,-d)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[I.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];a.scalex=N.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=N.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley;var f=-e[0][1],g=e[1][1];return 0>g?(a.rotate=c.deg(N.acos(g)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(N.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){var b=a||this[J]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:G)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:G)+(b.rotate?"r"+[b.rotate,0,0]:G)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(o.prototype);var Qb=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);v.safari="Apple Computer, Inc."==navigator.vendor&&(Qb&&Qb[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Qb&&Qb[1]<8?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:function(){};for(var Rb=function(){this.returnValue=!1},Sb=function(){return this.originalEvent.preventDefault()},Tb=function(){this.cancelBubble=!0},Ub=function(){return this.originalEvent.stopPropagation()},Vb=function(a){var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,c=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;return{x:a.clientX+c,y:a.clientY+b}},Wb=A.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=Vb(a);return c.call(d,a,b.x,b.y)};if(a.addEventListener(b,e,!1),F&&L[b]){a.addEventListener(L[b],function(b){for(var e=Vb(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){(b=b.targetTouches[g]).originalEvent=f,b.preventDefault=Sb,b.stopPropagation=Ub;break}return c.call(d,b,e.x,e.y)},!1)}return function(){return a.removeEventListener(b,e,!1),F&&L[b]&&a.removeEventListener(L[b],e,!1),!0}}:A.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||A.win.event;var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,e=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||Rb,a.stopPropagation=a.stopPropagation||Tb,c.call(d,a,f,g)};a.attachEvent("on"+b,e);return function(){return a.detachEvent("on"+b,e),!0}}:void 0,Xb=[],Yb=function(a){for(var c,d=a.clientX,e=a.clientY,f=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,g=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,h=Xb.length;h--;){if(c=Xb[h],F&&a.touches){for(var i,j=a.touches.length;j--;)if((i=a.touches[j]).identifier==c.el._drag.id){d=i.clientX,e=i.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var k,l=c.el.node,m=l.nextSibling,n=l.parentNode,o=l.style.display;A.win.opera&&n.removeChild(l),l.style.display="none",k=c.el.paper.getElementByPoint(d,e),l.style.display=o,A.win.opera&&(m?n.insertBefore(l,m):n.appendChild(l)),k&&b("raphael.drag.over."+c.el.id,c.el,k),d+=g,e+=f,b("raphael.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},Zb=function(a){c.unmousemove(Yb).unmouseup(Zb);for(var d,e=Xb.length;e--;)d=Xb[e],d.el._drag={},b("raphael.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,a);Xb=[]},$b=c.el={},_b=K.length;_b--;)!function(a){c[a]=$b[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Wb(this.shape||this.node||A.doc,a,b,d||this)})),this},c["un"+a]=$b["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name!=a||!c.is(b,"undefined")&&d[e].f!=b||(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(K[_b]);$b.data=function(a,d){var e=kb[this.id]=kb[this.id]||{};if(0==arguments.length)return e;if(1==arguments.length){if(c.is(a,"object")){for(var f in a)a[z](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this},$b.removeData=function(a){return null==a?kb[this.id]={}:kb[this.id]&&delete kb[this.id][a],this},$b.getData=function(){return d(kb[this.id]||{})},$b.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},$b.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var ac=[];$b.drag=function(a,d,e,f,g,h){function i(i){(i.originalEvent||i).preventDefault();var j=i.clientX,k=i.clientY,l=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,m=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;if(this._drag.id=i.identifier,F&&i.touches)for(var n,o=i.touches.length;o--;)if(n=i.touches[o],this._drag.id=n.identifier,n.identifier==this._drag.id){j=n.clientX,k=n.clientY;break}this._drag.x=j+m,this._drag.y=k+l,!Xb.length&&c.mousemove(Yb).mouseup(Zb),Xb.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("raphael.drag.start."+this.id,d),a&&b.on("raphael.drag.move."+this.id,a),e&&b.on("raphael.drag.end."+this.id,e),b("raphael.drag.start."+this.id,g||f||this,i.clientX+m,i.clientY+l,i)}return this._drag={},ac.push({el:this,start:i}),this.mousedown(i),this},$b.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)},$b.undrag=function(){for(var a=ac.length;a--;)ac[a].el==this&&(this.unmousedown(ac[a].start),ac.splice(a,1),b.unbind("raphael.drag.*."+this.id));!ac.length&&c.unmousemove(Yb).unmouseup(Zb),Xb=[]},v.circle=function(a,b,d){var e=c._engine.circle(this,a||0,b||0,d||0);return this.__set__&&this.__set__.push(e),e},v.rect=function(a,b,d,e,f){var g=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.ellipse=function(a,b,d,e){var f=c._engine.ellipse(this,a||0,b||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},v.path=function(a){a&&!c.is(a,U)&&!c.is(a[0],V)&&(a+=G);var b=c._engine.path(c.format[D](c,arguments),this);return this.__set__&&this.__set__.push(b),b},v.image=function(a,b,d,e,f){var g=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.text=function(a,b,d){var e=c._engine.text(this,a||0,b||0,I(d));return this.__set__&&this.__set__.push(e),e},v.set=function(a){!c.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new mc(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b},v.setStart=function(a){this.__set__=a||this.set()},v.setFinish=function(){var a=this.__set__;return delete this.__set__,a},v.setSize=function(a,b){return c._engine.setSize.call(this,a,b)},v.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)},v.top=v.bottom=null,v.raphael=c;var bc=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0;return{y:b.top+(A.win.pageYOffset||e.scrollTop||d.scrollTop)-f,x:b.left+(A.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g}};v.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=A.doc.elementFromPoint(a,b);if(A.win.opera&&"svg"==e.tagName){var f=bc(d),g=d.createSVGRect();g.x=a-f.x,g.y=b-f.y,g.width=g.height=1;var h=d.getIntersectionList(g,null);h.length&&(e=h[h.length-1])}if(!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null},v.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b},v.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},v.forEach=function(a,b){for(var c=this.bottom;c;){if(!1===a.call(b,c))return this;c=c.next}return this},v.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},$b.isPointInside=function(a,b){var d=this.realPath=qb[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=c.transformPath(d,this.attr("transform"))),c.isPointInsidePath(d,a,b)},$b.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=qb[this.type](this),b.bboxwt=Bb(this.realPath),b.bboxwt.toString=p,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=qb[this.type](this)),b.bbox=Bb(rb(this.realPath,this.matrix)),b.bbox.toString=p,b.dirty=b.dirtyT=0),b.bbox)},$b.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},$b.glow=function(a){if("text"==this.type)return null;var b={width:((a=a||{}).width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||qb[this.type](this);f=this.matrix?rb(f,this.matrix):f;for(var g=1;c+1>g;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var cc=function(a,b,d,e,f,g,h,i,l){return null==l?j(a,b,d,e,f,g,h,i):c.findDotsAtSegment(a,b,d,e,f,g,h,i,k(a,b,d,e,f,g,h,i,l))},dc=function(a,b){return function(d,e,f){for(var g,h,i,j,k,l="",m={},n=0,o=0,p=(d=Kb(d)).length;p>o;o++){if("M"==(i=d[o])[0])g=+i[1],h=+i[2];else{if(j=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),n+j>e){if(b&&!m.start){if(k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),l+=["C"+k.start.x,k.start.y,k.m.x,k.m.y,k.x,k.y],f)return l;m.start=l,l=["M"+k.x,k.y+"C"+k.n.x,k.n.y,k.end.x,k.end.y,i[5],i[6]].join(),n+=j,g=+i[5],h=+i[6];continue}if(!a&&!b)return k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),{x:k.x,y:k.y,alpha:k.alpha}}n+=j,g=+i[5],h=+i[6]}l+=i.shift()+i}return m.end=l,(k=a?n:b?m:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1)).alpha&&(k={x:k.x,y:k.y,alpha:k.alpha}),k}},ec=dc(1),fc=dc(),gc=dc(0,1);c.getTotalLength=ec,c.getPointAtLength=fc,c.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return gc(a,b).end;var d=gc(a,c,1);return b?gc(d,b).end:d},$b.getTotalLength=function(){var a=this.getPath();if(a)return this.node.getTotalLength?this.node.getTotalLength():ec(a)},$b.getPointAtLength=function(a){var b=this.getPath();if(b)return fc(b,a)},$b.getPath=function(){var a,b=c._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return b&&(a=b(this)),a},$b.getSubpath=function(a,b){var d=this.getPath();if(d)return c.getSubpath(d,a,b)};var hc=c.easing_formulas={linear:function(a){return a},"<":function(a){return R(a,1.7)},">":function(a){return R(a,.48)},"<>":function(a){var b=.48-a/1.04,c=N.sqrt(.1734+b*b),d=c-b,f=-c-b,h=R(Q(d),1/3)*(0>d?-1:1)+R(Q(f),1/3)*(0>f?-1:1)+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:R(2,-10*a)*N.sin(2*(a-.075)*S/.3)+1},bounce:function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b}};hc.easeIn=hc["ease-in"]=hc["<"],hc.easeOut=hc["ease-out"]=hc[">"],hc.easeInOut=hc["ease-in-out"]=hc["<>"],hc["back-in"]=hc.backIn,hc["back-out"]=hc.backOut;var ic=[],jc=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},kc=function(){for(var a=+new Date,d=0;d<ic.length;d++){var e=ic[d];if(!e.el.removed&&!e.paused){var f,g,h=a-e.start,i=e.ms,j=e.easing,k=e.from,l=e.diff,m=e.to,n=(e.t,e.el),o={},p={};if(e.initstatus?(h=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*i,e.status=e.initstatus,delete e.initstatus,e.stop&&ic.splice(d--,1)):e.status=(e.prev+(e.percent-e.prev)*(h/i))/e.anim.top,!(0>h))if(i>h){var q=j(h/i);for(var r in k)if(k[z](r)){switch(db[r]){case T:f=+k[r]+q*i*l[r];break;case"colour":f="rgb("+[lc($(k[r].r+q*i*l[r].r)),lc($(k[r].g+q*i*l[r].g)),lc($(k[r].b+q*i*l[r].b))].join(",")+")";break;case"path":f=[];for(var t=0,u=k[r].length;u>t;t++){f[t]=[k[r][t][0]];for(var v=1,w=k[r][t].length;w>v;v++)f[t][v]=+k[r][t][v]+q*i*l[r][t][v];f[t]=f[t].join(H)}f=f.join(H);break;case"transform":if(l[r].real)for(f=[],t=0,u=k[r].length;u>t;t++)for(f[t]=[k[r][t][0]],v=1,w=k[r][t].length;w>v;v++)f[t][v]=k[r][t][v]+q*i*l[r][t][v];else{var x=function(a){return+k[r][a]+q*i*l[r][a]};f=[["m",x(0),x(1),x(2),x(3),x(4),x(5)]]}break;case"csv":if("clip-rect"==r)for(f=[],t=4;t--;)f[t]=+k[r][t]+q*i*l[r][t];break;default:var y=[][E](k[r]);for(f=[],t=n.paper.customAttributes[r].length;t--;)f[t]=+y[t]+q*i*l[r][t]}o[r]=f}n.attr(o),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e),b("raphael.anim.finish."+d.id,d,e),c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(m),ic.splice(d--,1),e.repeat>1&&!e.next){for(g in m)m[z](g)&&(p[g]=e.totalOrigin[g]);e.el.attr(p),s(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&s(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}c.svg&&n&&n.paper&&n.paper.safari(),ic.length&&jc(kc)},lc=function(a){return a>255?255:0>a?0:a};$b.animateWith=function(a,b,d,e,f,g){var h=this;if(h.removed)return g&&g.call(h),h;var i=d instanceof r?d:c.animation(d,e,f,g);s(i,h,i.percents[0],null,h.attr());for(var j=0,k=ic.length;k>j;j++)if(ic[j].anim==b&&ic[j].el==a){ic[k-1].start=ic[j].start;break}return h},$b.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this},r.prototype.delay=function(a){var b=new r(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},r.prototype.repeat=function(a){var b=new r(this.anim,this.ms);return b.del=this.del,b.times=N.floor(O(a,0))||1,b},c.animation=function(a,b,d,e){if(a instanceof r)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null),a=Object(a),b=+b||0;var f,g,h={};for(g in a)a[z](g)&&_(g)!=g&&_(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new r({100:h},b)):new r(a,b)},$b.animate=function(a,b,d,e){var f=this;if(f.removed)return e&&e.call(f),f;var g=a instanceof r?a:c.animation(a,b,d,e);return s(g,f,g.percents[0],null,f.attr()),f},$b.setTime=function(a,b){return a&&null!=b&&this.status(a,P(b,a.ms)/a.ms),this},$b.status=function(a,b){var c,d,e=[],f=0;if(null!=b)return s(a,this,-1,P(b,1)),this;for(c=ic.length;c>f;f++)if((d=ic[f]).el.id==this.id&&(!a||d.anim==a)){if(a)return d.status;e.push({anim:d.anim,status:d.status})}return a?0:e},$b.pause=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||!1!==b("raphael.anim.pause."+this.id,this,ic[c].anim)&&(ic[c].paused=!0);return this},$b.resume=function(a){for(var c=0;c<ic.length;c++)if(ic[c].el.id==this.id&&(!a||ic[c].anim==a)){var d=ic[c];!1!==b("raphael.anim.resume."+this.id,this,d.anim)&&(delete d.paused,this.status(d.anim,d.status))}return this},$b.stop=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||!1!==b("raphael.anim.stop."+this.id,this,ic[c].anim)&&ic.splice(c--,1);return this},b.on("raphael.remove",t),b.on("raphael.clear",t),$b.toString=function(){return"Raphals object"};var mc=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)!a[b]||a[b].constructor!=$b.constructor&&a[b].constructor!=mc||(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},nc=mc.prototype;nc.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)!(a=arguments[c])||a.constructor!=$b.constructor&&a.constructor!=mc||(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},nc.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},nc.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(!1===a.call(b,this.items[c],c))return this;return this};for(var oc in $b)$b[z](oc)&&(nc[oc]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][D](c,b)})}}(oc));return nc.attr=function(a,b){if(a&&c.is(a,V)&&c.is(a[0],"object"))for(var d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(var f=0,g=this.items.length;g>f;f++)this.items[f].attr(a,b);return this},nc.clear=function(){for(;this.length;)this.pop()},nc.splice=function(a,b){a=0>a?O(this.length+a,0):a,b=O(0,P(this.length-a,b));var c,d=[],e=[],f=[];for(c=2;c<arguments.length;c++)f.push(arguments[c]);for(c=0;b>c;c++)e.push(this[a+c]);for(;c<this.length-a;c++)d.push(this[a+c]);var g=f.length;for(c=0;c<g+d.length;c++)this.items[a+c]=this[a+c]=g>c?f[c]:d[c-g];for(c=this.items.length=this.length-=b-g;this[c];)delete this[c++];return new mc(e)},nc.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},nc.animate=function(a,b,d,e){(c.is(d,"function")||!d)&&(e=d||null);var f,g,h=this.items.length,i=h,j=this;if(!h)return this;e&&(g=function(){!--h&&e.call(j)}),d=c.is(d,U)?d:g;var k=c.animation(a,b,d,g);for(f=this.items[--i].animate(k);i--;)this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(f,k,k),this.items[i]&&!this.items[i].removed||h--;return this},nc.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},nc.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=P[D](0,a),b=P[D](0,b),c=O[D](0,c),d=O[D](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},nc.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},nc.toString=function(){return"Raphals set"},nc.glow=function(a){var b=this.paper.set();return this.forEach(function(c){var d=c.glow(a);null!=d&&d.forEach(function(a){b.push(a)})}),b},nc.isPointInside=function(a,b){var c=!1;return this.forEach(function(d){return d.isPointInside(a,b)?(c=!0,!1):void 0}),c},c.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[z](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=ab(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[z](e)){var f=a.glyphs[e];if(b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k)for(var g in f.k)f[z](g)&&(b.glyphs[e].k[g]=f.k[g])}}return a},v.getFont=function(a,b,d,e){if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){var f=c.fonts[a];if(!f){var g=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,G)+"(\\s|$)","i");for(var h in c.fonts)if(c.fonts[z](h)&&g.test(h)){f=c.fonts[h];break}}var i;if(f)for(var j=0,k=f.length;k>j&&((i=f[j]).face["font-weight"]!=b||i.face["font-style"]!=d&&i.face["font-style"]||i.face["font-stretch"]!=e);j++);return i}},v.print=function(a,b,d,e,f,g,h,i){g=g||"middle",h=O(P(h||0,1),-1),i=O(P(i||1,3),1);var j,k=I(d)[J](G),l=0,m=0,n=G;if(c.is(e,"string")&&(e=this.getFont(e)),e){j=(f||16)/e.face["units-per-em"];for(var o=e.face.bbox[J](w),p=+o[0],q=o[3]-o[1],r=0,s=+o[1]+("baseline"==g?q+ +e.face.descent:q/2),t=0,u=k.length;u>t;t++){if("\n"==k[t])l=0,x=0,m=0,r+=q*i;else{var v=m&&e.glyphs[k[t-1]]||{},x=e.glyphs[k[t]];l+=m?(v.w||e.w)+(v.k&&v.k[k[t]]||0)+e.w*h:0,m=1}x&&x.d&&(n+=c.transformPath(x.d,["t",l*j,r*j,"s",j,j,p,s,"t",(a-p)/j,(b-s)/j]))}}return this.path(n).attr({fill:"#000",stroke:"none"})},v.add=function(a){if(c.is(a,"array"))for(var b,d=this.set(),e=0,f=a.length;f>e;e++)b=a[e]||{},x[z](b.type)&&d.push(this[b.type]().attr(b));return d},c.format=function(a,b){var d=c.is(b,V)?[0][E](b):arguments;return a&&c.is(a,U)&&d.length-1&&(a=a.replace(y,function(a,b){return null==d[++b]?G:d[b]})),a||G},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return B.was?A.win.Raphael=B.is:delete Raphael,c},c.st=nc,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1),a.readyState="complete"},!1),a.readyState="loading"),e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){u=!0}),function(){if(c.svg){var a="hasOwnProperty",b=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=c.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};c.toString=function(){return"Your browser supports SVG.\nYou are running Raphal "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[a](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),b(e[f])):d.setAttribute(f,b(e[f])))}else(d=c._g.doc.createElementNS("http://www.w3.org/2000/svg",d)).style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(a,e){var j="linear",k=a.id+e,m=.5,n=.5,o=a.node,p=a.paper,r=o.style,s=c._g.doc.getElementById(k);if(!s){if(e=b(e).replace(c._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b);var e=2*((n=d(c))>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){var t=e.shift();if(t=-d(t),isNaN(t))return null;var u=[0,0,f.cos(c.rad(t)),f.sin(c.rad(t))],v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v,u[3]*=v,u[2]<0&&(u[0]=-u[2],u[2]=0),u[3]<0&&(u[1]=-u[3],u[3]=0)}var w=c._parseDots(e);if(!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),a.gradient&&k!=a.gradient.id&&(p.defs.removeChild(a.gradient),delete a.gradient),!a.gradient){s=q(j+"Gradient",{id:k}),a.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:a.matrix.invert()}),p.defs.appendChild(s);for(var x=0,y=w.length;y>x;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){if("path"==d.type){for(var g,h,i,j,k,m=b(e).toLowerCase().split("-"),n=d.paper,r=f?"end":"start",s=d.node,t=d.attrs,u=t["stroke-width"],v=m.length,w="classic",x=3,y=3,z=5;v--;)switch(m[v]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=m[v];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}if("open"==w?(x+=2,y+=2,z+=2,i=1,j=f?4:1,k={fill:"none",stroke:t.stroke}):(j=i=x/2,k={fill:t.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=w){var A="raphael-marker-"+w,B="raphael-marker-"+r+w+x+y;c._g.doc.getElementById(A)?p[A]++:(n.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[w],id:A})),p[A]=1);var C,D=c._g.doc.getElementById(B);D?(p[B]++,C=D.getElementsByTagName("use")[0]):(D=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:j,refY:y/2}),C=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(1/((x/z+y/z)/2)).toFixed(4)}),D.appendChild(C),n.defs.appendChild(D),p[B]=1),q(C,k);var E=i*("diamond"!=w&&"oval"!=w);f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-E*u):(g=E*u,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),(k={})["marker-"+r]="url(#"+B+")",(h||g)&&(k.d=c.getSubpath(t.path,g,h)),q(s,k),d._.arrows[r+"Path"]=A,d._.arrows[r+"Marker"]=B,d._.arrows[r+"dx"]=E,d._.arrows[r+"Type"]=w,d._.arrows[r+"String"]=e}else f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-g):(g=0,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),d._.arrows[r+"Path"]&&q(s,{d:c.getSubpath(t.path,g,h)}),delete d._.arrows[r+"Path"],delete d._.arrows[r+"Marker"],delete d._.arrows[r+"dx"],delete d._.arrows[r+"Type"],delete d._.arrows[r+"String"];for(k in p)if(p[a](k)&&!p[k]){var F=c._g.doc.getElementById(k);F&&F.parentNode.removeChild(F)}}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=u[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=c.length;h--;)g[h]=c[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility;i.style.visibility="hidden";for(var o in f)if(f[a](o)){if(!c._availableAttrs[a](o))continue;var p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"title":var u=i.getElementsByTagName("title");if(u.length&&(u=u[0]))u.firstChild.nodeValue=p;else{u=q("title");var w=c._g.doc.createTextNode(p);u.appendChild(w),i.appendChild(u)}break;case"href":case"target":var x=i.parentNode;if("a"!=x.tagName.toLowerCase()){var z=q("a");x.insertBefore(z,i),z.appendChild(i),x=z}"target"==o?x.setAttributeNS(n,"show","blank"==p?"new":p):x.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":var A=b(p).split(j);if(4==A.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var B=q("clipPath"),C=q("rect");B.id=c.createUUID(),q(C,{x:A[0],y:A[1],width:A[2],height:A[3]}),B.appendChild(C),d.paper.defs.appendChild(B),q(i,{"clip-path":"url(#"+B.id+")"}),d.clip=C}if(!p){var D=i.getAttribute("clip-path");if(D){var E=c._g.doc.getElementById(D.replace(/(^url\(#|\)$)/g,l));E&&E.parentNode.removeChild(E),q(i,{"clip-path":l}),delete d.clip}}break;case"path":"path"==d.type&&(q(i,{d:p?k.path=c._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x",p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y",p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p),d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":(1!=d._.sx||1!=d._.sy)&&(p/=g(h(d._.sx),h(d._.sy))||1),d.paper._vbSize&&(p*=d.paper._vbSize),i.setAttribute(o,p),k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f),d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":var F=b(p).match(c._ISURL);if(F){B=q("pattern");var G=q("image");B.id=c.createUUID(),q(B,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),q(G,{x:0,y:0,"xlink:href":F[1]}),B.appendChild(G),function(a){c._preload(F[1],function(){var b=this.offsetWidth,c=this.offsetHeight;q(a,{width:b,height:c}),q(G,{width:b,height:c}),d.paper.safari()})}(B),d.paper.defs.appendChild(B),q(i,{fill:"url(#"+B.id+")"}),d.pattern=B,d.pattern&&s(d);break}var H=c.getRGB(p);if(H.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p)){if("opacity"in k||"fill-opacity"in k){var I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));if(I){var J=I.getElementsByTagName("stop");q(J[J.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})}}k.gradient=p,k.fill="none";break}}else delete f.gradient,delete k.gradient,!c.is(k.opacity,"undefined")&&c.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!c.is(k["fill-opacity"],"undefined")&&c.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});H[a]("opacity")&&q(i,{"fill-opacity":H.opacity>1?H.opacity/100:H.opacity});case"stroke":H=c.getRGB(p),i.setAttribute(o,H.hex),"stroke"==o&&H[a]("opacity")&&q(i,{"stroke-opacity":H.opacity>1?H.opacity/100:H.opacity}),"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[a]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){(I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)))&&(J=I.getElementsByTagName("stop"),q(J[J.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");var K=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[K]=p,d._.dirty=1,i.setAttribute(o,p)}}y(d,f),i.style.visibility=m},y=function(d,f){if("text"==d.type&&(f[a]("text")||f[a]("font")||f[a]("font-size")||f[a]("x")||f[a]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(c._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;if(f[a]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var j,k=b(f.text).split("\n"),m=[],n=0,o=k.length;o>n;n++)j=q("tspan"),n&&q(j,{dy:1.2*i,x:g.x}),j.appendChild(c._g.doc.createTextNode(k[n])),h.appendChild(j),m[n]=j}else for(m=h.getElementsByTagName("tspan"),n=0,o=m.length;o>n;n++)n?q(m[n],{dy:1.2*i,x:g.x}):q(m[0],{dy:0});q(h,{x:g.x,y:g.y}),d._.dirty=1;var p=d._getBBox(),r=g.y-(p.y+p.height/2);r&&c.is(r,"finite")&&q(m[0],{dy:r})}},z=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.matrix=c.matrix(),this.realPath=null,this.paper=b,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},A=c.el;z.prototype=A,A.constructor=z,c._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);var d=new z(c,b);return d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d},A.rotate=function(a,c,e){if(this.removed)return this;if((a=b(a).split(j)).length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,c,e]])),this},A.scale=function(a,c,e,f){if(this.removed)return this;if((a=b(a).split(j)).length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this},A.translate=function(a,c){return this.removed?this:((a=b(a).split(j)).length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",a,c]])),this)},A.transform=function(b){var d=this._;if(null==b)return d.transform;if(c._extractTransform(this,b),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy){var e=this.attrs[a]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},A.remove=function(){if(!this.removed&&this.node.parentNode){var a=this.paper;a.__set__&&a.__set__.exclude(this),k.unbind("raphael.*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),c._tear(this,a),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}},A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b},A.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;for(var g=b.split(j),h={},i=0,l=g.length;l>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return l-1?h:h[g[0]]}if(null==d&&c.is(b,"array")){for(h={},i=0,l=b.length;l>i;i++)h[b[i]]=this.attr(b[i]);return h}if(null!=d){var m={};m[b]=d}else null!=b&&c.is(b,"object")&&(m=b);for(var n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[a](n)&&m[a](n)&&c.is(this.paper.customAttributes[n],"function")){var o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(var p in o)o[a](p)&&(m[p]=o[p])}return w(this,m),this},A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this},A.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;return"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper),this.paper,this},A.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this},A.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this},A.blur=function(a){var b=this;if(0!=+a){var d=q("filter"),e=q("feGaussianBlur");b.attrs.blur=a,d.id=c.createUUID(),q(e,{stdDeviation:+a||1.5}),d.appendChild(e),b.paper.defs.appendChild(d),b._blur=d,q(b.node,{filter:"url(#"+d.id+")"})}else b._blur&&(b._blur.parentNode.removeChild(b._blur),delete b._blur,delete b.attrs.blur),b.node.removeAttribute("filter");return b},c._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);var f=new z(e,a);return f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f},c._engine.rect=function(a,b,c,d,e,f){var g=q("rect");a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h},c._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g},c._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h},c._engine.text=function(a,b,d,e){var f=q("text");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g},c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,g=a.height;if(!b)throw new Error("SVG container not found.");var h,i=q("svg"),j="overflow:hidden;";return d=d||0,e=e||0,f=f||512,g=g||342,q(i,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==b?(i.style.cssText=j+"position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(i),h=1):(i.style.cssText=j+"position:relative",b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i)),b=new c._Paper,b.width=f,b.height=g,b.canvas=i,b.clear(),b._left=b._top=0,h&&(b.renderfix=function(){}),b.renderfix(),b},c._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var f,h,i=g(c/this.width,d/this.height),j=this.top,l=e?"xMidYMid meet":"xMinYMin";for(null==a?(this._vbSize&&(i=1),delete this._vbSize,f="0 0 "+this.width+m+this.height):(this._vbSize=i,f=a+m+b+m+c+m+d),q(this.canvas,{viewBox:f,preserveAspectRatio:l});i&&j;)h="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":h}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[a,b,c,d,!!e],this},c.prototype.renderfix=function(){var a,b=this.canvas,c=b.style;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(d){a=b.createSVGMatrix()}var e=-a.e%1,f=-a.f%1;(e||f)&&(e&&(this._left=(this._left+e)%1,c.left=this._left+"px"),f&&(this._top=(this._top+f)%1,c.top=this._top+"px"))},c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null,(this.desc=q("desc")).appendChild(c._g.doc.createTextNode("Created with Raphal "+c.version)),a.appendChild(this.desc),a.appendChild(this.defs=q("defs"))},c.prototype.remove=function(){k("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};var B=c.st;for(var C in A)A[a](C)&&!B[a](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}}(),function(){if(c.vml){var a="hasOwnProperty",b=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=c.eve,n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(a){var d=/[ahqstv]/gi,e=c._pathToAbsolute;if(b(a).match(d)&&(e=c._path2curve),d=/[clmz]/g,e==c._pathToAbsolute&&!b(a).match(d)){var g=b(a).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]),d.push(f(a*u))}),g+d});return g}var h,i,j=e(a);g=[];for(var k=0,l=j.length;l>k;k++){h=j[k],"z"==(i=j[k][0].toLowerCase())&&(i="x");for(var m=1,r=h.length;r>m;m++)i+=f(h[m]*u)+(m!=r-1?",":o);g.push(i)}return g.join(n)},y=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",q=u/b,r=u/c;if(m.visibility="hidden",b&&c){if(l.coordsize=i(q)+n+i(r),m.rotation=f*(0>b*c?-1:1),f){var s=y(f,d,e);d=s.dx,e=s.dy}if(0>b&&(p+="x"),0>c&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-q+n+e*-r,k||g.fillsize){var t=l.getElementsByTagName(j);t=t&&t[0],l.removeChild(t),k&&(s=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),t.position=s.dx*o+n+s.dy*o),g.fillsize&&(t.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(t)}m.visibility="visible"}};c.toString=function(){return"Your browser doesnt support SVG. Falling down to VML.\nYou are running Raphal "+this.version};var A=function(a,c,d){for(var e=b(c).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}var k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h,k[f+"arrowlength"]=i,k[f+"arrowwidth"]=j},B=function(e,i){e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,q=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),r=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),s=e;for(var t in i)i[a](t)&&(m[t]=i[t]);if(q&&(m.path=c._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||q)&&(l.path=x(~b(m.path).toLowerCase().indexOf("r")?c._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),r){var y=+m.cx,B=+m.cy,D=+m.rx||+m.r||0,E=+m.ry||+m.r||0;l.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((y-D)*u),f((B-E)*u),f((y+D)*u),f((B+E)*u),f(y*u)),e._.dirty=1}if("clip-rect"in i){var G=b(i["clip-rect"]).split(k);if(4==G.length){G[2]=+G[2]+ +G[0],G[3]=+G[3]+ +G[1];var H=l.clipRect||c._g.doc.createElement("div"),I=H.style;I.clip=c.format("rect({1}px {2}px {3}px {0}px)",G),l.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=e.paper.width+"px",I.height=e.paper.height+"px",l.parentNode.insertBefore(H,l),H.appendChild(l),l.clipRect=H)}i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")}if(e.textpath){var J=e.textpath.style;i.font&&(J.font=i.font),i["font-family"]&&(J.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(J.fontSize=i["font-size"]),i["font-weight"]&&(J.fontWeight=i["font-weight"]),i["font-style"]&&(J.fontStyle=i["font-style"])}if("arrow-start"in i&&A(s,i["arrow-start"]),"arrow-end"in i&&A(s,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){var K=l.getElementsByTagName(j);if(!(K=K&&K[0])&&(K=F(j)),"image"==e.type&&i.src&&(K.src=i.src),i.fill&&(K.on=!0),(null==K.on||"none"==i.fill||null===i.fill)&&(K.on=!1),K.on&&i.fill){var M=b(i.fill).match(c._ISURL);if(M){K.parentNode==l&&l.removeChild(K),K.rotate=!0,K.src=M[1],K.type="tile";var N=e.getBBox(1);K.position=N.x+n+N.y,e._.fillpos=[N.x,N.y],c._preload(M[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})}else K.color=c.getRGB(i.fill).hex,K.src=o,K.type="solid",c.getRGB(i.fill).error&&(s.type in{circle:1,ellipse:1}||"r"!=b(i.fill).charAt())&&C(s,i.fill,K)&&(m.fill="none",m.gradient=i.fill,K.rotate=!1)}if("fill-opacity"in i||"opacity"in i){var O=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+c.getRGB(i.fill).o+1||2)-1);O=h(g(O,0),1),K.opacity=O,K.src&&(K.color="none")}l.appendChild(K);var P=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],Q=!1;!P&&(Q=P=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(P.on=!0),("none"==i.stroke||null===i.stroke||null==P.on||0==i.stroke||0==i["stroke-width"])&&(P.on=!1);var R=c.getRGB(i.stroke);P.on&&i.stroke&&(P.color=R.hex),O=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+R.o+1||2)-1);var S=.75*(d(i["stroke-width"])||1);if(O=h(g(O,0),1),null==i["stroke-width"]&&(S=m["stroke-width"]),i["stroke-width"]&&(P.weight=S),S&&1>S&&(O*=S)&&(P.weight=1),P.opacity=O,i["stroke-linejoin"]&&(P.joinstyle=i["stroke-linejoin"]||"miter"),P.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(P.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),"stroke-dasharray"in i){var T={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};P.dashstyle=T[a](i["stroke-dasharray"])?T[i["stroke-dasharray"]]:o}Q&&l.appendChild(P)}if("text"==s.type){s.paper.canvas.style.display=o;var U=s.paper.span,W=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=U.style,m.font&&(p.font=m.font),m["font-family"]&&(p.fontFamily=m["font-family"]),m["font-weight"]&&(p.fontWeight=m["font-weight"]),m["font-style"]&&(p.fontStyle=m["font-style"]),W=d(m["font-size"]||W&&W[0])||10,p.fontSize=100*W+"px",s.textpath.string&&(U.innerHTML=b(s.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var X=U.getBoundingClientRect();s.W=m.w=(X.right-X.left)/100,s.H=m.h=(X.bottom-X.top)/100,s.X=m.x,s.Y=m.y+s.H/2,("x"in i||"y"in i)&&(s.path.v=c.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],Z=0,$=Y.length;$>Z;Z++)if(Y[Z]in i){s._.dirty=1;break}switch(m["text-anchor"]){case"start":s.textpath.style["v-text-align"]="left",s.bbx=s.W/2;break;case"end":s.textpath.style["v-text-align"]="right",s.bbx=-s.W/2;break;default:s.textpath.style["v-text-align"]="center",s.bbx=0}s.textpath.style["v-text-kern"]=!0}},C=function(a,f,g){a.attrs=a.attrs||{};var h=(a.attrs,Math.pow),i="linear",j=".5 .5";if(a.attrs.gradient=f,f=b(f).replace(c._radial_gradient,function(a,b,c){return i="radial",b&&c&&(b=d(b),c=d(c),h(b-.5,2)+h(c-.5,2)>.25&&(c=e.sqrt(.25-h(b-.5,2))*(2*(c>.5)-1)+.5),j=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==i){var k=f.shift();if(k=-d(k),isNaN(k))return null}var l=c._parseDots(f);if(!l)return null;if(a=a.shape||a.node,l.length){a.removeChild(g),g.on=!0,g.method="none",g.color=l[0].color,g.color2=l[l.length-1].color;for(var m=[],p=0,q=l.length;q>p;p++)l[p].offset&&m.push(l[p].offset+n+l[p].color);g.colors=m.length?m.join():"0% "+g.color,"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360),a.appendChild(g)}return 1},D=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=b,this.matrix=c.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},E=c.el;D.prototype=E,E.constructor=D,E.transform=function(a){if(null==a)return this._.transform;var d,e=this.paper._viewBoxShift,f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:o;e&&(d=a=b(a).replace(/\.{3}|\u2026/g,this._.transform||o)),c._extractTransform(this,f+a);var g,h=this.matrix.clone(),i=this.skew,j=this.node,k=~b(this.attrs.fill).indexOf("-"),l=!b(this.attrs.fill).indexOf("url(");if(h.translate(1,1),l||k||"image"==this.type)if(i.matrix="1 0 0 1",i.offset="0 0",g=h.split(),k&&g.noRotation||!g.isSimple){j.style.filter=h.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;j.coordorigin=q*-u+n+r*-u,z(this,1,1,q,r,0)}else j.style.filter=o,z(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate);else j.style.filter=o,i.matrix=b(h),i.offset=h.offset();return d&&(this._.transform=d),this},E.rotate=function(a,c,e){if(this.removed)return this;if(null!=a){if((a=b(a).split(k)).length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,c,e]])),this}},E.translate=function(a,c){return this.removed?this:((a=b(a).split(k)).length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",a,c]])),this)},E.scale=function(a,c,e,f){if(this.removed)return this;if((a=b(a).split(k)).length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=o),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),c.eve.unbind("raphael.*.*."+this.id),c._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}},E.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if(b==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=b.split(k),h={},i=0,m=g.length;m>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&c.is(b,"array")){for(h={},i=0,m=b.length;m>i;i++)h[b[i]]=this.attr(b[i]);return h}var n;null!=d&&(n={},n[b]=d),null==d&&c.is(b,"object")&&(n=b);for(var o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[a](o)&&n[a](o)&&c.is(this.paper.customAttributes[o],"function")){var p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(var q in p)p[a](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text),B(this,n)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)},E.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)},E.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)},E.blur=function(a){var b=this.node.runtimeStyle,d=b.filter;return d=d.replace(r,o),0!=+a?(this.attrs.blur=a,b.filter=d+n+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",f(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur),this},c._engine.path=function(a,b){var c=F("shape");c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin;var d=new D(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c);var f=F("skew");return f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d},c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g),i=a.path(h),j=i.attrs;return i.X=j.x=b,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i},c._engine.ellipse=function(a,b,c,d,e){var f=a.path();return f.attrs,f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f},c._engine.circle=function(a,b,c,d){var e=a.path();return e.attrs,e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e},c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g),i=a.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=b,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=b,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i},c._engine.text=function(a,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath");d=d||0,e=e||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=b(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0";var k=new D(h,a),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g};k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=b(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),a.canvas.appendChild(h);var m=F("skew");return m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k},c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this},c._engine.setViewBox=function(a,b,d,e,f){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,f]);var h,i,j=this.width,k=this.height,l=1/g(d/j,e/k);return f&&(h=k/e,i=j/d,j>d*h&&(a-=(j-d*h)/2/h),k>e*i&&(b-=(k-e*i)/2/i)),this._viewBox=[a,b,d,e,!!f],this._viewBoxShift={dx:-a,dy:-b,scale:l},this.forEach(function(a){a.transform("...")}),this};var F;c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},c._engine.initWin(c._g.win),c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,e=a.width,f=a.x,g=a.y;if(!b)throw new Error("VML container not found.");var h=new c._Paper,i=h.canvas=c._g.doc.createElement("div"),j=i.style;return f=f||0,g=g||0,e=e||512,d=d||342,h.width=e,h.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),h.coordsize=216e5+n+216e5,h.coordorigin="0 0",h.span=c._g.doc.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",i.appendChild(h.span),j.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==b?(c._g.doc.body.appendChild(i),j.left=f+"px",j.top=g+"px",j.position="absolute"):b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i),h.renderfix=function(){},h},c.prototype.clear=function(){c.eve("raphael.clear",this),this.canvas.innerHTML=o,this.span=c._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},c.prototype.remove=function(){c.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};var G=c.st;for(var H in E)E[a](H)&&!G[a](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}}(),B.was?A.win.Raphael=c:Raphael=c,c}),PiObject=function(o){this.properties=[];var values={};this.length=this.properties.length,this.listeners={},this.filters={},this.globalListeners=[],this.globalFilters=[];var uuid=null,uid=-1;this.getUUID=function(){if(null==uuid){var my={};my.date=new Date,my.uuid=[],my.uuid.push(my.date.getFullYear().toString()),my.uuid.push(my.date.getMonth().toString()),my.uuid.push(my.date.getDate().toString()),my.uuid.push(my.date.getTime().toString()),uuid=my.uuid.join("")}return uuid},this.getLength=function(){return this.properties.length},this.getProperty=function(index){return index.constructor!=Number?index.replace(/^\s*(\S*)\s*$/,"$1"):index>=0&&index<this.getLength()?this.properties[index]:""},this.getIndex=function(propertyName){if(propertyName.constructor!=Number)for(var i=0;i<this.getLength();i++)if(this.properties[i]==propertyName)return i;var num=parseInt(propertyName);return propertyName==num&&num>=0&&num<this.getLength()?num:-1},this.getPropertyList=function(propertyName){if(propertyName){for(var value,propertyList=[],i=0;i<this.properties.length;i++)(value=values[this.properties[i]])instanceof PiObject?propertyList.push(value.get(propertyName).toString()):value instanceof Object?propertyList.push(value[propertyName]||""):propertyList.push("");return propertyList.join()}return this.properties.join()},this.get=function(property){var my={};property=this.getProperty(property),void 0!==values[property]?my.result=values[property]:my.result="",my.filters=this.filters[property]||[],my.filters=my.filters.concat(this.globalFilters);for(var i=0;i<my.filters.length;i++)my.returnVariable=my.filters[i].method.call(my.filters[i].scope,this,property,my.result),void 0!=my.returnVariable&&(my.result=my.returnVariable);return my.result},this.exists=function(property){return!!((property=this.getProperty(property)).length&&this.getIndex(property)>=0)},this.set=function(propertyName,value){var o={};void 0!=propertyName&&(propertyName.constructor==Object?o=propertyName:o[this.getProperty(propertyName)]=value);var my={};for(my.name in o){my.index=my.name,my.name.constructor==Number&&(my.name=this.getProperty(my.name)),my.oldValue=values[my.name]||"",this.getIndex(my.index)<0&&(uid++,this.properties.push(my.name),this.length=this.properties.length),my.newValue=o[my.name],values[my.name]=my.newValue,my.listeners=this.listeners[my.name]||[],my.listeners=my.listeners.concat(this.globalListeners);for(var i=0;i<my.listeners.length;i++)my.result=my.listeners[i].method.call(my.listeners[i].scope,this,my.index,my.oldValue,my.newValue),void 0!=my.result&&my.result!=my.newValue&&(my.newValue=my.result,values[my.name]=my.newValue)}return void 0!=propertyName&&propertyName.constructor!=Object?this.get(my.name):this},this.insertAt=function(i){var my={},o={};my.index=this.getIndex(i);for(var i=1;i<arguments.length;i++)my.prop=(++uid).toString(),my.index>=0?this.properties.splice(my.index++,0,my.prop):this.properties.push(my.prop),this.length=this.properties.length,o[my.prop]=arguments[i];return this.set(o)},this.add=function(){for(var my={},o={},i=0;i<arguments.length;i++)my.prop=(++uid).toString(),this.properties.push(my.prop),this.length=this.properties.length,o[my.prop]=arguments[i];return this.set(o)},this.append=this.add,this.move=function(oldName,newName){var my={};if(my.oldIndex=this.getIndex(oldName),my.oldIndex<0)throw"index does not exist";if(my.oldIndex<-this.properties.length||my.oldIndex>this.properties.length)throw"index does not exist";return my.newIndex=this.getIndex(newName),my.newIndex<0&&(my.newIndex="string"==typeof oldName?my.oldIndex:this.properties.length),my.oldIndex!=my.newIndex&&(my.prop=this.properties.splice(my.oldIndex,1)[0],my.newIndex<0&&my.newIndex++,my.newIndex>=this.properties.length?this.properties.push(my.prop):this.properties.splice(my.newIndex,0,my.prop)),"string"==typeof oldName&&"string"==typeof newName&&(this.remove(newName),this.properties[this.getIndex(oldName)]=newName,values[newName]=values[oldName],delete values[oldName]),this},this.remove=function(){for(var my={},o={},i=0;i<arguments.length;i++)my.prop=this.getProperty(arguments[i]),void 0!=values[my.prop]&&(o[my.prop]="");this.set(o);for(my.prop in o)my.index=this.getIndex(my.prop),0==values[my.prop].length&&(delete values[my.prop],this.properties.splice(my.index,1),this.length=this.properties.length);return this},this.deleteIt=this.remove,this.removeAll=function(){for(i=0;i<this.length;i++)this.set(i,"");for(var i in values)delete values[i];return delete this.properties,this.properties=[],this.length=this.properties.length,this},this.deleteAll=this.removeAll;var addFunction=function(type,action,property,scope,method,applyToExisting){var my={};if("string"==typeof property&&(property=property.split(",")),void 0!=property&&property.constructor==Array||(applyToExisting=method,method=scope,scope=property,property=[""]),"function"==typeof scope?(applyToExisting=method,method=scope,scope=this):"string"==typeof method&&(method=scope[method]),void 0!=applyToExisting&&"boolean"==typeof applyToExisting||(applyToExisting=!0),"object"!=typeof scope)throw"The scope parameter supplied to the "+action+type+"() function was not of type 'object'.";if("function"!=typeof method)throw"The method parameter supplied to the "+action+type+"() function was not of type 'function'.";if(property.constructor!=Array)throw"The property parameter supplied to the "+action+type+"() function must be either of type 'string' or 'array'.";if("boolean"!=typeof applyToExisting)throw"The applyToExisting parameter supplied to the "+action+type+"() function was not of type 'boolean'.";for(my.index=0;my.index<property.length;my.index++)if(my.property=this.getProperty(property[my.index]),my.property.length?"Listener"==type?("add"==action&&(this.listeners[my.property]=this.listeners[my.property]||[]),my.functions=this.listeners[my.property]):("add"==action&&(this.filters[my.property]=this.filters[my.property]||[]),my.functions=this.filters[my.property]):my.functions="Listener"==type?this.globalListeners:this.globalFilters,void 0!=my.functions){my.alreadyExists=!1;for(i=my.functions.length-1;i>=0;i--)if(my.functions[i].method==method&&my.functions[i].scope===scope){"add"==action?my.alreadyExists=!0:"remove"==action&&my.functions.splice(i,1);break}if("add"==action&&!my.alreadyExists&&(my.functions.push({property:my.property,scope:scope,method:method,applyToExisting:applyToExisting}),"Listener"==type&&applyToExisting)){my.property.length?my.properties=[my.property]:my.properties=this.properties;for(var i=0;i<my.properties.length;i++)void 0!=values[my.properties[i]]&&(my.result=method.call(scope,this,my.properties[i],"",values[my.properties[i]]),void 0!=my.result&&(values[my.properties[i]]=my.result))}}return this};this.addListener=function(property,scope,method,applyToExisting){return addFunction.call(this,"Listener","add",property,scope,method,applyToExisting)},this.removeListener=function(property,scope,method){return addFunction.call(this,"Listener","remove",property,scope,method)},this.addFilter=function(property,scope,method){return addFunction.call(this,"Filter","add",property,scope,method)},this.removeFilter=function(property,scope,method){return addFunction.call(this,"Filter","remove",property,scope,method)},this.each=function(scope,method){if("function"==typeof scope?(method=scope,scope=this):"string"==typeof method&&(method=scope[method]),"object"!=typeof scope)throw"The scope parameter supplied to the each() function was not of type 'object'.";if("function"!=typeof method)throw"The method parameter supplied to the each() function was not of type 'function'.";for(var propertyList=this.getPropertyList().split(","),i=0;i<propertyList.length;i++)if(void 0!==values[propertyList[i]]){var result=method.call(scope,this,propertyList[i],values[propertyList[i]]);if(void 0!=result)return result}},this.init(o),this.destroy=function(){delete this.properties;for(var prop in values)delete values[prop];delete this.length;for(var prop in this.listeners)for(var i in this.listeners[prop])delete this.listeners[prop][i];delete this.listeners;for(var prop in this.filters)for(var i in this.filters[prop])delete this.filters[prop][i];delete this.filters;for(var i in this.globalListeners)delete this.globalListeners[i];delete this.globalListeners;for(var i in this.globalFilters)delete this.globalFilters[i];delete this.globalFilters},this.getValues=function(){var copy={};for(var prop in values)copy[prop]=values[prop];return copy}},PiObject.prototype.init=function(o){o instanceof Array?this.add.apply(this,o):this.set.apply(this,arguments)},Pi=PiObject,Pi.extend=function(constructor){var parent=this;return constructor=constructor||function(){parent.prototype.constructor.apply(this,arguments)},constructor.parent=parent.prototype,constructor.extend=PiObject.extend,constructor.prototype=new parent,constructor.prototype.constructor=constructor,constructor},"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.Set=PiObject.extend(),MeasurementTool.Set.prototype.init=function(config){if(config=this.set("config",config||{}),this.addListener("config",this.defaultConfig),MeasurementTool.Set.parent.init.apply(this,arguments),this.exists("children"))children=this.get("children");else var children=this.set("children",new PiObject);if(this.addListener("children",this.initCollection),children.addListener(this,this.transformChildren,!1),this.exists("transforms"))transforms=this.get("transforms");else var transforms=this.set("transforms",new PiObject);transforms.addListener(this,this.defineTransform),transforms.addListener(this,this.transform),this.addFilter("transform",this.getTransform),this.addFilter("transforms",this.getPosition),this.addFilter("transforms",this.getRotation),this.addFilter("dragHandleAttributes",this.getDragHandleAttributes),this.addListener("canvas",this.addSet),this.addFilter("offset",this.getOffset),this.addListener("scale",this.setScale),this.addListener("visibility",this.setVisibility),this.addListener("visibility",this.resetTransforms)},MeasurementTool.Set.prototype.defaultConfig=function(object,property,oldConfig,newConfig){this.removeListener(property,this.defaultConfig),newConfig="object"==typeof newConfig?newConfig:{}},MeasurementTool.Set.prototype.initCollection=function(object,property,oldValue,newValue){if(""!=newValue&&(newValue.constructor==Array||newValue.constructor==Object))return new PiObject(newValue)},MeasurementTool.Set.prototype.setVisibility=function(object,property,oldValue,newValue){this.exists("set")&&("hidden"==this.get("visibility")?this.get("set").hide():this.get("set").show())},MeasurementTool.Set.prototype.resetTransforms=function(object,property,oldValue,newValue){"hidden"==newValue&&(this.get("transforms").removeAll(),this.transform(),this.setVisibility(this,"visibility","",this.get("visibility")))},MeasurementTool.Set.prototype.setScale=function(object,property,oldValue,newValue){""!=oldValue&&""==newValue&&this.get("transforms").remove("scale"),""!=newValue&&this.get("transforms").set("scale",{scale:newValue})},MeasurementTool.Set.prototype.defineTransform=function(transforms,index,oldTransform,newTransform){if(""!=newTransform){switch(index){case"rotation":newTransform.type=newTransform.type||"r";break;case"translation":newTransform.type=newTransform.type||"t";break;case"scale":newTransform.type=newTransform.type||"s"}switch(newTransform.type){case"r":case"R":case"rotate":case"rotation":"object"!=typeof newTransform&&(newTransform={type:"r",angle:+newTransform}),newTransform.svg=newTransform.type.charAt(0),newTransform.type="rotation",newTransform.css="rotate",newTransform.angle=newTransform.angle||0,newTransform.x=void 0!==newTransform.x?newTransform.x:this.exists("center")?+this.get("center").x:this.exists("width")?this.get("width")/2:0,newTransform.y=void 0!==newTransform.y?newTransform.y:this.exists("center")?+this.get("center").y:this.exists("height")?this.get("height")/2:0,newTransform.h=Math.sqrt(Math.pow(newTransform.x,2)+Math.pow(newTransform.y,2));break;case"t":case"T":case"translate":case"translation":newTransform.svg=newTransform.type.charAt(0),newTransform.type="translation",newTransform.css="translate",newTransform.x=void 0!==newTransform.x?newTransform.x:0,newTransform.y=void 0!==newTransform.y?newTransform.y:0;break;case"s":case"S":case"scale":newTransform.svg=newTransform.type.charAt(0),newTransform.type="scale",newTransform.css="scale",newTransform.scale=void 0!==newTransform.scale?newTransform.scale:1}}},MeasurementTool.Set.prototype.getPosition=function(object,property,transforms){transforms.exists("translation")||transforms.set("translation",{x:this.exists("x")?this.get("x"):this.exists("width")&&this.exists("canvas")?this.get("canvas").get("width")/2-this.get("width")/2:0,y:this.exists("y")?this.get("y"):this.exists("height")&&this.exists("canvas")?this.get("canvas").get("height")/2-this.get("height")/2:0})},MeasurementTool.Set.prototype.getRotation=function(object,property,transforms){transforms.exists("rotation")||transforms.set("rotation",{angle:this.get("rotation")})},MeasurementTool.Set.prototype.getDragHandleAttributes=function(object,property,value){if(this.removeFilter(property,this.getDragHandleAttributes),""==value)return this.set(property,{stroke:"none",fill:"#00F","fill-opacity":0})},MeasurementTool.Set.prototype.addSet=function(object,property,oldCanvas,newCanvas){this.exists("set")||(this.set("set",newCanvas instanceof PiObject?newCanvas.get("canvas").set():newCanvas.set()),this.transform(),this.setVisibility(this,"visibility","",this.get("visibility")))},MeasurementTool.Set.prototype.getOffset=function(object,property,offset){if(this.exists("canvas"))return this.get("canvas").get("offset")},MeasurementTool.Set.prototype.getTransform=function(object,property,transform){var result=[];return this.get("transforms").each(function(transforms,index,transform){if(""!=transform)switch(transform.type){case"rotation":result.push([transform.svg,transform.angle,transform.x,transform.y].join(" "));break;case"translation":result.push([transform.svg,transform.x,transform.y].join(" "));break;case"scale":result.push([transform.svg,transform.scale].join(" "))}}),result.join(" ")},MeasurementTool.Set.prototype.transformChildren=function(children,index,oldChild,newChild){""!=oldChild&&oldChild instanceof PiObject&&oldChild.removeFilter("transform",this,this.addParentTransform),""!=newChild&&newChild instanceof PiObject&&newChild.addFilter("transform",this,this.addParentTransform)},MeasurementTool.Set.prototype.addParentTransform=function(child,property,transform){return[this.get("transform"),transform].join(" ")},MeasurementTool.Set.prototype.transform=function(transforms,index,oldTransform,newTransform){if(this.exists("set")){var set=this.get("set");set.transform&&set.transform(this.get("transform")),this.get("children").each(function(children,index,child){child.transform&&child.transform()})}},MeasurementTool.Set.prototype.translation=function(){var start;return{drag:function(dx,dy,x,y){this.get("transforms").set("translation",{x:start.x+dx,y:start.y+dy})},start:function(x,y,event){start=this.get("transforms").get("translation")},stop:function(x,y,event){}}}(),MeasurementTool.Set.prototype.rotation=function(){var last;return{drag:function(dx,dy,canvasX,canvasY){var offset=this.get("offset"),transforms=this.get("transforms"),translation=transforms.get("translation"),rotation=transforms.get("rotation"),current=Raphael.angle(canvasX,canvasY,offset.x+rotation.x+translation.x,offset.y+rotation.y+translation.y),delta=current-last;delta<-180?delta+=360:delta>180&&(delta-=360),last=current,rotation.angle+=delta,transforms.set("rotation",rotation)},start:function(canvasX,canvasY,event){var offset=this.get("offset"),transforms=this.get("transforms"),translation=transforms.get("translation"),rotation=transforms.get("rotation");last=Raphael.angle(canvasX,canvasY,offset.x+rotation.x+translation.x,offset.y+rotation.y+translation.y)},stop:function(x,y,event){}}}(),"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.Canvas=MeasurementTool.Set.extend(),MeasurementTool.Canvas.prototype.init=function(config){void 0!==config&&((config=config||{}).window=config.window||window,MeasurementTool.Canvas.parent.init.apply(this,arguments),this.addListener("window",this.initRaphael),this.addFilter("node",this.createNode),this.addListener("node",this.initNode))},MeasurementTool.Canvas.prototype.defaultConfig=function(object,property,oldConfig,newConfig){MeasurementTool.Canvas.parent.defaultConfig.apply(this,arguments),newConfig.width=newConfig.width||620,newConfig.height=newConfig.height||420,newConfig.r=newConfig.r||0,newConfig.stroke=newConfig.stroke||"none",newConfig.fill=newConfig.fill||"none",newConfig.scale=newConfig.scale||1},MeasurementTool.Canvas.prototype.initRaphael=function(object,property,oldWindow,newWindow){Raphael.setWindow(newWindow)},MeasurementTool.Canvas.prototype.createNode=function(object,property,node){var doc=this.get("window").document;if(doc.body&&(this.removeFilter(property,this.createNode),""==node)){(node=doc.createElement("div")).id=this.get("id"),node.className=this.get("classname");var parent=this.exists("parent")?this.get("parent"):doc.body,box=parent.getBoundingClientRect(),width=this.get("width"),height=this.get("height");parent.appendChild(node),node.style.cssText=["width:"+width,"height:"+height].join(";"),this.exists("x")||this.set("x",box.left+box.width/2-width/2),this.exists("y")||this.set("y",box.top+box.height/2-height/2),node.style.visibility=this.exists("visibility")?this.get("visibility"):"visible",this.set("node",node)}},MeasurementTool.Canvas.prototype.initNode=function(object,property,oldNode,newNode){if("string"==typeof newNode?newNode=Raphael._g.doc.getElementById(this.set("id",newNode)):this.set("id",newNode.id),newNode.ownerDocument&&newNode.ownerDocument!=Raphael._g.doc&&newNode.ownerDocument.defaultView&&Raphael.setWindow(newNode.ownerDocument.defaultView),newNode.childNodes)for(;newNode.hasChildNodes();){if("IMG"==newNode.firstChild.tagName){var src=newNode.firstChild.src;if("/"!=src.charAt(0)&&-1==src.indexOf("://")){var href=window.document.location.href,last=href.split("/").pop();if(last.indexOf("."))dir=href.substr(0,href.length-last.length);else var dir=href;"/"!=dir.charAt(dir.length-1)&&(dir+="/"),src=dir+src}for(var img={type:"image",src:src,width:this.get("width"),height:this.get("height"),x:0,y:0},i=0;i<newNode.firstChild.attributes.length;i++)switch(newNode.firstChild.attributes[i].name){case"width":(value=+newNode.firstChild.attributes[i].value)&&(img.width=value,img.x=(this.get("width")-value)/2);break;case"height":var value=+newNode.firstChild.attributes[i].value;value&&(img.height=value,img.y=(this.get("height")-value)/2)}}newNode.removeChild(newNode.firstChild)}return this.set("raphael",Raphael),this.set("canvas",Raphael(newNode,this.get("width"),this.get("height"))),this.addListener("r",this.outline,!1),this.addListener("stroke",this.outline,!1),this.addListener("fill",this.outline,!1),this.outline(),img&&this.get("children").insertAt(0,img),this.addFilter("transformProperty",this.getTransformProperty),this.addFilter("transformMatrix",this.getTransformMatrix),this.get("children").addListener(this,this.initChildren),this.addListener("x",this.moveNode),this.addListener("y",this.moveNode),newNode},MeasurementTool.Canvas.prototype.moveNode=function(object,property,oldValue,newValue){if(this.exists("node"))switch(property){case"x":this.get("node").style.left=newValue+"px";break;case"y":this.get("node").style.top=newValue+"px"}},MeasurementTool.Canvas.prototype.resetTransforms=function(object,property,oldValue,newValue){MeasurementTool.Canvas.parent.resetTransforms.apply(this,arguments)},MeasurementTool.Canvas.prototype.getPosition=function(object,property,transforms){transforms.exists("translation")||transforms.set("translation",{x:0,y:0})},MeasurementTool.Canvas.prototype.getOffset=function(object,property,offset){if(this.exists("node")){var node=this.get("node"),height=this.get("height"),width=this.get("width"),box=node.getBoundingClientRect();if(offset=function(elem,raphael){var thisbox=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0;return{y:thisbox.top+(raphael._g.win.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,x:thisbox.left+(raphael._g.win.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft}}(node,this.get("raphael")),box.height!=height||box.width!=width){var translation=this.get("transformMatrix");offset.x=offset.x+(box.right-box.left)/2-width/2-translation.e,offset.y=offset.y+(box.bottom-box.top)/2-height/2-translation.f}return offset}},MeasurementTool.Canvas.prototype.setVisibility=function(object,property,oldValue,newValue){this.exists("node")&&(this.get("node").style.visibility=this.get("visibility"))},MeasurementTool.Canvas.prototype.getTransformProperty=function(object,property,value){for(var node=this.get("node"),properties=["transform","WebkitTransform","msTransform","MozTransform","OTransform","filters"],i=0;i<properties.length&&(value=properties[i],void 0===node.style[value]);i++);if("filters"!=value||void 0!==document.body.filters)return this.removeFilter(property,this.getTransformProperty),this.set(property,value)},MeasurementTool.Canvas.prototype.getTransformMatrix=function(object,property,value){return value=Raphael.matrix(1,0,0,1,0,0),this.get("transforms").each(this,function(transforms,index,transform){if(""!=transform)value.split();switch(transform.type){case"rotation":if(transform.angle%360){var raphael=this.get("raphael"),scale=this.get("scale"),delta={x:(transform.x-this.get("width")/2)*scale,y:(transform.y-this.get("height")/2)*scale};delta.h=Math.sqrt(Math.pow(delta.x,2)+Math.pow(delta.y,2)),delta.angle=raphael.rad(raphael.angle(transform.x,transform.y,this.get("width")/2,this.get("height")/2)+transform.angle),value.translate(delta.x-delta.h*Math.cos(delta.angle),delta.y-delta.h*Math.sin(delta.angle))}value.rotate(transform.angle);break;case"translation":value.translate(transform.x,transform.y);break;case"scale":value.scale(transform.scale)}}),value},MeasurementTool.Canvas.prototype.transform=function(transforms,index,oldTransform,newTransform){if(this.exists("node")&&this.exists("canvas")){var node=this.get("node"),property=(this.get("transforms"),this.get("transformProperty")),matrix=this.get("transformMatrix");if(this.exists("scale")){var scale=this.get("scale"),canvas=this.get("canvas").canvas;canvas.setAttribute("width",scale*this.get("width")),canvas.setAttribute("height",scale*this.get("height")),this.get("children").each(function(children,index,child){child.transform&&child.transform()})}if("filters"==property){var filter=node.filters.item("DXImageTransform.Microsoft.Matrix");filter.M11=matrix[0][0],filter.M12=matrix[0][1],filter.M21=matrix[1][0],filter.M22=matrix[1][1]}else null!=node.style[property]&&(node.style[property]=matrix.toString())}},MeasurementTool.Canvas.prototype.initChildren=function(object,property,oldChild,newChild){if(oldChild!=newChild&&(""!=oldChild&&(oldChild instanceof MeasurementTool.Set?oldChild.remove("canvas"):oldChild.remove()),""!=newChild)){var newRaphaelObject;newChild instanceof MeasurementTool.Set?newRaphaelObject=newChild.set({canvas:this}).get("set"):newChild.paper||(newRaphaelObject=this.get("canvas").add(newChild.constructor==Array?newChild:[newChild])),this.get("set").push(newRaphaelObject)}},MeasurementTool.Canvas.prototype.outline=function(object,property,oldValue,newValue){if(this.exists("outline")){var outline=this.get("outline");outline[property]=newValue,this.get("children").set(0,outline)}else{var config=this.get("config");config.type="rect",this.get("children").insertAt(0,this.set("outline",config))}},MeasurementTool.Canvas.prototype.translation=function(){var start;return{drag:function(dx,dy,x,y){var newX=start.x+dx,newY=start.y+dy,toolHeight=this.get("height")/2,toolWidth=this.get("width")/2;newX+toolWidth<=this.get("rightBoundary")&&newY+toolHeight<=this.get("bottomBoundary")&&newX+toolWidth>=0&&newY+toolHeight>=0&&(this.set("x",newX),this.set("y",newY))},start:function(x,y,event){start={x:this.get("x"),y:this.get("y")}},stop:function(x,y,event){}}}(),"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.StraightLine=MeasurementTool.Set.extend(),MeasurementTool.StraightLine.prototype.init=function(config){MeasurementTool.StraightLine.parent.init.apply(this,arguments),this.set("lines",new PiObject).addListener(MeasurementTool.StraightLine.prototype.removeLine),this.addListener("set",this.addPencil),this.transform()},MeasurementTool.StraightLine.prototype.defaultConfig=function(object,property,oldConfig,newConfig){newConfig.width=newConfig.width||18,newConfig.height=newConfig.height||62,newConfig.origin={x:newConfig.width/2,y:newConfig.height},MeasurementTool.StraightLine.parent.defaultConfig.apply(this,arguments)},MeasurementTool.StraightLine.prototype.setVisibility=function(object,property,oldValue,newValue){if(this.exists("canvas")){var canvasHolder=this.get("canvas").get("canvas"),canvas=canvasHolder.canvas,moveStraightLine=function(event){var offset=canvas.getBoundingClientRect(),zoomFactor=straightline.get("zoomFactor");canvasHolder.bottom.node&&(offset=canvasHolder.bottom.node.getBoundingClientRect()),straightline.get("transforms").set("translation",{x:(event.clientX-offset.left)/zoomFactor-15*zoomFactor,y:(event.clientY-offset.top-straightline.get("height"))/zoomFactor+5*zoomFactor})};if("hidden"==newValue)canvas.style.cursor="inherit",canvas.removeEventListener("mousemove",moveStraightLine,!1),"ontouchstart"in window&&canvas.removeEventListener("mousedown",moveStraightLine,!1),this.get("set").hide();else{var straightline=this;straightline.addMouseListener(canvas,"mousemove",moveStraightLine),"ontouchstart"in window&&straightline.addMouseListener(canvas,"mousedown",moveStraightLine),straightline.get("set").show(),canvas.style.cursor="none"}}},MeasurementTool.StraightLine.prototype.addMouseListener=function(target,name,fn){var eventName,altEventName,touchScreen="ontouchstart"in window,touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},mouseEvents={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove"},getWindowsNTVersion=function(){var value,matches=navigator.userAgent.match(/Windows NT (\d+\.\d+)/);return matches&&matches[1]&&(value=parseFloat(matches[1])),value||0},normalizeTouchEvent=function(evt){if(evt.changedTouches)for(var touches=evt.changedTouches,i=0,ii=touches.length;i<ii;i++)if(touches[i].target==evt.target){var oldevt=evt;return evt=touches[i],evt.preventDefault=function(){return oldevt.preventDefault()},evt.stopPropagation=function(){return oldevt.stopPropagation()},evt}return evt},touchAndMouse=touchScreen&&(getWindowsNTVersion()>=6.1||window.navigator.userAgent.indexOf("CrOS")>-1);touchScreen?(eventName=touchEvents[name]||name,touchAndMouse&&(altEventName=mouseEvents[name]||name)):eventName=mouseEvents[name]||name;var processEvent=function(evt){touchAndMouse&&evt.preventDefault(),touchScreen&&(evt=normalizeTouchEvent(evt)),fn(evt)};eventName&&(target.addEventListener(eventName,processEvent,!1),altEventName&&target.addEventListener(altEventName,processEvent,!1))},MeasurementTool.StraightLine.prototype.getRotation=function(object,property,transforms){var origin=this.get("origin");transforms.exists("rotation")||transforms.set("rotation",{type:"rotation",angle:30,x:origin.x,y:origin.y}),MeasurementTool.StraightLine.parent.getRotation.apply(this,arguments)},MeasurementTool.StraightLine.prototype.addPencil=function(object,property,oldSet,newSet){var start,line,canvas=this.get("canvas").get("canvas"),width=this.get("width"),height=this.get("height");newSet.push(this.get("children").set("pencil",canvas.set([canvas.rect(0,0,18,20,7).attr({fill:"#DB4652","stroke-miterlimit":"10",stroke:"#C1272D"}),canvas.rect(0,17,18,32).attr({fill:"#FBB03B"}),canvas.rect(5.5,17.5,9,32).attr({fill:"#F2B96D",stroke:"#D68A25","stroke-miterlimit":"10"}),canvas.rect(.5,8.5,17,5).attr({fill:"#E6E6E6",stroke:"#B3B3B3","stroke-miterlimit":"10"}),canvas.rect(.5,12.5,17,5).attr({fill:"#E6E6E6",stroke:"#B3B3B3","stroke-miterlimit":"10"}),canvas.path("M0,49 l9,13 l9,-13 Z").attr({fill:"#C7B299"}),canvas.path("M6,58 l6,0 l-3,4 z").attr({fill:"#000"}),canvas.rect(0,0,width,height).attr(this.get("dragHandleAttributes"))]).drag(function(dx,dy,canvasX,canvasY){var origin=this.get("origin"),translation=this.get("transforms").get("translation"),path=["M",start.x,start.y,"L",origin.x+translation.x,origin.y+translation.y].join(" ");line?line.attr("path",path):this.get("lines").add(line=canvas.path(path))},function(canvasX,canvasY,event){var origin=this.get("origin"),translation=this.get("transforms").get("translation");start={x:origin.x+translation.x,y:origin.y+translation.y}},function(event){line&&(line=null)},this,this,this)))},MeasurementTool.StraightLine.prototype.removeLine=function(arcs,index,oldLine,newLine){""!=oldLine&&oldLine.remove()},"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.Ruler=MeasurementTool.Canvas.extend(),MeasurementTool.Ruler.prototype.init=function(config){MeasurementTool.Ruler.parent.init.apply(this,arguments),this.addListener("set",this.addOutline),this.addListener("set",this.addTickMarks),this.addListener("set",this.addLabel),this.addListener("set",this.addDragHandles),this.addListener("set",this.adjustPosition),this.get("node"),this.transform()},MeasurementTool.Ruler.prototype.defaultConfig=function(object,property,oldConfig,newConfig){newConfig.origin=newConfig.origin||{x:0,y:0},newConfig.stroke=newConfig.stroke||"#000",newConfig["font-size"]=newConfig["font-size"]||"10pt",newConfig["line-height"]=parseInt(newConfig["font-size"]),newConfig.type=newConfig.type||"rect",newConfig.cursor=newConfig.cursor||"move",newConfig.thickness=newConfig.thickness||newConfig.height||5*newConfig["line-height"],newConfig.height=newConfig.height||newConfig.thickness,newConfig.length?newConfig.width=newConfig.length:newConfig.parent?newConfig.width=.6*newConfig.parent.offsetWidth:newConfig.width=400,MeasurementTool.Ruler.parent.defaultConfig.apply(this,arguments)},MeasurementTool.Ruler.prototype.getRotation=function(object,property,transforms){MeasurementTool.Ruler.parent.getRotation.apply(this,arguments),transforms.exists("left_rotation")||transforms.set("left_rotation",{type:"rotation",angle:0,x:this.get("width"),y:0}),transforms.exists("right_rotation")||transforms.set("right_rotation",{type:"rotation",angle:0,x:0,y:0})},MeasurementTool.Ruler.prototype.addOutline=function(object,property,oldSet,newSet){var canvas=this.get("canvas");this.get("children").set("outline",canvas.rect(0,0,this.get("width"),this.get("height")).attr({stroke:this.get("stroke")}))},MeasurementTool.Ruler.prototype.adjustPosition=function(){var rulerLeft=(window.innerWidth-this.get("canvas").width)/2,rulerTop=(window.innerHeight-this.get("canvas").height)/2;this.moveNode(this.get("node"),"x",0,rulerLeft),this.moveNode(this.get("node"),"y",0,rulerTop),this.set("x",rulerLeft),this.set("y",rulerTop)},MeasurementTool.Ruler.prototype.addTickMarks=function(object,property,oldSet,newSet){var canvas=this.get("canvas"),config=this.get("config"),system=this.get("system"),tickmarks=canvas.set();config.max=Math.ceil(config.max)||10,config.min=Math.floor(config.min)||0;var subscale,widest=Math.abs(config.max)>Math.abs(config.min)?Math.abs(config.max):Math.abs(config.min),span=config.max-config.min,temp=canvas.text(10,10,widest+"W").attr({opacity:0}),scale=Math.ceil(temp[0].getComputedTextLength()*(span+1)/config.width),width=config.width/(span/scale),lineHeight=config["line-height"];temp.remove();var origin=this.get("origin");origin.y>=config.height&&(lineHeight=-lineHeight);var labelY=origin.y+5*lineHeight/2;if(null!=system&&"metric"==system.toLowerCase()){if(scale<=2)subscale=2;else if(scale>2&&scale<=5)scale=5,subscale=5;else{for(scale=10*Math.ceil(scale/10);scale<span-10&&span%scale;)scale+=10;subscale=10}width=config.width/(span/scale)}else subscale=Math.min(4,scale);for(var label,x,half,i=0;config.min+i*scale<=config.max;i++){if(line=canvas.path("M"+width*i+","+origin.y+"v"+2*lineHeight),tickmarks.push(line),1==scale)if(null!=system&&"metric"==system.toLowerCase())for(j=1;j<10;j++)x=width*i+j*width/10,h=1.5,j%5&&(h-=.5),x<config.width&&tickmarks.push(canvas.path("M"+x+","+origin.y+"v"+lineHeight*h));else for(j=1;j<8;j++)x=width*i+j*width/8,h=2,j%8&&(h-=.5),j%4&&(h-=.5),j%2&&(h-=.5),x<config.width&&tickmarks.push(canvas.path("M"+x+","+origin.y+"v"+lineHeight*h));else for(var j=1;j<subscale;j++)(x=width*i+j*width/subscale)<config.width&&tickmarks.push(canvas.path("M"+x+","+origin.y+"v"+3*lineHeight/2));label=canvas.text(width*i,labelY,config.min+scale*i),(x=parseInt(label.attr("x")))-(half=label[0].getComputedTextLength()/2)<0?label.attr("x",half+config["line-height"]/4):x+half>config.width&&label.attr("x",config.width-half-config["line-height"]/4),tickmarks.push(label)}this.get("children").set("tickmarksR",tickmarks)},MeasurementTool.Ruler.prototype.addDragHandles=function(object,property,oldSet,newSet){var canvas=this.get("canvas"),config=this.get("config"),children=this.get("children"),y=this.get("origin").y;y>=config.height-config.thickness&&(y=config.height-config.thickness),children.add(canvas.rect(0,y,config.width,config.thickness).attr(this.get("dragHandleAttributes")).attr({cursor:"move"}).drag(this.translation.drag,this.translation.start,this.translation.stop,this,this,this)),children.add(canvas.set([canvas.rect(0,y,config.thickness,config.thickness).attr(this.get("dragHandleAttributes"))]).attr({cursor:"rotate"}).drag(function(dx,dy,canvasX,canvasY){this.rotation.drag.apply(this,arguments)},function(canvasX,canvasY,event){this.rotation.start.apply(this,arguments)},function(canvasX,canvasY,event){this.rotation.start.apply(this,arguments)},this,this,this)),children.add(canvas.set([canvas.rect(config.width-config.thickness,y,config.thickness,config.thickness).attr(this.get("dragHandleAttributes"))]).attr({cursor:"rotate"}).drag(function(dx,dy,canvasX,canvasY){this.rotation.drag.apply(this,arguments)},function(canvasX,canvasY,event){this.rotation.start.apply(this,arguments)},function(canvasX,canvasY,event){this.rotation.start.apply(this,arguments)},this,this,this))},MeasurementTool.Ruler.prototype.addLabel=function(object,property,oldSet,newSet){var canvas=this.get("canvas");this.exists("label")&&this.get("children").set("label",canvas.text(this.get("width")/2,this.get("height")-this.get("line-height"),this.get("label")))},"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.Protractor=MeasurementTool.Ruler.extend(),MeasurementTool.Protractor.prototype.init=function(config){MeasurementTool.Protractor.parent.init.apply(this,arguments),this.addListener("set",this.adjustPosition)},MeasurementTool.Protractor.prototype.defaultConfig=function(object,property,oldConfig,newConfig){newConfig.min=newConfig.min||-5,newConfig.max=newConfig.max||5,MeasurementTool.Protractor.parent.defaultConfig.apply(this,arguments),newConfig.thickness=newConfig.height,newConfig.height=newConfig.width/2+newConfig.thickness,newConfig.origin={x:newConfig.width/2,y:newConfig.width/2},newConfig.outline=newConfig.stroke,delete newConfig.stroke},MeasurementTool.Protractor.prototype.getRotation=function(object,property,transforms){this.get("width");var origin=this.get("origin");transforms.exists("rotation")||transforms.set("rotation",{type:"rotation",angle:0,x:origin.x,y:origin.y}),MeasurementTool.Ruler.parent.getRotation.apply(this,arguments)},MeasurementTool.Protractor.prototype.adjustPosition=function(){var protractorLeft=(window.innerWidth-this.get("canvas").width)/2,protractorTop=(window.innerHeight-this.get("canvas").height)/2;this.moveNode(this.get("node"),"x",0,protractorLeft),this.moveNode(this.get("node"),"y",0,protractorTop),this.set("x",protractorLeft),this.set("y",protractorTop)},MeasurementTool.Protractor.prototype.addOutline=function(object,property,oldSet,newSet){var canvas=this.get("canvas"),width=+this.get("width"),height=+this.get("height"),thickness=+this.get("thickness"),stroke=this.get("outline"),outer={radius:width/2,top:0,bottom:height-thickness,left:0,right:width},outline=canvas.set([canvas.rect(0,width/2,width,thickness).attr({stroke:stroke}),canvas.path(["M",0,width/2,"A",outer.radius,outer.radius,0,1,1,outer.right,outer.bottom,"Z"].join(" ")).attr({stroke:stroke})]);this.set("outline",outline),newSet.push(this.get("children").set("outline",outline))},MeasurementTool.Protractor.prototype.addTickMarks=function(object,property,oldSet,newSet){MeasurementTool.Protractor.parent.addTickMarks.apply(this,arguments);for(var path,canvas=this.get("canvas"),raphael=this.get("raphael"),config=this.get("config"),tickmarks=canvas.set(),center={x:config.width/2,y:config.width/2},offset={},a=1;a<180;a++)offset.angle=raphael.rad(-a),offset.x=config.width/2*Math.cos(offset.angle),offset.y=config.width/2*Math.sin(offset.angle),path=[],a%10==0?(path.push("M",center.x+.1*offset.x,center.y+.1*offset.y,"L",center.x+.7*offset.x,center.y+.7*offset.y,"M",center.x+.9*offset.x,center.y+.9*offset.y,"L",center.x+offset.x,center.y+offset.y),tickmarks.push(canvas.text(center.x+.75*offset.x,center.y+.75*offset.y,a).transform("R"+(90-a))),tickmarks.push(canvas.text(center.x+.85*offset.x,center.y+.85*offset.y,180-a).transform("R"+(90-a)))):a%5==0?path.push("M",center.x+.95*offset.x,center.y+.95*offset.y,"L",center.x+offset.x,center.y+offset.y):path.push("M",center.x+.975*offset.x,center.y+.975*offset.y,"L",center.x+offset.x,center.y+offset.y),tickmarks.push(canvas.path(path.join(" ")).attr({stroke:config.outline}));newSet.push(this.get("children").set("tickmarks",tickmarks))},MeasurementTool.Protractor.prototype.addDragHandles=function(object,property,oldSet,newSet){var canvas=this.get("canvas"),width=+this.get("width"),height=+this.get("height"),thickness=+this.get("thickness"),children=(this.get("config"),this.get("children")),outer={left:0,right:width,top:0,bottom:height-thickness,radius:width/2};newSet.push(children.set("rotate",canvas.set([canvas.rect(outer.left,outer.bottom,2*outer.radius,thickness),canvas.path(["M",outer.left,outer.bottom,"A",outer.radius,outer.radius,0,0,1,outer.right,outer.bottom,"Z"].join(" "))]).attr(this.get("dragHandleAttributes")).attr({cursor:"rotate"}).drag(this.rotation.drag,this.rotation.start,this.rotation.stop,this,this,this)));var inner={left:thickness,right:width-thickness,top:0,bottom:height-thickness,radius:width/2-thickness};newSet.push(children.set("drag",canvas.set([canvas.rect(inner.left,inner.bottom,2*inner.radius,thickness),canvas.path(["M",inner.left,inner.bottom,"A",inner.radius,inner.radius,0,0,1,inner.right,inner.bottom,"Z"].join(" "))]).attr(this.get("dragHandleAttributes")).attr({cursor:"move"}).drag(this.translation.drag,this.translation.start,this.translation.stop,this,this,this)))},"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.Compass=MeasurementTool.Set.extend(),MeasurementTool.Compass.prototype.init=function(config){MeasurementTool.Compass.parent.init.apply(this,arguments),this.set("arcs",new PiObject).addListener(MeasurementTool.Compass.prototype.removeArc),this.addListener("set",this.addPivotArm),this.addListener("set",this.addPencilArm),this.addListener("set",this.addPencil),this.addListener("set",this.addHandle)},MeasurementTool.Compass.prototype.defaultConfig=function(object,property,oldConfig,newConfig){newConfig.angle=newConfig.angle||0,newConfig.radius=newConfig.radius||16,newConfig.width=newConfig.width||32,newConfig.height=newConfig.height||220,newConfig.center={x:8,y:220},newConfig.joint={x:24,y:67},MeasurementTool.Compass.parent.defaultConfig.apply(this,arguments)},MeasurementTool.Compass.prototype.setVisibility=function(object,property,oldValue,newValue){"hidden"==newValue&&this.set({angle:0,radius:16}).get("children").each(function(children,index,child){child.get("transforms").remove("translation","rotation")}),MeasurementTool.Compass.parent.setVisibility.apply(this,arguments)},MeasurementTool.Compass.prototype.addHandle=function(object,property,oldSet,newSet){var canvas=this.get("canvas").get("canvas");newSet.push(this.get("children").set("handle",new MeasurementTool.Set({set:canvas.set([canvas.rect(13.5,20,5,10).attr({fill:"#808285",stroke:"#6D6E71","stroke-miterlimit":"10"}),canvas.rect(11,0,10,20).attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.rect(0,25,32,50,6).attr({fill:"#808285",stroke:"#6D6E71","stroke-miterlimit":"10"}),canvas.path("M12.5,44 l7,0 l3,6 l-3,6 l-7,0 l-3,-6 z").attr({fill:"#F1F2F2",stroke:"#BCBEC0","stroke-miterlimit":"10"}),canvas.circle(16,50,2.33).attr({fill:"#F1F2F2",stroke:"#BCBEC0","stroke-miterlimit":"10"})]).attr({cursor:"move"}).drag(this.rotation.drag,this.rotation.start,this.rotation.stop,this,this,this)})).get("set"))},MeasurementTool.Compass.prototype.addPivotArm=function(object,property,oldSet,newSet){var canvas=this.get("canvas").get("canvas");newSet.push(this.get("children").set("pivot_arm",new MeasurementTool.Set({rotation:0,center:{x:8,y:220},set:canvas.set([canvas.path("M7,205 l2,0 l-1,15 z").attr({fill:"none",stroke:"#BCBEC0","stroke-miterlimit":"10"}),canvas.rect(3,65,10,140).attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.circle(8,195,7).attr({fill:"#F1F2F2",stroke:"#BCBEC0","stroke-miterlimit":"10"}),canvas.circle(8,195,2.5).attr({fill:"#F1F2F2",stroke:"#BCBEC0","stroke-miterlimit":"10"}),canvas.rect(-3,65,22,155).attr(this.get("dragHandleAttributes"))]).attr({cursor:"move"}).drag(function(dx,dy,canvasX,canvasY){this.translation.drag.apply(this,arguments)},function(canvasX,canvasY,event){this.translation.start.apply(this,arguments)},function(canvasX,canvasY,event){this.translation.stop.apply(this,arguments)},this,this,this)})).get("set"))},MeasurementTool.Compass.prototype.addPencilArm=function(object,property,oldSet,newSet){var start,canvas=this.get("canvas").get("canvas");newSet.push(this.get("children").set("pencil_arm",new MeasurementTool.Set({rotation:0,center:{x:24,y:67},set:canvas.set([canvas.rect(19,65,10,100).attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.rect(13,65,22,100).attr(this.get("dragHandleAttributes"))]).attr({cursor:"e-resize"}).drag(function(dx,dy,canvasX,canvasY){my={},my.offset=this.get("offset"),my.children=this.get("children"),my.transforms=this.get("transforms"),my.translation=my.transforms.get("translation"),my.rotation=my.transforms.get("rotation"),my.P1=my.children.get("pivot_arm").get("transforms").get("rotation"),my.P2=my.children.get("pencil_arm").get("transforms").get("rotation"),my.triangle=this.set("mouse",{x:canvasX,y:canvasY}),my.triangle.gap=21,my.triangle.dx<0&&(my.triangle.gap=-my.triangle.gap),my.triangle.h1=start.h1,my.triangle.h2=start.h2,my.LIMIT=my.triangle.h3+my.triangle.h1+Math.abs(my.triangle.gap),my.triangle.dx<-my.LIMIT?my.triangle.dx=-my.LIMIT:my.triangle.dx>my.LIMIT&&(my.triangle.dx=my.LIMIT);var a=.25-Math.pow(my.triangle.h3/my.triangle.h2,2),b=Math.abs(my.triangle.dx-my.triangle.gap)/2,c=Math.pow(Math.abs(my.triangle.dx-my.triangle.gap),2)/4;my.triangle.x2=(-b-Math.sqrt(Math.pow(b,2)-4*a*c))/(2*a),my.triangle.x2<0&&(my.triangle.x2=(-b+Math.sqrt(Math.pow(b,2)-4*a*c))/(2*a)),my.triangle.dx<0&&(my.triangle.x2=-my.triangle.x2),my.triangle.x3=(my.triangle.dx-my.triangle.gap+my.triangle.x2)/2,my.triangle.A=Math.acos(my.triangle.x3/my.triangle.h3),my.triangle.y3=my.triangle.h3*Math.sin(my.triangle.A),my.triangle.dy=my.triangle.h3-my.triangle.y3,my.pivot_angle=this.set("angle",90-Raphael.deg(my.triangle.A)),this.set("radius",2*my.triangle.x3+(my.triangle.dx>=0?16:-16)),my.children.get("pivot_arm").get("transforms").set({rotation:{angle:my.pivot_angle,x:my.P1.x,y:my.P1.y}}),my.children.get("handle").get("transforms").set({translation:{x:my.triangle.dx<0?my.triangle.x3-16:my.triangle.x3,y:my.triangle.dy}}),my.children.get("pencil_arm").get("transforms").set({rotation:{angle:-my.pivot_angle,x:my.P2.x,y:my.P2.y},translation:{x:my.triangle.dx<0?my.triangle.x3-32:my.triangle.x3,y:my.triangle.dy}}),my.children.get("pencil").get("transforms").set({rotation:{angle:-my.pivot_angle,x:my.P2.x,y:my.P2.y},translation:{x:my.triangle.dx<0?my.triangle.x3-32:my.triangle.x3,y:my.triangle.dy}}),Math.abs(my.triangle.dx)>Math.abs(my.triangle.gap)&&(0==my.triangle.x2?my.triangle.y2=my.triangle.h2:my.triangle.y2=my.triangle.x2*Math.tan(my.triangle.A),my.delta={angle:Raphael.rad((start.rotation.angle-(my.triangle.dx<0?180:0))%360)-Math.atan(Math.abs(my.triangle.y2)/my.triangle.dx),h:Math.sqrt(Math.pow(my.triangle.y2,2)+Math.pow(my.triangle.dx,2))},my.delta.x=my.offset.x+my.translation.x+start.rotation.x+my.delta.h*Math.cos(my.delta.angle),my.delta.y=my.offset.y+my.translation.y+start.rotation.y+my.delta.h*Math.sin(my.delta.angle),my.delta.rotation=Raphael.angle(canvasX,canvasY,my.delta.x,my.delta.y,my.offset.x+start.rotation.x+my.translation.x,my.offset.y+start.rotation.y+my.translation.y),my.rotation.angle=start.rotation.angle+my.delta.rotation),my.transforms.set("rotation",my.rotation);var angle=my.rotation.angle+my.pivot_angle;if(angle=my.triangle.dx>=0?angle%360:(angle-90)%360,(angle=angle>=0?angle:angle+360)>=0&&angle<=90)cursor="e-resize";else if(angle>90&&angle<180)cursor="s-resize";else if(angle>=180&&angle<=270)cursor="w-resize";else if(angle>270&&angle<360)var cursor="n-resize";my.children.get("pencil_arm").get("set").attr({cursor:cursor})},function(canvasX,canvasY,event){this.addListener("mouse",this.setMouse),start=this.set("mouse",{x:canvasX,y:canvasY})},function(canvasX,canvasY,event){this.removeListener("mouse",this.setMouse)},this,this,null)})).get("set"))},MeasurementTool.Compass.prototype.setMouse=function(object,property,oldMouse,newMouse){var offset=this.get("offset"),transforms=this.get("transforms"),translation=transforms.get("translation"),rotation=transforms.get("rotation"),pivot=Raphael.rad(90-this.get("children").get("pivot_arm").get("transforms").get("rotation").angle);newMouse.rotation=rotation,newMouse.dAngle=Raphael.rad(Raphael.angle(newMouse.x,newMouse.y,offset.x+rotation.x+translation.x,offset.y+rotation.y+translation.y)-(rotation.angle||360)),newMouse.x<offset.x+rotation.x+translation.x&&(newMouse.dAngle=-newMouse.dAngle),newMouse.dh=Math.sqrt(Math.pow(newMouse.x-(offset.x+rotation.x+translation.x),2)+Math.pow(offset.y+rotation.y+translation.y-newMouse.y,2)),newMouse.dx=newMouse.dh*Math.cos(newMouse.dAngle),newMouse.dy=newMouse.dh*Math.sin(newMouse.dAngle),newMouse.y2=newMouse.dy,newMouse.h2=Math.abs(newMouse.y2/Math.sin(pivot)),newMouse.x2=Math.abs(newMouse.y2/Math.tan(pivot)),newMouse.h3=153,newMouse.h1=newMouse.h3-newMouse.h2},MeasurementTool.Compass.prototype.addPencil=function(object,property,oldSet,newSet){var arc,canvas=this.get("canvas").get("canvas");newSet.push(this.get("children").set("pencil",new MeasurementTool.Set({rotation:0,center:{x:24,y:67},set:canvas.set([canvas.rect(23.5,205,1,15).attr({fill:"none",stroke:"#231F20","stroke-miterlimit":"10"}),canvas.rect(23,165,2,12).attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.rect(20.5,177,7,10).attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.rect(22.5,187,3.5,3).attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.path("M22,190 l4,0 l-1,15 l-2,0 l-1,-15").attr({fill:"#D1D3D4",stroke:"#808285","stroke-miterlimit":"10"}),canvas.rect(13,165,22,55).attr(this.get("dragHandleAttributes"))]).drag(function(dx,dy,canvasX,canvasY){this.rotation.drag.apply(this,arguments);var radius=this.get("radius"),angle=this.get("transforms").get("rotation").angle-(radius<0?180:0),start=arc.get("start"),end=arc.get("end");angle<start?arc.set("start",angle):angle>end&&arc.set("end",angle)},function(canvasX,canvasY,event){this.rotation.start.apply(this,arguments);var radius=this.get("radius"),transforms=this.get("transforms"),translation=transforms.get("translation"),rotation=transforms.get("rotation"),angle=rotation.angle-(radius<0?180:0);this.get("arcs").add(arc=new MeasurementTool.Arc({canvas:this.get("canvas"),center:{x:rotation.x+translation.x,y:rotation.y+translation.y},radius:Math.abs(radius),start:angle,end:angle}))},null,this,this,null)})).get("set"))},MeasurementTool.Compass.prototype.removeArc=function(arcs,index,oldArc,newArc){""!=oldArc&&(oldArc.get("node").remove(),oldArc.destroy())},"undefined"==typeof MeasurementTool&&(MeasurementTool={}),MeasurementTool.Arc=PiObject.extend(),MeasurementTool.Arc.prototype.init=function(config){(config=config||{}).radius=Math.abs(config.radius),config["stroke-width"]=config["stroke-width"]||13,MeasurementTool.Arc.parent.init.apply(this,arguments),this.addListener("radius",this.positiveRadius,!1),this.addListener("canvas",this.addCanvas)},MeasurementTool.Arc.prototype.positiveRadius=function(object,property,oldValue,newValue){if(newValue<0)return Math.abs(newValue)},MeasurementTool.Arc.prototype.addCanvas=function(object,property,oldCanvas,newCanvas){this.addListener("center",this.render,!1),this.addListener("start",this.render,!1),this.addListener("end",this.render,!1),this.render()},MeasurementTool.Arc.prototype.render=function(object,property,oldValue,newValue){if("node"!=property){var large_arc_flag,sweep_flag=this.get("direction"),center=this.get("center"),radius=this.get("radius"),start=this.get("start"),end=this.get("end");if(""==sweep_flag&&(start<end?sweep_flag="1":start>end&&(sweep_flag="0"),""!=sweep_flag?this.set("direction",sweep_flag):sweep_flag="0"),large_arc_flag=Math.abs(end-start)>=180?1:0,this.exists("node")&&this.get("node").remove(),Math.abs(end-start)>=360)node=this.get("canvas").get("canvas").circle(center.x,center.y,radius);else{start=parseInt(start)*Math.PI/180,start=[center.x+radius*Math.cos(start),center.y+radius*Math.sin(start)].join(","),end=parseInt(end)*Math.PI/180,end=[center.x+radius*Math.cos(end),center.y+radius*Math.sin(end)].join(",");var path=["M",start,"A",[radius,radius].join(","),"0",[large_arc_flag,sweep_flag].join(","),end].join(" "),node=this.get("canvas").get("canvas").path(path)}node.attr(this.get("config")),this.set("node",node)}},function(CM){function MT_setVisibility(value){var toolContainer=this.get("canvas").canvas&&Util.Browser.isIOS()&&Util.Browser.getIOSVersion()<7?this.get("canvas").canvas.parentNode:null;return"hidden"==value||"visible"==this.get("visibility")?(toolContainer&&YUD.addClass(toolContainer,"hideMeasuring"),this.set("visibility","hidden")):(toolContainer&&YUD.removeClass(toolContainer,"hideMeasuring"),this.set("visibility","visible"))}function MTApplication(arg){var page=arg.page,imgItem=arg.imgItem,mtIndex=arg.mtIndex,lineEnabled=arg.lineEnabled,compassEnabled=arg.compassEnabled,zoomFactor=arg.zoomFactor,mtContainer=imgItem.parentNode.parentNode,mtElem=imgItem.parentNode,dataMTConfigWidth=YUD.getAttribute(imgItem,"data-mt-config-width")||500,dataMTConfigHeight=YUD.getAttribute(imgItem,"data-mt-config-height")||300;this.dataMTConfigWidth=dataMTConfigWidth,this.dataMTConfigHeight=dataMTConfigHeight;var imgSrc=YUD.getAttribute(imgItem,"src"),toolID=page.id+"_"+mtIndex,toolBox=[],doc=page.getDoc(),imgElem=doc.createElement("img"),imgParents=doc.createElement("div"),buttonContainer=doc.createElement("div"),measuringElem=doc.createElement("div");if(lineEnabled){var lineButton=doc.createElement("button");lineButton.setAttribute("id","ToggleStraightLine_"+toolID),YUD.addClass(lineButton,"measure_straight off"),YUE.addListener(lineButton,"click",function(e){YUE.stopEvent(e),compassEnabled&&(MT_setVisibility.call(page.mt[mtIndex].compass,"hidden"),compassButton.className="measure_compass off");var lineToolStatus=MT_setVisibility.call(page.mt[mtIndex].line);this.className="visible"==lineToolStatus?"measure_straight on":"measure_straight off"}),buttonContainer.appendChild(lineButton);var line_mt=new MeasurementTool.StraightLine({visibility:"hidden"});line_mt.set("zoomFactor",zoomFactor),toolBox.push(line_mt),this.line=line_mt}if(compassEnabled){var compassButton=doc.createElement("button");compassButton.setAttribute("id","ToggleCompass_"+toolID),YUD.addClass(compassButton,"measure_compass off"),YUE.addListener(compassButton,"click",function(e){YUE.stopEvent(e),lineEnabled&&(MT_setVisibility.call(page.mt[mtIndex].line,"hidden"),lineButton.className="measure_straight off");var compassToolStatus=MT_setVisibility.call(page.mt[mtIndex].compass);this.className="visible"==compassToolStatus?"measure_compass on":"measure_compass off"}),buttonContainer.appendChild(compassButton);var compass_mt=new MeasurementTool.Compass({visibility:"hidden"});toolBox.push(compass_mt),this.compass=compass_mt}if(lineEnabled||compassEnabled){var resetButton=doc.createElement("button");resetButton.setAttribute("id","RestCanvas_"+toolID),YUD.addClass(resetButton,"measure_reset off"),YUE.addListener(resetButton,"click",function(e){YUE.stopEvent(e),lineEnabled&&(MT_setVisibility.call(page.mt[mtIndex].line,"hidden"),lineButton.className="measure_straight off",page.mt[mtIndex].line.get("lines").removeAll()),compassEnabled&&(MT_setVisibility.call(page.mt[mtIndex].compass,"hidden"),compassButton.className="measure_compass off",page.mt[mtIndex].compass.get("arcs").removeAll())}),buttonContainer.appendChild(resetButton)}imgElem.setAttribute("src",imgSrc),imgElem.setAttribute("alt","line segments"),imgParents.setAttribute("id","measurement_"+toolID),YUD.setStyle(imgParents,"width",dataMTConfigWidth+"px"),YUD.setStyle(imgParents,"height",dataMTConfigHeight+"px"),YUD.addClass(imgParents,"contextArea illustrationContainer"),YUD.addClass(buttonContainer,"tools_measure"),YUD.addClass(measuringElem,"measuring"),imgParents.appendChild(imgElem),measuringElem.appendChild(imgParents),measuringElem.appendChild(buttonContainer),mtContainer.replaceChild(measuringElem,mtElem);var s_canvas=new MeasurementTool.Canvas({node:imgParents,width:dataMTConfigWidth,height:dataMTConfigHeight,r:20,children:new PiObject(toolBox)}),canvasStyle=s_canvas.get("canvas").canvas.style;canvasStyle.removeProperty("left"),canvasStyle.removeProperty("top"),this.canvas=s_canvas;this.zoomMt=function(zoomfacor){var curCanvas=this.canvas,curSvgElem=curCanvas.get("canvas").canvas,zoomCtnWidth=dataMTConfigWidth*zoomfacor,zoomCtnHeight=dataMTConfigHeight*zoomfacor;this.line&&this.line.set("zoomFactor",zoomfacor),curCanvas&&(curCanvas.get("canvas").setViewBox(0,0,dataMTConfigWidth,dataMTConfigHeight),YUD.setStyle(imgParents,"width",zoomCtnWidth+"px"),YUD.setStyle(imgParents,"height",zoomCtnHeight+"px"),YUD.setAttribute(curSvgElem,"width",zoomCtnWidth),YUD.setAttribute(curSvgElem,"height",zoomCtnHeight))}}"function"==typeof Raphael&&"object"==typeof MeasurementTool&&(TDS.MT_toggleRuler=function(event,page){if(!page.ruler)return!1;var zoomFactor=page.getZoomFactor();return"visible"==MT_setVisibility.call(page.ruler)?(page.ruler.setScale(0,0,0,zoomFactor),this.className="on"):this.className="off",!0},TDS.MT_toggleProtractor=function(event,page){if(!page.protractor)return!1;var zoomFactor=page.getZoomFactor();return"visible"==MT_setVisibility.call(page.protractor)?(page.protractor.setScale(0,0,0,zoomFactor),this.className="on"):this.className="off",!0},CM.onPageEvent("available",function(page){var pageEl=page.getElement(),doc=page.getDoc(),ruler=null,protractor=null,zoomFactor=page.getZoomFactor(),imgElements=Util.Array.slice(pageEl.getElementsByTagName("img")),mtIndex=0,rightBoundary=doc.body.clientWidth,bottomBoundary=doc.body.clientHeight-doc.getElementById("topBar").clientHeight;page.mt=[],YUD.batch(imgElements,function(imgItem){var rulerEnabled=YUD.getAttribute(imgItem,"data-mt-ruler-enabled"),protractorEnabled=YUD.getAttribute(imgItem,"data-mt-protractor-enabled"),lineEnabled=YUD.getAttribute(imgItem,"data-mt-line-enabled"),compassEnabled=YUD.getAttribute(imgItem,"data-mt-compass-enabled"),pageScaleToolClassName=Util.Browser.isIOS()&&Util.Browser.getIOSVersion()<7?"mtPageScaleTools hideMeasuring":"mtPageScaleTools";if(rulerEnabled&&null==ruler){var rulerMin=YUD.getAttribute(imgItem,"data-mt-ruler-min"),rulerMax=YUD.getAttribute(imgItem,"data-mt-ruler-max"),rulerSystem=YUD.getAttribute(imgItem,"data-mt-ruler-system"),rulerLabel=YUD.getAttribute(imgItem,"data-mt-ruler-label");(ruler=new MeasurementTool.Ruler({id:"Ruler_"+page.id,parent:pageEl,visibility:"hidden",classname:pageScaleToolClassName,min:rulerMin,max:rulerMax,system:rulerSystem,label:rulerLabel})).set("rightBoundary",rightBoundary),ruler.set("bottomBoundary",bottomBoundary),page.ruler=ruler,page.MT_toggleRuler=TDS.MT_toggleRuler}if(protractorEnabled&&null==protractor){var protractorSystem=YUD.getAttribute(imgItem,"data-mt-protractor-system"),protractorLabel=YUD.getAttribute(imgItem,"data-mt-protractor-label");(protractor=new MeasurementTool.Protractor({id:"Protractor_"+page.id,parent:pageEl,visibility:"hidden",classname:pageScaleToolClassName,system:protractorSystem,label:protractorLabel})).set("rightBoundary",rightBoundary),protractor.set("bottomBoundary",bottomBoundary),page.protractor=protractor,page.MT_toggleProtractor=TDS.MT_toggleProtractor}if(lineEnabled||compassEnabled){var mtArg={page:page,imgItem:imgItem,mtIndex:mtIndex,lineEnabled:lineEnabled,compassEnabled:compassEnabled,zoomFactor:zoomFactor};page.mt[mtIndex]=new MTApplication(mtArg),mtIndex++}},this,!0)}),CM.onPageEvent("show",function(page){if(page.ruler||page.protractor){var accProps=TDS.getAccommodationProperties();if(accProps&&accProps.hasReverseContrast()){var color="#808080";if(page.ruler){var rulerEls=page.ruler.get("children");rulerEls.get("tickmarksR").forEach(function(element){element.attr("stroke",color)}),rulerEls.get("outline").attr("stroke",color),rulerEls.get("label").attr("stroke",color)}if(page.protractor){var protractorEls=page.protractor.get("children");protractorEls.get("tickmarksR").forEach(function(element){element.attr("stroke",color)}),protractorEls.get("tickmarks").forEach(function(element){element.attr("stroke",color)}),protractorEls.get("outline").forEach(function(element){element.attr("stroke",color)}),protractorEls.get("label").attr("stroke",color)}}}}),CM.onPageEvent("zoom",function(page,item){if(page.mt||page.ruler||page.protractor){var zoomFactor=page.getZoomFactor();if(page.mt)for(var i=0;i<page.mt.length;i++)page.mt[i].zoomMt(zoomFactor);page.ruler&&page.ruler.setScale(0,0,0,zoomFactor),page.protractor&&page.protractor.setScale(0,0,0,zoomFactor)}}),CM.onPageEvent("hide",function(page){page.ruler&&"visible"==page.ruler.get("visibility")&&page.ruler.set("visibility","hidden"),page.protractor&&"visible"==page.protractor.get("visibility")&&page.protractor.set("visibility","hidden")}))}(ContentManager),void 0===Simulator||!Simulator)var Simulator={};Simulator.nameSpace=function(){for(var parts,nsObj=null,i=0;i<arguments.length;i++){parts=(""+arguments[i]).split("."),nsObj=Simulator;for(var j="Simulator"===parts[0]?1:0;j<parts.length;j++)nsObj[parts[j]]=nsObj[parts[j]]||{},nsObj=nsObj[parts[j]]}return console.log("Set up "+arguments[0]+"."+arguments[1]+" namespace"),nsObj},Simulator.Animation=Simulator.nameSpace("Simulator","Animation"),Simulator.Control=Simulator.nameSpace("Simulator","Control"),Simulator.Display=Simulator.nameSpace("Simulator","Display"),Simulator.Input=Simulator.nameSpace("Simulator","Input"),Simulator.Utils=Simulator.nameSpace("Simulator","Utils");var swfobject=function(){function callDomLoadFunctions(){if(!isDomLoaded){try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t)}catch(e){return}isDomLoaded=!0;for(var dl=domLoadFnArr.length,i=0;i<dl;i++)domLoadFnArr[i]()}}function addDomLoadEvent(fn){isDomLoaded?fn():domLoadFnArr[domLoadFnArr.length]=fn}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF)win.addEventListener("load",fn,!1);else if(typeof doc.addEventListener!=UNDEF)doc.addEventListener("load",fn,!1);else if(typeof win.attachEvent!=UNDEF)addListener(win,"onload",fn);else if("function"==typeof win.onload){var fnOld=win.onload;win.onload=function(){fnOld(),fn()}}else win.onload=fn}function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0],o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;!function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");d&&(d=d.split(" ")[1].split(","),ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}else if(counter<10)return counter++,void setTimeout(arguments.callee,10);b.removeChild(o),t=null,matchVersions()}()}else matchVersions()}function matchVersions(){var rl=regObjArr.length;if(rl>0)for(var i=0;i<rl;i++){var id=regObjArr[i].id,cb=regObjArr[i].callbackFn,cbObj={success:!1,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj)if(!hasPlayerVersion(regObjArr[i].swfVersion)||ua.wk&&ua.wk<312)if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall,att.width=obj.getAttribute("width")||"0",att.height=obj.getAttribute("height")||"0",obj.getAttribute("class")&&(att.styleclass=obj.getAttribute("class")),obj.getAttribute("align")&&(att.align=obj.getAttribute("align"));for(var par={},p=obj.getElementsByTagName("param"),pl=p.length,j=0;j<pl;j++)"movie"!=p[j].getAttribute("name").toLowerCase()&&(par[p[j].getAttribute("name")]=p[j].getAttribute("value"));showExpressInstall(att,par,id,cb)}else displayAltContent(obj),cb&&cb(cbObj);else setVisibility(id,!0),cb&&(cbObj.success=!0,cbObj.ref=getObjectById(id),cb(cbObj))}else if(setVisibility(id,!0),cb){var o=getObjectById(id);o&&typeof o.SetVariable!=UNDEF&&(cbObj.success=!0,cbObj.ref=o),cb(cbObj)}}}function getObjectById(objectIdStr){var r=null,o=getElementById(objectIdStr);if(o&&"OBJECT"==o.nodeName)if(typeof o.SetVariable!=UNDEF)r=o;else{var n=o.getElementsByTagName(OBJECT)[0];n&&(r=n)}return r}function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312)}function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=!0,storedCallbackFn=callbackFn||null,storedCallbackObj={success:!1,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){"OBJECT"==obj.nodeName?(storedAltContent=abstractAltContent(obj),storedAltContentId=null):(storedAltContent=obj,storedAltContentId=replaceElemIdStr),att.id=EXPRESS_INSTALL_ID,(typeof att.width==UNDEF||!/%$/.test(att.width)&&parseInt(att.width,10)<310)&&(att.width="310"),(typeof att.height==UNDEF||!/%$/.test(att.height)&&parseInt(att.height,10)<137)&&(att.height="137"),doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF?par.flashvars+="&"+fv:par.flashvars=fv,ua.ie&&ua.win&&4!=obj.readyState){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew",newObj.setAttribute("id",replaceElemIdStr),obj.parentNode.insertBefore(newObj,obj),obj.style.display="none",function(){4==obj.readyState?obj.parentNode.removeChild(obj):setTimeout(arguments.callee,10)}()}createSWF(att,par,replaceElemIdStr)}}function displayAltContent(obj){if(ua.ie&&ua.win&&4!=obj.readyState){var el=createElement("div");obj.parentNode.insertBefore(el,obj),el.parentNode.replaceChild(abstractAltContent(obj),el),obj.style.display="none",function(){4==obj.readyState?obj.parentNode.removeChild(obj):setTimeout(arguments.callee,10)}()}else obj.parentNode.replaceChild(abstractAltContent(obj),obj)}function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie)ac.innerHTML=obj.innerHTML;else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c)for(var cl=c.length,i=0;i<cl;i++)1==c[i].nodeType&&"PARAM"==c[i].nodeName||8==c[i].nodeType||ac.appendChild(c[i].cloneNode(!0))}}return ac}function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312)return r;if(el)if(typeof attObj.id==UNDEF&&(attObj.id=id),ua.ie&&ua.win){var att="";for(var i in attObj)attObj[i]!=Object.prototype[i]&&("data"==i.toLowerCase()?parObj.movie=attObj[i]:"styleclass"==i.toLowerCase()?att+=' class="'+attObj[i]+'"':"classid"!=i.toLowerCase()&&(att+=" "+i+'="'+attObj[i]+'"'));var par="";for(var j in parObj)parObj[j]!=Object.prototype[j]&&(par+='<param name="'+j+'" value="'+parObj[j]+'" />');el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>",objIdArr[objIdArr.length]=attObj.id,r=getElementById(attObj.id)}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj)attObj[m]!=Object.prototype[m]&&("styleclass"==m.toLowerCase()?o.setAttribute("class",attObj[m]):"classid"!=m.toLowerCase()&&o.setAttribute(m,attObj[m]));for(var n in parObj)parObj[n]!=Object.prototype[n]&&"movie"!=n.toLowerCase()&&createObjParam(o,n,parObj[n]);el.parentNode.replaceChild(o,el),r=o}return r}function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName),p.setAttribute("value",pValue),el.appendChild(p)}function removeSWF(id){var obj=getElementById(id);obj&&"OBJECT"==obj.nodeName&&(ua.ie&&ua.win?(obj.style.display="none",function(){4==obj.readyState?removeObjectInIE(id):setTimeout(arguments.callee,10)}()):obj.parentNode.removeChild(obj))}function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj)"function"==typeof obj[i]&&(obj[i]=null);obj.parentNode.removeChild(obj)}}function getElementById(id){var el=null;try{el=doc.getElementById(id)}catch(e){}return el}function createElement(el){return doc.createElement(el)}function addListener(target,eventType,fn){target.attachEvent(eventType,fn),listenersArr[listenersArr.length]=[target,eventType,fn]}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");return v[0]=parseInt(v[0],10),v[1]=parseInt(v[1],10)||0,v[2]=parseInt(v[2],10)||0,pv[0]>v[0]||pv[0]==v[0]&&pv[1]>v[1]||pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]}function createCSS(sel,decl,media,newStyle){if(!ua.ie||!ua.mac){var h=doc.getElementsByTagName("head")[0];if(h){var m=media&&"string"==typeof media?media:"screen";if(newStyle&&(dynamicStylesheet=null,dynamicStylesheetMedia=null),!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css"),s.setAttribute("media",m),dynamicStylesheet=h.appendChild(s),ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0&&(dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1]),dynamicStylesheetMedia=m}ua.ie&&ua.win?dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT&&dynamicStylesheet.addRule(sel,decl):dynamicStylesheet&&typeof doc.createTextNode!=UNDEF&&dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"))}}}function setVisibility(id,isVisible){if(autoHideShow){var v=isVisible?"visible":"hidden";isDomLoaded&&getElementById(id)?getElementById(id).style.visibility=v:createCSS("#"+id,"visibility:"+v)}}function urlEncodeIfNecessary(s){return null!=/[\\\"<>\.;]/.exec(s)&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s}var storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,dynamicStylesheet,dynamicStylesheetMedia,UNDEF="undefined",OBJECT="object",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",win=window,doc=document,nav=navigator,plugin=!1,domLoadFnArr=[function(){plugin?testPlayerVersion():matchVersions()}],regObjArr=[],objIdArr=[],listenersArr=[],isDomLoaded=!1,isExpressInstallActive=!1,autoHideShow=!0,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=/win/.test(p?p:u),mac=/mac/.test(p?p:u),webkit=!!/webkit/.test(u)&&parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),ie=!1,playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins["Shockwave Flash"]==OBJECT)!(d=nav.plugins["Shockwave Flash"].description)||typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin||(plugin=!0,ie=!1,d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof win.ActiveXObject!=UNDEF)try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");a&&(d=a.GetVariable("$version"))&&(ie=!0,d=d.split(" ")[1].split(","),playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}catch(e){}return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac}}();ua.w3&&((typeof doc.readyState!=UNDEF&&"complete"==doc.readyState||typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))&&callDomLoadFunctions(),isDomLoaded||(typeof doc.addEventListener!=UNDEF&&doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,!1),ua.ie&&ua.win&&(doc.attachEvent("onreadystatechange",function(){"complete"==doc.readyState&&(doc.detachEvent("onreadystatechange",arguments.callee),callDomLoadFunctions())}),win==top&&function(){if(!isDomLoaded){try{doc.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}callDomLoadFunctions()}}()),ua.wk&&function(){isDomLoaded||(/loaded|complete/.test(doc.readyState)?callDomLoadFunctions():setTimeout(arguments.callee,0))}(),addLoadEvent(callDomLoadFunctions))),ua.ie&&ua.win&&window.attachEvent("onunload",function(){for(var ll=listenersArr.length,i=0;i<ll;i++)listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);for(var il=objIdArr.length,j=0;j<il;j++)removeSWF(objIdArr[j]);for(var k in ua)ua[k]=null;ua=null;for(var l in swfobject)swfobject[l]=null;swfobject=null});return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr,regObj.swfVersion=swfVersionStr,regObj.expressInstall=xiSwfUrlStr,regObj.callbackFn=callbackFn,regObjArr[regObjArr.length]=regObj,setVisibility(objectIdStr,!1)}else callbackFn&&callbackFn({success:!1,id:objectIdStr})},getObjectById:function(objectIdStr){if(ua.w3)return getObjectById(objectIdStr)},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,simDocument,callbackFn){null!=simDocument&&(doc=simDocument);var callbackObj={success:!1,id:replaceElemIdStr};ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr?(setVisibility(replaceElemIdStr,!1),addDomLoadEvent(function(){widthStr+="",heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT)for(var i in attObj)att[i]=attObj[i];att.data=swfUrlStr,att.width=widthStr,att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT)for(var j in parObj)par[j]=parObj[j];if(flashvarsObj&&typeof flashvarsObj===OBJECT)for(var k in flashvarsObj)typeof par.flashvars!=UNDEF?par.flashvars+="&"+k+"="+flashvarsObj[k]:par.flashvars=k+"="+flashvarsObj[k];if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);att.id==replaceElemIdStr&&setVisibility(replaceElemIdStr,!0),callbackObj.success=!0,callbackObj.ref=obj}else{if(xiSwfUrlStr&&canExpressInstall())return att.data=xiSwfUrlStr,void showExpressInstall(att,par,replaceElemIdStr,callbackFn);setVisibility(replaceElemIdStr,!0)}callbackFn&&callbackFn(callbackObj)})):callbackFn&&callbackFn(callbackObj)},switchOffAutoHideShow:function(){autoHideShow=!1},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){return ua.w3?createSWF(attObj,parObj,replaceElemIdStr):void 0},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){ua.w3&&canExpressInstall()&&showExpressInstall(att,par,replaceElemIdStr,callbackFn)},removeSWF:function(objElemIdStr){ua.w3&&removeSWF(objElemIdStr)},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){ua.w3&&createCSS(selStr,declStr,mediaStr,newStyleBoolean)},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)&&(q=q.split("?")[1]),null==param)return urlEncodeIfNecessary(q);for(var pairs=q.split("&"),i=0;i<pairs.length;i++)if(pairs[i].substring(0,pairs[i].indexOf("="))==param)return urlEncodeIfNecessary(pairs[i].substring(pairs[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);obj&&storedAltContent&&(obj.parentNode.replaceChild(storedAltContent,obj),storedAltContentId&&(setVisibility(storedAltContentId,!0),ua.ie&&ua.win&&(storedAltContent.style.display="block")),storedCallbackFn&&storedCallbackFn(storedCallbackObj)),isExpressInstallActive=!1}}}}();Object.size=function(obj){var size=0;if(obj.length&&(size=obj.length),0==size)try{for(var propName in obj)obj.hasOwnProperty(propName)&&size++}catch(err){return logError("Javascript error: "+err.message+" occurred. Object size could not be determined."),Simulator.Constants.FAILURE}return size},Simulator.HTML2JSMap=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="HTML2JSMap",map=[],dbg=function(){return sim.getDebug()};this.inspect=function(embedded,force){var buff=[];buff.push("Inspecting "+source+"\n");for(var i in map)buff.push(i+" = "+map[i].getName()+" "+map[i].getEname()+"\n");if(buff.push("End Inspecting "+source+"\n\n"),embedded)return buff.join("");1==force?debugf(buff.join("")):debug(buff.join(""))},this.mapJSFromHTML=function(jsObject,htmlElement){jsObject&&htmlElement?map[htmlElement.id]=jsObject:dbg().logError(source,"jsOject or htmlElement is null. Cannot map JSFromHTML")},this.getJSFromHTML=function(htmlElement){return map[htmlElement.id]}},Simulator.Constants=function(){},Simulator.Constants.HIDDEN=!1,Simulator.Constants.VISIBLE=!0,Simulator.Constants.SUCCESS=1,Simulator.Constants.NONE=0,Simulator.Constants.FAILURE=-1,Simulator.Constants.YES=1,Simulator.Constants.NO=0,Simulator.Constants.SIM_CONTAINER_NAME="container",Simulator.Constants.TIME_BASED_ANIMATION="timeline",Simulator.Constants.INTERACTIVE_ANIMATION="interactive",Simulator.Constants.STATIC_ANIMATION="static",Simulator.Constants.INPUT_PANEL_NAME="inputPanel",Simulator.Constants.ANIMATION_PANEL_NAME="animationPanel",Simulator.Constants.DATA_DISPLAY_PANEL_NAME="dataOutputPanel",Simulator.Constants.CONTROL_PANEL_NAME="controlElementsPanel",Simulator.Constants.ITERATION_DELIMITTER="\\0x1D\\",Simulator.Constants.KEY_VALUE_DELIMITTER="\\0x1F\\",Simulator.Constants.PAIR_DELIMITTER="\\0x1E\\",Simulator.Constants.MULTIPLE_VALUE_DELIMITTER="|",Simulator.Constants.SPEECH_LABEL_PREFIX="Move To ",Simulator.Constants.SPEECH_ITEM_VALUE_PREFIX="Select ",Simulator.Constants.SPEECH_CMD_ITEM_PREFIX="Click ",Simulator.Constants.ANIMATION_FINISHED="animationFinished",Simulator.Constants.ANIMATION_STARTED="animationStarted",Simulator.Constants.ANIMATION_THREAD_FINISHED="animationThreadFinished",Simulator.Constants.ANIMATION_LOADED="animationLoaded",Simulator.Constants.ANIMATION_REPORT_STATUS="reportStatus",Simulator.Constants.ANIMATION_REPORTING="animationReporting",Simulator.Constants.ANIMATION_UNRESPONSIVE="animationUnresponsive",Simulator.Constants.ANIMATION_ABORTED="animationAborted",Simulator.Constants.ANIMATION_UNABLE_TO_START="animationUnableToStart",Simulator.Constants.ANIMATION_NOT_READY=0,Simulator.Constants.PARAM_COMMAND="command",Simulator.Constants.PARAM_INFO="info",Simulator.Constants.PARAM_DATA="data",Simulator.Constants.PARAM_INPUT="input",Simulator.Constants.PARAM_UPDATE="update",Simulator.Constants.PARAM_OUTPUT="output",Simulator.Constants.PARAM_DEBUG_OUTPUT="debug",Simulator.Constants.PARAM_ERROR="error",Simulator.Constants.PARAM_ALT_TEXT="altText",Simulator.Constants.SET_ID_CMD="setID",Simulator.Constants.PLAY_CMD="play",Simulator.Constants.STOP_CMD="stop",Simulator.Constants.REWIND_CMD="rewind",Simulator.Constants.RESTART_CMD="restart",Simulator.Constants.OUTPUT_REQ_CMD="outputRequest",Simulator.Constants.ALT_TEXT_REQ_CMD="altTextRequest",Simulator.Constants.INPUT_NAME_PART=0,Simulator.Constants.INPUT_VALUE_PART=1,Simulator.Constants.START_FRAME="startFrame",Simulator.Constants.ANIMATION_COMPLETED="animationCompleted",Simulator.Constants.ANIMATION_PLAYING="animationPlaying",Simulator.Constants.ANIMATION_PAUSED="animationPaused",Simulator.Constants.ANIMATION_STOPPED="animationStopped",Simulator.Constants.ANIMATION_REWOUND="animationRewound",Simulator.Constants.ANIMATION_READY="animationReady",Simulator.Constants.ANIMATION_ERROR="animationError",Simulator.Constants.ANIMATION_PROPERTIES="properties",Simulator.Constants.GET_ANIMATION_PROPERTIES="properties",Simulator.Constants.ANIMATION_ALIVE="alive",Simulator.Constants.SIM_CALLBACK="Simulator.Animation.FlashAnimationInterface.AnimationMediaOutput",Simulator.Constants.DEFAULT_INITIAL_TRIAL_NUM=0,Simulator.Constants.NO_DATA_INDICATOR="",Simulator.Constants.HTML5_ANIMATION="html5",Simulator.Constants.FLASH_ANIMATION="flash",Simulator.Constants.IMAGE_ANIMATION="image",Simulator.Constants.HOTTEXT_ANIMATION="hotText",Simulator.Whiteboard=function(sim){var categories=[],transDictionary=function(){return sim.getTranslationDictionary()},dbg=function(){return sim.getDebug()},key=1e3*Math.random();this.addCategory=function(catName){return!(catName in categories)&&(categories[catName]=[],!0)},this.getCategory=function(name){return name in categories?categories[name]:null},this.getEnglishTranslatedCategory=function(catName){if(catName in categories){var translatedCategory=[];for(itemName in categories[catName])translatedCategory[itemName]=this.getEnglishTranslatedItem(catName,itemName);return translatedCategory}return null},this.getCategoryAsString=function(name,separator){var buff=[],num=0;if(name in categories){var cat=categories[name];for(var item in cat)cat.hasOwnProperty(item)&&(num>0&&buff.push(Simulator.Constants.PAIR_DELIMITTER+" "),buff.push(item),separator?buff.push(Simulator.Constants.KEY_VALUE_DELIMITTER+" "):buff.push(Simulator.Constants.KEY_VALUE_DELIMITTER),buff.push(this.getItem(name,item)),num++);return buff.join("")}return null},this.getCategoryAsEnglishTranslatedString=function(name,separator){var buff=[],num=0;if(name in categories){var cat=categories[name];for(var item in cat)cat.hasOwnProperty(item)&&(num>0&&buff.push(Simulator.Constants.PAIR_DELIMITTER+" "),buff.push(item),separator?buff.push(Simulator.Constants.KEY_VALUE_DELIMITTER+" "):buff.push(Simulator.Constants.KEY_VALUE_DELIMITTER),buff.push(this.getEnglishTranslatedItem(name,item)),num++);return buff.join("")}return null},this.categoryExists=function(categoryName){return categoryName in categories},this.itemExists=function(categoryName,itemName){return categoryName in categories&&itemName in categories[categoryName]},this.addItem=function(category,item){if(category in categories){var cat=categories[category];return item in cat?null:(cat[item]=null,key)}return null},this.setItem=function(category,item,value,itemKey){return category in categories&&(key==itemKey&&(categories[category][item]=value,!0))},this.getItem=function(category,theItem){return category in categories?(cat=categories[category],cat[theItem]?cat[theItem]:null):null},this.getEnglishTranslatedItem=function(category,theItem){var myItem=this.getItem(category,theItem);if(!myItem)return null;if(myItem instanceof Array){var translatedArray=[];for(var i in myItem)translatedArray.push(transDictionary().translateToEnglish(myItem[i]));return translatedArray}return transDictionary().translateToEnglish(myItem)},this.clearCategory=function(category){categories[category]&&(categories[category]=[])},this.clearWhiteboard=function(){for(var p in categories)categories[p]=[]},this.inspect=function(embedded,force){var buff=[];buff.push("Inspecting Whiteboard:"),buff.push("\n\n");for(var i in categories){var aCat=categories[i];buff.push("Inspecting "),buff.push(i),buff.push(" category:"),buff.push("\n\n");for(var k in aCat)buff.push(i),buff.push("["),buff.push(k),buff.push("] = "),buff.push(aCat[k]),buff.push("\n\n")}return embedded||(force?dbg().debugf(buff.join(""),null,!0):dbg().debug(buff.join(""),null,!0)),buff.join("")}},Simulator.Utils.Utils=function(sim){var source="Utils",timeMark=0,IE="Microsoft Internet Explorer",sequenceNumber=0,dbg=function(){return sim.getDebug()};this.getChildElement=function(id,numChild){var HTMLElement=document.getElementById(id),num=0,child=null;if(HTMLElement){var children=HTMLElement.childNodes;if(chldren.length>0){for(var i=0;i<children.length;i++)if("#"!=(child=children[i]).nodeName[0]){if(num==numChild)return child;num++}return null}return HTMLElement}dbg().logError(source,"Could not get HTMLElement")},this.applyFilter=function(functionName,data){var result=null;switch(functionName){case"max":result=Math.max.apply(Math,data);break;case"min":result=Math.min.apply(Math,data);break;case"first":result=data[0];break;case"last":result=data[data.length-1];break;case"average":for(var sum=0,i=0;i<data.length;i++)sum+=parseFloat(data[i]);result=sum/data.length;break;case"sum":for(var sum=0,i=0;i<data.length;i++)sum+=parseFloat(data[i]);result=sum;break;case"numNonZero":for(var num=0,i=0;i<data.length;i++)0!==data[i]&&num++;result=num;break;case"zeroNotNull":result="null"==data[0]?"0":data[0];break;case"blankNotNull":result="null"===data[0]?Simulator.Constants.NO_DATA_INDICATOR:data[0];break;case"blankNotZero":result=0==parseFloat(data[0])?Simulator.Constants.NO_DATA_INDICATOR:data[0];break;default:if("set["==functionName.substr(0,4)){var resultArray=[];functionName.replace(/set\s*\[/,"").replace(/\s*\]$/,"");for(var parts=functionName.substr(4).split(","),i=0;i<parts.length;i++)resultArray.push(data[parseInt(parts[i])]);result=resultArray.join(",")}}return result},this.getFileName=function(path,includeExtension){var filename=path.substring(path.lastIndexOf("/")+1),index=filename.lastIndexOf(".");return includeExtension||(filename=filename.substring(0,index)),filename},this.getElementsByClassName=function(classname,node){node||(node=document.getElementsByTagName("body")[0]);for(var a=[],re=new RegExp("\\b"+classname+"\\b"),els=node.getElementsByTagName("*"),i=0,j=els.length;i<j;i++)re.test(els[i].className)&&a.push(els[i]);return a},this.getElementsByTagValue=function(node,tagName,tagValue){node||(node=document.getElementsByTagName("body")[0]);for(var a=[],els=node.getElementsByTagName(tagName),i=0;j<els.length;i++)els[i].nodeValue==tagValue&&a.push(els[i]);return a},this.associationStoreToString=function(associationStore,sep){buff=[],num=0;for(var i in associationStore)associationStore.hasOwnProperty(i)&&(num>0&&buff.push(", "),sep&&buff.push("\n"),buff.push(i),buff.push(": "),buff.push(associationStore[i]),num++);return buff.join("")},this.assocArrayIsEmpty=function(theArray){for(var i in theArray)if(i&&theArray.hasOwnProperty(i))return!1;return!0},this.appendText=function(node,txt,noBreak){noBreak||(node.innerHTML=node.innerHTML+"<br>"),node.appendChild(document.createTextNode(txt)),noBreak||(node.innerHTML=node.innerHTML+"<br>")},this.appendBlankVertcalSpace=function(parentElement,theNum){var num=1,newBreak=null;theNum&&(num=theNum);for(var i=0;i<num;i++)(newBreak=document.createElement("br")).style.border="none",parentElement.appendChild(newBreak)},this.appendElement=function(node,tag,id,htm){var ne=document.createElement(tag);id&&(ne.id=id),htm&&(ne.innerHTML=htm),node.appendChild(ne)},this.getNextSequenceNumber=function(){return++sequenceNumber},this.replaceAll=function(inThisString,replaceThis,withThis){var re=new RegExp("["+replaceThis+"]","g");return inThisString.replace(re,withThis)},this.setObjectDimensions=function(governingObject,subjectObject){var dimensions=setDimensions(governingObject.height,governingObject.width,subjectObject.height,subjectObject.width);subjectObject.height=dimensions.height,subjectObject.width=dimensions.width},this.removeHeadingAndTrailingQuotes=function(theString,theTypeOfQuotes){var fIndex,lIndex,strLength,typeOfQuotes="both";return theTypeOfQuotes&&(typeOfQuotes=theTypeOfQuotes),theString&&(theString=theString.trim()),"double"!==typeOfQuotes&&"both"!==typeOfQuotes||(fIndex=theString.indexOf('"'),lIndex=theString.lastIndexOf('"'),strLength=theString.length,0==fIndex&&lIndex==strLength-1&&(theString=theString.substr(1,lIndex-1))),"single"!==typeOfQuotes&&"both"!==typeOfQuotes||(fIndex=theString.indexOf("'"),lIndex=theString.lastIndexOf("'"),strLength=theString.length,0==fIndex&&lIndex==strLength-1&&(theString=theString.substr(1,lIndex-1))),theString},this.setDimensions=function(governingObjectHeight,governingObjectWidth,subjectObjectHeight,subjectObjectWidth,padding){var x=subjectObjectHeight/governingObjectHeight,y=subjectObjectWidth/governingObjectWidth,z=subjectObjectHeight/subjectObjectWidth;padding||(padding=0),x>=y?subjectObjectWidth=(subjectObjectHeight=governingObjectHeight)/z:subjectObjectHeight=(subjectObjectWidth=governingObjectWidth)*z;var dimensions={};return z>1?(dimensions.width=subjectObjectWidth-padding,dimensions.height=dimensions.width*z):(dimensions.height=subjectObjectHeight-padding,dimensions.width=dimensions.height/z),dimensions},this.elementInArray=function(array,element,isSubstring){for(var i=0;i<array.length;i++)if(!isSubstring){if(array[i]==element)return!0;if(-1!=array[i].indexOf(element))return!0}return!1},this.getAttributes=function(node){var attr=[],attributes=node.attributes;if(null!=attributes&&void 0!=attributes)for(var j=0;j<attributes.length;j++)attr[attributes[j].nodeName]=attributes[j].nodeValue;return attr},this.getNumberLength=function(num){return(num+"").length},this.isInternetExplorer=function(){return-1!=navigator.userAgent.indexOf("MSIE")},this.isIE8orBelow=function(){var info=this.getBrowserInfo(["name","major version"],null);return info.name===IE&&parseInt(info["major version"])<9},this.isFireFox=function(){return-1!=navigator.userAgent.indexOf("Firefox")},this.isChrome=function(){return-1!=navigator.userAgent.indexOf("Chrome")},this.isOpera=function(){return-1!==navigator.userAgent.indexOf("Opera")},this.isSafari=function(){return-1!==navigator.userAgent.indexOf("Safari")},this.getBrowserInfo=function(infoArray,sep){navigator.appVersion;var nameOffset,verOffset,ix,nAgt=navigator.userAgent,browserName=navigator.appName,fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10);-1!==(verOffset=nAgt.indexOf("Opera"))?(browserName=opera,fullVersion=nAgt.substring(verOffset+6),-1!==(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!==(verOffset=nAgt.indexOf("MSIE"))?(browserName=IE,fullVersion=nAgt.substring(verOffset+5)):-1!==(verOffset=nAgt.indexOf("Chrome"))?(browserName="Chrome",fullVersion=nAgt.substring(verOffset+7)):-1!==(verOffset=nAgt.indexOf("Safari"))?(browserName="Safari",fullVersion=nAgt.substring(verOffset+7),-1!==(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!==(verOffset=nAgt.indexOf("Firefox"))?(browserName="Firefox",fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browserName=nAgt.substring(nameOffset,verOffset),fullVersion=nAgt.substring(verOffset+1),browserName.toLowerCase()===browserName.toUpperCase()&&(browserName=navigator.appName)),-1!==(ix=fullVersion.indexOf(";"))&&(fullVersion=fullVersion.substring(0,ix)),-1!==(ix=fullVersion.indexOf(" "))&&(fullVersion=fullVersion.substring(0,ix)),majorVersion=parseInt(""+fullVersion,10),isNaN(majorVersion)&&(fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10)),buff=[],sep||(sep=" ");for(var i=0;i<infoArray.length;i++)switch(infoArray[i]){case"name":buff.push("Name  = "+browserName);break;case"major version":buff.push("Major version = "+majorVersion);break;case"full version":buff.push("Full version = "+fullVersion);break;case"appName":buff.push("App Name = "+navigator.appName);break;case"agent":buff.push("User Agent = "+navigator.userAgent);break;case"platform":buff.push("Platform = "+navigator.platform)}return buff.join(sep)},this.markTime=function(){var d=new Date;timeMark=d.getTime()},this.getElapsedTime=function(){return(new Date).getTime()-timeMark},this.getClass=function(obj){return void 0===obj?"undefined":null===obj?"null":Object.prototype.toString.call(obj).match(/^\[object\s(.*)\]$/)[1]},this.getJSObjName=function(obj){return obj?obj.getName?obj.getName():obj.name?obj.name:this.getJSObjNameViaConstructor(obj):null},this.getJSObjNameViaConstructor=function(obj){var str=obj.constructor.name;str||(str=obj.constructor.toString());var index=str.indexOf("(");return index>-1&&0==(index=(str=str.substring(0,index)).indexOf("function"))&&(str=str.substring("function".length)),str.trim()},this.createTimeOutCallbackStr=function(obj,fctn,args){var buff=[];return buff.push(obj),buff.push("."),buff.push(fctn),buff.push("('"),buff.push(args),buff.push("')"),buff.join("")},this.bindEvent=function(el,event,handler){el.addEventListener?el.addEventListener(event,handler,!1):el.attachEvent&&el.attachEvent("on"+event,handler)},this.canPlayHtml5=function(){return!(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9)&&!(Util.Browser.getFirefoxVersion()>0&&Util.Browser.getFirefoxVersion()<4)}},Simulator.Utils.Debug=function(sim){function AssertException(message){this.message=message,AssertException.prototype.toString=function(){return"AssertException: "+this.message}}function printStackTrace(){if(isFireFox())console.trace();else if(isChrome()){var obj={};Error.captureStackTrace(obj,getStackTrace),console.log(obj)}else isInternetExplorer()||isSafari()||isOpera()||console.log("Unknown browser: "+getBrowserInfo(["name"]))}function callerLine(str){var index=str.lastIndexOf(":");return str.substr(index+1)}var Count=0,debugOn=!1,prevSetting=!1,dLevel="SimWarning",eventMgr=function(){return sim.getEventManager()},util=function(){return sim.getUtils()};this.tdebug=function(source,str1,appendCount,appendTime,str2){if("object"==typeof console&&debugOn){var buff=[];if(source)if(util().isFireFox()){var line=callerLine((new Error).stack.split("\n")[2]);buff.push(source+" line "+line+": ")}else buff.push(source+": ");buff.push(str1),appendCount&&buff.push(Count++),appendTime&&buff.push(getTime()),str2&&buff.push(str2),console.log(buff.join(" "))}},this.debug=function(source,str,obj,trace){if("object"==typeof console){var buff=[];if(debugOn){if(source)if(util().isFireFox()){var line=callerLine((new Error).stack.split("\n")[2]);buff.push(source+" line "+line+": ")}else buff.push(source+": ");buff.push(str),obj&&buff.push(" = "),buff.push(obj),buff.push("\n\n"),console.log(buff.join("")),"trace"==trace&&(console.log("--- Program stack trace: ---\n"),printStackTrace(),console.log("\n--- End of program stack trace ---\n\n"))}}},this.debugf=function(source,str,obj,trace){if("object"==typeof console){var buff=[];if(source)if(util().isFireFox()){var line=callerLine((new Error).stack.split("\n")[2]);buff.push(source+" line "+line+": ")}else buff.push(source+": ");buff.push(str),obj&&buff.push(" = "),buff.push(obj),buff.push("\n\n"),console.log(buff.join("")),"trace"==trace&&(console.log("--- Program stack trace: ---\n"),printStackTrace(),console.log("\n--- End of program stack trace ---\n\n"))}};var iDest="console";this.setIDest=function(dest){iDest=dest},this.iDebug=function(source,str,obj,force){if("object"==typeof console&&(debugOn||force)){var buff=[];if(source&&util().isFireFox()){var line=callerLine((new Error).stack.split("\n")[2]);buff.push(source+" line "+line+": ")}buff.push(str),obj&&buff.push(" = "),buff.push(obj),buff.push("\n\n"),"screen"==iDest?Simulator.showAlert("",buff.join("")):console.log(buff.join(""))}},this.writeToConsole=function(str){console.log(str)},this.inspectArray=function(source,name,theArray,doNotIinspectObjects,embedded,force){if("object"==typeof console){var buff=[],sep="\n\n";if(debugOn||force){if(source)if(util().isFireFox()){var line=callerLine((new Error).stack.split("\n")[2]);buff.push(source+" line "+line+": ")}else buff.push(source+": ");if(buff.push("Inspecting "),buff.push(name),buff.push(sep),0==theArray.length)for(var p in theArray)buff.push(name),buff.push("["),buff.push(p),buff.push("] = "),theArray[p].getSourceName?(buff.push(theArray[p].getSourceName()),buff.push(sep)):theArray[p].getName?(buff.push(theArray[p].getName()),buff.push(sep)):(buff.push(String(theArray[p])),buff.push(sep)),doNotIinspectObjects||void 0!=theArray[p].inspect&&buff.push(theArray[p].inspect(!0));else for(var i=0;i<theArray.length;i++)buff.push(name),buff.push("["),buff.push(i),buff.push("] = "),theArray[i].getSourceName&&(buff.push(theArray[i].getSourceName()),buff.push(" ")),theArray[i].getName?(buff.push(theArray[i].getName()),buff.push(sep)):(buff.push(theArray[i]),buff.push(sep)),buff.push("Inspecting "),buff.push(typeof theArray[i]),buff.push(sep),doNotIinspectObjects||void 0!=theArray[i].inspect&&buff.push(theArray[i].inspect(!0));buff.push("End of inspection of "),buff.push(name),buff.push(sep),console.log(buff.join(""))}}},this.setDebug=function(flag){prevSetting=debugOn,debugOn="on"===flag||!0===flag},this.setErrorReportLevel=function(level){dLevel="SimWarning"==level||"SimError"==level||"SimFatalError"==level?level:"SimError"},this.debugIsOn=function(){return debugOn},this.resetDebug=function(){debugOn=prevSetting},this.logWarning=function(source,str,notify,trace){logMsg=!0,"SimWarning"==dLevel&&this.debugf(source,"Warning: "+str),logMsg=!1,notify&&Simulator.showAlertWarning(str)},this.logError=function(source,str,notify,noTrace){trace="noTrace",logMsg=!0,"SimFatalError"!=dLevel&&this.debugf(source,"**** ERROR: "+str),logMsg=!1,notify&&Simulator.showAlert("**** ERROR: "+str)},this.logFatalError=function(source,str){logMsg=!0,this.debugf(source,"!!!!!! FATAL ERROR: "+str),logMsg=!1,eventMgr().postEvent(new Simulator.Event(this,"info","fatalErrorOccurred",str)),Simulator.showAlert("Fatal Error",str)},this.assert=function(exp,message){if(!exp)throw new AssertException(message)}},Simulator.Utils.Queue=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="Queue",dbg=function(){return sim.getDebug()},queue=[],offset=0;this.length=function(){return queue.length-offset},this.isEmpty=function(){return 0==queue.length},this.insertAt=function(item,index){var offsetIndex=index+offset;offsetIndex>=0&&offsetIndex<queue.length?queue.splice(offsetIndex,0,item):offsetIndex==queue.length&&queue.push(item)},this.add=function(item){queue.push(item)},this.elementAt=function(index){var offsetIndex=index+offset;return offsetIndex>=0&&offsetIndex<queue.length?queue[offsetIndex]:void 0},this.remove=function(){if(0==queue.length)return null;var item=queue[offset];return 2*++offset>=queue.length&&(queue=queue.slice(offset),offset=0),item},this.peek=function(){return queue.length>0?queue[offset]:null},this.clear=function(){for(var item=this.remove();null!=item;)item=this.remove()},this.inspect=function(embedded,force){var buff=[];buff.push("\nInspecting Queue:"),buff.push("Contains "+queue.length+(1==queue.length?" item":" items")),buff.push("Queue offset = "+offset);for(var i=offset;i<queue.length;i++)buff.push("queue["+i+"] = "+queue[i]);if(buff.push("End inspecting Queue\n"),embedded)return buff.join("\n");force?debugf(buff.join("\n")):debug(buff.join("\n"))},this.entriesAsString=function(){for(var buff=[],i=0;i<queue.length;i++)buff.push(queue[i]);return buff.join(",")}},Simulator.Utils.OrderedQueue=function(sim){Simulator.Utils.Queue.call(this,sim);dbg=function(){return sim.getDebug()},this.add=function(item){var len=this.length();if("object"!=typeof item){if(this.isEmpty())return void this.insertAt(item,0);for(var i=0;i<len;i++)if(item<this.elementAt(i))return void this.insertAt(item,i);this.insertAt(item,len)}}},Simulator.Utils.OrderedQueue.prototype=new Simulator.Utils.Queue,Simulator.Utils.OrderedQueue.parent=Simulator.Utils.Queue,Simulator.Utils.OrderedQueue.prototype.constructor=Simulator.Utils.OrderedQueue,Simulator.Utils.Stack=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="Stack";this.store=[];var dbg=function(){return sim.getDebug()};this.push=function(data){this.store.push(data)},this.pop=function(){return this.store.length>0?this.store.pop():null},this.peek=function(){return this.store[this.store.length-1]},this.inspect=function(embedded,forced){var buff=[];buff.push("\nInspecting Stack:"),buff.push("Stack contains "+this.store.length+(1==this.store.length?" element":" elements"));for(var i=this.store.length-1;i>=0;i--)"object"==typeof this.store[i]?void 0!=this.store[i].inspect&&buff.push(this.store[i].inspect(!0,!0)):buff.push("stack nonobject element: "+this.store[i]);if(buff.push("End inspecting Stack\n"),embedded)return buff.join("\n");null==forced?debug(buff.join("\n")):debugf(buff.join("\n"))},this.elementAt=function(num){if(num<this.store.length&&num>=0)return this.store[num]},this.insertAt=function(obj,index){index>=0&&index<this.store.length?this.store.splice(index,0,obj):index==this.store.length&&this.store.push(obj)},this.numElements=function(){return this.store.length},this.clear=function(){for(var item=this.pop();null!=item;)item=this.pop()},this.entriesAsString=function(){for(var buff=[],i=this.store.length-1;i>-1;i--)buff.push(this.store[i]);return buff.join(",")}},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.ltrim=function(){return this.replace(/^\s+/,"")},String.prototype.rtrim=function(){return this.replace(/\s+$/,"")},Simulator.Utils.Dictionary=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="Dictionary",elements=[],dbg=function(){return sim.getDebug()};this.getElements=function(){return elements},this.exists=function(key){return void 0==elements[key]},this.keyExists=function(key){return key in elements},this.setValue=function(key,value){this.addKey(key),elements[key]=value},this.addKey=function(key,value){this.keyExists(key)||(elements[key]="")},this.remove=function(key){delete elements[key]},this.lookup=function(key){return elements[key]},this.keys=function(){var keys=[];for(var key in elements)void 0!=key&&null!=key&&keys.push(key);return keys},this.size=function(){var i=0;for(key in elements)i++;return i},this.toString=function(){var str,buff=new Simulator.Utils.StringBuffer;for(key in elements)void 0!=key&&null!=key&&(str=elements[key]instanceof Array?elements[key].join("  "):elements[key],buff.append("key = ").append(key).append(", value = ").append(str).append("\n"));return buff.toString()},this.toAssociativeArray=function(){return dbg().inspectArray(source,"elements",elements),elements},this.inspect=function(embedded,forced){buff=[];return buff.push("Inspecting Dictionary"),buff.push("\n\n"),buff.push(this.toString()),buff.push("\n\n"),embedded||(forced?debugf(buff.join("")):debug(buff.join(""))),buff.join("")}},Simulator.Utils.StringBuffer=function(){this.buffer=[],this.append=function(string){return this.buffer.push(string),this},this.toString=function(){return this.buffer.join("")}},Simulator.Utils.Table=function(incompleteRows,tableName,sim){function deleteRow(num){size=Object.size(columns);for(var col=0;col<size;col++)aColName=columnNames[col],columns[aColName].splice(num,1)}function getNumRows(){var maxLen=0,len=0;for(var p in columns)len=columns[p].length,maxLen=Math.max(len,maxLen);return maxLen}function rowIsCompletlyFilledIn(rowNum){for(var size=Object.size(columns),col=0;col<size;col++)if(aColName=columnNames[col],""==columns[aColName][rowNum])return!1;return!0}function rowIsEmpty(rowNum){for(var size=Object.size(columns),col=0;col<size;col++)if(aColName=columnNames[col],void 0!=columns[aColName][rowNum]&&""!=columns[aColName][rowNum])return!1;return!0}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="Table",columns=[],typedElements=[],columnNames=[],contentsForInCompleteRows=!1,name=tableName,maxRowNum=-1,dbg=function(){return sim.getDebug()},simMgr=function(){return sim.getSimulationManager()},scoringTable=function(){return sim.getScoringTable()};this.getName=function(){return name},incompleteRows&&(contentsForInCompleteRows=!0),this.setMaxRowNum=function(num){num&&(maxRowNum=num)},this.addElement=function(name,type){if(!(name in columns)&&(columns[name]=[],columnNames.push(name),type)){if(!(type in typedElements)){var values=new Array;typedElements[type]=values}typedElements[type].push(name)}},this.cloneInputsForOutputs=function(){var outputs=typedElements.output;if(!outputs){var values=new Array;typedElements.output=values,outputs=typedElements.output}for(var p in columns)columns.hasOwnProperty(p)&&(outputs.hasOwnProperty(p)||typedElements.output.push(p))},this.clearTable=function(clearOutputs){for(var p in columns)if(columns.hasOwnProperty(p))for(var col=columns[p],j=0;j<col.length;j++)col[j]="";if(clearOutputs){var outputs=typedElements.output;if(outputs)for(var t in outputs)outputs.hasOwnProperty(t)&&(outputs[t]="")}},this.clearEntry=function(colName,rowNum){columns.hasOwnProperty(colName)&&(columns[colName][rowNum]="")},this.clearRow=function(rowNum,clearOutputs,deleteRow){for(var p in columns)columns.hasOwnProperty(p)&&(columns[p][rowNum]="");if(clearOutputs){var outputs=typedElements.output;if(outputs)for(var t in outputs)outputs.hasOwnProperty(t)&&(outputs[rowNum]="")}},this.deleteEmptyRows=function(){for(var numRows=getNumRows(),row=0;row<numRows;row++)rowIsEmpty(row)&&deleteRow(row)},this.outputEntered=function(){var outputs=typedElements.output;if(outputs){for(var i=0;i<outputs.length;i++)if(!this.isColumnEmpty(outputs[i]))return!0;return!1}return!1},this.isColumnEmpty=function(elementName){if(columns[elementName]){for(var i=0;i<columns[elementName].length;i++)if(""!=columns[elementName][i])return!1;return!0}return!0},this.deleteElement=function(elementName){elementName in columns&&delete columns[elementName];for(t in typedElements)for(var j=0;j<typedElements[t].length;j++)typedElements[t][j]==elementName&&typedElements[t].splice(j,1)},this.setValue=function(colName,rowNum,value){var theValue=null;theValue=value instanceof Array?value.join(", "):value,(null==rowNum||rowNum<0)&&(rowNum=simMgr().getTrialNum()-1),rowNum>-1?(columns[colName]||(columns[colName]=[]),columns[colName][rowNum]=theValue):dbg().logError(source,"rowNum = "+rowNum+" in "+name+".setValue")},this.getElementsOfType=function(type){return typedElements[type]?typedElements[type]:null},this.getContents=function(){var buff=[],colNames=[],maxLen=0,len=0,i=0,aColName=null;buff.push("<responseTable>"),buff.push("   <tr>");for(var p in columns)buff.push('      <th id = "'+p+'">'+p+"</th>"),len=columns[p].length,maxLen=Math.max(len,maxLen),colNames[i++]=p;maxRowNum>0&&maxLen>maxRowNum&&(maxLen=maxRowNum),buff.push("   </tr>");for(var size=colNames.length,value=null,row=0;row<maxLen&&(contentsForInCompleteRows||rowIsCompletlyFilledIn(row));row++){buff.push("   <tr>");for(var col=0;col<size;col++)aColName=colNames[col],void 0!=(value=columns[aColName][row])&&null!=value||(value=""),value&&value.indexOf&&-1!=value.indexOf("<")&&(value="<![CDATA["+value+"]]>"),buff.push("      <td>"+value+"</td>");buff.push("   </tr>")}return buff.push("</responseTable>"),buff.join("\n")},this.getNumNonEmptyRows=function(){var maxLen=0,numRows=0;for(var p in columns){numRows=0,len=columns[p].length;for(var row=0;row<len;row++)""!=columns[p][row]&&numRows++;maxLen=Math.max(numRows,maxLen)}return maxLen},this.restoreResponseTable=function(node){var child=null,attr=null,text=null,colNum=-1,rowNum=-2;this.clearTable();for(var children=node.childNodes,q=0;q<children.length;q++)if("tr"==children[q].nodeName){rowNum++,colNum=-1,child=children[q];for(var m=0;m<child.childNodes.length;m++)if("td"==child.childNodes[m].nodeName)colNum++,text=child.childNodes[m].textContent,scoringTable().setValue(columnNames[colNum],rowNum,text);else if("th"==child.childNodes[m].nodeName){attr=child.childNodes[m].attributes;for(var j=0;j<attr.length;j++)"#"!=attr[j].nodeValue[0]&&(columnNames.push(attr[j].nodeValue),!attr[j].nodeValue in columns&&dbg().logFatalError(source,"response column name: "+columnNames[j]+" is not in "+name+" column names"))}}},this.inspectElementTypes=function(embedded,force){var buff=[],aType=null;buff.push("Inspecting typedElements:");for(var e in typedElements){buff.push("  "+e+" type elements:"),aType=typedElements[e];for(var j=0;j<aType.length;j++)buff.push("    "+aType[j])}if(buff.push("End inspecting typeElements"),embedded)return buff.join("\n");null===force?debug(buff.join("\n")):debugf(buff.join("\n"))},this.inspect=function(embedded,force){var str=this.getContents(),preface=name+"Table output:\n";if(embedded)return str;force?debugf(preface+str):debug(preface+str)}},Simulator.Utils.PersistentVariableDataBase=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="PersistentVariableDB",store=[],dbg=function(){return sim.getDebug()};this.updateElement=function(element,value,operation){if(element in store)if(isNaN(value))store[element]=value;else{if(currentValue=store[element],operation)switch(operation){case"+":currentValue+=parseFloat(value);break;case"*":currentValue*=parseFloat(value);break;case"/":currentValue/=parseFloat(value);break;case"-":currentValue-=parseFloat(value);break;case"overwrite":currentValue=value;break;default:dbg().logWarning(source,"Invalid operator "+operator+" passed to PersistentVariableDataBase.updateElement. No update occurred")}else currentValue+=parseFloat(value);store[element]=currentValue}else isNaN(value)?store[element]=value:store[element]=parseFloat(value);return this.getElementValue(element)},this.setElementTo=function(element,num){store[element]=num},this.getElementValue=function(element){return element in store?store[element]:null},this.getContents=function(){return store},this.inspect=function(embedded,force){var buff=[];buff.push("Inspecting "+source);for(var p in store)buff.push("   "+source+"["+p+"] = "+store[p]);if(embedded)return buff.join("\n");1==force?debugf(buff.join("\n")):debug(buff.join("\n"))}},Simulator.Utils.TranslationDictionary=function(sim){function getLanguageIndex(languageString){for(var i=0;i<supportedLanguages.length;i++)if(languageString.toLowerCase()==supportedLanguages[i].toLowerCase())return i;return-1}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Utils.Dictionary.call(this,sim);var source="TranslationDictionary",dbg=function(){return sim.getDebug()},supportedLanguages=[];supportedLanguages[0]="english",supportedLanguages[1]="current";var dictionaryLoaded=!1;this.loadTranslations=function(translationNodes){for(var langElements=translationNodes[0].getElementsByTagName("languageElement"),j=0;j<langElements.length;j++){var valueArray,tag=langElements[j].getAttribute("id"),engText=langElements[j].getAttribute("value")||"",currText=langElements[j].childNodes[0]?langElements[j].childNodes[0].nodeValue||"":"";(valueArray=this.keyExists(tag)?this.lookup(tag):[])[0]=engText,valueArray[1]=currText,this.setValue(tag,valueArray)}dictionaryLoaded=!0,this.validateTranslations()},this.getLanguageCount=function(){return supportedLanguages.length},this.translate=function(tag){return dictionaryLoaded&&this.keyExists(tag)?this.translateToLanguage(tag,1):tag},this.translateToEnglish=function(tag){return dictionaryLoaded&&this.keyExists(tag)?this.translateToLanguage(tag,0):tag},this.translateToLanguage=function(tag,lang){return isNaN(lang)?this.lookup(tag)[getLanguageIndex(lang)]:this.lookup(tag)[lang]},this.toString=function(){var buff=new StringBuffer,transBuff=[];for(var key in this.getElements())if(void 0!==key&&null!==key){for(var i=0;i<this.translationsAvailableCount(key);i++)transBuff[i]=supportedLanguages[i]+":"+this.translateToLanguage(key,i);buff.append("key = ").append(key).append(", value = ").append(transBuff.join(" ; ")).append("\n")}return buff.toString()},this.inspect=function(embedded,forced){var buff=[];return buff.push("Inspecting Translation Dictionary"),buff.push("\n\n"),buff.push(this.toString()),buff.push("\n\n"),embedded||(forced?debugf(buff.join("")):debug(buff.join(""))),buff.join("")},this.translationsAvailableCount=function(key){var count=0;if(this.keyExists(key)){var transSet=this.lookup(key);for(var transStrings in transSet)void 0!==transStrings&&++count}return count},this.validateTranslations=function(){var valid=!0;for(var key in this.getElements())this.translationsAvailableCount(key)!=this.getLanguageCount()&&(valid=!1,debugf("Error: Tag is missing translation(s): "+key));return valid&&debug("Translation Dictionary validated: translations are available for all tags."),valid},this.isLoaded=function(){return dictionaryLoaded},this.translateEvaluationOutput=function(data){if(null!==data&&this.isLoaded()){var translatedData=[];if(void 0!==(data=data.split(Simulator.Constants.PAIR_DELIMITTER))&&null!==data&&""!==data)for(var i=0;i<data.length;i++){var parts=data[i].split(Simulator.Constants.KEY_VALUE_DELIMITTER);if(parts[1]){var quoted='"'==parts[1][0]&&'"'==parts[1][parts[1].length-1];quoted&&(parts[1]=parts[1].substring(1,parts[1].length-1)),parts[1]=this.translateToEnglish(parts[1]),quoted&&(parts[1]='"'+parts[1]+'"')}translatedData.push(parts.join(Simulator.Constants.KEY_VALUE_DELIMITTER))}data=translatedData.join(Simulator.Constants.PAIR_DELIMITTER)}return data},this.internationalizePreparsedAnimationOutput=function(data){var oldData=data;if(null!==data){var translatedData=[];if(void 0!==(data=data.split(Simulator.Constants.PAIR_DELIMITTER))&&null!==data&&""!==data)for(var i=0;i<data.length;i++){var parts=data[i].split(Simulator.Constants.KEY_VALUE_DELIMITTER);parts[1]&&(parts[1]=this.internationalizeAnimationOutputPart(parts[1])),translatedData.push(parts.join(Simulator.Constants.KEY_VALUE_DELIMITTER))}data=translatedData.join(Simulator.Constants.PAIR_DELIMITTER)}return this.isLoaded()||oldData!=data&&dbg.logError(source,"Animation output data may have been corrupted.  If translation dictionary is not loaded, animation output should have passed through internationalization step intact, but the strings are not equal.\nBefore: "+oldData+" After: "+data),data},this.internationalizeAnimationOutputPart=function(outputValue){if(!this.isLoaded())return outputValue;if(!isNaN(outputValue))return outputValue;var value=outputValue.trim(),tag="trans.animation.output."+value;if(!this.keyExists(tag)){dbg.logWarning("Unable to match animation output with translation dictionary entry: "+value+"\nAdding the English version to the dictionary...");var newEntry=[];newEntry[0]=value,newEntry[1]=value,this.setValue(tag,newEntry)}return tag}},Simulator.Utils.TranslationDictionary.prototype=new Simulator.Utils.Dictionary,Simulator.Utils.TranslationDictionary.parent=Simulator.Utils.Dictionary,Simulator.Utils.TranslationDictionary.prototype.constructor=Simulator.Utils.TranslationDictionary,Simulator.SimItem=function(sim){var source="SimItem",eName="SimItem",simId=null,IDNum=-1,dbg=function(){return sim.getDebug()},simDocument=function(){return sim.getSimDocument()};sim&&(simId=sim.getSimID()),this.getEname=function(){return eName},this.setEname=function(newEname){return eName=newEname,this},this.createItemID=function(reset,itemNum,aName){var name=aName||this.getName();return null!=itemNum?itemNum>-1?name+"Item"+simId+itemNum:(IDNum++,name+"Element"+simId+IDNum):(reset&&(IDNum=-1),++IDNum,name+"Item"+simId+IDNum)},this.getNodeID=function(){return nodeID},this.inspect=function(embedded,force){var buff=[],sep="\n";buff.push("Inspecting "+source+sep);for(var i in this)"items"==i?buff.push(this.parent.inspect()):"get"==i.substr(0,3)&&(buff.push(i.charAt(3).toLowerCase()+i.slice(4)),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(buff.push("End Inspecting "+source+sep+sep),embedded)return buff.join("");1==force?dbg().debugf(source,buff.join("")):dbg().debug(source,buff.join(""))},this.setAttributes=function(attr){for(var i in attr)switch(i){case"eName":this.setEname(attr[i])}}},Simulator.Input.KeyboardInput=function(sim){var source="KeyboardInput",dbg=function(){return sim.getDebug()},eventMgr=function(){return sim.getEventManager()},simMgr=function(){return sim.getSimulationManager()},elementSelected=!1,focusableElements=[],inputIndex=0,itemIndex=-1;this.addFocusableElement=function(element,elementID,itemID){focusableElements.push([]),focusableElements[focusableElements.length-1][0]=elementID,focusableElements[focusableElements.length-1][1]=element,focusableElements[focusableElements.length-1][2]=[]},this.addFocusableElementItem=function(element,elementID,itemID,position){var index=elementInDB(elementID);if(-1==index)this.addFocusableElement(element,elementID,itemID),(items=[]).push(itemID),focusableElements[focusableElements.length-1][2]=items;else{var items=focusableElements[index][2];null==items?(items=[]).push(itemID):0==items.length||!position||items.length<=position?items.push(itemID):items.splice(position,0,itemID)}},this.inspect=function(force){var buff=[];buff.push("Inspecting focusableElements:");for(var i=0;i<focusableElements.length;i++)buff.push("["+i+"] = "+focusableElements[i][0]+", "+focusableElements[i][1].getName()+", "+focusableElements[i][2]);buff.push("End inspecting focusableElements"),null==force?debug(source,buff.join("\n")):debugf(source,buff.join("\n"))};var advanceToNextElement=function(){++inputIndex>=focusableElements.length&&(inputIndex=-1)},advanceToNextItem=function(){elementSelected=!1,itemIndex++,(-1==inputIndex||focusableElements[inputIndex][2].length<=itemIndex)&&(advanceToNextElement(),itemIndex=0)},advanceToPreviousElement=function(){--inputIndex<0&&(inputIndex=focusableElements.length-1),inputIndex>=0&&(itemIndex=focusableElements[inputIndex][2].length-1)<0&&(itemIndex=0)},advanceToPreviousItem=function(){itemIndex<=0?advanceToPreviousElement():itemIndex--},elementInDB=function(elementID){for(var i=0;i<focusableElements.length;i++)if(focusableElements[i][0]==elementID)return i;return-1},getInputObjectFromList=function(inputIndex,itemIndex){if(-1!=inputIndex&&inputIndex<focusableElements.length){var parts=[];parts[0]=focusableElements[inputIndex][0],parts[1]=focusableElements[inputIndex][1];var items=[];return items=focusableElements[inputIndex][2],parts[2]=items[itemIndex],parts}};shortcut={all_shortcuts:{},add:function(shortcut_combination,callback,simDoc,opt){var default_options={type:"keydown",propagate:!0,disable_in_input:!1,target:simDoc,keycode:!1};if(opt)for(var dfo in default_options)void 0===opt[dfo]&&(opt[dfo]=default_options[dfo]);else opt=default_options;var ele=opt.target;"string"==typeof opt.target&&(ele=document.getElementById(opt.target)),shortcut_combination=shortcut_combination.toLowerCase();var func=function(e){if(e=e||window.event,opt.disable_in_input){var element=null;if(e.target?element=e.target:e.srcElement&&(element=e.srcElement),3==element.nodeType&&(element=element.parentNode),"INPUT"==element.tagName||"TEXTAREA"==element.tagName)return}e.keyCode?code=e.keyCode:e.which&&(code=e.which);var character=String.fromCharCode(code).toLowerCase();188==code&&(character=","),190==code&&(character=".");var keys=shortcut_combination.split("+"),kp=0,shift_nums={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},special_keys={esc:27,escape:27,tab:9,space:32,return:13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,break:19,insert:45,home:36,delete:46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},modifiers={shift:{wanted:!1,pressed:!1},ctrl:{wanted:!1,pressed:!1},alt:{wanted:!1,pressed:!1},meta:{wanted:!1,pressed:!1}};e.ctrlKey&&(modifiers.ctrl.pressed=!0),e.shiftKey&&(modifiers.shift.pressed=!0),e.altKey&&(modifiers.alt.pressed=!0),e.metaKey&&(modifiers.meta.pressed=!0);for(var i=0;k=keys[i],i<keys.length;i++)"ctrl"==k||"control"==k?(kp++,modifiers.ctrl.wanted=!0):"shift"==k?(kp++,modifiers.shift.wanted=!0):"alt"==k?(kp++,modifiers.alt.wanted=!0):"meta"==k?(kp++,modifiers.meta.wanted=!0):k.length>1?special_keys[k]==code&&kp++:opt.keycode?opt.keycode==code&&kp++:character==k?kp++:shift_nums[character]&&e.shiftKey&&(character=shift_nums[character])==k&&kp++;if(kp==keys.length&&modifiers.ctrl.pressed==modifiers.ctrl.wanted&&modifiers.shift.pressed==modifiers.shift.wanted&&modifiers.alt.pressed==modifiers.alt.wanted&&modifiers.meta.pressed==modifiers.meta.wanted&&(callback(e),!opt.propagate))return e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),!1};this.all_shortcuts[shortcut_combination]={callback:func,target:ele,event:opt.type},ele.addEventListener?ele.addEventListener(opt.type,func,!1):ele.attachEvent?ele.attachEvent("on"+opt.type,func):ele["on"+opt.type]=func},remove:function(shortcut_combination){shortcut_combination=shortcut_combination.toLowerCase();var binding=this.all_shortcuts[shortcut_combination];if(delete this.all_shortcuts[shortcut_combination],binding){var type=binding.event,ele=binding.target,callback=binding.callback;ele.detachEvent?ele.detachEvent("on"+type,callback):ele.removeEventListener?ele.removeEventListener(type,callback,!1):ele["on"+type]=!1}}},this.initializeKeyboardShortcuts=function(){shortcut.add("tab",function(){handleKeyBoardInput("tab","","")},sim.getSimDocument()),shortcut.add("ctrl+tab",function(){handleKeyBoardInput("ctrl","tab","")},sim.getSimDocument()),shortcut.add("shift+tab",function(){handleKeyBoardInput("shift","tab","")},sim.getSimDocument()),shortcut.add("ctrl+shift+tab",function(){handleKeyBoardInput("ctrl","shift","tab")},sim.getSimDocument()),shortcut.add("enter",function(){handleKeyBoardInput("enter","","")},sim.getSimDocument())},this.removeKeyboardShortcuts=function(){shortcut.remove("tab"),shortcut.remove("ctrl+tab"),shortcut.remove("shift+tab"),shortcut.remove("ctrl+shift+tab"),shortcut.remove("enter")},this.resetKeyboardFocusState=function(){prevInputObjectInfo[1]&&prevInputObjectInfo[1].keyboardNavigateAwayFrom(prevInputObjectInfo[0],prevInputObjectInfo[2],itemIndex),inputIndex=0,itemIndex=-1,prevInputObjectInfo=[]};var prevInputObjectInfo=[],handleKeyBoardInput=function(firstKey,secondKey,thirdKey){if(!simMgr().isPlaying()){var parts=null;switch(prevInputObjectInfo[1]&&prevInputObjectInfo[1].keyboardNavigateAwayFrom(prevInputObjectInfo[0],prevInputObjectInfo[2],itemIndex),firstKey){case"ctrl":switch(secondKey){case"tab":elementSelected?advanceToNextElement():advanceToNextItem(),(parts=getInputObjectFromList(inputIndex,itemIndex))?parts[1].keyboardNavigateTo(parts[0],parts[2],itemIndex):(eventMgr().postEvent(new Simulator.Event(this,"info","lastfocusableSimulatorElementReached",null,!1)),inputIndex=-1);break;case"shift":switch(thirdKey){case"tab":elementSelected?advanceToPreviousElement():advanceToPreviousItem(),(parts=getInputObjectFromList(inputIndex,itemIndex))?parts[1].keyboardNavigateTo(parts[0],parts[2],itemIndex):(eventMgr().postEvent(new Simulator.Event(this,"info","firstfocusableSimulatorElementReached",null,!1)),inputIndex=-1)}}break;case"shift":switch(secondKey){case"tab":elementSelected?advanceToPreviousElement():advanceToPreviousItem(),(parts=getInputObjectFromList(inputIndex,itemIndex))?parts[1].keyboardNavigateTo(parts[0],parts[2],itemIndex):(eventMgr().postEvent(new Simulator.Event(this,"info","firstfocusableSimulatorElementReached",null,!1)),inputIndex=-1)}break;case"tab":break;case"enter":(parts=getInputObjectFromList(inputIndex,itemIndex))&&(parts[1].recordKeyboardSelection(parts[0],parts[2],itemIndex),"optionList"!=parts[1].getType()&&"choiceList"!=parts[1].getType()&&"Button"!=parts[1].getSourceName()||parts[1].keyboardNavigateTo(parts[0],parts[2],itemIndex),"dropList"===parts[1].getType()&&(itemIndex=focusableElements[inputIndex][2].length-1))}parts?(prevInputObjectInfo[0]=parts[0],prevInputObjectInfo[1]=parts[1],prevInputObjectInfo[2]=parts[2]):(prevInputObjectInfo[0]=null,prevInputObjectInfo[1]=null,prevInputObjectInfo[2]=null)}};this.closeDropList=function(){handleKeyBoardInput("enter")};var debug=function(str1,str2,trace){dbg().debug(source,str1,str2,trace)},debugf=function(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}},Simulator.SimElement=function(sim){function debug(str1,str2,trace){sim&&dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){sim&&dbg().debugf(source,str1,str2,trace)}Simulator.SimItem.call(this,sim);var source="SimElement",name="",focusable=!1,nodeID=null,type=null,label="",scoreable=!0,spaceAbove=0,spaceBelow=0,image=null,speechLabel="",toEvents=new Simulator.EventDB(sim,"toEvents"),fromEvents=new Simulator.EventDB(sim,"fromEvents"),theSimulator=null,keyboardInput=function(){sim.getKeyboardInput()},html2jsMap=function(){return sim.getHTML2JSMap()};sim&&(theSimulator=sim);var eventMgr=function(){return theSimulator.getEventManager()},dbg=function(){return theSimulator.getDebug()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()};this.getEname=function(){return source},this.addEvent=function(theEvent,dir){switch(dir){case"to":toEvents.addEvent(theEvent),eventMgr().registerEvent(theEvent);break;case"from":fromEvents.addEvent(theEvent);break;default:dbg().logError(source,"Unknown event direction "+dir+" passed to "+this.getName())}return this},this.setFocusable=function(flag,noRegister){focusable=1==flag},this.isFocusable=function(){return focusable},this.nextEvent=function(reset){return fromEvents.nextEvent(reset)},this.getName=function(){return name},this.setName=function(newName){return name=newName.trim(),nodeID=this.createItemID(!0,-1),this},this.getType=function(){return type},this.setType=function(newType){return type=newType,this},this.getLabel=function(){return transDictionary().translate(label)},this.setLabel=function(newLabel){return label=newLabel,this},this.getScoreable=function(){return scoreable},this.setSpaceAbove=function(newSpaceAbove){spaceAbove=parseInt(newSpaceAbove)},this.getSpaceAbove=function(){return spaceAbove},this.setSpaceBelow=function(newSpaceBelow){spaceBelow=parseInt(newSpaceBelow)},this.getSpaceBelow=function(){return spaceBelow},this.getImage=function(){var translatedImage=transDictionary().translate(image);return debug("Getting an image using SimElement2.js method: "+translatedImage),translatedImage},this.setImage=function(newImage){return debug("SETTING an image using SimElement2.js method: "+newImage),image=newImage,this},this.getData=function(){return""},this.setSpeechLabel=function(newSpeechLabel){speechLabel=newSpeechLabel},this.getSpeechLabel=function(){return speechLabel},this.formatEventData=function(){return this.getData()},this.postOnChangeEnabled=function(){for(var theEvent=this.nextEvent("true");null!=theEvent;){if("yes"==theEvent.postOnChange)return!0;theEvent=this.nextEvent()}return!1},this.postOnChangeEvents=function(){for(var theEvent=this.nextEvent("true");null!=theEvent;)"yes"==theEvent.postOnChange&&(theEvent.data=this.formatEventData(),eventMgr().postEvent(theEvent)),theEvent=this.nextEvent()},this.postStaticEvents=function(){for(var theEvent=this.nextEvent("true");null!=theEvent;)"yes"!=theEvent.postOnChange&&(theEvent.data=this.formatEventData(),theEvent.postEvent()),theEvent=this.nextEvent()},this.getNodeID=function(){return nodeID},this.mapHTML2JS=function(htmlElement){html2jsMap().mapJSFromHTML(this,htmlElement)},this.inspect=function(embedded,force){var buff=[],sep="\n";buff.push("Inspecting "+source+sep);var str=Simulator.SimElement.prototype.inspect.call(this,!0,force);if(str)return buff.push(str),buff.push(fromEvents.inspect(!0,force)),buff.push(toEvents.inspect(!0,force)),buff.join("");for(var i in this)"get"==i.substr(0,3)&&(buff.push(i.charAt(3).toLowerCase()+i.slice(4)),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(buff.push(fromEvents.inspect(!0,force)),buff.push(toEvents.inspect(!0,force)),buff.push("End Inspecting "+source+sep+sep),embedded)return buff.join("");1==force?debugf(buff.join("")):debug(buff.join(""))},this.selectViaKeyboard=function(itemIndex){Simulator.showAlert("Error",'"selectViaKeyboard" must be inplemented by subclass')},sim&&this.setEname("SimElement"),this.setAttributes=function(attr){Simulator.SimElement.prototype.setAttributes.call(this,attr);for(var i in attr)switch(i){case"name":this.setName(attr[i]);break;case"image":this.setImage(attr[i]);break;case"label":this.setLabel(attr[i]);break;case"type":this.setType(attr[i]);break;case"spaceAbove":this.setSpaceAbove(attr[i]);break;case"spaceBelow":this.setSpaceBelow(attr[i]);break;case"speechLabel":this.setSpeechLabel(attr[i])}}},Simulator.SimElement.prototype=new Simulator.SimItem,Simulator.SimElement.prototype.constructor=Simulator.SimElement,Simulator.DataDictionary=function(sim){Simulator.SimItem.call(this,sim);var dataDB=[];this.createEntry=function(key){dataDB.keyExists(key)||dataDB.addKey(key,"")},this.setEntryValue=function(key,value){dataDB.setValue(key,value)},this.getEntryValue=function(key){return dataDB.lookup(key)},this.contents=function(){var buff=[];buff.push("<Table>\n"),buff.push("<tr>");for(var keys=dataDB.keys(),i=0;i<keys.length;i++)buff.push('<th id = "'+keys[i]+'">'+keys[i]+"</th>");return buff.join("")}},Simulator.DataDictionary.prototype=new Simulator.SimItem,Simulator.DataDictionary.parent=Simulator.SimItem,Simulator.DataDictionary.prototype.constructor=Simulator.DataDictionary,Simulator.EventManager=function(sim){function processEvents(){for(;!inputQueue.isEmpty();){var matches=[],event=inputQueue.remove();matches=getSubscriberDB().getAllMatchingEvents(event);for(var i=0;i<matches.length;i++)void 0!=matches[i].src.handleEvent?matches[i].src.handleEvent(event):"object"!=typeof matches[i].src&&matches[i].src.prototype.handleEvent(event)}}function bind(method){var _this=this;return function(){return method.apply(_this.arguments)}}var inputQueue=new Simulator.Utils.Queue(sim),subscriberDB=null,timer=null,utils=function(){return sim.getUtils()},getSubscriberDB=function(){return subscriberDB||(subscriberDB=new Simulator.EventDB(sim,"subscriberDB")),subscriberDB};this.registerEvent=function(event){getSubscriberDB().addEvent(event)},this.deRegisterEvent=function(event){getSubscriberDB().remove(event)},this.postEvent=function(event){inputQueue.add(event)},this.startEventProcessing=function(){var closure=bind(processEvents);timer=setInterval(closure,500)},this.getSourceName=function(obj){return utils().getJSObjName(obj)},this.stopEventProcessing=function(){clearTimeout(timer)}},Simulator.EventDB=function(sim,theName){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="EventDB",DB=[],currentIndex=0,name=theName,dbg=function(){return sim.getDebug()};this.getName=function(){return name},this.addEvent=function(event){DB.push(event)},this.removeEvent=function(event){var index=this.isInDB(event,!0);index>-1&&DB.splice(index,1)},this.isInDB=function(event,fullMatch){for(var i=0;i<DB.length;i++){var theEvent=DB[i];if(theEvent.type==event.type&&theEvent.context==event.context){if(!fullMatch)return i;if(theEvent.src==event.src)return i}}return-1},this.getAllMatchingEvents=function(event){for(var matches=[],k=0,i=0;i<DB.length;i++){var theEvent=DB[i];theEvent.type!=event.type||theEvent.context!=event.context&&"*"!=theEvent.context&&"*"!=event.context||(event.data&&(theEvent.data=event.data),theEvent.completeWithoutOutput=event.completeWithoutOutput,theEvent.originatorName=event.originatorName,matches[k++]=theEvent)}return matches},this.nextEvent=function(reset){return reset&&(currentIndex=0),currentIndex<DB.length?DB[currentIndex++]:null},this.inspect=function(embedded,forced){var buff=[];buff.push("Inspecting EventDB "+name+"\n"),buff.push("There are "+DB.length+" events in "+name+"\n");for(var i=0;i<DB.length;i++)forced?buff.push(debugf(DB[i].inspect(embedded,!0))):buff.push(debug(DB[i].inspect(embedded,!0))),buff.push("\n");if(buff.push("End of EventDB "+name+" Inspection\n\n"),embedded)return buff.join("");forced?debugf(buff.join("")):debug(buff.join(""))}},Simulator.Event=function(src,type,context,data,postOnChange,completeWithoutOutput){this.type=type,this.src=src,this.context=context,this.data=data,this.postOnChange=postOnChange,this.completeWithoutOutput=!0===completeWithoutOutput,this.inspect=function(){var buff=[],sep="\n\n";return buff.push("Inspecting event"),buff.push(sep),this.src.getName&&(buff.push("event src = "),buff.push(this.src.getName()),buff.push(";"),buff.push(sep)),buff.push("event type = "),buff.push(this.type),buff.push(";"),buff.push(sep),buff.push("event context = "),buff.push(this.context),buff.push(";"),buff.push(sep),buff.push("event data = "),buff.push(this.data),buff.push(";"),buff.push(sep),buff.push("event postOnChange = "),buff.push(this.postOnChange),buff.push(";"),buff.push(sep),buff.push("event completeWithoutOutput = "),buff.push(this.completeWithoutOutput),buff.push(";"),buff.push(sep),buff.join("")}},Simulator.Display.Layout=function(sim,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}var source="Layout",panelList=[],dbg=function(){return sim.getDebug()},simDocument=function(){return sim.getSimDocument()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};this.specifyLayout=function(layout){var format=null,attr=layout[0].attributes,div=simDocument().createElement("div");div.setAttribute("id",Simulator.Constants.SIM_CONTAINER_NAME+sim.getSimID()),(format=utils().isInternetExplorer()?attr.getNamedItem("format").value:attr.format.nodeValue)?(div.setAttribute("class",format),container.appendChild(div)):dbg().logError(source,"Could not get layout format attribute.")},this.createPanels=function(node){for(var aPanel,panelSpec,panelNum=0,i=0;i<node.length;i++)if("#"!=node[i].nodeName[0]){aPanel=new Simulator.Display.Panel(sim,panelNum++);for(var j=0;j<node[i].childNodes.length;j++)"#"!=node[i].childNodes[j].nodeName[0]&&(panelSpec=node[i].childNodes[j],aPanel.setAttributes(aPanel,utils().getAttributes(panelSpec)));var attr=node[i].attributes;utils().isInternetExplorer()?aPanel.setAttributes(utils().getAttributes(node[i])):Object.size(attr)>0&&aPanel.setAttributes(utils().getAttributes(node[i])),aPanel.setName(node[i].nodeName);var id=aPanel.getNodeID();panelList[id]||(panelList[id]=aPanel),aPanel.render()}},this.getPanelInstance=function(panelType){for(var panel in panelList)if(panel.indexOf(panelType)>-1)return panelList[panel];return null},this.resizeAllPanels=function(zoom){debug(source,"In Layout Panel Resize All Panels for simID="+sim.getSimID());var aPanel=null;for(var name in panelList)(aPanel=panelList[name]).resize?aPanel.resize(zoom):dbg().logError(source,"unknown panel name: "+name)},this.recordPanelSizes=function(zoom){debug(source,"In Record Panel Sizes for simID="+sim.getSimID());var aPanel=null;for(var name in panelList)(aPanel=panelList[name]).recordOriginalWidthAndHeight?aPanel.recordOriginalWidthAndHeight():dbg().logError(source,"unknown panel name: "+name)},this.makeAllPanelsVisible=function(){for(var name in panelList){panelList[name].setDisplay("visible");var HTMLPanel=simDocument().getElementById(name);HTMLPanel?(HTMLPanel.style.visibility="visible",debug(name+".style.visibility = "+HTMLPanel.style.visibility)):dbg().logError(source,"Could not get HTML "+name+" panel element. Could not make panel visible")}},this.getContainerWidth=function(){var container=simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME+sim.getSimID());return container?(0===container.offsetWidth&&dbg().logError(source,"Simulator container offsetWidth is 0"),container.offsetWidth):(dbg().logError(source,"Simulator's container with id = \""+id+'" is null'),FAILURE)},this.getContainerHeight=function(){var container=simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME+sim.getSimID());return container?(0===container.offsetHeight&&dbg().logError(source,"Simuator container offsetHeight is 0"),container.offsetHeight):(dbg().logError(source,"Simulator's container with id = \""+id+'" is null.'),FAILURE)},this.handleEvent=function(event){switch(event.type){case"info":switch(event.context){case"simulatorStateChange":switch(event.data){case"ReadOnly":case"Playing":this.disableAllInput();break;case"Ready":this.enableAllInput()}}}},this.enableAllInput=function(){for(var panel in panelList)if(panel){var panelObj=panelList[panel];panelObj.enableAllInput&&panelObj.enableAllInput()}},this.enableStartButton=function(){for(var panel in panelList)if(panel){var panelObj=panelList[panel];panelObj.enableStartButton&&panelObj.enableStartButton()}},this.disableAllInput=function(){for(var panel in panelList)if(panel){var panelObj=panelList[panel];panelObj.disableAllInput&&panelObj.disableAllInput()}},this.saveInputs=function(forcedSave){for(var panel in panelList)if(panel){var panelObj=panelList[panel];panelObj.saveInputs&&panelObj.saveInputs(forcedSave)}},this.hasEmptyChoiceListSelection=function(){for(var panel in panelList)if(panel){var panelObj=panelList[panel];if(panelObj.hasEmptyChoiceListSelection&&panelObj.hasEmptyChoiceListSelection())return!0}return!1},this.getSourceName=function(){return source},sim&&sim.getEventManager().registerEvent(new Simulator.Event(this,"info","simulatorStateChange"))},Simulator.showAlertWarning=function(msg){window.TDS&&TDS.Dialog?TDS.Dialog.showWarning(msg,function(){}):alert(msg)},Simulator.showAlert=function(headline,msg){window.TDS&&TDS.Dialog?TDS.Dialog.showAlert(msg,function(){}):alert(msg)},Simulator.Simulator=function(container,assistiveMode,speechMode){function recordItemAttributes(sim,node){var attrArray=utils.getAttributes(node);for(var attr in attrArray)switch(attr){case"speechEnabled":speechEnabled="yes"===attrArray[attr];break;case"language":language=attrArray[attr];break;case"mode":mode=attrArray[attr];break;case"itemName":itemName=attrArray[attr];break;case"xmlns":xmlns=attrArray[attr];break;default:dbg.logWarning(source,"Unrecognized Simulator attribute "+attr+" with value "+attrArray[attr])}debug("Completed recording item attributes")}function loadXMLDoc(fileName){var xhttp=null;return(xhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",fileName,!1),xhttp.send(),xhttp.responseXML}function loadXMLDocFromString(xmlStr){var xmlDoc=null;return window.DOMParser?xmlDoc=(new DOMParser).parseFromString(xmlStr,"application/xml"):((xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async="false",xmlDoc.loadXML(xmlStr)),xmlDoc}function recordInitializationSpecs(initNode){var varName=null,value=null,isIE=utils.isInternetExplorer();if(initNode.length>0){var children=initNode[0].childNodes;whiteboard.addCategory("initialization");for(var i=0;i<children.length;i++)"#"!==children[i].nodeName[0]&&(debug("Found initialization variable "+(varName=children[i].attributes[0].nodeValue)+" with value = "+(value=children[i].attributes[1].nodeValue)),isIE&&void 0!=children[i].attributes.getNamedItem("persistent")||"persistent"in children[i].attributes?persistentVariableDB.updateElement(varName,value):(key=whiteboard.addItem("initialization",varName),whiteboard.setItem("initialization",varName,value,key)));debug("Completed recording initialization specs")}}function createInputSection(sim,section,count){var panel=layout.getPanelInstance(Simulator.Constants.INPUT_PANEL_NAME),attr=utils.getAttributes(section),aSection=new Simulator.Input.Section(sim,panel,count);aSection.setAttributes(attr),aSection.render();var theElement,container,sectionElements=section.childNodes,elementorientation=aSection.getSectionSettings().elementorientation,numberofcolumns=aSection.getSectionSettings().numberofcolumns;"vertical"===elementorientation&&((tableRow=aSection.getSimDocument().createElement("div")).className="inputpanelrow",panel.getHTMLElement().appendChild(tableRow),container=tableRow);for(var i=0;i<sectionElements.length;i++){if("horizontal"===elementorientation){if(i%numberofcolumns==0){var tableRow=aSection.getSimDocument().createElement("div");tableRow.className="inputpanelrow",panel.getHTMLElement().appendChild(tableRow)}container=tableRow}switch(sectionElements[i].nodeName){case"inputElement":for(var iElements=sectionElements[i].childNodes,j=0;j<iElements.length;j++){var my={};switch(iElements[j].nodeName){case"dropList":theElement=new Simulator.Input.DropList(sim,iElements[j],panel,aSection,container);break;case"optionList":theElement=new Simulator.Input.OptionList(sim,iElements[j],panel,aSection,container);break;case"choiceList":theElement=new Simulator.Input.ChoiceList(sim,iElements[j],panel,aSection,container);break;case"upDownCounter":sim.getAccessibilityIFActive()?(my.accessibleNode=convertUpDownCounterToDropDown(iElements[j]),theElement=new Simulator.Input.DropList(sim,my.accessibleNode,panel,aSection,container)):theElement=new Simulator.Input.UpDownCounter(sim,iElements[j],panel,aSection,container);break;case"slider":theElement=new Simulator.Input.SimSlider(sim,iElements[j],panel,aSection,container);break;case"textField":theElement=new Simulator.Input.TextField(sim,iElements[j],panel,aSection,container);break;default:continue}if(void 0!=my.accessibleNode){attr=utils.getAttributes(my.accessibleNode);theElement.setAttributes(attr,my.accessibleNode),setEvents(theElement,my.accessibleNode),delete my.accessibleNode}else{attr=utils.getAttributes(iElements[j]);theElement.setAttributes(attr,iElements[j]),setEvents(theElement,iElements[j])}theElement.render();break}break;case"commandElement":for(var cElements=sectionElements[i].childNodes,c=0;c<cElements.length;c++){switch(cElements[c].nodeName){case"button":theElement=new Simulator.Control.Button(sim,panel,aSection,container);break;default:continue}theElement.setAttributes(cElements[c].attributes,cElements[c]),setEvents(theElement,cElements[c]),theElement.render(panel.getNodeID());break}break;case"staticElement":for(var sElements=sectionElements[i].childNodes,s=0;s<sElements.length;s++){switch(sElements[s].nodeName){case"imageElement":theElement=new Simulator.Input.ImageElement(sim,panel,aSection,container);break;case"horizontalLine":theElement=new Simulator.Input.HorizontalLine(sim,panel,aSection,container);break;case"sectionDivider":theElement=new Simulator.Input.SectionDivider(sim,panel,aSection,container);break;case"verticalSpace":theElement=new Simulator.Input.VerticalSpace(sim,panel,aSection,container);break;case"textConstant":theElement=new Simulator.Input.TextConstant(sim,panel,aSection,container);break;default:continue}theElement.setAttributes(sElements[s].attributes,sElements[s]),theElement.render(Simulator.Constants.INPUT_PANEL_NAME);break}}}}function convertUpDownCounterToDropDown(upDownNode){function gatherPropertyString(obj){var stringVector=[];for(var prop in obj)null!=obj[prop]&&stringVector.push(prop+'="'+obj[prop]+'"');return stringVector.join(" ")}var my={};my.xml=[],my.dropElement={},my.dropElement.eName="dropList",my.dropElement.name=upDownNode.getAttribute("name"),my.dropElement.type="dropList",my.dropElement.inputScope=upDownNode.getAttribute("inputScope"),my.dropElement.label=upDownNode.getAttribute("label"),my.dropElement.note=upDownNode.getAttribute("note"),my.dropElement.image=upDownNode.getAttribute("image"),my.xml.push("<dropList "+gatherPropertyString(my.dropElement)+">"),my.calc={},my.calc.defaultValue=parseFloat(upDownNode.getAttribute("defaultValue")),my.calc.minValue=parseFloat(upDownNode.getAttribute("minValue")),my.calc.maxValue=parseFloat(upDownNode.getAttribute("maxValue")),my.calc.increment=parseFloat(upDownNode.getAttribute("increment")),my.calc.units=upDownNode.getAttribute("units"),my.calc.values=[];for(var currentValue=my.calc.defaultValue;currentValue>=my.calc.minValue;)my.calc.values.push(currentValue),currentValue-=my.calc.increment;for(currentValue=my.calc.defaultValue+my.calc.increment;currentValue<=my.calc.maxValue;)my.calc.values.push(currentValue),currentValue+=my.calc.increment;my.calc.values.sort(function(a,b){return a-b}),my.items=[];for(var i=0;i<my.calc.values.length;i++)my.items.push({val:null==my.calc.units?my.calc.values[i]:my.calc.values[i]+" "+my.calc.units,dataProxy:my.calc.values[i],evaluationProxy:my.calc.values[i],animationProxy:my.calc.values[i],default:my.calc.values[i]==my.calc.defaultValue?"yes":null});for(j=0;j<my.items.length;j++)my.xml.push("<item "+gatherPropertyString(my.items[j])+" />");my.eventNodes=upDownNode.getElementsByTagName("event");for(var j=0;j<my.eventNodes.length;j++)my.xml.push(my.eventNodes[j].outerHTML);return my.xml.push("</dropList>"),loadXMLDocFromString(my.xml.join("\n").replace("&","&amp;")).getElementsByTagName("dropList")[0]}function createAnimationMembers(sim,animationNode){var attr,theElement,animationSet=null,panel=layout.getPanelInstance(Simulator.Constants.ANIMATION_PANEL_NAME);panel.setLiveAttribute("polite"),panel.recordOriginalWidthAndHeight();for(var i=0;i<animationNode.childNodes.length;i++)if("#"!=animationNode.childNodes[i].nodeName[0]){animationSet=animationNode.childNodes[i];break}if(animationSet){var theSet=new Simulator.Animation.AnimationSet(sim,panel);animationSetObj=theSet,theSet.setAttributes(animationSet.attributes,animationSet),setEvents(theSet,animationSet);for(var animationSetElements=animationSet.childNodes,j=0;j<animationSetElements.length;j++)switch(animationSetElements[j].nodeName){case"animationThread":var animationThread=animationSetElements[j];theElement=new Simulator.Animation.AnimationThread(sim,panel,null,theSet),attr=animationThread.attributes,theElement.setAttributes(attr,animationThread);for(var threadElements=animationThread.childNodes,k=0;k<threadElements.length;k++)if("animationThreadElement"===threadElements[k].nodeName){var aThreadElement=new Simulator.Animation.AnimationThreadElement(sim,theElement);aThreadElement.setAttributes(threadElements[k].attributes,threadElements[k]),theElement.addAnimationThreadElement(aThreadElement)}setEvents(theElement,animationThread);break;case"animationElement":if(theElement=new Simulator.Animation.AnimationElement(sim,theSet,panel),attr=animationSetElements[j].attributes,theElement.setAttributes(attr,animationSetElements[j]),theSet.addAnimationElement(theElement),""===theElement.getSrc()){var inlineElement=getElementInlineData(animationSetElements[j],sim);inlineElement&&(theElement.setSrc(inlineElement.getData()),theElement.setInlineDataID(inlineElement.getID()))}"html5"==theElement.getType()&&utils.canPlayHtml5()?panel.addPanelClass("withHTML5"):panel.addPanelClass("withFlash");break;case"poster":attr=animationSetElements[j].attributes,theSet.setPoster(attr);break;case"commandElement":for(var cElements=animationSetElements[j].childNodes,c=0;c<cElements.length;c++){switch(cElements[c].nodeName){case"button":theElement=new Simulator.Control.Button(sim,panel);break;default:continue}theElement.setAttributes(cElements[c].attributes,cElements[c]),setEvents(theElement,cElements[c]),theElement.render("animationPanel");break}}}else dbg().logError(source,"Could not initialize animationSet.")}function getElementInlineData(node,sim){for(var aNode=null,theElement=new Simulator.Animation.InlineData(sim),attr=node.attributes,nodes=node.childNodes,numChildren=nodes.length,i=0;i<numChildren;i++)if("inlineData"===(aNode=nodes[i]).nodeName){theElement.setAttributes(attr,aNode);var data=aNode.textContent;return theElement.setData(data),theElement}return dbg.logError(source,"Missing CDATA section for inlineData element"),""}function createDisplayMembers(sim,displayNode){var theElement=null,panel=layout.getPanelInstance(Simulator.Constants.DATA_DISPLAY_PANEL_NAME);panel.setLiveAttribute("polite");var displayElementsOriginal=displayNode.childNodes,displayElements=[];if(sim.getAccessibilityIFActive()){for(var clearAllRowsButtons=[],otherElements=[],j=0;j<displayElementsOriginal.length;j++)"commandElement"==displayElementsOriginal[j].nodeName&&"ResetTrials"==displayElementsOriginal[j].getElementsByTagName("button")[0].getAttribute("handler")?clearAllRowsButtons.push(displayElementsOriginal[j]):otherElements.push(displayElementsOriginal[j]);for(j=0;j<otherElements.length;j++)displayElements.push(otherElements[j]),"displayElement"==otherElements[j].nodeName&&(displayElements=displayElements.concat(clearAllRowsButtons),clearAllRowsButtons=[])}else for(j=0;j<displayElementsOriginal.length;j++)displayElements.push(displayElementsOriginal[j]);for(var clearAllRowsButton,i=0;i<displayElements.length;i++)switch(displayElements[i].nodeName){case"displayElement":for(var dElements=displayElements[i].childNodes,j=0;j<dElements.length;j++){switch(dElements[j].nodeName){case"table":theElement=new Simulator.Display.DataTable(sim,panel),dataTable=theElement,simMgr.setTableExists(!0);break;case"graph":break;default:continue}theElement.setAttributes(dElements[j].attributes,dElements[j]),setEvents(theElement,dElements[j]),theElement.render("dataOutputPanel")}break;case"commandElement":for(var cElements=displayElements[i].childNodes,c=0;c<cElements.length;c++){switch(cElements[c].nodeName){case"button":theElement=new Simulator.Control.Button(sim,panel);break;default:continue}theElement.setAttributes(cElements[c].attributes,cElements[c]),setEvents(theElement,cElements[c]),theElement.render("dataOutputPanel"),sim.getAccessibilityIFActive()&&"ResetTrials"==theElement.getHandler()&&void 0==clearAllRowsButton&&(clearAllRowsButton=simDocument.getElementById(theElement.getNodeID()));break}}}function setEvents(element,node){var attributes,events=[],children=node.childNodes;if(null!=children&&void 0!=children)for(var j=0;j<children.length;j++)if("event"===children[j].nodeName){var eventInfo=createEvent(element,attributes=children[j].attributes);element.addEvent(eventInfo.theEvent,eventInfo.direction)}return events}function createEvent(obj,attributes){for(var response=[],data="",ctx="",dir="",type="",postOnChange="no",completeWithoutOutput=!1,k=0;k<attributes.length;k++)switch(attributes[k].nodeName){case"direction":dir=attributes[k].nodeValue;break;case"data":data=attributes[k].nodeValue;break;case"context":ctx=attributes[k].nodeValue;break;case"type":type=attributes[k].nodeValue;break;case"postOnChange":postOnChange=attributes[k].nodeValue;break;case"completeWithoutOutput":completeWithoutOutput="yes"===attributes[k].nodeValue}return response.theEvent=new Simulator.Event(obj,type,ctx,data,postOnChange,completeWithoutOutput),response.direction=dir,response}function sendStartEvent(){eventMgr.postEvent(new Simulator.Event(simMgr,"command","load"))}function debug(str1,str2,trace){dbg.debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg.debugf(source,str1,str2,trace)}var source="Simulator",simID=null,speechEnabled=speechMode,language="english",mode="operation",xmlns="",simMgr=null,layout=null,animationSetObj=null,animationShellPath=null,animationExternalScriptsPath=null,animationPresent=!0,accessibilityIFActive=assistiveMode,currentLanguage=null,dataTable=null,instance=this,simDocument=null,visible=!0,eventMgr=new Simulator.EventManager(this),whiteboard=new Simulator.Whiteboard(this),scoringTable=new Simulator.Utils.Table(!0,"ScoringTable",this),persistentVariableDB=new Simulator.Utils.PersistentVariableDataBase(this),utils=new Simulator.Utils.Utils(this),dbg=new Simulator.Utils.Debug(this),keyboardInput=new Simulator.Input.KeyboardInput(this),html2jsMap=new Simulator.HTML2JSMap(this),translationDictionary="function"==typeof Simulator.Utils.TranslationDictionary?new Simulator.Utils.TranslationDictionary(this):{translate:function(tag){return tag}},sliderPreRenderQueue=new Simulator.Utils.Queue,sliderIndex=1,speechGrammarBldr=null,speechMgr=null;this.getSpeechGrammarBldr=function(){return speechGrammarBldr},this.getVisibility=function(){return visible},this.setVisibilityAndAttachEvents=function(newValue){visible=newValue,newValue&&(this.resize(this,!1),this.bindResize(simDocument.body,this))},this.getSourceName=function(){return source},this.getDataTable=function(){return dataTable},this.setAnimationShellPath=function(path){animationShellPath||(animationShellPath=path)},this.getAnimationShellPath=function(){return animationShellPath},this.setAnimationExternalScriptsPath=function(path){animationExternalScriptsPath||(animationExternalScriptsPath=path)},this.getAnimationExternalScriptsPath=function(){return animationExternalScriptsPath},this.getAnimationSet=function(){return animationSetObj},this.getSimulationManager=function(){return simMgr},this.getSimDocument=function(){return simDocument},this.getLayout=function(){return layout},this.getSimID=function(){return simID},this.getHTML2JSMap=function(){return html2jsMap},this.getParser=function(){return parser},this.getWhiteboard=function(){return whiteboard},this.getScoringTable=function(){return scoringTable},this.getPersistentVariableDB=function(){return persistentVariableDB},this.getEventManager=function(){return eventMgr},this.getDebug=function(){return dbg},this.getUtils=function(){return utils},this.getKeyboardInput=function(){return keyboardInput},this.getTranslationDictionary=function(){return translationDictionary},debug("Instantiating SimulationManager"),simMgr=new Simulator.SimulationManager(this),debug("Required services instantiated"),this.getSliderPreRenderQueue=function(){return sliderPreRenderQueue},this.getSliderIndex=function(){return sliderIndex++},this.getSpeechEnabled=function(){return speechEnabled},this.setCurrentLanguage=function(lang){currentLanguage=lang},this.getCurrentLanguage=function(){return currentLanguage},this.getAnimationDisplayLanguage=function(){return this.getCurrentLanguage()},this.getLanguage=function(){return language},this.getAltText=function(){return 0==this.getAccessibilityIFActive()?(debugf("attempted to access altText when not in accessibility mode"),""):this._altText?this._altText:""},this.setAltText=function(altTextString){var missingAltTextString;missingAltTextString="object"==typeof window.Messages&&window.Messages.has("Simulator.Animation.MissingAltText")?window.Messages.get("Simulator.Animation.MissingAltText"):"Animation alt text not found.",this._altText=""==altTextString||"null"==altTextString?missingAltTextString:altTextString,debugf('Setting simulator alt text to "'+this._altText+'"')},this.getMode=function(){return mode},this.getXmlns=function(){return xmlns},this.animationIsPresent=function(){return animationPresent},this.startSimulation=function(xmlFile){var xmlDoc=loadXMLDoc(xmlFile);this.startSimulationXmlDom(xmlDoc),sendStartEvent()},this.loadTranslationXmlText=function(xmlText){var transElem=loadXMLDocFromString(xmlText);this.loadTranslationXmlDom(transElem)},this.startSimulationXmlText=function(xmlText){var xmlDoc=loadXMLDocFromString(xmlText);this.startSimulationXmlDom(xmlDoc),sendStartEvent()};var onSliderContainerDone=function(){for(var sliderElement=instance.getSliderPreRenderQueue().remove();sliderElement;)sliderElement.postContainerRender(),sliderElement=instance.getSliderPreRenderQueue().remove()};this.loadTranslationXmlDom=function(transDom){debug("Translation dictionary is loading"),x=transDom.getElementsByTagName("translation"),x.length>0&&(debug("Found translation section"),translationDictionary.loadTranslations(x))},this.startSimulationXmlDom=function(xmlDoc){if(eventMgr.startEventProcessing(),debug("Simulator is loading"),container){var className=container.getAttribute("class");className?className+=" simV2":className="simV2",container.setAttribute("class",className)}var x=xmlDoc.childNodes[1];if(x||(x=xmlDoc.childNodes[0]),x||(x=xmlDoc.getElementsByTagName("simulationItem")),x){if(recordItemAttributes(0,x),simDocument=container.ownerDocument,speechEnabled&&(null===speechGrammarBldr&&(speechGrammarBldr=new Simulator.Speech.SpeechGrammarBuilder(this)),speechGrammarBldr.setItemName(this.getItemName()),speechGrammarBldr.createHeader()),(x=xmlDoc.getElementsByTagName("definition")).length>0){debug("found definition spec");var layOut=xmlDoc.getElementsByTagName("layout");if(!(layOut.length>0))return void dbg.logFatalError(source,'Missing "layout" element in xml input file.');debug("Found layout spec"),(layout=new Simulator.Display.Layout(this,container)).specifyLayout(layOut),layout.createPanels(layOut[0].childNodes)}else dbg.logFatalError(source,'Missing "definition" element in xml input file.');if((x=xmlDoc.getElementsByTagName("initialization")).length>0&&(debug("Found initialization section"),recordInitializationSpecs(x)),simMgr.initManagerVariables(),(x=xmlDoc.getElementsByTagName("state")).length>0&&debug("Found state element"),(x=xmlDoc.getElementsByTagName("input")).length>0){debug("Found input section"),whiteboard.addCategory("dataInput"),whiteboard.addCategory("evaluationInput"),whiteboard.addCategory("animationInput"),whiteboard.addCategory("evaluationOutput"),whiteboard.addCategory("animationOutput");var sections=xmlDoc.getElementsByTagName("section");if(!sections)return void dbg.logFatalError(source,'Missing "section" elements in xml input file.');for(var i=0;i<sections.length;i++)createInputSection(this,sections[i],i)}else dbg.logFatalError(source,'Missing "input" element in xml input file.');if((x=xmlDoc.getElementsByTagName("animation")).length>0){animationPresent=!0;for(k=0;k<x.length;k++)debug("Found animation section"),createAnimationMembers(this,x[k])}else animationPresent=!1;if((x=xmlDoc.getElementsByTagName("display")).length>0)for(var k=0;k<x.length;k++)debug("Found display section"),createDisplayMembers(this,x[k]);x=xmlDoc.getElementsByTagName("evaluation");var parser=new SimParser.EvaluationUnit(this);if(x.length>0){debug("Found evaluation section");try{parser.load(xmlDoc)}catch(err){return void dbg.logFatalError(source,"Error loading evaluation element: "+err)}}(x=xmlDoc.getElementsByTagName("control")).length>0&&debug("Found control section"),onSliderContainerDone(),speechEnabled&&(speechGrammarBldr.finishItemSpeechGrammar(),null===speechMgr&&(speechMgr=new Simulator.Speech.SpeechManager(this))),simMgr.setStateFromName("Loaded"),animationPresent||eventMgr.postEvent(new Simulator.Event(this,"info","allMediaLoaded"))}else dbg.logFatalError(source,'Missing "simulationItem" element in xml input file.')},this.bindResize=function(dom,scope){if(dom){dom.onresize=function(){scope.resize(scope,!1)}}else dbg.logError(source,"Failed to bind a resize event.")},this.resize=function(scope,zoom){(scope=scope||this).getVisibility()&&layout.resizeAllPanels(zoom)},this.getDoc=function(){return simDocument},this.getWin=function(){return window},this.loadXml=function(itemXml,responseXml){"string"==typeof itemXml?(this.loadTranslationXmlText(itemXml),this.startSimulationXmlText(itemXml)):(this.loadTranslationXmlDom(itemXml),this.startSimulationXmlDom(itemXml),sendStartEvent()),null!=responseXml&&responseXml.length>0&&this.loadResponseXml(responseXml)},this.getResponseXml=function(){var stateMgr=new Simulator.ResponseStateManager(this);return simMgr.setResponseStateVariables(stateMgr),stateMgr.saveState()},this.loadResponseXml=function(xmlText){var responseMgr=new Simulator.ResponseStateManager(this);simMgr.clearSimulationState();var xmlDoc=loadXMLDocFromString(xmlText);responseMgr.restoreSimulation(xmlDoc),simMgr.displaySimulatorState()},this.isValid=function(){return scoringTable.outputEntered()},this.isPlaying=function(){return simMgr.isPlaying()},this.setReadOnlyState=function(readOnlyState){simMgr.setReadOnlyState(readOnlyState)},this.getAccessibilityIFActive=function(){return accessibilityIFActive},this.zoom=function(factor){this.zoomFactor=factor,this.resize(this,!0)},this.show=function(){},this.hide=function(){keyboardInput.resetKeyboardFocusState()},this.focus=function(){this.getAccessibilityIFActive()||keyboardInput.initializeKeyboardShortcuts()},this.blur=function(){keyboardInput.removeKeyboardShortcuts()},this.subscribe=function(type,context,callback){var stateCallback={handleEvent:callback},event=new Simulator.Event(stateCallback,type,context);return eventMgr.registerEvent(event),event},this.unsubscribe=function(event){eventMgr.deRegisterEvent(event)},this.inspect=function(embedded,forced){var buff=[];if(buff.push("Inspecting "+source),buff.push("simID = "+simID),buff.push("End inspecting "+source),embedded)return buff.join("\n");forced?debugf(buff.join("\n")):debug(buff.join("\n"))},this.isLoaded=function(){return simMgr.isLoaded()},dbg.setDebug(!0),dbg.setErrorReportLevel("SimWarning"),simID=function(){var id=(new Date).getTime();return debug("simID generated: "+id),id}(),debug("accessibilityIFActive = "+accessibilityIFActive)},Simulator.SimulationManager=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="SimulationManager",instance=this;this.zoomFactor=1;var maxTrials=0,currentTrial=0,isTrialLimitReached=!1,noMoreTrialsString="Limit on the Number of Trials Reached.",simulatorHeight=0,simulatorWidth=0,originalSimulatorHeight=0,originalSimulatorWidth=0,animationFinished=!1,tableUpdated=!1,redoingTrial=!1,tableExists=!1,animationCompleteWithoutOutput=!1,stateName=null,restoreAnimationOnReload=null,clearScoreOnNewTrial=!1,useTrialNumFromDeleteQueue=!1,state={SimError:-1,Uninitialized:0,Initialized:1,Instantiated:2,Loading:3,Loaded:4,Ready:5,TrialLimitReached:6,Playing:7,ReadOnly:8},currentState=state.Uninitialized,eventMgr=function(){return sim.getEventManager()},whiteboard=function(){return sim.getWhiteboard()},scoringTable=function(){return sim.getScoringTable()},trialNumStack=(sim.getPersistentVariableDB(),new Simulator.Utils.Stack(sim)),deleteQueue=new Simulator.Utils.OrderedQueue(sim),layout=function(){return sim.getLayout()},dbg=function(){return sim.getDebug()},dataTable=function(){return sim.getDataTable()},transDictionary=function(){return sim.getTranslationDictionary()};registerAllEvents=function(simMgr){eventMgr().registerEvent(new Simulator.Event(simMgr,"command","startTrial")),eventMgr().registerEvent(new Simulator.Event(simMgr,"command","newTrial")),eventMgr().registerEvent(new Simulator.Event(simMgr,"command","startAnimation")),eventMgr().registerEvent(new Simulator.Event(simMgr,"command","resetTrials")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","errorOccurred")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","animationStarted")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","animationFinished")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","animationThreadFinished")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","simulatorStateChange")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","animationUnreachable")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","tableUpdated")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","allMediaLoaded")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","allTableRowsCleared")),eventMgr().registerEvent(new Simulator.Event(simMgr,"command","redoTrial")),eventMgr().registerEvent(new Simulator.Event(simMgr,"info","simulatorDimensionsAvaiable")),debug("Registered all pre - required events")},this.getName=function(){return"SimulationManager"},this.getSourceName=function(){return source},this.getRestoreAnimationOnReload=function(){return restoreAnimationOnReload},this.setSimulatorHeight=function(height){simulatorHeight=height||layout().getContainerHeight()},this.setSimulatorWidth=function(width){simulatorWidth=width||layout().getContainerWidth()},this.setOriginalSimulatorHeight=function(height){originalSimulatorHeight=height||layout().getContainerHeight()},this.setOriginalSimulatorWidth=function(width){originalSimulatorWidth=width||layout().getContainerWidth()},this.getItemName=function(){return""},this.getSimulatorHeight=function(){return simulatorHeight=layout().getContainerHeight()},this.getSimulatorWidth=function(){return simulatorWidth=layout().getContainerWidth()},this.getOriginalSimulatorHeight=function(){return originalSimulatorHeight},this.getOriginalSimulatorWidth=function(){return originalSimulatorWidth},this.setAnimationCompleteWithoutOutput=function(flag){animationCompleteWithoutOutput="yes"===flag||1==flag},this.getAnimationCompleteWithoutOutput=function(){return animationCompleteWithoutOutput},this.setState=function(theState){switch(currentState=theState,theState){case state.SimError:stateName="SimError";break;case state.Uninitialized:stateName="Uninitialized";break;case state.Initialized:stateName="Initialized";break;case state.Instantiated:stateName="Instantiated";break;case state.Loading:stateName="Loading";break;case state.Loaded:stateName="Loaded";break;case state.Ready:stateName="Ready";break;case state.TrialLimitReached:stateName="TrialLimitReached";break;case state.Playing:stateName="Playing";break;case state.ReadOnly:stateName="ReadOnly";break;default:return void dbg().logError(source,"Unknown state passed to setState: "+theState)}debugf("Simulator state: "+stateName),eventMgr().postEvent(new Simulator.Event(this,"info","simulatorStateChange",stateName))},this.getState=function(){return currentState},this.getStateName=function(){return stateName},this.verifyCheckListSelection=function(){return layout().hasEmptyChoiceListSelection()},this.setStateFromName=function(theStateName){switch(theStateName){case"SimError":this.setState(state.SimError);break;case"Uninitialized":this.setState(state.Uninitialized);break;case"Initialized":this.setState(state.Initialized);break;case"Instantiated":this.setState(state.Instantiated);break;case"Loading":this.setState(state.Loading);break;case"Loaded":this.setState(state.Loaded);break;case"Ready":this.setState(state.Ready);break;case"TrialLimitReached":this.setState(state.TrialLimitReached);break;case"Playing":this.setState(state.Playing);break;case"ReadOnly":this.setState(state.ReadOnly);break;default:return void dbg().logError(source,"Unknown state name passed to setState: "+stateName)}},this.handleEvent=function(event){switch(event.type){case"command":switch(event.context){case"startTrial":var redoingATrial=this.adjustForRedoTrials();this.checkTrialLimitReached(redoingATrial)?this.trialLimitReachedAction():(layout().saveInputs(!0),tableUpdated=!1,animationFinished=!1,this.setAnimationCompleteWithoutOutput(!1),redoingATrial||this.nextTrialNum());break;case"startAnimation":this.adjustForRedoTrials(),layout().saveInputs(),tableUpdated=!1,animationFinished=!1;break;case"newTrial":this.checkTrialLimitReached()?this.trialLimitReachedAction():this.adjustForRedoTrials();break;case"resetTrials":this.isReadOnly()||(this.resetTrialNum(),layout().enableAllInput());break;case"redoTrial":this.isReadOnly()||this.redoTrialNum(event.data)}break;case"info":switch(event.context){case"animationStarted":this.setPlayingState();break;case"animationThreadFinished":animationFinished=!0,debug(source,"Received animationThreadFinished event from, animationCompleteWithoutOutput = "+this.getAnimationCompleteWithoutOutput()),this.getAnimationCompleteWithoutOutput()?(dataTable().saveScoreableInputs(),debug(source,"Received animationThreadFinished event with animationCompleteWithoutOutput = true. Table was not updated. Current trial number remains at "+this.getTrialNum()),this.setReadyState()):(debug("this.getTableExists() = "+this.getTableExists()+", tableUpdated = "+tableUpdated),this.getTableExists()&&tableUpdated?(dataTable().saveScoreableInputs(),whiteboard().clearCategory("evaluationOutput"),this.setReadyState()):this.getTableExists()?(debug(source,"Table does exist but has not been updated"),this.setReadyState()):(debug(source,"Table does not exist. Setting simulator state to Ready"),this.setReadyState()));break;case"animationUnreachable":dbg.logWarning("AnimationUnreachable.Setting Ready state in SimulationManager.handleEvent"),this.setReadyState();break;case"tableUpdated":tableUpdated=!0,debug("Received tableUpdated event"),animationFinished&&this.setReadyState();break;case"allTableRowsCleared":layout().enableAllInput();break;case"allMediaLoaded":debug("SimulationManager received 'allMediaLoaded' event"),this.setReadyState();break;case"fatalErrorOccurred":this.setState(state.Error),eventMgr().postEvent(new Simulator.Event({source:this,type:"error",context:"FatalSimulationError",data:event.data})),eventMgr().stopEventProcessing()}break;default:dbg().logWarning(source,'Unrecognized event of type "'+event.type+'" and context: "'+event.context+'"')}},this.lastTrialReached=function(){return!(deleteQueue.length()>0)&&(0!==maxTrials&&(!(trialNumStack.peek()<parseInt(maxTrials))&&(trialNumStack.push(parseInt(maxTrials)),!0)))},this.checkTrialLimitReached=function(redoingATrial){return deleteQueue.length()>0?(isTrialLimitReached=!1,!1):0===maxTrials?(isTrialLimitReached=!1,!1):isTrialLimitReached=redoingATrial?currentTrial>parseInt(maxTrials):currentTrial>=parseInt(maxTrials)},this.trialLimitReached=function(){return isTrialLimitReached},this.nextTrialNum=function(){var val=trialNumStack.peek();isNaN(val)?trialNumStack.push(0):trialNumStack.push(parseInt(trialNumStack.peek())+1),currentTrial=trialNumStack.peek(),!this.trialLimitReached()&&clearScoreOnNewTrial&&scoringTable().clearTable(),trialNumStack.inspect(),deleteQueue.inspect(),debug("SimulationManager.NextTrialNum: Setting next trial number to "+currentTrial)},this.adjustForRedoTrials=function(){return deleteQueue.length()>0?(currentTrial=deleteQueue.remove(),useTrialNumFromDeleteQueue=!0,redoingTrial=!1,!0):!!useTrialNumFromDeleteQueue&&(useTrialNumFromDeleteQueue=!1,currentTrial=trialNumStack.peek(),isNaN(currentTrial)&&(currentTrial=0),!1)},this.redoTrialNum=function(num){deleteQueue.add(num),trialNumStack.inspect(),deleteQueue.inspect(),redoingTrial=!0,this.setReadyState()},this.getTrialRowNum=function(recordOnChange){if(recordOnChange){if(0==deleteQueue.length()){val=trialNumStack.peek();return isNaN(val)?0:parseInt(trialNumStack.peek())}return deleteQueue.peek()-1}if(useTrialNumFromDeleteQueue)return currentTrial-1;var val=trialNumStack.peek();return isNaN(val)?0:parseInt(trialNumStack.peek())},this.isRedoingTrial=function(){return redoingTrial},this.getTrialNum=function(){return currentTrial},this.getInitialTrialNum=function(){return 0},this.setTrialNum=function(num){trialNumStack.push(num),debug("SimulationManager.SetTrialNum: Setting current trial number to "+(currentTrial=num))},this.resumeTrials=function(){},this.resetTrialNum=function(){deleteQueue.clear(),trialNumStack.push(Simulator.Constants.DEFAULT_INITIAL_TRIAL_NUM),currentTrial=trialNumStack.peek()},this.getDisabledAction=function(){switch(this.getState()){case state.TrialLimitReached:return trialLimitReachedAction;default:return this.noAction}},this.trialLimitReachedAction=function(){this.setTrialLimitReachedState(),Simulator.showAlertWarning(this.getNoMoreTrialString())},this.noAction=function(){},this.getNoMoreTrialString=function(){return transDictionary().translate(noMoreTrialsString)},this.getBaseURL=function(){return baseURL},this.getName=function(){return source},this.isPlaying=function(){return"Playing"===this.getStateName()},this.isReadOnly=function(){return"ReadOnly"==this.getStateName()},this.isLoaded=function(){return this.getState()>=state.Loaded},this.isReady=function(){return this.getState()===state.Ready},this.setReadOnlyState=function(newState){!0===newState?this.setState(state.ReadOnly):this.setState(state.Ready)},this.setReadyState=function(){this.setState(state.Ready),debugf('Enabling all input and setting simulator state to "Ready"',null,"notrace"),layout().enableAllInput()},this.setPlayingState=function(){debugf('Disabling all input and setting simulator state to "Playing"',null,"notrace"),this.setState(state.Playing),layout().disableAllInput()},this.setTrialLimitReachedState=function(){this.setState(state.TrialLimitReached),layout().disableAllInput(),layout().enableStartButton()},this.getNextItem=function(){window.location.reload()},this.getResponse=function(){return dataDB.getContents()},this.setTableExists=function(flag){tableExists=1==flag},this.getTableExists=function(){return tableExists},this.displaySimulatorState=function(embedded){var buff=[],aState=null;buff.push("Simulator State:"),buff.push("-----------------------"),buff.push(deleteQueue.inspect(!1)),buff.push(trialNumStack.inspect(!1)),buff.push("currentTrial = "+currentTrial),buff.push("redoingTrial = "+redoingTrial),buff.push("currentState = "+this.getStateName()),buff.push("zoomFactor = "+this.zoomFactor),buff.push("speechEnabled = "+sim.getSpeechEnabled()),buff.push("simulator height = "+this.getSimulatorHeight()),buff.push("simulator width = "+this.getSimulatorWidth()),null!==sim.getAnimationSet()?aState=sim.getAnimationSet().getCurrentAnimationState():(aState=[])["animation state"]="none";for(var p in aState)buff.push(p+" = "+aState[p]);if(buff.push("End of Simulator State"),buff.push("-----------------------"),embedded)return buff.join("\n");debug(buff.join("\n"))},this.initManagerVariables=function(){var whtBrd=whiteboard();this.setTrialNum(Simulator.Constants.DEFAULT_INITIAL_TRIAL_NUM),currentTrial=this.getTrialNum(),whtBrd.itemExists("initialization","MaxTrials")&&(maxTrials=whtBrd.getItem("initialization","MaxTrials"))&&maxTrials>0&&scoringTable().setMaxRowNum(maxTrials),whtBrd.itemExists("initialization","NoMoreTrialsString")&&(noMoreTrialsString=whtBrd.getItem("initialization","NoMoreTrialsString")),whtBrd.itemExists("initialization","ClearScoreOnNewTrial")&&(clearScoreOnNewTrial=whtBrd.getItem("initialization","ClearScoreOnNewTrial"),clearScoreOnNewTrial="yes"===clearScoreOnNewTrial),whtBrd.itemExists("initialization","RestoreAnimationOnReload")&&(restoreAnimationOnReload=whtBrd.getItem("initialization","RestoreAnimationOnReload"),restoreAnimationOnReload="yes"===restoreAnimationOnReload)},this.setSimulatorHeight=function(height){simulatorHeight=height},this.setSimulatorWidth=function(width){simulatorWidth=width},this.setResponseStateVariables=function(stateMgr){stateMgr.setResponseStateVariableValue("deleteQueue",deleteQueue.entriesAsString()),stateMgr.setResponseStateVariableValue("trialNumStack",trialNumStack.entriesAsString()),stateMgr.setResponseStateVariableValue("currentTrial",currentTrial),stateMgr.setResponseStateVariableValue("redoingTrial",redoingTrial),"ReadOnly"==this.getStateName()?stateMgr.setResponseStateVariableValue("currentState","Ready"):stateMgr.setResponseStateVariableValue("currentState",this.getStateName()),stateMgr.setResponseStateVariableValue("zoomFactor",this.zoomFactor),stateMgr.setResponseStateVariableValue("speechEnabled",sim.getSpeechEnabled()),"ReadOnly"==this.getStateName()?stateMgr.setResponseStateVariableValue("simulatorHeight",this.getOriginalSimulatorHeight()):stateMgr.setResponseStateVariableValue("simulatorHeight",this.getSimulatorHeight()),"ReadOnly"==this.getStateName()?stateMgr.setResponseStateVariableValue("simulatorWidth",this.getOriginalSimulatorWidth()):stateMgr.setResponseStateVariableValue("simulatorWidth",this.getSimulatorWidth())},this.clearSimulationState=function(){trialNumStack.clear(),deleteQueue.clear()},this.restoreStateVariables=function(stateDB){var parts=null;for(p in stateDB)switch(p){case"deleteQueue":deleteQueue.clear(),parts=stateDB.deleteQueue.split(",");for(i=0;i<parts.length;i++)parts[i]&&void 0!==parts[i]&&""!==parts[i]&&deleteQueue.add(parseInt(parts[i]));break;case"trialNumStack":trialNumStack.clear();for(var i=(parts=stateDB.trialNumStack.split(",")).length-1;i>-1;i--)parts[i]&&void 0!==parts[i]&&""!==parts[i]&&trialNumStack.push(parseInt(parts[i]));break;case"currentTrial":""!==stateDB[p]&&(currentTrial=parseInt(stateDB[p]));break;case"redoingTrial":redoingTrial="true"===stateDB[p];break;case"currentState":this.setStateFromName(stateDB[p]);break;case"zoomFactor":this.zoomFactor=parseFloat(stateDB[p]);break;case"simulatorHeight":this.setSimulatorHeight(stateDB[p]),this.setOriginalSimulatorHeight(stateDB[p]);break;case"simulatorWidth":this.setSimulatorWidth(stateDB[p]),this.setOriginalSimulatorWidth(stateDB[p])}this.displaySimulatorState()},sim&&registerAllEvents(instance)},Simulator.ResponseStateManager=function(sim){function writeSimulationState(indent){var simStateStr=indent+"<state>\n",doubleIndent=indent+indent,tripleIndent=doubleIndent+indent;for(var p in stateDB)simStateStr=simStateStr+doubleIndent+'<stateSpec element="'+p+'" value="'+stateDB[p]+'" /> \n';var store=persistentVarDB().getContents();for(var i in store)simStateStr=simStateStr+doubleIndent+'<stateSpec element="'+i+'" value="'+store[i]+'" persistent="yes" /> \n';simStateStr+=sim.getLayout().getPanelInstance(Simulator.Constants.INPUT_PANEL_NAME).saveInputElementStates(indent,"<inputSpec ",'element="','" value="','" />\n');var displayTable=dataTable();if(displayTable){var tableStr=displayTable.getContents(tripleIndent);tableStr&&(simStateStr=simStateStr+doubleIndent+'<stateTableSpec id="dataTable"> \n'+tableStr+doubleIndent+"</stateTableSpec>")}if(simMgr().getRestoreAnimationOnReload()){var animationState=sim.getAnimationSet().getCurrentAnimationState();if(void 0!=animationState&&null!=animationState){simStateStr=simStateStr+doubleIndent+"<animationStateSpec> \n";for(var k in animationState)simStateStr=simStateStr+tripleIndent+'<stateSpec element="'+k+'" value="'+animationState[k]+'" /> \n';simStateStr=simStateStr+doubleIndent+"</animationStateSpec>"}}return simStateStr=simStateStr+indent+"\n</state>\n"}var stateDB={},persistentVarDB=function(){return sim.getPersistentVariableDB()},simMgr=function(){return sim.getSimulationManager()},scoringTable=function(){return sim.getScoringTable()},dataTable=function(){return sim.getDataTable()},setStateVarSpec=function(initNode){var attr=initNode.attributes;if(attr.length>0){var element=attr.element.nodeValue,value=attr.value.nodeValue;attr.persistent?"yes"==attr.persistent.nodeValue&&persistentVarDB().updateElement(element,value):stateDB[element]=value}},setInputStateSpec=function(initNode,panel){var attr=initNode.attributes;if(attr.length>0){var element=attr.element.nodeValue,value=attr.value.nodeValue;panel.setElementSelectState(element,value)}},setAnimationStateSpec=function(initNode){for(var spec=null,attr=null,animationStateDB=[],children=initNode.childNodes,i=0;i<children.length;i++)if("#"!=children[i].nodeName[0]&&(spec=children[i],(attr=spec.attributes).length>0)){var element=attr.element.nodeValue,value=attr.value.nodeValue;animationStateDB[element]=value}Object.size(animationStateDB)>0&&sim.getAnimationSet().setCurrentAnimationState(animationStateDB)};this.setResponseStateVariableValue=function(theVariable,theValue){stateDB[theVariable]=theValue},this.getResponseStateVariableValue=function(theVariable){return stateDB[theVariable]},this.restoreSimulation=function(xmlDoc){var responseSpec=xmlDoc.getElementsByTagName("responseSpec")[0];if(responseSpec){for(var children=responseSpec.getElementsByTagName("state")[0].childNodes,i=0;i<children.length;i++)if("#"!=children[i].nodeName[0])switch(children[i].nodeName){case"stateSpec":setStateVarSpec(children[i]);break;case"inputSpec":setInputStateSpec(children[i],sim.getLayout().getPanelInstance(Simulator.Constants.INPUT_PANEL_NAME));break;case"stateTableSpec":for(var nextGen=children[i].childNodes,q=0;q<nextGen.length;q++)"stateTable"==nextGen[q].nodeName&&dataTable().loadFromResponse(nextGen[q]);break;case"animationStateSpec":setAnimationStateSpec(children[i])}simMgr().restoreStateVariables(stateDB),scoringTable().restoreResponseTable(responseSpec.getElementsByTagName("responseTable")[0])}},this.saveState=function(){var stateStr="<responseSpec>\n";return stateStr+=scoringTable().getContents("  ")+"\n\n",stateStr+=writeSimulationState("  "),stateStr+="\n</responseSpec>"}},Simulator.Display.Canvas=function(sim){Simulator.SimElement.call(this,sim);var source="Canvas",hTMLElement="",top=0,left=0,height=0,width=0,backgroundColor="",simulationMgr=function(){return sim.getSimulationManager()};this.getHTMLElement=function(){return hTMLElement},this.setHTMLElement=function(newHTMLElement){return hTMLElement=newHTMLElement,this},this.getTop=function(){return top},this.setTop=function(newTop){return top=newTop,this},this.getLeft=function(){return left},this.setLeft=function(newLeft){return left=newLeft,this},this.getHeight=function(){return simulationMgr()?parseFloat(height)/100*simulationMgr().getSimulatorHeight():0},this.getHeightPercentage=function(){return height},this.setHeight=function(newHeight){return height=newHeight,this},this.getWidth=function(){return simulationMgr()?parseFloat(width)/100*simulationMgr().getSimulatorWidth():0},this.getWidthPercentage=function(){return width},this.setWidth=function(newWidth){return width=newWidth,this},this.getBackgroundColor=function(){return backgroundColor},this.setBackgroundColor=function(newBackgroundColor){return backgroundColor=newBackgroundColor,this},this.containsElement=function(elementID){for(var children=hTMLElement.childNodes,i=0;i<children.length;i++)if("#"!=children[i].nodeName[0]&&children[i].nodeValue==elementID)return!0;return!1},this.containsElementWithAttribute=function(elementID,attributeName,attributeValue){for(var attributes=null,children=hTMLElement.childNodes,i=0;i<children.length;i++)if("#"!=children[i].nodeName[0]){if(children[i].nodeValue!=elementID)return!1;if(!(attributes=children[i].attributes))return!1;if(attributeName in attributes)return!attributeValue||attributes[attributeName]==attributeValue}return!1},this.setEname("Canvas"),this.setAttributes=function(attr,node){Simulator.Display.Canvas.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"top":this.setTop(attr[i]);break;case"left":this.setLeft(attr[i]);break;case"height":this.setHeight(attr[i]);break;case"width":this.setWidth(attr[i]);break;case"backgroundColor":this.setBackgroundColor(attr[i])}},this.getSourceName=function(){return source}},Simulator.Display.Canvas.prototype=new Simulator.SimElement,Simulator.Display.Canvas.prototype.constructor=Simulator.Display.Canvas,Simulator.Display.Panel=function(sim,panelNum){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Display.Canvas.call(this,sim);var source="Panel",instance=this,headerText="",headerTextSize="",float="",initialFocus=!1,display="hidden",borderColor="",dialogAttr=[],panelNumber=panelNum,panelID="",dialogPanel=null,ioElements=[],dialogButtonLabel="",originalWidth=null,originalHeight=null,dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};this.registerIOElement=function(inputElement){ioElements.push(inputElement)},this.getOriginalHeight=function(){return originalHeight},this.getOriginalWidth=function(){return originalWidth},this.recordOriginalWidthAndHeight=function(){"animationPanel"!=this.getName()||originalWidth>0&&originalHeight>0||(originalWidth=this.getWidth(),originalHeight=this.getHeight(),debugf(source,"Recording Original Width ="+originalWidth+" Original Heigth ="+originalHeight))},this.getHeaderText=function(){return headerText},this.setHeaderText=function(newHeaderText){return headerText=newHeaderText,this},this.getHeaderTextSize=function(){return headerTextSize},this.setHeaderTextSize=function(textSize){return(headerTextSize="small"==textSize||"medium"==textSize|"large"==textSize|"x-Large"==textSize?textSize:null)||(dbg().logError(source,"Invalid value for headerTextSize attribute: "+textSize),headerTextSize=""),this},this.getFloat=function(){return float},this.setFloat=function(newFloat){return(float="left"==newFloat|"right"==newFloat||"none"==newFloat?newFloat:null)||(dbg().logError(source,"Invalid value for float attribute: "+newFloat),newFloat=""),this},this.getInitialFocus=function(){return initialFocus},this.setInitialFocus=function(newInitialFocus){return initialFocus="yes"==newInitialFocus,this},this.setDialogButtonLabel=function(newLabel){dialogButtonLabel=newLabel},this.getDialogButtonLabel=function(){return dialogButtonLabel},this.getDisplay=function(){return display},this.setDisplay=function(newDisplay){return(display="inline"==newDisplay||"block"==newDisplay||"none"==newDisplay||"hidden"==newDisplay||"visible"==newDisplay?newDisplay:null)||(dbg().logError(source,"Invalid value for display attribute: "+newDisplay),display="hidden"),this},this.resize=function(zoom){"animationPanel"==this.getName()&&sim.getAnimationSet()&&sim.getAnimationSet().getRenderer().resizeAnimationElements(this,zoom)},this.getBorderColor=function(){return borderColor},this.setBorderColor=function(newBorderColor){return borderColor=newBorderColor,this},this.appendStr=function(str){var hElement=this.getHTMLElement();hElement.innerHTML=hElement.innerHTML+str},this.setStr=function(str){this.getHTMLElement().innerHTML=str},this.resetStr=function(str){this.getHTMLElement().innerHTML=this.getHeaderText()+str},this.disableAllInput=function(){for(var i=0;i<ioElements.length;i++)ioElements[i].disableInput()},this.enableAllInput=function(){for(var i=0;i<ioElements.length;i++)ioElements[i].enableInput()},this.enableStartButton=function(){for(var i=0;i<ioElements.length;i++)ioElements[i].enableStartButton&&ioElements[i].enableStartButton()},this.saveInputs=function(forcedSave){for(var i=0;i<ioElements.length;i++)ioElements[i].recordInput&&ioElements[i].recordInput(null,null,null,forcedSave)},this.saveInputElementStates=function(indent,preface,nameStr,valStr,suffix){for(var stateStr="",i=0;i<ioElements.length;i++)ioElements[i].saveState&&(stateStr=stateStr+indent+ioElements[i].saveState(indent,preface,nameStr,valStr,suffix));return stateStr},this.setElementSelectState=function(elementID,contents){for(var iElement=null,i=0;i<ioElements.length;i++)(iElement=ioElements[i]).getName()==elementID&&iElement.setElementSelectState("true",contents)},this.setLiveAttribute=function(liveValue){liveValue?this.getHTMLElement().setAttribute("aria-live",liveValue):this.getHTMLElement().setAttribute("aria-live","off")},this.hasEmptyChoiceListSelection=function(){for(var iElement=null,i=0;i<ioElements.length;i++)if("choiceList"===(iElement=ioElements[i]).getType()&&0==iElement.getData().length){var sectionLabel=iElement.getSectionLabel();return null!=sectionLabel&&""!=sectionLabel?dbg().logFatalError(iElement.getName(),'you must make a selection for "'+sectionLabel+'"!'):dbg().logFatalError(iElement.getName(),"you must make a selection for a choice element!"),!0}return!1},this.getHTMLPanel=function(){return simDocument().getElementById(this.getName())},this.setAttributes=function(panel,attr){Simulator.Display.Panel.prototype.setAttributes.call(this,attr);for(var i in attr)switch(i){case"headerText":this.setHeaderText(attr[i]);break;case"headerTextSize":this.setHeaderTextSize(attr[i]);break;case"float":this.setFloat(attr[i]);break;case"display":this.setDisplay(attr[i]);break;case"border":this.setBorder(attr[i]);break;case"initialFocus":this.setInitialFocus(attr[i]);break;case"instructions":dialogAttr[i]=attr[i];break;case"button":this.setDialogButtonLabel(attr[i]);break;case"borderColor":this.setBorderColor(attr[i]);break;case"title":this.setTitle(attr[i])}utils().assocArrayIsEmpty(dialogAttr)||(dialogPanel=new Simulator.Display.DialogPanel(sim,instance,panelID,this.getDialogButtonLabel(),dialogAttr))},this.render=function(){var div=simDocument().createElement("div");if(this.getFloat()&&(div.style.display=this.getFloat()),this.getHeightPercentage()&&(div.style.height=this.getHeightPercentage()),this.getWidthPercentage()&&(div.style.width=this.getWidthPercentage()),this.getTop()&&(div.style.top=this.getTop()),this.getLeft()&&(div.style.left=this.getLeft()),div.id=this.getNodeID(),div.setAttribute("class","panel"+panelNumber+" panelSingle "+this.getName()),div.setAttribute("role","region"),div.setAttribute("aria-live","off"),this.getHeaderText()){var div2=simDocument().createElement("div");div2.setAttribute("class","holderInfo"),div2.innerHTML=this.getHeaderText(),div.appendChild(div2)}simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME+sim.getSimID()).appendChild(div),this.setHTMLElement(div),"instructions"in dialogAttr&&("button"in dialogAttr?dialogPanel.render():div.innerHTML=this.getDialogAttr().instructions),this.mapHTML2JS(div)},this.getSourceName=function(){return source},this.inspect=function(embedded,forced){var buff=[],sep="\n";embedded||buff.push("Inspecting "+this.getName()+" panel"),buff.push(sep);for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(embedded)return buff.join("");null===forced?debug(buff.join("")):debugf(buff.join(""))},this.addPanelClass=function(className){var htmlPanel=simDocument().getElementById(this.getNodeID());if(htmlPanel){var classNames=htmlPanel.getAttribute("class");if(-1!=classNames.indexOf(className))return;""!=classNames&&(className=" "+className),classNames+=className,htmlPanel.setAttribute("class",classNames)}}},Simulator.Display.Panel.prototype=new Simulator.Display.Canvas,Simulator.Display.Panel.prototype.constructor=Simulator.Display.Panel,Simulator.Animation.InlineData=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="InlineData",id="",name="",data="",animationElementName="",util=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()},dbg=function(){return sim.getDebug()};this.setID=function(newID){id=newID},this.getID=function(){return id},this.setName=function(newName){return name=newName,this},this.getName=function(){return name},this.setData=function(newData){return data=newData,this},this.getData=function(){return data},this.setAnimationElement=function(newAnimationElementName){animationElementName=newAnimationElementName},this.getAnimationElementName=function(){return animationElementName},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";if(buff.push("Inspecting InlineData element "+this.getName()),"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep)),buff.push("End of inlineData element inspection"),buff.push(sep),embedded)return buff.join("");null==force?debug(buff.join("")):debugf(buff.join(""))},Simulator.Animation.InlineData.prototype.setAttributes=function(attr,node){var attr=util().getAttributes(node);for(var i in attr)switch(i){case"id":this.setID(attr[i]);break;case"name":this.setName(attr[i]);break;case"animationElement":this.setAnimationElement(attr[i])}}},Simulator.Animation.AnimationElement=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2){dbg().debugf(source,str1,str2,trace)}Simulator.SimElement.call(this,sim);var source="AnimationElement",controls="",src="",altSrc="",altSrcType="",altText="",behavior="timeline",inlineDataID="",interactive=!1;this.setEname(source);var util=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()},dbg=function(){return sim.getDebug()},simMgr=function(){return sim.getSimulationManager()},transDictionary=function(){return sim.getTranslationDictionary()};this.getControls=function(){return controls},this.setControls=function(newControls){return controls="yes"==newControls?"controls":"",this},this.getSrc=function(){return transDictionary().translate(src)},this.setSrc=function(newSrc){var filename=util().getFileName(transDictionary().translate(newSrc),!0);return src="inlineData"==filename?"":newSrc,this},this.getAltSrc=function(){return transDictionary().translate(altSrc)},this.setAltSrc=function(newAltSrc){var filename=util().getFileName(transDictionary().translate(newAltSrc),!0);return altSrc="inlineData"==filename?"":newAltSrc,this},this.getAltSrcType=function(){return altSrcType},this.setAltSrcType=function(newAltSrcType){return altSrcType=newAltSrcType,this},this.setAltText=function(newAltText){return altText=newAltText,this},this.getAltText=function(){return altText},this.setInteractive=function(newInteractive){return(interactive="yes"==newInteractive)&&(behavior=Simulator.Constants.INTERACTIVE_ANIMATION),this},this.getInteractive=function(){return interactive},this.getBehavior=function(){return behavior},this.setBehavior=function(newBehavior){return(behavior=newBehavior)===Simulator.Constants.INTERACTIVE_ANIMATION&&(interaction=!0),this},this.setInlineDataID=function(newInlineDataID){return inlineDataID=newInlineDataID,this},this.getInlineDataID=function(){return inlineDataID},this.setAttributes=function(attr,node){node&&(attr=util().getAttributes(node)),Simulator.Animation.AnimationElement.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"controls":this.setControls(attr[i]);break;case"src":this.setSrc(attr[i]);break;case"altSrc":this.setAltSrc(attr[i]);break;case"altSrcType":this.setAltSrcType(attr[i]);break;case"altText":this.setAltText(attr[i]);break;case"behavior":this.setBehavior(attr[i]);break;case"interactive":this.setInteractive(attr[i]);break;default:continue}},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";buff.push("Inspecting "),buff.push(this.getEname()),buff.push(": "),buff.push(this.getName()),buff.push(sep);for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(embedded)return buff.join("");null==force?debug(buff.join("")):debugf(buff.join(""))}},Simulator.Animation.AnimationElement.prototype=new Simulator.SimElement,Simulator.Animation.AnimationElement.parent=Simulator.SimElement,Simulator.Animation.AnimationElement.prototype.constructor=Simulator.Animation.AnimationElement,Simulator.Animation.AnimationRenderer=function(sim,thePanel,animationSet){function doImageRendering(element,img,panelName,div,span,renderMaxTime){debug("In doImageRendering - Image = "+img.src+", height = "+img.height+", width = "+img.width);var dimensions=util().setDimensions(panel.getHeight(),panel.getWidth(),img.height,img.width,10);dimensions.height>0&&dimensions.width>0&&(img.height=dimensions.height,img.width=dimensions.width,debug("In doImageRendering - Image resize with padding to height = "+img.height+", width = "+img.width)),span.appendChild(img),elementInfomediaType="image",elementInfoid=div.id,elementInfosrc=img.src,renderMaxTime||(remderMaxTime=0),renderMaxTime>=0&&setTimeout(function(){handleTimeout(element)},renderMaxTime)}function handleTimeout(renderedElement){var anEvent=null;if(void 0!=renderedElement&&null!=renderedElement){var thread=animationSet.getCurrentThread();null!=thread&&void 0!=thread?null==thread.renderNextThreadElement()&&(anEvent=new Simulator.Event(renderedElement,"info","animationThreadFinished"),eventMgr().postEvent(anEvent)):(anEvent=new Simulator.Event(renderedElement,"info","animationThreadFinished"),eventMgr().postEvent(anEvent))}else dbg().logFatalError(source,"renderedElement is null in AnimationRenderer.handleTimeout")}function flashEmbedSuccessCallback(event){event.success?(animationSet.setCurrentAnimation(simDocument().getElementById(event.ref.id)),eventMgr().postEvent(new Simulator.Event(animationSet,"info","animationEmbedded",event.ref)),sendDataToAnimationElement(!1)):(animationSet.setCurrentAnimation(null),dbg().logFatalError(source,"Could not embed flash element "+event.id))}function sendDataToAnimationElement(element,update){var t=null,foundSource=!1,interactive=!1,data="";sim.getAccessibilityIFActive();if(element=element||currentAnimationElement,debug("In sendDataToAnimationElement - element = "+element.getName()),util().elementInArray(animationSet.getInputSource(),"evaluator")&&(null==(data=transDictionary().translateEvaluationOutput(whiteboard().getItem("evaluationOutput","output")))||""==data?data="":foundSource=!0),util().elementInArray(animationSet.getInputSource(),"animation")){var animationData=whiteboard().getCategoryAsEnglishTranslatedString("animationInput");foundSource=!0,""!=animationData&&null!=animationData&&(""!=data&&null!=data?data+=Simulator.Constants.PAIR_DELIMITTER+animationData:data=animationData)}if(0!=foundSource){0==tries&&util().markTime();var movie=animationSet.getCurrentAnimation();if(movie){if(!movie.animationInput)return t=setTimeout(function(){sendDataToAnimationElement(element,!1)},animationInterval),void(++tries>maxTries&&(clearTimeout(t),tries=0,dbg().logFatalError(source,"Could not establish interface with animation element "+currenAnimationName+" after "+tries+" attempts spanning "+util().getElapsedTime()+" ms")));clearTimeout(t),tries=0;var simID=sim.getSimID();element.getInteractive&&(interactive=element.getInteractive()),movie.animationInitialize&&movie.animationInitialize(simID,interactive),update?movie.animationInput?(debugf('Sending "update" to animation "'+currenAnimationName+'" with data: "'+data+'" after '+util().getElapsedTime()+" ms"),eventMgr().postEvent(new Simulator.Event(animationSet,"info","animationStarted")),null!=data&&""!=data?movie.animationInput(simID,"update",data):movie.animationInput(simID,"update","input")):dbg().logFatalError(source,"Could not re-establish previously established interface with animation element "+currenAnimationName):(null!=data&&""!=data?(movie.animationInput(simID,"input",data),debugf('Sending "'+data+'" to animation "'+currenAnimationName+'"')):(movie.animationInput(simID,"input","input"),debugf('Sending "input" to animation "'+currenAnimationName+'"')),sim.getAccessibilityIFActive()?(movie.animationInput(simID,"command",Simulator.Constants.OUTPUT_REQ_CMD),debug("Requesting animation output since accessibilityIF is true"),simulateAnimationExecutionTime(),requestAltText(movie)):(debugf('Sending "play" to current animation after '+util().getElapsedTime()+" ms"),eventMgr().postEvent(new Simulator.Event(animationSet,"info","animationStarted")),movie.animationInput(simID,"command","play")))}}else dbg().logFatalError(source,"Unknown input source "+animationSet.getInputSource()+" in sendDataToAnimationElement. No data sent to animation element")}function appendExternalScriptURLParameter(animationUrl,scriptUrl){return scriptUrl&&(scriptUrl=encodeURIComponent(scriptUrl)),animationUrl&&(animationUrl=-1!=animationUrl.indexOf("?")?animationUrl.replace("?","?scriptUrl="+scriptUrl+"&"):animationUrl+"?scriptUrl="+scriptUrl),animationUrl}function createHTML5AnimationInterface(element,iFrame,animationName,renderMaxTime){var html5Shell=new Simulator.Animation.HTML5Shell(sim,simID);if(html5Shell){var parameters={callback:animationSet.animationMediaOutput,behavior:element.getBehavior(),inlineData:null,containerID:iFrame.id,outputOnReq:animationSet.getOutputOnRequest(),simLanguage:sim.getAnimationDisplayLanguage(),accessibilityMode:sim.getAccessibilityIFActive()?"true":"false"};animationSet.setCurrentAnimation(html5Shell),result=html5Shell.initialize(simID,parameters),result!==Simulator.Constants.ANIMATION_LOADED&&dbg().logFatalError(source,"Could not initialize HTML5Shell"),currenAnimationName=animationName}else dbg().logFatalError(source,"Could not instantiate HTML5Shell");void 0!=renderMaxTime&&null!=renderMaxTime&&renderMaxTime>=0&&setTimeout(function(){handleTimeout(element)},renderMaxTime),sendDataToAnimationElement(element,!1)}function simulateAnimationExecutionTime(renderer){debug("Posting animationThreadFinished event since accessibilityIF is true"),eventMgr().postEvent(new Simulator.Event(this,"info","animationThreadFinished"))}function createAltTextElement(){if(simDocument().getElementById(altTextID))return simDocument().getElementById(altTextID);var altTextDiv=simDocument().createElement("div");altTextDiv.id="altTextDiv"+simID,altTextDiv.setAttribute("class","altText"),altTextDiv.style.position="absolute",altTextDiv.style.top="0px";var altTextSpan=simDocument().createElement("span");return altTextSpan.id=altTextID,altTextDiv.appendChild(altTextSpan),panel.getHTMLElement().appendChild(altTextDiv),altTextSpan}function requestAltText(movie){movie.requestAltText?movie.requestAltText():movie.animationInput(simID,Simulator.Constants.PARAM_COMMAND,Simulator.Constants.ALT_TEXT_REQ_CMD)}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.SimItem.call(this,sim);var source="AnimationRenderer",prevImageID=null,elementInfomediaType=null,elementInfoid=null,elementInfosrc=null,currenAnimationName=null,currentAnimationElement=null,tries=0,maxTries=10,animationInterval=500,panel=thePanel,simID=null,iFrameID=null,altTextID=this.createItemID(!1,-1,"altText");sim&&(simID=sim.getSimID());var util=function(){return sim.getUtils()},dbg=function(){return sim.getDebug()},whiteboard=function(){return sim.getWhiteboard()},eventMgr=function(){return sim.getEventManager()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()};this.sendDataToAnimation=function(element){sendDataToAnimationElement(element,!1)},this.renderImage=function(element,panelName,imageSrc,currentElementName,renderMaxTime,thread,altText){var img=null,span=null,HTMLAnimation=null,HTMLPanel=panel.getHTMLElement();if((span=simDocument().getElementById("holdingSpan"+simID))&&(HTMLAnimation=span.getElementsByTagName("img")[0]),HTMLAnimation||(HTMLAnimation=simDocument().getElementById(prevImageID)),HTMLAnimation)HTMLAnimation.src=imageSrc,HTMLAnimation.id=element.getName(),renderMaxTime||(remderMaxTime=0),renderMaxTime>=0&&setTimeout(function(){handleTimeout(element)},renderMaxTime);else{var div=simDocument().getElementById("holderAnimation"+simID);if(div&&"imageAnimation"!=div.media){var parent=div.parentNode;"outerDiv"==parent.id?HTMLPanel.removeChild(parent):HTMLPanel.removeChild(div)}(div=simDocument().createElement("div")).id="holderAnimation"+simID,div.elementName=currentElementName,div.setAttribute("class","holderAnimation"),div.media="imageAnimation",HTMLPanel.appendChild(div),(span=simDocument().createElement("span")).setAttribute("class","holderCell"),span.id="holdingSpan"+simID,div.appendChild(span),(img=simDocument().createElement("img")).id=currentElementName,prevImageID=img.id;var wait,imageLoaded=!1;util().bindEvent(img,"load",function(){imageLoaded=!0}),img.src=imageSrc,altText&&(img.alt=altText),wait=setInterval(function(){imageLoaded&&(clearInterval(wait),doImageRendering(element,img,0,div,span,renderMaxTime),eventMgr().postEvent(new Simulator.Event(element,"info","imageEmbedded",img)),eventMgr().postEvent(new Simulator.Event(element,"info","allMediaLoaded")))},1)}},this.renderAnimation=function(element,panelName,animationSrc,animationName,animationControls,currentElementName,renderMaxTime,thread){var holderDiv=null,hsize=panel.getHeight(),wsize=panel.getWidth(),HTMLPanel=panel.getHTMLElement(),initialRender=!1;if("animation"!=elementInfomediaType||elementInfosrc!=animationSrc){if((holderDiv=simDocument().getElementById("holderAnimation"+simID))&&"animation"!=holderDiv.media){var parent=holderDiv.parentNode;"outerDiv"==parent.id?HTMLPanel.removeChild(parent):HTMLPanel.removeChild(holderDiv),initialRender=!0}(holderDiv=simDocument().createElement("div")).id="holderAnimation"+simID,holderDiv.name="holderAnimation"+simID,holderDiv.elementName=animationName,holderDiv.setAttribute("class","holderAnimation"),HTMLPanel.appendChild(holderDiv),elementInfomediaType="animation",elementInfoid=holderDiv.id,initialRender=!0}else holderDiv=simDocument().getElementById("holderAnimation"+simID);elementInfosrc=animationSrc,currentAnimationElement=element,sim.getAccessibilityIFActive()&&createAltTextElement(),iFrameID||(iFrameID=this.createItemID(!0,-1,"html5iFrame"));var iFrame=simDocument().getElementById(iFrameID);iFrame?(void 0!=renderMaxTime&&null!=renderMaxTime&&renderMaxTime>=0&&setTimeout(function(){handleTimeout(element)},renderMaxTime),sendDataToAnimationElement()):((iFrame=simDocument().createElement("iframe")).id=iFrameID,iFrame.width=wsize-5,iFrame.height=hsize-5,sim.getAccessibilityIFActive()&&(iFrame.height=0),debug("iFrame.height = "+iFrame.height+", iFrame.width = "+iFrame.width),iFrame.border=0,iFrame.scrolling="no",iFrame.src=appendExternalScriptURLParameter(animationSrc,sim.getAnimationExternalScriptsPath()),iFrame.setAttribute("style","height:"+iFrame.height+"px !important"),iFrame.setAttribute("class","centeredAnimation"),iFrame.setAttribute("aria-hidden","true"),initialRender&&holderDiv.appendChild(iFrame),iFrame.onload=function(){debug("iFrame is loaded"),createHTML5AnimationInterface(element,iFrame,animationName)})},this.renderHotText=function(element,panelName,animationSrc,animationName,animationControls,currentElementName,renderMaxTime,thread){var HTMLPanel=panel.getHTMLElement(),holderDiv=null;panel.getHeight(),panel.getWidth();if("hotText"!=elementInfomediaType||elementInfosrc!=animationSrc){if((holderDiv=simDocument().getElementById("holderAnimation"+simID))&&"hotText"!=holderDiv.media){var parent=holderDiv.parentNode;"outerDiv"==parent.id?HTMLPanel.removeChild(parent):HTMLPanel.removeChild(holderDiv)}(holderDiv=simDocument().createElement("div")).id="holderAnimation"+simID,holderDiv.style.textAlign="left",holderDiv.name="holderAnimation"+simID,holderDiv.elementName=animationName,holderDiv.setAttribute("class","holderAnimation");var contentDiv=simDocument().createElement("div");contentDiv.id="hotTextContentDiv",contentDiv.style.textAlign="left",contentDiv.style.padding="0px",holderDiv.appendChild(contentDiv),HTMLPanel.appendChild(holderDiv),elementInfomediaType="animation",elementInfoid=holderDiv.id}elementInfosrc=animationSrc,contentDiv.innerHTML=animationSrc,void 0!=renderMaxTime&&null!=renderMaxTime&&renderMaxTime>=0&&setTimeout(function(){handleTimeout(element)},renderMaxTime),currenAnimationName=animationName;var hotText=new Simulator.Animation.HotTextShell(sim);animationSet.setCurrentAnimation(hotText),debug("AnimationSet.CurrentAnimation = "+animationSet.getCurrentAnimation()),debug("Initializing the HotTextShell: inlinDataID = "+element.getInlineDataID()+", holderDiv.id = "+holderDiv.id+", outputOnRequest = "+animationSet.getOutputOnRequest());var parameters={callback:animationSet.animationMediaOutput,inlineDataID:element.getInlineDataID(),containerID:holderDiv.id,behavior:element.getBehavior(),outputOnReq:animationSet.getOutputOnRequest()};hotText.initialize(simID,parameters),sendDataToAnimationElement(element,!1)},this.resizeAnimationElements=function(panel,zoom){var HTMLPanel=panel.getHTMLElement();if(zoom){if((flashObjectArray=HTMLPanel.getElementsByTagName("object"))&&1==flashObjectArray.length)flashObj=flashObjectArray[0]}else{var hsize=panel.getHeight(),wsize=panel.getWidth(),flashObjectArray=HTMLPanel.getElementsByTagName("object");if(flashObjectArray&&1==flashObjectArray.length){var flashObj=flashObjectArray[0];(dimensions=util().setDimensions(hsize,wsize,parseInt(panel.getOriginalHeight()),parseInt(panel.getOriginalWidth()),10)).height>0&&dimensions.width>0&&(hsize=dimensions.height,wsize=dimensions.width),flashObj.width=wsize,flashObj.height=hsize,flashObj.setAttribute("originalwidth",wsize),flashObj.setAttribute("originalheight",hsize),flashObj.style.width=wsize+"px",flashObj.style.height=hsize+"px",flashObj.animationResize(wsize,hsize)}var imgArray=HTMLPanel.getElementsByTagName("img");if(imgArray&&1==imgArray.length){var image=imgArray[0];debug("Image height = "+image.height+", width = "+image.width);var dimensions=util().setDimensions(hsize,wsize,image.height,image.width,10);dimensions.height>0&&dimensions.width>0&&(image.height=dimensions.height,image.width=dimensions.width,debug("Image resize with padding to height = "+image.height+", width = "+image.width))}}},this.renderFlash=function(element,panelName,flashSrc,flashName,flashControls,currentElementName,renderMaxTime,thread){var HTMLPanel=panel.getHTMLElement();if("flash"!=elementInfomediaType||elementInfosrc!=flashSrc){thread.getAnimationSet();var flashvars={simID:simID,simURL:escape(flashSrc),simCallback:window.document==simDocument()?Simulator.Constants.SIM_CALLBACK:"window.parent."+Simulator.Constants.SIM_CALLBACK,simBehavior:element.getBehavior(),simLanguage:sim.getAnimationDisplayLanguage(),accessibilityMode:sim.getAccessibilityIFActive()?"true":"false"};debug("flashvars.simBehavior = "+flashvars.simBehavior);var params={wmode:"opaque",allowscriptaccess:"always",swliveconnect:"true"},attributes={};attributes.name=flashName,attributes.media="flashAnimation",attributes.styleclass="centeredAnimation";var hsize,wsize;hsize=null==panel.getOriginalHeight()||panel.getOriginalHeight()<=0?panel.getHeight()-10:panel.getOriginalHeight()-10,sim.getAccessibilityIFActive()&&(hsize=0),wsize=null==panel.getOriginalWidth()||panel.getOriginalWidth()<=0?panel.getWidth()-10:panel.getOriginalWidth()-10;var holderDiv=simDocument().getElementById("holderAnimation"+simID);if(holderDiv&&"flashAnimation"!=holderDiv.media){var parent=holderDiv.parentNode;"outerDiv"==parent.id?HTMLPanel.removeChild(parent):HTMLPanel.removeChild(holderDiv)}(holderDiv=simDocument().createElement("div")).id="holderAnimation"+simID,holderDiv.name="holderAnimation"+simID,holderDiv.elementName=flashName,holderDiv.setAttribute("class","holderAnimation"),holderDiv.innerHTML="<h1>Alternative content</h1>",HTMLPanel.appendChild(holderDiv),sim.getAccessibilityIFActive()&&createAltTextElement(),elementInfomediaType="flash",elementInfoid=holderDiv.id,elementInfosrc=flashSrc,currentAnimationElement=element,currenAnimationName=flashName,swfobject.switchOffAutoHideShow(),swfobject.embedSWF(sim.getAnimationShellPath(),holderDiv.id,wsize,hsize,"9",!1,flashvars,params,attributes,simDocument(),flashEmbedSuccessCallback),void 0!=renderMaxTime&&null!=renderMaxTime&&renderMaxTime>=0&&setTimeout(function(){handleTimeout(element)},renderMaxTime)}else sendDataToAnimationElement(element,!1)},this.renderVideo=function(element,panelName,videoSrc,currentElementName,renderMaxTime,thread){var HTMLAnimation=simDocument().getElementById(currentElementName),vid=simDocument().createElement("video");vid.setAttribute("type","application/x-shockwave-flash"),vid.setAttribute("width",panel.getWidth(!0)-2),vid.controls="true",vid.setAttribute("src",videoSrc),vid.object=simDocument().createElement("object"),vid.object.data="flvplayer.swf",vid.object.media="videoAnimation",vid.object.type="application/x-shockwave-flash",vid.object.param=simDocument().createElement("param"),vid.object.param.value="flvplayer.swf",vid.object.param.name="movie";var div=simDocument().createElement("div");div.setAttribute("class","holderAnimation");var span=simDocument().createElement("span");span.appendChild(vid),div.appendChild(span),panel.replaceChild(div,HTMLAnimation)},this.updateAltText=function(){var altText=sim.getAltText(),altTextSpan=simDocument().getElementById(altTextID);altTextSpan||(altTextSpan=createAltTextElement()),altTextSpan.innerHTML=altText}},Simulator.Animation.AnimationRenderer.prototype=new Simulator.SimItem,Simulator.Animation.AnimationRenderer.prototype.constructor=Simulator.Animation.AnimationRenderer,Simulator.Animation.HTML5Shell=function(sim,theSimID){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}var source="HTML5Shell",simURL=null,iFrameID=null,iFrame=null,behavior=null,simCallback=null,simHeight=null,simWidth=null,simID=theSimID,outputOnReq=null,statusReqTimer=null,statusReturnTimer=null,simLanguage=null,accessibilityMode=null,dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};this.initialize=function(theSimID,parameters){if(simIDIsValid(theSimID)){if(iFrameID=parameters.containerID,iFrame=simDocument().getElementById(iFrameID)){if(simURL=iFrame.src,behavior=parameters.behavior,simWidth=iFrame.width,simHeight=iFrame.height,simCallback=parameters.callback,outputOnReq=parameters.outputOnReq,simLanguage=parameters.simLanguage,accessibilityMode=parameters.accessibilityMode,debug("In initialize"),simWidth1=simWidth,""===simID&&""===simURL)return dbg().logError(source,"Simulation does not exist"),Simulator.Constants.FAILURE;var animationParams={behavior:behavior,callback:this.fromAnimationInterface,simHeight:simHeight,simWidth:simWidth,simLanguage:simLanguage,accessibilityMode:accessibilityMode};debug("animationParams.behavior = "+animationParams.behavior),debug("animationParams.simHeight = "+animationParams.simHeight),debug("animationParams.simWidth = "+animationParams.simWidth),debug("animationParams.simLanguage = "+animationParams.simLanguage),debugf("animationParams.accessibilityMode = "+animationParams.accessibilityMode),debug("Calling init in the animation interface");var status=iFrame.contentWindow.init(this,animationParams);return status!==Simulator.Constants.SUCCESS?(dbg().logFatalError(source,"animation interface returned failure. Link with HTML Animation NOT established"),Simulator.Constants.FAILURE):(debug("Received SUCCESS from init function in animation. Link with HTML Animation established"),status=Simulator.Constants.ANIMATION_LOADED,behavior!==Simulator.Constants.INTERACTIVE_ANIMATION&&startStatusTimer(),Simulator.Constants.ANIMATION_LOADED)}return dbg().logError(source,"Could not get iFrame from id "+iframeID),Simulator.Constants.FAILURE}return dbg().logError(source,"initialize message with simID = "+simulationID+" sent to HTML5Shell with simID = "+simID),Simulator.Constants.FAILURE},this.fromAnimationInterface=function(type,data){debug("HTML5Shell.fromAnimationInterface(), type = "+type);var formattedOutput=null;switch(resetStatusTimer(),type){case Simulator.Constants.ANIMATION_PROPERTIES:formattedOutput=formatOutput(data),sendOutputToSimulator(type,formattedOutput);break;case Simulator.Constants.ANIMATION_REPORTING:debug(data===Simulator.Constants.ANIMATION_ALIVE?'Received "I am alive" message from animation at '+utils().getElapsedTime():'Received "'+data+'" message from animation at '+utils().getElapsedTime());break;case Simulator.Constants.PARAM_OUTPUT:formattedOutput=formatOutput(data),sendOutputToSimulator(type,formattedOutput);break;case Simulator.Constants.PARAM_ERROR:case Simulator.Constants.PARAM_INFO:data===Simulator.Constants.ANIMATION_FINISHED&&behavior!=Simulator.Constants.INTERACTIVE_ANIMATION&&processCommand(simID,Simulator.Constants.OUTPUT_REQ_CMD),sendOutputToSimulator(type,data);break;default:debug("ERROR - Unrecognized type, '"+type+"' of messsage received from animationInterface.")}},this.animationInput=function(simulationID,type,input){debug("HTML5Shell.animationInput(): type = "+type+", input = "+input);var inputs=null;if(!simIDIsValid(theSimID))return Simulator.Constants.FAILURE;switch(debug("Received message from simulator: simID = "+simID+", type = "+type+", input = "+input),type){case Simulator.Constants.PARAM_COMMAND:processCommand(simulationID,input);break;case Simulator.Constants.PARAM_INFO:break;case Simulator.Constants.PARAM_INPUT:null===input||""===input?(debug("Inputs not provided"),sendInfo(Simulator.Constants.ANIMATION_UNABLE_TO_START)):(inputs=parseInputs(input),iFrame.contentWindow&&iFrame.contentWindow.updateInputs(inputs));break;case Simulator.Constants.PARAM_UPDATE:if(!checkID(simulationID))return void dbg().logError(source,"simID does not match!");null===input||""===input?(debug("Inputs not provided"),sendInfo(Simulator.Constants.ANIMATION_UNABLE_TO_START)):(inputs=parseInputs(input),iFrame.contentWindow.updateInputs(inputs),iFrame.contentWindow.playAnimation(),behavior!==Simulator.Constants.INTERACTIVE_ANIMATION&&1!=accessibilityMode||setTimeout(function(){sendInfo(Simulator.Constants.ANIMATION_FINISHED)},1e3),startStatusTimer());break;default:debug("Inputs not provided")}};var processCommand=function(simulationID,cmd){switch(debug("Received command from simulator: "+cmd),cmd){case Simulator.Constants.GET_ANIMATION_PROPERTIES:var properties=iFrame.contentWindow.getProperties(),output=formatOutput(properties);sendOutputToSimulator(Simulator.Constants.ANIMATION_PROPERTIES,output);break;case Simulator.Constants.PLAY_CMD:iFrame.contentWindow&&(iFrame.contentWindow.playAnimation(),behavior===Simulator.Constants.INTERACTIVE_ANIMATION&&setTimeout(function(){sendInfo(Simulator.Constants.ANIMATION_FINISHED)},1e3),startStatusTimer());break;case Simulator.Constants.STOP_CMD:break;case Simulator.Constants.REWIND_CMD:rewind();break;case Simulator.Constants.SET_ID_CMD:this.simID=simulationID;break;case Simulator.Constants.RESTART_CMD:reStart();break;case Simulator.Constants.OUTPUT_REQ_CMD:var outputs=iFrame.contentWindow.getOutputs();debug("HTML5Shell.processCommand() with Simulator.Constants.OUTPUT_REQ_CMD, outputs = "+outputs),debug("Received data from formatOutput: "+(data=formatOutput(outputs))),sendOutputToSimulator(Simulator.Constants.PARAM_OUTPUT,data);break;case Simulator.Constants.ALT_TEXT_REQ_CMD:var altText=getAltText();debug("HTML5Shell.processCommand() with Simulator.Constants.ALT_TEXT_REQ_CMD, altText = "+altText);var data=altText;sendOutputToSimulator(Simulator.Constants.PARAM_ALT_TEXT,data);break;case Simulator.Constants.ANIMATION_REPORT_STATUS:sendStatusRequest();break;default:dbg().logError(source,"Unknown command passed to animation")}},parseInputs=function(input){console.log("parseInputs(): "+input),inputArray=[],input=removeBrackets(input);for(var elements=(input=removeSemi(input)).split(Simulator.Constants.ITERATION_DELIMITTER),j=0;j<elements.length;j++)for(var pairs=String(elements[j]).split(Simulator.Constants.PAIR_DELIMITTER),i=0;i<pairs.length;i++){parts=String(pairs[i]).split(Simulator.Constants.KEY_VALUE_DELIMITTER),parts[Simulator.Constants.INPUT_NAME_PART]=removeQuotes(String(parts[Simulator.Constants.INPUT_NAME_PART]).trim()),parts[Simulator.Constants.INPUT_VALUE_PART]=removeQuotes(String(parts[Simulator.Constants.INPUT_VALUE_PART]).trim());var values=String(parts[Simulator.Constants.INPUT_VALUE_PART]).split(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER);parts[Simulator.Constants.INPUT_VALUE_PART]=values,debug("Input #"+(j+1)+", '"+parts[Simulator.Constants.INPUT_NAME_PART]+"' = "+parts[Simulator.Constants.INPUT_VALUE_PART]+";"),inputArray[parts[Simulator.Constants.INPUT_NAME_PART]]=parts[Simulator.Constants.INPUT_VALUE_PART]}return inputArray},rewind=function(){iFrame.contentWindow.gotoAndStop(Simulator.Constants.START_FRAME)},reStart=function(){iFrame.contentWindow.gotoAndStop(Simulator.Constants.START_FRAME),iFrame.contentWindow.playAnimation()},getAltText=function(){return iFrame.contentWindow.getAltText?iFrame.contentWindow.getAltText():""},formatOutput=function(dataArray){var str="";for(key in dataArray)str&&(str+=Simulator.Constants.PAIR_DELIMITTER),str+=key+Simulator.Constants.KEY_VALUE_DELIMITTER+dataArray[key];return str},sendInfo=function(info){sendOutputToSimulator(Simulator.Constants.PARAM_INFO,info)},sendOutputToSimulator=function(type,output){debug("Sending simulator "+type+" message with data =  "+output.toString()),simCallback(this.simID,type,output)},simIDIsValid=function(simulationID){return simID===simulationID},removeBrackets=function(str){var rex=/[\[\]]*/gim;return str.replace(rex,"")},removeSemi=function(str){var rex=/[;]$/im;return str.replace(rex,"")},removeQuotes=function(str){var rex=/["]*/gim;return str.replace(rex,"")},startStatusTimer=function(){statusReqTimer&&clearTimeout(statusReqTimer),statusReqTimer=setTimeout(sendStatusRequest,1e4),utils().markTime(),statusReqTimer||dbg().logError(source,'Could not start statusReqTimer. No "alive" messages will be sent to the animation.')},resetStatusTimer=function(){debug("Status timers reset at "+utils().getElapsedTime()),statusReturnTimer&&clearTimeout(statusReturnTimer),statusReqTimer&&clearTimeout(statusReqTimer),startStatusTimer()},sendStatusRequest=function(){utils().markTime(),srTimeouts++,statusReturnTimer=setTimeout(statusReportTimeout,1e3),debug("Sending number "+srTimeouts+" status request to animation."),iFrame.contentWindow&&iFrame.contentWindow.statusRequest()===Simulator.Constants.ANIMATION_ALIVE&&resetStatusTimer()},srTimeouts=0;statusReportTimeout=function(){debug("Status report waiting period "+srTimeouts+" timed out at "+utils().getElapsedTime()),2===srTimeouts&&(debug('Sending "animationUnresponsive" message to simulator'),sendOutputToSimulator(Simulator.Constants.PARAM_ERROR,Simulator.Constants.ANIMATION_UNRESPONSIVE),srTimeouts=0)}},Simulator.Animation.HotTextShell=function(sim){function generateOutputStr(simID){var interaction,output="",comma="\\0x1E\\",colon="\\0x1F\\",formattedResponse="",rawResponse="",responseText="",interactionType="";if(interactions.length>0){for(var j=0;j<interactions.length;j++)if(interaction=interactions[j],rawResponse=interaction.getResponse(),interaction instanceof TDS.DDInteraction)interactionType+=interactionType?"|draggable":"draggable";else if(interaction instanceof TDS.SelectInteraction){interactionType+=interactionType?"|selectable":"selectable";var selectionChoices=interaction.getSelectedChoices(),selectedChoicesLength=0;selectionChoices&&(selectedChoicesLength=selectionChoices.length);for(var i=0;i<selectedChoicesLength;i++)0==i?(formattedResponse=selectionChoices[i].getIdentifier(),responseText=selectionChoices[i].getElement().innerHTML.replace(/<[^>]*>/gi,"").replace(/&.{4};/gi,"")):(formattedResponse+="|"+selectionChoices[i].getIdentifier(),responseText+="|"+selectionChoices[i].getElement().innerHTML.replace(/<[^>]*>/gi,"").replace(/&.{4};/gi,""))}var xml=[];xml.push("<interactions>"),xml.push(rawResponse),xml.push("</interactions>"),rawResponse=xml.join(""),output+="itemId"+colon+inlineDataID+comma,output+="interactionType"+colon+interactionType+comma,output+="formattedResponse"+colon+formattedResponse+comma,output+="rawHTResponseRC"+colon+rawResponse+comma,output+="responseText"+colon+responseText}return output}var interactions=[],inlineDataID=(new Object,null),simDocument=function(){return sim.getSimDocument()};this.initialize=function(simID,parameters){inlineDataID=parameters.inlineDataID;var itemContainer=simDocument().getElementById(parameters.containerID),id_postfix="-interaction-"+simID,ddInteraction=new TDS.DDInteraction("dd"+id_postfix);ddInteraction.load(itemContainer),ddInteraction.getDraggables().length>0&&interactions.push(ddInteraction);var selectInteraction=new TDS.SelectInteraction("select"+id_postfix);selectInteraction.load(itemContainer);var numChoices=selectInteraction.getChoices().length;if(numChoices>0&&(interactions.push(selectInteraction),!parameters.outputOnReq))for(var i=0;i<numChoices;i++)selectInteraction.getChoices()[i].subscribe("selectEvent",function(){sim.getAnimationSet().animationMediaOutput(simID,"output",generateOutputStr())}),selectInteraction.getChoices()[i].subscribe("deselectEvent",function(){sim.getAnimationSet().animationMediaOutput(simID,"output",generateOutputStr())});interactions.length?sim.getAnimationSet().animationMediaOutput(simID,"info","animationLoaded"):sim.getAnimationSet().animationMediaOutput(simID,"info","animationError")},this.animationInput=function(simID,type,content){if("command"==type)switch(content){case"outputRequest":var output=generateOutputStr();sim.getAnimationSet().animationMediaOutput(simID,"output",output);break;case"play":sim.getAnimationSet().animationMediaOutput(simID,"info","animationStarted"),sim.getAnimationSet().animationMediaOutput(simID,"info","animationFinished")}},this.animationIONames=function(){return"output"+Simulator.Constants.KEY_VALUE_DELIMITTER+"itemId"+Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+"interactionType"+Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+"formattedResponse"+Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+"rawHTResponseRC"+Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+"responseText"+Simulator.Constants.PAIR_DELIMITTER}},Simulator.Animation.AnimationSet=function(sim,panel){function renderNextElement(instance){var anEvent=null;null!=currentThread&&void 0!=currentThread?null==currentThread.renderNextThreadElement()&&(anEvent=new Simulator.Event(instance,"info","animationThreadFinished"),eventMgr().postEvent(anEvent)):(anEvent=new Simulator.Event(instance,"info","animationThreadFinished"),eventMgr().postEvent(anEvent))}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.SimElement.call(this,sim),this.setEname("AnimationSet");var source="AnimationSet",instance=this,setElements=[],setThreads=[],poster=[],inputSource=[],outputs=[],outputOnRequest=!1,prevInputs=[],currentInputs=[],lastThreadExecuted=null,currentThread=null,currentAnimation=null,currentAnimationState=[],scoreable=!0,key=null,renderer=null,animationBehavior="timeBased",instance=this,animationLoaded=!1,util=function(){return sim.getUtils()},dbg=function(){return sim.getDebug()},whiteboard=function(){return sim.getWhiteboard()},eventMgr=function(){return sim.getEventManager()},scoringTable=function(){return sim.getScoringTable()},simMgr=function(){return sim.getSimulationManager()},transDictionary=function(){return sim.getTranslationDictionary()};this.getRenderer=function(){return renderer},this.getKey=function(){return key},this.getPrevInputs=function(){return prevInputs},(inputSource=[])[0]="evaluator",this.getInputSource=function(){return inputSource},this.setInputSource=function(newInputSource){var parts=[];inputSource.splice(0,1),parts=newInputSource.split(",");for(var i=0;i<parts.length;i++)parts[i]=parts[i].trim(),"evaluator"==parts[i]||"animation"==parts[i]?util().elementInArray(inputSource,parts[i])||inputSource.push(parts[i]):dgb().logFatalError(source,'Unknow input source "'+parts[i]+'" passed to AnimationSet.setInputSource')},this.getCurrentAnimation=function(){return currentAnimation},this.setCurrentAnimation=function(animation){currentAnimation=animation},this.getCurrentInputs=function(){return currentInputs},this.getAnimationBehavior=function(){return animationBehavior},this.setAnimationBehavior=function(newBehavior){return animationBehavior=newBehavior,this},this.addAnimationElement=function(element){return setElements.push(element),this},this.getAnimationElement=function(id){for(var i=0;i<setElements.length;i++)if(setElements[i].getName()==id)return setElements[i];return null},this.addThread=function(aThread){setThreads.push(aThread)},this.getThreadFromName=function(name){for(var i=0;i<setThreads.length;i++)if(setThreads[i].getName()==name)return setThreads[i];return null},this.getFirstAnimationThread=function(){return setThreads[0]},this.getPosterName=function(){return poster.name+sim.getSimID()},this.getPosterSrc=function(){var translatedPosterSource=transDictionary().translate(poster.image);return debug("Getting a poster image using AnimationSet2.js method: "+translatedPosterSource),translatedPosterSource},this.getPosterShow=function(){return poster.show},this.getInputSource=function(){return inputSource},this.setOutputs=function(newOutputs){if("inputs"==(outputs=newOutputs.split(",")))scoringTable().cloneInputsForOutputs();else if(scoreable)for(var i=0;i<outputs.length;i++)"none"!=outputs[i]&&scoringTable().addElement(outputs[i],"output")},this.getOutputs=function(){return outputs},this.setScoreable=function(newScoreable){return scoreable="yes"==newScoreable,this},this.getScoreable=function(){return scoreable},this.setPoster=function(posterAttributes){for(var i=0;i<posterAttributes.length;i++)posterAttributes[i].nodeName,poster[posterAttributes[i].nodeName]=posterAttributes[i].nodeValue},this.getPosterAltText=function(){return"object"==typeof window.Messages&&window.Messages.has("Simulator.Animation.PosterAltText")?window.Messages.get("Simulator.Animation.PosterAltText"):"This image is a placeholder for the animation.  Start a new trial to view the animation."},this.setOutputOnRequest=function(newOutputOnRequest){return outputOnRequest="yes"==newOutputOnRequest,this},this.getOutputOnRequest=function(){return outputOnRequest},this.recordOutputs=function(){var parts=[],data=whiteboard().getCategory("animationOutput").output;if(null!=data&&void 0!=(data=data.split(Simulator.Constants.PAIR_DELIMITTER))&&null!=data&&""!=data)for(var i=0;i<outputs.length&&"none"!=outputs[i];i++)if(scoreable)for(var j=0;j<data.length;j++)(parts=data[j].split(Simulator.Constants.KEY_VALUE_DELIMITTER))[0]=parts[0].trim(),parts[1]&&(parts[1]=parts[1].trim()),parts[0]==outputs[i]&&scoringTable().setValue(parts[0],simMgr().getTrialNum()-1,parts[1])},this.selectThread=function(noStart){this.setCurrentThread(null);for(var i=0;i<setThreads.length;i++)if(setThreads[i].isSelected())return this.setCurrentThread(setThreads[i]),noStart||setThreads[i].startSimulation(),!0;return!1},this.handleEvent=function(event){var newEvent=void 0;switch(event.type){case"info":switch(event.context){case"animationThreadFinished":case"animationFinished":lastThreadExecuted=this.getCurrentThread(),"after"!=poster.show&&"both"!=poster.show||renderer.renderImage(this,"animationPanel",this.getPosterSrc(),this.getPosterName(),-1,null,null);break;case"animationStarted":break;case"inputAvailable":0!=(result=this.storeInputs(!0))&&(simMgr().setAnimationCompleteWithoutOutput(event.completeWithoutOutput),this.sendDataToAnimation());break;case"animationError":dbg().logError(source,event.data);break;case"outputAvailable":if(!simMgr().trialLimitReached()){var result=this.storeInputs(!0);0!=result&&(null==this.getCurrentThread()?this.selectThread():(nextElement=this.getCurrentThread().renderNextThreadElement(!1))||this.selectThread())}break;default:dbg().logFatalError(source,"AnimationSet - Unknown command name: "+event.context+" received by "+this.getName());break;case"altTextReceived":this.getRenderer().updateAltText()}break;case"command":switch(event.context){case"load":if(!animationLoaded){if("before"==poster.show||"both"==poster.show){var posterAltText=this.getPosterAltText();renderer.renderImage(this,"animationPanel",this.getPosterSrc(),this.getPosterName(),-1,null,posterAltText)}else util().assocArrayIsEmpty(poster)&&eventMgr().postEvent(new Simulator.Event(instance,"info","allMediaLoaded"));animationLoaded=!0}break;case"startAnimation":this.storeInputs(!0),null==this.getCurrentThread()?this.selectThread():(nextElement=this.getCurrentThread().renderNextThreadElement(!0))&&this.selectThread();break;case"outputReq":currentAnimation&&currentAnimation.animationInput(sim.getSimID(),"command","outputRequest");break;case"startTrial":if(!simMgr().trialLimitReached())if(this.storeInputs(!0),simMgr().setAnimationCompleteWithoutOutput(event.completeWithoutOutput),null==this.getCurrentThread())this.selectThread();else{var nextElement=this.getCurrentThread().renderNextThreadElement(!1);nextElement||this.selectThread()}break;default:dbg().logFatalError(source,"AnimationSet - Unknown command name: "+event.context+" received by "+this.getName())}break;default:return void dbg().logFatalError(source,"AnimationSet "+this.getName()+": Unhandled event type received: "+event.inspect())}void 0!=newEvent&&null!=newEvent&&newEvent.postEvent()},this.sendDataToAnimation=function(){debug("in sendDataToAnimation of AnimationSet");var thread=this.getCurrentThread();if(!thread)return(thread=lastThreadExecuted)?void 0:void(this.selectThread()||dbg().logFatalError(source,"Could not select a thread in sendDataToAnimation of AnimationSet."));var element=thread.getCurrentElement();element||(element=thread.getLastExecutedAnimationElement()),debug("null"),element?renderer.sendDataToAnimation(element):dbg().logFatalError(source,"Could not find CurrentElement or LastExecutedAnimationElement in sendDataToAnimation of AnimationThread")},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[];embedded||buff.push("Inspecting AnimationSet"),buff.push("\n\n");for(var i=0;i<setElements.length;i++)buff.push("["),buff.push(i),buff.push("] = "),buff.push(setElements[i].inspect(!0)),buff.push("\n\n");if(embedded||buff.push("End of AnimationSet inspection"),buff.push("\n\n"),embedded)return buff.join("");null==force?debug(buff.join("")):debugf(buff.join(""))},this.getCurrentAnimationState=function(){return lastThreadExecuted?(currentAnimationState.lastThreadExecutedName=lastThreadExecuted.getName(),currentAnimationState.currentThreadElementIndex=lastThreadExecuted.getCurrentThreadElementIndex(),currentAnimationState.animationInputs=currentInputs.join(","),currentAnimationState.animationOutputs=this.getOutputs().join(","),currentAnimationState):[]},this.setCurrentAnimationState=function(stateArray){(lastThreadExecuted=this.getThreadFromName(stateArray.lastThreadExecutedName)).setCurrentThreadElementIndex(stateArray.currentThreadElementIndex);var parts=stateArray.animationInputs.split(",");for(var p in parts)currentInputs[p]=parts[p];this.setOutputs(stateArray.animationOutputs),simMgr().getRestoreAnimationOnReload()&&lastThreadExecuted.startSimulation()},this.storeInputs=function(backupInputs){var inputs=whiteboard().getEnglishTranslatedCategory("animationInput");if(null!=inputs&&Object.size(inputs)>0){backupInputs&&this.setPrevInputs();for(var s in inputs)currentInputs[s]=inputs[s]}},this.setPrevInputs=function(){for(var p in currentInputs)prevInputs[p]=currentInputs[p]},this.setCurrentThread=function(thread){lastThreadExecuted=currentThread,null!==(currentThread=thread)?(debug('In setCurrentThread - currentThread = "'+currentThread.getName()+'", so setting currentElement to null'),currentThread.setCurrentElement(null)):dbg().logWarning(source,"In setCurrentThread - currentThread = null")},this.getCurrentThread=function(thread){return currentThread},this.animationMediaOutput=function(theSimID,type,data){sim.getSimID()!=theSimID&&dbg().logWarning(source,"SimID from animation: "+theSimID+" does not match this simulator's ID: "+sim.getSimID());switch("debug"!=type&&type!=Simulator.Constants.PARAM_DEBUG_OUTPUT&&debug("Received "+type+' output from the animation with data "'+data+'"'),type){case"info":switch(data){case Simulator.Constants.ANIMATION_THREAD_FINISHED:case Simulator.Constants.ANIMATION_FINISHED:var currentElement=currentThread.getCurrentElement();debug("In animationMediaOutput - currentElement = "+(null===currentElement?"null":currentElement.getName())),currentElement.getBehavior()!=Simulator.Constants.INTERACTIVE_ANIMATION&&""!=instance.getOutputs()&&instance.recordOutputs(),renderNextElement(instance);break;case Simulator.Constants.ANIMATION_STARTED:break;case Simulator.Constants.ANIMATION_ABORTED:case Simulator.Constants.ANIMATION_UNABLE_TO_START:case"newTrial":eventMgr().postEvent(new Simulator.Event(null,"command","newTrial"))}break;case Simulator.Constants.PARAM_OUTPUT:case Simulator.Constants.PARAM_DATA:whiteboard().setItem("animationOutput","output",transDictionary().internationalizePreparsedAnimationOutput(data),key),instance.recordOutputs(),eventMgr().postEvent(new Simulator.Event(instance,"info","animationOutputAvailable"));break;case Simulator.Constants.PARAM_ALT_TEXT:case Simulator.Constants.ALT_TEXT_REQ_CMD:sim.setAltText(data),eventMgr().postEvent(new Simulator.Event(instance,"info","altTextReceived"));break;case Simulator.Constants.PARAM_DEBUG_OUTPUT:break;case Simulator.Constants.ANIMATION_ERROR:eventMgr().postEvent(new Simulator.Event(null,"animationError",data))}},this.setAttributes=function(attr,node){var attr=util().getAttributes(node);Simulator.Animation.AnimationSet.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"poster":this.setPoster(attr[i]);break;case"scoreable":this.setScoreable(attr[i]);break;case"outputs":this.setOutputs(attr[i]);break;case"inputSource":this.setInputSource(attr[i]);break;case"outputOnRequest":this.setOutputOnRequest(attr[i])}},sim&&(key=whiteboard().addItem("animationOutput","output"),inputSource[0]="evaluator",function(instance){eventMgr().registerEvent(new Simulator.Event(instance,"info","animationThreadFinished")),eventMgr().registerEvent(new Simulator.Event(instance,"info","animationFinished")),eventMgr().registerEvent(new Simulator.Event(instance,"info","animationStarted")),eventMgr().registerEvent(new Simulator.Event(instance,"info","animationError")),eventMgr().registerEvent(new Simulator.Event(instance,"info","altTextReceived"))}(instance),renderer=new Simulator.Animation.AnimationRenderer(sim,panel,this))},Simulator.Animation.AnimationSet.prototype=new Simulator.SimElement,Simulator.Animation.AnimationSet.parent=Simulator.Simulator,Simulator.Animation.AnimationSet.prototype.constructor=Simulator.Animation.AnimationSet,Simulator.Animation.AnimationThread=function(sim,panel,section,animationSet){function onChangeToSpecified(criteria){return!!criteria.onChangeTo&&"yes"==criteria.onChangeTo}function changeOccurred(criteria){var val=criteria.variable,prevVal=animationSet.getPrevInputs()[val],curVarName=criteria.variable,currentVal=animationSet.getCurrentInputs()[curVarName];return currentVal!=prevVal&&("*"==criteria.value||currentVal==criteria.value)}function inspectSelectionCriteria(sc,embedded,force){var buff=[];for(var l in sc)buff.push("selectionCriteria["),buff.push(l),buff.push("] = "),buff.push(sc[l]),buff.push("\n");if(embedded)return buff.join("");null==force?debug(buff.join("")):debugf(buff.join(""))}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2){dbg().debugf(source,str1,str2,trace)}Simulator.SimElement.call(this);var source="AnimationThread",theSet=animationSet,threadElements=[],currentThreadElementIndex=0,selectionCriteria=[],requiresInput="no",currentElement=null,currentThread=null,lastExecutedAnimationElement=null;this.setEname(source),animationSet&&animationSet.addThread(this);var util=function(){return sim.getUtils()},dbg=function(){return sim.getDebug()},eventMgr=function(){return sim.getEventManager()},renderer=function(){return animationSet.getRenderer()},simDocument=function(){return sim.getSimDocument()};this.getAnimationSet=function(){return animationSet},this.addAnimationThreadElement=function(element){return threadElements.push(element),this},this.getAnimationElement=function(id){return animationSet.getAnimationElement(id)},this.getFirstAnimationThreadElement=function(){return threadElements[0]},this.nextAnimationThreadElement=function(reset){return reset?this.resetCurrentThreadElementIndex():this.incrementCurrentThreadElementIndex(),this.getCurrentThreadElementIndex()>=threadElements.length?null:threadElements[this.getCurrentThreadElementIndex()]},this.getCurrentThreadElementIndex=function(){return currentThreadElementIndex},this.setCurrentThreadElementIndex=function(num){currentThreadElementIndex=Math.min(Math.max(0,num),threadElements.length)},this.incrementCurrentThreadElementIndex=function(){currentThreadElementIndex++},this.resetCurrentThreadElementIndex=function(){currentThreadElementIndex=0},this.getRequiresInput=function(){return requiresInput},this.setRequiresInput=function(newRequiresInput){requiresInput=newRequiresInput},this.addSelectionCriteria=function(attributes){for(var criteriaAttr=[],i=0;i<attributes.length;i++)criteriaAttr[attributes[i].nodeName]=attributes[i].nodeValue;selectionCriteria.push(criteriaAttr)},this.getSelectionCriteria=function(){return selectionCriteria},this.isSelected=function(){var result=!0,sc=this.getSelectionCriteria();if(0==Object.size(sc))result=!0;else for(var i=0;i<sc.length;i++){var criterium=sc[i];if(onChangeToSpecified(criterium)){if(!changeOccurred(criterium)){result=!1;break}if(!(criterium.variable in animationSet.getCurrentInputs())||criterium.value!=animationSet.getCurrentInputs()[criterium.variable]){result=!1;break}}else{if(!(criterium.variable in animationSet.getCurrentInputs()&&criterium.value==animationSet.getCurrentInputs()[criterium.variable])){result=!1;break}result=!0}}return result},this.startSimulation=function(){theSet.setCurrentThread(this),this.resetCurrentThreadElementIndex(),this.renderNextThreadElement(!0)},this.getSourceName=function(){return source},this.renderNextThreadElement=function(startAtBeginning){function tryHTML5AnimationFirst(html5Src,flashSrc){html5Src&&util().canPlayHtml5()?renderer().renderAnimation(currentElement,"animationPanel",html5Src,util().getFileName(html5Src),currentThreadElement.getMaxTime(),self):flashSrc&&renderer().renderFlash(currentElement,"animationPanel",flashSrc,util().getFileName(flashSrc),currentElement.getControls(),currentElementName,currentThreadElement.getMaxTime(),self)}if(debug("In renderNextThreadElement -startAtBeginning = "+startAtBeginning),startAtBeginning)currentThreadElement=this.getFirstAnimationThreadElement();else if(currentThreadElement=this.nextAnimationThreadElement(!1),!currentThreadElement)return dbg().logError(source,"Could not get next AnimationThreadElement for currentThread = "+this.getName()),null;if(debug("In renderNextThreadElement - currentThreadElement = "+currentThreadElement.getName()),!(currentElement=animationSet.getAnimationElement(currentThreadElement.getName())))return dbg().logError(source,"Could not get new current AnimationElement for currentThreadElement = "+currentThreadElement.getName()),null;debug("In renderNextThreadElement - currentElement = "+currentElement.getName()),currentElementName=currentElement.getName(),currentElementName||dbg().logWarning(source,"Name is null for current AnimationElement in AnimationThread = "+this.getName());var html5Src=null,flashSrc=null,self=this;switch(currentElement.getType()){case Simulator.Constants.IMAGE_ANIMATION:debug("In renderNextThreadElement - rendering image "+currentElement.getSrc()),renderer().renderImage(currentElement,"animationPanel",currentElement.getSrc(),currentElementName,currentThreadElement.getMaxTime(),this);break;case"animation":case Simulator.Constants.HTML5_ANIMATION:html5Src=currentElement.getSrc(),currentElement.getAltSrcType()==Simulator.Constants.FLASH_ANIMATION&&(flashSrc=currentElement.getAltSrc()),tryHTML5AnimationFirst(html5Src,flashSrc);break;case Simulator.Constants.FLASH_ANIMATION:flashSrc=currentElement.getSrc(),currentElement.getAltSrcType()==Simulator.Constants.HTML5_ANIMATION&&(html5Src=currentElement.getAltSrc()),tryHTML5AnimationFirst(html5Src,flashSrc);break;case Simulator.Constants.HOTTEXT_ANIMATION:renderer().renderHotText(currentElement,"animationPanel",currentElement.getSrc(),"",currentElement.getControls(),currentElementName,currentThreadElement.getMaxTime(),this)}return debug("In renderNextThreadElement - returning currentElement = "+currentElement.getName()),currentElement},this.inspect=function(embedded,force){var buff=[],sep="\n\n";buff.push('Inspecting AnimationThread "'),buff.push(this.getName()),buff.push('"'),buff.push(sep);for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));buff.push(inspectSelectionCriteria(this.getSelectionCriteria(),!0,force)),buff.push("End of selectionCriteria"),buff.push(sep);for(var i=0;i<threadElements.length;i++)switch(getConstructorName(threadElements[i].constructor.toString())){case"AnimationThreadElement":buff.push(threadElements[i].inspect(!0)),buff.push(sep)}if(buff.push("End of AnimationThread inspection"),buff.push(sep),embedded)return buff.join("");null==force?debug(buff.join("")):debugf(buff.join(""))},this.getCurrentElement=function(){return debug("In getCurrentElement - returning "+(null===currentElement?null:currentElement.getName())),currentElement},this.setCurrentElement=function(element){debug("In setCurrentElement - setting lastExecutedAnimationElement to currentElement: "+(null===currentElement?"null":currentElement.getName())),lastExecutedAnimationElement=currentElement,debug("In setCurrentElement - setting currentElement to "+(null===element?"null":element.getName())),currentElement=element},this.getLastExecutedAnimationElement=function(){return lastExecutedAnimationElement},this.setAttributes=function(attr,node){node&&(attr=util().getAttributes(node)),Simulator.Animation.AnimationThread.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"maxTime":this.setmaxTime(attr[i]);break;case"requiresInput":this.setRequiresInput(attr[i]);break;case"completionPendingOnOutput":this.setCompletionPendingOnOutput(attr[i])}for(var threadElements=node.childNodes,i=0;i<threadElements.length;i++)switch(threadElements[i].nodeName){case"selectionClause":for(var clauseElements=threadElements[i].childNodes,j=0;j<clauseElements.length;j++)"#"!=clauseElements[j].nodeName[0]&&this.addSelectionCriteria(clauseElements[j].attributes)}}},Simulator.Animation.AnimationThread.prototype=new Simulator.SimElement,Simulator.Animation.AnimationThread.parent=Simulator.SimElement,Simulator.Animation.AnimationThread.prototype.constructor=Simulator.Animation.AnimationThread,Simulator.Animation.AnimationThreadElement=function(sim,panel,section,animationSet,animationThread){function storeInputs(backupInputs){var inputs=whiteboard.getCategory("dataInputs");if(setPrevInputs(),Object.size(inputs)>0){setPrevInputs();for(var r in inputs)currentInputs[r]=inputs[r]}}function setPrevInputs(){for(var p in currentInputs)prevInputs[p]=currentInputs[p]}function onChangeToSpecified(criteria){return!!criteria.onChangeTo&&"yes"==criteria.onChangeTo}function changeOccurred(criteria){var prevVal=animationSet.getPrevInputs()[criteria.variable],curVarName=criteria.variable,currentVal=animationSet.getCurrentInputs()[curVarName];return currentVal!=prevVal&&("*"==criteria.value||currentVal==criteria.value)}function inspectSelectionCriteria(criteria,embedded,force){var buff=[],sep="\n\n";buff.push("Inspecting Selection Criteria:"),buff.push(sep);for(var l in criteria){buff.push("selectionCriteria["),buff.push(l),buff.push("]: "),buff.push(sep);for(var p in criteria[l])buff.push("["),buff.push(p),buff.push("] = "),buff.push(criteria[l][p]),buff.push(sep)}return buff.push("End of selectionCriteria"),buff.push(sep),embedded||(null==force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.SimElement.call(this,sim);var source="AnimationThreadElement",selectionCriteria=[],prevInputs=[],currentInputs=[],maxTime=-1;this.setEname(source);var util=function(){return sim.getUtils()},whiteboard=function(){sim.getWhiteboard()},dbg=function(){return sim.getDebug()},simDocument=function(){return sim.getSimDocument()};this.getMaxTime=function(){return maxTime},this.setMaxTime=function(newMaxTime){maxTime=newMaxTime},this.getAnimationThread=function(){return animationThread},this.getAnimationSet=function(){return animationSet},this.addSelectionCriteria=function(attributes){for(var criteriaAttr=[],i=0;i<attributes.length;i++)criteriaAttr[attributes[i].nodeName]=attributes[i].nodeValue;selectionCriteria.push(criteriaAttr)},this.getSelectionCriteria=function(){return selectionCriteria},this.isSelected=function(){var result=!0,sc=this.getSelectionCriteria(),scSize=Object.size(sc),inputSize=Object.size(animationSet.getCurrentInputs());if(0==scSize)result=!0;else if(scSize!=inputSize)result=!1;else for(var i=0;i<inputSize;i++){var criterium=sc[i];if(onChangeToSpecified(criterium)){if(!changeOccurred(criterium)){result=!1;break}if(!(criterium.variable in animationSet.getCurrentInputs())||criterium.value!=animationSet.getCurrentInputs()[criterium.variable]){result=!1;break}}else if(!(criterium.variable in animationSet.getCurrentInputs())||criterium.value!=animationSet.getCurrentInputs()[criterium.variable]){result=!1;break}}return result},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";buff.push("Inspecting "),buff.push(this.getEname()),buff.push(": "),buff.push(this.getName()),buff.push(sep);for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return buff.push(inspectSelectionCriteria(selectionCriteria,!0)),buff.push(sep),buff.push("end of AnimationThreadElement Inspection"),buff.push(sep),embedded||(null==force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")},this.setAttributes=function(attr,node){node&&(attr=util().getAttributes(node)),Simulator.Animation.AnimationThreadElement.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"maxTime":this.setMaxTime(attr[i]);break;default:continue}for(var threadElements=node.childNodes,i=0;i<threadElements.length;i++)if("#"!=threadElements[i].nodeName[0])switch(threadElements[i].nodeName){case"selectionClause":for(var clauseElements=threadElements[i].childNodes,j=0;j<clauseElements.length;j++)"#"!=clauseElements[j].nodeName[0]&&this.addSelectionCriteria(clauseElements[j].attributes)}},this.render=function(panelName,currentElementName,maxTime,thread){var element=this.getAnimationThread().getAnimationElement(this.getName());debug(null),element.render(panelName,currentElementName,maxTime,thread)}},Simulator.Animation.AnimationThreadElement.prototype=new Simulator.SimElement,Simulator.Animation.AnimationThreadElement.parent=Simulator.SimElement,Simulator.Animation.AnimationThreadElement.prototype.constructor=Simulator.Animation.AnimationThreadElement,Simulator.Animation.FlashAnimationInterface={},Simulator.Animation.FlashAnimationInterface.ObjectMapper=[],Simulator.Animation.FlashAnimationInterface.GetInstance=function(simID){return Simulator.Animation.FlashAnimationInterface.ObjectMapper[simID]},Simulator.Animation.FlashAnimationInterface.MapInstance=function(simObject){Simulator.Animation.FlashAnimationInterface.ObjectMapper[simObject.getSimID()]=simObject},Simulator.Animation.FlashAnimationInterface.AnimationMediaOutput=function(simID,type,data){var simulator=Simulator.Animation.FlashAnimationInterface.GetInstance(simID);simulator&&simulator.getAnimationSet().animationMediaOutput(simID,type,data)},Simulator.Input.Section=function(sim,thePanel,count){Simulator.SimElement.call(this,sim);var instance=this,divider="no",sectionLabel="",panel=thePanel,simID=null,sectionCount=count||0,orientation="vertical",numberOfColumns="1";this.getSectionSettings=function(){return{elementorientation:orientation,numberofcolumns:numberOfColumns}};var utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()};this.getSimDocument=function(){return simDocument()},sim&&(simID=sim.getSimID()),this.setDivider=function(newDivider){divider=newDivider},this.getDivider=function(){return divider},this.setLabel=function(newLabel){return sectionLabel=newLabel,this},this.getLabel=function(){return transDictionary().translate(sectionLabel)},this.getSectionID=function(){return"inputSection"+simID+sectionCount},this.render=function(){var label=this.getLabel(),HTMLPanel=simDocument().getElementById(panel.getNodeID()),space=this.getSpaceAbove();if(space>0&&utils().appendBlankVertcalSpace(HTMLPanel,space),label){var h4Element=simDocument().createElement("h4");h4Element.id=this.getSectionID(),h4Element.innerHTML=label,HTMLPanel.appendChild(h4Element)}var image=this.getImage();if(image){div=simDocument().createElement("div"),div.id="imageHolder"+simID,HTMLPanel.appendChild(div);var span=simDocument().createElement("span");span.id="holdingSpan"+simID,div.appendChild(span);var img=simDocument().createElement("img");img.id=this.getEname()+SimItem.NextForNumber(),img.src=image,span.appendChild(img)}"yes"==this.getDivider()&&HTMLPanel.appendChild(simDocument().createElement("hr")),(space=this.getSpaceBelow())>0&&utils().appendBlankVertcalSpace(HTMLPanel,space)},this.setAttributes=function(attr,node){Simulator.Input.Section.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"divider":instance.setDivider(attr[i]);break;case"orientation":orientation=attr[i];break;case"columns":numberOfColumns=attr[i]}}},Simulator.Input.Section.prototype=new Simulator.SimElement,Simulator.Input.Section.prototype.constructor=Simulator.Input.Section,Simulator.Input.InputElement=function(sim){Simulator.SimElement.call(this,sim);var prevValue=null,data=0,availableinputScopes=["dataInput","animationInput","evaluationInput"],inputScope=[],saveOnChange=!0,key=void 0,scoreable=!0,state="enabled",eventsRegistered=!1,panel=null,section=null,eventMgr=function(){return sim.getEventManager()},simulationMgr=function(){return sim.getSimulationManager()},whiteboard=function(){return sim.getWhiteboard()},scoringTable=function(){return sim.getScoringTable()},simDocument=function(){return sim.getSimDocument()};this.getPanel=function(){return panel},this.setPanel=function(newPanel){return(panel=newPanel).registerIOElement(this),this},this.setSection=function(theSection){section=theSection},this.getSectionLabel=function(){return section.getLabel()},this.getSectionID=function(){return section.getSectionID()},this.createLabelID=function(){return this.createItemID(!1,-1,this.getName()+"Label")},this.createUnitsID=function(){return this.createItemID(!1,-1,this.getName()+"Units")},this.getPrevValue=function(){return prevValue},this.setPrevValue=function(newPrevValue){return prevValue=newPrevValue,this},this.getData=function(){var dataArray=[];return dataArray[0]&&(prevValue=dataArray[0]),dataArray[0]=data,dataArray},this.setData=function(newData){return data&&(prevValue=data),data=newData,this},this.getInputScope=function(){return inputScope},this.setInputScope=function(newinputScope){if("globalInput"==newinputScope)for(var i=0;i<availableinputScopes.length;i++)inputScope[i]=availableinputScopes[i];else inputScope=newinputScope.split(",");for(var j=0;j<inputScope.length;j++)inputScope[j]=inputScope[j].trim()},this.getSaveOnChange=function(){return saveOnChange},this.setSaveOnChange=function(newSaveOnChange){saveOnChange="no"!=newSaveOnChange},this.onChange=function(id){id||(id=this.getNodeID());var jsObj=this.getHTMLElement(id);this.recordInput(jsObj,!1,!0,!1),this.postOnChangeEvents()},this.recordInput=function(obj,setDefault,recordOnChange,forcedSave){for(var value=null,i=0;i<inputScope.length;i++)void 0==key&&(key=whiteboard().addItem(inputScope[i],this.getName())),(value=this.getData(inputScope[i]))&&("animationInput"==inputScope[i]&&this instanceof Simulator.Input.InputElement?value=this.formatForAnimationInput(value):"dataInput"==inputScope[i]&&this instanceof Simulator.Input.InputElement&&(value=this.formatForTableInput(value)),whiteboard().setItem(inputScope[i],this.getName(),value,key));value&&this.getScoreable()&&!setDefault&&(this.postOnChangeEnabled()||forcedSave)&&scoringTable().setValue(this.getName(),simulationMgr().getTrialRowNum(recordOnChange),value)},this.getScoreable=function(){return scoreable},this.formatForAnimationInput=function(value){return value},this.formatForTableInput=function(value){return value},this.setScoreable=function(newScoreable){scoreable="yes"==newScoreable},this.getState=function(){return state},this.setState=function(newState){state="disabled"==newState?"disabled":"enabled"},this.disableInput=function(){simDocument().getElementById(this.getNodeID()).disabled=!0,this.setState("disabled")},this.enableInput=function(){simDocument().getElementById(this.getNodeID()).disabled=!1,this.setState("enabled")},this.getHTMLElement=function(id){return id?simDocument().getElementById(id):simDocument().getElementById(this.getNodeID())},this.registerEvents=function(){eventsRegistered||(eventMgr().registerEvent(new Simulator.Event(this,"info","simulatorStateChange"),"to"),eventsRegistered=!0)},this.setAttributes=function(attr){Simulator.Input.InputElement.prototype.setAttributes.call(this,attr);for(var i in attr)switch(i){case"inputScope":this.setInputScope(attr[i]);break;case"state":this.setState(attr[i]);break;case"scoreable":this.setScoreable(attr[i]);break;case"saveOnChange":this.setSaveOnChange(attr[i])}}},Simulator.Input.InputElement.prototype=new Simulator.SimElement,Simulator.Input.InputElement.parent=Simulator.SimElement,Simulator.Input.InputElement.prototype.constructor=Simulator.Input.InputElement,Simulator.Input.GroupList=function(sim){Simulator.Input.InputElement.call(this,sim);var items=[],dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};this.getItems=function(){return items},this.setItems=function(node){var id;try{utils().isInternetExplorer()?node.attributes.getNamedItem("name").value:node.attributes.name.nodeValue}catch(err){dbg().logError(source,"Error occurred getting element name: "+err.message),""}var attr=[],itemID=null,itemNum=0;if(null!=node.childNodes)for(var j=0;j<node.childNodes.length;j++)if("#"!=(id=node.childNodes[j].nodeName)[0]&&("item"==id||"ITEM"==id)){attr=node.childNodes[j].attributes;var attributes=new Simulator.Utils.Dictionary(sim);items[itemNum]=attributes;for(var i=0;i<attr.length;i++){var attribute=attr[i],nodeName=attribute.nodeName;attribute.nodeName,attributes.setValue(nodeName,attribute.nodeValue)}itemID=0==j?this.createItemID(!0,itemNum):this.createItemID(!1,itemNum),attributes.setValue("itemID",itemID),itemNum++}},this.disableItems=function(){for(var i=0;i<items.length;i++)simDocument().getElementById(items[i].itemID).disabled=!0},this.enableItems=function(){for(var i=0;i<items.length;i++)simDocument().getElementById(items[i].itemID).disabled=!1},this.getDefaultSelection=function(){for(var defaults=[],i=0;i<items.length;i++)items[i].keyExists("default")&&"yes"==items[i].lookup("default")&&defaults.push(items[i].lookup("val"));return defaults},this.setDefaultSelections=function(){var defaults=this.getDefaultSelection();defaults.length>0&&(selectedItem=defaults,this.setData(defaults))},this.getDataProxy=function(itemNum){return void 0!=itemNum&&null!=itemNum?items[itemNum].lookup("dataProxy"):null},this.getAnimationProxy=function(itemNum){return void 0!=itemNum&&null!=itemNum?items[itemNum].lookup("animationProxy"):null},this.getEvaluationProxy=function(itemNum){return void 0!=itemNum&&null!=itemNum?items[itemNum].lookup("evaluationProxy"):null},this.extractItemValue=function(itemIndex){var value=null,inputScope=this.getInputScope();if(isNaN(itemIndex))for(var i=0;i<items.length;i++)if(items[i].itemID==itemIndex){itemIndex=i;break}return itemIndex>=0?("dataInput"==inputScope?value=this.getDataProxy(itemIndex):"evaluationInput"==inputScope?value=this.getEvaluationProxy(itemIndex):"animationInput"==inputScope&&(value=this.getAnimationProxy(itemIndex)),void 0!=value&&null!=value||(value=items[itemIndex].lookup("val")),value):(dbg().logError(source,'itemIndex = "'+itemIndex+'". Could not extract item value'),null)},this.saveState=function(indent,preface,nameStr,valStr,suffix){for(var checkedItems="",i=0;i<items.length;i++){var id=items[i].itemID,value=items[i].lookup("val");void 0!=value&&null!=value&&""!=value||(value=items[i].lookup("dataProxy"));var htmlElement=simDocument().getElementById(id);void 0!=htmlElement.checked?htmlElement.checked&&(""==checkedItems?checkedItems+=value:checkedItems=checkedItems+", "+value):void 0!=htmlElement.selected&&htmlElement.selected&&(this.selectedIndex=value,checkedItems=value)}return""!=checkedItems?indent+preface+nameStr+this.getName()+valStr+checkedItems+suffix:""},this.setSelectStateViaKeyboard=function(elementID,itemID){var HTMLItem=null;(HTMLItem=itemID?simDocument().getElementById(itemID):simDocument().getElementById(elementID))&&("dropList"==this.getType()?HTMLItem.selected?HTMLItem.removeAttribute("selected"):HTMLItem.selected="selected":HTMLItem.checked?HTMLItem.checked=!1:(HTMLItem.checked="checked",this.recordInput(this)))},this.setSelectStateViaSpeech=function(elementID,itemID){this.recordKeyboardSelection(elementID,itemID)},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){var element=null,item=null;itemID&&((item=simDocument().getElementById(itemID))||(element=simDocument().getElementById(elementID))&&(item=element.getElementsByClassName(itemID)[0]),item&&(item.isSelected=!0,this.setSelectStateViaKeyboard(elementID,itemID),this.onChange(elementID)))},this.inspect=function(embedded,forced){buff=[],embedded||buff.push("Inspecting GroupList");var items=this.getItems();for(var i in items)buff.push(i),buff.push(" = "),buff.push(items[i]),buff.push("\n\n");if(embedded)return buff.join("");1==forced?dbg().debugf(buff.join("")):dbg().debug(buff.join())},this.setAttributes=function(attr){Simulator.Input.GroupList.prototype.setAttributes.call(this,attr);for(var i in attr)switch(i){case"items":this.setItems(attr[i])}}},Simulator.Input.GroupList.prototype=new Simulator.Input.InputElement,Simulator.Input.GroupList.prototype.constructor=Simulator.Input.GroupList,Simulator.Input.ChoiceList=function(sim,node,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.GroupList.call(this,sim);var that=this,source="ChoiceList",dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simMgr=function(){return sim.getSimulationManager()},keyboardInput=function(){return sim.getKeyboardInput()},scoringTable=function(){return sim.getScoringTable()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()};sim&&(this.setPanel(panel),this.setSection(theSection)),this.formatEventData=function(){for(var buff=[],data=this.getData(),i=0;i<data.length;i++)data[i]&&(buff.push(data[i]),i<data.length-1&&buff.push(","));return buff.join("")},this.formatForAnimationInput=function(value){var output=[];return output[0]=value.join(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER),output},this.formatForTableInput=function(value){var output=[];return output[0]=value.join(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+" "),output},this.getData=function(inputScope){for(var checkedItems=[],k=0,proxy=null,items=this.getItems(),i=0;i<items.length;i++){var labelFor=simDocument().getElementById(items[i].lookup("labelForID"));simDocument().getElementById(items[i].itemID).checked?("dataInput"==inputScope?proxy=this.getDataProxy(i):"evaluationInput"==inputScope?proxy=this.getEvaluationProxy(i):"animationInput"==inputScope&&(proxy=this.getAnimationProxy(i)),checkedItems[k]=void 0!=proxy&&null!=proxy?proxy:items[i].lookup("val"),labelFor.setAttribute("class","inputChecked"),k++):labelFor.removeAttribute("class")}return this.setData(checkedItems),checkedItems},this.handleEvent=function(event){switch(event.type){case"inputReq":this.recordInput(this);break;case"info":event.context;break;default:return void dbg().logWarning(sourde,"Unhandled event type received: "+event.toString())}},this.setElementSelectState=function(state,contents){var htmlElement=null;selectedItem=-1;for(var items=this.getItems(),parts=contents.split(","),i=0;i<parts.length;i++)null!=parts[i]&&(parts[i]=parts[i].trim());for(var value=null,i=0;i<items.length;i++){var labelFor=simDocument().getElementById(items[i].lookup("labelForID"));value=items[i].lookup("dataProxy")||items[i].lookup("val"),"true"==state?utils().elementInArray(parts,value)?(items[i].setValue("selected","checked"),""==selectedItem?selectedItem=value:selectedItem=", "+value,(htmlElement=simDocument().getElementById(items[i].itemID)).checked="checked",labelFor.setAttribute("class","inputChecked"),this.recordInput(this,!0)):(items[i].lookup("selected")||"yes"==items[i].lookup("default"))&&((htmlElement=simDocument().getElementById(items[i].itemID))&&(htmlElement.checked=!1),labelFor.removeAttribute("class"),items[i].remove("selected")):value==contents&&items[i].lookup("selected")&&((htmlElement=simDocument().getElementById(items[i].itemID))&&(htmlElement.checked=!1),labelFor.removeAttribute("class"),items[i].remove("selected"))}},this.keyboardNavigateTo=function(elementID,itemID,index){var element=simDocument().getElementById(elementID),item=element.getElementsByTagName("li")[index];element&&(element.selectedIndex=index),item&&item.setAttribute("class","simAreaFocus")},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){simDocument().getElementById(elementID).getElementsByTagName("li")[index].removeAttribute("class")},this.disableInput=function(){this.disableItems()},this.enableInput=function(){this.enableItems()},this.setAttributes=function(attr,node){Simulator.Input.ChoiceList.prototype.setAttributes.call(this,attr),this.getScoreable()&&scoringTable().addElement(this.getName(),"input"),this.setItems(node)},this.doOnClick=function(id){this.onChange(id)},this.render=function(){var nodeID=this.getNodeID(),itemID=null,items=this.getItems(),nextNum=utils().getNextSequenceNumber(),image=null,labelledByID=this.getSectionID(),panelHtml=container,outerDiv=simDocument().createElement("div");if(outerDiv.className="inputChoiceList",this.setFocusable(!0,!0),this.getLabel()){var h5LabelElement=simDocument().createElement("h5"),h5ID=this.createLabelID();h5LabelElement.id=h5ID,labelledByID=labelledByID+" "+h5ID,h5LabelElement.innerHTML=this.getLabel(),panelHtml.appendChild(h5LabelElement)}for(var x=0;x<items.length;x++){var itemIDReset=0==x;itemID=this.createItemID(itemIDReset),items[x].itemID=itemID;items[x].lookup("image");if(image=transDictionary().translate(items[x].lookup("image")),0==x){if(null!=image&&void 0!=image){var ulElement=simDocument().createElement("ul");ulElement.id=nodeID,ulElement.setAttribute("class","multiSelect withImages")}else(ulElement=simDocument().createElement("ul")).id=nodeID,ulElement.setAttribute("class","multiSelect"),ulElement.setAttribute("role","group"),ulElement.setAttribute("aria-labelledby",labelledByID);"horizontal"===theSection.getSectionSettings().elementorientation&&outerDiv.classList.add("inputpanelcell"),outerDiv.appendChild(ulElement)}labelForID="labelFor"+itemID;if(items[x].setValue("labelForID",labelForID),void 0!=items[x].lookup("val")){var valueTag=items[x].lookup("val"),valueTranslated=transDictionary().translate(valueTag),listElement=simDocument().createElement("li"),inputEl=simDocument().createElement("input");inputEl.id=itemID,inputEl.setAttribute("type","checkbox"),inputEl.setAttribute("name","ChoiceButtonGroup"+nodeID+nextNum),inputEl.setAttribute("value",valueTranslated),this.getSaveOnChange()&&utils().bindEvent(inputEl,"click",function(){that.doOnClick(nodeID)}),"yes"==items[x].lookup("default")&&inputEl.setAttribute("checked",""),listElement.appendChild(inputEl);var labelForID="labelFor"+itemID;items[x].setValue("labelForID",labelForID);var labelEl=simDocument().createElement("label");if(labelEl.id=labelForID,labelEl.setAttribute("for",itemID),"yes"==items[x].lookup("default")&&labelEl.setAttribute("class","inputChecked"),null!=image&&void 0!=image){var imageSpanEl=simDocument().createElement("span");imageSpanEl.setAttribute("class","holderImage");var imageEl=simDocument().createElement("img");imageEl.setAttribute("src",image),imageEl.setAttribute("alt",valueTranslated),imageSpanEl.appendChild(imageEl),labelEl.appendChild(imageSpanEl)}var listLabelSpanEl=simDocument().createElement("span");listLabelSpanEl.setAttribute("class","listLabel"),listLabelSpanEl.innerHTML=valueTranslated,labelEl.appendChild(listLabelSpanEl),listElement.appendChild(labelEl),ulElement.appendChild(listElement)}this.isFocusable()&&keyboardInput().addFocusableElementItem(this,this.getNodeID(),itemID)}panelHtml.appendChild(outerDiv),this.setDefaultSelections(),this.mapHTML2JS(ulElement)},this.getSourceName=function(){return source},this.inspect=function(embedded,forced){var buff=[],sep="\n\n";buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep);for(var i in this)"items"==i?buff.push(this.parent.inspect()):"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(embedded)return buff.join("");1==forced?dbg().debugf(buff.join("")):dbg().debug(buff.join(""))}},Simulator.Input.ChoiceList.prototype=new Simulator.Input.GroupList,Simulator.Input.ChoiceList.prototype.constructor=Simulator.Input.ChoiceList,Simulator.Input.DropList=function(sim,node,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.GroupList.call(this,sim);var dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},keyboardInput=function(){return sim.getKeyboardInput()},scoringTable=function(){return sim.getScoringTable()},simMgr=function(){return sim.getSimulationManager()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()},instance=this,selectType="single",listExpanded=!1;sim&&(this.setPanel(panel),this.setSection(theSection)),this.getSelectType=function(){return selectType},this.getElementData=function(id){},this.getKeyboardInput=function(){return keyboardInput()},this.setSelectType=function(newSelectType){return selectType=newSelectType,this},this.getListExpanded=function(){return listExpanded},this.getData=function(inputScope){var data=[],proxy=null,select=simDocument().getElementById(this.getNodeID()),value=select.value;return this.setData(value),"dataInput"==inputScope?proxy=this.getDataProxy(select.selectedIndex):"animationInput"==inputScope?proxy=this.getAnimationProxy(select.selectedIndex):"evaluationInput"==inputScope&&(proxy=this.getEvaluationProxy(select.selectedIndex)),data[0]=void 0!=proxy&&null!=proxy?proxy:value,data},this.handleEvent=function(event){switch(event.type){case"inputReq":this.recordInput(this);break;case"info":event.context;break;default:return void dbg().logWarning(source,"Unhandled event type received: "+event.toString())}},this.setElementSelectState=function(state,contents){for(var items=this.getItems(),value=null,i=0;i<items.length;i++){value=items[i].lookup("dataProxy")||items[i].lookup("val");var htmlElement=simDocument().getElementById(items[i].itemID);"true"==state?value==contents?(items[i].setValue("selected","selected"),selectedItem=value,htmlElement.selected=!0,this.recordInput(this,!0)):"selected"==items[i].lookup("selected")&&htmlElement.removeAttribute("selected"):value==contents&&"selected"==items[i].lookup("selected")&&htmlElement.removeAttribute("selected")}},this.receivedSpeechFocus=function(){debug(this.getName()+" received speech focus");var element=simDocument().getElementById(this.getNodeID()),outline=(simDocument().getElementById(Simulator.Constants.INPUT_PANEL_NAME),simDocument().getElementById("dropHolder"+this.getName()));outline&&outline.setAttribute("class","dropHolder simAreaFocus"),outline.size=this.getItems().length,element.size=this.getItems().length,simDocument().getElementById(this.getName()).style.border="thin solid #ff0000"},this.speechActivated=function(value){this.setSelectStateViaSpeech(this.getNodeID(),value),InputElement.onChange(this.getNodeID())},this.removeSpeechFocus=function(){debug(this.getName()+" lost speech focus"),(element=simDocument().getElementById(this.getNodeID())).size=1;var node=simDocument().getElementById(Simulator.Constants.INPUT_PANEL_NAME),element=getElementsByClassName("dropHolder",node)[0];(node=simDocument().getElementById(this.getName())).style.border="none",element&&element.setAttribute("class","dropHolder")},this.keyboardNavigateTo=function(elementID,itemID,index){var outline=simDocument().getElementById(elementID).parentNode;outline&&outline.setAttribute("class","dropHolder simAreaFocus");var item=null;(item=simDocument().getElementById(itemID))&&item.setAttribute("focused","focused"),listExpanded||(this.expandList(),listExpanded=!0)},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){var outline=simDocument().getElementById(elementID).parentNode;outline&&outline.setAttribute("class","dropHolder");var item=null;(item=simDocument().getElementById(itemID))&&item.setAttribute("focused",""),listExpanded&&(this.closeList(),listExpanded=!1)},this.disableInput=function(){this.disableItems()},this.enableInput=function(){this.enableItems()},this.expandList=function(){var dlist=simDocument().getElementById(this.getNodeID()),newspan=simDocument().createElement("span");newspan.setAttribute("id","selectholderspan"),newspan.setAttribute("class","selectHolder selectOpened"),dlist.parentNode.parentNode.appendChild(newspan),newspan.appendChild(dlist.parentNode),dlist.setAttribute("size",this.getItems().length);var visibleHeight=1.2*this.getItems().length;dlist.style.height=visibleHeight.toString()+"em";var container=simDocument().getElementById(Simulator.Constants.SIM_CONTAINER_NAME+sim.getSimID());container&&utils().bindEvent(container,"click",function(){instance&&instance.getListExpanded()&&instance.getKeyboardInput().closeDropList()})},this.closeList=function(){var dlist=simDocument().getElementById(this.getNodeID());dlist.style.height="",dlist.setAttribute("size",0);var spanRemoved=dlist.parentNode.parentNode;spanRemoved.parentNode.appendChild(dlist.parentNode),spanRemoved.parentNode.removeChild(spanRemoved)},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){var element=null,item=null;itemID&&elementID&&(item=simDocument().getElementById(itemID),element=simDocument().getElementById(elementID),item||element&&(item=element.getElementsByClassName(itemID)[0]),item&&(null!=element.selectedIndex&&element.selectedIndex>=0&&element.options[element.selectedIndex].setAttribute("selected",""),item.selected=!0,item.setAttribute("selected","selected"),element&&(element.selectedIndex=itemIndex),this.setSelectStateViaKeyboard(elementID,itemID),this.onChange(elementID))),listExpanded&&(this.closeList(),listExpanded=!1)},this.setAttributes=function(attr,node){Simulator.Input.DropList.prototype.setAttributes.call(this,attr);for(var i in attr)switch(i){case"selectType":this.setSelectType(attr[i])}instance.getScoreable()&&scoringTable().addElement(instance.getName(),"input"),this.setItems(node)},this.doOnChange=function(){instance.onChange(instance.getNodeID())},this.render=function(){var items=this.getItems(),itemID=null,labelledByID=this.getSectionID();this.setFocusable(!0,!0);var image=this.getImage();if(void 0!=image&&null!=image){(dropDiv=simDocument().createElement("div")).setAttribute("class","dropDown withImages"),dropDiv.id=this.getName();var holderSpan=simDocument().createElement("span");holderSpan.setAttribute("class","holderImage"),dropDiv.appendChild(holderSpan);var img=simDocument().createElement("img");img.src=image,img.alt=this.getName()+" image",holderSpan.appendChild(img),dropDiv.appendChild(holderSpan)}else{var dropDiv=simDocument().createElement("div");dropDiv.setAttribute("class","dropDown"),dropDiv.id=this.getName()}var form=simDocument().createElement("form");dropDiv.appendChild(form),form.name=this.getName();var formSpan=simDocument().createElement("span");if(formSpan.setAttribute("class","dropHolder"),formSpan.id="dropHolder"+this.getName(),form.appendChild(formSpan),this.getLabel()){var labelSpan=simDocument().createElement("span");labelSpan.style.padding.top="15px",labelSpan.style.padding.top="15px",labelSpan.innerHTML=this.getLabel();var labelSpanID=this.createLabelID();labelSpan.id=labelSpanID,labelledByID=labelledByID+" "+labelSpanID,formSpan.appendChild(labelSpan)}var select=simDocument().createElement("select");select.id=this.getNodeID(),select.setAttribute("aria-labelledby",labelledByID);for(var item=null,x=0;x<items.length;x++){var itemIDReset=0==x;itemID=this.createItemID(itemIDReset),items[x].itemID=itemID,void 0!=items[x].lookup("val")&&((item=simDocument().createElement("option")).id=itemID,item.value=items[x].lookup("val")),"yes"==items[x].lookup("default")&&(item.selected="selected");var innerHTMLtag=items[x].lookup("val");item.innerHTML=transDictionary().translate(innerHTMLtag),select.appendChild(item),this.isFocusable()&&keyboardInput().addFocusableElementItem(this,this.getNodeID(),itemID)}formSpan.appendChild(select);var arrowSpan=simDocument().createElement("span");arrowSpan.setAttribute("class","dropArrow"),formSpan.appendChild(arrowSpan),htmlPanel=container,"horizontal"===theSection.getSectionSettings().elementorientation&&dropDiv.classList.add("inputpanelcell"),htmlPanel.appendChild(dropDiv);var dropList=simDocument().getElementById(this.getNodeID());instance.getSaveOnChange()&&utils().bindEvent(dropList,"change",function(){instance.doOnChange()}),utils().appendBlankVertcalSpace(simDocument().getElementById(panel.getNodeID()),2),this.setDefaultSelections(),this.mapHTML2JS(dropList)},this.getSourceName=function(){return source},this.inspect=function(embedded,forced){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"items"==i?buff.push(this.parent.inspect()):"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(embedded)return buff.join("");!0===forced?dbg().debugf(buff.join("")):dbg().debug(buff.join(""))}},Simulator.Input.DropList.prototype=new Simulator.Input.GroupList,Simulator.Input.DropList.prototype.constructor=Simulator.Input.DropList,Simulator.Input.OptionList=function(sim,node,panel,theSection,container){Simulator.Input.GroupList.call(this,sim);var that=this,source="OptionList",dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},scoringTable=function(){return sim.getScoringTable()},keyboardInput=function(){return sim.getKeyboardInput()},simMgr=function(){sim.getSimulationManager()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()};sim&&(this.setPanel(panel),this.setSection(theSection)),this.getData=function(inputScope){for(var data=[],proxy=null,items=this.getItems(),i=0;i<items.length;i++){var HTMLItem=simDocument().getElementById(items[i].lookup("itemID")),labelFor=simDocument().getElementById(items[i].lookup("labelForID"));"dataInput"==inputScope?proxy=this.getDataProxy(i):"evaluationInput"==inputScope?proxy=this.getEvaluationProxy(i):"animationInput"==inputScope&&(proxy=this.getAnimationProxy(i)),HTMLItem.checked?(data[0]=void 0!=proxy&&null!=proxy?proxy:items[i].lookup("val"),this.setData(data[0]),labelFor.setAttribute("class","inputChecked"),items[i].setValue("checked","true"),selectedItem=data[0]):(labelFor.removeAttribute("class"),items[i].setValue("checked","false"))}return 0==data.length&&this.setData(""),data},this.handleEvent=function(event){switch(event.type){case"inputReq":this.recordInput(this);break;case"info":event.context;break;default:return void dbg().logWarning(source,"Unhandled event type received: "+event.toString())}},this.setElementSelectState=function(state,contents){for(var items=this.getItems(),value=null,i=0;i<items.length;i++){value=items[i].lookup("dataProxy")||items[i].lookup("val");var itemID=items[i].lookup("itemID"),labelFor=simDocument().getElementById("labelFor"+itemID),htmlElement=simDocument().getElementById(itemID);value==contents?(items[i].setValue("checked","true"),selectedItem=value,htmlElement.checked="checked",labelFor.setAttribute("class","inputChecked"),this.recordInput(this,!0)):items[i].lookup("checked")&&(items[i].setValue("checked","false"),htmlElement.removeAttribute("checked"),labelFor.removeAttribute("class"))}},this.keyboardNavigateTo=function(elementID,itemID,index){var element=simDocument().getElementById(elementID);if(element){element.selectedIndex=index;var item=element.getElementsByTagName("li")[index];item&&item.setAttribute("class","simAreaFocus")}},this.receivedSpeechFocus=function(){debug(this.getName()+" received speech focus");var element=simDocument().getElementById(this.getNodeID());if(element){element.selectedIndex=0,element.style.border="thin solid #ff0000";var item=element.getElementsByTagName("li")[0];item&&item.setAttribute("class","simAreaFocus")}},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){var element=simDocument().getElementById(elementID);if(element){var item=element.getElementsByTagName("li")[index];item&&item.removeAttribute("class")}},this.removeSpeechFocus=function(){debug(this.getName()+" lost speech focus");var element=simDocument().getElementById(this.getNodeID());if(element){element.style.border="none";var item=element.getElementsByTagName("li")[0];item&&item.removeAttribute("class")}},this.disableInput=function(){this.disableItems()},this.enableInput=function(){this.enableItems()},this.speechActivated=function(value){this.setSelectStateViaSpeech(this.getNodeID(),value),this.onChange(this.getNodeID())},this.setAttributes=function(attr,node){Simulator.Input.OptionList.prototype.setAttributes.call(this,attr,node),this.getScoreable()&&scoringTable().addElement(this.getName(),"input"),this.setItems(node)},this.doOnClick=function(id){this.onChange(id)},this.render=function(){var nodeID=this.getNodeID(),itemID=null,items=this.getItems(),nextNum=utils().getNextSequenceNumber(),image=null,labelledByID=this.getSectionID(),panelHtml=container,outerDiv=simDocument().createElement("div");if(outerDiv.className="inputOptionList",this.setFocusable(!0,!0),this.getLabel()){var h5LabelElement=simDocument().createElement("h5"),h5ID=this.createLabelID();h5LabelElement.id=h5ID,labelledByID=labelledByID+" "+h5ID,h5LabelElement.innerHTML=this.getLabel(),outerDiv.appendChild(h5LabelElement)}for(var ulElement=null,x=0;x<items.length;x++){var itemIDReset=0==x;itemID=this.createItemID(itemIDReset),items[x].itemID=itemID;items[x].lookup("image");if(image=transDictionary().translate(items[x].lookup("image")),0==x&&(void 0!=image&&null!=image?((ulElement=simDocument().createElement("ul")).id=nodeID,ulElement.setAttribute("class","singleSelect withImages"),ulElement.setAttribute("role","radiogroup"),ulElement.setAttribute("aria-labelledby",labelledByID)):((ulElement=simDocument().createElement("ul")).id=nodeID,ulElement.setAttribute("class","singleSelect"),ulElement.setAttribute("role","radiogroup"),ulElement.setAttribute("aria-labelledby",labelledByID)),"horizontal"===theSection.getSectionSettings().elementorientation&&outerDiv.classList.add("inputpanelcell"),outerDiv.appendChild(ulElement)),void 0!=items[x].lookup("val")){var valueTag=items[x].lookup("val"),valueTranslated=transDictionary().translate(valueTag),listElement=simDocument().createElement("li"),inputEl=simDocument().createElement("input");inputEl.id=itemID,inputEl.setAttribute("type","radio"),inputEl.setAttribute("name","RadioButtonGroup"+nodeID+nextNum),inputEl.setAttribute("value",valueTranslated),this.getSaveOnChange()&&utils().bindEvent(inputEl,"click",function(){that.doOnClick(nodeID)}),"yes"==items[x].lookup("default")&&inputEl.setAttribute("checked",""),listElement.appendChild(inputEl);var labelForID="labelFor"+itemID;items[x].setValue("labelForID",labelForID);var elementLabel=simDocument().createElement("label");if(elementLabel.id=labelForID,elementLabel.setAttribute("for",itemID),"yes"==items[x].lookup("default")&&elementLabel.setAttribute("class","inputChecked"),void 0!=image&&null!=image){var imageSpanEl=simDocument().createElement("span");imageSpanEl.setAttribute("class","holderImage");var imageEl=simDocument().createElement("img");imageEl.setAttribute("src",image),imageEl.setAttribute("alt",valueTranslated),imageSpanEl.appendChild(imageEl),elementLabel.appendChild(imageSpanEl)}var listLabelSpanEl=simDocument().createElement("span");listLabelSpanEl.setAttribute("class","listLabel"),listLabelSpanEl.innerHTML=valueTranslated,elementLabel.appendChild(listLabelSpanEl),listElement.appendChild(elementLabel),ulElement.appendChild(listElement)}this.isFocusable()&&keyboardInput().addFocusableElementItem(this,nodeID,itemID)}panelHtml.appendChild(outerDiv),this.setDefaultSelections(),this.mapHTML2JS(ulElement)},this.getSourceName=function(){return source},this.inspect=function(embedded,forced){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"items"==i?buff.push(this.parent.inspect()):"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(embedded)return buff.join("");dbg().debug(buff.join(""))};var debug=function(str1,str2,trace){dbg().debug(source,str1,str2,trace)},debugf=function(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}},Simulator.Input.OptionList.prototype=new Simulator.Input.GroupList,Simulator.Input.OptionList.parent=Simulator.Input.GroupList,Simulator.Input.OptionList.prototype.constructor=Simulator.Input.OptionList,Simulator.Input.FieldSet=function(sim){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.InputElement.call(this,sim);var dbg=function(){return sim.getDebug()},persistentVarDB=function(){return sim.getPersistentVariableDataBase()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()},defaultValue=0,minValue=0,increment=0,unitsTag="",data="",valueModifier=null,valueChanged=!1,selectedValue=-1,valueModifierOp="add",maxValue=0;this.getMinValue=function(){return minValue},this.setMinValue=function(newMinValue){return minValue=newMinValue,this},this.getMaxValue=function(){return maxValue},this.setMaxValue=function(newMaxValue){return maxValue=newMaxValue,this},this.getDefaultValue=function(){return this.setData(defaultValue),defaultValue},this.setDefaultValue=function(newDefaultValue){return defaultValue=newDefaultValue,selectedValue=newDefaultValue,this.setPrevValue(newDefaultValue),this},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){var element=null,item=null;itemID&&((item=simDocument().getElementById(itemID))||(element=simDocument().getElementById(elementID))&&(item=element.getElementsByClassName(itemID)[0]),item&&(item.isSelected=!0,this.setSelectStateViaKeyboard(elementID,itemID),this.onChange(elementID)))},this.setSelectStateViaKeyboard=function(elementID,itemID){"goingUp"==itemID?incrementValue(elementID,this.getMaxValue(),this.getIncrement()):"goingDown"==itemID&&decrementValue(elementID,this.getMaxValue(),this.getIncrement())},this.getIncrement=function(){return increment},this.setIncrement=function(newIncrement){return increment=newIncrement,this},this.getUnits=function(){return transDictionary().translate(unitsTag)},this.setUnits=function(newUnits){return unitsTag=newUnits,this},this.setData=function(newData){data=newData},this.getData=function(){var dataArray=[];return dataArray[0]=data,dataArray},this.saveState=function(indent,preface,nameStr,valStr,suffix){return""!=selectedValue?indent+preface+nameStr+this.getName()+valStr+this.getData()+suffix:""},this.setElementSelectState=function(state,contents){var value=parseFloat(contents);value>=this.getMinValue()&&value<=this.getMaxValue()&&value%this.getIncrement()==0&&(this.setData(contents),selectedValue=contents,setHTMLValue(this.getNodeID(),this.getData()),this.recordInput(this,!0))},this.setValueModifier=function(element){valueModifier=element},this.getValueModifier=function(){return valueModifier},this.setValueModifierOp=function(op){valueModifierOp=op},this.getValueModifierOp=function(){return valueModifierOp};var doModifierOp=function(element,value){var modifier=element.getValueModifier();if(isNaN(modifier)&&(modifier=persistentVarDB().getElementValue(element.getValueModifier())),void 0==value||null==value)logError("ValueModifier "+modifier+" for "+element.getName()+" is not a number nor in persistentVarDB");else{var op=element.getValueModifierOp();switch(op){case"add":value+=modifier;break;case"multiply":value*=modifier;break;case"subtract":value-=modifier;break;case"divide":value/=modifier;break;default:dbg().logError(source,'Value modifer operation "'+op+'" is not defined')}}return value};this.getModifiedValue=function(value){return null!=this.getValueModifier()&&(value=doModifierOp(this,value)),value},this.setAttributes=function(attr,node){Simulator.Input.FieldSet.prototype.setAttributes.call(this,attr);for(var i in attr)switch(i){case"minValue":this.setMinValue(attr[i]);break;case"maxValue":this.setMaxValue(attr[i]);break;case"defaultValue":this.setDefaultValue(attr[i]);break;case"increment":this.setIncrement(attr[i]);break;case"units":this.setUnits(attr[i])}};var setHTMLValue=function(id,value){var htmlElement=simDocument().getElementById(id);htmlElement||(htmlElement=simDocument().getElementById(id+"slider-value")),htmlElement&&(htmlElement.value=value)};this.setValueChanged=function(newValueChanged){valueChanged="true"==newValueChanged||"yes"==newValueChanged},this.getValueChanged=function(){return valueChanged},this.incrementValue=function(id,maxValue,increment){var htmlElement=simDocument().getElementById(id);currentValue=parseFloat(htmlElement.value),currentValue=Math.min(currentValue+parseFloat(increment),maxValue),htmlElement.value=currentValue,currentValue=this.getModifiedValue(currentValue),currentValue=currentValue.toString(),this.setData(currentValue),valueChanged=!0,this.getSaveOnChange()&&this.onChange(this.getNodeID())},this.decrementValue=function(id,minValue,decrement){var htmlElement=simDocument().getElementById(id);currentValue=parseFloat(htmlElement.value),currentValue=Math.max(currentValue-parseFloat(decrement),minValue),htmlElement.value=currentValue,currentValue=this.getModifiedValue(currentValue),currentValue=currentValue.toString(),this.setData(currentValue),valueChanged=!0,this.getSaveOnChange()&&this.onChange(this.getNodeID())},this.inspect=function(embedded,forced){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(embedded)return buff.join("");!0===forced?dbg().debugf(buff.join("")):dbg().debug(buff.join(""))}},Simulator.Input.FieldSet.prototype=new Simulator.Input.InputElement,Simulator.Input.FieldSet.prototype.constructor=Simulator.Input.FieldSet,Simulator.Input.SimSlider=function(sim,node,panel,theSection,container){Simulator.Input.FieldSet.call(this,sim);var that=this,source="SimSlider",instance=this,HTMLId=null,textAreaId=null,sliderBackgroundImage="http://yui.yahooapis.com/2.9.0/build/slider/assets/bg-h.gif",sliderImage="Scripts/Simulator/renderer/images/slider_thumb.png",theSlider=null,setValues=[],orientation="horizontal",reportMovement=!1,startConstraint=0,endConstraint=210,dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simMgr=function(){return sim.getSimulationManager()},scoringTable=function(){return sim.getScoringTable()},keyboardInput=function(){return sim.getKeyboardInput()},simDocument=function(){return sim.getSimDocument()};sim&&(this.setPanel(panel),this.setSection(theSection)),this.setHTMLId=function(newHTMLId){HTMLId=newHTMLId},this.getHTMLId=function(){return HTMLId},this.setTextAreaId=function(newTextAreaId){textAreaId=newTextAreaId},this.getTextAreaId=function(){return textAreaId},this.getSetValues=function(){return setValues},this.setSetValues=function(newSetValues){return setValues=newSetValues,this},this.getSliderBackgroundImage=function(){return sliderBackgroundImage},this.setSliderBackgroundImage=function(newSliderBackgroundImage){return sliderBackgroundImage=newSliderBackgroundImage,this},this.getSliderImage=function(){return"Scripts/Simulator/renderer/images/slider_thumb.png"},this.setSliderImage=function(newSliderImage){return sliderImage=newSliderImage,this},this.getOrientation=function(){return orientation},this.setOrientation=function(newOrientation){return orientation=newOrientation,this},this.getReportMovement=function(){return reportMovement},this.setReportMovement=function(newReportMovement){return reportMovement="yes"==newReportMovement,this},this.handleEvent=function(event){switch(event.type){case"inputReq":this.recordInput(this);break;case"info":switch(event.context){case"sliderValue":this.setData(this.getModifiedValue(event.data.toString())),this.onChange(this.getNodeID())}default:return void dbg().logWarning(source,"Unhandled event type received: "+event.toString())}},this.keyboardNavigateTo=function(elementID,itemID,index){if(this.getTextAreaId()){var element=simDocument().getElementById(this.getTextAreaId());if(element){var className=element.getAttribute("class");className+=" simAreaFocus",element.setAttribute("class",className),element.focus()}}},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){if(this.getTextAreaId()){var element=simDocument().getElementById(this.getTextAreaId());if(element){var className=element.getAttribute("class");(index=className.indexOf("simAreaFocus"))>0&&(className=className.substring(0,index-1)),element.setAttribute("class",className),element.blur()}}},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){if(this.getTextAreaId()&&null!=theSlider){var element=simDocument().getElementById(this.getTextAreaId());if(element){var currentValue=element.value;if(!isNaN(currentValue)){var actualValue=theSlider.jsSlider.getMinValue()-0;theSlider.setValue(actualValue+currentValue/theSlider.scaleFactor),RecordChange(theSlider)}element.blur()}}},this.disableInput=function(){simDocument().getElementById(this.getNodeID()+"sliderHolder").disabled=!0,simDocument().getElementById(this.getNodeID()+"slider-value").disabled=!0,this.setState("disabled"),this.mySlider&&this.mySlider.lock()},this.enableInput=function(){simDocument().getElementById(this.getNodeID()+"sliderHolder").disabled=!1,simDocument().getElementById(this.getNodeID()+"slider-value").disabled=!1,this.setState("enabled"),this.mySlider&&this.mySlider.unlock()},this.render=function(){var panelHtml=container,labelledByID=this.getSectionID(),holderDiv=simDocument().createElement("div");holderDiv.id=this.getNodeID()+"sliderHolder","horizontal"==this.getOrientation()?holderDiv.setAttribute("class","slider sliderHorizontal"):holderDiv.setAttribute("class","slider sliderVertical"),holderDiv.setAttribute("role","group"),"horizontal"===theSection.getSectionSettings().elementorientation&&holderDiv.classList.add("inputpanelcell");var label="";if(sim.getSpeechEnabled()){if(!(label=this.getSpeechLabel()))if(label=this.getLabel()){if(label=Section.GetCurrentSectionLabel())return void dbg().logFatalError(source,"Item is speech enabled but no speechLabel, element label, or enclosing section label is specified for "+this.getName());label=Simulator.Constants.SPEECH_LABEL_PREFIX+label}else label=Simulator.Constants.SPEECH_LABEL_PREFIX+label}else(label=this.getLabel())?label+=":":label=" ";var labelElem=simDocument().createElement("span");if(labelElem.innerHTML=label,this.getLabel()){var labelID=this.createLabelID();labelElem.id=labelID,labelledByID=labelledByID+" "+labelID,labelElem.setAttribute("aria-label",this.getLabel())}var txtAreaDiv=simDocument().createElement("div");txtAreaDiv.setAttribute("class","slider-label-area");var txtAreaInput=simDocument().createElement("input");txtAreaInput.id=this.getNodeID()+"slider-value",this.txtAreaId=txtAreaInput.id,this.setTextAreaId(txtAreaInput.id),txtAreaInput.type="text",txtAreaInput.size=utils().getNumberLength(this.getMaxValue()),txtAreaInput.maxlength=txtAreaInput.size,txtAreaInput.autocomplete="off",txtAreaInput.value=this.getDefaultValue(),txtAreaInput.setAttribute("class","slider-text-area"),txtAreaInput.setAttribute("aria-labelledby",labelledByID),utils().bindEvent(txtAreaInput,"change",function(){var currentValue=txtAreaInput.value;if(!isNaN(currentValue)){var actualValue=theSlider.jsSlider.getMinValue()-0;theSlider.setValue(actualValue+Math.round(currentValue/theSlider.scaleFactor)),RecordChange(theSlider)}}),utils().bindEvent(txtAreaInput,"keypress",function(event){if(13==event.keyCode){var currentValue=txtAreaInput.value;if(!isNaN(currentValue)){var actualValue=theSlider.jsSlider.getMinValue()-0;theSlider.setValue(actualValue+Math.round(currentValue/theSlider.scaleFactor)),RecordChange(theSlider)}}else that.onKeyPressHandler(event)||(event.preventDefault?event.preventDefault():event.returnValue=!1)});var txtAreaUM=null;if(this.getUnits()){(txtAreaUM=simDocument().createElement("label")).setAttribute("for",txtAreaInput.id),txtAreaUM.innerHTML=this.getUnits();var unitsID=this.createUnitsID();txtAreaUM.id=unitsID,txtAreaInput.setAttribute("aria-describedby",unitsID)}this.isFocusable()&&keyboardInput().addFocusableElementItem(this,this.getNodeID(),txtAreaInput.id);var minMaxDiv=simDocument().createElement("div");minMaxDiv.setAttribute("class","slider-min-max");var minValSpan=simDocument().createElement("span");minMaxDiv.appendChild(minValSpan),minValSpan.innerHTML=this.getMinValue()+"  ",minValSpan.setAttribute("class","yui-slider-min"),minValSpan.setAttribute("role","presentation");var maxValSpan=simDocument().createElement("span");minMaxDiv.appendChild(maxValSpan),maxValSpan.setAttribute("class","yui-slider-max"),maxValSpan.setAttribute("role","presentation"),maxValSpan.innerHTML="  "+this.getMaxValue();var image=this.getImage(),imageDiv=null;if(null!=image&&void 0!=image){(imageDiv=simDocument().createElement("div")).setAttribute("class","slider withImages"),imageDiv.setAttribute("id",this.getName());var imageHolder=simDocument().createElement("span");imageHolder.setAttribute("class","holderImage");var imageElement=simDocument().createElement("img");imageElement.setAttribute("src",image),imageHolder.appendChild(imageElement),imageDiv.appendChild(imageHolder)}var bgDivId=this.getNodeID()+"DivBG",sliderDiv=simDocument().createElement("div");sliderDiv.id=bgDivId,sliderDiv.setAttribute("class","yui-h-slider"),sliderDiv.tabindex="-1",sliderDiv.title="Slider",this.setHTMLId(sliderDiv.id);var sliderThumbDiv=simDocument().createElement("div"),thumbDivId=this.getNodeID()+"ThumbDiv";sliderThumbDiv.id=thumbDivId,sliderThumbDiv.setAttribute("class","yui-slider-thumb"),sliderThumbDiv.setAttribute("class","yui-slider-thumb"),sliderThumbDiv.setAttribute("aria-labelledby",labelledByID),sliderThumbDiv.setAttribute("aria-valuenow",this.getDefaultValue()),sliderThumbDiv.setAttribute("aria-valuemax",this.getMaxValue()),sliderThumbDiv.setAttribute("aria-valuemin",this.getMinValue()),sliderThumbDiv.setAttribute("role","slider"),sliderThumbDiv.setAttribute("tabindex",0),panelHtml.appendChild(holderDiv),txtAreaDiv.appendChild(labelElem),txtAreaDiv.appendChild(txtAreaInput),txtAreaUM&&txtAreaDiv.appendChild(txtAreaUM),sliderDiv.appendChild(sliderThumbDiv),holderDiv.appendChild(txtAreaDiv),holderDiv.appendChild(minMaxDiv),holderDiv.appendChild(sliderDiv),null!=imageDiv&&holderDiv.appendChild(imageDiv),this.sliderDiv=sliderDiv.id,this.sliderThumbDiv=sliderThumbDiv.id,this.startConstraint=startConstraint,this.endConstraint=endConstraint,this.sliderDivId=sliderDiv.id,this.sliderThumbDivId=sliderThumbDiv.id,sim.getSliderPreRenderQueue().add(this),this.recordInput(this,!0),this.setPrevValue(this.getDefaultValue()),this.mapHTML2JS(holderDiv)},this.onKeyPressHandler=function(event){var char=null;if(null==event.which)char=String.fromCharCode(event.keyCode);else{if(0==event.which||0==event.charCode)return!0;char=String.fromCharCode(event.which)}return!!char.match(/[0-9]/)},this.getHTMLElement=function(id){return simDocument().getElementById(this.getNodeID()+"DivBG")},this.getHTMLSlider=function(){return theSlider},this.setFocusable(!0,!0),this.postContainerRender=function(){var inc=this.getIncrement(),scaleFactor=(this.getMaxValue()-this.getMinValue())/endConstraint;inc/=scaleFactor,this.scaleFactor=scaleFactor,theSlider="horizontal"==this.getOrientation()?YAHOO.widget.Slider.getHorizSlider(this.sliderDivId,this.sliderThumbDivId,startConstraint,endConstraint,inc):YAHOO.widget.Slider.getVertSlider(this.sliderDivId,this.sliderThumbDivId,startConstraint,endConstraint,inc),this.mySlider=theSlider,this.prevValue=this.getDefaultValue(),theSlider.keyIncrement=inc,theSlider.setValue(Math.abs(this.getDefaultValue()-this.getMinValue())/scaleFactor,!1,!0,!0),theSlider.valTxtField=this.txtAreaInput,theSlider.jsSlider=this,theSlider.scaleFactor=this.scaleFactor,theSlider.subscribe("change",function(){RecordChange(theSlider)}),theSlider.subscribe("slideEnd",function(){SliderEnd(theSlider)}),theSlider.animate=!1;var id=this.txtAreaId;simDocument().getElementById(id).value=this.getDefaultValue()},this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.SimSlider.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"orientation":this.setOrientation(attr[i]);break;case"sliderBackgroundImage":this.setSliderBackgroundImage(attr[i]);break;case"sliderImage":this.setSliderImage(attr[i]);break;case"imagePath":this.setSliderImagePath(attr[i]);break;case"multModifier":this.setMultModifier(attr[i]);break;case"addModifier":this.setAddModifier(attr[i]);break;case"valueModifier":this.setValueModifier(attr[i]);break;case"reportMovement":this.setReportMovement(attr[i])}this.getScoreable()&&scoringTable().addElement(this.getName(),"input")},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")};var SSFixRoundError=function(val,inc){if(inc){var rem=val%inc;rem&&(val+=inc-rem)}return val},RecordChange=function(slider){var jsSlider=slider.jsSlider,actualValue=Math.round(slider.getValue());(actualValue*=slider.scaleFactor)<0&&(actualValue=0);var offset=jsSlider.getMinValue()-0;actualValue=SSFixRoundError(actualValue+=offset,jsSlider.getIncrement());var id=jsSlider.txtAreaId;simDocument().getElementById(id).value=actualValue,simDocument().getElementById(jsSlider.sliderThumbDivId).setAttribute("aria-valuenow",actualValue),jsSlider.getReportMovement()&&(jsSlider.setData(actualValue),jsSlider.recordInput(jsSlider),instance.onChange(jsSlider.getNodeID()))},SliderEnd=function(slider){var jsSlider=slider.jsSlider,actualValue=Math.round(slider.getValue()*slider.scaleFactor);actualValue<0&&(actualValue=0);var offset=slider.jsSlider.getMinValue()-0;actualValue=SSFixRoundError(actualValue+=offset,jsSlider.getIncrement());var id=jsSlider.txtAreaId;simDocument().getElementById(id).value=actualValue,jsSlider.prevValue!=actualValue&&(jsSlider.setData(jsSlider.getModifiedValue(actualValue)+""),jsSlider.recordInput(jsSlider),instance.onChange(jsSlider.getNodeID()),jsSlider.prevValue=actualValue)};this.setElementSelectState=function(state,contents){var value=parseFloat(contents);value>=this.getMinValue()&&value<=this.getMaxValue()&&value%this.getIncrement()==0&&(this.setData(contents),this.setDefaultValue(contents),setHTMLValue(this.getNodeID(),this.getData()),this.recordInput(this,!0))};var setHTMLValue=function(id,value){var htmlElement=simDocument().getElementById(id);if(htmlElement||(htmlElement=simDocument().getElementById(id+"slider-value")),htmlElement&&(htmlElement.value=value),!isNaN(value)){var actualValue=theSlider.jsSlider.getMinValue()-0;theSlider.setValue(actualValue+Math.round(value/theSlider.scaleFactor)),RecordChange(theSlider)}},debug=function(str1,str2,trace){dbg().debug(source,str1,str2,trace)},debugf=function(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}},Simulator.Input.SimSlider.prototype=new Simulator.Input.FieldSet,Simulator.Input.SimSlider.parent=Simulator.Input.FieldSet,Simulator.Input.SimSlider.prototype.constructor=Simulator.Input.SimSlider,Simulator.Input.TextField=function(sim,node,panel,theSection,container){Simulator.Input.InputElement.call(this,sim);var that=this,source="TextField",userEditable=!0,prevStyle={},displayLabel=!0,text="",typeInputAllowed="textOnly",fieldLength=7,textCache="",dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},eventMgr=function(){return sim.getEventManager()},simDocument=function(){return sim.getSimDocument()},keyboardInput=function(){return sim.getKeyboardInput()},transDictionary=function(){return sim.getTranslationDictionary()},scoringTable=function(){return sim.getScoringTable()};sim&&(this.setPanel(panel),this.setSection(theSection)),eventMgr().registerEvent(new Simulator.Event(this,"info","animationThreadFinished"),"to"),this.getUserEditable=function(){return userEditable},this.setUserEditable=function(newUserEditable){return userEditable="yes"==newUserEditable,this},this.getDisplayLabel=function(){return displayLabel},this.setDisplayLabel=function(newDisplayLabel){return displayLabel="yes"==newDisplayLabel,this},this.getText=function(){return transDictionary().translate(text)},this.setText=function(newText){return text=newText,this.setData(newText),this},this.setTypeInputAllowed=function(typeInput){typeInputAllowed=typeInput},this.getTypeInputAllowed=function(){return typeInputAllowed},this.getFieldLength=function(){return fieldLength},this.setFieldLength=function(newLength){return fieldLength=parseInt(newLength),this},this.saveState=function(indent,preface,nameStr,valStr,suffix){var data=this.getData();return""!=data?indent+preface+nameStr+this.getName()+valStr+data+suffix:""},this.setElementSelectState=function(state,contents){this.setData(contents),this.recordInput(this,!0)},this.disableInput=function(){simDocument().getElementById(this.getNodeID()).disabled=!0,this.setState("disabled")},this.enableInput=function(){simDocument().getElementById(this.getNodeID()).disabled=!1,this.setState("enabled")},this.setTextCache=function(cacheText){textCache=cacheText},this.handleEvent=function(event){switch(event.type){case"inputReq":this.recordInput(this);break;case"info":switch(event.context){case"simulatorStateChange":break;case"animationThreadFinished":this.setData(textCache),this.recordInput(),textCache=""}break;default:return void dbg().logWarning(source,"Unhandled event type received: "+event.toString())}},this.keyboardNavigateTo=function(elementID,itemID,index){var element=simDocument().getElementById(elementID);element&&(prevStyle.color=element.style.borderColor,prevStyle.width=element.style.borderWidth,prevStyle.style=element.style.borderStyle,element.style.borderStyle="solid",element.style.borderWidth="2px",element.style.borderColor="#FF9100"),element.focus()},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){var element=simDocument().getElementById(elementID);element&&(element.style.borderStyle=prevStyle.style,element.style.borderWidth=prevStyle.width,element.style.borderColor=prevStyle.color,element.blur())},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){var element=null;(element=simDocument().getElementById(elementID))&&(element.style.borderStyle=prevStyle.style,element.style.borderWidth=prevStyle.width,element.style.borderColor=prevStyle.color,element.isSelected=!0,this.setSelectStateViaKeyboard(elementID,itemID),this.onChange(elementID),element.blur())},this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.TextField.prototype.setAttributes.call(this,attr,node);for(var i in attr)try{switch(i){case"initialText":this.setText(attr[i]);break;case"userEditable":this.setUserEditable(attr[i]);break;case"displayLabel":this.setDisplayLabel(attr[i]);break;case"fieldLength":this.setFieldLength(attr[i]);break;case"typeInputAllowed":this.setTypeInputAllowed(attr[i])}}catch(err){dbg().logError(source,"Error occurred getting TextField attribute "+i+": "+err.message)}this.getScoreable()&&sim.getScoringTable().addElement(this.getName(),"input")},this.render=function(){var nodeID=this.getNodeID(),panelHtml=container,brElement1=simDocument().createElement("br");panelHtml.appendChild(brElement1);var brElement2=simDocument().createElement("br");panelHtml.appendChild(brElement2);var divElement=simDocument().createElement("div");divElement.setAttribute("class","textFieldWrapper withImages");var image=this.getImage();if(null!=image&&void 0!=image){var spanElement1=simDocument().createElement("span");spanElement1.setAttribute("class","holderImage");var imgElement=simDocument().createElement("img");imgElement.setAttribute("src",image),imgElement.setAttribute("alt",this.getName()),spanElement1.appendChild(imgElement),divElement.appendChild(spanElement1)}var spanElement2=simDocument().createElement("span");spanElement2.setAttribute("class","textFieldContainer"),spanElement2.innerHTML=this.getLabel();var inputEl=simDocument().createElement("input");inputEl.setAttribute("type","text"),inputEl.id=nodeID,inputEl.setAttribute("value",this.getText()),inputEl.onkeydown="return false;",utils().bindEvent(inputEl,"keypress",function(event){that.onKeyPressHandler(nodeID,event)||(event.preventDefault?event.preventDefault():event.returnValue=!1)}),utils().bindEvent(inputEl,"change",function(){that.changeInValue(nodeID)}),inputEl.setAttribute("size",this.getFieldLength()),inputEl.setAttribute("maxlength",this.getFieldLength()),spanElement2.appendChild(inputEl),divElement.appendChild(spanElement2),"horizontal"===theSection.getSectionSettings().elementorientation&&divElement.classList.add("inputpanelcell"),panelHtml.appendChild(divElement),this.recordInput(this,!0),this.setFocusable(!0,!0),this.isFocusable()&&keyboardInput().addFocusableElementItem(this,nodeID),this.mapHTML2JS(divElement)},this.changeInValue=function(id){if(id){var htmlElement=simDocument().getElementById(id);this.setData(htmlElement.value),this.recordInput(),eventMgr().postEvent(new Simulator.Event(this,"info","inputAvailable",null,!1))}};var numLockKeyCode=144,numLockPressed=!1;this.onKeyPressHandler=function(id,event){var char=null;if(null==event.which)char=String.fromCharCode(event.keyCode);else{if(0==event.which||0==event.charCode)return!0;char=String.fromCharCode(event.which)}switch(this.getTypeInputAllowed()){case"alphaOnly":return!!char.match(/[a-z\.]/i);case"numericOnly":return!!char.match(/[0-9\.\+\-]/);case"alphaNumericOnly":return!!char.match(/[a-z0-9\.\+\-]/i);case"textOnly":default:return!0}},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")};var debug=function(str1,str2,trace){dbg().debug(source,str1,str2,trace)},debugf=function(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}},Simulator.Input.TextField.prototype=new Simulator.Input.InputElement,Simulator.Input.TextField.parent=Simulator.Input.InputElement,Simulator.Input.TextField.prototype.constructor=Simulator.Input.TextField,Simulator.Input.StaticElement=function(sim){Simulator.SimElement.call(this,sim);var panel=null,section=null;this.getPanel=function(){return panel},this.setPanel=function(newPanel){return panel=newPanel,this},this.setSection=function(theSection){section=theSection},this.saveState=function(indent,preface,nameStr,valStr,suffix){return indent+preface+nameStr+this.getName()+valStr+checkedItems+suffix}},Simulator.Input.StaticElement.prototype=new Simulator.SimElement,Simulator.Input.StaticElement.parent=Simulator.SimElement,Simulator.Input.StaticElement.prototype.constructor=Simulator.Input.StaticElement,Simulator.Input.VerticalSpace=function(sim,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.StaticElement.call(this,sim);var source="VerticalSpace",lines=0,dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};sim&&(this.setPanel(panel),this.setSection(theSection)),this.setLines=function(newLines){lines=parseInt(newLines)},this.getLines=function(){return lines},this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.VerticalSpace.prototype.setAttributes(attr);for(var i in attr)switch(i){case"lines":this.setLines(attr[i])}},this.render=function(){var panelHtml=container,divElement=simDocument().createElement("div");divElement.style.paddingBottom=20*this.getLines()+"px",panelHtml.appendChild(divElement),this.setFocusable(!1),this.mapHTML2JS(divElement)},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}},Simulator.Input.VerticalSpace.prototype=new Simulator.Input.StaticElement,Simulator.Input.VerticalSpace.parent=Simulator.Input.StaticElement,Simulator.Input.VerticalSpace.prototype.constructor=Simulator.Input.VerticalSpace,Simulator.Input.HorizontalLine=function(sim,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.StaticElement.call(this,sim);var source="HorizontalLine",dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};sim&&(this.setPanel(panel),this.setSection(theSection));var height=0;this.setHeight=function(newHeight){height=parseInt(newHeight)},this.getHeight=function(){return height};var width=1;this.setWidth=function(newWidth){width=parseInt(newWidth)},this.getWidth=function(){return width};var alignment="absolute";this.setAlignment=function(newAlignment){alignment=newAlignment},this.getAlignment=function(){return alignment};var distance=0;this.setDistance=function(newDistance){distance=newDistance},this.getDistance=function(){return distance};var ownSpace=!0;this.setOwnSpace=function(newOwnSpace){ownSpace="yes"==newOwnSpace},this.getOwnSpace=function(){return ownSpace},this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.HorizontalLine.prototype.setAttributes(attr);for(var i in attr)switch(i){case"name":this.setName(attr[i]);break;case"width":this.setWidth(attr[i]);break;case"height":this.setHeight(attr[i]);break;case"alignment":this.setAlignment(attr[i]);break;case"distance":this.setDistance(attr[i]);break;case"ownSpace":this.setOwnSpace(attr[i])}},this.render=function(){var panelHtml=container;spanElement=simDocument().createElement("span"),spanElement.id="horizontalLine","left"==this.getAlignment()?(spanElement.setAttribute("class","sim_divider sim_divider_left"),null!=this.getDistance()&&(spanElement.style.marginLeft=this.getDistance()+"px")):"right"==this.getAlignment()?(spanElement.setAttribute("class","sim_divider sim_divider_right"),null!=this.getDistance()&&(spanElement.style.marginRight=this.getDistance()+"px")):spanElement.setAttribute("class","sim_divider sim_divider_center"),null!=this.getWidth()&&(spanElement.style.width=this.getWidth()+"px"),null!=this.getHeight()&&(spanElement.style.height=this.getHeight()+"px"),this.getOwnSpace()&&(spanElement.style.clear="both"),panelHtml.appendChild(spanElement),this.setFocusable(!1),this.mapHTML2JS(spanElement)},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null==force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}},Simulator.Input.HorizontalLine.prototype=new Simulator.Input.StaticElement,Simulator.Input.HorizontalLine.parent=Simulator.Input.StaticElement,Simulator.Input.HorizontalLine.prototype.constructor=Simulator.Input.HorizontalLine,Simulator.Input.SectionDivider=function(sim,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.StaticElement.call(this,sim);var source="SectionDivider",dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};sim&&(this.setPanel(panel),this.setSection(theSection)),this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.SectionDivider.prototype.setAttributes(attr);for(var i in attr)switch(i){case"name":this.setName(attr[i])}},this.render=function(){var panelHtml=container;divElement=simDocument().createElement("div"),divElement.id="hrHolder",divElement.setAttribute("class","hrHolder");var hrElement=simDocument().createElement("hr");divElement.appendChild(hrElement),panelHtml.appendChild(divElement),this.setFocusable(!1),this.mapHTML2JS(divElement)},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null==force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}},Simulator.Input.SectionDivider.prototype=new Simulator.Input.StaticElement,Simulator.Input.SectionDivider.parent=Simulator.Input.StaticElement,Simulator.Input.SectionDivider.prototype.constructor=Simulator.Input.SectionDivider,Simulator.Input.UpDownCounter=function(sim,node,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.FieldSet.call(this,sim);var that=this,source="UpDownCounter",setValues=[],interButtonDelay=!0,interButtonDelay=!0,setValues=[],actOnChangeWithMouseout=!1,dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()},scoringTable=function(){return sim.getScoringTable()},keyboardInput=function(){return sim.getKeyboardInput()};sim&&(this.setPanel(panel),this.setSection(theSection)),this.getSetValues=function(){return setValues},this.setsetValues=function(newsetValues){return setValues=newsetValues,this},this.setInterButtonDelay=function(newInterButtonDelay){return interButtonDelay=1==newInterButtonDelay||"yes"==newInterButtonDelay,this},this.getInterButtonDelay=function(){return interButtonDelay},this.handleEvent=function(event){switch(event.type){case"inputReq":this.recordInput(this);break;case"info":event.context;break;default:return void dbg().logWarning(source,"Unhandled event type received: "+event.toString())}},this.setActOnChangeWithMouseout=function(newActOnChangeWithMouseout){actOnChangeWithMouseout="yes"==newActOnChangeWithMouseout},this.getActOnChangeWithMouseout=function(){return actOnChangeWithMouseout},this.keyboardNavigateTo=function(elementID,itemID,index){var element=simDocument().getElementById(elementID),item=(element.getElementsByTagName("span")[0].getElementsByClassName("upDown")[0],element.getElementsByClassName(itemID)[0]);item&&item.setAttribute("class",itemID+" simAreaFocus")},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){var element=simDocument().getElementById(elementID),item=(element.getElementsByTagName("span")[0].getElementsByClassName("upDown")[0],element.getElementsByClassName(itemID)[0]);item&&item.setAttribute("class",itemID)},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){itemID&&elementID&&(0==itemIndex?this.incrementValue(this.getNodeID(),this.getMaxValue(),this.getIncrement()):1==itemIndex&&this.decrementValue(this.getNodeID(),this.getMinValue(),this.getIncrement()))},this.receivedSpeechFocus=function(){debug(this.getName()+" received speech focus"),simDocument().getElementById("incrementalWrapper"+this.getNodeID()).style.border="thin solid #ff0000"},this.removeSpeechFocus=function(value){debug(this.getName()+" lost speech focus");var node=simDocument().getElementById("incrementalWrapper"+this.getNodeID());prevBorders=node.borders,node.style.border="none"},this.disableInput=function(){var component=simDocument().getElementById("goingUp"+this.getNodeID());component.disabled=!0,(component=simDocument().getElementById("goingDown"+this.getNodeID())).disabled=!0},this.enableInput=function(){var component=simDocument().getElementById("goingUp"+this.getNodeID());component.disabled=!1,(component=simDocument().getElementById("goingDown"+this.getNodeID())).disabled=!1},this.speechActivated=function(value){1==value?this.incrementValue(this.getNodeID(),parseFloat(this.getMaxValue()),parseFloat(this.getIncrement())):-1==value&&this.decrementValue(this.getNodeID(),this.getMinValue(),this.getIncrement()),this.onChange(this.getNodeID())},this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.UpDownCounter.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"actOnChange":this.setActOnChange(attr[i]);break;case"actOnChangeWithMouseout":this.setActOnChangeWithMouseout(attr[i]);break;case"interButtonDelay":this.setInterButtonDelay(attr[i]);break;case"multModifier":this.setMultModifier(attr[i]);break;case"addModifier":this.setAddModifier(attr[i])}this.getScoreable()&&scoringTable().addElement(this.getName(),"input")},this.render=function(){var nodeID=this.getNodeID(),panelHtml=container,labelledByID=this.getSectionID();this.setFocusable(!0,!0);var nextNum=utils().getNextSequenceNumber(),image=this.getImage();this.getSpaceAbove()&&utils().appendBlankVertcalSpace(panelHtml,this.getSpaceAbove);var divElement=null;if(null!=image&&void 0!=image){(divElement=simDocument().createElement("div")).id="incrementalWrapper"+nodeID,divElement.setAttribute("class","incrementalWrapper withImages"),divElement.setAttribute("role","group");var spanElement=simDocument().createElement("span");spanElement.setAttribute("class","holderImage");var imageElement=simDocument().createElement("img");imageElement.setAttribute("src",image),imageElement.setAttribute("alt",this.getName()),spanElement.appendChild(imageElement),divElement.appendChild(spanElement)}else(divElement=simDocument().createElement("div")).id="incrementalWrapper"+nodeID,divElement.setAttribute("class","incrementalWrapper"),divElement.setAttribute("role","group"),sim.getSpeechEnabled()&&divElement.setAttribute("style","padding-bottom: 40px");var containerSpanElement=simDocument().createElement("span");containerSpanElement.setAttribute("class","incrementalContainer");var inputElement=simDocument().createElement("input");inputElement.id=nodeID,inputElement.setAttribute("readonly","readonly"),inputElement.setAttribute("name","number"+nodeID),inputElement.setAttribute("value",this.getDefaultValue()),inputElement.setAttribute("type","text"),containerSpanElement.appendChild(inputElement);var labelElement=simDocument().createElement("label");labelElement.setAttribute("for",nextNum),labelElement.innerHTML=this.getUnits(),containerSpanElement.appendChild(labelElement);var upDownSpanElement=simDocument().createElement("span");upDownSpanElement.setAttribute("class","upDown");var inputGoingUpElement=simDocument().createElement("input");if(inputGoingUpElement.id="goingUp"+nodeID,inputGoingUpElement.setAttribute("class","goingUp"),utils().bindEvent(inputGoingUpElement,"click",function(){that.incrementValue(nodeID,that.getMaxValue(),that.getIncrement())}),this.getActOnChangeWithMouseout()&&(utils().bindEvent(inputGoingUpElement,"mouseout",function(){that.PotentialChangeInValue(nodeID)}),this.getInterButtonDelay()&&utils().bindEvent(inputGoingUpElement,"mouseover",function(){that.CancelNoChange(nodeID)})),inputGoingUpElement.setAttribute("type","button"),inputGoingUpElement.setAttribute("title","increase count"),upDownSpanElement.appendChild(inputGoingUpElement),sim.getSpeechEnabled()){var textLabelElement1=simDocument().createTextNode(" Increment");upDownSpanElement.appendChild(textLabelElement1)}var inputGoingDownElement=simDocument().createElement("input");if(inputGoingDownElement.id="goingDown"+nodeID,inputGoingDownElement.setAttribute("class","goingDown"),utils().bindEvent(inputGoingDownElement,"click",function(){that.decrementValue(nodeID,that.getMinValue(),that.getIncrement())}),this.getActOnChangeWithMouseout()&&(utils().bindEvent(inputGoingDownElement,"mouseout",function(){that.PotentialChangeInValue(nodeID)}),this.getInterButtonDelay()&&utils().bindEvent(inputGoingDownElement,"mouseover",function(){that.CancelNoChange(nodeID)})),inputGoingDownElement.setAttribute("type","button"),inputGoingDownElement.setAttribute("title","decrease count"),upDownSpanElement.appendChild(inputGoingDownElement),sim.getSpeechEnabled()){var textLabelElement2=simDocument().createTextNode(" Decrement");upDownSpanElement.appendChild(textLabelElement2)}if(containerSpanElement.appendChild(upDownSpanElement),divElement.appendChild(containerSpanElement),"horizontal"===theSection.getSectionSettings().elementorientation&&divElement.classList.add("inputpanelcell"),panelHtml.appendChild(divElement),this.getLabel()){var h5LabelElement=simDocument().createElement("h5"),h5ID=this.createLabelID();h5LabelElement.id=h5ID,labelledByID=labelledByID+" "+h5ID,h5LabelElement.innerHTML=this.getLabel(),divElement.appendChild(h5LabelElement)}inputElement.setAttribute("aria-labelledby",labelledByID),inputGoingUpElement.setAttribute("aria-labelledby",labelledByID),inputGoingDownElement.setAttribute("aria-labelledby",labelledByID),inputGoingUpElement.setAttribute("aria-valuenow",this.getDefaultValue()),inputGoingUpElement.setAttribute("aria-valuemax",this.getMaxValue()),inputGoingUpElement.setAttribute("aria-valuemin",this.getMinValue()),inputGoingDownElement.setAttribute("aria-valuenow",this.getDefaultValue()),inputGoingDownElement.setAttribute("aria-valuemax",this.getMaxValue()),inputGoingDownElement.setAttribute("aria-valuemin",this.getMinValue()),this.isFocusable()&&(keyboardInput().addFocusableElementItem(this,divElement.id,"goingUp"),keyboardInput().addFocusableElementItem(this,divElement.id,"goingDown")),this.getSpaceBelow()&&utils().appendBlankVertcalSpace(panelHtml,this.getSpaceBelow()),this.recordInput(this,!0),this.setPrevValue(this.getDefaultValue()),this.mapHTML2JS(divElement)};var theCounterID=null,prevCounterID=null,movementInterval=50,t=null;this.PotentialChangeInValue=function(id){simDocument().getElementById(id);prevCounterID=null==theCounterID?id:theCounterID,theCounterID=id,this.getInterButtonDelay()?t=setTimeout(function(){that.ChangeInValue()},movementInterval):this.ChangeInValue()},this.CancelNoChange=function(){theCounterID==prevCounterID&&clearTimeout(t)},this.ChangeInValue=function(){if(theCounterID){var htmlElement=simDocument().getElementById(theCounterID);this.getPrevValue()!=htmlElement.value&&(this.setPrevValue(this.getData()),this.onChange(theCounterID)),theCounterID=null}},this.incrementValue=function(id,maxValue,increment){var htmlElement=simDocument().getElementById(id),upElement=htmlElement.parentNode.getElementsByTagName("span")[0].getElementsByClassName("goingUp")[0],downElement=htmlElement.parentNode.getElementsByTagName("span")[0].getElementsByClassName("goingDown")[0];currentValue=parseFloat(htmlElement.value),currentValue+parseFloat(increment)<=maxValue&&(currentValue=parseFloat((currentValue+parseFloat(increment)).toFixed(10))),htmlElement.value=currentValue,currentValue=this.getModifiedValue(currentValue),currentValue=currentValue.toString(),upElement.setAttribute("aria-valuenow",currentValue),downElement.setAttribute("aria-valuenow",currentValue),this.setData(currentValue),valueChanged=!0,this.getSaveOnChange()&&this.onChange(this.getNodeID())},this.decrementValue=function(id,minValue,decrement){var htmlElement=simDocument().getElementById(id),upElement=htmlElement.parentNode.getElementsByTagName("span")[0].getElementsByClassName("goingUp")[0],downElement=htmlElement.parentNode.getElementsByTagName("span")[0].getElementsByClassName("goingDown")[0];currentValue=parseFloat(htmlElement.value),currentValue-parseFloat(decrement)>=minValue&&(currentValue=parseFloat((currentValue-parseFloat(decrement)).toFixed(10))),htmlElement.value=currentValue,currentValue=this.getModifiedValue(currentValue),currentValue=currentValue.toString(),upElement.setAttribute("aria-valuenow",currentValue),downElement.setAttribute("aria-valuenow",currentValue),this.setData(currentValue),valueChanged=!0,this.getSaveOnChange()&&this.onChange(this.getNodeID())},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}},Simulator.Input.UpDownCounter.prototype=new Simulator.Input.FieldSet,Simulator.Input.UpDownCounter.parent=Simulator.Input.FieldSet,Simulator.Input.UpDownCounter.prototype.constructor=Simulator.Input.UpDownCounter,Simulator.Input.TextConstant=function(sim,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.StaticElement.call(this,sim);var source="TextConstant",dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()};sim&&(this.setPanel(panel),this.setSection(theSection));var text="",heavy=!1;this.setText=function(newText){text=newText},this.getText=function(){return transDictionary().translate(text)},this.setHeavy=function(newHeavy){heavy="yes"==newHeavy},this.getHeavy=function(){return heavy},this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.TextConstant.prototype.setAttributes(attr);for(var i in attr)switch(i){case"text":this.setText(attr[i]);break;case"heavy":this.setHeavy(attr[i])}},this.render=function(){var panelHtml=container,divElement=simDocument().createElement("div");this.getSpaceAbove()>0&&utils().appendBlankVertcalSpace(divElement,this.getSpaceAbove()),"horizontal"===theSection.getSectionSettings().elementorientation&&divElement.classList.add("inputpanelcell"),panelHtml.appendChild(divElement),this.getHeavy()?divElement.innerHTML="<b>"+this.getText()+"</b>":divElement.innerHTML=this.getText(),this.getSpaceBelow()>0&&utils().appendBlankVertcalSpace(divElement,this.getSpaceBelow()),this.setFocusable(!1),this.mapHTML2JS(divElement)},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";buff.push("Inspecting TextElement"),buff.push(sep);for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}},Simulator.Input.TextConstant.prototype=new Simulator.Input.StaticElement,Simulator.Input.TextConstant.parent=Simulator.Input.StaticElement,Simulator.Input.TextConstant.prototype.constructor=Simulator.Input.TextConstant,Simulator.Input.ImageElement=function(sim,panel,theSection,container){function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Input.StaticElement.call(this,sim);var source="ImageElement",simID=null,dbg=function(){return sim.getDebug()},utils=function(){return sim.getUtils()},simDocument=function(){return sim.getSimDocument()};sim&&(simID=sim.getSimID()),this.setAttributes=function(attr,node){node&&(attr=utils().getAttributes(node)),Simulator.Input.ImageElement.prototype.setAttributes(attr);for(var i in attr)switch(i){case"name":this.setName(attr[i]);break;case"image":this.setImage(attr[i]);break;case"type":this.setType(attr[i])}},this.render=function(){var inputPanel=container;div=simDocument().createElement("div"),div.id="imageHolder"+simID,"horizontal"===theSection.getSectionSettings().elementorientation&&div.classList.add("inputpanelcell"),inputPanel.appendChild(div);var span=simDocument().createElement("span");span.id="holdingSpan"+simID,div.appendChild(span);var img=simDocument().createElement("img");img.id=this.getEname()+sim.getSimID(),img.src=this.getImage(),span.appendChild(img),this.setFocusable(!1),this.mapHTML2JS(div)},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n";embedded||(buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep));for(var i in this)"get"==i.substr(0,3)&&(buff.push(i),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")}},Simulator.Input.ImageElement.prototype=new Simulator.Input.StaticElement,Simulator.Input.ImageElement.parent=Simulator.Input.StaticElement,Simulator.Input.ImageElement.prototype.constructor=Simulator.Input.ImageElement,Simulator.Control.CommandElement=function(sim){Simulator.SimElement.call(this,sim);var source="CommandElement",parent=Simulator.SimElement.prototype,cmdElementImages=["image_Trashcan"],handler=null,state="enabled",handlerParameters="",alwaysEnabled=!1,eventsRegistered=!1,panel=null,util=function(){return sim.getUtils()},simMgr=function(){return sim.getSimulationManager()},eventMgr=function(){return sim.getEventManager()},dbg=function(){return sim.getDebug()},simDocument=function(){return sim.getSimDocument()},registerClassEvents=function(instance){eventsRegistered||(eventMgr().registerEvent(new Simulator.Event(instance,"info","simulatorStateChange")),eventsRegistered=!0)};this.setEname(source),this.isAPredefinedCmdElementImage=function(imageName){return util().elementInArray(cmdElementImages,imageName)},this.getState=function(){return state},this.setState=function(newState){return simMgr().isPlaying()||simMgr().isReadOnly()?state="disabled":"disabled"==newState?state=this.getAlwaysEnabled()?"enabled":newState:"enabled"==newState?state=newState:dbg().logFatalError(source,"Invalid state passed to CommandElement.setState()"),this},this.keyboardNavigateTo=function(elementID,itemID,index){var element=simDocument().getElementById(elementID);element&&element.setAttribute("class",element.getAttribute("class")+" simAreaFocus")},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){var element=simDocument().getElementById(elementID);if(element){var className=element.getAttribute("class");(index=className.indexOf("simAreaFocus"))>0&&(className=className.substring(0,index-1)),element.setAttribute("class",className)}},this.getHandler=function(){return handler},this.setHandler=function(newHandler){return handler=newHandler,this},this.getHandlerParameters=function(){return handlerParameters},this.setHandlerParameters=function(newHandlerParameters){return handlerParameters=newHandlerParameters,this},this.setPredefinedImage=function(newImage){this.setImage(newImage)},this.getAlwaysEnabled=function(){return alwaysEnabled},this.setAlwaysEnabled=function(newAlwaysEnabled){return alwaysEnabled="yes"==newAlwaysEnabled,this},this.isDisabled=function(){return"disabled"==state},this.setPanel=function(thePanel){return(panel=thePanel).registerIOElement(this),this},this.saveState=function(indent,preface,nameStr,valStr,suffix){return""},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n";buff.push("Inspecting "+source+sep);var str=Simulator.Control.CommandElement.prototype.inspect.call(this,!0,force);if(str)return str;for(var i in this)"get"==i.substr(0,3)&&(buff.push(i.charAt(3).toLowerCase()+i.slice(4)),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(buff.push("End Inspecting "+source+sep+sep),embedded)return buff.join("");1==force?dbg().debugf(source,buff.join("")):dbg().debug(source,buff.join(""))},this.setAttributes=function(attr,node){Simulator.Control.CommandElement.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"predefinedImage":this.setPredefinedImage(attr[i]);break;case"handler":this.setHandler(attr[i]);break;case"handlerParameters":this.setHandlerParameters(attr[i]);break;case"alwaysEnabled":this.setAlwaysEnabled(attr[i]);break;case"speechLabel":this.setSpeechLabel(attr[i])}},sim&&registerClassEvents(this)},Simulator.Control.CommandElement.prototype=new Simulator.SimElement,Simulator.Control.CommandElement.parent=Simulator.SimElement,Simulator.Control.CommandElement.prototype.constructor=Simulator.Control.CommandElement,Simulator.Control.Button=function(sim,panel,section,container){function resetButton(buttonName){switch(buttonName){case"generic":genericButtonReady=!0;break;case"startTrial":startTrialButtonReady=!0;break;case"startAnimation":startAnimationButtonReady=!0;break;case"resetTrials":resetTrialsButtonReady=!0;break;case"newTrial":newTrialButtonReady=!0;break;case"submitInput":submitInputButtonReady=!0;break;case"submitItem":submitItemButtonReady=!0;break;case"requestAnimationOutput":requestAnimationOutputButtonReady=!0;break;case"showDialog":showDialogButtonReady=!0;break;case"showAlert":showAlertButtonReady=!0;break;case"speechLabel":this.setSpeechLabel(attr[i])}}function publishEvents(jsButton,context){var anEvent=jsButton.nextEvent(!0);for(context||(context="*");null!=anEvent;)anEvent.context!=context&&"*"!=anEvent.context&&"*"!=context||eventMgr().postEvent(anEvent),anEvent=jsButton.nextEvent()}function onClick(id){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()?1!=genericButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,genericButtonReady=!1,setTimeout(function(){resetButton("generic")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():publishEvents(jsButton)):dbg().logWarning(source,"-- Button with id = "+id+" could not be activated --")}else dbg().logFatalError(source,"Could not get Button instance with id = "+id)}function StartTrial(id){if(!simMgr().verifyCheckListSelection()){var newTime=new Date,debounceMultiplier=sim.animationIsPresent()?4:.5,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=startTrialButtonReady||simMgr().isPlaying()||simMgr().isReadOnly()||(lastStartTrialTime=newTime,startTrialButtonReady=!1,whiteboard().clearCategory("evaluationOutput"),whiteboard().clearCategory("animationOutput"),setTimeout(function(){resetButton("startTrial")},debouceInterval*debounceMultiplier),publishEvents(jsButton,"startTrial")))}else dbg().logFatalError(source,"Could not get Button instance with id = "+id)}}function StartAnimation(id){if(!simMgr().verifyCheckListSelection()){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=startAnimationButtonReady||simMgr().isPlaying()||simMgr().isReadOnly()||(lastStartTrialTime=newTime,startAnimationButtonReady=!1,whiteboard().clearCategory("evaluationOutput"),whiteboard().clearCategory("animationOutput"),setTimeout(function(){resetButton("startAnimation")},4*debouceInterval),publishEvents(jsButton,"startAnimation")))}else dbg().logFatalError(source,"Could not get Button instance with id = "+id)}}function NewTrial(id){if(!simMgr().verifyCheckListSelection()){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=newTrialButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,newTrialButtonReady=!1,setTimeout(function(){resetButton("newTrial")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():simMgr().NexTrial()))}}}function SubmitInput(id){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=submitInputButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,submitInputButtonReady=!1,setTimeout(function(){resetButton("submitInput")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():publishEvents(jsButton,"submitInput")))}}function SubmitItem(id){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=submitItemButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,submitItemButtonReady=!1,setTimeout(function(){resetButton("submitItem")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():confirm("Are You Sure You Want to Submit the Item for Scoring")&&(simMgr().ScoreItem(),Simulator.showAlert("Question",'Press "Next" for Next Test Item'),simMgr().GetNextItem())))}}function RequestAnimationOutput(id){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=requestAnimationOutputButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,requestAnimationOutputButtonReady=!1,setTimeout(function(){resetButton("requestAnimationOutput")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():eventMgr().postEvent(new Simulator.Event(jsButton,"command","outputReq"))))}}function ShowDialog(id,dialogID){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"==jsButton.getState()&&(1!=showDialogButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,showDialogButtonReady=!1,setTimeout(function(){resetButton("showDialog")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():dialogID.style.display=""))}}function ShowAlert(id,parameters){var transParameters=transDictionary().translate(parameters),newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);if("enabled"==jsButton.getState()&&1==showAlertButtonReady&&!simMgr().isPlaying()&&newTime-lastStartTrialTime>debouceInterval)if(lastStartTrialTime=newTime,showAlertButtonReady=!1,setTimeout(function(){resetButton("showAlert")},debouceInterval),jsButton.isDisabled())simMgr().GetDisabledAction()();else if(transParameters){for(var parts=transParameters.split("|"),elements=[],aParameter=null,i=0;i<parts.length;i++)elements[(aParameter=parts[i].split("*"))[0]]=aParameter[1];if("contents"in elements){unescape(elements.contents);Simulator.showAlertWarning(unescape(elements.contents))}}}}function ResetTrials(id){var newTime=new Date,theButton=simDocument().getElementById(id);if(theButton){var jsButton=html2jsMap().getJSFromHTML(theButton);"enabled"!=jsButton.getState()||simMgr().isReadOnly()||1!=resetTrialsButtonReady||simMgr().isPlaying()||newTime-lastStartTrialTime>debouceInterval&&(lastStartTrialTime=newTime,resetTrialsButtonReady=!1,setTimeout(function(){resetButton("resetTrials")},debouceInterval),jsButton.isDisabled()?simMgr().GetDisabledAction()():(publishEvents(jsButton,"resetTrials"),simMgr().setReadyState(),scoringTable().clearTable()))}}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Control.CommandElement.call(this,sim);var source="Button",instance=this,HTMLButton=null,src="",implication="neutral",borderColor="",eventsRegistered=!1,debouceInterval=1e3,lastStartTrialTime=0,genericButtonReady=!0,startTrialButtonReady=!0,startAnimationButtonReady=!0,resetTrialsButtonReady=!0,newTrialButtonReady=!0,submitInputButtonReady=!0,submitItemButtonReady=!0,requestAnimationOutputButtonReady=!0,showDialogButtonReady=!0,showAlertButtonReady=!0,util=function(){return sim.getUtils()},simMgr=function(){return sim.getSimulationManager()},eventMgr=function(){return sim.getEventManager()},dbg=function(){return sim.getDebug()},speechGrammarBldr=function(){return sim.getSpeechGrammarBldr()},scoringTable=function(){return sim.getScoringTable()},html2jsMap=function(){return sim.getHTML2JSMap()},simDocument=function(){return sim.getSimDocument()},transDictionary=function(){return sim.getTranslationDictionary()},keyboardInput=function(){return sim.getKeyboardInput()},whiteboard=function(){return sim.getWhiteboard()},registerClassEvents=function(instance){eventsRegistered||(eventMgr().registerEvent(new Simulator.Event(instance,"info","animationFinished")),eventMgr().registerEvent(new Simulator.Event(instance,"info","animationThreadFinished")),eventsRegistered=!0)};this.setEname(source),panel&&this.setPanel(panel),this.setHTMLButton=function(){return HTMLButton},this.setHTMLButton=function(newHTMLButton){return HTMLButton=newHTMLButton,this},this.getSrc=function(){return src},this.setSrc=function(newSrc){return src=newSrc,this},this.getImplication=function(){return implication},this.setImplication=function(newImplication){return implication=newImplication,this},this.recordKeyboardSelection=function(elementID,itemID){itemID&&this.getHandler()(elementID)},this.receivedSpeechFocus=function(){debug(this.getName()+" received speech focus");var node=simDocument().getElementById("buttonDiv"+this.getNodeID());borderColor=node.style.border.color,node.style.border="#ff0000"},this.removeSpeechFocus=function(value){debug(this.getName()+" lost speech focus"),simDocument().getElementById("buttonDiv"+this.getNodeID()).style.border.color=borderColor},this.speechActivated=function(value){var handler="Button."+this.getHandler();eval(handler)(this.getNodeID())},this.handleEvent=function(event){var newEvent=void 0;switch(event.type){case"command":break;case"info":switch(event.context){case"animationThreadFinished":case"animationFinished":resetButton("startTrial")}break;default:return void dbg().logWarning(this.getName()+": Unhandled event type received: "+event.toString())}void 0!=newEvent&&null!=newEvent&&newEvent.postEvent()},this.disableInput=function(){simDocument().getElementById(this.getNodeID()).disable=!0,this.setState("disabled")},this.enableInput=function(){simDocument().getElementById(this.getNodeID()).disable=!1,this.setState("enabled")},this.enableStartButton=function(){"StartTrial"===this.getHandler()&&this.enableInput()},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n";buff.push("Inspecting "+source+" "+this.getName()+sep);var str=Simulator.Control.Button.prototype.inspect.call(this,!0,force);if(str)buff.push(str);else for(var i in this)"get"==i.substr(0,3)&&(buff.push(i.charAt(3).toLowerCase()+i.slice(4)),buff.push(" = "),buff.push(eval("this."+i+"()")),buff.push(sep));if(buff.push("End inspecting "+source+" "+this.getName()+sep+sep),embedded)return buff.join("");1==force?debugf(buff.join("")):debug(buff.join(""))},this.setAttributes=function(attr,node){node&&(attr=util().getAttributes(node)),Simulator.Control.Button.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"implication":this.setImplication(attr[i])}},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){var bHandler=this.getHandler(),bNodeID=this.getNodeID(),parameters=this.getHandlerParameters();parameters&&(parameters=', "'+parameters+'"'),parameters||(parameters=""),eval(bHandler+'("'+bNodeID+'"'+parameters+")")},this.render=function(panelName){var needTableDiv=!1,tableDiv=null,buttonDiv=null;if(section)var HTMLPanel=container;else var HTMLPanel=panel.getHTMLElement();var button=null,imageSpan=null,imageElement=null,labelSpan=null,type=this.getType(),tableElement=null;-1!=HTMLPanel.id.indexOf("dataOutputPanel")&&(tableElement=util().getElementsByClassName("table_controls",HTMLPanel),needTableDiv=!0),needTableDiv?(tableDiv=simDocument().createElement("div"),tableDiv.id="tableDiv"+this.getNodeID(),tableDiv.setAttribute("class","table_controls"),HTMLPanel.appendChild(tableDiv)):(buttonDiv=simDocument().createElement("div"),buttonDiv.id="buttonDiv"+this.getNodeID(),section&&"horizontal"===section.getSectionSettings().elementorientation&&buttonDiv.classList.add("inputpanelcell"),HTMLPanel.appendChild(buttonDiv)),button=simDocument().createElement("button"),button.id=this.getNodeID(),button.setAttribute("type","button");var bHandler=this.getHandler(),bNodeID=this.getNodeID(),parameters=this.getHandlerParameters();if(parameters&&(parameters=', "'+parameters+'"'),parameters||(parameters=""),util().bindEvent(button,"click",function(event){return eval(bHandler+'("'+bNodeID+'"'+parameters+")"),event.preventDefault?event.preventDefault():event.returnValue=!1,!1}),"mixed"==type||"image"==type){imageSpan=simDocument().createElement("span"),imageSpan.setAttribute("class","holderImage");var image=this.getImage();this.isAPredefinedCmdElementImage(image)?button.setAttribute("class","actionButton "+image+" "+this.getImplication()):(button.setAttribute("class","actionButton withImages "+this.getImplication()),imageElement=simDocument().createElement("img"),imageElement.src=image,imageElement.alt=this.getLabel(),imageSpan.appendChild(imageElement)),button.appendChild(imageSpan)}if("mixed"!=type&&"text"!=type||("text"==type&&button.setAttribute("class","actionButton "+this.getImplication()),(labelSpan=simDocument().createElement("span")).setAttribute("class","holderText"),sim.getSpeechEnabled()?labelSpan.innerHTML=Simulator.Constants.SPEECH_CMD_ITEM_PREFIX+this.getLabel():labelSpan.innerHTML=this.getLabel(),button.appendChild(labelSpan)),needTableDiv?tableDiv.appendChild(button):-1==HTMLPanel.id.indexOf("dataOutputPanel")?buttonDiv.appendChild(button):tableElement[0].appendChild(button),this.setHTMLButton(button),hButton=button,this.mapHTML2JS(button),this.setFocusable(!0,!0),sim.getSpeechEnabled()){var speechLabel=this.getSpeechLabel();if(!speechLabel&&(!(speechLabel=this.getLabel())&&section&&(label=section.getSectionLabel()),!speechLabel))return void dbg().logFatalError(source,"Item is speech enabled but speechLabel attribute is missing for "+this.getName(),!0);speechGrammarBldr().createButtonGrammarRule(this.getName(),speechLabel,this,speechLabel)}this.isFocusable()&&keyboardInput().addFocusableElementItem(this,this.getNodeID())},sim&&registerClassEvents(instance)},Simulator.Control.Button.prototype=new Simulator.Control.CommandElement,Simulator.Control.Button.parent=Simulator.Control.CommandElement,Simulator.Control.Button.prototype.constructor=Simulator.Control.Button,Simulator.Display.DataDisplayElement=function(sim){Simulator.SimElement.call(this,sim);var visible="true",displayVector=[],waitOn=null,fixedDigits=2;this.getVisible=function(){return visible},this.setVisible=function(newVisible){return visible=newVisible,this},this.getDisplayVector=function(){return displayVector},this.setDisplayVector=function(newDisplayVector){return displayVector=newDisplayVector,this},this.getWaitOn=function(){return waitOn},this.setWaitOn=function(newWaitOn){return waitOn=newWaitOn,this},this.getFixedDigits=function(){return fixedDigits},this.setFixedDigits=function(newFixedDigits){return fixedDigits=newFixedDigits,this},this.onChange=function(id){this.postOnChangeEvents()},this.setAttributes=function(attr,node){Simulator.Display.DataDisplayElement.prototype.setAttributes.call(this,attr,node);for(var i in attr)switch(i){case"visible":this.setVisible(attr[i]);break;case"fixedDigits":this.setFixedDigits(attr[i]);break;case"waitOn":this.setWaitOn(attr[i])}}},Simulator.Display.DataDisplayElement.prototype=new Simulator.SimElement,Simulator.Display.DataDisplayElement.parent=Simulator.SimElement,Simulator.Display.DataDisplayElement.prototype.constructor=Simulator.Display.DataDisplayElement,Simulator.Display.DataTable=function(sim,panel){function updateHTMLTable(newHTMLTable){HTMLDataTable=newHTMLTable}function addRow(table,loadFromResponse){var newCell=null,hTable=simDocument().getElementById(table.getID()),nRows=hTable.rows.length,newRow=(table.createCellId(hTable.tBodies[0].rows.length-2,table.getNumColumnsPlusHeader()-1),hTable.insertRow(nRows));if(sim.getAccessibilityIFActive()){var rowHeader=document.createElement("th");rowHeader.innerHTML=rowHeaderText()+" "+nRows,rowHeader.scope="row",newRow.appendChild(rowHeader)}for(var i=table.getZerothColumn();i<table.getNumColumnsPlusHeader();i++)(newCell=newRow.insertCell(i)).id=table.createCellId(hTable.tBodies[0].rows.length-1,i),newCell.innerHTML=" ",table.isFocusable()&&keyboardInput().addFocusableElementItem(table,table.getID(),newCell.id);if(table.getClearRows()){var dCell=newCell=newRow.insertCell(table.getNumColumnsPlusHeader());dCell.style.borderRight="0px",dCell.style.borderTop="0px",dCell.style.borderBottom="0px",dCell.id=table.createCellId(hTable.tBodies[0].rows.length-1,table.getNumColumnsPlusHeader());var anchor=simDocument().createElement("a");anchor.href="#",anchor.setAttribute("class","clearRow"),anchor.innerHTML=clearRowText();var anchorwrap=simDocument().createElement("div");anchor.onclick=function(e){var theRow=simMgr().getTrialNum()-1;loadFromResponse&&(theRow=nRows-1);var id=table.getNodeID();return function(e){instance.clearRow(e,id,theRow)}}(),anchorwrap.appendChild(anchor),dCell.appendChild(anchorwrap),table.isFocusable()&&keyboardInput().addFocusableElementItem(table,table.getID(),dCell.id)}updateHTMLTable(hTable),table.setNumRows(hTable.tBodies[0].rows.length)}function trimExtraRows(table,intendedRowCount){var hTable=simDocument().getElementById(table.getID()),nRows=hTable.rows.length-1;if(intendedRowCount<nRows){for(var r=nRows;r>intendedRowCount;--r)hTable.deleteRow(r);updateHTMLTable(hTable),table.setNumRows(hTable.tBodies[0].rows.length)}}function resolveColumn(inputKey,outputKey){for(var i=0;i<numColumns;i++)if(headingMap[i].inputKey){if(inputKey&&headingMap[i].inputKey.toLowerCase()==inputKey.toLowerCase())return outputKeyMatch(outputKey,i)?i:-1}else if(outputKey&&outputKeyMatch(outputKey,i))return i;return-1}function outputKeyMatch(outputKey,colNum){if(!headingMap[colNum].outputKey)return!outputKey;if(outputKey){if("+"!=headingMap[colNum].outputKey[0]){theOutputKeys=headingMap[colNum].outputKey.split(",");for(var j=0;j<theOutputKeys.length;j++)if(anOutputKey=theOutputKeys[j].replace(/^\s+/,""),anOutputKey=anOutputKey.replace(/\s+$/,""),anOutputKey.toLowerCase()==outputKey.toLowerCase())return!0;return!1}if(headingMap[colNum].outputKey.substring(1)==outputKey)return!0}}function parseTableInput(obj,inputs){var inputArray=[],elements=null,parts=null,cellWritten=!1;for(var p in inputs)if(inputArray=inputs[p])for(var i=0;i<inputArray.length;i++)if(inputArray[i]){elements=inputArray[i].split(Simulator.Constants.PAIR_DELIMITTER);for(var k=0;k<elements.length;k++){var myInputKey,myData;if((parts=elements[k].split(Simulator.Constants.KEY_VALUE_DELIMITTER))[1]?(myInputKey=parts[0],myData=parts[1]):(myInputKey=p,myData=parts[0]),isNaN(myData)){for(var dataValues=myData.split(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+" "),m=0;m<dataValues.length;m++)dataValues[m]=transDictionary().translate(dataValues[m]);myData=dataValues.join(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER+" ")}cellWritten=obj.setCell(myInputKey,myData)}}cellWritten&&!hasOutputKeys&&(debug(source,"cellWritten = "+cellWritten+", hasOutputKeys = "+hasOutputKeys+'. Sending "tableUpdated" event'),eventMgr().postEvent(new Simulator.Event(obj,"info","tableUpdated")))}function parseOutput(obj,outputs){var parts=[],functionList=[],functionDB=[],iterations=[];if(""!=outputs&&";"!=outputs){iterations=outputs.split(Simulator.Constants.ITERATION_DELIMITTER);for(var t=0;t<iterations.length;t++){functionList=iterations[t].split(Simulator.Constants.PAIR_DELIMITTER);for(var fl=0;fl<functionList.length;fl++)(parts=functionList[fl].split(Simulator.Constants.KEY_VALUE_DELIMITTER))[0]=util().removeHeadingAndTrailingQuotes(parts[0],"both"),parts[1]=util().removeHeadingAndTrailingQuotes(parts[1],"both"),0==t&&(functionDB[parts[0]]=[]),parts[0]&&functionDB[parts[0]].push(parts[parts.length-1])}for(var cellWritten=!1,k=0;k<obj.getNumColumns();k++){var allData=null,inputKey=headingMap[k].inputKey,outputKeys=headingMap[k].outputKey;if(outputKeys)for(var outputKeyList=outputKeys.split(","),i=0;i<outputKeyList.length;i++){var data=null;if("Array"==typeof outputKeyList[i]&&(outputKeyList[i]=outputKeyList[i][0]),outputKeyList[i]=outputKeyList[i].replace(/^\s*/,""),outputKeyList[i]=outputKeyList[i].replace(/\s*$/,""),outputKeyList[i]=outputKeyList[i].replace(/^"\s*/,"*"),outputKeyList[i]=outputKeyList[i].replace(/\s*\"$/,'"'),outputKeyList[i]=outputKeyList[i].replace(/\"/g,""),outputKeyList[i]in functionDB){var keyString="";if(iteratorSelectorMap[k])data=util().applyFilter(iteratorSelectorMap[k],functionDB[outputKeyList[i]]),functionDB[outputKeyList[i]]=data;else if(includeKeyInOutput[k]){var keyTag=outputKeyList[i];keyString=transDictionary().translate(keyTag)+" : "}isNaN(functionDB[outputKeyList[i]])&&(functionDB[outputKeyList[i]]=transDictionary().translate(functionDB[outputKeyList[i]])),(data=keyString+functionDB[outputKeyList[i]])instanceof Array&&(data=data.join(",")),allData=allData?allData+", "+data:data,cellWritten=obj.setCell(inputKey,allData,outputKeyList[i])}}}cellWritten&&(obj.saveScoreableInputs(),eventMgr().postEvent(new Simulator.Event(obj,"info","tableUpdated")))}else dbg().logError(source,"Improper output parameter received in DataTable.parseOutput: "+outputs)}function compoundOutputKey(outputs){return"+"==outputs[0]}function postTableDataToWhiteboard(obj){var dataSeriesID=null;whiteboard().addCategory("itemTableData");for(var cellID=null,cell=null,buff=[],j=0;j<numRows;j++){for(var i=obj.getZerothColumn();i<obj.getNumColumnsPlusHeader();i++)cellID=obj.createCellId(j,i),cell=simDocument().getElementById(cellID),0==i?buff.push(cell.innerHTML):(buff.push(", "),buff.push(cell.innerHTML));dataSeriesID="series"+(j+1),whiteboardKey||(whiteboardKey=whiteboard().addItem("itemTableData",dataSeriesID)),whiteboard().setItem("itemTableData",dataSeriesID,buff.join(""),whiteboardKey)}}function rowIsEmpty(tbl,theRow){var nCols=tbl.getNumColumnsPlusHeader();if(theRow<tbl.getNumRows()&&theRow>=0)for(var i=tbl.getZerothColumn();i<nCols;i++){var id=tbl.createCellId(theRow,i);if(""!=simDocument().getElementById(id).innerHTML)return!1}return!0}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}function debugf(str1,str2,trace){dbg().debugf(source,str1,str2,trace)}Simulator.Display.DataDisplayElement.call(this,sim);var source="DataTable",iteratorSelectorMap=[],rowFunctionMap=[],headingMap=[],headingNames=[],autoCountMap=[],scoreableMap=[],numFiguresMap=[],includeKeyInOutput=[],columnTextLengthMap=[],hasOutputKeys=!1,colWidth=-1,whiteboardKey=null,userAlerted=!1,deleteColumn=!1,numRows=void 0,htmlTableRendered=!1,userAddRows=!0,numColumns=void 0,header=!0,incrementTrialOnOutput=!1,clearRows=!1,footer=!1,scoreable=!1,headerVisible=!0,outputSource="evaluator",deleteRowImage="",prevBorder="none",simID=null,instance=this;sim&&(simID=sim.getSimID());var HTMLPanel=panel.getHTMLElement(),keyboardInput=function(){return sim.getKeyboardInput()},util=function(){return sim.getUtils()},simMgr=function(){return sim.getSimulationManager()},eventMgr=function(){return sim.getEventManager()},dbg=function(){return sim.getDebug()},speechGrammarBldr=function(){return sim.getSpeechGrammarBldr()},whiteboard=function(){return sim.getWhiteboard()},scoringTable=function(){return sim.getScoringTable()},simDocument=function(){return sim.getSimDocument()},clearRowText=function(){return"Clear Row"},tableCaptionText=function(){return"Output Table"},rowHeaderText=function(){return"Trial"},transDictionary=function(){return sim.getTranslationDictionary()},HTMLDataTable=simDocument().createElement("table");HTMLDataTable.setAttribute("class","dataTable"),HTMLDataTable.rules="all",this.setFocusable(!0,!0);var createTableBody=function(tbl){var tBody=simDocument().createElement("tbody");HTMLDataTable.appendChild(tBody);var row;tbl.setFocusable(!0,!1);for(var j=0;j<numRows;j++){if(row=simDocument().createElement("tr"),tBody.appendChild(row),sim.getAccessibilityIFActive()){var rowHeader=document.createElement("th"),printedRowNumber=j+1;rowHeader.innerHTML=rowHeaderText()+" "+printedRowNumber,rowHeader.scope="row",row.appendChild(rowHeader)}for(var i=tbl.getZerothColumn();i<tbl.getNumColumnsPlusHeader();i++){var cell=simDocument().createElement("td");cell.id=tbl.createCellId(j,i),row.appendChild(cell),cell.innerHTML="",tbl.isFocusable()&&keyboardInput().addFocusableElementItem(tbl,tbl.getNodeID(),cell.id)}if(tbl.getClearRows()){var dCell=newCell=row.insertCell(row.cells.length);dCell.id=tbl.createCellId(j,tbl.getNumColumnsPlusHeader()),dCell.style.borderRight="0px",dCell.style.borderTop="0px",dCell.style.borderBottom="0px";var anchor=simDocument().createElement("a");anchor.href="#",anchor.setAttribute("class","clearRow"),anchor.innerHTML=clearRowText(),anchor.onclick=function(e){var theRow=j,id=tbl.getNodeID();return function(e){instance.clearRow(e,id,theRow)}}(),dCell.appendChild(anchor),tbl.isFocusable()&&keyboardInput().addFocusableElementItem(tbl,tbl.getNodeID(),dCell.id)}}},createRowDeletionSpeechCommand=function(tbl){speechGrammarBldr().createTableRowClearRule(tbl.getName(),"",tbl,"Data Table")};this.setEname(source),this.getHTMLTable=function(){return HTMLDataTable},this.getID=function(){return HTMLDataTable.id},this.setID=function(id){HTMLDataTable.setAttribute("id",this.getNodeID())},this.getCaptionID=function(){return"caption"+this.getID()},this.getColumnHeaderID=function(colNumber){return"column"+colNumber+"Header"+this.getID()},this.getUserAddRows=function(){return userAddRows},this.setUserAddRows=function(newUserAddRows){userAddRows="true"==newUserAddRows},this.getNumRows=function(){return numRows},this.setNumRows=function(newNumRows){return void 0==(numRows=parseInt(newNumRows))&&dbg().logWarning(source,"Could not convert string representation of number of data table rows to an integer"),0==numRows&&(deleteColumn=!0),this},this.getZerothColumn=function(){return sim.getAccessibilityIFActive()?1:0},this.getNumColumnsPlusHeader=function(){return this.getNumColumns()+this.getZerothColumn()},this.getNumColumns=function(){return numColumns},this.setNumColumns=function(newNumColumns){return(numColumns=parseInt(newNumColumns))||dbg().logWarning(source,"Could not convert string representation of number of data table columns to an integer"),colWidth=85/numColumns,dColWidth=100-colWidth*numColumns+"%",this},this.getHeader=function(){return header},this.setHeader=function(header){var indexStr="",maxLength=0,k=-1,cell=null,headingText=null,isIE=util().isInternetExplorer();if(null!=header){var tHead=HTMLDataTable.createTHead(),row=simDocument().createElement("tr");if(tHead.appendChild(row),sim.getAccessibilityIFActive()){var blankHeaderCell=simDocument().createElement("td");blankHeaderCell.setAttribute("id",this.getColumnHeaderID(0)),row.appendChild(blankHeaderCell)}for(var i=0;i<header.childNodes.length;i++)try{var child=header.childNodes[i];if("#"!=child.nodeName[0]&&(k+=1)<=numColumns){if(cell=simDocument().createElement("th"),cell.scope="col",cell.setAttribute("id",this.getColumnHeaderID(k+this.getZerothColumn())),row.appendChild(cell),indexStr="text",headingText=isIE?child.attributes.getNamedItem(indexStr).value:child.attributes[indexStr].nodeValue,cell.innerHTML=transDictionary().translate(headingText),headingNames[k]=headingText,headingMap[k]=[],indexStr="contentType",headingMap[k].push([indexStr]),isIE?void 0!=child.attributes.getNamedItem(indexStr)?headingMap[k][indexStr]=child.attributes.getNamedItem(indexStr).value:headingMap[k][indexStr]="text":void 0!=child.attributes[indexStr]?headingMap[k][indexStr]=child.attributes[indexStr].nodeValue:headingMap[k][indexStr]="text",indexStr="inputKey",headingMap[k].push([indexStr]),isIE?void 0!=child.attributes.getNamedItem(indexStr)?headingMap[k][indexStr]=child.attributes.getNamedItem(indexStr).value:headingMap[k][indexStr]=null:void 0!=child.attributes[indexStr]?headingMap[k][indexStr]=child.attributes[indexStr].nodeValue:headingMap[k][indexStr]=null,indexStr="outputKey",headingMap[k].push([indexStr]),isIE?void 0!=child.attributes.getNamedItem(indexStr)?(headingMap[k][indexStr]=child.attributes.getNamedItem(indexStr).value,headingMap[k][indexStr]=headingMap[k][indexStr].replace(/\s*\"\s*/g,'"'),hasOutputKeys=!0):headingMap[k][indexStr]=null:void 0!=child.attributes[indexStr]?(headingMap[k][indexStr]=child.attributes[indexStr].nodeValue,headingMap[k][indexStr]=headingMap[k][indexStr].replace(/\s*\"\s*/g,'"'),hasOutputKeys=!0):headingMap[k][indexStr]=null,indexStr="includeKeyInOutput",isIE?child.attributes.getNamedItem(indexStr)&&("yes"==child.attributes.getNamedItem(indexStr).value?includeKeyInOutput[k]=!0:includeKeyInOutput[k]=!1):child.attributes[indexStr]&&("yes"==child.attributes[indexStr].nodeValue?includeKeyInOutput[k]=!0:includeKeyInOutput[k]=!1),indexStr="autoCount",isIE?child.attributes.getNamedItem(indexStr)?autoCountMap[k]=child.attributes.getNamedItem(indexStr).value:autoCountMap[k]=null:child.attributes[indexStr]?autoCountMap[k]=child.attributes[indexStr].nodeValue:autoCountMap[k]=null,indexStr="filter",isIE)child.attributes.getNamedItem(indexStr)&&(iteratorSelectorMap[k]=child.attributes.getNamedItem(indexStr).value),(len=headingText.length)>maxLength&&(maxLength=len);else{child.attributes[indexStr]&&(iteratorSelectorMap[k]=child.attributes[indexStr].nodeValue);var len=headingText.length;len>maxLength&&(maxLength=len)}indexStr="scoreable",isIE?void 0!=child.attributes.getNamedItem(indexStr)?(scoreableMap[k]=!0,scoringTable().addElement(headingNames[k],"output")):scoreableMap[k]=!1:void 0!=child.attributes[indexStr]?(scoreableMap[k]=!0,scoringTable().addElement(headingNames[k],"output")):scoreableMap[k]=!1,indexStr="numDecFigures",isIE?void 0!=child.attributes.getNamedItem(indexStr)&&(numFiguresMap[k]=child.attributes.getNamedItem(indexStr).value):void 0!=child.attributes[indexStr]&&(numFiguresMap[k]=child.attributes[indexStr].nodeValue),indexStr="rowFunction",isIE?void 0!=child.attributes.getNamedItem(indexStr)&&(rowFunctionMap[k]=child.attributes.getNamedItem(indexStr).value):void 0!=child.attributes[indexStr]&&(rowFunctionMap[k]=child.attributes[indexStr].nodeValue),indexStr="maxTextLength",isIE?child.attributes.getNamedItem(indexStr)?columnTextLengthMap[k]=child.attributes.getNamedItem(indexStr).value:columnTextLengthMap[k]=-1:child.attributes[indexStr]?columnTextLengthMap[k]=child.attributes[indexStr].nodeValue:columnTextLengthMap[k]=-1}}catch(err){dbg().logError(source,"Error occurred during construction of data table header column "+k+" for attribute "+indexStr+": "+err.message)}if(sim.getAccessibilityIFActive()){var caption=simDocument().createElement("caption");caption.innerHTML=tableCaptionText(),caption.setAttribute("id",this.getCaptionID()),HTMLDataTable.insertBefore(caption,tHead);cell=simDocument().createElement("th");row.appendChild(cell),cell.innerHTML=clearRowText(),cell.scope="col"}}return this},this.getInputKey=function(columnNumber){return headingMap[columnNumber].inputKey},this.getOutputKey=function(columnNumber){return headingMap[columnNumber].outputKey},this.headingMapInverse=function(num){for(var key in headingMap)if(headingMap[key]==num)return key;return null},this.setIncrementTrialOnOutput=function(newIncrementTrialOnOutput){incrementTrialOnOutput="true"==newIncrementTrialOnOutput},this.getIncrementTrialOnOutput=function(){return incrementTrialOnOutput},this.createCellId=function(row,col){return this.getName()+simID+row+col},this.getFooter=function(){return footer},this.setFooter=function(footer){var tFoot=HTMLDataTable.createTFoot(),row=simDocument().createElement("TR");tFoot.appendChild(row);for(var i=this.getZerothColumn();i<this.getNumColumnsPlusHeader();i++){var cell=simDocument().createElement("TD");cell.style.width=colWidth,row.appendChild(cell),cell.innerHTML=" "}return this.HTMLDataTable.style.display="block",this},this.getClearRows=function(){return clearRows},this.setClearRows=function(newClearRows){return clearRows="true"==newClearRows||"yes"==newClearRows,this},this.getScoreable=function(){return scoreable},this.setScoreable=function(newScoreable){return scoreable="yes"==newScoreable,this},this.getHeaderVisible=function(){return headerVisible},this.setHeaderVisible=function(newHeaderVisible){return headerVisible=newHeaderVisible,this},this.getOutputSource=function(){return outputSource},this.setOutputSource=function(newOutputSource){return outputSource=newOutputSource,this},this.getDeleteRowImage=function(){return deleteRowImage},this.setDeleteRowImage=function(newDeleteRowImage){return(deleteRowImage=newDeleteRowImage)&&(this.setClearRows(!0),deleteColumn=!0),this},this.evaluateRowFunction=function(row,column){if(rowFunctionMap[column]){var sum=0,cellID=this.createCellId(row,column),cell=simDocument().getElementById(cellID);switch(rowFunctionMap[column]){case"mean":for(i=0;i<this.getNumColumns();i++)i!=column&&(sum+=parseFloat(cell.innerHTML));return(sum/numRows).toFixed(this.getFixedDigits());case"sum":for(i=0;i<this.getNumColumns();i++)i!=column&&(sum+=parseFloat(cell.innerHTML));return sum.toFixed(this.getFixedDigits());case"max":for(var max=null,i=0;i<this.getNumColumns();i++)max=Math.max(parseFloat(cell.innerHTML),max);return max.toFixed(this.getFixedDigits());case"min":for(var min=null,i=0;i<this.getNumColumns();i++)min=Math(min,parseFloat(cell.innerHTML));return min.toFixed(this.getFixedDigits())}}},this.replace=function(){HTMLPanel.replaceChild(HTMLDataTable,HTMLDataTable),this.refreshTable()},this.append=function(){HTMLPanel.appendChild(HTMLDataTable)},this.setCell=function(inputKey,data,outputKey){var cellWritten=!1,rowNum=simMgr().getTrialNum()-1,colNum=resolveColumn(inputKey,outputKey);if(rowNum==numRows){if(!userAddRows)return void(userAlerted||(Simulator.showAlertWarning("You cannot add additional data table rows."),userAlerted=!0));addRow(this)}return cellWritten=this.setCellWithRowColNum(rowNum,colNum,data),this.setAutoCountCells(rowNum),cellWritten},this.setCellWithRowColNum=function(rowNum,colNum,data){var cellWritten=!1,testVal=null;if(rowNum<numRows&&rowNum>=0&&-1!=colNum){var displayColNum=colNum+this.getZerothColumn(),id=this.createCellId(rowNum,displayColNum);cell=simDocument().getElementById(id);var contentType=headingMap[colNum].contentType;if(data===Simulator.Constants.NO_DATA_INDICATOR)cell.innerHTML=Simulator.Constants.NO_DATA_INDICATOR;else if("text"==contentType){if(isNaN(data)){if(-1!=columnTextLengthMap[colNum]){for(var parts=data.split(Simulator.Constants.MULTIPLE_VALUE_DELIMITTER),txtLen=parseInt(columnTextLengthMap[colNum]),i=0;i<parts.length;i++)parts[i].length>txtLen&&(parts[i]=parts[i].substr(0,txtLen-4)+" ..."),i>0&&(parts[i]=", "+parts[i]);data=parts.length>1?parts.join("\n"):parts[0]}}else{testVal=parseFloat(data);var figures=parseInt(numFiguresMap[colNum]);figures||(figures=0),rowFunctionMap[colNum]&&(testVal=this.evaluateRowFunction(rowNum,colNum)),data=testVal.toFixed(figures)}cell.innerHTML=util().replaceAll(data,Simulator.Constants.MULTIPLE_VALUE_DELIMITTER,",")}else"image"==contentType&&(cell.innerHTML='<img src="data:image/png;base64,"'+data+'" alt="x">');cellWritten=!0}else cellWritten=!1;return cellWritten},this.setAutoCountCells=function(rowNum){if(rowNum<numRows&&rowNum>=0)for(var i=this.getZerothColumn();i<this.getNumColumnsPlusHeader();i++)if(null!=autoCountMap[i]){var id=this.createCellId(rowNum,i);cell=simDocument().getElementById(id),cell.innerHTML=simMgr().getTrialNum()}},this.handleEvent=function(event){var newEvent=void 0,data="";switch(event.type){case"inputReq":break;case"input":parseTableInput(this,data=event.data);break;case"command":switch(event.context){case"resetTrials":this.clearAllRows(this),userAlerted=!1;break;case"startTrial":simMgr().trialLimitReached()||(userAlerted=!1,null!=(data=whiteboard().getCategory("dataInput"))&&(parseTableInput(this,data),postTableDataToWhiteboard(this)));break;case"startAnimation":userAlerted=!1,null!=(data=whiteboard().getCategory("dataInput"))&&(parseTableInput(this,data),postTableDataToWhiteboard(this));break;default:dbg().logWarning(source,"Unhandled command "+event.context+" received by DataTable")}break;case"info":switch(event.context){case"inputAvailable":simMgr().trialLimitReached()||null!=(data=whiteboard().getCategory("dataInput"))&&(parseTableInput(this,data),postTableDataToWhiteboard(this));break;case Simulator.Constants.ANIMATION_FINISHED:case Simulator.Constants.ANIMATION_THREAD_FINISHED:this.getOutputSource()?"evaluator"==this.getOutputSource()?data=whiteboard().getItem("evaluationOutput","output"):"animation"==this.getOutputSource()&&(data=whiteboard().getItem("animationOutput","output")):(data=whiteboard().getItem("evaluationOutput","output"))||(data=whiteboard().getItem("animationOutput","output")),null!=data&&parseOutput(this,data);break;case"outputAvailable":simMgr().trialLimitReached()||null!=this.getWaitOn()&&""!=this.getWaitOn()?null!=this.getWaitOn()&&""!=this.getWaitOn()&&eventMgr().registerEvent(new Simulator.Event(this,"info",this.getWaitOn())):((data=whiteboard().getItem("evaluationOutput","output"))||(data=whiteboard().getItem("evaluation","output")),data||(data=whiteboard().getItem("animationOutput","output")),null!=data?parseOutput(this,data):eventMgr().postEvent(new Simulator.Event(this,"info","tableUpdated")));break;case"animationOutputAvailable":null!=(data=whiteboard().getItem("animationOutput","output"))?parseOutput(this,data):eventMgr().postEvent(new Simulator.Event(this,"info","tableUpdated"))}break;default:return void dbg().logWarning(source,"DataTable "+this.getName()+": Unhandled event type received: "+event.inspect())}void 0!=newEvent&&null!=newEvent&&newEvent.postEvent()},this.allAttributesLoaded=function(){createTableBody(this)},this.saveScoreableInputs=function(){for(var row=simMgr().getTrialNum()-1,i=this.getZerothColumn();i<this.getNumColumnsPlusHeader();i++){var cellID=this.createCellId(row,i),cell=simDocument().getElementById(cellID);scoreableMap[i]&&scoringTable().setValue(headingNames[i],row,cell.innerHTML)}},this.getContents=function(indent,name){var buff=[],numCols=0,table=simDocument().getElementById(this.getNodeID());if(table){var children=table.tBodies[0].childNodes;name?buff.push("<"+name+">\n"):buff.push(indent+"<stateTable>\n");for(var i=0;i<children.length;i++)if("#"!=children[i].nodeName[0]){var child=children[i];if("tr"==child.nodeName.toLowerCase()){buff.push(indent+"  <tr>\n");var cols=child.childNodes;numCols=1==this.getClearRows()?cols.length-1:cols.length;for(var j=0;j<numCols;j++)"th"==cols[j].nodeName.toLowerCase()?(buff.push(indent+"    <th>"),buff.push(cols[j].childNodes[0].textContent),buff.push("</th>")):"td"==cols[j].nodeName.toLowerCase()&&(buff.push(indent+"    <td>"),buff.push(cols[j].textContent),buff.push("</td>\n"));buff.push(indent+"  </tr>\n")}}return name?buff.push("</"+name+">\n"):buff.push(indent+"</stateTable>\n"),buff.join("")}return""},this.loadFromResponse=function(node){for(var responseRowNum=-1,lastTableRowNum=this.getNumRows()-1,colNum=-1,children=node.childNodes,i=0;i<children.length;i++){var child=children[i];if("#"!=child.nodeName[0]&&"tr"==child.nodeName.toLowerCase()){colNum=-1,lastTableRowNum<++responseRowNum&&(addRow(this,!0),lastTableRowNum++);for(var childChildren=child.childNodes,j=0;j<childChildren.length;j++){var childChild=childChildren[j];if("#"!=childChild.nodeName[0]&&"td"==childChild.nodeName.toLowerCase()){colNum++;var cellID=this.createCellId(responseRowNum,colNum),cell=simDocument().getElementById(cellID);cell?cell.innerHTML=childChild.textContent:dbg().logError(source,"DataTable.loadFromResponse: Could not find cell with ID = "+cellID)}}}}trimExtraRows(this,responseRowNum+1)},this.keyboardNavigateTo=function(elementID,itemID,index){var item=simDocument().getElementById(itemID);item&&item.setAttribute("class","simAreaFocus")},this.keyboardNavigateAwayFrom=function(elementID,itemID,index){var item=simDocument().getElementById(itemID);item&&item.removeAttribute("class")},this.recordKeyboardSelection=function(elementID,itemID,itemIndex){var element=null,item=null;if(itemID&&((item=simDocument().getElementById(itemID))||(element=simDocument().getElementById(elementID))&&(item=element.getElementsByClassName(itemID)[0]),item&&(item.isSelected=!0,this.getClearRows()&&itemIndex%(numColumns+1)==numColumns))){var currentRow=Math.floor(itemIndex/(numColumns+1));this.clearRow(null,itemID,currentRow,!1)}},this.receivedSpeechFocus=function(){debug(this.getName()+" received speech focus");var node=simDocument().getElementById(this.getID());prevBorder=node.style.border,node.style.border="thin solid #ff0000"},this.removeSpeechFocus=function(value){debug(this.getName()+" lost speech focus"),simDocument().getElementById(this.getID()).style.border=prevBorder},this.speechActivated=function(value){var parts=value.split("#");this.clearRow(null,this.getNodeID(),parts[1].trim(),!1)},this.getSourceName=function(){return source},this.inspect=function(embedded,force){var buff=[],sep="\n\n",rowSep="\n\n",colSep="   ",tHeader=HTMLDataTable.tHead,tBody=HTMLDataTable.tBodies[0];buff.push("Inspecting "),buff.push(this.getName()),buff.push(sep);for(var i=this.getZerothColumn();i<this.getNumColumnsPlusHeader();i++)buff.push(tHeader.rows[0].cells[i].innerHTML),buff.push(colSep);buff.push(rowSep);for(var l=0;l<numRows;l++){for(var row=tBody.rows[l],j=this.getZerothColumn();j<this.getNumColumnsPlusHeader();j++)buff.push(row.cells[j].innerHTML),buff.push(colSep);buff.push(rowSep)}buff.push(sep);for(var prop in this)"get"==prop.substr(0,3)&&(buff.push(prop),buff.push(" = "),buff.push(eval("this."+prop+"()")),buff.push(sep));return embedded||(null===force?debug(buff.join("")):debugf(buff.join(""))),buff.join("")},this.refreshTable=function(){HTMLDataTable.style.display="none",HTMLDataTable.style.display="table"},this.clearRow=function(e,htmlTbl,theRow,batchDelete){var evt=window.event||e;if(!simMgr().isPlaying()&&!simMgr().isReadOnly()){var tbl=this,nRows=tbl.getNumRows(),nCols=tbl.getNumColumnsPlusHeader();if(theRow<nRows&&theRow>=0&&!rowIsEmpty(tbl,theRow)){for(var i=this.getZerothColumn();i<nCols;i++){var id=tbl.createCellId(theRow,i);simDocument().getElementById(id).innerHTML=""}scoringTable().clearRow(theRow),batchDelete||eventMgr().postEvent(new Simulator.Event(tbl,"command","redoTrial",theRow+1))}}evt&&(evt.preventDefault?evt.preventDefault():evt.returnValue=!1)},this.clearAllRows=function(tbl){if(!simMgr().isReadOnly()){for(var htmlTbl=simDocument().getElementById(tbl.getNodeID()),nRows=tbl.getNumRows(),j=0;j<nRows;j++)this.clearRow(null,htmlTbl.id,j,!0);eventMgr().postEvent(new Simulator.Event(tbl,"info","allTableRowsCleared"))}},this.setAttributes=function(attr,node){node&&(attr=util().getAttributes(node)),Simulator.Display.DataTable.prototype.setAttributes.call(this,attr,node);for(var key in attr)switch(key){case"rows":this.setNumRows(attr[key]);break;case"columns":this.setNumColumns(attr[key]);break;case"footer":this.setFooter(attr[key]);break;case"clearRow":this.setClearRows(attr[key]);break;case"headerVisible":this.setHeaderVisible(attr[key]);break;case"name":this.setID(this.getName());break;case"deleteRowImage":this.setDeleteRowImage(attr[key]);break;case"contentType":this.setContentType(attr[key]);break;case"incrementTrialOnOutput":this.setIncrementTrialOnOutput(attr[key]);break;case"userAddRows":this.setUserAddRows(attr[key]);break;case"rowFunction":this.setRowFunction(attr[key]);break;case"outputSource":this.setOutputSource(attr[key])}for(var children=node.childNodes,k=0;k<children.length;k++)if("header"==children[k].nodeName){this.setHeader(children[k]);break}this.allAttributesLoaded()},this.render=function(panelName){if(this.getVisible())htmlTableRendered?this.append():(this.append(),htmlTableRendered=!0),this.refreshTable();else{var HTMLTable=simDocument().getElementById(this.getName());HTMLTable.style.display="none",this.mapHTML2JS(HTMLTable)}}},Simulator.Display.DataTable.prototype=new Simulator.Display.DataDisplayElement,Simulator.Display.DataTable.parent=Simulator.Display.DataDisplayElement,Simulator.Display.DataTable.prototype.constructor=Simulator.Display.DataTable,Simulator.Display.DialogPanel=function(sim,enclosingPanel,panelID,buttonLabel,attr){function setStructure(){(HTMLDialogPanel=simDocument().createElement("div")).setAttribute("class","infoWrapper"),HTMLDialogPanel.style.display="none";var titleDiv=simDocument().createElement("div");titleDiv.setAttribute("class","instructionsTitle");var header=simDocument().createElement("h2");header.innerHTML=title,titleDiv.appendChild(header);var anchor=simDocument().createElement("a");anchor.href="#",anchor.setAttribute("class","close instructions"),anchor.innerHTML="Close",titleDiv.appendChild(anchor),HTMLDialogPanel.appendChild(titleDiv);var instrDiv=simDocument().createElement("div");instrDiv.setAttribute("class","holderInfo"),instrDiv.innerHTML=instructions,HTMLDialogPanel.appendChild(instrDiv)}var source="DialogPanel",HTMLDialogPanel=null,title="",instructions="",dialogAttr=[],dbg=function(){return sim.getDebug()},simDocument=function(){return sim.getSimDocument()};this.getTitle=function(){return title},this.getInstructions=function(){return instructions},this.getID=function(){return""},this.setClass=function(newClass){HTMLDialogPanel.setAttribute("class",newClass)},this.setInstructions=function(newInstructions){dialogAttr.instructions=newInstructions},this.setTitle=function(newTitle){dialogAttr.title=newITitle},this.getDialogAttr=function(){return dialogAttr},this.render=function(enclosingPanel,attr,panelID,buttonLabel){dialogButton=dialogPanel.createButton(panelID+"button",panelID,buttonLabel);var htmlButton=simDocument().getElementById(dialogButton.getNodeID());HTMLPanel=simDocument().getElementById(panelID),dialogPanel.innerHTML=dialogAttr.instructions,dialogPanel.display="none",HTMLPanel.appendChild(htmlButton)},this.getDialogButton=function(){return dialogButton},this.createButton=function(htmlID,panelName,buttonLabel){var theButton=new Button,attr=[];return attr.implication="neutral",attr.label=buttonLabel,attr.name=htmlID,attr.type="text",attr.alwaysEnabled="yes",attr.handler="ShowDialog",attr.handlerParameters=panelName,theButton.setAttributes(attr,null),theButton.render(panelName),theButton},function(attr){for(var i in attr)switch(i){case"title":title=attr[i];break;case"instructions":instructions=attr[i];break;default:dbg().logError(source,"Unknown DialogPanel attribute seen: "+i+'with value "'+attr[i]+'"')}setStructure()}(attr)};var SimParser=SimParser||{};SimParser.nameSpace=function(){for(var parts,nsObj=null,i=0;i<arguments.length;i++){parts=(""+arguments[i]).split("."),nsObj=SimParser;for(var j="SimParser"==parts[0]?1:0;j<parts.length;j++)nsObj[parts[j]]=nsObj[parts[j]]||{},nsObj=nsObj[parts[j]]}return nsObj},SimParser.ParserItem=SimParser.nameSpace("SimParser","ParserItem"),SimParser.Utils=SimParser.nameSpace("SimParser","Utils"),SimParser.Variable=SimParser.nameSpace("SimParser","Variable"),SimParser.VariableManager=SimParser.nameSpace("SimParser","VariableManager"),SimParser.Range=SimParser.nameSpace("SimParser","Range"),SimParser.RangeManager=SimParser.nameSpace("SimParser","RangeManager"),SimParser.Constraint=SimParser.nameSpace("SimParser","Constraint"),SimParser.ConstraintManager=SimParser.nameSpace("SimParser","ConstraintManager"),SimParser.Permutation=SimParser.nameSpace("SimParser","Permutation"),SimParser.Function=SimParser.nameSpace("SimParser","Function"),SimParser.FunctionManager=SimParser.nameSpace("SimParser","FunctionManager"),SimParser.FilterEvaluation=SimParser.nameSpace("SimParser","FilterEvaluation"),SimParser.FunctionEvaluation=SimParser.nameSpace("SimParser","FunctionEvaluation"),SimParser.EvaluationUnit=SimParser.nameSpace("SimParser","EvaluationUnit"),SimParser.ParserItem=function(parser){var eName="ParserItem";this.getEname=function(){return eName},this.setEname=function(newEname){return eName=newEname,this},SimParser.ParserItem.prototype.setAttributes=function(attr,node){for(var i in attr)switch(i){case"eName":this.setEname(attr[i])}}},"undefined"==typeof EU&&(EU={}),EU.debug=function(str){"function"==typeof debug&&debug(str),"object"==typeof console&&console.log(str)},SimParser.Utils=function(vUnit){var evUnit=vUnit,whiteboard=evUnit.getSimInstance().getWhiteboard();this.greedyEvaluation=function(varsWB,varsFunc){for(var varCount=new Array(varsFunc.length),i=0;i<varsFunc.length;i++)varCount[i]=countVarBindable(varsWB,varsFunc[i]);for(var iMax=0,i=0;i<varCount.length;i++)varCount[i].bindable&&varCount[i].count>iMax&&(iMax=varCount[i].count);r=[];for(i=0;i<varsFunc.length;i++)(varCount[i].bindable&&varCount[i].count===iMax||0===varCount[i].count)&&r.push(varsFunc[i].name);return r},this.fullEvaluation=function(varsWB,varsFunc){for(var func=[],vMng=evUnit.getVariableManager(),i=0;i<varsFunc.length;i++){for(var v=varsFunc[i].vars,fBind=!0,j=0;j<v.length;j++)if(vMng.isVarBindable(v[j])&&-1===varsWB.indexOf(v[j])){fBind=!1;break}fBind&&func.push(varsFunc[i])}return func},this.countVarBindable=function(varsWB,varFunc){for(var r={count:0,bindable:!0},v=varFunc.vars,vMng=evUnit.getVariableManager(),i=0;i<v.length;i++)vMng.isVarBindable(v[i])&&(-1!==varsWB.indexOf(v[i])?r.count++:r.bindable=!1);return r},this.mergeWBVariables=function(varsWB){for(var r={},varsWB1=[],i=0;i<varsWB.length;i++)for(var key in varsWB[i])varsWB1.push({name:key,value:varsWB[i][key]});for(i=0;i<varsWB1.length;i++)void 0===r[varsWB1[i].name]?r[varsWB1[i].name]=[varsWB1[i].value]:r[varsWB1[i].name].push(varsWB1[i].value);var rr=[];for(var key in r)rr.push({name:key,value:r[key]});return rr},this.getWBVarNames=function(varsWB){for(var names=[],i=0;i<varsWB.length;i++)names.push(varsWB[i].name);return names},this.getWBVarValues=function(varsWB){for(var v=[],i=0;i<varsWB.length;i++)v.push(varsWB[i].value);return v},this.convertElementNamesToVarNames=function(vNames){r=[];for(var vMng=evUnit.getVariableManager(),j=0;j<vNames.length;j++){var v=vMng.getVariableByObjectName(vNames[j]);v?r.push(v.getName()):(EU.debug("Cannot find a varible name for element:"+vNames[j]),r.push(vNames[j]))}return r},this.getConstantValues=function(){r={vNames:[],vValues:[]};for(var c=evUnit.getVariableManager().getConstants(),i=0;i<c.length;i++)-1===r.vNames.indexOf(c[i].name)&&(r.vNames.push(c[i].name),r.vValues.push(c[i].value));return r},this.getImplicitValues=function(varFuncs){for(var imvarsRequiredNames=[],imvarsRequiredValues=[],vMng=evUnit.getVariableManager(),impvarsDeclaredNames=vMng.getVariableNames(["implicit"]),i=0;i<varFuncs.length;i++)for(var v=varFuncs[i].vars,j=0;j<v.length;j++)if(impvarsDeclaredNames.indexOf(v[j])>=0&&-1===imvarsRequiredNames.indexOf(v[j])){imvarsRequiredNames.push(v[j]);var sirVar=vMng.getVariableByName(v[j]);imvarsRequiredValues.push(sirVar.getValues())}return{names:imvarsRequiredNames,values:imvarsRequiredValues}},this.getVarObject=function(varNames,varValues){for(var r={},i=0;i<varNames.length;i++)r[varNames[i]]=varValues[i];return r},this.getFuncVars=function(){vFuncs=[];for(var fn=evUnit.getFunctionManager().getFunctions(),i=0;i<fn.length;i++)vFuncs.push({name:fn[i].getName(),vars:fn[i].getVarNames()});return vFuncs},this.writeDataOnWhiteBoard=function(data,key1,cat,item){if(void 0!==whiteboard)return whiteboard.addCategory(cat),key1||(key1=whiteboard.addItem(cat,item)),whiteboard.setItem(cat,item,data,key1),key1;EU.debug("whiteboard object not defined.")},this.readDataFromWhiteBoard=function(section,item){return[{chalk:15},{surfaceArea:600},{chalk:16}]},this.readDataFromWhiteBoard=function(category){var data=[],cat=whiteboard.getCategory(category);if(null!==cat||void 0!==cat||0!==cat.length)for(var p in cat)if(cat.hasOwnProperty(p)){var d={};d[p]=cat[p],data.push(d)}return data},this.packVariablesforWhiteboard=function(v){for(var vv={},vMng=evUnit.getVariableManager(),i=0;i<v.length;i++){var objName=v[i].name,sirVar=vMng.getVariableByName(v[i].name);sirVar&&"binding"===sirVar.getType()&&(objName=sirVar.getObjectName()),vv[objName]=v[i].value}return vv},this.packFunctionforWhiteboard=function(f,v){for(var ff={},i=0;i<f.length;i++)ff[f[i]]=v[i];return ff},this.getFuncNames=function(algorithm,varNames,varFuncs){return"greedy"===algorithm?greedyEvaluation(varNames,varFuncs):"all"===algorithm?this.fullEvaluation(varNames,varFuncs):void EU.debug("Unsupported algorithm in function evaluation")},this.createSingleOutput=function(varList,funcList){for(var v={},f={},i=0;i<varList.length;i++)v[varList[i].name]=varList[i].value;for(i=0;i<funcList.length;i++)f[funcList[i].name]=funcList[i].value;return{variables:v,functions:f}},this.oddValue=function(v){return void 0===v||null===v||"string"==typeof v||"number"==typeof v&&(v===1/0||v===-1/0||"NaN"===v.toString())}},Array.prototype.indexOf||(Array.prototype.indexOf=function(elt){var len=this.length,from=Number(arguments[1])||0;for((from=from<0?Math.ceil(from):Math.floor(from))<0&&(from+=len);from<len;from++)if(from in this&&this[from]===elt)return from;return-1});var Parser=function(){function object(o){function F(){}return F.prototype=o,new F}function Token(type_,index_,prio_,number_){this.type_=type_,this.index_=index_||0,this.prio_=prio_||0,this.number_=void 0!==number_&&null!==number_?number_:0,this.toString=function(){switch(this.type_){case TNUMBER:return this.number_;case TOP1:case TOP2:case TVAR:return this.index_;case TFUNCALL:return"CALL";default:return"Invalid Token"}}}function Expression(tokens,ops1,ops2,functions){this.tokens=tokens,this.ops1=ops1,this.ops2=ops2,this.functions=functions}function escapeValue(v){return"string"==typeof v?(escapable.lastIndex=0,escapable.test(v)?"'"+v.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+v+"'"):v}function append(a,b){return"[object Array]"!=Object.prototype.toString.call(a)?[a,b]:((a=a.slice()).push(b),a)}function fac(a){for(var b=a=Math.floor(a);a>1;)b*=--a;return b}function pyt(a,b){return Math.sqrt(a*a+b*b)}function random(a){return Math.random()*(a||1)}function Parser(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,exp:Math.exp,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,if:function(x){return x},"-":function(x){return-x},"!":function(x){return!x},"{":function(a){return eval("var z = {"+a+"}"),z}},this.ops2={"+":function(a,b){return Number(a)+Number(b)},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},",":append,"&&":function(a,b){return a&&b},"||":function(a,b){return a||b},"^":Math.pow,pow:Math.pow,"?":function(a,b){return a?b:null},":":function(ab,c){return null===ab?c:ab},"[]":function(a,b){return a[b]},"==":function(a,b){return a==b},"!=":function(a,b){return a!=b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b}},this.functions={"Math.atan2":Math.atan2,"Math.sin":Math.sin,"Math.cos":Math.cos,"Math.floor":Math.floor,"Math.min":Math.min,"Math.max":Math.max,"Math.pow":Math.pow,"Math.rand":Math.random,"Math.random":Math.random,"Math.round":Math.round,"Math.sqrt":Math.sqrt,atan2:Math.atan2,fac:fac,min:Math.min,max:Math.max,pow:Math.pow,random:random,rand:random,pyt:pyt},this.consts={E:Math.E,e:Math.E,PI:Math.PI,pi:Math.PI}}Array.indexOf||(Array.prototype.indexOf=function(arg){for(var i=0;i<this.length;i++)if(this[i]==arg)return i;return-1}),String.trim=function(strArg){return strArg.replace(/^\s+|\s+$/g,"")};var TNUMBER=0,TOP1=1,TOP2=2,TVAR=3,TFUNCALL=4,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};Parser.parbracketsAndCo=function(expr){function enclosers(expr,delimOpen,delimClose,name){for(var newExp="",char=0,pos=0,charOpen=delimOpen.charAt(0),charClose=delimClose.charAt(0),countingOpenedGroup=0;pos<expr.length;)(char=expr.charAt(pos))==charOpen?(countingOpenedGroup++,newExp+="{"==delimOpen?name+"(`":name+"("):char==charClose?(--countingOpenedGroup<0&&noIllegalGroup(countingOpenedGroup,delimOpen,delimClose),newExp+="{"==delimOpen?"`)":")"):newExp+=char,pos++;return noIllegalGroup(countingOpenedGroup,delimOpen,delimClose),newExp}function noIllegalGroup(countingOpenedGroup,delimOpen,delimClose){if(countingOpenedGroup<0)throw new Error("parse error : "+delimOpen+"..."+delimClose+", missing opening character");if(countingOpenedGroup>0)throw new Error("parse error : "+delimOpen+"..."+delimClose+", missing closing character")}return expr=enclosers(expr,"(",")",""),expr=enclosers(expr,"[","]","[]"),expr=enclosers(expr,"{","}","{")},Parser.evaluate=function(expr,variables){return Parser.parse(expr).evaluate(variables)},Parser.Expression=Expression,Parser.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,"Math.floor":Math.floor,round:Math.round,random:random,rand:random,fac:fac,exp:Math.exp,min:Math.min,max:Math.max,"Math.max":Math.max,pyt:pyt,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};var PRIMARY=1,OPERATOR=2,FUNCTION=4,LPAREN=8,RPAREN=16,COMMA=32,SIGN=64,CALL=128;return Parser.prototype={parse:function(expr){expr=Parser.parbracketsAndCo(expr),this.errormsg="",this.success=!0;var operstack=[],tokenstack=[];this.tmpprio=0;var expected=PRIMARY|LPAREN|FUNCTION|SIGN,noperators=0,lptsl=-1;for(this.expression=expr,this.pos=0;this.pos<this.expression.length;){this.expression.charAt(this.pos);if(this.isOperator())this.isSign()&&expected&SIGN?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",this.addfunc(tokenstack,operstack,TOP1),noperators+=1),expected=PRIMARY|LPAREN|FUNCTION|SIGN):this.isComment()||(0==(expected&OPERATOR)&&this.error_parsing(this.pos,"unexpected operator"),this.addfunc(tokenstack,operstack,TOP2),noperators+=2,expected=PRIMARY|LPAREN|FUNCTION|SIGN);else if(this.isNumber()){0==(expected&PRIMARY)&&this.error_parsing(this.pos,"unexpected number");token=new Token(TNUMBER,0,0,this.tokennumber);tokenstack.push(token),expected=OPERATOR|RPAREN|COMMA}else if(this.isString()){0==(expected&PRIMARY)&&this.error_parsing(this.pos,"unexpected string");token=new Token(TNUMBER,0,0,this.tokennumber);tokenstack.push(token),expected=OPERATOR|RPAREN|COMMA}else if(this.isLeftParen())0==(expected&LPAREN)&&this.error_parsing(this.pos,'unexpected "("'),expected&CALL&&(this.tokenprio=-2,this.tokenindex=-1,this.addfunc(tokenstack,operstack,TFUNCALL),noperators+=2,lptsl=tokenstack.length),expected=PRIMARY|LPAREN|FUNCTION|SIGN|RPAREN;else if(this.isRightParen()){if(0==(expected&RPAREN)&&this.error_parsing(this.pos,'unexpected ")"'),lptsl==tokenstack.length){var token=new Token(TNUMBER,0,0,"");tokenstack.push(token),lptsl=-1}expected=OPERATOR|RPAREN|COMMA|LPAREN|CALL}else if(this.isComma())0==(expected&COMMA)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(tokenstack,operstack,TOP2),noperators+=2,expected=PRIMARY|LPAREN|FUNCTION|SIGN;else if(this.isConst()){0==(expected&PRIMARY)&&this.error_parsing(this.pos,"unexpected constant");var consttoken=new Token(TNUMBER,0,0,this.tokennumber);tokenstack.push(consttoken),expected=OPERATOR|RPAREN|COMMA}else if(this.isOp2())0==(expected&FUNCTION)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(tokenstack,operstack,TOP2),noperators+=2,expected=LPAREN;else if(this.isOp1())0==(expected&FUNCTION)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(tokenstack,operstack,TOP1),noperators+=1,expected=LPAREN;else if(this.isVar()){0==(expected&PRIMARY)&&this.error_parsing(this.pos,"unexpected variable");var vartoken=new Token(TVAR,this.tokenindex,0,0);tokenstack.push(vartoken),expected=OPERATOR|RPAREN|COMMA|LPAREN|CALL}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg))}for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');operstack.length>0;){var tmp=operstack.pop();tokenstack.push(tmp)}return noperators+1!==tokenstack.length&&this.error_parsing(this.pos,"parity"),new Expression(tokenstack,object(this.ops1),object(this.ops2),object(this.functions))},evaluate:function(expr,variables){return this.parse(expr).evaluate(variables)},error_parsing:function(column,msg){throw this.success=!1,this.errormsg="parse error: "+msg+"; col. "+column+" in: '"+this.expression+"'",new Error(this.errormsg)},addfunc:function(tokenstack,operstack,type_){for(var operator=new Token(type_,this.tokenindex,this.tokenprio+this.tmpprio,0);operstack.length>0&&operator.prio_<=operstack[operstack.length-1].prio_;)tokenstack.push(operstack.pop());operstack.push(operator)},isNumber:function(){for(var r=!1,str="";this.pos<this.expression.length;){var code=this.expression.charCodeAt(this.pos);if(!(code>=48&&code<=57||46===code))break;str+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(str),r=!0}return r},unescape:function(v,pos){var i,buffer=[],escaping=!1;for(i=0;i<v.length;i++){var c=v.charAt(i);if(escaping){switch(c){case"'":buffer.push("'");break;case"\\":buffer.push("\\");break;case"/":buffer.push("/");break;case"b":buffer.push("\b");break;case"f":buffer.push("\f");break;case"n":buffer.push("\n");break;case"r":buffer.push("\r");break;case"t":buffer.push("\t");break;case"u":var codePoint=parseInt(v.substring(i+1,i+5),16);buffer.push(String.fromCharCode(codePoint)),i+=4;break;default:throw this.error_parsing(pos+i,"Illegal escape sequence: '\\"+c+"'")}escaping=!1}else"\\"==c?escaping=!0:buffer.push(c)}return buffer.join("")},isString:function(){var r=!1,str="",startpos=this.pos,char0=this.expression.charAt(this.pos);if(this.pos<this.expression.length&&("'"==char0||'"'==char0||"`"==char0))for(this.pos++;this.pos<this.expression.length;){if(this.expression.charAt(this.pos)==char0&&"\\"!=str.slice(-1)){this.pos++,this.tokennumber=this.unescape(str,startpos),r=!0;break}str+=this.expression.charAt(this.pos),this.pos++}return r},isConst:function(){var str;for(var i in this.consts){var L=i.length;if(str=this.expression.substr(this.pos,L),i===str)return this.tokennumber=this.consts[i],this.pos+=L,!0}return!1},isOperator:function(){var opsyns={"+":["+",0],"-":["-",0],"&&":["&&",-3],and:["&&",-3],"&amp;&amp;":["&&",-3],"||":["||",-4],or:["||",-4],"*":["*",1],"/":["/",2],"%":["%",2],"^":["^",3],"?":["?",-5],":":[":",-6],if:["+",-4],then:["?",-5],else:[":",-6],"[]":["[]",4],"===":["==",-2],"==":["==",-2],"=":["==",-2],"!==":["!=",-2],"!=":["!=",-2],"<>":["!=",-2],"<=":["<=",-1],"<":["<",-1],">=":[">=",-1],">":[">",-1],"&lt;=":["<=",-1],"&lt;":["<",-1],"&gt;=":[">=",-1],"&gt;":[">",-1]};for(var key in opsyns){for(var found=!0,equiv=opsyns[key][0],i=(this.expression.charAt(this.pos),0);i<key.length;i+=1)found=found&&this.expression.charAt(this.pos+i).toLowerCase()===key.charAt(i);if(found)return this.tokenindex=equiv,this.tokenprio=opsyns[key][1],this.pos+=key.length,!0}return!1},isSign:function(){var char=this.expression.charAt(this.pos-1),prevchar=this.expression.charAt(this.pos-2);return"-"===char||"+"===char||prevchar+char==="if"},isPositiveSign:function(){return"+"===this.expression.charAt(this.pos-1)},isNegativeSign:function(){return"-"===this.expression.charAt(this.pos-1)},isLeftParen:function(){return"("===this.expression.charAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParen:function(){return")"===this.expression.charAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return","===this.expression.charAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var code=this.expression.charCodeAt(this.pos);return(32===code||9===code||10===code||13===code)&&(this.pos++,!0)},isOp1:function(){var i,str="";for(i=this.pos;i<this.expression.length;i++){var c=this.expression.charAt(i);if(c.toUpperCase()===c.toLowerCase()&&"{"!=c&&(i===this.pos||c<"0"||c>"9"))break;str+=c}return str.length>0&&str in this.ops1&&(this.tokenindex=str,this.tokenprio=5,this.pos+=str.length,!0)},isOp2:function(){var i,str="";for(i=this.pos;i<this.expression.length;i++){var c=this.expression.charAt(i);if(c.toUpperCase()===c.toLowerCase()&&(i===this.pos||c<"0"||c>"9"))break;str+=c}return str.length>0&&str in this.ops2&&(this.tokenindex=str,this.tokenprio=5,this.pos+=str.length,!0)},isVar:function(){var i,str="";for(i=this.pos;i<this.expression.length;i++){var c=this.expression.charAt(i);if(c.toUpperCase()===c.toLowerCase()&&"_"!==c&&"."!==c&&(i===this.pos||c<"0"||c>"9"))break;str+=c}return str.length>0&&(this.tokenindex=str,this.tokenprio=4,this.pos+=str.length,!0)},isComment:function(){return"/"===this.expression.charAt(this.pos-1)&&"*"===this.expression.charAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},Expression.prototype={simplify:function(values){values=values||{};var f,i,item,n1,n2,nstack=[],newexpression=[],L=this.tokens.length;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push(item);else if(type_===TVAR&&item.index_ in values)item=new Token(TNUMBER,0,0,values[item.index_]),nstack.push(item);else if(type_===TOP2&&nstack.length>1)n2=nstack.pop(),n1=nstack.pop(),f=this.ops2[item.index_],item=new Token(TNUMBER,0,0,f(n1.number_,n2.number_)),nstack.push(item);else if(type_===TOP1&&nstack.length>0)n1=nstack.pop(),f=this.ops1[item.index_],item=new Token(TNUMBER,0,0,f(n1.number_)),nstack.push(item);else{for(;nstack.length>0;)newexpression.push(nstack.shift());newexpression.push(item)}}for(;nstack.length>0;)newexpression.push(nstack.shift());return new Expression(newexpression,object(this.ops1),object(this.ops2),object(this.functions))},substitute:function(variable,expr){expr instanceof Expression||(expr=(new Parser).parse(String(expr)));var i,item,newexpression=[],L=this.tokens.length;for(i=0;i<L;i++)if((item=this.tokens[i]).type_===TVAR&&item.index_===variable)for(var j=0;j<expr.tokens.length;j++){var expritem=expr.tokens[j],replitem=new Token(expritem.type_,expritem.index_,expritem.prio_,expritem.number_);newexpression.push(replitem)}else newexpression.push(item);return new Expression(newexpression,object(this.ops1),object(this.ops2),object(this.functions))},evaluate:function(values){values=values||{};var f,i,item,n1,n2,nstack=[],L=this.tokens.length;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push(item.number_);else if(type_===TOP2)n2=nstack.pop(),n1=nstack.pop(),f=this.ops2[item.index_],nstack.push(f(n1,n2));else if(type_===TVAR)if(item.index_ in values)nstack.push(values[item.index_]);else{if(!(item.index_ in this.functions))throw new Error("undefined variable: "+item.index_);nstack.push(this.functions[item.index_])}else if(type_===TOP1)n1=nstack.pop(),f=this.ops1[item.index_],nstack.push(f(n1));else{if(type_!==TFUNCALL)throw new Error("invalid Expression");if(n1=nstack.pop(),!(f=nstack.pop()).apply||!f.call)throw new Error(f+" is not a function");"[object Array]"==Object.prototype.toString.call(n1)?nstack.push(f.apply(void 0,n1)):nstack.push(f.call(void 0,n1))}}if(nstack.length>1)throw new Error("invalid Expression (parity)");return nstack[0]},toString:function(toJS){var f,i,item,n1,n2,nstack=[],L=this.tokens.length;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push(escapeValue(item.number_));else if(type_===TOP2)n2=nstack.pop(),n1=nstack.pop(),f=item.index_,toJS&&"^"==f?nstack.push("Math.pow("+n1+","+n2+")"):nstack.push("("+n1+f+n2+")");else if(type_===TVAR)nstack.push(item.index_);else if(type_===TOP1)n1=nstack.pop(),"-"===(f=item.index_)?nstack.push("("+f+n1+")"):nstack.push(f+"("+n1+")");else{if(type_!==TFUNCALL)throw new Error("invalid Expression");n1=nstack.pop(),f=nstack.pop(),nstack.push(f+"("+n1+")")}}if(nstack.length>1)throw new Error("invalid Expression (parity)");return nstack[0]},toLaTeX:function(){var f,i,item,n1,n2,nstack=[],L=this.tokens.length;for(i=0;i<L;i++){var type_=(item=this.tokens[i]).type_;if(type_===TNUMBER)nstack.push(escapeValue(item.number_));else if(type_===TOP2)n2=nstack.pop(),n1=nstack.pop(),"^"==(f=item.index_)?nstack.push("{"+n1+"}^{"+n2+"}"):"*"==f?nstack.push(n1+" \\times "+n2):"/"==f?nstack.push("\\frac{"+n1+"}{"+n2+"}"):nstack.push(n1+" "+f+" "+n2);else if(type_===TVAR)nstack.push(item.index_);else if(type_===TOP1)n1=nstack.pop(),"-"===(f=item.index_)?nstack.push(f+n1):nstack.push(f+" "+n1);else{if(type_!==TFUNCALL)throw new Error("invalid Expression");n1=nstack.pop(),f=nstack.pop(),nstack.push(f+" "+n1)}}if(nstack.length>1)throw new Error("invalid Expression (parity)");return nstack[0]},variables:function(){var i,L=this.tokens.length,vars=[];for(i=0;i<L;i++){var item=this.tokens[i];item.type_===TVAR&&-1==vars.indexOf(item.index_)&&vars.push(item.index_)}return vars},toJSFunction:function(param,variables){return new Function(param,"with(Parser.values) { return "+this.simplify(variables).toString(!0)+"; }")}},Parser}();SimParser.Constraint=function(){SimParser.ParserItem.call(this);var constraint,boundedConstraint,formulaName,name,varList,type;this.getName=function(){return name},this.setName=function(newName){name=newName},this.getFormulaName=function(){return formulaName},this.setFormulaName=function(newFormulaName){formulaName=newFormulaName},this.getConstraint=function(){return constraint},this.setConstraint=function(newConstraint){constraint=newConstraint},this.getType=function(){return type},this.setType=function(newType){type=newType},this.isConstraintBindable=function(varsWB){var varNames=getVarNames();r=!0;for(var i=0;i<varNames.length;i++)if(-1===varsWB.indexOf(varNames[i])){r=!1;break}return r},this.setAttributes=function(attr,node){void 0!==attr.name&&this.setName(attr.name),void 0!==attr.formula&&this.setFormulaName(attr.formula),void 0!==attr.clause&&this.setConstraint(attr.clause),void 0!==attr.type&&this.setType(attr.type)},this.bindConstraint=function(vars){varList=[];var c=constraint;tokens=c.match(/\w+/g);for(i=0;i<tokens.length;i++)for(var j=0;j<vars.length;j++)if(tokens[i]===vars[j].getName()){varList.push(vars[j]);break}for(var strVar=new String,i=0;i<varList.length;i++)strVar=strVar+varList[i].getName()+"="+varList[i].getValue()+";";return c=c.replace(/\bor\b/g,"||").replace(/\band\b/g,"&&"),boundedConstraint=strVar+"("+c+")"},this.evaluate=function(){if(boundedConstraint)return eval(boundedConstraint)},this.getVarNames=function(){for(var cNames=[],tokens=constraint.match(/\w+/g),i=0;i<tokens.length;i++)"and"===tokens[i].toString().toLowerCase()||"or"===tokens[i].toString().toLowerCase()||parseFloat(NaN!==tokens[i])||cNames.push(tokens[i]);return cNames},this.setEname("Constraint")},SimParser.Constraint.prototype=new SimParser.ParserItem,SimParser.Constraint.prototype.constructor=SimParser.Constraint,SimParser.ConstraintManager=function(){var constraints=[],that=this,subs={"&lt;":"<","&gt;":">"};this.getConstraints=function(){return constraints},this.setConstraints=function(root){constraints=[];var r=root.getElementsByTagName("constraints").item(0);if(null!==r&&r.hasChildNodes())for(var i=0;i<r.childNodes.length;i++){var attr={};if("#"!==r.childNodes[i].nodeName[0]){for(var j=0;j<r.childNodes[i].attributes.length;j++)attr[r.childNodes[i].attributes[j].name]=r.childNodes[i].attributes[j].nodeValue;c=new SimParser.Constraint,c.setAttributes(attr,r),constraints.push(c)}}},this.getConstraintNames=function(funcName,filter){var cNames=[];void 0===filter&&(filter="pre-condition");for(var i=0;i<constraints.length;i++)constraints[i].getFormulaName()===funcName&&constraints[i].getType()===filter&&cNames.push(constraints[i].getName());return cNames},this.getConstraintByName=function(cName,filter){void 0===filter&&(filter="pre-condition");for(var i=0;i<constraints.length;i++)if(constraints[i].getName()===cName&&constraints[i].getType()===filter)return constraints[i]},this.evalPreConstraints=function(fName,varValueList){var cEval=!0;void 0===fName&&(fName="");for(var cn=that.getConstraintNames(fName,"pre-condition"),j=0;j<cn.length;j++){var cnt=that.getConstraintByName(cn[j]),r=evalConstraint(cnt.getConstraint(),varValueList);if(!(cEval="boolean"==typeof r&&(cEval&&r)))break}return cEval},this.evalPostConstraints=function(fName,varValueList,funcValueList){var cEval=!0;void 0===fName&&(fName="");for(var varList=[],i=0;i<varValueList.length;i++)varList.push(varValueList[i]);for(i=0;i<funcValueList.length;i++)void 0!==funcValueList[i]&&varList.push(funcValueList[i]);for(var cn=that.getConstraintNames(fName,"post-condition"),j=0;j<cn.length;j++){var cnt=that.getConstraintByName(cn[j],"post-condition"),r=evalConstraint(cnt.getConstraint(),varList);if(!(cEval="boolean"==typeof r&&(cEval&&r)))break}return cEval};var evalConstraint=function(constraint,vars){for(var result=null,varList=[],c=constraint,variables=vars,nonVariableTokens=[],tokens=c.match(/\w+/g),i=0;i<tokens.length;i++){for(var tokenIsVariable=!1,j=0;j<variables.length;j++)if(tokens[i]===variables[j].name){varList.push(variables[j]),tokenIsVariable=!0;break}if(isNaN(tokens[i])&&"and"!==tokens[i]&&"or"!==tokens[i]&&0==tokenIsVariable&&!arrayContains(nonVariableTokens,tokens[i])){var pattern=new RegExp(tokens[i],"g"),newPatten="'"+tokens[i]+"'";c=c.replace(pattern,newPatten),nonVariableTokens.push(tokens[i])}}for(var strVar=new String,i=0;i<varList.length;i++)null!=varList[i].value[0]?strVar=isNaN(varList[i].value[0])?strVar+varList[i].name+"='"+varList[i].value+"';":strVar+varList[i].name+"="+varList[i].value+";":null!=varList[i].value&&(strVar=isNaN(varList[i].value)?strVar+varList[i].name+"='"+varList[i].value+"';":strVar+varList[i].name+"="+varList[i].value+";");c=c.replace(/\bor\b/g,"||").replace(/\band\b/g,"&&");try{result=eval(strVar+"("+c+")")}catch(err){result=err.message}return result},arrayContains=function(arr,obj){for(var i=arr.length;i--;)if(arr[i]===obj)return!0;return!1}},SimParser.Permutation=function(vars){var n=vars.length,pia=[],piv=[],rs=[],init=function(){rs=[];for(var i=0;i<n;i++)pia[i]=0,piv[i]=vars[i].length-1},next=function(){for(var i=n-1;i>=0;i--){if(pia[i]<piv[i])return pia[i]++,!0;for(var j=i-1;j>=0&&pia[j]===piv[j];)j--;if(j<0)return!1;pia[j]++;for(var k=j+1;k<=i;k++)pia[k]=0;return!0}},currentPermutation=function(){var cp=[];for(i=0;i<n;i++)cp.push(vars[i][pia[i]]);return cp};return function(){init();do{rs.push(currentPermutation())}while(next());return rs}()},SimParser.Function=function(){SimParser.ParserItem.call(this);var name,nameProxy,equation="",varList=[],value,context,type="regualar",variable,parser=new Parser,lookup,code="",func,keyName=void 0,filter="",scoreable="yes",orderedEvaluation=!1,depLevel=-1,compOrder=-1;this.bindVariables=function(vars){for(var vList=[],p=parser.parse(equation),i=0;i<p.tokens.length;i++)if(3===p.tokens[i].type_){for(var j=0;j<vars.length;j++){var v=void 0;if(vars[j].getName()===p.tokens[i].index_){v=vars[j];break}}v&&vList.push(v)}this.setVarList(vList)},this.evaluateEquation=function(){for(var bindList={},i=0;i<varList.length;i++)bindList[varList[i].getName()]=varList[i].getValue();return parser.parse(this.getEquation()).evaluate(bindList)},this.testAnswer=function(testValue){return value===testValue},this.getValue=function(){return value},this.setValue=function(newValue){return value=newValue,this},this.getEquation=function(){return equation},this.setEquation=function(newEquation){return equation=newEquation,this},this.getVarList=function(){return varList},this.setVarList=function(vars){return varList=vars,this},this.setVarList=function(newVarList){return varList=newVarList,this},this.getName=function(){return name},this.setName=function(newName){return name=newName,this},this.getContext=function(){return context},this.setContext=function(newContext){return context=newContext,this},this.getDepLevel=function(){return depLevel},this.setDepLevel=function(level){depLevel=level},this.getCompOrder=function(){return compOrder},this.setCompOrder=function(newCompOrder){compOrder=newCompOrder},this.getVariable=function(){return variable},this.setVariable=function(newVariable){variable=newVariable},this.getCode=function(){return code},this.setCode=function(newCode){code=newCode},this.getScoreable=function(){return scoreable},this.setScoreable=function(newScorable){"no"!==newScorable&&(newScorable="yes"),scoreable=newScorable},this.getOrderedEvaluation=function(){return orderedEvaluation},this.setOrderedEvaluation=function(ordered){orderedEvaluation="yes"===ordered},this.getFunction=function(){if(!func){var params=this.getVarNames().join(",");func=new Function(params,"return "+this.getCode())}return func},this.getVarNames=function(){for(var fNames=[],p=parser.parse(equation),i=0;i<p.tokens.length;i++)3===p.tokens[i].type_&&-1===fNames.indexOf(p.tokens[i].index_)&&p.tokens[i].index_!==name&&(p.tokens[i].index_.length<5||"math."!=p.tokens[i].index_.substring(0,5).toLowerCase())&&fNames.push(p.tokens[i].index_);return fNames},this.getType=function(){return type},this.setType=function(t){type=t},this.getKeyName=function(){return keyName},this.setKeyName=function(k){keyName=k},this.getLookupValue=function(v){return lookup||(lookup={},lookup=eval("("+equation+")")),lookup[v]},this.getFilter=function(){return filter},this.setFilter=function(f){filter=f},this.getProxyName=function(){return nameProxy},this.setProxyName=function(p){nameProxy=p},this.setAttributes=function(attr,node){void 0!==attr.type&&this.setType(attr.type),void 0!==attr.nameProxy&&this.setProxyName(attr.nameProxy),void 0!==attr.name&&this.setName(attr.name),void 0!==attr.formula&&this.setEquation(attr.formula),void 0!==attr.context&&this.setContext(attr.context),void 0!==attr.value&&this.setValue(attr.value),void 0!==attr.variable&&this.setVariable(attr.variable),void 0!==attr.code&&("javascript"===this.getType()&&this.setEquation(attr.code),this.setCode(attr.code)),void 0!==attr.keyName&&this.setKeyName(attr.keyName),void 0!==attr.filter&&this.setFilter(attr.filter),this.setScoreable(attr.scoreable),void 0!==attr.orderedEvaluation&&this.setOrderedEvaluation(attr.orderedEvaluation)},this.setEname("Equation")},SimParser.Function.prototype=new SimParser.ParserItem,SimParser.Function.prototype.constructor=SimParser.Function,SimParser.FunctionManager=function(eUnit){function mergeArrays(arrayOne,arrayTwo){for(var result=[],i=0;i<arrayOne.length;i++)result.push(arrayOne[i]);for(i=0;i<arrayTwo.length;i++)result.push(arrayTwo[i]);return result}function compareArrays(arrayOne,arrayTwo){for(var i=0;i<arrayOne.length;i++)if(-1===arrayTwo.indexOf(arrayOne[i]))return!1;return!0}var functions=[],lfunctions=[],jfunctions=[],maxDepLevel=0,depTreeExists=!1,currentOrder=0,varCurrent=[],evUnit=eUnit,scoringTable=evUnit.getSimInstance().getScoringTable(),cMng=evUnit.getConstraintManager();this.getMaxDepLevel=function(){return maxDepLevel},this.setMaxDepLevel=function(level){maxDepLevel=level},this.getFunctions=function(){return functions},this.getLFunctions=function(){return lfunctions},this.getJFunctions=function(){return jfunctions},this.setFunctions=function(root){functions=[];var r=root.getElementsByTagName("functions").item(0);if(null!==r&&r.hasChildNodes())for(var i=0;i<r.childNodes.length;i++){var attr={};if("#"!==r.childNodes[i].nodeName[0]){for(var j=0;j<r.childNodes[i].attributes.length;j++)attr[r.childNodes[i].attributes[j].name]=r.childNodes[i].attributes[j].nodeValue;var newFunction=new SimParser.Function;newFunction.setAttributes(attr,r),"no"!==newFunction.getScoreable()&&scoringTable.addElement(newFunction.getName(),"output"),functions.push(newFunction)}}},this.getFunctionNames=function(){for(var fNames=[],i=0;i<functions.length;i++)fNames.push(functions[i].getName());return fNames},this.getFunctionByName=function(funcName){for(i=0;i<functions.length;i++)if(functions[i].getName()===funcName)return functions[i];for(i=0;i<lfunctions.length;i++)if(lfunctions[i].getName()===funcName)return lfunctions[i];for(var i=0;i<jfunctions.length;i++)if(jfunctions[i].getName()===funcName)return jfunctions[i]},this.getLFunctionByName=function(funcName){for(var i=0;i<functions.length;i++)if(lfunctions[i].getName()===funcName)return lfunctions[i]},this.evaluateOrderedFunctions=function(){var evaluationSucceed=!0,iCompOrder=0,vMng=evUnit.getVariableManager();varCurrent=vMng.getVariableNames(["binding","constant","implicit","persistent","cumulative"]);for(var i=0;i<functions.length;i++)if(1==functions[i].getOrderedEvaluation()){if(!this.canComputeFunction(functions[i],varCurrent)){EU.debug("Function evaluation cannot work because ordered function "+functions[i].getValue()+" cannot be evaluated"),evaluationSucceed=!1,depTreeExists=!0;break}functions[i].setCompOrder(iCompOrder),iCompOrder++;var varNext=[];varNext.push(functions[i].getValue()),varCurrent=mergeArrays(varCurrent,varNext)}1==evaluationSucceed&&(currentOrder=iCompOrder)},this.buildFunctionDependancyTree=function(){if(this.evaluateOrderedFunctions(),!depTreeExists){for(var orderedFuncList=[],varNext=[],iCompOrder=currentOrder,iDepLevel=0,bEnd=!1,iTotalAmount=functions.length;iCompOrder<iTotalAmount&&!bEnd;){for(var oldCompOrder=iCompOrder,k=0;k<functions.length;k++)0==functions[k].getOrderedEvaluation()&&-1===functions[k].getDepLevel()&&this.canComputeFunction(functions[k],varCurrent)&&(functions[k].setDepLevel(iDepLevel),functions[k].setCompOrder(iCompOrder),orderedFuncList.push(functions[k]),iCompOrder++,varNext.push(functions[k].getValue()));iDepLevel++,varCurrent=mergeArrays(varCurrent,varNext),bEnd=!!oldCompOrder==iCompOrder}iCompOrder===iTotalAmount?depTreeExists=!0:EU.debug("Function evaluation cannot work because of broken dependancy tree."),maxDepLevel=iDepLevel-1}},this.buildFuncVarMap=function(){for(var map={},i=0;i<functions.length;i++)map[functions[i].name]=functions[i].value;return map},this.canComputeFunction=function(func,values){var fvars;return fvars="lookup"==func.getType()?[func.getKeyName()]:func.getVarNames(),compareArrays(fvars,values)},this.getFunctionByCompOrder=function(order){for(var i=0;i<functions.length;i++)if(functions[i].getCompOrder()===order)return functions[i]},this.bindVars=function(){for(var i=0;i<functions.length;i++)functions[i].bindVariables(variables)},this.evalFuncs=function(){for(var res=[],i=0;i<functions.length;i++)res.push(functions[i].evaluateEquation())},this.evaluateLFunctions=function(varValueList,varNames,varValues){for(var r={},i=0;i<lfunctions.length;i++)if("yes"===lfunctions[i].getScoreable()){var varName=lfunctions[i].getName(),fName=lfunctions[i].getKeyName();if(varName&&cMng.evalPreConstraints(varName,varValueList)){var ind=varNames.indexOf(fName);if(ind>=0){var val=varValues[ind];r[varName]=lfunctions[i].getLookupValue(val),scoringTable.setValue(varName,null,r[varName])}}}return r};var evalFormula=function(formula,variables){var parser=new Parser;try{var result=parser.parse(formula).evaluate(variables)}catch(e){result=e.message}return result};this.evaluateJFunctions=function(varNames,varValues){for(var r={},v=new SimParser.Utils(evUnit).getVarObject(varNames,varValues),i=0;i<jfunctions.length;i++)if("yes"===jfunctions[i].getScoreable()){var varName=jfunctions[i].getName();if(varName){var sirF=jfunctions[i],jF=sirF.getFunction();v[varName]=jF,r[varName]=evalFormula(sirF.getEquation(),v),scoringTable.setValue(varName,null,r[varName])}}return r},this.getFunctionIndexByName=function(name,type){fn=this.getFunctions();if("lookup"===type)var fn=this.getLFunctions();for(var i=0;i<fn.length;i++)if(fn[i].getName()===name)return i},this.createFunction=function(name,type,formula,vName){var f=new SimParser.Function,attr={name:name,type:type,formula:formula,variable:vName};f.setAttributes(attr),"lookup"===attr.type?lfunctions.push(f):functions.push(f)},this.renameEquation=function(oldName,newName){var f=this.getFunctionByName(oldName);f&&f.setName(newName)},this.updateFunction=function(name,type,formula,vName){var f=this.getFunctionNames(name);if(f||(f=this.getLFunctionNames(name)),f){var attr={name:name,type:type,formula:formula,variable:vName};f.setAttributes(attr)}},this.deleteFunction=function(name){var i=this.getFunctionIndexByName(name);if(i)(fn=this.getFunctions()).splice(i,1);else if(i=this.getFunctionIndexByName(name,"lookup")){var fn=getLFunctions();fn.splice(i,1)}}},SimParser.FilterEvaluation=function(eUnit){function getValues(fName){for(var r=[],i=0;i<rs.length;i++)r.push(rs[i].functions[fName]);return r}function getVarValues(vName){for(var r=[],i=0;i<rs.length;i++)r.push(rs[i].variables[vName]);return r}function max(fName){for(var v=getValues(fName),f=!1,vr=impVar,maxValue=-1/0,i=0;i<v.length;i++)v[i]&&v[i]>maxValue&&(maxValue=v[i],vr[i],f=!0);return f?maxValue:void 0}function min(fName){for(var v=getValues(fName),vr=impVar,minValue=1/0,f=!1,i=0;i<v.length;i++)v[i]&&v[i]<minValue&&(minValue=v[i],vr[i],f=!0);return f?minValue:void 0}function average(fName){for(var v=getValues(fName),totValue=0,avValue=0,f=!1,i=0;i<v.length;i++)totValue+=v[i];return v.length>0&&(avValue=totValue/v.length,f=!0),f?avValue:void 0}var rs,impVar=[],evUnit=eUnit,vMng=evUnit.getVariableManager(),fMng=evUnit.getFunctionManager();this.run=function(result){rs=result;var fList=fMng.getFunctionNames(),impNames=vMng.getVariableNames(["implicit"]);if(1!==impNames.length)return rs;impVar=getVarValues(impNames[0]);for(i=0;i<fList.length;i++){var r={},filter=fMng.getFunctionByName(fList[i]).getFilter();if(""!==filter){getValues(fList[i]);for(var aFilter=filter.split(","),j=0;j<aFilter.length;j++)switch(aFilter[j]){case"max":r=max(fList[i]);break;case"min":r=min(fList[i]);break;case"average":r=average(fList[i])}for(var k=0;k<rs.length;k++){delete rs[k].functions[fList[i]];var allgone=!0;if(fList.length-1===i||k>0){for(var p in rs[k].functions)if(rs[k].functions.hasOwnProperty(p)){allgone=!1;break}allgone&&(delete rs[k].functions,delete rs[k].variables,rs[k]=void 0)}}rs[0].functions[fList[i]]=r}}for(var rs1=[],i=0;i<rs.length;i++)void 0!==rs[i]&&rs1.push(rs[i]);return rs1}},SimParser.Range=function(){SimParser.ParserItem.call(this);var name,type;this.getName=function(){return name},this.setName=function(newName){name=newName},this.getType=function(){return type},this.setType=function(newType){type=newType},SimParser.Range.prototype.setAttributes=function(attr){void 0!==attr.name&&this.setName(attr.name),void 0!==attr.type&&this.setType(attr.type)}},SimParser.Range.prototype=new SimParser.ParserItem,SimParser.Range.prototype.constructor=SimParser.Range,SimParser.RangeManager=function(){var ranges=[];this.getRanges=function(){return ranges},this.setRanges=function(root){ranges=[];var r=root.getElementsByTagName("ranges").item(0);if(null!==r&&r.hasChildNodes())for(var i=0;i<r.childNodes.length;i++){var attr={};if("#"!==r.childNodes[i].nodeName[0]){for(var j=0;j<r.childNodes[i].attributes.length;j++)attr[r.childNodes[i].attributes[j].name]=r.childNodes[i].attributes[j].nodeValue;switch(attr.type){case"range":rn=new SimParser.MinMaxRange;break;case"iterator":var rn=new SimParser.IterationRange}rn.setAttributes(attr,r),ranges.push(rn)}}},this.getRangeByName=function(name){for(var i=0;i<ranges.length;i++)if(ranges[i].getName()===name)return ranges[i]}},SimParser.MinMaxRange=function(){SimParser.Range.call(this);var values,minValue=new Number,maxValue=new Number,increment=new Number,currentValue=new Number;this.runNext=function(callback,params){currentValue<=maxValue&&(callback(params),currentValue++)},this.runAll=function(callback,params){for(var i=minValue;i<=maxValue;i+=increment)callback(params),currentValue=i},this.IsValueinRange=function(val){return value>=minValue&&value<=maxValue},this.reset=function(){currentValue=minValue},this.getValues=function(){return values},this.setValues=function(){values=[],void 0!==minValue&&void 0!==maxValue&&"undefined"!=typeof incrementValue||EU.debug("minValue/maxValue/increment is not defined in "+name);for(var curValue=minValue;curValue<=maxValue;)values.push(curValue),curValue+=increment},SimParser.MinMaxRange.prototype.setAttributes=function(attr){SimParser.Range.prototype.setAttributes.call(this,attr),minValue=void 0!==attr.minValue?parseInt(attr.minValue):1,maxValue=void 0!==attr.maxValue?parseInt(attr.maxValue):10,increment=void 0!==attr.increment?parseFloat(attr.increment):1,this.setValues()}},SimParser.MinMaxRange.prototype=new SimParser.Range,SimParser.MinMaxRange.prototype.constructor=SimParser.MinMaxRange,SimParser.IterationRange=function(){SimParser.Range.call(this);var values,startValue=new Number,numIterations=new Number,currentValue=new Number;this.runNext=function(callback,params){currentValue<=numIterations&&(callback(params),currentValue++)},this.runAll=function(callback,params){for(var i=1;i<=numIterations;i++)callback(params),currentValue=i},this.reset=function(){currentValue=1},this.getValues=function(){return values},this.getStartValue=function(){return startValue},this.setStartValue=function(newStartValue){startValue=newStartValue},this.setValues=function(){values=[],void 0!==startValue&&void 0!==numIterations||EU.debug("startValue or numIterations is not defined in "+name);for(var i=startValue;i<numIterations;i++)values.push(i)},this.getNumIterations=function(){return numIterations},this.setNumIterations=function(iterations){numIterations=iterations},SimParser.IterationRange.prototype.setAttributes=function(attr){SimParser.Range.prototype.setAttributes.call(this,attr),numIterations=void 0!==attr.numIteration?parseInt(attr.numIteration):10,startValue=void 0!==attr.startValue?parseInt(attr.startValue):1,void 0!==attr.type&&(this.type=attr.type),this.setValues()}},SimParser.IterationRange.prototype=new SimParser.Range,SimParser.IterationRange.prototype.constructor=SimParser.IterationRange,SimParser.Variable=function(){SimParser.ParserItem.call(this);var name,type,objectName,value=new Number;this.getName=function(){return name},this.setName=function(n){return name=n,this},this.getType=function(){return type},this.setType=function(t){return type=t,this},this.getValue=function(){return value},this.setValue=function(v){return value=v,this},this.getObjectName=function(){return objectName},this.setObjectName=function(o){return objectName=o,this},SimParser.Variable.prototype.setAttributes=function(attr,node){void 0!==attr.name&&this.setName(attr.name),void 0!==attr.type&&this.setType(attr.type),void 0!==attr.value&&this.setValue(attr.value),void 0!==attr.object&&this.setObjectName(attr.object)},this.setEname("BaseVariable")},SimParser.Variable.prototype=new SimParser.ParserItem,SimParser.Variable.prototype.constructor=SimParser.Variable,SimParser.VariableManager=function(eUnit){function createVariable(name,value,type){var vr=void 0,attr={type:type,name:name,value:value};switch(attr.type){case"binding":vr=new SimParser.BindableVariable;break;case"constant":vr=new SimParser.ConstantVariable;break;case"implicit":vr=new SimParser.ImplicitVariable,attr.sirRange=SirRangeManager.getRangeByName(attr.range);break;case"result":vr=new SimParser.ResultVariable;break;case"lookup":vr=new SimParser.LookupVariable}return!!vr&&(vr.setAttributes(attr),variables.push(vr),!0)}var variables=[],evUnit=eUnit,that=this;this.getVariables=function(){return variables},this.setVariables=function(root){if(variables=[],r=root.getElementsByTagName("variables").item(0),null!==r&&r.hasChildNodes())for(var i=0;i<r.childNodes.length;i++)if("#"!==r.childNodes[i].nodeName[0]){for(var attr={},rc=r.childNodes[i],j=0;j<r.childNodes[i].attributes.length;j++)attr[r.childNodes[i].attributes[j].name]=r.childNodes[i].attributes[j].nodeValue;if(rc.hasChildNodes()){for(var vals=[],k=0;k<rc.childNodes.length;k++)"#"!==rc.childNodes[k].nodeName[0]&&vals.push(rc.childNodes[k].textContent);attr.allValues=vals}var vr;switch(attr.type){case"binding":vr=new SimParser.BindableVariable;break;case"constant":vr=new SimParser.ConstantVariable;break;case"implicit":vr=new SimParser.ImplicitVariable;var rMng=evUnit.getRangeManager();attr.sirRange=rMng.getRangeByName(attr.range);break;case"result":vr=new SimParser.ResultVariable;break;case"lookup":vr=new SimParser.LookupVariable;break;case"cumulative":vr=new SimParser.CumulativeVariable;break;case"persistent":vr=new SimParser.PersistentVariable;break;default:vr=new SimParser.Variable}vr.setAttributes(attr,r),variables.push(vr)}},this.getConstants=function(){for(var cNames=[],vars=that.getVariables(),i=0;i<vars.length;i++)"constant"===vars[i].type&&cNames.push({name:vars[i].name,value:[vars[i].value]});return cNames},this.getVariableByName=function(vName){for(var i=0;i<variables.length;i++)if(variables[i].getName()===vName)return variables[i]},this.getVarIndexByName=function(vName){for(var i=0;i<variables.length;i++)if(variables[i].getName()===vName)return i},this.getVariableNames=function(filter){for(var vNames=[],i=0;i<variables.length;i++)(void 0===filter||filter.indexOf(variables[i].getType())>=0)&&vNames.push(variables[i].getName());return vNames},this.getVariableByObjectName=function(name){for(var i=0;i<variables.length;i++)if(variables[i].getObjectName()===name)return variables[i]},this.isVarBindable=function(vName){var v=that.getVariableByName(vName);return void 0!==v&&"binding"===v.type},this.isVarConstant=function(vName){var v=that.getVariableByName(vName);return void 0!==v&&"constant"===v.type},this.isVarImplicit=function(vName){var v=that.getVariableByName(vName);return void 0!==v&&"implicit"===v.type},this.isVarResult=function(vName){var v=that.getVariableByName(vName);return void 0!==v&&"result"===v.type},this.getConstantNames=function(){for(var cNames=[],vars=that.getVariables(),i=0;i<vars.length;i++)"constant"===vars[i].getType()&&cNames.push(vars[i].getName());return cNames},this.getConstants=function(){for(var cNames=[],vars=that.getVariables(),i=0;i<vars.length;i++)"constant"===vars[i].getType()&&cNames.push({name:vars[i].getName(),value:[vars[i].getValue()]});return cNames},this.saveVariable=function(name,value,type){var v=this.getVariableByName(name);v?(v.setValue(value),v.setName(name)):createVariable(name,value,type)},this.renameVariable=function(oldName,newName){var v=this.getVariableByName(oldName);v&&v.setName(newName)},this.updateVariable=function(name,value){var v=this.getVariableByName(name);if(v){var attr={name:name,value:value};v.setAttributes(attr)}},this.deleteVariable=function(name){var i=this.getVarIndexByName(name);i&&functions.splice(i,1)}},SimParser.PersistentVariable=function(){SimParser.Variable.call(this);var store;this.getStore=function(){return store},this.setStore=function(s){return store=s,this},SimParser.PersistentVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node),void 0!==attr.store&&this.setStore(attr.store),void 0!==attr.comOp&&this.setStore(attr.cumOP)},this.setEname("PersistentVariable")},SimParser.PersistentVariable.prototype=new SimParser.PersistentVariable,SimParser.PersistentVariable.prototype.constructor=SimParser.Variable,SimParser.ImplicitVariable=function(){SimParser.Variable.call(this);var allValues,range;this.getValues=function(){return allValues||(allValues=range?range.getValues():[])},this.bindRange=function(newRange){range=newRange},SimParser.ImplicitVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node),void 0!==attr.range&&this.bindRange(attr.sirRange),void 0!==attr.defaultValue&&this.setValue(attr.defaultValue)},this.setEname("ImplicitVariable")},SimParser.ImplicitVariable.prototype=new SimParser.ImplicitVariable,SimParser.ImplicitVariable.prototype.constructor=SimParser.Variable,SimParser.LookupVariable=function(){SimParser.Variable.call(this),this.getAllValues=function(){return[value]},SimParser.LookupVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node),void 0!==attr.value&&this.setValue(attr.value),void 0!==attr.defaultValue&&this.setValue(attr.defaultValue)},this.setEname("LookupVariable")},SimParser.LookupVariable.prototype=new SimParser.LookupVariable,SimParser.LookupVariable.prototype.constructor=SimParser.Variable,SimParser.BindableVariable=function(){SimParser.Variable.call(this);var allValues;this.getValues=function(){return allValues},this.setValues=function(v){return allValues=v,this},SimParser.BindableVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node),void 0!==attr.allValues&&this.setValues(attr.allValues),void 0!==attr.defaultValue&&this.setValue(attr.defaultValue)},this.setEname("BindableVariable")},SimParser.BindableVariable.prototype=new SimParser.BindableVariable,SimParser.BindableVariable.prototype.constructor=SimParser.Variable,SimParser.ConstantVariable=function(){SimParser.Variable.call(this);this.getAllValues=function(){return[value]},SimParser.ConstantVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node),void 0!==attr.object&&this.setObjectName(attr.object)},this.setEname("ConstantVariable")},SimParser.ConstantVariable.prototype=new SimParser.ConstantVariable,SimParser.ConstantVariable.prototype.constructor=SimParser.Variable,SimParser.CumulativeVariable=function(){SimParser.Variable.call(this);var store,cumOp;this.getStore=function(){return store},this.setStore=function(s){return store=s,this},this.getCumOp=function(){return cumOp},this.setCumOp=function(c){return cumOp=c,this},SimParser.CumulativeVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node),void 0!==attr.store&&this.setStore(attr.store),void 0!==attr.cumOp&&this.setCumOp(attr.cumOp)},this.setEname("CumulativeVariable")},SimParser.CumulativeVariable.prototype=new SimParser.CumulativeVariable,SimParser.CumulativeVariable.prototype.constructor=SimParser.Variable,SimParser.ResultVariable=function(){SimParser.Variable.call(this),SimParser.ResultVariable.prototype.setAttributes=function(attr,node){SimParser.Variable.prototype.setAttributes.call(this,attr,node)},this.setEname("ResultVariable")},SimParser.ResultVariable.prototype=new SimParser.ResultVariable,SimParser.ResultVariable.prototype.constructor=SimParser.Variable,SimParser.FunctionEvaluation=function(eUnit){function doInit(p,f){if(varNames=[],varValues=[],varFuncs=[],varList=[],void 0!==(varList=evUtils.readDataFromWhiteBoard("evaluationInput","input"))&&0!==varList.length){var vWB=evUtils.mergeWBVariables(varList);varNames=evUtils.getWBVarNames(vWB),varValues=evUtils.getWBVarValues(vWB),varNames=evUtils.convertElementNamesToVarNames(varNames),new Parser;for(var c=evUtils.getConstantValues(),i=0;i<c.vNames.length;i++)varNames.push(c.vNames[i]),varValues.push(c.vValues[i]);varFuncs=void 0===f?evUtils.getFuncVars():evUtils.getFuncVars(f);for(var impVars=evUtils.getImplicitValues(varFuncs),i=0;i<impVars.names.length;i++)varNames.push(impVars.names[i]),varValues.push(impVars.values[i])}else isContinue=!1}function doProcess(p,f){var param={};param.algorithm=void 0===p?"greedy":p;var fList=[];return void 0===f||null===f||""===f||(void 0===evUnit.getFunctionManager().getFunctionByName(f)?EU.debug("unknown function to evaluate: "+f):fList.push(f)),doProcess3()}function doProcess3(){var fMng=evUnit.getFunctionManager();fMng.buildFunctionDependancyTree();for(var result=[],persistentVarDB=evUnit.getSimInstance().getPersistentVariableDB(),funcCount=fMng.getFunctions().length,permList=SimParser.Permutation(varValues),varValueList=[],vMng=evUnit.getVariableManager(),cMng=evUnit.getConstraintManager(),i=0;i<permList.length;i++){varValueList=[];for(var fLastIteration=!1,k=0;k<varNames.length;k++)varValueList.push({name:varNames[k],value:permList[i][k]});for(k=0;k<funcCount;k++)null!=(sirF=fMng.getFunctionByCompOrder(k)).getValue()&&(null==(currentVariable=vMng.getVariableByName(sirF.getValue()))||"cumulative"!=currentVariable.getType()&&"persistent"!=currentVariable.getType()||null!=(variableStore=currentVariable.getStore())&&null!=persistentVarDB.getElementValue(variableStore)&&varValueList.push({name:sirF.getValue(),value:persistentVarDB.getElementValue(variableStore)}));var funcVector=[],varFuncVars=[],fEval=!0,fn=[];if(cMng.evalPreConstraints("",varValueList)){for(k=0;k<funcCount;k++){var sirF=fMng.getFunctionByCompOrder(k);if(fn[k]=sirF.getName(),cMng.evalPreConstraints(fn[k],varValueList)){if("lookup"!=sirF.getType()?funcVector[k]=evalFormula2(sirF.getEquation(),varValueList):funcVector[k]=evalLFunction(sirF,varValueList),null!=sirF.getValue()){if(null!=(currentVariable=vMng.getVariableByName(sirF.getValue()))&&"cumulative"==currentVariable.getType()){if(null!=(variableStore=currentVariable.getStore())){var cumOp=currentVariable.getCumOp(),variableCumOp="+";null!=cumOp&&("add"===cumOp?variableCumOp="+":"multiply"===cumOp?variableCumOp="*":"subtract"===cumOp?variableCumOp="-":"divide"===cumOp&&(variableCumOp="/")),persistentVarDB.updateElement(variableStore,funcVector[k],variableCumOp),funcVector[k]=persistentVarDB.getElementValue(variableStore)}}else null!=currentVariable&&"persistent"==currentVariable.getType()&&null!=(variableStore=currentVariable.getStore())&&persistentVarDB.updateElement(variableStore,funcVector[k],"overwrite");if("no"!==sirF.getScoreable()&&scoringTable().setValue(fn[k],null,funcVector[k]),varFuncVars[k]={name:sirF.getValue(),value:funcVector[k]},(fEval=fEval&&cMng.evalPostConstraints(fn[k],varValueList,varFuncVars))||(fLastIteration=!0),null!=currentVariable)if("cumulative"==currentVariable.getType()||"persistent"==currentVariable.getType()){for(l=0;l<varValueList.length;l++)if(varValueList[l].name===sirF.getValue()){varValueList[l].value=funcVector[k];break}}else varValueList.push({name:sirF.getValue(),value:funcVector[k]})}}else{var currentVariable=vMng.getVariableByName(sirF.getValue());if(null!=currentVariable&&"cumulative"==currentVariable.getType()){var variableStore=currentVariable.getStore();null!=variableStore&&(funcVector[k]=persistentVarDB.getElementValue(variableStore)),"no"!==sirF.getScoreable()&&scoringTable().setValue(fn[k],null,funcVector[k]),varFuncVars[k]={name:sirF.getValue(),value:funcVector[k]},(fEval=fEval&&cMng.evalPostConstraints(fn[k],varValueList,varFuncVars))||(fLastIteration=!0);for(var l=0;l<varValueList.length;l++)if(varValueList[l].name===sirF.getValue()){varValueList[l].value=funcVector[k];break}}}}if(result.push({functions:evUtils.packFunctionforWhiteboard(fn,funcVector),variables:evUtils.packVariablesforWhiteboard(varValueList)}),fLastIteration||!cMng.evalPostConstraints("",varValueList,varFuncVars))break}}if(0===result.length&&result.push({functions:void 0,variables:void 0}),(result=new SimParser.FilterEvaluation(evUnit).run(result)).length>=0){var r=result[0].functions;if(r)for(var p in r)"undefined"!=p&&scoringTable().setValue(p,null,r[p])}return result}function evalLFunction(lFunction,varValueList){for(var keyValue,keyName=lFunction.getKeyName(),i=0;i<varValueList.length;i++){var obj=varValueList[i];obj.name==keyName&&(keyValue=obj.value)}return lFunction.getLookupValue(keyValue)}function doEnd(){for(var str,strCopy,r=[],r1="",rs=evalResult,fMng=evUnit.getFunctionManager(),k=0;k<rs.length;k++)if(str=rs[k].functions,strCopy={},void 0!==str){for(var p in str)if(str.hasOwnProperty(p)&&(strCopy[p]=str[p],str[p])){var prName=fMng.getFunctionByName(p).getProxyName();prName&&("string"==typeof str[p]?strCopy[prName]=str[p].replace(/:/g,"\\0x1G\\").replace(/,/g,"\\0x1H\\"):strCopy[prName]=str[p],p!==prName&&delete strCopy[p])}r.push(JSON.stringify(strCopy).replace(/:/g,"\\0x1F\\").replace(/,/g,"\\0x1E\\")+"\\0x1D\\")}r1=(r1=(r1=r.join("")).replace(/\\0x1H\\/g,",").replace(/\\0x1G\\/g,":")).replace(/{/g,"").replace(/}/g,"").replace(/;;/g,""),(r1=unescape(r1)).length>6&&"\\0x1D\\"===r1.substring(r1.length-6,r1.length)&&(r1=r1.substring(0,r1.length-6)),key=evUtils.writeDataOnWhiteBoard(r1,key,"evaluationOutput","output")}var key=void 0,varList=[],varNames=[],varValues=[],varFuncs=[],evalResult=[],isContinue=!0,evUnit=eUnit,evUtils=new SimParser.Utils(eUnit),scoringTable=function(){return evUnit.getSimInstance().getScoringTable()};this.process=function(p,f){new Date;doInit(0,f),isContinue&&(evalResult=doProcess(p,f)).length>0&&doEnd();new Date;return evalResult};var evalFormula2=function(formula,variables){var parser=new Parser;vars={};for(var i=0;i<variables.length;i++)vars[variables[i].name]=variables[i].value;try{var result=parser.parse(formula).evaluate(vars)}catch(e){result=e.message}return result}},SimParser.EvaluationUnit=function(sim){function setEvents(element,node){var attributes,events=[],children=node.childNodes;if(null!=children&&void 0!=children)for(var j=0;j<children.length;j++)if("event"===children[j].nodeName){var eventInfo=createEvent(element,attributes=children[j].attributes);element.addEvent(eventInfo.theEvent,eventInfo.direction)}return events}function createEvent(obj,attributes){for(var response=[],data="",ctx="",dir="",type="",postOnChange="no",completeWithoutOutput=!1,k=0;k<attributes.length;k++)switch(attributes[k].nodeName){case"direction":dir=attributes[k].nodeValue;break;case"data":data=attributes[k].nodeValue;break;case"context":ctx=attributes[k].nodeValue;break;case"type":type=attributes[k].nodeValue;break;case"postOnChange":postOnChange=attributes[k].nodeValue;break;case"completeWithoutOutput":completeWithoutOutput="yes"===attributes[k].nodeValue}return response.theEvent=new Simulator.Event(obj,type,ctx,data,postOnChange,completeWithoutOutput),response.direction=dir,response}function debug(str1,str2,trace){dbg().debug(source,str1,str2,trace)}var root,source="EvaluationUnit",vMng=new SimParser.VariableManager(this),cMng=new SimParser.ConstraintManager(this),rMng=new SimParser.RangeManager(this),simInstance=sim,dbg=function(){return sim.getDebug()},isRunning=!1,eventElement=new Simulator.SimElement(sim);this.getVariableManager=function(){return vMng},this.getConstraintManager=function(){return cMng},this.getRangeManager=function(){return rMng},this.getSimInstance=function(){return simInstance};var fMng=new SimParser.FunctionManager(this);this.getFunctionManager=function(){return fMng};var fEvaluation=new SimParser.FunctionEvaluation(this);this.evaluateFunction=function(funcName){for(var func=fMng.getFunctionByName(funcName),vars=func.getVarList(),valueList=[],results=[],i=0;i<vars.length;i++)valueList.push(vars[i].getValues());for(var permList=SimParser.Permutation(valueList),i=0;i<permList.length;i++){for(var j=0;j<vars.length;j++)vars[j].setValue(permList[i][j]);results.push({params:permList[i],result:func.evaluateEquation()})}return results},this.functionVerifierEvaluation=function(){return runEvaluation(1)};var runEvaluation=function(funcVerifier){var result=!1;new Date;if(!isRunning){isRunning=!0;try{try{root?fMng.getFunctions().length+fMng.getLFunctions().length+fMng.getJFunctions().length>0&&(funcVerifier?result=fEvaluation.process("greedy"):(fEvaluation.process("greedy"),result=!0)):Simulator.showAlertWarning("Evaluation Unit is not loaded")}catch(e){EU.debug(e.message)}}finally{isRunning=!1}return result}};this.load=function(source){new Date;root=source,rMng.setRanges(root),vMng.setVariables(root),fMng.setFunctions(root),cMng.setConstraints(root),this.setupEvents()},eventElement.handleEvent=function(event){var simulationMgr=sim.getSimulationManager(),eventMgr=sim.getEventManager();switch(event.type){case"info":if(simulationMgr.trialLimitReached())return;if("inputAvailable"===event.context||"animationThreadFinished"===event.context){runEvaluation()&&eventMgr.postEvent(new Simulator.Event(this,"info","outputAvailable",null,!1));break}case"command":if(simulationMgr.trialLimitReached())return;if("startTrial"===event.context||"startAnimation"===event.context){runEvaluation()&&eventMgr.postEvent(new Simulator.Event(this,"info","outputAvailable",null,!1));break}default:return void debug(this.getName()+": Unhandled event type received: "+event.toString())}},this.setupEvents=function(){var r=root.getElementsByTagName("unit").item(0);void 0!==r&&null!==r&&setEvents(eventElement,r)},this.getEvents=function(){return eventElement}},SimulationLoader=function(xmlText,callback){this._xmlText=xmlText,this._callback=callback},SimulationLoader.prototype.start=function(){SimulationLoader.parseImages(this._xmlText),SimulationLoader.parseFlash(this._xmlText);this._callback(this._xmlText)},SimulationLoader._regex_images1=/image[\s]*=[\s]*".*"/g,SimulationLoader._regex_images2=/src[\s]*=[\s]*".*(.jpg | .png | .gif)\s*"/g,SimulationLoader._regex_flash1=/flash[\s]*=[\s]*\".*\"/g,SimulationLoader._regex_flash2=/src[\s]*=[\s]*\".*(swf)\s*\"/g,SimulationLoader._regex_flash3=/altSrc[\s]*=[\s]*\".*(swf)\s*\"/g,SimulationLoader._regex_translationImageElement=/^.*languageElement.*type="image\/.*$/gm,SimulationLoader._regex_translationFlashElement=/^.*languageElement.*type="application\/x-shockwave-flash.*$/gm,SimulationLoader._regex_extractAttribute=/="([^"]*)"/,SimulationLoader._regex_extractNodeValue=/>([^<]*)</,SimulationLoader._parse=function(xmlText,regex){var values=[],matches=xmlText.match(regex);if(null!=matches){var extractFile=function(str,isNodeValue){return isNodeValue?str.match(SimulationLoader._regex_extractNodeValue)[1]:str.match(SimulationLoader._regex_extractAttribute)[1]};if(regex==this._regex_translationImageElement||regex==this._regex_translationFlashElement)for(i=0;i<matches.length;i++)values.push(extractFile(matches[i],!0));else for(var i=0;i<matches.length;i++)values.push(extractFile(matches[i]))}return values},SimulationLoader.parseImages=function(xmlText){"string"!=typeof xmlText&&(xmlText=(new XMLSerializer).serializeToString(xmlText));var imageFiles=[];imageFiles=xmlText.indexOf("<translation>")>-1?imageFiles.concat(this._parse(xmlText,this._regex_translationImageElement)):(imageFiles=imageFiles.concat(this._parse(xmlText,this._regex_images1))).concat(this._parse(xmlText,this._regex_images2));for(var i=0;i<imageFiles.length;i++)imageFiles[i]=SimulationLoader.resolveUrl(imageFiles[i]);return imageFiles},SimulationLoader.parseFlash=function(xmlText){"string"!=typeof xmlText&&(xmlText=(new XMLSerializer).serializeToString(xmlText));var flashFiles=[];flashFiles=xmlText.indexOf("<translation>")>-1?flashFiles.concat(this._parse(xmlText,this._regex_translationFlashElement)):(flashFiles=(flashFiles=flashFiles.concat(this._parse(xmlText,this._regex_flash1))).concat(this._parse(xmlText,this._regex_flash2))).concat(this._parse(xmlText,this._regex_flash3));for(var i=0;i<flashFiles.length;i++)flashFiles[i]=SimulationLoader.resolveUrl(flashFiles[i]);return flashFiles},SimulationLoader.fixPaths=function(xmlText,baseUrl){return xmlText=xmlText.replace(/src=\"/g,'src="'+baseUrl),xmlText=xmlText.replace(/altSrc=\"/g,'altSrc="'+baseUrl),xmlText=xmlText.replace(/image=\"/g,'image="'+baseUrl),xmlText=xmlText.replace(/deleteRowImage=\"/g,'deleteRowImage="'+baseUrl),xmlText=xmlText.replace(/flash=\'"/g,'flash="'+baseUrl)},SimulationLoader.resolveUrl=function(url){url=(url=url.replace(/&amp;/g,"&")).split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var el=document.createElement("div");return el.innerHTML='<a href="'+url+'">x</a>',el.firstChild.href},function(CM,TS){function create(page,item,containerEl,simXml){for(var simulator=null,simImageFiles=SimulationLoader.parseImages(simXml),i=0;i<simImageFiles.length;i++){var loaderImage=new ResourceLoader.Image(simImageFiles[i]);page.addResourceLoader(loaderImage)}for(var simSWFFiles=SimulationLoader.parseFlash(simXml),i=0;i<simSWFFiles.length;i++){var loaderBinary=new ResourceLoader.Binary(simSWFFiles[i]);page.addResourceLoader(loaderBinary)}var responseXml;responseXml=TS&&TS.PageManager?TS.PageManager.getResponse(item.position).getLastValue():item.value,simulator=new Simulator.Simulator(containerEl,CM.isAccessibilityEnabled()),Simulator.Animation.FlashAnimationInterface.MapInstance(simulator),simulator.setAnimationShellPath(CM.resolveBaseUrl("Scripts/Simulator2/Renderer/SWF/SimulationShell.swf")),simulator.setAnimationExternalScriptsPath(CM.resolveBaseUrl("Scripts/Libraries")),simulator.setCurrentLanguage(CM.getLanguage()),simulator.loadXml(simXml,responseXml),item.simulator=simulator;var simWin=simulator.getWin(),simDoc=simulator.getDoc(),zoomImage=function(img){var zoom=page.getZoom();zoom&&zoom.updateElement(img)},updateZoom=function(){var zoom=page.getZoom();zoom&&zoom.updateElements(containerEl)};return YUD.batch(simDoc.getElementsByTagName("img"),function(img){Util.Dom.isImgLoaded(img)?zoomImage(img):YUE.on(img,"load",function(){zoomImage(img)})}),simulator.subscribe("info","animationEmbedded",function(evt){VideoManager.SWF.stopRightClick(evt.data)}),simulator.subscribe("info","imageEmbedded",function(evt){updateZoom()}),simulator.subscribe("info","simulatorStateChange",function(evt){if(YAHOO.lang.isString(evt.data)){var eventType=evt.data.toUpperCase();"READY"==eventType?(item.isReadOnly()&&simulator.setReadOnlyState(!0),YUD.removeClass(containerEl,"loading")):"ERROR"==eventType&&YUD.addClass(containerEl,"failed")}}),"object"==typeof TDS.Diagnostics&&TDS.Diagnostics.addErrorHandler(simWin),simulator}function Widget_Sim(page,item,config){this.simulator=null}CM.registerWidget("simulator",Widget_Sim,function(page,item,content){var id="SimContainer_"+item.position,el=document.getElementById(id);return!(!el||!item.rendererSpec)&&new CM.WidgetConfig(id,el,item.rendererSpec)});var match_QTI=CM.QTI.createWidgetMatch("customInteraction","sim");CM.registerWidget("qti.simulator",Widget_Sim,match_QTI),Widget_Sim.prototype.load=function(){this.simulator=create(this.page,this.entity,this.element,this.config)},Widget_Sim.prototype.zoom=function(level){this.simulator.zoom(level)},Widget_Sim.prototype.show=function(){this.simulator.setVisibilityAndAttachEvents(!0)},Widget_Sim.prototype.hide=function(){this.simulator.setVisibilityAndAttachEvents(!1),this.simulator.hide()},Widget_Sim.prototype.focus=function(){this.simulator.focus()},Widget_Sim.prototype.blur=function(){this.simulator.blur()},Widget_Sim.prototype.isResponseAvailable=function(){return this.simulator&&this.simulator.isLoaded()},Widget_Sim.prototype.getResponse=function(){var value=this.simulator.getResponseXml(),isValid=this.simulator.isValid();return this.createResponse(value,isValid)},Widget_Sim.prototype.setResponse=function(value){this.simulator.loadResponseXml(value)}}(window.ContentManager,window.TestShell),function(){window.MathEditorContent||(window.MathEditorContent={});var greek={title:"Greek",type:"row",items:["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi"]},trig={title:"Trigonometry",type:"row",items:["sin","cos","tan","arcsin","arccos","arctan"]},numbers={title:"Numbers",type:"grid",cols:3,items:["1","2","3","4","5","6","7","8","9","0",".",{key:"fraction",text:"fraction",value:"\\frac{\\PH}{\\PH}",css:"mathjax_editor_button_fraction"}]},numbersminus={title:"Numbers",type:"grid",cols:3,items:["1","2","3","4","5","6","7","8","9","0",".","-"]},numpad={title:"Number Pad",type:"numpad",items:["7","8","9","4","5","6","1","2","3","0","."]},decimalnumbers={title:"Numbers",type:"grid",cols:3,items:["1","2","3","4","5","6","7","8","9","0","."]},operations={title:"Operations_After_Grade_6",type:"row",items:["+","-",{key:"*",text:"*"},"div"]},operations_muldot={title:"OperationsWithCDot",type:"row",items:["+","-",{key:"*",value:"\\bullet",css:"mje_button_dot"},"div"]},operations_calc={title:"Operations",type:"row",items:["+","-",{key:"*",text:"*"},"div",{key:"nrt",value:"\\sqrt[\\PH]{\\PH}",css:"mathjax_editor_button_nrt"},{key:"fraction",value:"\\frac{\\PH}{\\PH}",css:"mathjax_editor_button_fraction"},{key:"intV",value:"\\int_\\PH^\\PH \\PH",css:"mathjax_editor_button_intergal_vals",text:eval('"\\u222B"')},{key:"sub",value:"\\PH_\\PH",css:"mathjax_editor_button_sub"},{key:"sup",value:"\\PH^\\PH",css:"mathjax_editor_button_sup"}]},operation_simple={title:"Operations",type:"row",items:["+","-","times","div"]},signs_basic={title:"Signs",type:"row",items:["lt","=","gt"]},signs={title:"Signs",type:"row",items:["lt","le","=","ge","gt"]},basic_variables={title:"Variables",type:"row",items:["x","y"]},variables={title:"Variables",type:"row",items:["f","n","x","y",{key:"sub",value:"\\PH_{\\PH}"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"( )",value:"(\\PH)"}]},fractions={title:"Fractions",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"}]},calc={title:"Calculus",type:"row",items:[{key:"subsup",value:"\\PH_{\\PH}^{\\PH}",css:""}]},other={title:"Other",type:"row",items:[{key:"| |",value:"\\lvert\\PH\\rvert",css:""},{key:"( )",value:"(\\PH)"}]},functions={title:"Functions",type:"grid",cols:2,items:["(",")","sin","cos","tan",{key:"e^x",value:"e^{\\PH}",text:"e^exp"},"ln","log",{key:"n!",value:"\\PH!",text:"n!"},{key:"FBoxes",value:"\\frac{\\PH}{\\PH}",text:"fraction"},{key:"x^y",text:"x^y",value:"x^y"},{key:"x^2",value:"x^2",text:"x^2"},{key:"x^3",text:"x^3",value:"x^3"},"pi","abs"]},row3_sbac4={title:"Other",type:"row",items:[{key:"( )",value:"(\\PH)"}]},row3_sbac5={title:"Other",type:"row",items:[{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"}]},row3_sbac6={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"}]},row3_sbac7={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},"pi"]},row3_sbac8={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi"]},row3_sbac10={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"sub",value:"\\PH_\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi","i"]},row3_utah3={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"( )",value:"(\\PH)"}]},row3_utah4={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"( )",value:"(\\PH)"}]},row3_utah5={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"}]},row3_utah6={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"}]},row3_utah7={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi"]},row3_utah8={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi"]},row3_utahsm1={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"sub",value:"\\PH_\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi"]},row3_utahsm2={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"sub",value:"\\PH_\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi","i"]},row3_utahsm3={title:"Other",type:"row",items:[{key:"fraction",value:"\\frac{\\PH}{\\PH}"},{key:"sup",value:"\\PH^\\PH"},{key:"sub",value:"\\PH_\\PH"},{key:"( )",value:"(\\PH)"},{key:"| |",value:"\\lvert\\PH\\rvert"},{key:"sqrt",value:"\\sqrt{\\PH}"},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}"},"pi","i"]};MathEditorContent.Config=MathEditorContent.Config||{},MathEditorContent.Config.Common=[{key:"Box",value:"\\Box",text:eval('"\\u2610"')},{key:"int",value:"\\int\\PH",text:eval('"\\u222B"')},{key:"abs",value:"\\lvert\\PH\\rvert",text:"| |"},{key:"sqrt",value:"\\sqrt\\PH",text:eval('"\\u221A"')},{key:"nrt",value:"\\sqrt[\\PH]{\\PH}",css:"mathjax_editor_button_nrt"},{key:"fraction",value:"\\frac{\\PH}{\\PH}",css:"mathjax_editor_button_fraction"},{key:"intV",value:"\\int_\\PH^\\PH \\PH",css:"mathjax_editor_button_intergal_vals",text:eval('"\\u222B"')},{key:"sub",value:"\\PH_\\PH",css:"mathjax_editor_button_sub"},{key:"sup",value:"\\PH^\\PH",css:"mathjax_editor_button_sup"},{key:"subsup",value:"\\PH_\\PH^\\PH",css:"mathjax_editor_button_subsup"}],MathEditorContent.Config.Rows={Numbers:numbers,NumPad:numpad,Signs:signs,Functions:functions,Other:other,Operations:operations,SimpleOperation:operation_simple,OperationsWithCDot:operations_muldot,Greek:greek,Trigonometry:trig,Algebra:basic_variables,Fraction:fractions},MathEditorContent.Config.Tabs={Order:["Numbers","Basic","Algebra","Calculus","SBAC3","SBAC4","SBAC5","SBAC6","SBAC7","SBAC8","SBAC9","SBAC10","SBAC11","Utah3","Utah4","Utah5","Utah6","Utah7","Utah8","UtahSM1","UtahSM2","UtahSM3"],Numbers:{title:"Numbers",rows:[numbers]},Basic:{title:"Basic",rows:[numbers,operation_simple,signs_basic,fractions]},Algebra:{title:"Algebra",rows:[numbers,basic_variables,operations,signs,other]},Calculus:{title:"Calculus",rows:[numbers,variables,operations_calc,signs,trig]},SBAC3:{title:"SBAC3",rows:[numbers,operation_simple,signs_basic,row3_sbac4]},SBAC4:{title:"SBAC4",rows:[numbers,operation_simple,signs_basic,row3_sbac4]},SBAC5:{title:"SBAC5",rows:[numbers,operation_simple,signs_basic,row3_sbac5]},SBAC6:{title:"SBAC6",rows:[numbersminus,operations,signs_basic,row3_sbac6]},SBAC7:{title:"SBAC7",rows:[numbersminus,operations,signs,row3_sbac7]},SBAC8:{title:"SBAC8",rows:[numbersminus,operations,signs,row3_sbac8]},SBAC9:{title:"SBAC9",rows:[numbersminus,operations,signs,row3_sbac8]},SBAC10:{title:"SBAC10",rows:[numbersminus,operations,signs,row3_sbac10]},SBAC11:{title:"SBAC11",rows:[numbersminus,operations,signs,row3_sbac10,trig]},Utah3:{title:"Utah3",rows:[decimalnumbers,operation_simple,signs_basic,row3_utah3]},Utah4:{title:"Utah4",rows:[decimalnumbers,operation_simple,signs_basic,row3_utah4]},Utah5:{title:"Utah5",rows:[decimalnumbers,operation_simple,signs_basic,row3_utah5]},Utah6:{title:"Utah6",rows:[numbersminus,operations_muldot,signs_basic,row3_utah6]},Utah7:{title:"Utah7",rows:[numbersminus,operations_muldot,signs,row3_utah7]},Utah8:{title:"Utah8",rows:[numbersminus,operations_muldot,signs,row3_utah8]},UtahSM1:{title:"UtahSM1",rows:[numbersminus,operations_muldot,signs,row3_utahsm1]},UtahSM2:{title:"UtahSM2",rows:[numbersminus,operations_muldot,signs,row3_utahsm2,trig]},UtahSM3:{title:"UtahSM3",rows:[numbersminus,operations_muldot,signs,row3_utahsm3,trig]}},MathEditorContent.Config.Translator={_itemCollectioBuildComplete:!1,itemCollection:{keys:[],values:[]},_ignoreItems:[],buildItemCollection:function(){this._ignoreItems.push("("),this._ignoreItems.push(")");var keys=[],values=[];keys.push("Box"),values.push({key:"Box",text:"&#x25a1;",cmd:"\\Box",title:"box",arialabel:"box"}),keys.push("1"),values.push({key:"1",text:"1",title:"one",arialabel:"one"}),keys.push("2"),values.push({key:"2",text:"2",title:"two",arialabel:"two"}),keys.push("3"),values.push({key:"3",text:"3",title:"three",arialabel:"three"}),keys.push("4"),values.push({key:"4",text:"4",title:"four",arialabel:"four"}),keys.push("5"),values.push({key:"5",text:"5",title:"five",arialabel:"five"}),keys.push("6"),values.push({key:"6",text:"6",title:"six",arialabel:"six"}),keys.push("7"),values.push({key:"7",text:"7",title:"seven",arialabel:"seven"}),keys.push("8"),values.push({key:"8",text:"8",title:"eight",arialabel:"eight"}),keys.push("9"),values.push({key:"9",text:"9",title:"nine",arialabel:"nine"}),keys.push("0"),values.push({key:"0",text:"0",title:"zero",arialabel:"zero"}),keys.push("+"),values.push({key:"+",text:"+",title:"plus",arialabel:"plus"}),keys.push("-"),values.push({key:"-",text:"-",title:"minus",arialabel:"minus"}),keys.push("."),values.push({key:".",text:".",title:"period",arialabel:"period"}),keys.push("div"),values.push({key:"div",text:"&#xF7;",title:"divison",arialabel:"divison"}),keys.push("*"),values.push({key:"*",text:"&#x2217;",cmd:"\\ast",title:"asterisk",arialabel:"multiply"}),keys.push("mje_button_dot"),values.push({key:"cdot",text:"&#x2219;",css:"mje_button_dot",title:"cdot",arialabel:"multiply"}),keys.push("times"),values.push({key:"times",text:"&#215;",title:"times",arialabel:"multiply"}),keys.push("fraction"),values.push({key:"fraction",cmd:"/",css:"mje_button_fraction",title:"fraction",arialabel:"fraction"}),keys.push("FBoxes"),values.push({key:"FBoxes",cmd:"/",css:"mje_button_fraction",title:"fboxes",arialabel:"fraction"}),keys.push("lt"),values.push({key:"lt",text:"&#x3C;",title:"lt",arialabel:"Less Than"}),keys.push("le"),values.push({key:"le",text:"&#x2264;",title:"le",arialabel:"Less Than Equal To"}),keys.push("="),values.push({key:"=",text:"&#x3D;",title:"eq",arialabel:"Equals"}),keys.push("ge"),values.push({key:"ge",text:"&#x2265;",title:"ge",arialabel:"Greater Than"}),keys.push("gt"),values.push({key:"gt",text:"&#x3E;",title:"gt",arialabel:"Greater Than Equal To"}),keys.push("sqrt"),values.push({key:"sqrt",cmd:"\\sqrt",css:"mje_button_sqrt",title:"sqroot",arialabel:"Square Root"}),keys.push("nrt"),values.push({key:"nrt",cmd:"\\nthroot",css:"mje_button_nrt",title:"nthroot",arialabel:"Nth Root"}),keys.push("intV"),values.push({key:"intV",text:"&#x0222B;",title:"integral",arialabel:"Integral"}),keys.push("sup"),values.push({key:"sup",cmd:"^",css:"mje_button_sup",title:"exponent",arialabel:"exponent"}),keys.push("sub"),values.push({key:"sub",cmd:"_",css:"mje_button_sub",title:"subscript",arialabel:"subscript"}),keys.push("( )"),values.push({key:"( )",text:"( )",cmd:"(",title:"parentheses",arialabel:"parentheses"}),keys.push("| |"),values.push({key:"| |",text:"| |",cmd:"|",title:"absvalue",arialabel:"absolute value"}),keys.push("prod"),values.push({key:"prod",text:"&#x3C0;",cmd:"\\pi",title:"pi",arialabel:"PI"}),keys.push("log"),values.push({key:"log",text:"log",cmd:"\\log",title:"log",arialabel:"logarithm"}),keys.push("ln"),values.push({key:"ln",text:"ln",cmd:"\\ln",title:"ln",arialabel:"natural logarithm"}),keys.push("n!"),values.push({key:"n!",text:"!",title:"factorial",arialabel:"factorial"}),keys.push("pi"),values.push({key:"pi",text:"&#x3C0;",cmd:"\\pi",title:"pi",arialabel:"pi"}),keys.push("abs"),values.push({key:"abs",text:"| |",cmd:"|",title:"abs",arialabel:"absolute value"}),keys.push("sin"),values.push({key:"sin",text:"sin",cmd:"\\sin",title:"sin",arialabel:"sine",wrapargs:"true"}),keys.push("cos"),values.push({key:"cos",text:"cos",cmd:"\\cos",title:"cos",arialabel:"cosine",wrapargs:"true"}),keys.push("tan"),values.push({key:"tan",text:"tan",cmd:"\\tan",title:"tan",arialabel:"tangent",wrapargs:"true"}),keys.push("arcsin"),values.push({key:"arcsin",text:"arcsin",cmd:"\\arcsin",title:"arcsin",arialabel:"secant",wrapargs:"true"}),keys.push("arccos"),values.push({key:"arccos",text:"arccos",cmd:"\\arccos",title:"arccos",arialabel:"cosecant",wrapargs:"true"}),keys.push("arctan"),values.push({key:"arctan",text:"arctan",cmd:"\\arctan",title:"arctan",arialabel:"cotangent",wrapargs:"true"}),keys.push("alpha"),values.push({key:"alpha",text:"&#x03B1;",cmd:"\\alpha",title:"alpha",arialabel:"alpha"}),keys.push("beta"),values.push({key:"beta",text:"&#x03B2;",cmd:"\\beta",title:"beta",arialabel:"beta"}),keys.push("gamma"),values.push({key:"gamma",text:"&#x03B3;",cmd:"\\gamma",title:"gamma",arialabel:"gamma"}),keys.push("delta"),values.push({key:"delta",text:"&#x03B4;",cmd:"\\delta",title:"delta",arialabel:"delta"}),keys.push("epsilon"),values.push({key:"epsilon",text:"&#x03B5;",cmd:"\\epsilon",title:"epsilon",arialabel:"epsilon"}),keys.push("zeta"),values.push({key:"zeta",text:"&#x03B6;",cmd:"\\zeta",title:"zeta",arialabel:"zeta"}),keys.push("eta"),values.push({key:"eta",text:"&#x03B7;",cmd:"\\eta",title:"eta",arialabel:"eta"}),keys.push("theta"),values.push({key:"theta",text:"&#x03B8;",cmd:"\\theta",title:"theta",arialabel:"theta"}),keys.push("iota"),values.push({key:"iota",text:"&#x03B9;",cmd:"\\iota",title:"iota",arialabel:"iota"}),keys.push("kappa"),values.push({key:"kappa",text:"&#x03BA;",cmd:"\\kappa",title:"kappa",arialabel:"kappa"}),keys.push("lambda"),values.push({key:"lambda",text:"&#x03BB;",cmd:"\\lambda",title:"lambda",arialabel:"lambda"}),keys.push("mu"),values.push({key:"mu",text:"&#x03BC;",cmd:"\\mu",title:"mu",arialabel:"mu"}),keys.push("nu"),values.push({key:"nu",text:"&#x03BD;",cmd:"\\nu",title:"nu",arialabel:"nu"}),keys.push("xi"),values.push({key:"xi",text:"&#x03BE;",cmd:"\\xi",title:"xi",arialabel:"xi"}),keys.push("omicron"),values.push({key:"omicron",text:"&#x03BF;",title:"omicron",arialabel:"omicron"}),keys.push("rho"),values.push({key:"rho",text:"&#x03C1;",cmd:"\\rho",title:"rho",arialabel:"rho"}),keys.push("sigma"),values.push({key:"sigma",text:"&#x03C3;",cmd:"\\sigma",title:"sigma",arialabel:"sigma"}),keys.push("tau"),values.push({key:"tau",text:"&#x03C4;",cmd:"\\tau",title:"tau",arialabel:"tau"}),keys.push("upsilon"),values.push({key:"upsilon",text:"&#x03C5;",cmd:"\\upsilon",title:"upsilon",arialabel:"upsilon"}),keys.push("phi"),values.push({key:"phi",text:"&#x03C6;",cmd:"\\phi",title:"phi",arialabel:"phi"}),keys.push("chi"),values.push({key:"chi",text:"&#x03C7;",cmd:"\\chi",title:"chi",arialabel:"chi"}),keys.push("psi"),values.push({key:"psi",text:"&#x03C8;",cmd:"\\psi",title:"psi",arialabel:"psi"}),keys.push("x^y"),values.push({key:"x^y",text:"x^y",cmd:"x^y",insertraw:"true",title:"xpowery",arialabel:"x to the power y"}),keys.push("x^2"),values.push({key:"x^2",text:"x^2",cmd:"x^2",insertraw:"true",title:"xpower2",arialabel:"x to the power 2"}),keys.push("x^3"),values.push({key:"x^3",text:"x^3",cmd:"x^3",insertraw:"true",title:"xpower3",arialabel:"x to the power 3"}),this.itemCollection.keys=keys,this.itemCollection.values=values,this._itemCollectioBuildComplete=!0},getItem:function(key){this._itemCollectioBuildComplete||this.buildItemCollection();var ind=this.itemCollection.keys.indexOf(key);return-1===ind?key:this.itemCollection.values[ind]},ignoreKey:function(key){return this._itemCollectioBuildComplete||this.buildItemCollection(),-1!==this._ignoreItems.indexOf(key)},hasKey:function(key){return-1!==this.itemCollection.keys.indexOf(key)}},MathEditorContent.Config.EquationAdapter={_translator:MathEditorContent.Config.Translator,_PLACEHOLDER:"&##&",_FORMATTER:"\r\n",_Empty:"",convertToDesmosXml:function(xml){return this._parser(xml)},getTabXml:function(key){var tab=MathEditorContent.Config.Tabs[key];return'<tab title="'+tab.title+'">'+this._FORMATTER+this._rowsToXml(tab.rows)+this._FORMATTER+"</tab>"},getRowXml:function(key){var row=MathEditorContent.Config.Rows[key];return this._rowsToXml([row])},getItemXml:function(key){if(this._translator.ignoreKey(key))return this._Empty;var item=this._getItem(key);return this._toItemXml(item)},hasKey:function(key){return this._translator.hasKey(key)},_getItem:function(key){var item=this._translator.getItem(key);return item===key&&(item={key:key,title:key,arialabel:key,text:key,css:"mje_button_variable"}),item},_parser:function(xml){var xmlDoc=null,xmlSerializer=new XMLSerializer;window.DOMParser?xmlDoc=(new DOMParser).parseFromString(xml,"text/xml"):((xmlDoc=new ActiveXObject("Microsoft.XMLDOM")).async=!1,xmlDoc.loadXML(xml));for(var node=xmlDoc.childNodes[0],desmosXml="",mathml=$(node).find("editorconfig mathML"),labels=$(node).find("editorconfig editorLabels"),lblen=labels.length,i=0;i<mathml.length;i++)desmosXml+="<editorRow><editorLabels>"+(i<lblen?labels[i].textContent:"")+"</editorLabels>"+xmlSerializer.serializeToString(mathml[i].firstChild)+"</editorRow>";var tabContent=MathEditorContent.Config.Tabs,keypad="",tabConfigEl=$(node).find("editorconfig tabConfig");if(tabConfigEl.length>0){var tabStr="",orders=$(tabConfigEl[0]).find("Order");for(i=0,len=orders.length;i<len;i++){var tName=orders[i].firstChild.nodeValue;tabStr='<tab title="'+tName+'" >'+this._FORMATTER+this._PLACEHOLDER+"</tab>";var rows=[],tab=$(tabConfigEl[0]).find(tName);if(tab.length>0)for(var rowEls=$(tab[0]).find("rows"),j=0,elLen=rowEls.length;j<elLen;j++){for(var r={title:"",type:"",items:[]},k=0,plen=rowEls[j].childNodes.length;k<plen;k++)if("title"===rowEls[j].childNodes[k].nodeName)r.title=rowEls[j].childNodes[k].firstChild.nodeValue;else if("type"===rowEls[j].childNodes[k].nodeName)r.type=rowEls[j].childNodes[k].firstChild.nodeValue;else if("items"===rowEls[j].childNodes[k].nodeName)if(rowEls[j].childNodes[k].childNodes.length>1){var itObj={};$.each(rowEls[j].childNodes[k].childNodes,function(idx){"isparsed"===rowEls[j].childNodes[k].childNodes[idx].nodeName?itObj.isParsed=rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue:"key"===rowEls[j].childNodes[k].childNodes[idx].nodeName?(itObj.key=rowEls[j].childNodes[k].childNodes[idx].textContent,itObj.arialabel=rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue):"text"===rowEls[j].childNodes[k].childNodes[idx].nodeName&&null!=rowEls[j].childNodes[k].childNodes[idx].firstChild?itObj.text=rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue:"value"===rowEls[j].childNodes[k].childNodes[idx].nodeName&&null!=rowEls[j].childNodes[k].childNodes[idx].firstChild?itObj.value=rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue:"css"===rowEls[j].childNodes[k].childNodes[idx].nodeName&&null!=rowEls[j].childNodes[k].childNodes[idx].firstChild&&(itObj.css=rowEls[j].childNodes[k].childNodes[idx].firstChild.nodeValue)}),r.items.push(itObj)}else r.items.push(rowEls[j].childNodes[k].firstChild.nodeValue);rows.push(r)}else try{rows=tabContent[tName].rows}catch(e){console.log("$$$$$$ row configuration not found.");continue}keypad+=(tabStr=tabStr.replace(this._PLACEHOLDER,this._rowsToXml(rows)))+this._FORMATTER}}return desmosXml="<editorconfig>"+desmosXml+"<tabConfig>"+this._FORMATTER+keypad+"</tabConfig></editorconfig>"},_rowsToXml:function(rows){for(var keypad="",j=0,rlen=rows.length;j<rlen;j++){var r=rows[j];"grid"===r.type||"numpad"===r.type?keypad+='<grid cols="3" title="'+r.title+'">'+this._PLACEHOLDER+"</grid>"+this._FORMATTER:keypad+='<row title="'+r.title+'">'+this._PLACEHOLDER+"</row>"+this._FORMATTER;for(var items=r.items,itemStr="",k=0,ilen=items.length;k<ilen;k++)"object"==typeof items[k]?void 0!==items[k].isParsed&&items[k].isParsed?itemStr+=this._toItemXml({key:items[k].key,title:items[k].key,arialabel:items[k].key,text:items[k].text,css:"mje_button_variable"}):"*"==items[k].key&&items[k].css?itemStr+=this.getItemXml(items[k].css):itemStr+=this.getItemXml(items[k].key):itemStr+=this.getItemXml(items[k]);keypad=keypad.replace(this._PLACEHOLDER,this._FORMATTER+itemStr)}return keypad},_toItemXml:function(item){var xmlVal='<item title="'+item.title+'" aria-label="'+item.arialabel+'" ';return void 0!==item.cmd&&(xmlVal+='cmd="'+item.cmd+'" '),void 0!==item.css&&(xmlVal+='class="'+item.css+'" '),void 0!==item.insertraw&&(xmlVal+='insert-raw="'+item.insertraw+'" '),void 0!==item.wrapargs&&(xmlVal+='wrap-args="'+item.wrapargs+'" '),void 0!==item.text?xmlVal+=">"+item.text:xmlVal+=">",xmlVal+="</item>"+this._FORMATTER}},MathEditorContent.Config.PreviewFormatter={getPreviewXmlDoc:function(configXml){for(var newXmlDoc=$.parseXML(configXml),rows=($(newXmlDoc).find("item[title='cdot']").each(function(){$(this).attr("class")||($(this).text(""),$(this).attr("class","mje_button_dot"))}),$(newXmlDoc).find("editorconfig editorRow")),i=0,len=rows.length;i<len;i++){var mathml=$(rows[i]).find("math"),latexCmd="";mathml.length>0&&-1!=(latexCmd=window.MathEditorWidget.convertMathMlToLatex(mathml[0])).indexOf("##")&&(latexCmd=latexCmd.replace(/##/g,"\\MathQuillMathField{}"));var labels=$(rows[i]).find("editorLabels"),labelVal=labels.length>0?labels[0].textContent:"";labelVal=labelVal.replace(/ /g,"\\space "),rows[i].textContent=""!=labelVal?labelVal+"\\MathQuillMathField{}":labelVal+latexCmd}return newXmlDoc}}}(),function(){function AMcreateElementXHTML(t){return isIE?document.createElement(t):document.createElementNS("http://www.w3.org/1999/xhtml",t)}function compareNames(s1,s2){return s1.input>s2.input?1:-1}function AMcreateElementMathML(t){return isIE?document.createElement("m:"+t):document.createElementNS(AMmathml,t)}function AMcreateMmlNode(t,frag){if(isIE)node=document.createElement("m:"+t);else var node=document.createElementNS(AMmathml,t);return node.appendChild(frag),node}function AMremoveCharsAndBlanks(str,n){var st;st=str.slice(n);for(var i=0;i<st.length&&st.charCodeAt(i)<=32;i+=1);return st.slice(i)}function AMposition(arr,str,n){if(0==n){var h,m;for(n=-1,h=arr.length;n+1<h;)arr[m=n+h>>1]<str?n=m:h=m;return h}for(var i=n;i<arr.length&&arr[i]<str;i++);return i}function AMgetSymbol(str){for(var mk,st,tagst,k=0,match="",more=!0,i=1;i<=str.length&&more;i++)st=str.slice(0,i),(k=AMposition(AMnames,st,k))<AMnames.length&&str.slice(0,AMnames[k].length)==AMnames[k]&&(mk=k,i=(match=AMnames[k]).length),more=k<AMnames.length&&str.slice(0,AMnames[k].length)>=AMnames[k];return AMpreviousSymbol=AMcurrentSymbol,""!=match?(AMcurrentSymbol=AMsymbols[mk].ttype,AMsymbols[mk]):(AMcurrentSymbol=CONST,k=1,(st=/^[\d.]+/.exec(str))?(st=st[0],tagst="mn"):tagst=("A">(st=str.slice(0,1))||st>"Z")&&("a">st||st>"z")?"mo":"mi",{input:st,tag:tagst,output:st,ttype:CONST})}function AMparseSexpr(str){var symbol,node,result,result2,i,st,newFrag=document.createDocumentFragment();if(str=AMremoveCharsAndBlanks(str,0),null==(symbol=AMgetSymbol(str))||symbol.ttype==RIGHTBRACKET)return[null,str,null];if(symbol.ttype==DEFINITION&&(str=symbol.output+AMremoveCharsAndBlanks(str,symbol.input.length),null==(symbol=AMgetSymbol(str))||symbol.ttype==RIGHTBRACKET))return[null,str,null];switch(str=AMremoveCharsAndBlanks(str,symbol.input.length),symbol.ttype){case SPACE:return(node=AMcreateElementMathML(symbol.tag)).setAttribute(symbol.atname,symbol.atval),[node,str,symbol.tag];case UNDEROVER:return isIE&&"\\big"==symbol.input.substr(0,4)&&((symbol=AMgetSymbol(str="\\"+symbol.input.substr(4)+str)).ttype=UNDEROVER,str=AMremoveCharsAndBlanks(str,symbol.input.length)),[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str,symbol.tag];case CONST:output=symbol.output;if(isIE)if("'"==symbol.input)output="";else if("''"==symbol.input)output="";else if("'''"==symbol.input)output="";else if("''''"==symbol.input)output="";else if("\\square"==symbol.input)output="";else if("\\frac"==symbol.input.substr(0,5)){var denom=symbol.input.substr(6,1);if("5"==denom||"6"==denom)return str=symbol.input.replace(/\\frac/,"\\frac ")+str,[node,str,symbol.tag]}return node=AMcreateMmlNode(symbol.tag,document.createTextNode(output)),[node,str,symbol.tag];case LONG:return(node=AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output))).setAttribute("minsize","1.5"),node.setAttribute("maxsize","1.5"),(node=AMcreateMmlNode("mover",node)).appendChild(AMcreateElementMathML("mspace")),[node,str,symbol.tag];case STRETCHY:return isIE&&"\\backslash"==symbol.input&&(symbol.output="\\"),node=AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),"|"!=symbol.input&&"\\vert"!=symbol.input&&"\\|"!=symbol.input&&"\\Vert"!=symbol.input||(node.setAttribute("lspace","0em"),node.setAttribute("rspace","0em")),node.setAttribute("maxsize",symbol.atval),null!=symbol.rtag?[node,str,symbol.rtag]:[node,str,symbol.tag];case BIG:var atval=symbol.atval;return isIE&&(atval=symbol.ieval),null==(symbol=AMgetSymbol(str))?[null,str,null]:(str=AMremoveCharsAndBlanks(str,symbol.input.length),node=AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),isIE?((space=AMcreateElementMathML("mspace")).setAttribute("height",atval+"ex"),(node=AMcreateMmlNode("mrow",node)).appendChild(space)):(node.setAttribute("minsize",atval),node.setAttribute("maxsize",atval)),[node,str,symbol.tag]);case LEFTBRACKET:return"\\left"==symbol.input&&null!=(symbol=AMgetSymbol(str))&&("."==symbol.input&&(symbol.invisible=!0),str=AMremoveCharsAndBlanks(str,symbol.input.length)),result=AMparseExpr(str,!0,!1),null==symbol||"boolean"==typeof symbol.invisible&&symbol.invisible?node=AMcreateMmlNode("mrow",result[0]):(node=AMcreateMmlNode("mrow",node=AMcreateMmlNode("mo",document.createTextNode(symbol.output)))).appendChild(result[0]),[node,result[1],result[2]];case MATRIX:if("\\begin{array}"==symbol.input){var mask="";if(symbol=AMgetSymbol(str),str=AMremoveCharsAndBlanks(str,0),null==symbol)mask="l";else if(str=AMremoveCharsAndBlanks(str,symbol.input.length),"{"!=symbol.input)mask="l";else do{null!=(symbol=AMgetSymbol(str))&&(str=AMremoveCharsAndBlanks(str,symbol.input.length),"}"!=symbol.input&&(mask+=symbol.input))}while(null!=symbol&&""!=symbol.input&&"}"!=symbol.input);if(result=AMparseExpr("{"+str,!0,!0),node=AMcreateMmlNode("mtable",result[0]),mask=mask.replace(/l/g,"left "),mask=mask.replace(/r/g,"right "),mask=mask.replace(/c/g,"center "),node.setAttribute("columnalign",mask),node.setAttribute("displaystyle","false"),isIE)return[node,result[1],null];var lspace=AMcreateElementMathML("mspace");lspace.setAttribute("width","0.167em");var rspace=AMcreateElementMathML("mspace");return rspace.setAttribute("width","0.167em"),(node1=AMcreateMmlNode("mrow",lspace)).appendChild(node),node1.appendChild(rspace),[node1,result[1],null]}return result=AMparseExpr("{"+str,!0,!0),node=AMcreateMmlNode("mtable",result[0]),isIE?node.setAttribute("columnspacing","0.25em"):node.setAttribute("columnspacing","0.167em"),node.setAttribute("columnalign","right center left"),node.setAttribute("displaystyle","true"),node=AMcreateMmlNode("mrow",node),[node,result[1],null];case TEXT:return-1==(i="{"==str.charAt(0)?str.indexOf("}"):0)&&(i=str.length)," "==(st=str.slice(1,i)).charAt(0)&&((node=AMcreateElementMathML("mspace")).setAttribute("width","0.33em"),newFrag.appendChild(node)),newFrag.appendChild(AMcreateMmlNode(symbol.tag,document.createTextNode(st)))," "==st.charAt(st.length-1)&&((node=AMcreateElementMathML("mspace")).setAttribute("width","0.33em"),newFrag.appendChild(node)),str=AMremoveCharsAndBlanks(str,i+1),[AMcreateMmlNode("mrow",newFrag),str,null];case UNARY:if(null==(result=AMparseSexpr(str))[0])return[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str];if("boolean"==typeof symbol.func&&symbol.func)return"^"==(st=str.charAt(0))||"_"==st||","==st?[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str,symbol.tag]:(node=AMcreateMmlNode("mrow",AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output))),isIE&&((space=AMcreateElementMathML("mspace")).setAttribute("width","0.167em"),node.appendChild(space)),node.appendChild(result[0]),[node,result[1],symbol.tag]);if("\\sqrt"==symbol.input){if(isIE){var space=AMcreateElementMathML("mspace");return space.setAttribute("height","1.2ex"),space.setAttribute("width","0em"),(node=AMcreateMmlNode(symbol.tag,result[0])).appendChild(space),[node,result[1],symbol.tag]}return[AMcreateMmlNode(symbol.tag,result[0]),result[1],symbol.tag]}if("boolean"==typeof symbol.acc&&symbol.acc){node=AMcreateMmlNode(symbol.tag,result[0]);var output=symbol.output;isIE&&("\\hat"==symbol.input?output="":"\\widehat"==symbol.input?output="^":"\\bar"==symbol.input?output="":"\\grave"==symbol.input?output="":"\\tilde"==symbol.input&&(output=""));var node1=AMcreateMmlNode("mo",document.createTextNode(output));return"\\vec"!=symbol.input&&"\\check"!=symbol.input||node1.setAttribute("maxsize","1.2"),isIE&&"\\bar"==symbol.input&&node1.setAttribute("maxsize","0.5"),"\\underbrace"==symbol.input||"\\underline"==symbol.input?node1.setAttribute("accentunder","true"):node1.setAttribute("accent","true"),node.appendChild(node1),"\\overbrace"!=symbol.input&&"\\underbrace"!=symbol.input||(node.ttype=UNDEROVER),[node,result[1],symbol.tag]}if(!isIE&&void 0!==symbol.codes)for(i=0;i<result[0].childNodes.length;i++)if("mi"==result[0].childNodes[i].nodeName||"mi"==result[0].nodeName){st="mi"==result[0].nodeName?result[0].firstChild.nodeValue:result[0].childNodes[i].firstChild.nodeValue;for(var newst=[],j=0;j<st.length;j++)st.charCodeAt(j)>64&&st.charCodeAt(j)<91?newst+=String.fromCharCode(symbol.codes[st.charCodeAt(j)-65]):newst+=st.charAt(j);"mi"==result[0].nodeName?result[0]=AMcreateElementMathML("mo").appendChild(document.createTextNode(newst)):result[0].replaceChild(AMcreateElementMathML("mo").appendChild(document.createTextNode(newst)),result[0].childNodes[i])}return(node=AMcreateMmlNode(symbol.tag,result[0])).setAttribute(symbol.atname,symbol.atval),"\\scriptstyle"!=symbol.input&&"\\scriptscriptstyle"!=symbol.input||node.setAttribute("displaystyle","false"),[node,result[1],symbol.tag];case BINARY:return null==(result=AMparseSexpr(str))[0]?[AMcreateMmlNode("mo",document.createTextNode(symbol.input)),str,null]:null==(result2=AMparseSexpr(result[1]))[0]?[AMcreateMmlNode("mo",document.createTextNode(symbol.input)),str,null]:("\\root"!=symbol.input&&"\\stackrel"!=symbol.input||newFrag.appendChild(result2[0]),newFrag.appendChild(result[0]),"\\frac"==symbol.input&&newFrag.appendChild(result2[0]),[AMcreateMmlNode(symbol.tag,newFrag),result2[1],symbol.tag]);case INFIX:return str=AMremoveCharsAndBlanks(str,symbol.input.length),[AMcreateMmlNode("mo",document.createTextNode(symbol.output)),str,symbol.tag];default:return[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str,symbol.tag]}}function AMparseIexpr(str){var symbol,sym1,sym2,node,result,tag,underover;if(str=AMremoveCharsAndBlanks(str,0),sym1=AMgetSymbol(str),result=AMparseSexpr(str),node=result[0],str=result[1],tag=result[2],(symbol=AMgetSymbol(str)).ttype==INFIX)if(str=AMremoveCharsAndBlanks(str,symbol.input.length),null==(result=AMparseSexpr(str))[0]&&(result[0]=AMcreateMmlNode("mo",document.createTextNode(""))),str=result[1],tag=result[2],"_"==symbol.input||"^"==symbol.input){if(sym2=AMgetSymbol(str),tag=null,underover=sym1.ttype==UNDEROVER||node.ttype==UNDEROVER,"_"==symbol.input&&"^"==sym2.input){var res2=AMparseSexpr(str=AMremoveCharsAndBlanks(str,sym2.input.length));str=res2[1],tag=res2[2],(node=AMcreateMmlNode(underover?"munderover":"msubsup",node)).appendChild(result[0]),node.appendChild(res2[0])}else"_"==symbol.input?(node=AMcreateMmlNode(underover?"munder":"msub",node)).appendChild(result[0]):(node=AMcreateMmlNode(underover?"mover":"msup",node)).appendChild(result[0]);node=AMcreateMmlNode("mrow",node)}else node=AMcreateMmlNode(symbol.tag,node),"\\atop"!=symbol.input&&"\\choose"!=symbol.input||node.setAttribute("linethickness","0ex"),node.appendChild(result[0]),"\\choose"==symbol.input&&(node=AMcreateMmlNode("mfenced",node));return[node,str,tag]}function AMparseExpr(str,rightbracket,matrix){var symbol,node,result,i,tag,newFrag=document.createDocumentFragment();do{if(str=AMremoveCharsAndBlanks(str,0),result=AMparseIexpr(str),node=result[0],str=result[1],tag=result[2],symbol=AMgetSymbol(str),void 0!=node){if(("mn"==tag||"mi"==tag)&&null!=symbol&&"boolean"==typeof symbol.func&&symbol.func){var space=AMcreateElementMathML("mspace");space.setAttribute("width","0.167em"),(node=AMcreateMmlNode("mrow",node)).appendChild(space)}newFrag.appendChild(node)}}while(symbol.ttype!=RIGHTBRACKET&&null!=symbol&&""!=symbol.output);if(tag=null,symbol.ttype==RIGHTBRACKET){"\\right"==symbol.input&&(null!=(symbol=AMgetSymbol(str=AMremoveCharsAndBlanks(str,symbol.input.length)))&&"."==symbol.input&&(symbol.invisible=!0),null!=symbol&&(tag=symbol.rtag)),null!=symbol&&(str=AMremoveCharsAndBlanks(str,symbol.input.length));var len=newFrag.childNodes.length;if(matrix&&len>0&&"mrow"==newFrag.childNodes[len-1].nodeName&&len>1&&"mo"==newFrag.childNodes[len-2].nodeName&&"&"==newFrag.childNodes[len-2].firstChild.nodeValue){var pos=[],m=newFrag.childNodes.length;for(i=0;matrix&&i<m;i+=2){pos[i]=[],node=newFrag.childNodes[i];for(var j=0;j<node.childNodes.length;j++)"&"==node.childNodes[j].firstChild.nodeValue&&(pos[i][pos[i].length]=j)}var row,frag,n,k,table=document.createDocumentFragment();for(i=0;i<m;i+=2){for(row=document.createDocumentFragment(),frag=document.createDocumentFragment(),n=(node=newFrag.firstChild).childNodes.length,k=0,j=0;j<n;j++)void 0!==pos[i][k]&&j==pos[i][k]?(node.removeChild(node.firstChild),row.appendChild(AMcreateMmlNode("mtd",frag)),k++):frag.appendChild(node.firstChild);row.appendChild(AMcreateMmlNode("mtd",frag)),newFrag.childNodes.length>2&&(newFrag.removeChild(newFrag.firstChild),newFrag.removeChild(newFrag.firstChild)),table.appendChild(AMcreateMmlNode("mtr",row))}return[table,str]}"boolean"==typeof symbol.invisible&&symbol.invisible||(node=AMcreateMmlNode("mo",document.createTextNode(symbol.output)),newFrag.appendChild(node))}return[newFrag,str,tag]}function AMparseMath(str){var node=AMcreateElementMathML("mstyle");if(""!=mathcolor&&node.setAttribute("mathcolor",mathcolor),""!=mathfontfamily&&node.setAttribute("fontfamily",mathfontfamily),node.appendChild(AMparseExpr(str.replace(/^\s+/g,""),!1,!1)[0]),node=AMcreateMmlNode("math",node),showasciiformulaonhover&&node.setAttribute("title",str.replace(/\s+/g," ")),""!=mathfontfamily&&(isIE||"serif"!=mathfontfamily)){var fnode=AMcreateElementXHTML("font");return fnode.setAttribute("face",mathfontfamily),fnode.appendChild(node),fnode}return node}var P=function(prototype,ownProperty,undefined){function isObject(o){return"object"==typeof o}function isFunction(f){return"function"==typeof f}function P(_superclass,definition){function C(args){var self=this;if(!(self instanceof C))return new C(arguments);args&&isFunction(self.init)&&self.init.apply(self,args)}definition===undefined&&(definition=_superclass,_superclass=Object);var extensions,proto=C[prototype]=C.fn=new _superclass,_super=_superclass[prototype];return proto.constructor=C,C.mixin=function(def){return C[prototype]=P(C,def)[prototype],C},(C.open=function(def){if(extensions={},isFunction(def)?extensions=def.call(C,proto,_super,C,_superclass):isObject(def)&&(extensions=def),isObject(extensions))for(var ext in extensions)ownProperty.call(extensions,ext)&&(proto[ext]=extensions[ext]);return isFunction(proto.init)||(proto.init=function(){_superclass.apply(this,arguments)}),C})(definition)}return P}("prototype",{}.hasOwnProperty);!function(){function noop(){}function bind(cons){var args=__slice.call(arguments,1);return function(){return cons.apply(this,args)}}function pray(message,cond){if(!cond)throw new Error("prayer failed: "+message)}function createRoot(container,root,textbox,editable){var contents=container.contents().detach();textbox||container.addClass("mathquill-rendered-math"),root.jQ=$('<span class="mathquill-root-block"/>').appendTo(container.attr(mqBlockId,root.id)),root.revert=function(){container.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(contents)},root.cursor=Cursor(root),root.renderLatex(contents.text())}function setupTextarea(editable,container,root,cursor){function setTextareaSelection(){textareaSelectionTimeout=undefined;var latex=cursor.selection?"$"+cursor.selection.latex()+"$":"";textareaManager.select(latex),root.triggerSpecialEvent("selectionChanged")}var is_ios=null!==navigator.userAgent.match(/(iPad|iPhone|iPod)/i);navigator.userAgent.match(/(Android|Silk|Kindle)/i);window.MathEditorWidgetUseKeyboard=!0,is_ios&&(window.MathEditorWidgetUseKeyboard=!1);var textareaSelectionTimeout,useTextarea=window.MathEditorWidgetUseKeyboard,textareaSpan=root.textarea=$(useTextarea?'<span class="mq-textarea"><textarea></textarea></span>':'<span class="mq-textarea"><span tabindex=0></span></span>'),textarea=textareaSpan.children();root.selectionChanged=function(){textareaSelectionTimeout===undefined&&(textareaSelectionTimeout=setTimeout(setTextareaSelection)),forceIERedraw(container[0])},container.bind("selectstart.mathquill",function(e){e.target!==textarea[0]&&e.preventDefault(),e.stopPropagation()});var textareaManager=hookUpTextarea(editable,container,root,cursor,textarea,textareaSpan,setTextareaSelection);return textarea}function mouseEvents(ultimateRootjQ){ultimateRootjQ.bind("mousedown.mathquill",function(e){function mousemove(e){cursor.seek($(e.target),e.clientX,e.clientY,cachedClientRect),cursor.prev===anticursor.prev&&cursor.parent===anticursor.parent||cursor.selectFrom(anticursor),e.preventDefault()}function docmousemove(e){return delete e.target,mousemove(e)}function mouseup(e){anticursor=undefined,cursor.blink=blink,cursor.selection||(root.editable?cursor.show():textareaSpan.detach()),container.unbind("mousemove",mousemove),$(e.target.ownerDocument).unbind("mousemove",docmousemove).unbind("mouseup",mouseup)}e.preventDefault();var container=$(e.target);container.hasClass("mathquill-editable")||(container=container.closest(".mathquill-root-block").parent());var root=MathElement[container.attr(mqBlockId)||ultimateRootjQ.attr(mqBlockId)],cursor=root.cursor,blink=cursor.blink,textareaSpan=root.textarea,textarea=textareaSpan.children();if(root.ignoreMousedownTimeout!==undefined)return clearTimeout(root.ignoreMousedownTimeout),void(root.ignoreMousedownTimeout=undefined);var cachedClientRect=cachedClientRectFnForNewCache();cursor.blink=noop,cursor.hideHandle().seek($(e.target),e.clientX,e.clientY,cachedClientRect);var anticursor={parent:cursor.parent,prev:cursor.prev,next:cursor.next};!root.editable&&root.blurred&&container.prepend(textareaSpan),textarea.focus(),root.blurred=!1,container.mousemove(mousemove),$(e.target.ownerDocument).mousemove(docmousemove).mouseup(mouseup)})}function setupTouchHandle(editable,root,cursor){cursor.handle.on("touchstart",function(ontouchstart){return function(e){e.preventDefault();var e=e.originalEvent,target=$(e.target);if(!(e.changedTouches.length<e.touches.length)){var touchstart=e.changedTouches[0],handlers=ontouchstart(touchstart)||0;handlers.touchmove&&target.bind("touchmove",function(e){var touchmove=e.originalEvent.changedTouches[0];touchmove.id===touchstart.id&&handlers.touchmove.call(this,touchmove)}),target.bind("touchend",function(e){var touchend=e.originalEvent.changedTouches[0];touchend.id===touchstart.id&&(handlers.touchend&&handlers.touchend.call(this,touchend),target.unbind("touchmove touchend"))})}}}(function(e){cursor.blink=noop;var onAnimationEnd,cursorRect=cursor.jQ[0].getBoundingClientRect(),offsetX=e.clientX-cursorRect.left,offsetY=e.clientY-(cursorRect.top+cursorRect.bottom)/2,cachedClientRect=cachedClientRectFnForNewCache();return root.onAnimationEnd=function(){onAnimationEnd()},{touchmove:function(e){function visualHapticFeedback(){var cursorRect=cursor.jQ[0].getBoundingClientRect();cursor.repositionHandle(cursorRect);var dx=adjustedX-cursorRect.left,dy=adjustedY-(cursorRect.top+cursorRect.bottom)/2,dist=Math.sqrt(dx*dx+dy*dy),weight=(Math.log(dist)+1)/dist,skewX=Math.atan2(weight*dx,offsetY),scaleY=(weight*dy+offsetY)/offsetY,steeperScale=2*(scaleY-1)+1;cursor.handle.css({WebkitTransform:"translateX(.5px) skewX("+skewX+"rad) scaleY("+scaleY+")",opacity:1-.5*steeperScale})}var adjustedX=e.clientX-offsetX,adjustedY=e.clientY-offsetY;cursor.seek(elAtPt(adjustedX,adjustedY,root),adjustedX,adjustedY,cachedClientRect,!0),visualHapticFeedback(),onAnimationEnd=visualHapticFeedback},touchend:function(e){cursor.handle.css({WebkitTransform:"",opacity:""}),cursor.blink=blink,cursor.show(!0),onAnimationEnd=function(){cursor.repositionHandle(cursor.jQ[0].getBoundingClientRect()),cursor.handle.css({WebkitTransform:"",opacity:""}),delete root.onAnimationEnd}}}}))}function hookUpTextarea(editable,container,root,cursor,textarea,textareaSpan,setTextareaSelection){function detach(){textareaSpan.detach(),root.blurred=!0}if(!editable){root.blurred=!0;textareaManager=manageTextarea(textarea,{container:container});return container.bind("copy",setTextareaSelection).prepend('<span class="mq-selectable">$'+root.latex()+"$</span>"),textarea.bind("cut paste",!1).blur(function(){cursor.clearSelection(),setTimeout(detach)}),textareaManager}var textareaManager=manageTextarea(textarea,{container:container,key:function(key,evt){cursor.parent.bubble("onKey",key,evt)},text:function(text){cursor.parent.bubble("onText",text)},cut:function(e){cursor.selection&&setTimeout(function(){cursor.prepareEdit(),cursor.parent.bubble("redraw"),root.triggerSpecialEvent("render")}),e.stopPropagation(),root.triggerSpecialEvent("render")},paste:function(text){"$"===text.slice(0,1)&&"$"===text.slice(-1)&&(text=text.slice(1,-1)),cursor.writeLatex(text).show(),root.triggerSpecialEvent("render")}});return container.prepend(textareaSpan),textareaManager}function rootCSSClasses(container,textbox){container.addClass("mathquill-editable"),textbox&&container.addClass("mathquill-textbox")}function focusBlurEvents(root,cursor,textarea){textarea.focus(function(e){root.blurred=!1,cursor.parent||cursor.appendTo(root),cursor.parent.jQ.addClass("mq-hasCursor"),cursor.selection?(cursor.selection.jQ.removeClass("mq-blur"),setTimeout(root.selectionChanged)):cursor.show()}).blur(function(e){root.blurred=!0,cursor.hide().parent.blur(),cursor.selection&&cursor.selection.jQ.addClass("mq-blur")}).blur()}function desmosCustomEvents(container,root,cursor){container.bind("select_all",function(e){for(cursor.prepareMove().appendTo(root);cursor.prev;)cursor.selectLeft()}).bind("custom_paste",function(e,text){"$"===text.slice(0,1)&&"$"===text.slice(-1)&&(text=text.slice(1,-1)),cursor.writeLatex(text).show(),root.triggerSpecialEvent("render")})}function elAtPt(clientX,clientY,root){var el=document.elementFromPoint(clientX,clientY);return $.contains(root.jQ[0],el)?$(el):root.jQ}function cachedClientRectFnForNewCache(){function elById(el,id){if(!cache[id]){pray("only called within Cursor::seek","scrollLeft"in cachedClientRect);var rect=el.getBoundingClientRect(),dx=cachedClientRect.scrollLeft;cache[id]={top:rect.top,right:rect.right+dx,bottom:rect.bottom,left:rect.left+dx}}return cache[id]}function cachedClientRect(node){return elById(node.jQ[0],node.id)}var cache={};return cachedClientRect.elById=elById,cachedClientRect}function makeTextBlock(latex,tagName,attrs){return P(TextBlock,{ctrlSeq:latex,htmlTemplate:"<"+tagName+" "+attrs+">&0</"+tagName+">"})}var undefined,scale,transformPropName,$=jQuery,mqBlockId="mathquill-block-id",min=Math.min,max=Math.max,__slice=[].slice,P=function(prototype,ownProperty,undefined){function isObject(o){return"object"==typeof o}function isFunction(f){return"function"==typeof f}function P(_superclass,definition){function C(args){var self=this;if(!(self instanceof C))return new C(arguments);args&&isFunction(self.init)&&self.init.apply(self,args)}definition===undefined&&(definition=_superclass,_superclass=Object);var extensions,proto=C[prototype]=new _superclass,_super=_superclass[prototype];return proto.constructor=C,C.mixin=function(def){return C[prototype]=P(C,def)[prototype],C},(C.open=function(def){if(extensions={},isFunction(def)?extensions=def.call(C,proto,_super,C,_superclass):isObject(def)&&(extensions=def),isObject(extensions))for(var ext in extensions)ownProperty.call(extensions,ext)&&(proto[ext]=extensions[ext]);return isFunction(proto.init)||(proto.init=function(){_superclass.apply(this,arguments)}),C})(definition)}return P}("prototype",{}.hasOwnProperty),manageTextarea=function(){function stringify(evt){var key,which=evt.which||evt.keyCode,keyVal=KEY_VALUES[which],modifiers=[];return evt.ctrlKey&&modifiers.push("Ctrl"),evt.originalEvent&&evt.originalEvent.metaKey&&modifiers.push("Meta"),evt.altKey&&modifiers.push("Alt"),evt.shiftKey&&modifiers.push("Shift"),key=keyVal||String.fromCharCode(which),modifiers.length||keyVal?(modifiers.push(key),modifiers.join("-")):key}var KEY_VALUES={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(el,opts){function defer(fn){timeout=setTimeout(fn),deferredFn=fn}function flush(){timeout&&(clearTimeout(timeout),timeout=undefined,deferredFn())}function hasSelection(){var dom=textarea[0];return"selectionStart"in dom&&dom.selectionStart!==dom.selectionEnd}function popText(callback){var text=textarea.val();textarea.val(""),text&&callback(text)}function handleKey(){keyCallback(stringify(keydown),keydown)}if(!el.is("textarea"))return{select:noop};var keydown=null,keypress=null;opts||(opts={});var timeout,deferredFn,textCallback=opts.text||noop,keyCallback=opts.key||noop,pasteCallback=opts.paste||noop,onCut=opts.cut||noop,textarea=$(el),target=$(opts.container||textarea);return target.bind("keydown keypress input keyup focusout paste",flush),target.bind({keydown:function(e){keydown=e,keypress=null,handleKey()},keypress:function(e){keydown&&keypress&&handleKey(),keypress=e,defer(function(){hasSelection()?setTimeout(function(){hasSelection()||popText(textCallback)}):popText(textCallback),hasSelection()||popText(textCallback)})},focusout:function(){keydown=keypress=null},cut:onCut,paste:function(e){textarea.focus(),defer(function(){popText(pasteCallback)})}}),{select:function(text){flush(),textarea.val(text),text&&textarea[0].select()}}}}(),Parser=P(function(_,_super,Parser){function parseError(stream,message){throw stream=stream?"'"+stream+"'":"EOF","Parse Error: "+message+" at "+stream}_.init=function(body){this._=body},_.parse=function(stream){return this.skip(eof)._(stream,function(stream,result){return result},parseError)},_.or=function(alternative){pray("or is passed a parser",alternative instanceof Parser);var self=this;return Parser(function(stream,onSuccess,onFailure){return self._(stream,onSuccess,function(newStream){return alternative._(stream,onSuccess,onFailure)})})},_.then=function(next){var self=this;return Parser(function(stream,onSuccess,onFailure){return self._(stream,function(newStream,result){var nextParser=next instanceof Parser?next:next(result);return pray("a parser is returned",nextParser instanceof Parser),nextParser._(newStream,onSuccess,onFailure)},onFailure)})},_.many=function(){var self=this;return Parser(function(stream,onSuccess,onFailure){for(var xs=[];self._(stream,function(newStream,x){return stream=newStream,xs.push(x),!0},function(){return!1}););return onSuccess(stream,xs)})},_.times=function(min,max){arguments.length<2&&(max=min);var self=this;return Parser(function(stream,onSuccess,onFailure){function success(newStream,x){return xs.push(x),stream=newStream,!0}for(var failure,xs=[],result=!0,i=0;i<min;i+=1)if(!(result=self._(stream,success,function(newStream,msg){return failure=msg,stream=newStream,!1})))return onFailure(stream,failure);for(;i<max&&result;i+=1)result=self._(stream,success,function(newStream,msg){return!1});return onSuccess(stream,xs)})},_.result=function(res){return this.then(succeed(res))},_.atMost=function(n){return this.times(0,n)},_.atLeast=function(n){var self=this;return self.times(n).then(function(start){return self.many().map(function(end){return start.concat(end)})})},_.map=function(fn){return this.then(function(result){return succeed(fn(result))})},_.skip=function(two){return this.then(function(result){return two.result(result)})};this.string=function(str){var len=str.length,expected="expected '"+str+"'";return Parser(function(stream,onSuccess,onFailure){var head=stream.slice(0,len);return head===str?onSuccess(stream.slice(len),head):onFailure(stream,expected)})};var regex=this.regex=function(re){pray("regexp parser is anchored","^"===re.toString().charAt(1));var expected="expected "+re;return Parser(function(stream,onSuccess,onFailure){var match=re.exec(stream);if(match){var result=match[0];return onSuccess(stream.slice(result.length),result)}return onFailure(stream,expected)})},succeed=Parser.succeed=function(result){return Parser(function(stream,onSuccess){return onSuccess(stream,result)})},eof=(Parser.fail=function(msg){return Parser(function(stream,_,onFailure){return onFailure(stream,msg)})},Parser.letter=regex(/^[a-z]/i),Parser.letters=regex(/^[a-z]*/i),Parser.digit=regex(/^[0-9]/),Parser.digits=regex(/^[0-9]*/),Parser.whitespace=regex(/^\s+/),Parser.optWhitespace=regex(/^\s*/),Parser.any=Parser(function(stream,onSuccess,onFailure){return stream?onSuccess(stream.slice(1),stream.charAt(0)):onFailure(stream,"expected any character")}),Parser.all=Parser(function(stream,onSuccess,onFailure){return onSuccess("",stream)}),Parser.eof=Parser(function(stream,onSuccess,onFailure){return stream?onFailure(stream,"expected EOF"):onSuccess(stream,stream)}))}),Node=P(function(_){_.prev=0,_.next=0,_.parent=0,_.firstChild=0,_.lastChild=0,_.children=function(){return Fragment(this.firstChild,this.lastChild)},_.eachChild=function(fn){return this.children().each(fn)},_.foldChildren=function(fold,fn){return this.children().fold(fold,fn)},_.adopt=function(parent,prev,next){return Fragment(this,this).adopt(parent,prev,next),this},_.disown=function(){return Fragment(this,this).disown(),this}}),Fragment=P(function(_){function prayWellFormed(parent,prev,next){pray("a parent is always present",parent),pray("prev is properly set up",prev?prev.next===next&&prev.parent===parent:parent.firstChild===next),pray("next is properly set up",next?next.prev===prev&&next.parent===parent:parent.lastChild===prev)}_.first=0,_.last=0,_.init=function(first,last){pray("no half-empty fragments",!first==!last),first&&(pray("first node is passed to Fragment",first instanceof Node),pray("last node is passed to Fragment",last instanceof Node),pray("first and last have the same parent",first.parent===last.parent),this.first=first,this.last=last)},_.adopt=function(parent,prev,next){prayWellFormed(parent,prev,next);var self=this;self.disowned=!1;var first=self.first;if(!first)return this;var last=self.last;return prev||(parent.firstChild=first),next?next.prev=last:parent.lastChild=last,self.last.next=next,self.each(function(el){el.prev=prev,el.parent=parent,prev&&(prev.next=el),prev=el}),self},_.disown=function(){var self=this,first=self.first;if(!first||self.disowned)return self;self.disowned=!0;var last=self.last,parent=first.parent;return prayWellFormed(parent,first.prev,first),prayWellFormed(parent,last,last.next),first.prev?first.prev.next=last.next:parent.firstChild=last.next,last.next?last.next.prev=first.prev:parent.lastChild=first.prev,self},_.each=function(fn){var self=this,el=self.first;if(!el)return self;for(;el!==self.last.next&&!1!==fn.call(self,el);el=el.next);return self},_.fold=function(fold,fn){return this.each(function(el){fold=fn.call(this,fold,el)}),fold}}),uuid=function(){var id=0;return function(){return id+=1}}(),MathElement=P(Node,function(_){_.init=function(obj){this.id=uuid(),MathElement[this.id]=this},_.toString=function(){return"[MathElement "+this.id+"]"},_.bubble=function(event){for(var args=__slice.call(arguments,1),ancestor=this;ancestor&&!1!==(ancestor[event]&&ancestor[event].apply(ancestor,args));ancestor=ancestor.parent);return this},_.postOrder=function(fn){if("string"==typeof fn){var methodName=fn;fn=function(el){methodName in el&&el[methodName].apply(el,arguments)}}!function recurse(desc){desc.eachChild(recurse),fn(desc)}(this)},_.jQ=$(),_.jQadd=function(jQ){this.jQ=this.jQ.add(jQ)},this.jQize=function(html){function jQadd(el){if(el.getAttribute){var cmdId=el.getAttribute("mathquill-command-id"),blockId=el.getAttribute("mathquill-block-id");cmdId&&MathElement[cmdId].jQadd(el),blockId&&MathElement[blockId].jQadd(el)}}function traverse(el){for(el=el.firstChild;el;el=el.nextSibling)jQadd(el),el.firstChild&&traverse(el)}for(var jQ=$(html),i=0;i<jQ.length;i+=1)jQadd(jQ[i]),traverse(jQ[i]);return jQ},_.finalizeInsert=function(){var self=this;self.postOrder("finalizeTree"),self.postOrder("blur"),self.postOrder("respace"),self.next.respace&&self.next.respace(),self.prev.respace&&self.prev.respace(),self.postOrder("redraw"),self.bubble("redraw"),self.bubble("redraw")},_.seek=function(cursor,clientX,clientY,root,clientRect){function popClosest(){for(var iClosest,minSqDist=1/0,i=0;i<frontier.length;i+=1)if(frontier[i]){var sqDist=frontier[i].sqDist;sqDist<minSqDist&&(iClosest=i,minSqDist=sqDist)}var closest=frontier[iClosest];return frontier[iClosest]=null,closest}function seekPoint(node){var pt=node.seekPoint(clientX,clientY,clientRect);if(pt){var dx=clientX-pt.x,dy=clientY-pt.y;frontier.push({point:pt,sqDist:dx*dx+dy*dy})}}function addNode(node){if(node){var rect=clientRect(node),closestX=max(rect.left,min(rect.right,clientX)),closestY=max(rect.top,min(rect.bottom,clientY)),dx=clientX-closestX,dy=clientY-closestY;frontier.push({node:node,sqDist:dx*dx+dy*dy})}}function addContainer(node){if(node!==root){var rect=clientRect(node),dist=max(0,min(clientX-rect.left,clientY-rect.top,rect.right-clientX,rect.bottom-clientY));frontier.push({container:node,sqDist:dist*dist})}}var frontier=[];seekPoint(this),this.eachChild(addNode),addContainer(this);for(var closest=popClosest();!closest.point;closest=popClosest())if(closest.container){var container=closest.container,outer=container.parent;seekPoint(outer),outer.eachChild(function(n){n!==container&&addNode(n)}),addContainer(outer)}else seekPoint(closest.node),closest.node.eachChild(addNode);closest.point.next?cursor.insertBefore(closest.point.next):cursor.appendTo(closest.point.parent)}}),MathCommand=P(MathElement,function(_,_super){_.init=function(ctrlSeq,htmlTemplate,textTemplate){var cmd=this;_super.init.call(cmd),cmd.ctrlSeq||(cmd.ctrlSeq=ctrlSeq),htmlTemplate&&(cmd.htmlTemplate=htmlTemplate),textTemplate&&(cmd.textTemplate=textTemplate)},_.replaces=function(replacedFragment){replacedFragment.disown(),this.replacedFragment=replacedFragment},_.isEmpty=function(){return this.foldChildren(!0,function(isEmpty,child){return isEmpty&&child.isEmpty()})},_.parser=function(){var self=this;return latexMathParser.block.times(self.numBlocks()).map(function(blocks){self.blocks=blocks;for(var i=0;i<blocks.length;i+=1)blocks[i].adopt(self,self.lastChild,0);return self})},_.createBefore=function(cursor){var cmd=this,replacedFragment=cmd.replacedFragment;cmd.createBlocks(),MathElement.jQize(cmd.html()),replacedFragment&&(replacedFragment.adopt(cmd.firstChild,0,0),replacedFragment.jQ.appendTo(cmd.firstChild.jQ)),cursor.jQ.before(cmd.jQ),cursor.prev=cmd.adopt(cursor.parent,cursor.prev,cursor.next),cmd.finalizeInsert(cursor),cmd.placeCursor(cursor)},_.createBlocks=function(){for(var cmd=this,numBlocks=cmd.numBlocks(),blocks=cmd.blocks=Array(numBlocks),i=0;i<numBlocks;i+=1)(blocks[i]=MathBlock()).adopt(cmd,cmd.lastChild,0)},_.respace=noop,_.placeCursor=function(cursor){cursor.appendTo(this.foldChildren(this.firstChild,function(prev,child){return prev.isEmpty()?prev:child}))},_.seekPoint=noop,_.expectedCursorYNextTo=function(clientRect){return this.firstChild.expectedCursorYInside(clientRect)},_.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(el){delete MathElement[el.id]}),this},_.numBlocks=function(){var matches=this.htmlTemplate.match(/&\d+/g);return matches?matches.length:0},_.html=function(){var cmd=this,blocks=cmd.blocks,cmdId=" mathquill-command-id="+cmd.id,tokens=cmd.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);pray("no unmatched angle brackets",tokens.join("")===this.htmlTemplate);for(var i=0,token=tokens[0];token;i+=1,token=tokens[i])if("/>"===token.slice(-2))tokens[i]=token.slice(0,-2)+cmdId+"/>";else if("<"===token.charAt(0)){pray("not an unmatched top-level close tag","/"!==token.charAt(1)),tokens[i]=token.slice(0,-1)+cmdId+">";var nesting=1;do{pray("no missing close tags",token=tokens[i+=1]),"</"===token.slice(0,2)?nesting-=1:"<"===token.charAt(0)&&"/>"!==token.slice(-2)&&(nesting+=1)}while(nesting>0)}return tokens.join("").replace(/>&(\d+)/g,function($0,$1){return" mathquill-block-id="+blocks[$1].id+">"+blocks[$1].join("html")})},_.latex=function(){return this.foldChildren(this.ctrlSeq,function(latex,child){return latex+"{"+(child.latex()||" ")+"}"})},_.mqLatex=function(){return this.foldChildren(this.ctrlSeq,function(latex,child){return latex+"{"+(child.mqLatex()||" ")+"}"})},_.textTemplate=[""],_.text=function(){var i=0;return this.foldChildren(this.textTemplate[i],function(text,child){i+=1;var child_text=child.text();return text&&"("===this.textTemplate[i]&&"("===child_text[0]&&")"===child_text.slice(-1)?text+child_text.slice(1,-1)+this.textTemplate[i]:text+child.text()+(this.textTemplate[i]||"")})}}),Symbol=P(MathCommand,function(_,_super){_.init=function(ctrlSeq,html,text){text||(text=ctrlSeq&&ctrlSeq.length>1?ctrlSeq.slice(1):ctrlSeq),_super.init.call(this,ctrlSeq,html,[text])},_.parser=function(){return Parser.succeed(this)},_.numBlocks=function(){return 0},_.replaces=function(replacedFragment){replacedFragment.remove()},_.createBlocks=noop,_.seek=function(cursor,clientX,clientY,root,clientRect){var rect=clientRect(this);clientX-rect.left<rect.right-clientX?cursor.insertBefore(this):cursor.insertAfter(this)},_.expectedCursorYNextTo=function(clientRect){return(clientRect(this).top+clientRect(this).bottom)/2},_.latex=function(){return this.ctrlSeq},_.text=function(){return this.textTemplate},_.placeCursor=noop,_.isEmpty=function(){return!0}}),MathBlock=P(MathElement,function(_){_.join=function(methodName){return this.foldChildren("",function(fold,child){return fold+child[methodName]()})},_.mqLatex=function(){return this.join("mqLatex")},_.latex=function(){return this.join("latex")},_.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():"("+this.join("text")+")"},_.isEmpty=function(){return 0===this.firstChild&&0===this.lastChild},_.seekPoint=function(clientX,clientY,clientRect){function pointLeftOf(n){return{next:n,x:clientRect(n).left}}if(this.firstChild){if(clientX>(pt=pointLeftOf(this.firstChild)).x){pt=pointLeftOf(this.lastChild);for(var rightwardPt={next:0,x:clientRect(pt.next).right};clientX<pt.x;)rightwardPt=pt,pt=pointLeftOf(pt.next.prev);rightwardPt.x-clientX<clientX-pt.x&&(pt=rightwardPt)}}else var pt={next:0,x:(clientRect(this).left+clientRect(this).right)/2};return{parent:this,next:pt.next,x:pt.x,y:this.expectedCursorYInside(clientRect)}},_.expectedCursorYInside=function(clientRect){return this.firstChild?this.firstChild.expectedCursorYNextTo(clientRect):(clientRect(this).top+clientRect(this).bottom)/2},_.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},_.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),MathFragment=P(Fragment,function(_,_super){_.init=function(first,last){_super.init.call(this,first,last||first),this.jQ=this.fold($(),function(jQ,child){return child.jQ.add(jQ)})},_.latex=function(){return this.fold("",function(latex,el){return latex+el.latex()})},_.remove=function(){return this.jQ.remove(),this.each(function(el){el.postOrder(function(desc){delete MathElement[desc.id]})}),this.disown()}}),RootMathBlock=P(MathBlock,function(_,_super){_.latex=function(){return _super.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},_.text=function(){return this.foldChildren("",function(text,child){return text+child.text()})},_.renderLatex=function(latex){var all=Parser.all,eof=Parser.eof,block=latexMathParser.skip(eof).or(all.result(!1)).parse(latex);this.firstChild=this.lastChild=0,block&&block.children().adopt(this,0,0);var jQ=this.jQ;if(block){var html=block.join("html");jQ.html(html),MathElement.jQize(jQ),this.focus().finalizeInsert()}else jQ.empty();this.cursor.appendTo(this)},_.renderSliderLatex=function(latex){function makeCmd(ch){var code=ch.charCodeAt(0);return 65<=code&&code<=90||97<=code&&code<=122?Variable(ch):CharCmds[ch]||LatexCmds[ch]?(CharCmds[ch]||LatexCmds[ch])(ch):VanillaSymbol(ch)}var matches=/^([a-z])(?:_([a-z0-9]|\{[a-z0-9]+\}))?=([-0-9.]+)$/i.exec(latex);pray("valid restricted slider LaTeX",matches);var letter=matches[1],subscript=matches[2],value=matches[3];if(this.firstChild=this.lastChild=0,letter=Variable(letter),subscript){var sub=LatexCmds._("_"),subBlock=MathBlock().adopt(sub,0,0);if(sub.blocks=[subBlock],1===subscript.length)makeCmd(subscript).adopt(subBlock,subBlock.lastChild,0);else for(i=1;i<subscript.length-1;i+=1)makeCmd(subscript.charAt(i)).adopt(subBlock,subBlock.lastChild,0)}letter.adopt(this,this.lastChild,0),sub&&sub.adopt(this,this.lastChild,0),LatexCmds["="]("=").adopt(this,this.lastChild,0);for(var i=0,l=value.length;i<l;i+=1)makeCmd(value.charAt(i)).adopt(this,this.lastChild,0);var jQ=this.jQ,html=this.join("html");jQ.html(html),MathElement.jQize(jQ),this.cursor.parent=this,this.cursor.prev=this.lastChild,this.cursor.next=0},_.up=function(){this.triggerSpecialEvent("upPressed")},_.down=function(){this.triggerSpecialEvent("downPressed")},_.moveOutOf=function(dir){this.triggerSpecialEvent(dir+"Pressed")},_.onKey=function(key,e){switch(key){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":for(;this.cursor.prev||this.cursor.selection;)this.cursor.backspace();break;case"Shift-Backspace":case"Backspace":this.cursor.backspace(),this.triggerSpecialEvent("render");break;case"Esc":case"Tab":if((parent=this.cursor.parent)===this.cursor.root)return;this.cursor.prepareMove(),parent.next?this.cursor.prependTo(parent.next):this.cursor.insertAfter(parent.parent);break;case"Shift-Tab":case"Shift-Esc":var parent=this.cursor.parent;if(parent===this.cursor.root)return;this.cursor.prepareMove(),parent.prev?this.cursor.appendTo(parent.prev):this.cursor.insertBefore(parent.parent);break;case"Enter":this.triggerSpecialEvent("enterPressed");break;case"End":this.cursor.prepareMove().appendTo(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().appendTo(this);break;case"Shift-End":for(;this.cursor.next;)this.cursor.selectRight();break;case"Ctrl-Shift-End":for(;this.cursor.next||this.cursor.parent!==this;)this.cursor.selectRight();break;case"Home":this.cursor.prepareMove().prependTo(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().prependTo(this);break;case"Shift-Home":for(;this.cursor.prev;)this.cursor.selectLeft();break;case"Ctrl-Shift-Home":for(;this.cursor.prev||this.cursor.parent!==this;)this.cursor.selectLeft();break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":case"Meta-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":case"Meta-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor.prev)for(;this.cursor.prev;)this.cursor.selectLeft();else this.cursor.selectLeft();case"Shift-Down":if(this.cursor.next)for(;this.cursor.next;)this.cursor.selectRight();else this.cursor.selectRight();case"Ctrl-Up":case"Meta-Up":case"Ctrl-Down":case"Meta-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":for(;this.cursor.next||this.cursor.selection;)this.cursor.deleteForward();this.triggerSpecialEvent("render");break;case"Shift-Del":case"Del":this.cursor.deleteForward(),this.triggerSpecialEvent("render");break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().appendTo(this);this.cursor.prev;)this.cursor.selectLeft();break;default:return this.scrollHoriz(),!1}return e.preventDefault(),this.scrollHoriz(),!1},_.onText=function(ch){return this.cursor.setFractionMode(1),this.cursor.write(ch),this.cursor.setFractionMode(0),this.triggerSpecialEvent("render"),this.scrollHoriz(),!1},_.scrollHoriz=function(){var cursor=this.cursor,seln=cursor.selection,rootRect=this.jQ[0].getBoundingClientRect();if(seln){var rect=seln.jQ[0].getBoundingClientRect(),overLeft=rect.left-(rootRect.left+20),overRight=rect.right-(rootRect.right-20);if(seln.first===cursor.next)if(overLeft<0)scrollBy=overLeft;else{if(!(overRight>0))return;if(rect.left-overRight<rootRect.left+20)scrollBy=overLeft;else scrollBy=overRight}else if(overRight>0)scrollBy=overRight;else{if(!(overLeft<0))return;if(rect.right-overLeft>rootRect.right-20)scrollBy=overRight;else scrollBy=overLeft}}else{var x=cursor.jQ[0].getBoundingClientRect().left;if(x>rootRect.right-20)scrollBy=x-(rootRect.right-20);else{if(!(x<rootRect.left+20))return;var scrollBy=x-(rootRect.left+20)}}this.jQ.stop().animate({scrollLeft:"+="+scrollBy},100,this.onAnimationEnd)},_.triggerSpecialEvent=function(eventName){this.jQ.trigger(eventName)}}),RootMathCommand=P(MathCommand,function(_,_super){_.init=function(cursor){_super.init.call(this,"$"),this.cursor=cursor},_.htmlTemplate='<span class="mathquill-rendered-math">&0</span>',_.createBlocks=function(){this.firstChild=this.lastChild=RootMathBlock(),this.blocks=[this.firstChild],this.firstChild.parent=this;var cursor=this.firstChild.cursor=this.cursor;this.firstChild.onText=function(ch){return"$"!==ch||cursor.parent!==this?cursor.write(ch):this.isEmpty()?cursor.insertAfter(this.parent).backspace().insertNew(VanillaSymbol("\\$","$")).show():cursor.next?cursor.prev?cursor.write(ch):cursor.insertBefore(this.parent):cursor.insertAfter(this.parent),!1}},_.latex=function(){return"$"+this.firstChild.latex()+"$"}}),RootTextBlock=P(MathBlock,function(_){_.renderLatex=function(latex){var self=this,cursor=self.cursor;self.jQ.children().slice(1).remove(),self.firstChild=self.lastChild=0,cursor.show().appendTo(self);var regex=Parser.regex,string=Parser.string,eof=Parser.eof,all=Parser.all,mathMode=string("$").then(latexMathParser).skip(string("$").or(eof)).map(function(block){var rootMathCommand=RootMathCommand(cursor);rootMathCommand.createBlocks();var rootMathBlock=rootMathCommand.firstChild;return block.children().adopt(rootMathBlock,0,0),rootMathCommand}),textChar=string("\\$").result("$").or(regex(/^[^$]/)).map(VanillaSymbol),commands=mathMode.or(textChar).many().skip(eof).or(all.result(!1)).parse(latex);if(commands){for(var i=0;i<commands.length;i+=1)commands[i].adopt(self,self.lastChild,0);var html=self.join("html");MathElement.jQize(html).appendTo(self.jQ),this.finalizeInsert()}},_.onKey=RootMathBlock.prototype.onKey,_.onText=function(ch){return this.cursor.prepareEdit(),"$"===ch?this.cursor.insertNew(RootMathCommand(this.cursor)):this.cursor.insertNew(VanillaSymbol(ch)),!1},_.scrollHoriz=RootMathBlock.prototype.scrollHoriz}),CharCmds={},LatexCmds={},forceIERedraw=noop,div_style=document.createElement("div").style,transformPropNames={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var prop in transformPropNames)if(prop in div_style){transformPropName=prop;break}transformPropName?scale=function(jQ,x,y){jQ.css(transformPropName,"scale("+x+","+y+")")}:"filter"in div_style?(forceIERedraw=function(el){el.className=el.className},scale=function(jQ,x,y){function calculateMarginRight(){jQ.css("marginRight",(innerjQ.width()-1)*(x-1)/x+"px")}x/=1+(y-1)/2,jQ.css("fontSize",y+"em"),jQ.hasClass("mq-matrixed-container")||jQ.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var innerjQ=jQ.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+x+",SizingMethod='auto expand')");calculateMarginRight();var intervalId=setInterval(calculateMarginRight);$(window).load(function(){clearTimeout(intervalId),calculateMarginRight()})}):scale=function(jQ,x,y){jQ.css("fontSize",y+"em")};var Style=P(MathCommand,function(_,_super){_.init=function(ctrlSeq,tagName,attrs){_super.init.call(this,ctrlSeq,"<"+tagName+" "+attrs+">&0</"+tagName+">")}});LatexCmds.mathrm=bind(Style,"\\mathrm","span",'class="mq-roman mq-font"'),LatexCmds.mathit=bind(Style,"\\mathit","i",'class="mq-font"'),LatexCmds.mathbf=bind(Style,"\\mathbf","b",'class="mq-font"'),LatexCmds.mathsf=bind(Style,"\\mathsf","span",'class="mq-sans-serif mq-font"'),LatexCmds.mathtt=bind(Style,"\\mathtt","span",'class="mq-monospace mq-font"'),LatexCmds.underline=bind(Style,"\\underline","span",'class="mq-non-leaf mq-underline"'),LatexCmds.overline=LatexCmds.bar=bind(Style,"\\overline","span",'class="mq-non-leaf mq-overline"');var SupSub=P(MathCommand,function(_,_super){function insertBeforeUnlessAtEnd(cursor){var cmd=this.parent,ancestorCmd=cursor;do{if(ancestorCmd.next)return cursor.insertBefore(cmd),!1;ancestorCmd=ancestorCmd.parent.parent}while(ancestorCmd!==cmd);return cursor.insertAfter(cmd),!1}_.init=function(ctrlSeq,tag,text){_super.init.call(this,ctrlSeq,"<"+tag+' class="mq-non-leaf"><span class="mq-non-leaf mq-'+tag+'">&0</span></'+tag+">",[text])},_.finalizeTree=function(){pray("SupSub is only _ and ^","^"===this.ctrlSeq||"_"===this.ctrlSeq),"_"===this.ctrlSeq?(this.down=this.firstChild,this.firstChild.up=insertBeforeUnlessAtEnd):(this.up=this.firstChild,this.firstChild.down=insertBeforeUnlessAtEnd)},_.latex=function(){if("_"===this.ctrlSeq&&this.respaced)return"";var latex="";"^"===this.ctrlSeq&&this.next.respaced&&(1===(block=this.next.firstChild.latex()).length?latex+="_"+block:latex+="_{"+block+"}");var block=this.firstChild.latex();return 1===block.length?latex+=this.ctrlSeq+block:latex+=this.ctrlSeq+"{"+(block||" ")+"}",latex},_.redraw=function(){this.prev&&this.prev.respace(),this.prev instanceof SupSub||(this.respace(),!this.next||this.next instanceof SupSub||this.next.respace())},_.respace=function(){if("\\int "===this.prev.ctrlSeq||this.prev instanceof SupSub&&this.prev.ctrlSeq!=this.ctrlSeq&&this.prev.prev&&"\\int "===this.prev.prev.ctrlSeq?this.int||(this.int=!0,this.jQ.addClass("mq-int")):this.int&&(this.int=!1,this.jQ.removeClass("mq-int")),this.respaced=this.prev instanceof SupSub&&this.prev.ctrlSeq!=this.ctrlSeq&&!this.prev.respaced,this.respaced){var fontSize=+this.jQ.css("fontSize").slice(0,-2),prevWidth=this.prev.jQ.outerWidth(),thisWidth=this.jQ.outerWidth();this.jQ.css({left:(this.int&&"_"===this.ctrlSeq?-.25:0)-prevWidth/fontSize+"em",marginRight:.1-min(thisWidth,prevWidth)/fontSize+"em"})}else this.int&&"_"===this.ctrlSeq?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this.respaced?"^"===this.ctrlSeq?this.down=this.firstChild.down=this.prev.firstChild:this.up=this.firstChild.up=this.prev.firstChild:this.next.respaced?"_"===this.ctrlSeq?this.up=this.firstChild.up=this.next.firstChild:this.down=this.firstChild.down=this.next.firstChild:"_"===this.ctrlSeq?(delete this.up,this.firstChild.up=insertBeforeUnlessAtEnd):(delete this.down,this.firstChild.down=insertBeforeUnlessAtEnd),this.next instanceof SupSub&&this.next.respace(),this},_.onKey=function(key,e){if(this.getCursor().parent.parent===this)switch(key){case"Tab":if(this.next.respaced)return this.getCursor().prepareMove().prependTo(this.next.firstChild),e.preventDefault(),!1;break;case"Shift-Tab":if(this.respaced)return this.getCursor().prepareMove().appendTo(this.prev.firstChild),e.preventDefault(),!1;break;case"Left":if(!this.getCursor().prev&&this.respaced)return this.getCursor().prepareMove().insertBefore(this.prev),!1;break;case"Right":if(!this.getCursor().next&&this.next.respaced)return this.getCursor().prepareMove().insertAfter(this.next),!1}},_.getCursor=function(){for(var cursor,ancestor=this.parent;!cursor;ancestor=ancestor.parent)cursor=ancestor.cursor;return this.getCursor=function(){return cursor},this.getCursor()},_.expectedCursorYNextTo=function(clientRect){return"_"===this.ctrlSeq?clientRect(this).top:clientRect(this).bottom}});LatexCmds.subscript=LatexCmds._=bind(SupSub,"_","sub","_"),LatexCmds.superscript=LatexCmds.supscript=LatexCmds["^"]=bind(SupSub,"^","sup","**");var BigSymbol=P(MathCommand,function(_,_super){function insertAfterUnlessAtBeginning(cursor){var cmd=this.parent,ancestorCmd=cursor;do{if(ancestorCmd.prev)return cursor.insertAfter(cmd),!1;ancestorCmd=ancestorCmd.parent.parent}while(ancestorCmd!==cmd);return cursor.insertBefore(cmd),!1}_.init=function(ch,html){var htmlTemplate='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+html+'</big><span class="mq-from"><span>&0</span></span></span>';Symbol.prototype.init.call(this,ch,htmlTemplate)},_.placeCursor=function(cursor){cursor.prev&&"\\int"!=cursor.prev.ctrlSeq.trim()&&cursor.appendTo(this.firstChild).writeLatex("n=").show()},_.latex=function(){function simplify(latex){return 1===latex.length?latex:"{"+(latex||" ")+"}"}return this.ctrlSeq+"_"+simplify(this.firstChild.latex())+"^"+simplify(this.lastChild.latex())},_.parser=function(){for(var string=Parser.string,optWhitespace=Parser.optWhitespace,succeed=Parser.succeed,block=latexMathParser.block,self=this,blocks=self.blocks=[MathBlock(),MathBlock()],i=0;i<blocks.length;i+=1)blocks[i].adopt(self,self.lastChild,0);return optWhitespace.then(string("_").or(string("^"))).then(function(supOrSub){var child=blocks["_"===supOrSub?0:1];return block.then(function(block){return block.children().adopt(child,child.lastChild,0),succeed(self)})}).many().result(self)},_.finalizeTree=function(){this.down=this.firstChild,this.firstChild.up=insertAfterUnlessAtBeginning,this.up=this.lastChild,this.lastChild.down=insertAfterUnlessAtBeginning}});LatexCmds[""]=LatexCmds.sum=LatexCmds.summation=bind(BigSymbol,"\\sum ","&sum;"),LatexCmds[""]=LatexCmds.prod=LatexCmds.product=bind(BigSymbol,"\\prod ","&prod;"),LatexCmds[""]=LatexCmds.int=bind(BigSymbol,"\\int ","&int;");var Fraction=LatexCmds.frac=LatexCmds.dfrac=LatexCmds.cfrac=LatexCmds.fraction=P(MathCommand,function(_,_super){_.ctrlSeq="\\frac",_.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0;overflow:hidden">&nbsp;</span></span>',_.textTemplate=["(","/",")"],_.finalizeTree=function(){this.up=this.lastChild.up=this.firstChild,this.down=this.firstChild.down=this.lastChild},_.expectedCursorYNextTo=function(clientRect){return clientRect.elById(this.jQ[0].lastChild,this.id+.5).top}}),LiveFraction=LatexCmds.over=CharCmds["/"]=P(Fraction,function(_,_super){_.createBefore=function(cursor){if(!this.replacedFragment){var prev=cursor.prev;if(prev instanceof TextBlock||prev instanceof Fraction)prev=prev.prev;else{for(;prev&&!(prev instanceof BinaryOperator||prev instanceof TextBlock||prev instanceof BigSymbol||prev instanceof Fraction||","===prev.ctrlSeq||":"===prev.ctrlSeq||"\\space "===prev.ctrlSeq);)prev=prev.prev;prev instanceof BigSymbol&&prev.next instanceof SupSub&&(prev=prev.next).next instanceof SupSub&&prev.next.ctrlSeq!=prev.ctrlSeq&&(prev=prev.next)}prev!==cursor.prev&&("\\frac"!=this.ctrlSeq&&0==cursor.getFractionMode()||"\\frac"==this.ctrlSeq&&1==cursor.getFractionMode())&&(this.replaces(MathFragment(prev.next||cursor.parent.firstChild,cursor.prev)),cursor.prev=prev)}_super.createBefore.call(this,cursor)}}),SquareRoot=LatexCmds.sqrt=LatexCmds[""]=P(MathCommand,function(_,_super){_.ctrlSeq="\\sqrt",_.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',_.textTemplate=["sqrt(",")"],_.parser=function(){return latexMathParser.optBlock.then(function(optBlock){return latexMathParser.block.map(function(block){var nthroot=NthRoot();return nthroot.blocks=[optBlock,block],optBlock.adopt(nthroot,0,0),block.adopt(nthroot,optBlock,0),nthroot})}).or(_super.parser.call(this))},_.redraw=function(){var block=this.lastChild.jQ;scale(block.prev(),1,block.innerHeight()/+block.css("fontSize").slice(0,-2)-.1)}}),NthRoot=LatexCmds.nthroot=P(SquareRoot,function(_,_super){_.ctrlSeq="\\root",_.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',_.textTemplate=["sqrt[","](",")"],_.onKey=function(key,e){if(this.getCursor().parent.parent===this)switch(key){case"Right":if(this.getCursor().next)return;case"Tab":if(this.getCursor().parent===this.firstChild)return this.getCursor().prepareMove().prependTo(this.lastChild),e.preventDefault(),!1;break;case"Left":if(this.getCursor().prev)return;case"Shift-Tab":if(this.getCursor().parent===this.lastChild)return this.getCursor().prepareMove().appendTo(this.firstChild),e.preventDefault(),!1}},_.getCursor=SupSub.prototype.getCursor,_.expectedCursorYNextTo=function(clientRect){return clientRect.elById(this.jQ[0],this.id+.5).bottom}}),Bracket=P(MathCommand,function(_,_super){_.init=function(open,close,ctrlSeq,end){_super.init.call(this,"\\left"+ctrlSeq,'<span class="mq-non-leaf"><span class="mq-scaled mq-paren">'+open+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren">'+close+"</span></span>",[open,close]),this.end="\\right"+end},_.jQadd=function(){_super.jQadd.apply(this,arguments);var jQ=this.jQ;this.bracketjQs=jQ.children(":first").add(jQ.children(":last"))},_.finalizeTree=function(){if(this.firstChild.isEmpty()&&this.next){var nextAll=MathFragment(this.next,this.parent.lastChild).disown();nextAll.adopt(this.firstChild,0,0),nextAll.jQ.appendTo(this.firstChild.jQ)}},_.placeCursor=function(cursor){cursor.prependTo(this.firstChild)},_.latex=function(){return this.ctrlSeq+this.firstChild.latex()+this.end},_.redraw=function(){var blockjQ=this.firstChild.jQ,height=blockjQ.outerHeight()/+blockjQ.css("fontSize").slice(0,-2);scale(this.bracketjQs,min(1+.2*(height-1),1.2),1.05*height)}});LatexCmds.left=P(MathCommand,function(_){_.parser=function(){var regex=Parser.regex,string=Parser.string,regex=Parser.regex,succeed=Parser.succeed,optWhitespace=(latexMathParser.block,Parser.optWhitespace);return optWhitespace.then(regex(/^(?:[([|]|\\\{)/)).then(function(open){"\\"===open.charAt(0)&&(open=open.slice(1));var cmd=CharCmds[open]();return latexMathParser.map(function(block){cmd.blocks=[block],block.adopt(cmd,0,0)}).then(string("\\right")).skip(optWhitespace).then(regex(/^(?:[\])|]|\\\})/)).then(function(close){return close.slice(-1)!==cmd.end.slice(-1)?Parser.fail("open doesn't match close"):succeed(cmd)})})}}),LatexCmds.right=P(MathCommand,function(_){_.parser=function(){return Parser.fail("unmatched \\right")}}),LatexCmds.lbrace=CharCmds["{"]=bind(Bracket,"{","}","\\{","\\}"),LatexCmds.langle=LatexCmds.lang=bind(Bracket,"&lang;","&rang;","\\langle ","\\rangle ");var CloseBracket=P(Bracket,function(_,_super){_.createBefore=function(cursor){if(this.replacedFragment)return _super.createBefore.call(this,cursor);var openParen=cursor.parent.parent;if(openParen.ctrlSeq===this.ctrlSeq){if(cursor.next){var nextAll=MathFragment(cursor.next,openParen.firstChild.lastChild).disown();nextAll.adopt(openParen.parent,openParen,openParen.next),nextAll.jQ.insertAfter(openParen.jQ),cursor.next.respace&&cursor.next.respace()}cursor.insertAfter(openParen),openParen.bubble("redraw")}else _super.createBefore.call(this,cursor),cursor.appendTo(this.firstChild)},_.finalizeTree=noop,_.placeCursor=function(cursor){this.firstChild.blur(),cursor.insertAfter(this)}});LatexCmds.rbrace=CharCmds["}"]=bind(CloseBracket,"{","}","\\{","\\}"),LatexCmds.rangle=LatexCmds.rang=bind(CloseBracket,"&lang;","&rang;","\\langle ","\\rangle ");var parenMixin=function(_,_super){_.init=function(open,close){_super.init.call(this,open,close,open,close)}},Paren=P(Bracket,parenMixin);LatexCmds.lparen=CharCmds["("]=bind(Paren,"(",")"),LatexCmds.lbrack=LatexCmds.lbracket=CharCmds["["]=bind(Paren,"[","]");var CloseParen=P(CloseBracket,parenMixin);LatexCmds.rparen=CharCmds[")"]=bind(CloseParen,"(",")"),LatexCmds.rbrack=LatexCmds.rbracket=CharCmds["]"]=bind(CloseParen,"[","]");LatexCmds.lpipe=LatexCmds.rpipe=CharCmds["|"]=P(Paren,function(_,_super){_.init=function(){_super.init.call(this,"|","|")},_.createBefore=function(cursor){cursor.next||!cursor.parent.parent||cursor.parent.parent.end!==this.end||this.replacedFragment?MathCommand.prototype.createBefore.call(this,cursor):cursor.insertAfter(cursor.parent.parent)},_.finalizeTree=noop});var TextBlock=LatexCmds.text=LatexCmds.textnormal=LatexCmds.textrm=LatexCmds.textup=LatexCmds.textmd=P(MathCommand,function(_,_super){_.ctrlSeq="\\text",_.htmlTemplate='<span class="mq-text">&0</span>',_.replaces=function(replacedText){replacedText instanceof MathFragment?this.replacedText=replacedText.remove().jQ.text():"string"==typeof replacedText&&(this.replacedText=replacedText)},_.textTemplate=['"','"'],_.parser=function(){var string=Parser.string,regex=Parser.regex;return Parser.optWhitespace.then(string("{")).then(regex(/^[^}]*/)).skip(string("}")).map(function(text){var cmd=TextBlock();cmd.createBlocks();for(var block=cmd.firstChild,i=0;i<text.length;i+=1)VanillaSymbol(text.charAt(i)).adopt(block,block.lastChild,0);return cmd})},_.createBlocks=function(){this.firstChild=this.lastChild=InnerTextBlock(),this.blocks=[this.firstChild],this.firstChild.parent=this},_.finalizeInsert=function(){this.firstChild.blur=function(){return delete this.blur,this},_super.finalizeInsert.call(this)},_.createBefore=function(cursor){if(_super.createBefore.call(this,this.cursor=cursor),this.replacedText)for(var i=0;i<this.replacedText.length;i+=1)this.write(this.replacedText.charAt(i))},_.write=function(ch){this.cursor.insertNew(VanillaSymbol(ch))},_.onKey=function(key,e){if(!this.cursor.selection&&("Backspace"===key&&!this.cursor.prev||"Del"===key&&!this.cursor.next))return this.isEmpty()&&this.cursor.insertAfter(this),!1},_.onText=function(ch){if(this.cursor.prepareEdit(),"$"!==ch)this.write(ch);else if(this.isEmpty())this.cursor.insertAfter(this).backspace().insertNew(VanillaSymbol("\\$","$"));else if(this.cursor.next)if(this.cursor.prev){var next=TextBlock(MathFragment(this.cursor.next,this.firstChild.lastChild));next.placeCursor=function(cursor){this.prev=0,delete this.placeCursor,this.placeCursor(cursor)},next.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(next),next.prev=this,this.cursor.insertBefore(next),delete next.firstChild.focus}else this.cursor.insertBefore(this);else this.cursor.insertAfter(this);return this.cursor.root.triggerSpecialEvent("render"),!1}}),InnerTextBlock=P(MathBlock,function(_,_super){_.blur=function(){if(this.jQ.removeClass("mq-hasCursor"),this.isEmpty()){var textblock=this.parent,cursor=textblock.cursor;cursor.parent===this?this.jQ.addClass("mq-empty"):(cursor.hide(),textblock.remove(),cursor.next===textblock?cursor.next=textblock.next:cursor.prev===textblock&&(cursor.prev=textblock.prev),cursor.show().parent.bubble("redraw"))}return this},_.focus=function(){_super.focus.call(this);var textblock=this.parent;if(textblock.next.ctrlSeq===textblock.ctrlSeq){var innerblock=this,cursor=textblock.cursor,next=textblock.next.firstChild;next.eachChild(function(child){child.parent=innerblock,child.jQ.appendTo(innerblock.jQ)}),this.lastChild?this.lastChild.next=next.firstChild:this.firstChild=next.firstChild,next.firstChild.prev=this.lastChild,this.lastChild=next.lastChild,next.parent.remove(),cursor.prev?cursor.insertAfter(cursor.prev):cursor.prependTo(this),cursor.parent.bubble("redraw")}else textblock.prev.ctrlSeq===textblock.ctrlSeq&&((cursor=textblock.cursor).prev?textblock.prev.firstChild.focus():cursor.appendTo(textblock.prev.firstChild));return this}});LatexCmds.em=LatexCmds.italic=LatexCmds.italics=LatexCmds.emph=LatexCmds.textit=LatexCmds.textsl=makeTextBlock("\\textit","i",'class="mq-text"'),LatexCmds.strong=LatexCmds.bold=LatexCmds.textbf=makeTextBlock("\\textbf","b",'class="mq-text"'),LatexCmds.sf=LatexCmds.textsf=makeTextBlock("\\textsf","span",'class="mq-sans-serif mq-text"'),LatexCmds.tt=LatexCmds.texttt=makeTextBlock("\\texttt","span",'class="mq-monospace mq-text"'),LatexCmds.textsc=makeTextBlock("\\textsc","span",'style="font-variant:small-caps" class="mq-text"'),LatexCmds.uppercase=makeTextBlock("\\uppercase","span",'style="text-transform:uppercase" class="mq-text"'),LatexCmds.lowercase=makeTextBlock("\\lowercase","span",'style="text-transform:lowercase" class="mq-text"');P(MathCommand,function(_,_super){_.ctrlSeq="\\",_.replaces=function(replacedFragment){this._replacedFragment=replacedFragment.disown(),this.isEmpty=function(){return!1}},_.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',_.textTemplate=["\\"],_.createBlocks=function(){_super.createBlocks.call(this),this.firstChild.focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.firstChild.blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this}},_.createBefore=function(cursor){if(_super.createBefore.call(this,cursor),this.cursor=cursor.appendTo(this.firstChild),this._replacedFragment){var el=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(e){return $(e.target=el).trigger(e),!1}).insertBefore(this.jQ).add(this.jQ)}},_.latex=function(){return"\\"+this.firstChild.latex()+" "},_.onKey=function(key,e){if("Tab"===key||"Enter"===key)return this.renderCommand(),this.cursor.root.triggerSpecialEvent("render"),e.preventDefault(),!1},_.onText=function(ch){return ch.match(/[a-z]/i)?(this.cursor.prepareEdit(),this.cursor.insertNew(VanillaSymbol(ch)),!1):(this.renderCommand()," "===ch||"\\"===ch&&this.firstChild.isEmpty()?(this.cursor.root.triggerSpecialEvent("render"),!1):void 0)},_.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var latex=this.firstChild.latex();latex||(latex="backslash"),this.cursor.insertCmd(latex,this._replacedFragment)}});var Binomial=LatexCmds.binom=LatexCmds.binomial=P(MathCommand,function(_,_super){_.ctrlSeq="\\binom",_.htmlTemplate='<span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span>',_.textTemplate=["choose(",",",")"],_.redraw=function(){var blockjQ=this.jQ.eq(1),height=blockjQ.outerHeight()/+blockjQ.css("fontSize").slice(0,-2),parens=this.jQ.filter(".mq-paren");scale(parens,min(1+.2*(height-1),1.2),1.05*height)},_.expectedCursorYNextTo=Symbol.prototype.expectedCursorYNextTo});LatexCmds.choose=P(Binomial,function(_){_.createBefore=LiveFraction.prototype.createBefore}),LatexCmds.vector=P(MathCommand,function(_,_super){_.ctrlSeq="\\vector",_.htmlTemplate='<span class="mq-array"><span>&0</span></span>',_.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(latex,child){return latex.push(child.latex()),latex}).join("\\\\")+"\\end{matrix}"},_.text=function(){return"["+this.foldChildren([],function(text,child){return text.push(child.text()),text}).join()+"]"},_.createBefore=function(cursor){_super.createBefore.call(this,this.cursor=cursor)},_.onKey=function(key,e){var currentBlock=this.cursor.parent;if(currentBlock.parent===this){if("Enter"===key)return(newBlock=MathBlock()).parent=this,newBlock.jQ=$("<span></span>").attr(mqBlockId,newBlock.id).insertAfter(currentBlock.jQ),currentBlock.next?currentBlock.next.prev=newBlock:this.lastChild=newBlock,newBlock.next=currentBlock.next,currentBlock.next=newBlock,newBlock.prev=currentBlock,this.bubble("redraw").cursor.appendTo(newBlock),e.preventDefault(),!1;if("Tab"===key&&!currentBlock.next){if(currentBlock.isEmpty())return currentBlock.prev?(this.cursor.insertAfter(this),delete currentBlock.prev.next,this.lastChild=currentBlock.prev,currentBlock.jQ.remove(),this.bubble("redraw"),e.preventDefault(),!1):void 0;var newBlock=MathBlock();return newBlock.parent=this,newBlock.jQ=$("<span></span>").attr(mqBlockId,newBlock.id).appendTo(this.jQ),this.lastChild=newBlock,currentBlock.next=newBlock,newBlock.prev=currentBlock,this.bubble("redraw").cursor.appendTo(newBlock),e.preventDefault(),!1}if(8===e.which){if(currentBlock.isEmpty())return currentBlock.prev?(this.cursor.appendTo(currentBlock.prev),currentBlock.prev.next=currentBlock.next):(this.cursor.insertBefore(this),this.firstChild=currentBlock.next),currentBlock.next?currentBlock.next.prev=currentBlock.prev:this.lastChild=currentBlock.prev,currentBlock.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),e.preventDefault(),!1;if(!this.cursor.prev)return e.preventDefault(),!1}}},_.expectedCursorYNextTo=Binomial.prototype.expectedCursorYNextTo});LatexCmds.MathQuillMathField=P(MathCommand,function(_,_super){_.ctrlSeq="\\MathQuillMathField",_.htmlTemplate='<span class="mathquill-editable">&0</span>',_.finalizeTree=function(){var self=this,rootBlock=RootMathBlock();delete MathElement[rootBlock.id],rootBlock.id=self.firstChild.id,MathElement[rootBlock.id]=rootBlock,self.firstChild.children().disown().adopt(rootBlock,0,0),rootBlock.parent=self,self.firstChild=self.lastChild=rootBlock,self.blocks=[rootBlock],rootBlock.jQ=self.jQ.wrapInner('<span class="mathquill-root-block"/>').children(),rootBlock.editable=!0;var cursor=rootBlock.cursor=Cursor(rootBlock).appendTo(rootBlock),textarea=setupTextarea(!0,self.jQ,rootBlock,cursor);setupTouchHandle(0,rootBlock,cursor),focusBlurEvents(rootBlock,cursor,textarea),desmosCustomEvents(self.jQ,rootBlock,cursor)},_.mqLatex=_super.latex,_.latex=function(){return this.firstChild.latex()},_.text=function(){return this.firstChild.text()}});var Variable=P(Symbol,function(_,_super){_.init=function(ch,html){_super.init.call(this,ch,"<var>"+(html||ch)+"</var>")},_.createBefore=function(cursor){for(var ctrlSeq=this.ctrlSeq,i=0,prev=cursor.prev;i<MAX_AUTOCMD_LEN-1&&prev&&prev instanceof Variable;i+=1,prev=prev.prev)ctrlSeq=prev.ctrlSeq+ctrlSeq;for(;ctrlSeq.length;){if(AutoCmds.hasOwnProperty(ctrlSeq)){for(i=1;i<ctrlSeq.length;i+=1)cursor.backspace();return void(/^(sin|cos|tan|arcsin|arccos|arctan)$/i.test(ctrlSeq)?(cursor.insertNew(CharCmds["("]("(")),cursor.moveLeft(),cursor.insertNew(LatexCmds[ctrlSeq](ctrlSeq)),cursor.moveRight()):cursor.insertNew(LatexCmds[ctrlSeq](ctrlSeq)))}ctrlSeq=ctrlSeq.slice(1)}_super.createBefore.apply(this,arguments)},_.respace=_.finalizeTree=function(){var ctrlSeq=this.ctrlSeq;if(!(ctrlSeq.length>1)){for(var prev=this.prev;prev instanceof Variable&&1===prev.ctrlSeq.length;prev=prev.prev)ctrlSeq=prev.ctrlSeq+ctrlSeq;for(var next=this.next;next instanceof Variable&&1===next.ctrlSeq.length;next=next.next)ctrlSeq+=next.ctrlSeq;MathFragment(prev.next||this.parent.firstChild,next.prev||this.parent.lastChild).each(function(el){el.jQ.removeClass("mq-un-italicized mq-last"),delete el.isFirstLetter,delete el.isLastLetter});outer:for(var i=0,first=prev.next||this.parent.firstChild;i<ctrlSeq.length;i+=1,first=first.next)for(var len=min(MAX_UNITALICIZED_LEN,ctrlSeq.length-i);len>0;len-=1)if(UnItalicizedCmds.hasOwnProperty(ctrlSeq.slice(i,i+len))){first.isFirstLetter=!0;for(var j=0,letter=first;j<len;j+=1,letter=letter.next){letter.jQ.addClass("mq-un-italicized");var last=letter}last.isLastLetter=!0,last.next instanceof SupSub||last.next instanceof Bracket||last.jQ.addClass("mq-last"),i+=len-1,first=last;continue outer}}},_.latex=function(){return this.isFirstLetter?"\\"+this.ctrlSeq:this.isLastLetter?this.ctrlSeq+" ":this.ctrlSeq},_.text=function(){var text=this.ctrlSeq;return!this.prev||this.prev instanceof Variable||this.prev instanceof BinaryOperator||(text="*"+text),!this.next||this.next instanceof BinaryOperator||"^"===this.next.ctrlSeq||(text+="*"),text}}),UnItalicized=P(Symbol,function(_,_super){_.init=function(fn){this.ctrlSeq=fn},_.createBefore=function(cursor){cursor.writeLatex(this.ctrlSeq).show()},_.parser=function(){for(var fn=this.ctrlSeq,block=MathBlock(),i=0;i<fn.length;i+=1)Variable(fn.charAt(i)).adopt(block,block.lastChild,0);return Parser.succeed(block.children())}}),UnItalicizedCmds={ln:1,log:1,min:1,nCr:1,nPr:1,gcd:1,lcm:1,mcm:1,mcd:1,ceil:1,exp:1,abs:1,max:1,mod:1,gcf:1,exp:1,floor:1,sign:1,signum:1,round:1},MAX_UNITALICIZED_LEN=9,AutoCmds={sin:1,cos:1,tan:1,arcsin:1,arccos:1,arctan:1,sqrt:1,nthroot:1,sum:1,prod:1,pi:1,phi:1,tau:1,gamma:1,theta:1},MAX_AUTOCMD_LEN=7;!function(){var trigs={sin:1,cos:1,tan:1,sec:1,cosec:1,csc:1,cotan:1,cot:1,ctg:1};for(var trig in trigs)UnItalicizedCmds[trig]=UnItalicizedCmds["arc"+trig]=UnItalicizedCmds[trig+"h"]=UnItalicizedCmds["arc"+trig+"h"]=1;for(var fn in UnItalicizedCmds)LatexCmds[fn]=UnItalicized}();var VanillaSymbol=P(Symbol,function(_,_super){_.init=function(ch,html){_super.init.call(this,ch,"<span>"+(html||ch)+"</span>")}});CharCmds[" "]=bind(VanillaSymbol,"\\space "," "),LatexCmds.prime=CharCmds["'"]=bind(VanillaSymbol,"'","&prime;");var NonSymbolaSymbol=P(Symbol,function(_,_super){_.init=function(ch,html){_super.init.call(this,ch,'<span class="mq-nonSymbola">'+(html||ch)+"</span>")}});LatexCmds.$=NonSymbolaSymbol,LatexCmds["@"]=NonSymbolaSymbol,LatexCmds["&"]=bind(NonSymbolaSymbol,"\\&","&amp;"),LatexCmds["%"]=bind(NonSymbolaSymbol,"\\%","%"),LatexCmds.alpha=LatexCmds.beta=LatexCmds.gamma=LatexCmds.delta=LatexCmds.zeta=LatexCmds.eta=LatexCmds.theta=LatexCmds.iota=LatexCmds.kappa=LatexCmds.mu=LatexCmds.nu=LatexCmds.xi=LatexCmds.rho=LatexCmds.sigma=LatexCmds.tau=LatexCmds.chi=LatexCmds.psi=LatexCmds.omega=P(Variable,function(_,_super){_.init=function(latex){_super.init.call(this,"\\"+latex+" ","&"+latex+";")}}),LatexCmds.sin=bind(VanillaSymbol,"\\sin ","sin"),LatexCmds.cos=bind(VanillaSymbol,"\\cos ","cos"),LatexCmds.tan=bind(VanillaSymbol,"\\tan ","tan"),LatexCmds.arcsin=bind(VanillaSymbol,"\\arcsin ","arcsin"),LatexCmds.arccos=bind(VanillaSymbol,"\\arccos ","arccos"),LatexCmds.arctan=bind(VanillaSymbol,"\\arctan ","arctan"),LatexCmds.phi=bind(Variable,"\\phi ","&#981;"),LatexCmds.phiv=LatexCmds.varphi=bind(Variable,"\\varphi ","&phi;"),LatexCmds.epsilon=bind(Variable,"\\epsilon ","&#1013;"),LatexCmds.epsiv=LatexCmds.varepsilon=bind(Variable,"\\varepsilon ","&epsilon;"),LatexCmds.piv=LatexCmds.varpi=bind(Variable,"\\varpi ","&piv;"),LatexCmds.sigmaf=LatexCmds.sigmav=LatexCmds.varsigma=bind(Variable,"\\varsigma ","&sigmaf;"),LatexCmds.thetav=LatexCmds.vartheta=LatexCmds.thetasym=bind(Variable,"\\vartheta ","&thetasym;"),LatexCmds.upsilon=LatexCmds.upsi=bind(Variable,"\\upsilon ","&upsilon;"),LatexCmds.gammad=LatexCmds.Gammad=LatexCmds.digamma=bind(Variable,"\\digamma ","&#989;"),LatexCmds.kappav=LatexCmds.varkappa=bind(Variable,"\\varkappa ","&#1008;"),LatexCmds.rhov=LatexCmds.varrho=bind(Variable,"\\varrho ","&#1009;"),LatexCmds.pi=LatexCmds[""]=bind(NonSymbolaSymbol,"\\pi ","&pi;"),LatexCmds.theta=LatexCmds[""]=bind(NonSymbolaSymbol,"\\theta ","&theta;"),LatexCmds.lambda=bind(NonSymbolaSymbol,"\\lambda ","&lambda;"),LatexCmds.Upsilon=LatexCmds.Upsi=LatexCmds.upsih=LatexCmds.Upsih=bind(Symbol,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),LatexCmds.Gamma=LatexCmds.Delta=LatexCmds.Theta=LatexCmds.Lambda=LatexCmds.Xi=LatexCmds.Pi=LatexCmds.Sigma=LatexCmds.Phi=LatexCmds.Psi=LatexCmds.Omega=LatexCmds.forall=P(VanillaSymbol,function(_,_super){_.init=function(latex){_super.init.call(this,"\\"+latex+" ","&"+latex+";")}});var LatexFragment=P(MathCommand,function(_){_.init=function(latex){this.latex=latex},_.createBefore=function(cursor){cursor.writeLatex(this.latex)},_.parser=function(){var frag=latexMathParser.parse(this.latex).children();return Parser.succeed(frag)}});LatexCmds[""]=bind(LatexFragment,"^1"),LatexCmds[""]=bind(LatexFragment,"^2"),LatexCmds[""]=bind(LatexFragment,"^3"),LatexCmds[""]=bind(LatexFragment,"\\frac14"),LatexCmds[""]=bind(LatexFragment,"\\frac12"),LatexCmds[""]=bind(LatexFragment,"\\frac34"),LatexCmds[""]=bind(LatexFragment,"\\frac{1}{10}"),LatexCmds[""]=bind(LatexFragment,"\\frac13"),LatexCmds[""]=bind(LatexFragment,"\\frac23");var BinaryOperator=P(Symbol,function(_,_super){_.init=function(ctrlSeq,html,text){_super.init.call(this,ctrlSeq,'<span class="mq-binary-operator">'+html+"</span>",text)},_.createBefore=function(cursor){var ctrlSeq=cursor.prev.ctrlSeq+this.ctrlSeq;"<="===ctrlSeq&&cursor.overridenOperators&&cursor.overridenOperators.le?cursor.backspace().insertNew(BinaryOperator("\\le ","&le;")):">="===ctrlSeq&&cursor.overridenOperators&&cursor.overridenOperators.ge?cursor.backspace().insertNew(BinaryOperator("\\ge ","&ge;")):_super.createBefore.apply(this,arguments)}}),PlusMinus=P(BinaryOperator,function(_){_.init=VanillaSymbol.prototype.init,_.respace=function(){return this.prev?this.prev instanceof BinaryOperator&&this.next&&!(this.next instanceof BinaryOperator)?this.jQ[0].className="mq-unary-operator":this.jQ[0].className="mq-binary-operator":this.jQ[0].className="",this}});LatexCmds["+"]=bind(PlusMinus,"+","+"),LatexCmds[""]=LatexCmds[""]=LatexCmds["-"]=bind(PlusMinus,"-","&minus;"),LatexCmds[""]=LatexCmds.pm=LatexCmds.plusmn=LatexCmds.plusminus=bind(PlusMinus,"\\pm ","&plusmn;"),LatexCmds.mp=LatexCmds.mnplus=LatexCmds.minusplus=bind(PlusMinus,"\\mp ","&#8723;"),LatexCmds.sdot=LatexCmds.cdot=bind(BinaryOperator,"\\cdot ","&middot;"),LatexCmds.bull=LatexCmds.bullet=bind(BinaryOperator,"\\bullet ","&bull;"),LatexCmds["="]=bind(BinaryOperator,"=","="),LatexCmds["<"]=bind(BinaryOperator,"<","&lt;"),LatexCmds[">"]=bind(BinaryOperator,">","&gt;"),LatexCmds.notin=LatexCmds.sim=LatexCmds.cong=LatexCmds.equiv=LatexCmds.oplus=LatexCmds.otimes=P(BinaryOperator,function(_,_super){_.init=function(latex){_super.init.call(this,"\\"+latex+" ","&"+latex+";")}}),LatexCmds.times=bind(BinaryOperator,"\\times ","&times;","[x]"),LatexCmds[""]=LatexCmds.div=LatexCmds.divide=LatexCmds.divides=bind(BinaryOperator,"\\div ","&divide;","[/]"),LatexCmds[""]=LatexCmds.ne=LatexCmds.neq=bind(BinaryOperator,"\\ne ","&ne;"),LatexCmds.ast=LatexCmds.star=LatexCmds.loast=LatexCmds.lowast=bind(BinaryOperator,"\\ast ","&lowast;"),LatexCmds.therefor=LatexCmds.therefore=bind(BinaryOperator,"\\therefore ","&there4;"),LatexCmds.cuz=LatexCmds.because=bind(BinaryOperator,"\\because ","&#8757;"),LatexCmds.prop=LatexCmds.propto=bind(BinaryOperator,"\\propto ","&prop;"),LatexCmds[""]=LatexCmds.asymp=LatexCmds.approx=bind(BinaryOperator,"\\approx ","&asymp;"),LatexCmds.lt=bind(BinaryOperator,"<","&lt;"),LatexCmds.gt=bind(BinaryOperator,">","&gt;"),LatexCmds[""]=LatexCmds.le=LatexCmds.leq=bind(BinaryOperator,"\\le ","&le;"),LatexCmds[""]=LatexCmds.ge=LatexCmds.geq=bind(BinaryOperator,"\\ge ","&ge;"),LatexCmds.isin=LatexCmds.in=bind(BinaryOperator,"\\in ","&isin;"),LatexCmds.ni=LatexCmds.contains=bind(BinaryOperator,"\\ni ","&ni;"),LatexCmds.notni=LatexCmds.niton=LatexCmds.notcontains=LatexCmds.doesnotcontain=bind(BinaryOperator,"\\not\\ni ","&#8716;"),LatexCmds.sub=LatexCmds.subset=bind(BinaryOperator,"\\subset ","&sub;"),LatexCmds.sup=LatexCmds.supset=LatexCmds.superset=bind(BinaryOperator,"\\supset ","&sup;"),LatexCmds.nsub=LatexCmds.notsub=LatexCmds.nsubset=LatexCmds.notsubset=bind(BinaryOperator,"\\not\\subset ","&#8836;"),LatexCmds.nsup=LatexCmds.notsup=LatexCmds.nsupset=LatexCmds.notsupset=LatexCmds.nsuperset=LatexCmds.notsuperset=bind(BinaryOperator,"\\not\\supset ","&#8837;"),LatexCmds.sube=LatexCmds.subeq=LatexCmds.subsete=LatexCmds.subseteq=bind(BinaryOperator,"\\subseteq ","&sube;"),LatexCmds.supe=LatexCmds.supeq=LatexCmds.supsete=LatexCmds.supseteq=LatexCmds.supersete=LatexCmds.superseteq=bind(BinaryOperator,"\\supseteq ","&supe;"),LatexCmds.nsube=LatexCmds.nsubeq=LatexCmds.notsube=LatexCmds.notsubeq=LatexCmds.nsubsete=LatexCmds.nsubseteq=LatexCmds.notsubsete=LatexCmds.notsubseteq=bind(BinaryOperator,"\\not\\subseteq ","&#8840;"),LatexCmds.nsupe=LatexCmds.nsupeq=LatexCmds.notsupe=LatexCmds.notsupeq=LatexCmds.nsupsete=LatexCmds.nsupseteq=LatexCmds.notsupsete=LatexCmds.notsupseteq=LatexCmds.nsupersete=LatexCmds.nsuperseteq=LatexCmds.notsupersete=LatexCmds.notsuperseteq=bind(BinaryOperator,"\\not\\supseteq ","&#8841;"),LatexCmds.Box=bind(VanillaSymbol,"\\Box ",""),LatexCmds.mid=bind(VanillaSymbol,"\\mid ",""),LatexCmds.space=bind(VanillaSymbol,"\\space ","&nbsp;"),LatexCmds.and=LatexCmds.land=LatexCmds.wedge=bind(VanillaSymbol,"\\wedge ","&and;"),LatexCmds.or=LatexCmds.lor=LatexCmds.vee=bind(VanillaSymbol,"\\vee ","&or;");var latexMathParser=function(){function joinBlocks(blocks){for(var firstBlock=blocks[0]||MathBlock(),i=1;i<blocks.length;i+=1)blocks[i].children().adopt(firstBlock,firstBlock.lastChild,0);return firstBlock}var string=Parser.string,regex=Parser.regex,letter=Parser.letter,any=Parser.any,optWhitespace=Parser.optWhitespace,succeed=Parser.succeed,fail=Parser.fail,variable=letter.map(Variable),symbol=regex(/^[^${}\\_^]/).map(VanillaSymbol),command=regex(/^[^\\]/).or(string("\\").then(regex(/^[a-z]+/i).or(regex(/^\s+/).result(" ")).or(any))).then(function(ctrlSeq){var cmdKlass=LatexCmds[ctrlSeq];return cmdKlass?cmdKlass(ctrlSeq).parser():fail("unknown command: \\"+ctrlSeq)}).or(variable).or(symbol),mathGroup=string("{").then(function(){return mathSequence}).skip(string("}")),mathBlock=optWhitespace.then(mathGroup.or(command.map(function(cmd){var block=MathBlock();return cmd.adopt(block,0,0),block}))),mathSequence=mathBlock.many().map(joinBlocks).skip(optWhitespace),optMathBlock=string("[").then(mathBlock.then(function(block){return"]"!==block.join("latex")?succeed(block):fail()}).many().map(joinBlocks).skip(optWhitespace)).skip(string("]")),latexMath=mathSequence;return latexMath.block=mathBlock,latexMath.optBlock=optMathBlock,latexMath}(),Cursor=P(function(_){function moveUpDown(self,dir){if(self.next[dir])self.prependTo(self.next[dir]);else if(self.prev[dir])self.appendTo(self.prev[dir]);else{var ancestorBlock=self.parent;do{var prop=ancestorBlock[dir];if(prop&&("function"==typeof prop&&(prop=ancestorBlock[dir](self)),!1===prop||prop instanceof MathBlock)){if(self.upDownCache[ancestorBlock.id]={parent:self.parent,prev:self.prev,next:self.next},prop instanceof MathBlock){var cached=self.upDownCache[prop.id];if(cached)cached.next?self.insertBefore(cached.next):self.appendTo(cached.parent);else{var coords=self.jQ[0].getBoundingClientRect(),cachedClientRect=cachedClientRectFnForNewCache();cachedClientRect.scrollLeft=0,prop.seek(self,coords.left,coords.bottom,prop,cachedClientRect)}}break}ancestorBlock=ancestorBlock.parent.parent}while(ancestorBlock)}return self.clearSelection().show()}function clearUpDownCache(self){self.upDownCache={}}_.init=function(root){this.parent=this.root=root;var jQ=this.jQ=this._jQ=$('<span class="mq-cursor"><span class="mq-line">&zwj;</span></span>');this.blink=function(){jQ.toggleClass("mq-blink")},this.upDownCache={},this.handle=$('<span class="mq-handle"></span>'),this.handleAnchor=$('<span class="mq-handle-anchor" style="display:none"></span>').append(this.handle).insertAfter(root.jQ),this.handleAnchor.top=this.handleAnchor.left=0},_.prev=0,_.next=0,_.parent=0,_.showHandle=function(){return this.handleAnchor.visible||(this.handleAnchor.show(),this.repositionHandle(this.jQ[0].getBoundingClientRect()),this.handleAnchor.visible=!0),this},_.hideHandle=function(){return this.handleAnchor.visible&&(this.handleAnchor.hide(),delete this.handleAnchor.visible),this},_.repositionHandle=function(cursorRect){var anchor=this.handleAnchor,anchorRect=anchor[0].getBoundingClientRect();anchor.css({top:anchor.top+=cursorRect.bottom-anchorRect.bottom,left:anchor.left+=cursorRect.left-anchorRect.left})},_.show=function(keepHandle){return keepHandle||this.hideHandle(),this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.first.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},_.hide=function(){return this.hideHandle(),"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=$(),this},_.insertAt=function(parent,prev,next){var old_parent=this.parent;this.parent=parent,this.prev=prev,this.next=next,old_parent.blur()},_.insertBefore=function(el){return this.insertAt(el.parent,el.prev,el),this.parent.jQ.addClass("mq-hasCursor"),this.jQ.insertBefore(el.jQ.first()),this},_.insertAfter=function(el){return this.insertAt(el.parent,el,el.next),this.parent.jQ.addClass("mq-hasCursor"),this.jQ.insertAfter(el.jQ.last()),this},_.prependTo=function(el){return this.insertAt(el,0,el.firstChild),this.jQ.prependTo(el.jQ),el.focus(),this},_.appendTo=function(el){return this.insertAt(el,el.lastChild,0),this.jQ.appendTo(el.jQ),el.focus(),this},_.hopLeft=function(){return this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev,this},_.hopRight=function(){return this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next,this},_.moveLeftWithin=function(block){this.prev?this.prev instanceof NthRoot?this.appendTo(this.prev.lastChild):this.prev instanceof Fraction?this.appendTo(this.prev.lastChild):0==this.prev.prev&&0!=this.parent&&0!=this.parent.parent&&this.parent.parent instanceof Fraction&&void 0!==this.parent.up?this.appendTo(this.parent.parent.firstChild):this.prev.up instanceof MathBlock?this.appendTo(this.prev.up):this.prev.firstChild?this.appendTo(this.prev.firstChild):this.hopLeft():this.parent!==block?this.insertBefore(this.parent.parent):block.moveOutOf&&block.moveOutOf("left",this)},_.moveRightWithin=function(block){this.next?this.next.up instanceof MathBlock?this.prependTo(this.next.up):0==this.next.next&&0!=this.parent&&0!=this.parent.parent&&this.parent.parent instanceof Fraction&&void 0!==this.parent.down?this.prependTo(this.parent.parent.lastChild):this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight():this.parent!==block?this.insertAfter(this.parent.parent):block.moveOutOf&&block.moveOutOf("right",this)},_.moveLeft=function(){return clearUpDownCache(this),this.selection?this.insertBefore(this.selection.first).clearSelection():this.moveLeftWithin(this.root),this.root.triggerSpecialEvent("cursorMoved"),this.show()},_.moveRight=function(){return clearUpDownCache(this),this.selection?this.insertAfter(this.selection.last).clearSelection():this.moveRightWithin(this.root),this.root.triggerSpecialEvent("cursorMoved"),this.show()},_.moveUp=function(){return moveUpDown(this,"up")},_.moveDown=function(){return moveUpDown(this,"down")},_.seek=function(target,clientX,clientY,clientRect,keepHandle){clearUpDownCache(this);var cursor=this.clearSelection().show(keepHandle),nodeId=target.attr(mqBlockId)||target.attr("mathquill-command-id");if(!nodeId){var targetParent=target.parent();nodeId=targetParent.attr(mqBlockId)||targetParent.attr("mathquill-command-id")}var node=nodeId?MathElement[nodeId]:cursor.root;pray("nodeId is the id of some Node that exists",node);var dx=clientRect.scrollLeft=this.root.jQ.scrollLeft();return node.seek(cursor,clientX+dx,clientY,cursor.root,clientRect),delete clientRect.scrollLeft,this.root.scrollHoriz(),cursor},_.writeLatex=function(latex){var self=this;clearUpDownCache(self),self.show().deleteSelection();var all=Parser.all,eof=Parser.eof,block=latexMathParser.skip(eof).or(all.result(!1)).parse(latex);if(block&&!block.isEmpty()){block.children().adopt(self.parent,self.prev,self.next);var html=block.join("html");MathElement.jQize(html).insertBefore(self.jQ),self.prev=block.lastChild,block.finalizeInsert(),self.parent.bubble("redraw")}return this},_.autoCorrect=function(latex){var cursor=this;if(" "!=latex||cursor._superMode?("/"==latex&&cursor._superMode&&cursor.setFractionMode(0),cursor._superMode=!1):cursor._superMode=!0,/(\\sin|\\cos|\\tan)/gi.test(latex)||cursor.next&&/(\\sin|\\cos|\\tan)/gi.test(cursor.next.ctrlSeq)){for(var ctrlSeq="",i=0,prev=cursor.prev;prev&&prev instanceof Variable;prev=prev.prev)ctrlSeq=prev.ctrlSeq+ctrlSeq;if(/arc$/.test(ctrlSeq)){for(i=0;i<3;i++)cursor.backspace();latex="arc"+latex.slice(1)}else if(/ar$/.test(ctrlSeq)&&"c"==latex)for(latex=cursor.next.ctrlSeq.replace("\\","arc").replace(/\ /g,""),cursor.moveRight(),i=0;i<3;i++)cursor.backspace();else/(\\sin|\\cos|\\tan)/gi.test(latex)&&(latex=latex.slice(1))}return latex},_._superMode=!1,_._fractionModeId=0,_.setFractionMode=function(value){this._fractionModeId=value},_.getFractionMode=function(){return this._fractionModeId},_.write=_.insertCh=function(ch,overrideRestrictForCh){var updatedCh=this.autoCorrect(ch);if(updatedCh!=ch&&updatedCh.length>1)return this.insertCmd(updatedCh);if(((overrideRestrictForCh=void 0!==overrideRestrictForCh&&overrideRestrictForCh)||!this.restrictContentKeys||function(cursor,keyPressed){for(var ctrlSeq="",prev=cursor.prev;prev&&prev instanceof Variable;prev=prev.prev)ctrlSeq=prev.ctrlSeq+ctrlSeq;ctrlSeq+=keyPressed;for(var next=cursor.next;next&&next instanceof Variable;next=next.next)ctrlSeq+=next.ctrlSeq;return cursor.restrictContentKeys.match(ctrlSeq)}(this,ch))&&(this.overridenOperators&&this.overridenOperators[ch]&&(ch=this.overridenOperators[ch]),"^"!=ch&&"_"!=ch||this.prev))if("="!=ch&&"<"!=ch&&">"!=ch&&""!=ch&&""!=ch||"^"!==this.parent.parent.ctrlSeq&&"_"!==this.parent.parent.ctrlSeq||this.next||!this.prev||this.moveRight(),"^"===ch&&this.prev instanceof SupSub&&("^"===this.prev.ctrlSeq||"^"===this.prev.prev.ctrlSeq))this.moveUp();else if("^"===ch&&this.next instanceof SupSub&&("^"===this.next.ctrlSeq||this.next.next&&"^"===this.next.next.ctrlSeq))this.moveUp();else{if(!("_"===ch&&this.prev instanceof SupSub)||"_"!==this.prev.ctrlSeq&&"_"!==this.prev.prev.ctrlSeq){clearUpDownCache(this),this.show(),"*"==ch&&void 0===CharCmds[ch]?CharCmds["*"]=LatexCmds.ast:""==ch&&void 0===CharCmds[ch]&&(CharCmds[""]=LatexCmds.bullet);var cmd;return cmd=ch.match(/^[a-z]$/i)?Variable(ch):(cmd=CharCmds[ch]||LatexCmds[ch])?cmd(ch):VanillaSymbol(ch),this.selection&&(this.prev=this.selection.first.prev,this.next=this.selection.last.next,cmd.replaces(this.selection),delete this.selection),this.insertNew(cmd)}this.moveDown()}},_.insertNew=function(cmd){return cmd.createBefore(this),this},_.insertCmd=function(latexCmd,replacedFragment){clearUpDownCache(this),this.show(),/(\\sin|\\cos|\\tan)/gi.test("\\"+latexCmd)&&(latexCmd=this.autoCorrect("\\"+latexCmd));var cmd=LatexCmds[latexCmd];return cmd?(cmd=cmd(latexCmd),replacedFragment&&cmd.replaces(replacedFragment),this.insertNew(cmd)):((cmd=TextBlock()).replaces(latexCmd),cmd.firstChild.focus=function(){return delete this.focus,this},this.insertNew(cmd).insertAfter(cmd),replacedFragment&&replacedFragment.remove()),this},_.unwrapGramp=function(){var gramp=this.parent.parent,greatgramp=gramp.parent,next=gramp.next,prev=gramp.prev;if(gramp.disown().eachChild(function(uncle){uncle.isEmpty()||(uncle.children().adopt(greatgramp,prev,next).each(function(cousin){cousin.jQ.insertBefore(gramp.jQ.first())}),prev=uncle.lastChild)}),!this.next)if(this.prev)this.next=this.prev.next;else for(;!this.next;){if(this.parent=this.parent.next,!this.parent){this.next=gramp.next,this.parent=greatgramp;break}this.next=this.parent.firstChild}this.next?this.insertBefore(this.next):this.appendTo(greatgramp),gramp.jQ.remove(),gramp.prev&&gramp.prev.respace(),gramp.next&&gramp.next.respace()},_.backspace=function(){if(clearUpDownCache(this),this.show(),this.deleteSelection());else if(this.prev)if(this.prev.isEmpty()){if("\\le "===this.prev.ctrlSeq)ins=LatexCmds["<"]("<");else if("\\ge "===this.prev.ctrlSeq)var ins=LatexCmds[">"](">");this.prev=this.prev.remove().prev,ins&&this.insertNew(ins)}else{if(this.prev instanceof Bracket)return this.appendTo(this.prev.firstChild).deleteForward();this.selectLeft()}else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();if(this.next instanceof Bracket)return this.prependTo(this.next.firstChild).backspace();this.unwrapGramp()}else this.root.triggerSpecialEvent("backspacePressed");return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this},_.deleteForward=function(){if(clearUpDownCache(this),this.show(),this.deleteSelection());else if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}else this.root.triggerSpecialEvent("delPressed");return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this},_.selectFrom=function(anticursor){var oneA=this,otherA=anticursor;loopThroughAncestors:do{for(var oneI=this;oneI!==oneA.parent.parent;oneI=oneI.parent.parent)if(oneI.parent===otherA.parent){left=oneI,right=otherA;break loopThroughAncestors}for(var otherI=anticursor;otherI!==otherA.parent.parent;otherI=otherI.parent.parent)if(oneA.parent===otherI.parent){left=oneA,right=otherI;break loopThroughAncestors}oneA.parent.parent&&(oneA=oneA.parent.parent),otherA.parent.parent&&(otherA=otherA.parent.parent)}while(oneA.parent.parent||otherA.parent.parent||oneA.parent===otherA.parent);pray("cursor and anticursor are in the same tree",oneA.parent.parent||otherA.parent.parent||oneA.parent===otherA.parent);var left,right,leftRight;if(left.next!==right){for(var next=left;next;next=next.next)if(next===right.prev){leftRight=!0;break}leftRight||(leftRight=right,right=left,left=leftRight)}this.hide().selection=Selection(left.prev.next||left.parent.firstChild,right.next.prev||right.parent.lastChild),this.insertAfter(right.next.prev||right.parent.lastChild),this.root.selectionChanged()},_.selectLeft=function(){if(clearUpDownCache(this),this.selection)if(this.selection.first===this.next)this.prev?this.hopLeft().selection.extendLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp();else{if(this.hopLeft(),this.selection.first===this.selection.last)return void this.clearSelection().show();this.selection.retractLeft()}else{if(this.prev)this.hopLeft();else{if(this.parent===this.root)return;this.insertBefore(this.parent.parent)}this.hide().selection=Selection(this.next)}this.root.selectionChanged()},_.selectRight=function(){if(clearUpDownCache(this),this.selection)if(this.selection.last===this.prev)this.next?this.hopRight().selection.extendRight():this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp();else{if(this.hopRight(),this.selection.first===this.selection.last)return void this.clearSelection().show();this.selection.retractRight()}else{if(this.next)this.hopRight();else{if(this.parent===this.root)return;this.insertAfter(this.parent.parent)}this.hide().selection=Selection(this.prev)}this.root.selectionChanged()},_.prepareMove=function(){return clearUpDownCache(this),this.show().clearSelection()},_.prepareEdit=function(){return clearUpDownCache(this),this.show().deleteSelection()},_.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},_.deleteSelection=function(){return!!this.selection&&(this.prev=this.selection.first.prev,this.next=this.selection.last.next,this.selection.remove(),this.root.selectionChanged(),delete this.selection)}}),Selection=P(MathFragment,function(_,_super){_.init=function(){var frag=this;_super.init.apply(frag,arguments),frag.jQwrap(frag.jQ)},_.jQwrap=function(children){this.jQ=children.wrapAll('<span class="mq-selection"></span>').parent()},_.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),_super.adopt.apply(this,arguments)},_.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},_.levelUp=function(){var seln=this,gramp=seln.first=seln.last=seln.last.parent.parent;return seln.clear().jQwrap(gramp.jQ),seln},_.extendLeft=function(){this.first=this.first.prev,this.first.jQ.prependTo(this.jQ)},_.extendRight=function(){this.last=this.last.next,this.last.jQ.appendTo(this.jQ)},_.retractRight=function(){this.first.jQ.insertBefore(this.jQ),this.first=this.first.next},_.retractLeft=function(){this.last.jQ.insertAfter(this.jQ),this.last=this.last.prev}});$.fn.mathquill=function(cmd,latex){switch(cmd){case"focus":case"blur":return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId];block&&block.textarea&&block.textarea.children().trigger(cmd)});case"onKey":case"onText":return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId],cursor=block&&block.cursor;cursor&&(cursor.parent.bubble(cmd,latex,{preventDefault:noop}),block.blurred&&cursor.hide().parent.blur())});case"redraw":return this.each(function(){var blockId=$(this).attr(mqBlockId),rootBlock=blockId&&MathElement[blockId];rootBlock&&function postOrderRedraw(el){el.eachChild(postOrderRedraw),el.redraw&&el.redraw()}(rootBlock)});case"revert":return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId];block&&block.revert&&block.revert()});case"sliderLatex":return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId];block&&((cursor=block&&block.cursor)&&cursor.clearSelection(),block.renderSliderLatex(latex),block.triggerSpecialEvent("render"))});case"latex":return arguments.length>1?this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId];block&&((cursor=block&&block.cursor)&&cursor.clearSelection(),block.renderLatex(latex),block.triggerSpecialEvent("render"))}):(block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId])&&block.latex();case"mqLatex":return(block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId])&&block.mqLatex();case"text":return(block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId])&&block.text();case"html":return this.children(".mathquill-root-block").html().replace(/ ?mq-hasCursor|mq-hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId],cursor=block&&block.cursor;cursor&&(cursor.writeLatex(latex),block.blurred&&cursor.hide().parent.blur())});case"cmd":if(arguments.length>1)var overrideRestrictForCh=arguments[2]||!1;return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId],cursor=block&&block.cursor;if(cursor){if(/^\\[a-z]+$/i.test(latex)){var selection=cursor.selection;selection&&(cursor.prev=selection.first.prev,cursor.next=selection.last.next,delete cursor.selection),cursor.insertCmd(latex.slice(1),selection)}else cursor.insertCh(latex,overrideRestrictForCh);block.blurred&&cursor.hide().parent.blur()}});case"restrictContentKeys":block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId];(cursor=block&&block.cursor)&&void 0===cursor.restrictContentKeys&&(cursor.restrictContentKeys=latex);break;case"mathOperatorOverride":block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId];(cursor=block&&block.cursor)&&void 0===cursor.overridenOperators&&(cursor.overridenOperators={},latex&&latex.length>0&&$(latex).each(function(index,element){var operators=element.split("|");(operators.length=2)&&(cursor.overridenOperators[operators[0]]=operators[1])}));break;case"touchtap":var touchstartTarget=arguments[1],x=arguments[2],y=arguments[3];return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId],cursor=block&&block.cursor;if(cursor&&touchstartTarget!==cursor.handle[0]){var wasBlurred=block.blurred;block.textarea.children().focus(),cursor.seek(elAtPt(x,y,block),x,y,cachedClientRectFnForNewCache(),!0),wasBlurred||cursor.showHandle()}});case"ignoreNextMousedown":var time=arguments[1];return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId];block&&(block.ignoreMousedownTimeout=setTimeout(function(){block.ignoreMousedownTimeout=undefined},time))});case"moveStart":(block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId])&&block.cursor&&block.cursor.prependTo(block);break;case"moveEnd":(block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId])&&block.cursor&&block.cursor.appendTo(block);break;case"isAtStart":block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId];if(cursor=block&&block.cursor)return cursor.parent===cursor.root&&!cursor.prev;break;case"isAtEnd":var block=(blockId=$(this).attr(mqBlockId))&&MathElement[blockId];if(cursor=block&&block.cursor)return cursor.parent===cursor.root&&!cursor.next;break;case"selection":var blockId=$(this).attr(mqBlockId),cursor=(block=blockId&&MathElement[blockId])&&block.cursor;if(!cursor)return;return cursor.selection?"$"+cursor.selection.latex()+"$":"";case"clearSelection":return this.each(function(){var blockId=$(this).attr(mqBlockId),block=blockId&&MathElement[blockId],cursor=block&&block.cursor;cursor&&(cursor.clearSelection(),block.blurred&&cursor.hide().parent.blur())});default:var textbox="textbox"===cmd,editable=textbox||"editable"===cmd,RootBlock=textbox?RootTextBlock:RootMathBlock;return this.each(function(){var container=$(this),root=RootBlock();createRoot(container,root,textbox);var cursor=root.cursor,textarea=setupTextarea(editable,container,root,cursor);root.textarea;root.editable=editable,mouseEvents(container),setupTouchHandle(0,root,cursor),editable&&(rootCSSClasses(container,textbox),focusBlurEvents(root,cursor,textarea),desmosCustomEvents(container,root,cursor))})}}}();var mathcolor="",mathfontfamily="",showasciiformulaonhover=!0,isIE=null==document.createElementNS;null==document.getElementById&&alert("This webpage requires a recent browser such as\nMozilla/Netscape 7+ or Internet Explorer 6+MathPlayer");var AMpreviousSymbol,AMcurrentSymbol,CONST=0,UNARY=1,BINARY=2,INFIX=3,LEFTBRACKET=4,RIGHTBRACKET=5,SPACE=6,UNDEROVER=7,DEFINITION=8,TEXT=9,BIG=10,LONG=11,STRETCHY=12,MATRIX=13,AMsymbols=[{input:"\\alpha",tag:"mi",output:"",ttype:CONST},{input:"\\beta",tag:"mi",output:"",ttype:CONST},{input:"\\gamma",tag:"mi",output:"",ttype:CONST},{input:"\\delta",tag:"mi",output:"",ttype:CONST},{input:"\\epsilon",tag:"mi",output:"",ttype:CONST},{input:"\\varepsilon",tag:"mi",output:"",ttype:CONST},{input:"\\zeta",tag:"mi",output:"",ttype:CONST},{input:"\\eta",tag:"mi",output:"",ttype:CONST},{input:"\\theta",tag:"mi",output:"",ttype:CONST},{input:"\\vartheta",tag:"mi",output:"",ttype:CONST},{input:"\\iota",tag:"mi",output:"",ttype:CONST},{input:"\\kappa",tag:"mi",output:"",ttype:CONST},{input:"\\lambda",tag:"mi",output:"",ttype:CONST},{input:"\\mu",tag:"mi",output:"",ttype:CONST},{input:"\\nu",tag:"mi",output:"",ttype:CONST},{input:"\\xi",tag:"mi",output:"",ttype:CONST},{input:"\\pi",tag:"mi",output:"",ttype:CONST},{input:"\\varpi",tag:"mi",output:"",ttype:CONST},{input:"\\rho",tag:"mi",output:"",ttype:CONST},{input:"\\varrho",tag:"mi",output:"",ttype:CONST},{input:"\\varsigma",tag:"mi",output:"",ttype:CONST},{input:"\\sigma",tag:"mi",output:"",ttype:CONST},{input:"\\tau",tag:"mi",output:"",ttype:CONST},{input:"\\upsilon",tag:"mi",output:"",ttype:CONST},{input:"\\phi",tag:"mi",output:"",ttype:CONST},{input:"\\varphi",tag:"mi",output:"",ttype:CONST},{input:"\\chi",tag:"mi",output:"",ttype:CONST},{input:"\\psi",tag:"mi",output:"",ttype:CONST},{input:"\\omega",tag:"mi",output:"",ttype:CONST},{input:"\\Gamma",tag:"mo",output:"",ttype:CONST},{input:"\\Delta",tag:"mo",output:"",ttype:CONST},{input:"\\Theta",tag:"mo",output:"",ttype:CONST},{input:"\\Lambda",tag:"mo",output:"",ttype:CONST},{input:"\\Xi",tag:"mo",output:"",ttype:CONST},{input:"\\Pi",tag:"mo",output:"",ttype:CONST},{input:"\\Sigma",tag:"mo",output:"",ttype:CONST},{input:"\\Upsilon",tag:"mo",output:"",ttype:CONST},{input:"\\Phi",tag:"mo",output:"",ttype:CONST},{input:"\\Psi",tag:"mo",output:"",ttype:CONST},{input:"\\Omega",tag:"mo",output:"",ttype:CONST},{input:"\\frac12",tag:"mo",output:"",ttype:CONST},{input:"\\frac14",tag:"mo",output:"",ttype:CONST},{input:"\\frac34",tag:"mo",output:"",ttype:CONST},{input:"\\frac13",tag:"mo",output:"",ttype:CONST},{input:"\\frac23",tag:"mo",output:"",ttype:CONST},{input:"\\frac15",tag:"mo",output:"",ttype:CONST},{input:"\\frac25",tag:"mo",output:"",ttype:CONST},{input:"\\frac35",tag:"mo",output:"",ttype:CONST},{input:"\\frac45",tag:"mo",output:"",ttype:CONST},{input:"\\frac16",tag:"mo",output:"",ttype:CONST},{input:"\\frac56",tag:"mo",output:"",ttype:CONST},{input:"\\frac18",tag:"mo",output:"",ttype:CONST},{input:"\\frac38",tag:"mo",output:"",ttype:CONST},{input:"\\frac58",tag:"mo",output:"",ttype:CONST},{input:"\\frac78",tag:"mo",output:"",ttype:CONST},{input:"\\pm",tag:"mo",output:"",ttype:CONST},{input:"\\mp",tag:"mo",output:"",ttype:CONST},{input:"\\triangleleft",tag:"mo",output:"",ttype:CONST},{input:"\\triangleright",tag:"mo",output:"",ttype:CONST},{input:"\\cdot",tag:"mo",output:"",ttype:CONST},{input:"\\star",tag:"mo",output:"",ttype:CONST},{input:"\\ast",tag:"mo",output:"*",ttype:CONST},{input:"\\times",tag:"mo",output:"",ttype:CONST},{input:"\\div",tag:"mo",output:"",ttype:CONST},{input:"\\circ",tag:"mo",output:"",ttype:CONST},{input:"\\bullet",tag:"mo",output:"",ttype:CONST},{input:"\\oplus",tag:"mo",output:"",ttype:CONST},{input:"\\ominus",tag:"mo",output:"",ttype:CONST},{input:"\\otimes",tag:"mo",output:"",ttype:CONST},{input:"\\bigcirc",tag:"mo",output:"",ttype:CONST},{input:"\\oslash",tag:"mo",output:"",ttype:CONST},{input:"\\odot",tag:"mo",output:"",ttype:CONST},{input:"\\land",tag:"mo",output:"",ttype:CONST},{input:"\\wedge",tag:"mo",output:"",ttype:CONST},{input:"\\lor",tag:"mo",output:"",ttype:CONST},{input:"\\vee",tag:"mo",output:"",ttype:CONST},{input:"\\cap",tag:"mo",output:"",ttype:CONST},{input:"\\cup",tag:"mo",output:"",ttype:CONST},{input:"\\sqcap",tag:"mo",output:"",ttype:CONST},{input:"\\sqcup",tag:"mo",output:"",ttype:CONST},{input:"\\uplus",tag:"mo",output:"",ttype:CONST},{input:"\\amalg",tag:"mo",output:"",ttype:CONST},{input:"\\bigtriangleup",tag:"mo",output:"",ttype:CONST},{input:"\\bigtriangledown",tag:"mo",output:"",ttype:CONST},{input:"\\dag",tag:"mo",output:"",ttype:CONST},{input:"\\dagger",tag:"mo",output:"",ttype:CONST},{input:"\\ddag",tag:"mo",output:"",ttype:CONST},{input:"\\ddagger",tag:"mo",output:"",ttype:CONST},{input:"\\lhd",tag:"mo",output:"",ttype:CONST},{input:"\\rhd",tag:"mo",output:"",ttype:CONST},{input:"\\unlhd",tag:"mo",output:"",ttype:CONST},{input:"\\unrhd",tag:"mo",output:"",ttype:CONST},{input:"\\sum",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\prod",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigcap",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigcup",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigwedge",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigvee",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigsqcap",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigsqcup",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\coprod",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigoplus",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigotimes",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\bigodot",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\biguplus",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\int",tag:"mo",output:"",ttype:UNDEROVER},{input:"\\oint",tag:"mo",output:"",ttype:CONST},{input:":=",tag:"mo",output:":=",ttype:CONST},{input:"\\lt",tag:"mo",output:"<",ttype:CONST},{input:"\\gt",tag:"mo",output:">",ttype:CONST},{input:"\\ne",tag:"mo",output:"",ttype:CONST},{input:"\\neq",tag:"mo",output:"",ttype:CONST},{input:"\\le",tag:"mo",output:"",ttype:CONST},{input:"\\leq",tag:"mo",output:"",ttype:CONST},{input:"\\leqslant",tag:"mo",output:"",ttype:CONST},{input:"\\ge",tag:"mo",output:"",ttype:CONST},{input:"\\geq",tag:"mo",output:"",ttype:CONST},{input:"\\geqslant",tag:"mo",output:"",ttype:CONST},{input:"\\equiv",tag:"mo",output:"",ttype:CONST},{input:"\\ll",tag:"mo",output:"",ttype:CONST},{input:"\\gg",tag:"mo",output:"",ttype:CONST},{input:"\\doteq",tag:"mo",output:"",ttype:CONST},{input:"\\prec",tag:"mo",output:"",ttype:CONST},{input:"\\succ",tag:"mo",output:"",ttype:CONST},{input:"\\preceq",tag:"mo",output:"",ttype:CONST},{input:"\\succeq",tag:"mo",output:"",ttype:CONST},{input:"\\subset",tag:"mo",output:"",ttype:CONST},{input:"\\supset",tag:"mo",output:"",ttype:CONST},{input:"\\subseteq",tag:"mo",output:"",ttype:CONST},{input:"\\supseteq",tag:"mo",output:"",ttype:CONST},{input:"\\sqsubset",tag:"mo",output:"",ttype:CONST},{input:"\\sqsupset",tag:"mo",output:"",ttype:CONST},{input:"\\sqsubseteq",tag:"mo",output:"",ttype:CONST},{input:"\\sqsupseteq",tag:"mo",output:"",ttype:CONST},{input:"\\sim",tag:"mo",output:"",ttype:CONST},{input:"\\simeq",tag:"mo",output:"",ttype:CONST},{input:"\\approx",tag:"mo",output:"",ttype:CONST},{input:"\\cong",tag:"mo",output:"",ttype:CONST},{input:"\\Join",tag:"mo",output:"",ttype:CONST},{input:"\\bowtie",tag:"mo",output:"",ttype:CONST},{input:"\\in",tag:"mo",output:"",ttype:CONST},{input:"\\ni",tag:"mo",output:"",ttype:CONST},{input:"\\owns",tag:"mo",output:"",ttype:CONST},{input:"\\propto",tag:"mo",output:"",ttype:CONST},{input:"\\vdash",tag:"mo",output:"",ttype:CONST},{input:"\\dashv",tag:"mo",output:"",ttype:CONST},{input:"\\models",tag:"mo",output:"",ttype:CONST},{input:"\\perp",tag:"mo",output:"",ttype:CONST},{input:"\\smile",tag:"mo",output:"",ttype:CONST},{input:"\\frown",tag:"mo",output:"",ttype:CONST},{input:"\\asymp",tag:"mo",output:"",ttype:CONST},{input:"\\notin",tag:"mo",output:"",ttype:CONST},{input:"\\begin{eqnarray}",output:"X",ttype:MATRIX,invisible:!0},{input:"\\begin{array}",output:"X",ttype:MATRIX,invisible:!0},{input:"\\\\",output:"}&{",ttype:DEFINITION},{input:"\\end{eqnarray}",output:"}}",ttype:DEFINITION},{input:"\\end{array}",output:"}}",ttype:DEFINITION},{input:"\\big",tag:"mo",output:"X",atval:"1.2",ieval:"2.2",ttype:BIG},{input:"\\Big",tag:"mo",output:"X",atval:"1.6",ieval:"2.6",ttype:BIG},{input:"\\bigg",tag:"mo",output:"X",atval:"2.2",ieval:"3.2",ttype:BIG},{input:"\\Bigg",tag:"mo",output:"X",atval:"2.9",ieval:"3.9",ttype:BIG},{input:"\\left",tag:"mo",output:"X",ttype:LEFTBRACKET},{input:"\\right",tag:"mo",output:"X",ttype:RIGHTBRACKET},{input:"{",output:"{",ttype:LEFTBRACKET,invisible:!0},{input:"}",output:"}",ttype:RIGHTBRACKET,invisible:!0},{input:"(",tag:"mo",output:"(",atval:"1",ttype:STRETCHY},{input:"[",tag:"mo",output:"[",atval:"1",ttype:STRETCHY},{input:"\\lbrack",tag:"mo",output:"[",atval:"1",ttype:STRETCHY},{input:"\\{",tag:"mo",output:"{",atval:"1",ttype:STRETCHY},{input:"\\lbrace",tag:"mo",output:"{",atval:"1",ttype:STRETCHY},{input:"\\langle",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\lfloor",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\lceil",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:")",tag:"mo",output:")",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"]",tag:"mo",output:"]",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rbrack",tag:"mo",output:"]",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\}",tag:"mo",output:"}",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rbrace",tag:"mo",output:"}",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rangle",tag:"mo",output:"",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rfloor",tag:"mo",output:"",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rceil",tag:"mo",output:"",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"|",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\|",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\vert",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\Vert",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\mid",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\parallel",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"/",tag:"mo",output:"/",atval:"1.01",ttype:STRETCHY},{input:"\\backslash",tag:"mo",output:"",atval:"1",ttype:STRETCHY},{input:"\\setminus",tag:"mo",output:"\\",ttype:CONST},{input:"\\!",tag:"mspace",atname:"width",atval:"-0.167em",ttype:SPACE},{input:"\\,",tag:"mspace",atname:"width",atval:"0.167em",ttype:SPACE},{input:"\\>",tag:"mspace",atname:"width",atval:"0.222em",ttype:SPACE},{input:"\\:",tag:"mspace",atname:"width",atval:"0.222em",ttype:SPACE},{input:"\\;",tag:"mspace",atname:"width",atval:"0.278em",ttype:SPACE},{input:"~",tag:"mspace",atname:"width",atval:"0.333em",ttype:SPACE},{input:"\\quad",tag:"mspace",atname:"width",atval:"1em",ttype:SPACE},{input:"\\qquad",tag:"mspace",atname:"width",atval:"2em",ttype:SPACE},{input:"\\prime",tag:"mo",output:"",ttype:CONST},{input:"'",tag:"mo",output:"",ttype:CONST},{input:"''",tag:"mo",output:"",ttype:CONST},{input:"'''",tag:"mo",output:"",ttype:CONST},{input:"''''",tag:"mo",output:"",ttype:CONST},{input:"\\ldots",tag:"mo",output:"",ttype:CONST},{input:"\\cdots",tag:"mo",output:"",ttype:CONST},{input:"\\vdots",tag:"mo",output:"",ttype:CONST},{input:"\\ddots",tag:"mo",output:"",ttype:CONST},{input:"\\forall",tag:"mo",output:"",ttype:CONST},{input:"\\exists",tag:"mo",output:"",ttype:CONST},{input:"\\Re",tag:"mo",output:"",ttype:CONST},{input:"\\Im",tag:"mo",output:"",ttype:CONST},{input:"\\aleph",tag:"mo",output:"",ttype:CONST},{input:"\\hbar",tag:"mo",output:"",ttype:CONST},{input:"\\ell",tag:"mo",output:"",ttype:CONST},{input:"\\wp",tag:"mo",output:"",ttype:CONST},{input:"\\emptyset",tag:"mo",output:"",ttype:CONST},{input:"\\infty",tag:"mo",output:"",ttype:CONST},{input:"\\surd",tag:"mo",output:"\\sqrt{}",ttype:DEFINITION},{input:"\\partial",tag:"mo",output:"",ttype:CONST},{input:"\\nabla",tag:"mo",output:"",ttype:CONST},{input:"\\triangle",tag:"mo",output:"",ttype:CONST},{input:"\\therefore",tag:"mo",output:"",ttype:CONST},{input:"\\angle",tag:"mo",output:"",ttype:CONST},{input:"\\diamond",tag:"mo",output:"",ttype:CONST},{input:"\\Diamond",tag:"mo",output:"",ttype:CONST},{input:"\\neg",tag:"mo",output:"",ttype:CONST},{input:"\\lnot",tag:"mo",output:"",ttype:CONST},{input:"\\bot",tag:"mo",output:"",ttype:CONST},{input:"\\top",tag:"mo",output:"",ttype:CONST},{input:"\\square",tag:"mo",output:"",ttype:CONST},{input:"\\Box",tag:"mo",output:"",ttype:CONST},{input:"\\wr",tag:"mo",output:"",ttype:CONST},{input:"\\arccos",tag:"mi",output:"arccos",ttype:UNARY,func:!0},{input:"\\arcsin",tag:"mi",output:"arcsin",ttype:UNARY,func:!0},{input:"\\arctan",tag:"mi",output:"arctan",ttype:UNARY,func:!0},{input:"\\arg",tag:"mi",output:"arg",ttype:UNARY,func:!0},{input:"\\cos",tag:"mi",output:"cos",ttype:UNARY,func:!0},{input:"\\cosh",tag:"mi",output:"cosh",ttype:UNARY,func:!0},{input:"\\cot",tag:"mi",output:"cot",ttype:UNARY,func:!0},{input:"\\coth",tag:"mi",output:"coth",ttype:UNARY,func:!0},{input:"\\csc",tag:"mi",output:"csc",ttype:UNARY,func:!0},{input:"\\deg",tag:"mi",output:"deg",ttype:UNARY,func:!0},{input:"\\det",tag:"mi",output:"det",ttype:UNARY,func:!0},{input:"\\dim",tag:"mi",output:"dim",ttype:UNARY,func:!0},{input:"\\exp",tag:"mi",output:"exp",ttype:UNARY,func:!0},{input:"\\gcd",tag:"mi",output:"gcd",ttype:UNARY,func:!0},{input:"\\hom",tag:"mi",output:"hom",ttype:UNARY,func:!0},{input:"\\inf",tag:"mo",output:"inf",ttype:UNDEROVER},{input:"\\ker",tag:"mi",output:"ker",ttype:UNARY,func:!0},{input:"\\lg",tag:"mi",output:"lg",ttype:UNARY,func:!0},{input:"\\lim",tag:"mo",output:"lim",ttype:UNDEROVER},{input:"\\liminf",tag:"mo",output:"liminf",ttype:UNDEROVER},{input:"\\limsup",tag:"mo",output:"limsup",ttype:UNDEROVER},{input:"\\ln",tag:"mi",output:"ln",ttype:UNARY,func:!0},{input:"\\log",tag:"mi",output:"log",ttype:UNARY,func:!0},{input:"\\max",tag:"mo",output:"max",ttype:UNDEROVER},{input:"\\min",tag:"mo",output:"min",ttype:UNDEROVER},{input:"\\Pr",tag:"mi",output:"Pr",ttype:UNARY,func:!0},{input:"\\sec",tag:"mi",output:"sec",ttype:UNARY,func:!0},{input:"\\sin",tag:"mi",output:"sin",ttype:UNARY,func:!0},{input:"\\sinh",tag:"mi",output:"sinh",ttype:UNARY,func:!0},{input:"\\sup",tag:"mo",output:"sup",ttype:UNDEROVER},{input:"\\tan",tag:"mi",output:"tan",ttype:UNARY,func:!0},{input:"\\tanh",tag:"mi",output:"tanh",ttype:UNARY,func:!0},{input:"\\gets",tag:"mo",output:"",ttype:CONST},{input:"\\leftarrow",tag:"mo",output:"",ttype:CONST},{input:"\\to",tag:"mo",output:"",ttype:CONST},{input:"\\rightarrow",tag:"mo",output:"",ttype:CONST},{input:"\\leftrightarrow",tag:"mo",output:"",ttype:CONST},{input:"\\uparrow",tag:"mo",output:"",ttype:CONST},{input:"\\downarrow",tag:"mo",output:"",ttype:CONST},{input:"\\updownarrow",tag:"mo",output:"",ttype:CONST},{input:"\\Leftarrow",tag:"mo",output:"",ttype:CONST},{input:"\\Rightarrow",tag:"mo",output:"",ttype:CONST},{input:"\\Leftrightarrow",tag:"mo",output:"",ttype:CONST},{input:"\\iff",tag:"mo",output:"~\\Longleftrightarrow~",ttype:DEFINITION},{input:"\\Uparrow",tag:"mo",output:"",ttype:CONST},{input:"\\Downarrow",tag:"mo",output:"",ttype:CONST},{input:"\\Updownarrow",tag:"mo",output:"",ttype:CONST},{input:"\\mapsto",tag:"mo",output:"",ttype:CONST},{input:"\\longleftarrow",tag:"mo",output:"",ttype:LONG},{input:"\\longrightarrow",tag:"mo",output:"",ttype:LONG},{input:"\\longleftrightarrow",tag:"mo",output:"",ttype:LONG},{input:"\\Longleftarrow",tag:"mo",output:"",ttype:LONG},{input:"\\Longrightarrow",tag:"mo",output:"",ttype:LONG},{input:"\\Longleftrightarrow",tag:"mo",output:"",ttype:LONG},{input:"\\longmapsto",tag:"mo",output:"",ttype:CONST},{input:"\\sqrt",tag:"msqrt",output:"sqrt",ttype:UNARY},{input:"\\root",tag:"mroot",output:"root",ttype:BINARY},{input:"\\frac",tag:"mfrac",output:"/",ttype:BINARY},{input:"\\stackrel",tag:"mover",output:"stackrel",ttype:BINARY},{input:"_",tag:"msub",output:"_",ttype:INFIX},{input:"^",tag:"msup",output:"^",ttype:INFIX},{input:"\\mathrm",tag:"mtext",output:"text",ttype:TEXT},{input:"\\mbox",tag:"mtext",output:"mbox",ttype:TEXT},{input:"\\atop",tag:"mfrac",output:"",ttype:INFIX},{input:"\\choose",tag:"mfrac",output:"",ttype:INFIX},{input:"\\acute",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\grave",tag:"mover",output:"`",ttype:UNARY,acc:!0},{input:"\\breve",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\check",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\dot",tag:"mover",output:".",ttype:UNARY,acc:!0},{input:"\\ddot",tag:"mover",output:"..",ttype:UNARY,acc:!0},{input:"\\mathring",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\vec",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\overrightarrow",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\overleftarrow",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\hat",tag:"mover",output:"^",ttype:UNARY,acc:!0},{input:"\\widehat",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\tilde",tag:"mover",output:"~",ttype:UNARY,acc:!0},{input:"\\widetilde",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\bar",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\overbrace",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\overline",tag:"mover",output:"",ttype:UNARY,acc:!0},{input:"\\underbrace",tag:"munder",output:"",ttype:UNARY,acc:!0},{input:"\\underline",tag:"munder",output:"",ttype:UNARY,acc:!0},{input:"\\displaystyle",tag:"mstyle",atname:"displaystyle",atval:"true",ttype:UNARY},{input:"\\textstyle",tag:"mstyle",atname:"displaystyle",atval:"false",ttype:UNARY},{input:"\\scriptstyle",tag:"mstyle",atname:"scriptlevel",atval:"1",ttype:UNARY},{input:"\\scriptscriptstyle",tag:"mstyle",atname:"scriptlevel",atval:"2",ttype:UNARY},{input:"\\textrm",tag:"mstyle",output:"\\mathrm",ttype:DEFINITION},{input:"\\mathbf",tag:"mstyle",atname:"mathvariant",atval:"bold",ttype:UNARY},{input:"\\textbf",tag:"mstyle",atname:"mathvariant",atval:"bold",ttype:UNARY},{input:"\\mathit",tag:"mstyle",atname:"mathvariant",atval:"italic",ttype:UNARY},{input:"\\textit",tag:"mstyle",atname:"mathvariant",atval:"italic",ttype:UNARY},{input:"\\mathtt",tag:"mstyle",atname:"mathvariant",atval:"monospace",ttype:UNARY},{input:"\\texttt",tag:"mstyle",atname:"mathvariant",atval:"monospace",ttype:UNARY},{input:"\\mathsf",tag:"mstyle",atname:"mathvariant",atval:"sans-serif",ttype:UNARY},{input:"\\mathbb",tag:"mstyle",atname:"mathvariant",atval:"double-struck",ttype:UNARY,codes:[61324,61325,8450,61326,61327,61328,61329,8461,61330,61331,61332,61333,61334,8469,61335,8473,8474,8477,61336,61337,61338,61339,61340,61341,61342,8484]},{input:"\\mathcal",tag:"mstyle",atname:"mathvariant",atval:"script",ttype:UNARY,codes:[61237,8492,61238,61239,8496,8497,61240,8459,8464,61241,61242,8466,8499,61243,61244,61245,61246,8475,61247,61248,61249,61250,61251,61252,61253,61254]},{input:"\\mathfrak",tag:"mstyle",atname:"mathvariant",atval:"fraktur",ttype:UNARY,codes:[61277,61278,8493,61279,61280,61281,61282,8460,8465,61283,61284,61285,61286,61287,61288,61289,61290,8476,61291,61292,61293,61294,61295,61296,61297,8488]}],AMnames=[],AMmathml="http://www.w3.org/1998/Math/MathML",xsltMathml='<?xml version=\'1.0\' encoding="UTF-8"?>\r\n<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"\r\n\t\txmlns:m="http://www.w3.org/1998/Math/MathML"\r\n                version=\'1.0\'>\r\n                \r\n<xsl:output method="text" indent="no" encoding="UTF-8"/>\r\n\r\n\x3c!-- ====================================================================== --\x3e\r\n\x3c!-- $id: mmltex.xsl, 2002/22/11 Exp $\r\n     This file is part of the XSLT MathML Library distribution.\r\n     See ./README or http://www.raleigh.ru/MathML/mmltex for\r\n     copyright and other information                                        --\x3e\r\n\x3c!-- ====================================================================== --\x3e\r\n\r\n\x3c!--xsl:include href="tokens.xsl"/--\x3e\r\n\r\n<xsl:template match="m:mi|m:mn|m:mo|m:mtext|m:ms">\r\n\t<xsl:call-template name="CommonTokenAtr"/>\r\n</xsl:template>\r\n\r\n<xsl:template name="mi">\r\n  <xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template name="mn">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template name="mo">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template name="mtext">\r\n\t<xsl:variable name="content">\r\n\t\t<xsl:call-template name="replaceMtextEntities">\r\n\t\t\t<xsl:with-param name="content" select="."/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t<xsl:text>\\text{</xsl:text>\r\n\t<xsl:value-of select="$content"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mspace">\r\n</xsl:template>\r\n\r\n<xsl:template name="ms">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@lquote"><xsl:value-of select="@lquote"/></xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>"</xsl:text></xsl:otherwise>\r\n\t</xsl:choose><xsl:apply-templates/><xsl:choose>\r\n\t\t<xsl:when test="@rquote"><xsl:value-of select="@rquote"/></xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>"</xsl:text></xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name="CommonTokenAtr">\r\n\t<xsl:if test="@mathbackground">\r\n\t\t<xsl:text>\\colorbox[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name="color">\r\n\t\t\t<xsl:with-param name="color" select="@mathbackground"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{$</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@color or @mathcolor"> \x3c!-- Note: @color is deprecated in MathML 2.0 --\x3e\r\n\t\t<xsl:text>\\textcolor[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name="color">\r\n\t\t\t<xsl:with-param name="color" select="@color|@mathcolor"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@mathvariant">\r\n\t\t<xsl:choose>\r\n\t\t\t<xsl:when test="@mathvariant=\'normal\'">\r\n\t\t\t\t<xsl:text>\\mathrm{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'bold\'">\r\n\t\t\t\t<xsl:text>\\mathbf{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'italic\'">\r\n\t\t\t\t<xsl:text>\\mathit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'bold-italic\'">\t\x3c!-- Required definition --\x3e\r\n\t\t\t\t<xsl:text>\\mathbit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'double-struck\'">\t\x3c!-- Required amsfonts --\x3e\r\n\t\t\t\t<xsl:text>\\mathbb{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'bold-fraktur\'">\t\x3c!-- Error --\x3e\r\n\t\t\t\t<xsl:text>{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'script\'">\r\n\t\t\t\t<xsl:text>\\mathcal{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'bold-script\'">\t\x3c!-- Error --\x3e\r\n\t\t\t\t<xsl:text>\\mathsc{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'fraktur\'">\t\x3c!-- Required amsfonts --\x3e\r\n\t\t\t\t<xsl:text>\\mathfrak{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'sans-serif\'">\r\n\t\t\t\t<xsl:text>\\mathsf{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'bold-sans-serif\'"> \x3c!-- Required definition --\x3e\r\n\t\t\t\t<xsl:text>\\mathbsf{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'sans-serif-italic\'"> \x3c!-- Required definition --\x3e\r\n\t\t\t\t<xsl:text>\\mathsfit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'sans-serif-bold-italic\'">\t\x3c!-- Error --\x3e\r\n\t\t\t\t<xsl:text>\\mathbsfit{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:when test="@mathvariant=\'monospace\'">\r\n\t\t\t\t<xsl:text>\\mathtt{</xsl:text>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:otherwise>\r\n\t\t\t\t<xsl:text>{</xsl:text>\r\n\t\t\t</xsl:otherwise>\r\n\t\t</xsl:choose>\r\n\t</xsl:if>\r\n\t<xsl:call-template name="selectTemplate"/>\r\n\t<xsl:if test="@mathvariant">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@color or @mathcolor">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@mathbackground">\r\n\t\t<xsl:text>$}</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template name="selectTemplate">\r\n\x3c!--\t<xsl:variable name="name" select="local-name()"/>\r\n\t<xsl:call-template name="{$name}"/>--\x3e\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="local-name(.)=\'mi\'">\r\n\t\t\t<xsl:call-template name="mi"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="local-name(.)=\'mn\'">\r\n\t\t\t<xsl:call-template name="mn"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="local-name(.)=\'mo\'">\r\n\t\t\t<xsl:call-template name="mo"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="local-name(.)=\'mtext\'">\r\n\t\t\t<xsl:call-template name="mtext"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="local-name(.)=\'ms\'">\r\n\t\t\t<xsl:call-template name="ms"/>\r\n\t\t</xsl:when>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name="color">\r\n\x3c!-- NB: Variables colora and valueColor{n} only for Sablotron --\x3e\r\n\t<xsl:param name="color"/>\r\n\t<xsl:variable name="colora" select="translate($color,\'ABCDEFGHIJKLMNOPQRSTUVWXYZ\',\'abcdefghijklmnopqrstuvwxyz\')"/>\r\n\t<xsl:choose>\r\n\t<xsl:when test="starts-with($colora,\'#\') and string-length($colora)=4">\r\n\t\t<xsl:variable name="valueColor">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,2,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select="$valueColor div 15"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name="valueColor1">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,3,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select="$valueColor1 div 15"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name="valueColor2">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,4,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select="$valueColor2 div 15"/>\r\n\t</xsl:when>\r\n\t<xsl:when test="starts-with($colora,\'#\') and string-length($colora)=7">\r\n\t\t<xsl:variable name="valueColor1">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,2,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:variable name="valueColor2">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,3,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select="($valueColor1*16 + $valueColor2) div 255"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name="valueColor1a">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,4,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:variable name="valueColor2a">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,5,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select="($valueColor1a*16 + $valueColor2a) div 255"/><xsl:text>,</xsl:text>\r\n\t\t<xsl:variable name="valueColor1b">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,6,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:variable name="valueColor2b">\r\n\t\t\t<xsl:call-template name="Hex2Decimal">\r\n\t\t\t\t<xsl:with-param name="arg" select="substring($colora,7,1)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:variable>\r\n\t\t<xsl:value-of select="($valueColor1b*16 + $valueColor2b) div 255"/>\r\n\t</xsl:when>\r\n\x3c!-- ======================= if color specifed as an html-color-name ========================================== --\x3e\r\n\t<xsl:when test="$colora=\'aqua\'"><xsl:text>0,1,1</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'black\'"><xsl:text>0,0,0</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'blue\'"><xsl:text>0,0,1</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'fuchsia\'"><xsl:text>1,0,1</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'gray\'"><xsl:text>.5,.5,.5</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'green\'"><xsl:text>0,.5,0</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'lime\'"><xsl:text>0,1,0</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'maroon\'"><xsl:text>.5,0,0</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'navy\'"><xsl:text>0,0,.5</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'olive\'"><xsl:text>.5,.5,0</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'purple\'"><xsl:text>.5,0,.5</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'red\'"><xsl:text>1,0,0</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'silver\'"><xsl:text>.75,.75,.75</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'teal\'"><xsl:text>0,.5,.5</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'white\'"><xsl:text>1,1,1</xsl:text></xsl:when>\r\n\t<xsl:when test="$colora=\'yellow\'"><xsl:text>1,1,0</xsl:text></xsl:when>\r\n\t<xsl:otherwise>\r\n\t\t<xsl:message>Exception at color template</xsl:message>\r\n\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name="Hex2Decimal">\r\n\t<xsl:param name="arg"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="$arg=\'f\'">\r\n\t\t\t<xsl:value-of select="15"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$arg=\'e\'">\r\n\t\t\t<xsl:value-of select="14"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$arg=\'d\'">\r\n\t\t\t<xsl:value-of select="13"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$arg=\'c\'">\r\n\t\t\t<xsl:value-of select="12"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$arg=\'b\'">\r\n\t\t\t<xsl:value-of select="11"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$arg=\'a\'">\r\n\t\t\t<xsl:value-of select="10"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="translate($arg, \'0123456789\', \'9999999999\')=\'9\'"> \x3c!-- if $arg is number --\x3e\r\n\t\t\t<xsl:value-of select="$arg"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:message>Exception at Hex2Decimal template</xsl:message>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:*/text()">\r\n\t<xsl:call-template name="replaceEntities">\r\n\t\t<xsl:with-param name="content" select="normalize-space()"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\x3c!--xsl:include href="glayout.xsl"/--\x3e\r\n<xsl:template match="m:mfrac">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@bevelled=\'true\'">\r\n\x3c!--\t\t\t<xsl:text>\\raisebox{1ex}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}\\!\\left/ \\!\\raisebox{-1ex}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t\t<xsl:text>}\\right.</xsl:text>--\x3e\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="@linethickness">\r\n\t\t\t<xsl:text>\\genfrac{}{}{</xsl:text>\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test="number(@linethickness)">\r\n\t\t\t\t\t<xsl:value-of select="@linethickness div 10"/>\r\n\t\t\t\t\t<xsl:text>ex</xsl:text>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:when test="@linethickness=\'thin\'">\r\n\t\t\t\t\t<xsl:text>.05ex</xsl:text>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:when test="@linethickness=\'medium\'"/>\r\n\t\t\t\t<xsl:when test="@linethickness=\'thick\'">\r\n\t\t\t\t\t<xsl:text>.2ex</xsl:text>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:otherwise>\r\n\t\t\t\t\t<xsl:value-of select="@linethickness"/>\r\n\t\t\t\t</xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t\t<xsl:text>}{}{</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\frac{</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:if test="@numalign=\'right\'">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates select="./*[1]"/>\r\n\t<xsl:if test="@numalign=\'left\'">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>}{</xsl:text>\t\r\n\t<xsl:if test="@denomalign=\'right\'">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t<xsl:if test="@denomalign=\'left\'">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mroot">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="count(./*)=2">\r\n\t\t\t<xsl:text>\\sqrt[</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t\t<xsl:text>]{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\x3c!-- number of argumnets is not 2 - code 25 --\x3e\r\n\t\t\t<xsl:message>exception 25:</xsl:message>\r\n\t\t\t<xsl:text>\\text{exception 25:}</xsl:text> \r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:msqrt">\r\n\t<xsl:text>\\sqrt{</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mfenced">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@open">\r\n\t\t\t<xsl:if test="translate(@open,\'{}[]()|\',\'{{{{{{{\')=\'{\'">\r\n\t\t\t\t<xsl:text>\\left</xsl:text>\r\n\t\t\t</xsl:if>\r\n\t\t\t<xsl:if test="@open=\'{\' or @open=\'}\'">\r\n\t\t\t\t<xsl:text>\\</xsl:text>\r\n\t\t\t</xsl:if>\r\n\t\t\t<xsl:value-of select="@open"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\left(</xsl:text></xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="count(./*)>1">\r\n\t\t\t<xsl:variable name="symbol">\r\n\t\t\t\t<xsl:choose>\r\n\t\t\t\t\t<xsl:when test="@separators">\r\n\t\t\t\t\t\t<xsl:call-template name="startspace">\r\n\t\t\t\t\t\t\t<xsl:with-param name="symbol" select="@separators"/>\r\n\t\t\t\t\t\t</xsl:call-template>\r\n\t\t\t\t\t</xsl:when>\r\n\t\t\t\t\t<xsl:otherwise>,</xsl:otherwise>\r\n\t\t\t\t</xsl:choose>\r\n\t\t\t</xsl:variable>\r\n\t\t\t<xsl:for-each select="./*">\r\n\t\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t\t<xsl:if test="not(position()=last())">\r\n\t\t\t\t\t<xsl:choose>\r\n\t\t\t\t\t\t<xsl:when test="position()>string-length($symbol)">\r\n\t\t\t\t\t\t\t<xsl:value-of select="substring($symbol,string-length($symbol))"/>\r\n\t\t\t\t\t\t</xsl:when>\r\n\t\t\t\t\t\t<xsl:otherwise>\r\n\t\t\t\t\t\t\t<xsl:value-of select="substring($symbol,position(),1)"/>\r\n\t\t\t\t\t\t</xsl:otherwise>\r\n\t\t\t\t\t</xsl:choose>\r\n\t\t\t\t</xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@close">\r\n\t\t\t<xsl:if test="translate(@open,\'{}[]()|\',\'{{{{{{{\')=\'{\'">\r\n\t\t\t\t<xsl:text>\\right</xsl:text>\r\n\t\t\t</xsl:if>\r\n\t\t\t<xsl:if test="@open=\'{\' or @open=\'}\'">\r\n\t\t\t\t<xsl:text>\\</xsl:text>\r\n\t\t\t</xsl:if>\t\t\r\n\t\t\t<xsl:value-of select="@close"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\right)</xsl:text></xsl:otherwise>\r\n\t</xsl:choose>\t\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mphantom">\r\n\t<xsl:text>\\phantom{</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:menclose">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@notation = \'actuarial\'">\r\n\t\t\t<xsl:text>\\overline{</xsl:text>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t\t<xsl:text>\\hspace{.2em}|}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="@notation = \'radical\'">\r\n\t\t\t<xsl:text>\\sqrt{</xsl:text>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\overline{)</xsl:text>\r\n\t\t\t<xsl:apply-templates/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mrow">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mstyle">\r\n\t<xsl:if test="@background">\r\n\t\t<xsl:text>\\colorbox[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name="color">\r\n\t\t\t<xsl:with-param name="color" select="@background"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{$</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@color">\r\n\t\t<xsl:text>\\textcolor[rgb]{</xsl:text>\r\n\t\t<xsl:call-template name="color">\r\n\t\t\t<xsl:with-param name="color" select="@color"/>\r\n\t\t</xsl:call-template>\r\n\t\t<xsl:text>}{</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test="@color">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@background">\r\n\t\t<xsl:text>$}</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\x3c!--\r\n\r\n<xsl:template match="m:mstyle">\r\n\t<xsl:if test="@displaystyle=\'true\'">\r\n\t\t<xsl:text>{\\displaystyle</xsl:text>\r\n\t</xsl:if>\t\t\t\r\n\t<xsl:if test="@scriptlevel=2">\r\n\t\t<xsl:text>{\\scriptscriptstyle</xsl:text>\t\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test="@scriptlevel=2">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="@displaystyle=\'true\'">\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n--\x3e\r\n\r\n<xsl:template match="m:merror">\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\x3c!--xsl:include href="scripts.xsl"/--\x3e\r\n<xsl:template match="m:munderover">\r\n\t<xsl:variable name="base">\r\n\t\t<xsl:call-template name="startspace">\r\n\t\t\t<xsl:with-param name="symbol" select="./*[1]"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t<xsl:variable name="under">\r\n\t\t<xsl:call-template name="startspace">\r\n\t\t\t<xsl:with-param name="symbol" select="./*[2]"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t<xsl:variable name="over">\r\n\t\t<xsl:call-template name="startspace">\r\n\t\t\t<xsl:with-param name="symbol" select="./*[3]"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:variable>\r\n\t\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="$over=\'&#x000AF;\'">\t\x3c!-- OverBar - over bar --\x3e\r\n\t\t\t<xsl:text>\\overline{</xsl:text>\r\n\t\t\t<xsl:call-template name="munder">\r\n\t\t\t\t<xsl:with-param name="base" select="$base"/>\r\n\t\t\t\t<xsl:with-param name="under" select="$under"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$over=\'&#x0FE37;\'">\t\x3c!-- OverBrace - over brace --\x3e\r\n\t\t\t<xsl:text>\\overbrace{</xsl:text>\r\n\t\t\t<xsl:call-template name="munder">\r\n\t\t\t\t<xsl:with-param name="base" select="$base"/>\r\n\t\t\t\t<xsl:with-param name="under" select="$under"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$under=\'&#x00332;\'">\t\x3c!-- UnderBar - combining low line --\x3e\r\n\t\t\t<xsl:text>\\underline{</xsl:text>\r\n\t\t\t<xsl:call-template name="mover">\r\n\t\t\t\t<xsl:with-param name="base" select="$base"/>\r\n\t\t\t\t<xsl:with-param name="over" select="$over"/>\r\n\t\t\t\t<xsl:with-param name="pos_over" select="3"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$under=\'&#x0FE38;\'">\t\x3c!-- UnderBrace - under brace --\x3e\r\n\t\t\t<xsl:text>\\underbrace{</xsl:text>\r\n\t\t\t<xsl:call-template name="mover">\r\n\t\t\t\t<xsl:with-param name="base" select="$base"/>\r\n\t\t\t\t<xsl:with-param name="over" select="$over"/>\r\n\t\t\t\t<xsl:with-param name="pos_over" select="3"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="translate($base,\'&#x0220F;&#x02210;&#x022c2;&#x022c3;&#x02294;&#x0222B;\',\r\n\t\t\t\t\t\t\'&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;\')=\'&#x02211;\'">\r\n\x3c!-- if $base is operator, such as\r\n\t\t\t&#x02211;\t/sum L: summation operator\r\n\t\t\t&#x0220F;\t/prod L: product operator\r\n\t\t\t&#x02210;\t/coprod L: coproduct operator\r\n\t\t\t&#x022c2;\t/bigcap\r\n\t\t\t&#x022c3;\t/bigcup\r\n\t\t\t&#x02294;\t/bigsqcup\r\n--\x3e\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>_{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t\t<xsl:text>}^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[3]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\underset{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t\t<xsl:text>}{\\overset{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[3]"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}}</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mover">\r\n\t<xsl:call-template name="mover">\r\n\t\t<xsl:with-param name="base">\r\n\t\t\t<xsl:call-template name="startspace">\r\n\t\t\t\t<xsl:with-param name="symbol" select="./*[1]"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t\t<xsl:with-param name="over">\r\n\t\t\t<xsl:call-template name="startspace">\r\n\t\t\t\t<xsl:with-param name="symbol" select="./*[2]"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:munder">\r\n\t<xsl:call-template name="munder">\r\n\t\t<xsl:with-param name="base">\r\n\t\t\t<xsl:call-template name="startspace">\r\n\t\t\t\t<xsl:with-param name="symbol" select="./*[1]"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t\t<xsl:with-param name="under">\r\n\t\t\t<xsl:call-template name="startspace">\r\n\t\t\t\t<xsl:with-param name="symbol" select="./*[2]"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<xsl:template name="mover">\r\n\t<xsl:param name="base"/>\r\n\t<xsl:param name="over"/>\r\n\t<xsl:param name="pos_over" select="2"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="$over=\'&#x000AF;\'">\t\x3c!-- OverBar - over bar --\x3e\r\n\t\t\t<xsl:text>\\overline{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$over=\'&#x0FE37;\'">\t\x3c!-- OverBrace - over brace --\x3e\r\n\t\t\t<xsl:text>\\overbrace{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="translate($base,\'&#x0220F;&#x02210;&#x022c2;&#x022c3;&#x02294;\',\r\n\t\t\t\t\t\t\'&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;\')=\'&#x02211;\'">\r\n\x3c!-- if $base is operator, such as\r\n\t\t\t&#x02211;\t/sum L: summation operator\r\n\t\t\t&#x0220F;\t/prod L: product operator\r\n\t\t\t&#x02210;\t/coprod L: coproduct operator\r\n\t\t\t&#x022c2;\t/bigcap\r\n\t\t\t&#x022c3;\t/bigcup\r\n\t\t\t&#x02294;\t/bigsqcup\r\n--\x3e\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[$pos_over]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\stackrel{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[$pos_over]"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t\t\x3c!--\r\n\t\t\t<xsl:text>\\overset{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[$pos_over]"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>--\x3e\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name="munder">\r\n\t<xsl:param name="base"/>\r\n\t<xsl:param name="under"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="$under=\'&#x00332;\'">\t\x3c!-- UnderBar - combining low line --\x3e\r\n\t\t\t<xsl:text>\\underline{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="$under=\'&#x0FE38;\'">\t\x3c!-- UnderBrace - under brace --\x3e\r\n\t\t\t<xsl:text>\\underbrace{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="translate($base,\'&#x0220F;&#x02210;&#x022c2;&#x022c3;&#x02294;\',\r\n\t\t\t\t\t\t\'&#x02211;&#x02211;&#x02211;&#x02211;&#x02211;\')=\'&#x02211;\'">\r\n\x3c!-- if $base is operator, such as\r\n\t\t\t&#x02211;\t/sum L: summation operator\r\n\t\t\t&#x0220F;\t/prod L: product operator\r\n\t\t\t&#x02210;\t/coprod L: coproduct operator\r\n\t\t\t&#x022c2;\t/bigcap\r\n\t\t\t&#x022c3;\t/bigcup\r\n\t\t\t&#x02294;\t/bigsqcup\r\n--\x3e\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>_{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>\\underset{</xsl:text>\t\t\x3c!-- Required AmsMath package --\x3e\r\n\t\t\t<xsl:apply-templates select="./*[2]"/>\r\n\t\t\t<xsl:text>}{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:msubsup">\r\n\t<xsl:text>{</xsl:text>\t\r\n\t<xsl:apply-templates select="./*[1]"/>\r\n\t<xsl:text>}_{</xsl:text>\r\n\t<xsl:apply-templates select="./*[2]"/>\r\n\t<xsl:text>}^{</xsl:text>\t\r\n\t<xsl:apply-templates select="./*[3]"/>\r\n\t<xsl:text>}</xsl:text>\t\r\n</xsl:template>\r\n\r\n<xsl:template match="m:msup">\r\n\t<xsl:text>{</xsl:text>\t\r\n\t<xsl:apply-templates select="./*[1]"/>\r\n\t<xsl:text>}^{</xsl:text>\t\r\n\t<xsl:apply-templates select="./*[2]"/>\r\n\t<xsl:text>}</xsl:text>\t\r\n</xsl:template>\r\n\r\n<xsl:template match="m:msub">\r\n\t<xsl:text>{</xsl:text>\t\r\n\t<xsl:apply-templates select="./*[1]"/>\r\n\t<xsl:text>}_{</xsl:text>\t\r\n\t<xsl:apply-templates select="./*[2]"/>\r\n\t<xsl:text>}</xsl:text>\t\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mmultiscripts" mode="mprescripts">\r\n\t<xsl:for-each select="m:mprescripts/following-sibling::*">\r\n\t\t<xsl:if test="position() mod 2 and local-name(.)!=\'none\'">\r\n\t\t\t<xsl:text>{}_{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t\t<xsl:if test="not(position() mod 2) and local-name(.)!=\'none\'">\r\n\t\t\t<xsl:text>{}^{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:apply-templates select="./*[1]"/>\r\n\t<xsl:for-each select="m:mprescripts/preceding-sibling::*[position()!=last()]">\r\n\t\t<xsl:if test="position()>2 and local-name(.)!=\'none\'">\r\n\t\t\t<xsl:text>{}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t\t<xsl:if test="position() mod 2 and local-name(.)!=\'none\'">\r\n\t\t\t<xsl:text>_{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t\t<xsl:if test="not(position() mod 2) and local-name(.)!=\'none\'">\r\n\t\t\t<xsl:text>^{</xsl:text>\t\r\n\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mmultiscripts">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="m:mprescripts">\r\n\t\t\t<xsl:apply-templates select="." mode="mprescripts"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:apply-templates select="./*[1]"/>\r\n\t\t\t<xsl:for-each select="*[position()>1]">\r\n\t\t\t\t<xsl:if test="position()>2 and local-name(.)!=\'none\'">\r\n\t\t\t\t\t<xsl:text>{}</xsl:text>\t\r\n\t\t\t\t</xsl:if>\r\n\t\t\t\t<xsl:if test="position() mod 2 and local-name(.)!=\'none\'">\r\n\t\t\t\t\t<xsl:text>_{</xsl:text>\t\r\n\t\t\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t\t\t</xsl:if>\r\n\t\t\t\t<xsl:if test="not(position() mod 2) and local-name(.)!=\'none\'">\r\n\t\t\t\t\t<xsl:text>^{</xsl:text>\t\r\n\t\t\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t\t\t<xsl:text>}</xsl:text>\t\r\n\t\t\t\t</xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\x3c!--xsl:include href="tables.xsl"/--\x3e\r\n<xsl:template match="m:mtd[@columnspan]">\r\n\t<xsl:text>\\multicolumn{</xsl:text>\r\n\t<xsl:value-of select="@columnspan"/>\r\n\t<xsl:text>}{c}{</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:if test="count(following-sibling::*)>0">\r\n\t\t<xsl:text>&amp; </xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n\r\n<xsl:template match="m:mtd">\r\n\t<xsl:if test="@columnalign=\'right\' or @columnalign=\'center\'">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test="@columnalign=\'left\' or @columnalign=\'center\'">\r\n\t\t<xsl:text>\\hfill </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="count(following-sibling::*)>0">\r\n\x3c!--    this test valid for Sablotron, another form - test="not(position()=last())".\r\n\tAlso for m:mtd[@columnspan] and m:mtr  --\x3e\r\n\t\t<xsl:text>&amp; </xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mtr">\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test="count(following-sibling::*)>0">\r\n\t\t<xsl:text>\\\\ </xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:mtable">\r\n\t<xsl:text>\\begin{array}{</xsl:text>\r\n\t<xsl:if test="@frame=\'solid\'">\r\n\t\t<xsl:text>|</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:variable name="numbercols" select="count(./m:mtr[1]/m:mtd[not(@columnspan)])+sum(./m:mtr[1]/m:mtd/@columnspan)"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@columnalign">\r\n\t\t\t<xsl:variable name="colalign">\r\n\t\t\t\t<xsl:call-template name="colalign">\r\n\t\t\t\t\t<xsl:with-param name="colalign" select="@columnalign"/>\r\n\t\t\t\t</xsl:call-template>\r\n\t\t\t</xsl:variable>\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test="string-length($colalign) > $numbercols">\r\n\t\t\t\t\t<xsl:value-of select="substring($colalign,1,$numbercols)"/>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:when test="string-length($colalign) &lt; $numbercols">\r\n\t\t\t\t\t<xsl:value-of select="$colalign"/>\r\n\t\t\t\t\t<xsl:call-template name="generate-string">\r\n\t\t\t\t\t\t<xsl:with-param name="text" select="substring($colalign,string-length($colalign))"/>\r\n\t\t\t\t\t\t<xsl:with-param name="count" select="$numbercols - string-length($colalign)"/>\r\n\t\t\t\t\t</xsl:call-template>\r\n\t\t\t\t</xsl:when>\r\n\t\t\t\t<xsl:otherwise>\r\n\t\t\t\t\t<xsl:value-of select="$colalign"/>\r\n\t\t\t\t</xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:call-template name="generate-string">\r\n\t\t\t\t<xsl:with-param name="text" select="\'c\'"/>\r\n\t\t\t\t<xsl:with-param name="count" select="$numbercols"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:if test="@frame=\'solid\'">\r\n\t\t<xsl:text>|</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:if test="@frame=\'solid\'">\r\n\t\t<xsl:text>\\hline </xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test="@frame=\'solid\'">\r\n\t\t<xsl:text>\\\\ \\hline</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>\\end{array}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template name="colalign">\r\n\t<xsl:param name="colalign"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="contains($colalign,\' \')">\r\n\t\t\t<xsl:value-of select="substring($colalign,1,1)"/>\r\n\t\t\t<xsl:call-template name="colalign">\r\n\t\t\t\t<xsl:with-param name="colalign" select="substring-after($colalign,\' \')"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:value-of select="substring($colalign,1,1)"/>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template name="generate-string">\r\n\x3c!-- template from XSLT Standard Library v1.1 --\x3e\r\n    <xsl:param name="text"/>\r\n    <xsl:param name="count"/>\r\n\r\n    <xsl:choose>\r\n      <xsl:when test="string-length($text) = 0 or $count &lt;= 0"/>\r\n\r\n      <xsl:otherwise>\r\n\t<xsl:value-of select="$text"/>\r\n\t<xsl:call-template name="generate-string">\r\n\t  <xsl:with-param name="text" select="$text"/>\r\n\t  <xsl:with-param name="count" select="$count - 1"/>\r\n\t</xsl:call-template>\r\n      </xsl:otherwise>\r\n    </xsl:choose>\r\n</xsl:template>\r\n\x3c!--xsl:include href="entities.xsl"/--\x3e\r\n\r\n<xsl:template name="replaceEntities">\r\n\t<xsl:param name="content"/>\r\n\t<xsl:if test="string-length($content)>0">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="$content =\'sin\' or $content =\'cos\' or $content=\'tan\' or $content =\'sec\' or $content =\'csc\' or $content =\'cot\' or $content =\'sinh\' or $content =\'cosh\' or $content =\'tanh\' or $content =\'coth\' or $content =\'arcsin\' or $content =\'arccos\' or $content =\'arctan\' or $content =\'ln\'"><xsl:text>\\</xsl:text><xsl:value-of select="$content" /></xsl:when><xsl:when test="starts-with($content,\'&#x0025B;\')"><xsl:value-of select="\'\\varepsilon \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0025B;\')"/></xsl:call-template></xsl:when>\t\x3c!--/varepsilon --\x3e\r\n\r\n\x3c!-- ====================================================================== --\x3e\r\n\x3c!-- \tUnicode 3.2\r\n\tGreek\r\n\tRange: 0370-03FF\r\n\thttp://www.unicode.org/charts/PDF/U0370.pdf\t                    --\x3e\r\n\x3c!-- ====================================================================== --\x3e\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x00393;\')"><xsl:value-of select="\'\\Gamma \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x00393;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Gamma capital Gamma, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x00394;\')"><xsl:value-of select="\'\\Delta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x00394;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Delta capital Delta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x00398;\')"><xsl:value-of select="\'\\Theta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x00398;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Theta capital Theta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0039B;\')"><xsl:value-of select="\'\\Lambda \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0039B;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Lambda capital Lambda, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0039E;\')"><xsl:value-of select="\'\\Xi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0039E;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Xi capital Xi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003A0;\')"><xsl:value-of select="\'\\Pi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003A0;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Pi capital Pi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003A3;\')"><xsl:value-of select="\'\\Sigma \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003A3;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Sigma capital Sigma, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003A6;\')"><xsl:value-of select="\'\\Phi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003A6;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Phi capital Phi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003A8;\')"><xsl:value-of select="\'\\Psi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003A8;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Psi capital Psi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003A9;\')"><xsl:value-of select="\'\\Omega \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003A9;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Omega capital Omega, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B1;\')"><xsl:value-of select="\'\\alpha \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B1;\')"/></xsl:call-template></xsl:when>\t\x3c!--/alpha small alpha, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B2;\')"><xsl:value-of select="\'\\beta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B2;\')"/></xsl:call-template></xsl:when>\t\x3c!--/beta small beta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B3;\')"><xsl:value-of select="\'\\gamma \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B3;\')"/></xsl:call-template></xsl:when>\t\x3c!--/gamma small gamma, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B4;\')"><xsl:value-of select="\'\\delta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B4;\')"/></xsl:call-template></xsl:when>\t\x3c!--/delta small delta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B5;\')"><xsl:value-of select="\'\\epsilon \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B5;\')"/></xsl:call-template></xsl:when>\t\x3c!--/straightepsilon, small epsilon, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B6;\')"><xsl:value-of select="\'\\zeta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B6;\')"/></xsl:call-template></xsl:when>\t\x3c!--/zeta small zeta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B7;\')"><xsl:value-of select="\'\\eta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B7;\')"/></xsl:call-template></xsl:when>\t\x3c!--/eta small eta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B8;\')"><xsl:value-of select="\'\\theta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B8;\')"/></xsl:call-template></xsl:when>\t\x3c!--/theta straight theta, small theta, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003B9;\')"><xsl:value-of select="\'\\iota \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003B9;\')"/></xsl:call-template></xsl:when>\t\x3c!--/iota small iota, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003BA;\')"><xsl:value-of select="\'\\kappa \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003BA;\')"/></xsl:call-template></xsl:when>\t\x3c!--/kappa small kappa, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003BB;\')"><xsl:value-of select="\'\\lambda \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003BB;\')"/></xsl:call-template></xsl:when>\t\x3c!--/lambda small lambda, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003BC;\')"><xsl:value-of select="\'\\mu \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003BC;\')"/></xsl:call-template></xsl:when>\t\x3c!--/mu small mu, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003BD;\')"><xsl:value-of select="\'\\nu \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003BD;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nu small nu, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003BE;\')"><xsl:value-of select="\'\\xi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003BE;\')"/></xsl:call-template></xsl:when>\t\x3c!--/xi small xi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C0;\')"><xsl:value-of select="\'\\pi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C0;\')"/></xsl:call-template></xsl:when>\t\x3c!--/pi small pi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C1;\')"><xsl:value-of select="\'\\rho \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C1;\')"/></xsl:call-template></xsl:when>\t\x3c!--/rho small rho, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C2;\')"><xsl:value-of select="\'\\varsigma \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C2;\')"/></xsl:call-template></xsl:when>\t\x3c!--/varsigma --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C3;\')"><xsl:value-of select="\'\\sigma \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C3;\')"/></xsl:call-template></xsl:when>\t\x3c!--/sigma small sigma, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C4;\')"><xsl:value-of select="\'\\tau \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C4;\')"/></xsl:call-template></xsl:when>\t\x3c!--/tau small tau, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C5;\')"><xsl:value-of select="\'\\upsilon \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C5;\')"/></xsl:call-template></xsl:when>\t\x3c!--/upsilon small upsilon, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C6;\')"><xsl:value-of select="\'\\phi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C6;\')"/></xsl:call-template></xsl:when>\t\x3c!--/straightphi - small phi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C7;\')"><xsl:value-of select="\'\\chi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C7;\')"/></xsl:call-template></xsl:when>\t\x3c!--/chi small chi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C8;\')"><xsl:value-of select="\'\\psi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C8;\')"/></xsl:call-template></xsl:when>\t\x3c!--/psi small psi, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003C9;\')"><xsl:value-of select="\'\\omega \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003C9;\')"/></xsl:call-template></xsl:when>\t\x3c!--/omega small omega, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003D1;\')"><xsl:value-of select="\'\\vartheta \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003D1;\')"/></xsl:call-template></xsl:when>\t\x3c!--/vartheta - curly or open theta --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003D2;\')"><xsl:value-of select="\'\\Upsilon \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003D2;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Upsilon capital Upsilon, Greek --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003D5;\')"><xsl:value-of select="\'\\varphi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003D5;\')"/></xsl:call-template></xsl:when>\t\x3c!--/varphi - curly or open phi --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003D6;\')"><xsl:value-of select="\'\\varpi \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003D6;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/varpi --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003F0;\')"><xsl:value-of select="\'\\varkappa \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003F0;\')"/></xsl:call-template></xsl:when>\t\x3c!--/varkappa --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x003F1;\')"><xsl:value-of select="\'\\varrho \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x003F1;\')"/></xsl:call-template></xsl:when>\t\x3c!--/varrho --\x3e\r\n\t\t\r\n\x3c!-- ====================================================================== --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0200B;\')"><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0200B;\')"/></xsl:call-template></xsl:when>\t\t\t\t\t\t\x3c!--short form of  &InvisibleComma; --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02026;\')"><xsl:value-of select="\'\\dots \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02026;\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test="starts-with($content,\'&#x02032;\')"><xsl:value-of select="\'\\prime \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02032;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/prime prime or minute --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02061;\')"><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02061;\')"/></xsl:call-template></xsl:when>\t\t\t\t\t\t\x3c!-- ApplyFunction --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02062;\')"><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02062;\')"/></xsl:call-template></xsl:when>\t\t\t\t\t\t\x3c!-- InvisibleTimes --\x3e\r\n\x3c!-- ====================================================================== --\x3e\r\n\x3c!-- \tUnicode 3.2\r\n\tLetterlike Symbols\r\n\tRange: 2100-214F\r\n\thttp://www.unicode.org/charts/PDF/U2100.pdf\t                    --\x3e\r\n\x3c!-- ====================================================================== --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0210F;&#x0FE00;\')"><xsl:value-of select="\'\\hbar \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0210F;&#x0FE00;\')"/></xsl:call-template></xsl:when>\t\x3c!--/hbar - Planck\'s over 2pi --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0210F;\')"><xsl:value-of select="\'\\hslash \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0210F;\')"/></xsl:call-template></xsl:when>\t\x3c!--/hslash - variant Planck\'s over 2pi --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02111;\')"><xsl:value-of select="\'\\Im \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02111;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/Im - imaginary   --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02113;\')"><xsl:value-of select="\'\\ell \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02113;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ell - cursive small l --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02118;\')"><xsl:value-of select="\'\\wp \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02118;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/wp - Weierstrass p --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0211C;\')"><xsl:value-of select="\'\\Re \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0211C;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/Re - real --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02127;\')"><xsl:value-of select="\'\\mho \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02127;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/mho - conductance --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02135;\')"><xsl:value-of select="\'\\aleph \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02135;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/aleph aleph, Hebrew --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02136;\')"><xsl:value-of select="\'\\beth \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02136;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/beth - beth, Hebrew --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02137;\')"><xsl:value-of select="\'\\gimel \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02137;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/gimel - gimel, Hebrew --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02138;\')"><xsl:value-of select="\'\\daleth \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02138;\')"/></xsl:call-template></xsl:when>\t\x3c!--/daleth - daleth, Hebrew --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02145;\')"><xsl:value-of select="\'D\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02145;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--D for use in differentials, e.g., within integrals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02146;\')"><xsl:value-of select="\'d\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02146;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--d for use in differentials, e.g., within integrals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02147;\')"><xsl:value-of select="\'e\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02147;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--e use for the exponential base of the natural logarithms --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02148;\')"><xsl:value-of select="\'i\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02148;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--i for use as a square root of -1 --\x3e\r\n\r\n\x3c!-- ====================================================================== --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02192;\')"><xsl:value-of select="\'\\to \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02192;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/rightarrow /to A: =rightward arrow --\x3e\r\n\t\t\r\n\x3c!-- ====================================================================== --\x3e\r\n\x3c!-- \tUnicode 3.2\r\n\tMathematical Operators\r\n\tRange: 2200-22FF\r\n\thttp://www.unicode.org/charts/PDF/U2200.pdf                         --\x3e\r\n\x3c!-- ====================================================================== --\x3e\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x02200;\')"><xsl:value-of select="\'\\forall \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02200;\')"/></xsl:call-template></xsl:when>\t\x3c!--/forall for all --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02201;\')"><xsl:value-of select="\'\\complement \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02201;\')"/></xsl:call-template></xsl:when>\t\x3c!--/complement - complement sign --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02202;\')"><xsl:value-of select="\'\\partial \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02202;\')"/></xsl:call-template></xsl:when>\t\x3c!--/partial partial differential --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02203;\')"><xsl:value-of select="\'\\exists \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02203;\')"/></xsl:call-template></xsl:when>\t\x3c!--/exists at least one exists --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02204;\')"><xsl:value-of select="\'\\nexists \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02204;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nexists - negated exists --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02205;&#x0FE00;\')"><xsl:value-of select="\'\\emptyset \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02205;&#x0FE00;\')"/></xsl:call-template></xsl:when>\t\x3c!--/emptyset - zero, slash --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02205;\')"><xsl:value-of select="\'\\varnothing \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02205;\')"/></xsl:call-template></xsl:when>\t\x3c!--/varnothing - circle, slash --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02206;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02206;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02207;\')"><xsl:value-of select="\'\\nabla \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02207;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nabla del, Hamilton operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02208;\')"><xsl:value-of select="\'\\in \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02208;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/in R: set membership  --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02209;\')"><xsl:value-of select="\'\\notin \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02209;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/notin N: negated set membership --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0220B;\')"><xsl:value-of select="\'\\ni \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0220B;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ni /owns R: contains --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0220C;\')"><xsl:value-of select="\'\\not\\ni \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0220C;\')"/></xsl:call-template></xsl:when>\t\x3c!--negated contains --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0220F;\')"><xsl:value-of select="\'\\prod \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0220F;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/prod L: product operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02210;\')"><xsl:value-of select="\'\\coprod \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02210;\')"/></xsl:call-template></xsl:when>\t\x3c!--/coprod L: coproduct operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02211;\')"><xsl:value-of select="\'\\sum \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02211;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/sum L: summation operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02212;\')"><xsl:value-of select="\'-\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02212;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--B: minus sign --\x3e\t\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x02213;\')"><xsl:value-of select="\'\\mp \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02213;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/mp B: minus-or-plus sign --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02214;\')"><xsl:value-of select="\'\\dotplus \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02214;\')"/></xsl:call-template></xsl:when>\t\x3c!--/dotplus B: plus sign, dot above --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02215;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02215;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02216;\')"><xsl:value-of select="\'\\setminus \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02216;\')"/></xsl:call-template></xsl:when>\t\x3c!--/setminus B: reverse solidus --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02217;\')"><xsl:value-of select="\'\\ast \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02217;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--low asterisk --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02218;\')"><xsl:value-of select="\'\\circ \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02218;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/circ B: composite function (small circle) --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02219;\')"><xsl:value-of select="\'\\bullet \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02219;\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test="starts-with($content,\'&#x0221A;\')"><xsl:value-of select="\'\\surd \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0221A;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/surd radical --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0221D;\')"><xsl:value-of select="\'\\propto \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0221D;\')"/></xsl:call-template></xsl:when>\t\x3c!--/propto R: is proportional to --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0221E;\')"><xsl:value-of select="\'\\infty \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0221E;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/infty infinity --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0221F;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0221F;\')"/></xsl:call-template></xsl:when>\t\tright (90 degree) angle --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02220;\')"><xsl:value-of select="\'\\angle \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02220;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/angle - angle --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02221;\')"><xsl:value-of select="\'\\measuredangle \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02221;\')"/></xsl:call-template></xsl:when>\t\x3c!--/measuredangle - angle-measured --\x3e\t\x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02222;\')"><xsl:value-of select="\'\\sphericalangle \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02222;\')"/></xsl:call-template></xsl:when>\x3c!--/sphericalangle angle-spherical --\x3e\t\x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02223;\')"><xsl:value-of select="\'\\mid \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02223;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/mid R: --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02224;&#x0FE00;\')"><xsl:value-of select="\'\\nshortmid \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02224;&#x0FE00;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nshortmid --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02224;\')"><xsl:value-of select="\'\\nmid \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02224;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nmid --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02225;\')"><xsl:value-of select="\'\\parallel \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02225;\')"/></xsl:call-template></xsl:when>\t\x3c!--/parallel R: parallel --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02226;&#x0FE00;\')"><xsl:value-of select="\'\\nshortparallel \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02226;&#x0FE00;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nshortparallel N: not short par --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02226;\')"><xsl:value-of select="\'\\nparallel \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02226;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nparallel N: not parallel --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02227;\')"><xsl:value-of select="\'\\wedge \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02227;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/wedge /land B: logical and --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02228;\')"><xsl:value-of select="\'\\vee \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02228;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/vee /lor B: logical or --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02229;\')"><xsl:value-of select="\'\\cap \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02229;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/cap B: intersection --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0222A;\')"><xsl:value-of select="\'\\cup \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0222A;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/cup B: union or logical sum --\x3e\t\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x0222B;\')"><xsl:value-of select="\'\\int \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0222B;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/int L: integral operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0222C;\')"><xsl:value-of select="\'\\iint \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0222C;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--double integral operator --\x3e \x3c!-- Required amsmath --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0222D;\')"><xsl:value-of select="\'\\iiint \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0222D;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/iiint triple integral operator --\x3e\t\x3c!-- Required amsmath --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0222E;\')"><xsl:value-of select="\'\\oint \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0222E;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/oint L: contour integral operator --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0222F;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0222F;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02230;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02230;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02231;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02231;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02232;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02232;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02233;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02233;\')"/></xsl:call-template></xsl:when>--\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02234;\')"><xsl:value-of select="\'\\therefore \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02234;\')"/></xsl:call-template></xsl:when>\t\x3c!--/therefore R: therefore --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02235;\')"><xsl:value-of select="\'\\because \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02235;\')"/></xsl:call-template></xsl:when>\t\x3c!--/because R: because --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x02236;\')"><xsl:value-of select="\':\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02236;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ratio --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x02237;\')"><xsl:value-of select="\'\\colon\\colon \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02237;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Colon, two colons --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x02238;\')"><xsl:value-of select="\'\\dot{-}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02238;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/dotminus B: minus sign, dot above --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02239;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02239;\')"/></xsl:call-template></xsl:when>\t\t--\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0223A;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0223A;\')"/></xsl:call-template></xsl:when>\t\tminus with four dots, geometric properties --\x3e\t\t\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0223B;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0223B;\')"/></xsl:call-template></xsl:when>\t\thomothetic --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0223C;\')"><xsl:value-of select="\'\\sim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0223C;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/sim R: similar --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0223D;\')"><xsl:value-of select="\'\\backsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0223D;\')"/></xsl:call-template></xsl:when>\t\x3c!--/backsim R: reverse similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0223E;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0223E;\')"/></xsl:call-template></xsl:when>\t\tmost positive --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0223F;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0223F;\')"/></xsl:call-template></xsl:when>\t\tac current --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02240;\')"><xsl:value-of select="\'\\wr \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02240;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/wr B: wreath product --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02241;\')"><xsl:value-of select="\'\\nsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02241;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nsim N: not similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02242;\')"><xsl:value-of select="\'\\eqsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02242;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/esim R: equals, similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02243;\')"><xsl:value-of select="\'\\simeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02243;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/simeq R: similar, equals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02244;\')"><xsl:value-of select="\'\\not\\simeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02244;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nsimeq N: not similar, equals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02245;\')"><xsl:value-of select="\'\\cong \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02245;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/cong R: congruent with --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02246;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02246;\')"/></xsl:call-template></xsl:when>\t\tsimilar, not equals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02247;\')"><xsl:value-of select="\'\\ncong \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02247;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ncong N: not congruent with --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02248;\')"><xsl:value-of select="\'\\approx \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02248;\')"/></xsl:call-template></xsl:when>\t\x3c!--/approx R: approximate --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02249;&#x00338;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02249;&#x00338;\')"/></xsl:call-template></xsl:when>\tnot, vert, approximate --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02249;\')"><xsl:value-of select="\'\\not\\approx \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02249;\')"/></xsl:call-template></xsl:when>\t\x3c!--/napprox N: not approximate --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0224A;\')"><xsl:value-of select="\'\\approxeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0224A;\')"/></xsl:call-template></xsl:when>\t\x3c!--/approxeq R: approximate, equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0224B;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0224B;\')"/></xsl:call-template></xsl:when>\t\tapproximately identical to --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0224C;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0224C;\')"/></xsl:call-template></xsl:when>\t\t/backcong R: reverse congruent --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0224D;\')"><xsl:value-of select="\'\\asymp \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0224D;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/asymp R: asymptotically equal to --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0224E;\')"><xsl:value-of select="\'\\Bumpeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0224E;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Bumpeq R: bumpy equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0224F;\')"><xsl:value-of select="\'\\bumpeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0224F;\')"/></xsl:call-template></xsl:when>\t\x3c!--/bumpeq R: bumpy equals, equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02250;\')"><xsl:value-of select="\'\\doteq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02250;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/doteq R: equals, single dot above --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02251;\')"><xsl:value-of select="\'\\doteqdot \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02251;\')"/></xsl:call-template></xsl:when>\t\x3c!--/doteqdot /Doteq R: eq, even dots --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02252;\')"><xsl:value-of select="\'\\fallingdotseq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02252;\')"/></xsl:call-template></xsl:when>\t\x3c!--/fallingdotseq R: eq, falling dots --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02253;\')"><xsl:value-of select="\'\\risingdotseq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02253;\')"/></xsl:call-template></xsl:when>\t\x3c!--/risingdotseq R: eq, rising dots --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02254;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02254;\')"/></xsl:call-template></xsl:when>\t\t/coloneq R: colon, equals --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02255;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02255;\')"/></xsl:call-template></xsl:when>\t\t/eqcolon R: equals, colon --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02256;\')"><xsl:value-of select="\'\\eqcirc \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02256;\')"/></xsl:call-template></xsl:when>\t\x3c!--/eqcirc R: circle on equals sign --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02257;\')"><xsl:value-of select="\'\\circeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02257;\')"/></xsl:call-template></xsl:when>\t\x3c!--/circeq R: circle, equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x02258;\')"><xsl:value-of select="\'\\stackrel{\\frown}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02258;\')"/></xsl:call-template></xsl:when>\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x02259;\')"><xsl:value-of select="\'\\stackrel{\\wedge}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02259;\')"/></xsl:call-template></xsl:when>\t\x3c!--/wedgeq R: corresponds to (wedge, equals) --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x0225A;\')"><xsl:value-of select="\'\\stackrel{\\vee}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0225A;\')"/></xsl:call-template></xsl:when>\t\x3c!--logical or, equals --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x0225B;\')"><xsl:value-of select="\'\\stackrel{\\star}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0225B;\')"/></xsl:call-template></xsl:when>\t\x3c!--equal, asterisk above --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0225C;\')"><xsl:value-of select="\'\\triangleq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0225C;\')"/></xsl:call-template></xsl:when>\t\x3c!--/triangleq R: triangle, equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x0225D;\')"><xsl:value-of select="\'\\stackrel{\\scriptscriptstyle\\mathrm{def}}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0225D;\')"/></xsl:call-template></xsl:when>\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x0225E;\')"><xsl:value-of select="\'\\stackrel{\\scriptscriptstyle\\mathrm{m}}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0225E;\')"/></xsl:call-template></xsl:when>\t\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x0225F;\')"><xsl:value-of select="\'\\stackrel{?}{=}\'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0225F;\')"/></xsl:call-template></xsl:when>\t\x3c!--/questeq R: equal with questionmark --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02260;&#x0FE00;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02260;&#x0FE00;\')"/></xsl:call-template></xsl:when>\tnot equal, dot --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02260;\')"><xsl:value-of select="\'\\ne \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02260;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ne /neq R: not equal --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02261;&#x020E5;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02261;&#x020E5;\')"/></xsl:call-template></xsl:when>\treverse not equivalent --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02261;\')"><xsl:value-of select="\'\\equiv \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02261;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/equiv R: identical with --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02262;\')"><xsl:value-of select="\'\\not\\equiv \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02262;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nequiv N: not identical with --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x02263;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02263;\')"/></xsl:call-template></xsl:when>\t\t--\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02264;\')"><xsl:value-of select="\'\\le \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02264;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/leq /le R: less-than-or-equal --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02265;\')"><xsl:value-of select="\'\\ge \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02265;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/geq /ge R: greater-than-or-equal --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02266;\')"><xsl:value-of select="\'\\leqq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02266;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/leqq R: less, double equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02267;\')"><xsl:value-of select="\'\\geqq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02267;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/geqq R: greater, double equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02268;\')"><xsl:value-of select="\'\\lneqq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02268;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/lneqq N: less, not double equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02269;\')"><xsl:value-of select="\'\\gneqq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02269;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/gneqq N: greater, not dbl equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0226A;&#x00338;&#x0FE00;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226A;&#x00338;&#x0FE00;\')"/></xsl:call-template></xsl:when>\tnot much less than, variant --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0226A;&#x00338;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226A;&#x00338;\')"/></xsl:call-template></xsl:when>\tnot, vert, much less than --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0226A;\')"><xsl:value-of select="\'\\ll \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226A;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ll R: double less-than sign --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0226B;&#x00338;&#x0FE00;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226B;&#x00338;&#x0FE00;\')"/></xsl:call-template></xsl:when>\tnot much greater than, variant --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x0226B;&#x00338;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226B;&#x00338;\')"/></xsl:call-template></xsl:when>\tnot, vert, much greater than --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0226B;\')"><xsl:value-of select="\'\\gg \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226B;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/gg R: dbl greater-than sign --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0226C;\')"><xsl:value-of select="\'\\between \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226C;\')"/></xsl:call-template></xsl:when>\t\x3c!--/between R: between --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0226D;\')"><xsl:value-of select="\'\\not\\asymp \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226D;\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test="starts-with($content,\'&#x0226E;\')"><xsl:value-of select="\'\\nless \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226E;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nless N: not less-than --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0226F;\')"><xsl:value-of select="\'\\ngtr \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0226F;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ngtr N: not greater-than --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02270;&#x020E5;\')"><xsl:value-of select="\'\\nleq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02270;&#x020E5;\')"/></xsl:call-template></xsl:when>\t\x3c!--/nleq N: not less-than-or-equal --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02270;\')"><xsl:value-of select="\'\\nleqq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02270;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nleqq N: not less, dbl equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02271;&#x020E5;\')"><xsl:value-of select="\'\\ngeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02271;&#x020E5;\')"/></xsl:call-template></xsl:when>\t\x3c!--/ngeq N: not greater-than-or-equal --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02271;\')"><xsl:value-of select="\'\\ngeqq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02271;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ngeqq N: not greater, dbl equals --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02272;\')"><xsl:value-of select="\'\\lesssim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02272;\')"/></xsl:call-template></xsl:when>\t\x3c!--/lesssim R: less, similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02273;\')"><xsl:value-of select="\'\\gtrsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02273;\')"/></xsl:call-template></xsl:when>\t\x3c!--/gtrsim R: greater, similar --\x3e \x3c!-- Required amssymb --\x3e\t\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x02274;\')"><xsl:value-of select="\'\\not\\lesssim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02274;\')"/></xsl:call-template></xsl:when>\t\x3c!--not less, similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02275;\')"><xsl:value-of select="\'\\not\\gtrsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02275;\')"/></xsl:call-template></xsl:when>\t\x3c!--not greater, similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02276;\')"><xsl:value-of select="\'\\lessgtr \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02276;\')"/></xsl:call-template></xsl:when>\t\x3c!--/lessgtr R: less, greater --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02277;\')"><xsl:value-of select="\'\\gtrless \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02277;\')"/></xsl:call-template></xsl:when>\t\x3c!--/gtrless R: greater, less --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02278;\')"><xsl:value-of select="\'\\not\\lessgtr \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02278;\')"/></xsl:call-template></xsl:when>\t\x3c!--not less, greater --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02279;\')"><xsl:value-of select="\'\\not\\gtrless \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02279;\')"/></xsl:call-template></xsl:when>\t\x3c!--not greater, less --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0227A;\')"><xsl:value-of select="\'\\prec \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0227A;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/prec R: precedes --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0227B;\')"><xsl:value-of select="\'\\succ \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0227B;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/succ R: succeeds --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0227C;\')"><xsl:value-of select="\'\\preccurlyeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0227C;\')"/></xsl:call-template></xsl:when>\t\x3c!--/preccurlyeq R: precedes, curly eq --\x3e \x3c!-- Required amssymb --\x3e\t\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x0227D;\')"><xsl:value-of select="\'\\succcurlyeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0227D;\')"/></xsl:call-template></xsl:when>\t\x3c!--/succcurlyeq R: succeeds, curly eq --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0227E;\')"><xsl:value-of select="\'\\precsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0227E;\')"/></xsl:call-template></xsl:when>\t\x3c!--/precsim R: precedes, similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0227F;\')"><xsl:value-of select="\'\\succsim \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0227F;\')"/></xsl:call-template></xsl:when>\t\x3c!--/succsim R: succeeds, similar --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02280;\')"><xsl:value-of select="\'\\nprec \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02280;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nprec N: not precedes --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02281;\')"><xsl:value-of select="\'\\nsucc \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02281;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/nsucc N: not succeeds --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02282;\')"><xsl:value-of select="\'\\subset \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02282;\')"/></xsl:call-template></xsl:when>\t\x3c!--/subset R: subset or is implied by --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02283;\')"><xsl:value-of select="\'\\supset \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02283;\')"/></xsl:call-template></xsl:when>\t\x3c!--/supset R: superset or implies --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02284;\')"><xsl:value-of select="\'\\not\\subset \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02284;\')"/></xsl:call-template></xsl:when>\t\x3c!--not subset --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02285;\')"><xsl:value-of select="\'\\not\\supset \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02285;\')"/></xsl:call-template></xsl:when>\t\x3c!--not superset --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02286;\')"><xsl:value-of select="\'\\subseteq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02286;\')"/></xsl:call-template></xsl:when>\t\x3c!--/subseteq R: subset, equals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02287;\')"><xsl:value-of select="\'\\supseteq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02287;\')"/></xsl:call-template></xsl:when>\t\x3c!--/supseteq R: superset, equals --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0228E;\')"><xsl:value-of select="\'\\uplus \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0228E;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/uplus B: plus sign in union --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02293;\')"><xsl:value-of select="\'\\sqcap \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02293;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/sqcap B: square intersection --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02294;\')"><xsl:value-of select="\'\\bigsqcup \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02294;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/sqcup B: square union --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02295;\')"><xsl:value-of select="\'\\oplus \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02295;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/oplus B: plus sign in circle --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02296;\')"><xsl:value-of select="\'\\ominus \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02296;\')"/></xsl:call-template></xsl:when>\t\x3c!--/ominus B: minus sign in circle --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02297;\')"><xsl:value-of select="\'\\otimes \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02297;\')"/></xsl:call-template></xsl:when>\t\x3c!--/otimes B: multiply sign in circle --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x02298;\')"><xsl:value-of select="\'\\oslash \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02298;\')"/></xsl:call-template></xsl:when>\t\x3c!--/oslash B: solidus in circle --\x3e\r\n\x3c!-- ? --\x3e\t<xsl:when test="starts-with($content,\'&#x02299;\')"><xsl:value-of select="\'\\odot \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x02299;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/odot B: middle dot in circle --\x3e \x3c!--/bigodot L: circle dot operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x0229F;\')"><xsl:value-of select="\'\\boxminus \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x0229F;\')"/></xsl:call-template></xsl:when>\t\x3c!--/boxminus B: minus sign in box --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022A4;\')"><xsl:value-of select="\'\\top \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022A4;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/top top --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022A5;\')"><xsl:value-of select="\'\\perp \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022A5;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/perp R: perpendicular --\x3e\x3c!--/bot bottom --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022A6;\')"><xsl:value-of select="\'\\vdash \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022A6;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/vdash R: vertical, dash --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022A7;\')"><xsl:value-of select="\'\\vDash \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022A7;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/vDash R: vertical, dbl dash --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022A8;\')"><xsl:value-of select="\'\\models \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022A8;\')"/></xsl:call-template></xsl:when>\t\x3c!--/models R: --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022AA;\')"><xsl:value-of select="\'\\Vvdash \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022AA;\')"/></xsl:call-template></xsl:when>\t\x3c!--/Vvdash R: triple vertical, dash --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C0;\')"><xsl:value-of select="\'\\bigwedge \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C0;\')"/></xsl:call-template></xsl:when>\t\x3c!--/bigwedge L: logical or operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C1;\')"><xsl:value-of select="\'\\bigvee \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C1;\')"/></xsl:call-template></xsl:when>\t\x3c!--/bigcap L: intersection operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C2;\')"><xsl:value-of select="\'\\bigcap \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C2;\')"/></xsl:call-template></xsl:when>\t\x3c!--/bigvee L: logical and operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C3;\')"><xsl:value-of select="\'\\bigcup \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C3;\')"/></xsl:call-template></xsl:when>\t\x3c!--/bigcup L: union operator --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C4;\')"><xsl:value-of select="\'\\diamond \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C4;\')"/></xsl:call-template></xsl:when>\t\x3c!--/diamond B: open diamond --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C5;\')"><xsl:value-of select="\'\\cdot \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C5;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/cdot B: small middle dot --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C6;\')"><xsl:value-of select="\'\\star \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C6;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/star B: small star, filled --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C7;\')"><xsl:value-of select="\'\\divideontimes \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C7;\')"/></xsl:call-template></xsl:when>\t\x3c!--/divideontimes B: division on times --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022C8;\')"><xsl:value-of select="\'\\bowtie \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022C8;\')"/></xsl:call-template></xsl:when>\t\x3c!--/bowtie R: --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022CD;\')"><xsl:value-of select="\'\\backsimeq \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022CD;\')"/></xsl:call-template></xsl:when>\t\x3c!--/backsimeq R: reverse similar, eq --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022EF;\')"><xsl:value-of select="\'\\cdots \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022EF;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/cdots, three dots, centered --\x3e\r\n\x3c!--\t\t<xsl:when test="starts-with($content,\'&#x022F0;\')"><xsl:value-of select="\' \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022F0;\')"/></xsl:call-template></xsl:when>\t\tthree dots, ascending --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x022F1;\')"><xsl:value-of select="\'\\ddots \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x022F1;\')"/></xsl:call-template></xsl:when>\t\t\x3c!--/ddots, three dots, descending --\x3e\r\n\r\n\x3c!-- ====================================================================== --\x3e\t\t\r\n\t\t<xsl:when test="starts-with($content,\'&#x025A1;\')"><xsl:value-of select="\'\\Box \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x025A1;\')"/></xsl:call-template></xsl:when>\t\x3c!--/square, square --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t<xsl:when test="starts-with($content,\'&#x025AA;\')"><xsl:value-of select="\'\\blacksquare \'" /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'&#x025AA;\')"/></xsl:call-template></xsl:when>\t\x3c!--/blacksquare, square, filled  --\x3e \x3c!-- Required amssymb --\x3e\r\n\t\t\r\n\t\t<xsl:when test=\'starts-with($content,"&apos;")\'><xsl:value-of select=\'"\\text{&apos;}"\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select=\'substring-after($content, "&apos;")\'/></xsl:call-template></xsl:when>\x3c!-- \\text required amslatex --\x3e\r\n\t\t<xsl:when test=\'starts-with($content,"(")\'><xsl:value-of select=\'"\\left("\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'(\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\'starts-with($content,")")\'><xsl:value-of select=\'"\\right)"\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \')\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\'starts-with($content,"[")\'><xsl:value-of select=\'"\\left["\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'[\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\'starts-with($content,"]")\'><xsl:value-of select=\'"\\right]"\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \']\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\'starts-with($content,"{")\'><xsl:value-of select=\'"\\left\\{"\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'{\')"/></xsl:call-template></xsl:when>\r\n\t\t<xsl:when test=\'starts-with($content,"}")\'><xsl:value-of select=\'"\\right\\}"\' /><xsl:call-template name="replaceEntities"><xsl:with-param name="content" select="substring-after($content, \'}\')"/></xsl:call-template></xsl:when>\r\n\t\t\r\n\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:value-of select="substring($content,1,1)"/>\r\n\t\t\t<xsl:call-template name="replaceEntities">\r\n\t\t\t\t<xsl:with-param name="content" select="substring($content, 2)"/>\r\n\t\t\t</xsl:call-template>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose></xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template name="replaceMtextEntities">\r\n\t<xsl:param name="content"/>\r\n\t<xsl:choose>\r\n\t<xsl:when test="contains($content,\'&#x02009;&#x0200A;&#x0200A;\')">\t\x3c!-- ThickSpace - space of width 5/18 em --\x3e\r\n\t\t<xsl:call-template name="replaceMtextEntities">\r\n\t\t\t<xsl:with-param name="content" select="concat(substring-before($content,\'&#x02009;&#x0200A;&#x0200A;\'),\'\\hspace{0.28em}\',substring-after($content,\'&#x02009;&#x0200A;&#x0200A;\'))"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:when>\r\n\t<xsl:when test="contains($content,\'&#x02009;\')">\t\x3c!-- ThinSpace - space of width 3/18 em --\x3e\r\n\t\t<xsl:call-template name="replaceMtextEntities">\r\n\t\t\t<xsl:with-param name="content" select="concat(substring-before($content,\'&#x02009;\'),\'\\hspace{0.17em}\',substring-after($content,\'&#x02009;\'))"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:when>\r\n\t<xsl:otherwise>\r\n\t\t<xsl:value-of select="normalize-space($content)"/>\r\n\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n\x3c!--xsl:include href="cmarkup.xsl"/--\x3e\r\n\x3c!-- 4.4.1.1 cn --\x3e\r\n<xsl:template match="m:cn"><xsl:apply-templates/></xsl:template>\r\n\r\n<xsl:template match="m:cn[@type=\'complex-cartesian\']">\r\n\t<xsl:apply-templates select="text()[1]"/>\r\n  \t<xsl:text>+</xsl:text>\r\n\t<xsl:apply-templates select="text()[2]"/>\r\n\t<xsl:text>i</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:cn[@type=\'rational\']">\r\n\t<xsl:apply-templates select="text()[1]"/>\r\n\t<xsl:text>/</xsl:text>\r\n\t<xsl:apply-templates select="text()[2]"/>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:cn[@type=\'integer\' and @base!=10]">\r\n\t\t<xsl:apply-templates/>\r\n\t\t<xsl:text>_{</xsl:text><xsl:value-of select="@base"/><xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:cn[@type=\'complex-polar\']">\r\n\t<xsl:apply-templates select="text()[1]"/>\r\n\t<xsl:text>e^{i </xsl:text>\r\n\t<xsl:apply-templates select="text()[2]"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:cn[@type=\'e-notation\']">\r\n    <xsl:apply-templates select="text()[1]"/>\r\n    <xsl:text>E</xsl:text>\r\n    <xsl:apply-templates select="text()[2]"/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.1.1 ci 4.4.1.2 csymbol --\x3e\r\n<xsl:template match="m:ci | m:csymbol">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="string-length(normalize-space(text()))>1">\r\n\t\t\t<xsl:text>\\mathrm{</xsl:text><xsl:apply-templates/><xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:apply-templates/></xsl:otherwise>\r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.1 apply 4.4.2.2 reln --\x3e\r\n<xsl:template match="m:apply | m:reln">\r\n\t<xsl:apply-templates select="*[1]">\r\n\t\x3c!-- <? --\x3e\r\n\t\t<xsl:with-param name="p" select="10"/>\r\n\t</xsl:apply-templates>\r\n\t\x3c!-- ?> --\x3e\r\n \t<xsl:text>(</xsl:text>\r\n\t<xsl:for-each select="*[position()>1]">\r\n\t\t<xsl:apply-templates select="."/>\r\n\t\t<xsl:if test="not(position()=last())"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n \t<xsl:text>)</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.3 fn --\x3e\r\n<xsl:template match="m:fn[m:apply[1]]"> \x3c!-- for m:fn using default rule --\x3e\r\n\t<xsl:text>(</xsl:text><xsl:apply-templates/><xsl:text>)</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.4 interval --\x3e\r\n<xsl:template match="m:interval[*[2]]">\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@closure=\'open\' or @closure=\'open-closed\'">\r\n\t\t\t<xsl:text>\\left(</xsl:text>\t\t\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\left[</xsl:text></xsl:otherwise> \r\n\t</xsl:choose>\r\n\t<xsl:apply-templates select="*[1]"/>\r\n\t<xsl:text> , </xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="@closure=\'open\' or @closure=\'closed-open\'">\r\n\t\t\t<xsl:text>\\right)</xsl:text>\t\t\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise><xsl:text>\\right]</xsl:text></xsl:otherwise> \r\n\t</xsl:choose>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:interval">\r\n\t<xsl:text>\\left\\{</xsl:text><xsl:apply-templates/><xsl:text>\\right\\}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.5 inverse --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:inverse]]">\r\n\t<xsl:apply-templates select="*[2]"/><xsl:text>^{(-1)}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.6 sep 4.4.2.7 condition --\x3e\r\n<xsl:template match="m:sep | m:condition"><xsl:apply-templates/></xsl:template>\r\n\r\n\x3c!-- 4.4.2.9 lambda --\x3e\r\n<xsl:template match="m:lambda">\r\n\t<xsl:text>\\mathrm{lambda}\\: </xsl:text>\r\n  \t<xsl:apply-templates select="m:bvar/*"/>\r\n  \t<xsl:text>.\\: </xsl:text>\r\n  <xsl:apply-templates select="*[last()]"/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.10 compose --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:compose]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\circ </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.11 ident --\x3e\r\n<xsl:template match="m:ident"><xsl:text>\\mathrm{id}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.2.12 domain 4.4.2.13 codomain 4.4.2.14 image 4.4.3.21 arg 4.4.3.24 lcm\r\n\t\t4.4.5.9 grad 4.4.5.10 curl 4.4.9.4 median 4.4.9.5 mode--\x3e\r\n<xsl:template match="m:domain | m:codomain | m:image | m:arg | m:lcm | m:grad |\r\n\t\t\t\t\t\t\t\t m:curl | m:median | m:mode">\r\n\t<xsl:text>\\mathop{\\mathrm{</xsl:text>\r\n\t<xsl:value-of select="local-name()"/>\r\n\t<xsl:text>}}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.15 domainofapplication --\x3e\r\n<xsl:template match="m:domainofapplication"/>\r\n\r\n\x3c!-- 4.4.2.16 piecewise --\x3e\r\n<xsl:template match="m:piecewise">\r\n\t<xsl:text>\\begin{cases}</xsl:text>\r\n\t<xsl:apply-templates select="m:piece"/>\r\n\t<xsl:apply-templates select="m:otherwise"/>\r\n\t<xsl:text>\\end{cases}</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:piece">\r\n\t\t<xsl:apply-templates select="*[1]"/>\r\n\t\t<xsl:text> &amp; \\text{if $</xsl:text>\r\n\t\t<xsl:apply-templates select="*[2]"/>\r\n\t\t<xsl:text>$}</xsl:text>\r\n\t\t<xsl:if test="not(position()=last()) or ../m:otherwise"><xsl:text>\\\\ </xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:otherwise">\r\n\t<xsl:apply-templates select="*[1]"/>\r\n\t<xsl:text> &amp; \\text{otherwise}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.1 quotient --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:quotient]]">\r\n\t<xsl:text>\\left\\lfloor\\frac{</xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>}{</xsl:text>\r\n\t<xsl:apply-templates select="*[3]"/>\r\n\t<xsl:text>}\\right\\rfloor </xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.2 factorial --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:factorial]]">\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>!</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.3 divide --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:divide]]">\r\n\t<xsl:param name="p" select="0"/>\r\n  <xsl:param name="this-p" select="3"/>\r\n  <xsl:if test="$this-p &lt; $p"><xsl:text>\\left(</xsl:text></xsl:if>\r\n  <xsl:text>\\frac{</xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\x3c!--\t\t<xsl:with-param name="p" select="$this-p"/>\r\n\t</xsl:apply-templates>--\x3e\r\n\t<xsl:text>}{</xsl:text>\r\n\t<xsl:apply-templates select="*[3]"/>\r\n\x3c!--    \t<xsl:with-param name="p" select="$this-p"/>\r\n\t</xsl:apply-templates>--\x3e\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:if test="$this-p &lt; $p"><xsl:text>\\right)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.4 max min --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:max or self::m:min]]">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select="local-name(*[1])"/>\r\n\t<xsl:text>\\{</xsl:text>\r\n   <xsl:choose>\r\n\t\t<xsl:when test="m:condition">\r\n   \t\t<xsl:apply-templates select="*[last()]"/>\r\n   \t\t<xsl:text>, </xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:condition/node()"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:for-each select="*[position() &gt; 1]">\r\n\t\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t\t<xsl:if test="position() !=last()"><xsl:text> , </xsl:text></xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:otherwise>\r\n   </xsl:choose>\r\n\t<xsl:text>\\}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.5  minus--\x3e\r\n<xsl:template match="m:apply[*[1][self::m:minus] and count(*)=2]">\r\n\t<xsl:text>-</xsl:text>\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="5"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[*[1][self::m:minus] and count(*)&gt;2]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="mo">-</xsl:with-param>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.6  plus--\x3e\r\n<xsl:template match="m:apply[*[1][self::m:plus]]">\r\n  <xsl:param name="p" select="0"/>\r\n  <xsl:if test="$p &gt; 2">\r\n\t\t<xsl:text>(</xsl:text>\r\n\t</xsl:if>\r\n  <xsl:for-each select="*[position()&gt;1]">\r\n   <xsl:if test="position() &gt; 1">\r\n    <xsl:choose>\r\n      <xsl:when test="self::m:apply[*[1][self::m:times] and\r\n      *[2][self::m:apply/*[1][self::m:minus] or self::m:cn[not(m:sep) and\r\n      (number(.) &lt; 0)]]]">-</xsl:when>\r\n      <xsl:otherwise>+</xsl:otherwise>\r\n    </xsl:choose>\r\n   </xsl:if>   \r\n    <xsl:choose>\r\n      <xsl:when test="self::m:apply[*[1][self::m:times] and\r\n      *[2][self::m:cn[not(m:sep) and (number(.) &lt;0)]]]">\r\n\t\t\t<xsl:value-of select="-(*[2])"/>\r\n\t\t\t<xsl:apply-templates select=".">\r\n\t\t     <xsl:with-param name="first" select="2"/>\r\n\t\t     <xsl:with-param name="p" select="2"/>\r\n\t\t   </xsl:apply-templates>\r\n       </xsl:when>\r\n      <xsl:when test="self::m:apply[*[1][self::m:times] and\r\n      *[2][self::m:apply/*[1][self::m:minus]]]">\r\n\t\t\t\t<xsl:apply-templates select="./*[2]/*[2]"/>\r\n\t\t\t\t<xsl:apply-templates select=".">\r\n\t\t\t\t\t<xsl:with-param name="first" select="2"/>\r\n\t\t\t\t\t<xsl:with-param name="p" select="2"/>\r\n\t\t\t\t</xsl:apply-templates>\r\n\t\t\t</xsl:when>\r\n\t\t\t<xsl:otherwise>\r\n\t\t\t\t<xsl:apply-templates select=".">\r\n\t\t\t\t\t<xsl:with-param name="p" select="2"/>\r\n\t\t\t\t</xsl:apply-templates>\r\n\t\t\t</xsl:otherwise>\r\n\t\t</xsl:choose>\r\n\t</xsl:for-each>\r\n\t<xsl:if test="$p &gt; 2">\r\n\t\t<xsl:text>)</xsl:text>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.7 power --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:power]]">\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="5"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>^{</xsl:text>\r\n\t<xsl:apply-templates select="*[3]">\r\n\t\t<xsl:with-param name="p" select="5"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.8 remainder --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:rem]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="mo">\\mod </xsl:with-param>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.9  times--\x3e\r\n<xsl:template match="m:apply[*[1][self::m:times]]" name="times">\r\n  <xsl:param name="p" select="0"/>\r\n  <xsl:param name="first" select="1"/>\r\n  <xsl:if test="$p &gt; 3"><xsl:text>(</xsl:text></xsl:if>\r\n  <xsl:for-each select="*[position()&gt;1]">\r\n\t\t<xsl:if test="position() &gt; 1">\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test="self::m:cn">\\times \x3c!-- times --\x3e</xsl:when>\r\n\t\t\t\t<xsl:otherwise>\x3c!--invisible times--\x3e</xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t</xsl:if> \r\n\t\t<xsl:if test="position()&gt;= $first">\r\n\t\t\t<xsl:apply-templates select=".">\r\n\t\t\t\t<xsl:with-param name="p" select="3"/>\r\n\t\t\t</xsl:apply-templates>\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n  <xsl:if test="$p &gt; 3"><xsl:text>)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.10 root --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:root]]">\r\n\t<xsl:text>\\sqrt</xsl:text>\r\n\t<xsl:if test="m:degree!=2">\r\n\t\t<xsl:text>[</xsl:text>\r\n\t\t<xsl:apply-templates select="m:degree/*"/>\r\n\t\t<xsl:text>]</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text>{</xsl:text>\r\n\t<xsl:apply-templates select="*[position()&gt;1 and not(self::m:degree)]"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.11 gcd --\x3e\r\n<xsl:template match="m:gcd"><xsl:text>\\gcd </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.3.12 and --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:and]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\land \x3c!-- and --\x3e</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.13 or --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:or]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\lor </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.14 xor --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:xor]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\mathop{\\mathrm{xor}}</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.15 not --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:not]]">\r\n\t<xsl:text>\\neg </xsl:text>\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.16 implies --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:implies]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="mo">\\implies </xsl:with-param>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.17 forall 4.4.3.18 exists --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:forall or self::m:exists]]">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select="local-name(*[1])"/>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select="m:bvar"/>\r\n\t<xsl:if test="m:condition">\r\n\t\t<xsl:text>, </xsl:text><xsl:apply-templates select="m:condition"/>\r\n\t</xsl:if>\r\n\t<xsl:if test="*[last()][local-name()!=\'condition\'][local-name()!=\'bvar\']">\r\n\t\t<xsl:text>\\colon </xsl:text>\r\n\t  <xsl:apply-templates select="*[last()]"/>\r\n  </xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.19 abs --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:abs]]">\r\n\t<xsl:text>\\left|</xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>\\right|</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.20 conjugate --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:conjugate]]">\r\n\t<xsl:text>\\overline{</xsl:text><xsl:apply-templates select="*[2]"/><xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.22 real --\x3e\r\n<xsl:template match="m:real"><xsl:text>\\Re </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.3.23 imaginary --\x3e\r\n<xsl:template match="m:imaginary"><xsl:text>\\Im </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.3.25 floor --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:floor]]">\r\n\t<xsl:text>\\lfloor </xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>\\rfloor </xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.3.25 ceiling --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:ceiling]]">\r\n\t<xsl:text>\\lceil </xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>\\rceil </xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.1 eq --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:eq]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">=</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.2 neq --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:neq]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\neq </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.3 gt --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:gt]]">\r\n<xsl:param name="p" select="0"/>\r\n<xsl:call-template name="infix">\r\n\t<xsl:with-param name="this-p" select="1"/>\r\n\t<xsl:with-param name="p" select="$p"/>\r\n\t<xsl:with-param name="mo">&gt; </xsl:with-param>\r\n</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.4 lt --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:lt]]">\r\n<xsl:param name="p" select="0"/>\r\n<xsl:call-template name="infix">\r\n\t<xsl:with-param name="this-p" select="1"/>\r\n\t<xsl:with-param name="p" select="$p"/>\r\n\t<xsl:with-param name="mo">&lt; </xsl:with-param>\r\n</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.5 geq --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:geq]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\ge </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.6 leq --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:leq]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\le </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.7 equivalent --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:equivalent]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\equiv </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.8 approx --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:approx]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="1"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\approx </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.4.9 factorof --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:factorof]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="mo"> | </xsl:with-param>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.5.1 int --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:int]]">\r\n\t<xsl:text>\\int</xsl:text>\r\n\t<xsl:if test="m:lowlimit/*|m:interval/*[1]|m:condition/*">\r\n\t\t<xsl:text>_{</xsl:text>\r\n\t\t<xsl:apply-templates select="m:lowlimit/*|m:interval/*[1]|m:condition/*"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="m:uplimit/*|m:interval/*[2]">\r\n\t\t<xsl:text>^{</xsl:text>\r\n\t\t<xsl:apply-templates select="m:uplimit/*|m:interval/*[2]"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select="*[last()]"/>\r\n\t<xsl:text>\\,d </xsl:text>\r\n\t<xsl:apply-templates select="m:bvar"/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.5.2 diff --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:diff] and m:ci and count(*)=2]" priority="2">\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>^\\prime </xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[*[1][self::m:diff]]" priority="1">\r\n\t<xsl:text>\\frac{</xsl:text>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="m:bvar/m:degree">\r\n\t\t\t<xsl:text>d^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:bvar/m:degree/node()"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t\t<xsl:apply-templates select="*[last()]"/>\r\n\t\t\t<xsl:text>}{d</xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:bvar/node()"/>\r\n\t\t\t<xsl:text>^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:bvar/m:degree/node()"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:text>d </xsl:text>\r\n\t\t\t<xsl:apply-templates select="*[last()]"/>\r\n\t\t\t<xsl:text>}{d </xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:bvar"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.5.3 partialdiff --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:partialdiff] and m:list and m:ci and count(*)=3]" priority="2">\r\n\t<xsl:text>D_{</xsl:text>\r\n\t<xsl:for-each select="m:list[1]/*">\r\n\t\t<xsl:apply-templates select="."/>\r\n\t\t<xsl:if test="position()&lt;last()"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select="*[3]"/>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[*[1][self::m:partialdiff]]" priority="1">\r\n\t<xsl:text>\\frac{\\partial^{</xsl:text>\r\n\t<xsl:choose>\r\n\t\t<xsl:when test="m:degree">\r\n\t\t\t<xsl:apply-templates select="m:degree/node()"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:when test="m:bvar/m:degree[string(number(.))=\'NaN\']">\r\n\t\t\t<xsl:for-each select="m:bvar/m:degree">\r\n\t\t\t\t<xsl:apply-templates select="node()"/>\r\n\t\t\t\t<xsl:if test="position()&lt;last()"><xsl:text>+</xsl:text></xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t\t<xsl:if test="count(m:bvar[not(m:degree)])&gt;0">\r\n\t\t\t\t<xsl:text>+</xsl:text>\r\n\t\t\t\t<xsl:value-of select="count(m:bvar[not(m:degree)])"/>\r\n\t\t\t</xsl:if>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:value-of select="sum(m:bvar/m:degree)+count(m:bvar[not(m:degree)])"/>\r\n\t\t</xsl:otherwise>\r\n\t</xsl:choose>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select="*[last()]"/>\r\n\t<xsl:text>}{</xsl:text>\r\n\t<xsl:for-each select="m:bvar">\r\n\t\t<xsl:text>\\partial </xsl:text>\r\n\t\t<xsl:apply-templates select="node()"/>\r\n\t\t<xsl:if test="m:degree">\r\n\t\t\t<xsl:text>^{</xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:degree/node()"/>\r\n\t\t\t<xsl:text>}</xsl:text>\r\n\t\t</xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.2.8 declare 4.4.5.4 lowlimit 4.4.5.5 uplimit 4.4.5.7 degree 4.4.9.5 momentabout --\x3e\r\n<xsl:template match="m:declare | m:lowlimit | m:uplimit | m:degree | m:momentabout"/>\r\n\r\n\x3c!-- 4.4.5.6  bvar--\x3e\r\n<xsl:template match="m:bvar">\r\n\t<xsl:apply-templates/>\r\n\t<xsl:if test="following-sibling::m:bvar"><xsl:text>, </xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.5.8 divergence--\x3e\r\n<xsl:template match="m:divergence"><xsl:text>\\mathop{\\mathrm{div}}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.5.11 laplacian--\x3e\r\n<xsl:template match="m:laplacian"><xsl:text>\\nabla^2 </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.6.1 set --\x3e\r\n<xsl:template match="m:set">\r\n\t<xsl:text>\\{</xsl:text><xsl:call-template name="set"/><xsl:text>\\}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.2 list --\x3e\r\n<xsl:template match="m:list">\r\n\t<xsl:text>\\left[</xsl:text><xsl:call-template name="set"/><xsl:text>\\right]</xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template name="set">\r\n   <xsl:choose>\r\n\t\t<xsl:when test="m:condition">\r\n   \t\t<xsl:apply-templates select="m:bvar/*[not(self::bvar or self::condition)]"/>\r\n   \t\t<xsl:text>\\colon </xsl:text>\r\n\t\t\t<xsl:apply-templates select="m:condition/node()"/>\r\n\t\t</xsl:when>\r\n\t\t<xsl:otherwise>\r\n\t\t\t<xsl:for-each select="*">\r\n\t\t\t\t<xsl:apply-templates select="."/>\r\n\t\t\t\t<xsl:if test="position()!=last()"><xsl:text>, </xsl:text></xsl:if>\r\n\t\t\t</xsl:for-each>\r\n\t\t</xsl:otherwise>\r\n   </xsl:choose>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.3 union --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:union]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\cup </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.4 intersect --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:intersect]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\cap </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.5 in --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:in]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="mo">\\in </xsl:with-param>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.5 notin --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:notin]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="mo">\\notin </xsl:with-param>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="this-p" select="3"/>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.7 subset --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:subset]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\subseteq </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.8 prsubset --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:prsubset]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\subset </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.9 notsubset --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:notsubset]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\nsubseteq </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.10 notprsubset --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:notprsubset]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\not\\subset </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.11 setdiff --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:setdiff]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\setminus </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.12 card --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:card]]">\r\n\t<xsl:text>|</xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>|</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.6.13 cartesianproduct 4.4.10.6 vectorproduct --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:cartesianproduct or self::m:vectorproduct]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\times </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n<xsl:template\r\nmatch="m:apply[*[1][self::m:cartesianproduct][count(following-sibling::m:reals)=count(following-sibling::*)]]"\r\npriority="2">\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="5"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>^{</xsl:text>\r\n\t<xsl:value-of select="count(*)-1"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.7.1 sum --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:sum]]">\r\n\t<xsl:text>\\sum</xsl:text><xsl:call-template name="series"/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.7.2 product --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:product]]">\r\n\t<xsl:text>\\prod</xsl:text><xsl:call-template name="series"/>\r\n</xsl:template>\r\n\t\r\n<xsl:template name="series">\r\n\t<xsl:if test="m:lowlimit/*|m:interval/*[1]|m:condition/*">\r\n\t\t<xsl:text>_{</xsl:text>\r\n\t\t<xsl:if test="not(m:condition)">\r\n\t\t\t<xsl:apply-templates select="m:bvar"/>\r\n\t\t\t<xsl:text>=</xsl:text>\r\n\t\t</xsl:if>\r\n\t\t<xsl:apply-templates select="m:lowlimit/*|m:interval/*[1]|m:condition/*"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:if test="m:uplimit/*|m:interval/*[2]">\r\n\t\t<xsl:text>^{</xsl:text>\r\n\t\t<xsl:apply-templates select="m:uplimit/*|m:interval/*[2]"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select="*[last()]"/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.7.3 limit --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:limit]]">\r\n\t<xsl:text>\\lim_{</xsl:text>\r\n\t<xsl:apply-templates select="m:lowlimit|m:condition/*"/>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select="*[last()]"/>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[m:limit]/m:lowlimit" priority="3">\r\n\t<xsl:apply-templates select="../m:bvar/node()"/>\r\n\t<xsl:text>\\to </xsl:text>\r\n\t<xsl:apply-templates/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.7.4 tendsto --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:tendsto]]">\r\n\t<xsl:param name="p"/>\r\n\t<xsl:call-template name="binary">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\r\n\t\t\t<xsl:choose>\r\n\t\t\t\t<xsl:when test="@type=\'above\'">\\searrow </xsl:when>\r\n\t\t\t\t<xsl:when test="@type=\'below\'">\\nearrow </xsl:when>\r\n\t\t\t\t<xsl:when test="@type=\'two-sided\'">\\rightarrow </xsl:when>\r\n\t\t\t\t<xsl:otherwise>\\to </xsl:otherwise>\r\n\t\t\t</xsl:choose>\r\n\t\t</xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.8.1 common tringonometric functions 4.4.8.3 natural logarithm --\x3e\r\n<xsl:template match="m:apply[*[1][\r\n self::m:sin or \t\tself::m:cos or \tself::m:tan or\t\tself::m:sec or\r\n self::m:csc or \t\tself::m:cot or \tself::m:sinh or\t \tself::m:cosh or\r\n self::m:tanh or \t\tself::m:coth or\tself::m:arcsin or \tself::m:arccos or\r\n self::m:arctan or \tself::m:ln]]">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select="local-name(*[1])"/>\r\n\t<xsl:text> </xsl:text>\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:sin | m:cos | m:tan | m:sec | m:csc |\r\n\t\t\t\t\t\t\t\t m:cot | m:sinh | m:cosh | m:tanh | m:coth |\r\n\t\t\t\t\t\t\t\t m:arcsin | m:arccos | m:arctan | m:ln">\r\n\t<xsl:text>\\</xsl:text>\r\n\t<xsl:value-of select="local-name(.)"/>\r\n\t<xsl:text> </xsl:text>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[*[1][\r\n self::m:sech or \t\tself::m:csch or\t\tself::m:arccosh or\r\n self::m:arccot or \tself::m:arccoth or \tself::m:arccsc or\r\n self::m:arccsch or self::m:arcsec or \tself::m:arcsech or\r\n self::m:arcsinh or self::m:arctanh]]">\r\n\t<xsl:text>\\mathrm{</xsl:text>\r\n\t<xsl:value-of select="local-name(*[1])"/>\r\n\t<xsl:text>\\,}</xsl:text>\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:sech | m:csch | m:arccosh | m:arccot |\r\n\t\t\t\t\t\t\t\t m:arccoth | m:arccsc |m:arccsch |m:arcsec |\r\n\t\t\t\t\t\t\t\t m:arcsech | m:arcsinh | m:arctanh">\r\n\t<xsl:text>\\mathrm{</xsl:text>\r\n\t<xsl:value-of select="local-name(.)"/>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.8.2 exp --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:exp]]">\r\n\t<xsl:text>e^{</xsl:text><xsl:apply-templates select="*[2]"/><xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.8.4 log --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:log]]">\r\n\t<xsl:text>\\lg </xsl:text>\r\n\t<xsl:apply-templates select="*[last()]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[*[1][self::m:log] and m:logbase != 10]">\r\n\t<xsl:text>\\log_{</xsl:text>\r\n\t<xsl:apply-templates select="m:logbase/node()"/>\r\n\t<xsl:text>}</xsl:text>\r\n\t<xsl:apply-templates select="*[last()]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.9.1 mean --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:mean]]">\r\n\t<xsl:text>\\langle </xsl:text>\r\n\t<xsl:for-each select="*[position()&gt;1]">\r\n\t\t<xsl:apply-templates select="."/>\r\n\t\t<xsl:if test="position() !=last()"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>\\rangle </xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.9.2 sdef --\x3e\r\n<xsl:template match="m:sdev"><xsl:text>\\sigma </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.9.3 variance --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:variance]]">\r\n\t<xsl:text>\\sigma(</xsl:text>\r\n\t<xsl:apply-templates select="*[2]"/>\r\n\t<xsl:text>)^2</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.9.5 moment --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:moment]]">\r\n\t<xsl:text>\\langle </xsl:text>\r\n\t<xsl:apply-templates select="*[last()]"/>\r\n\t<xsl:text>^{</xsl:text>\r\n\t<xsl:apply-templates select="m:degree/node()"/>\r\n\t<xsl:text>}\\rangle</xsl:text>\r\n\t<xsl:if test="m:momentabout">\r\n\t\t<xsl:text>_{</xsl:text>\r\n\t\t<xsl:apply-templates select="m:momentabout/node()"/>\r\n\t\t<xsl:text>}</xsl:text>\r\n\t</xsl:if>\r\n\t<xsl:text> </xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.1 vector  --\x3e\r\n<xsl:template match="m:vector">\r\n\t<xsl:text>\\left(\\begin{array}{c}</xsl:text>\r\n\t<xsl:for-each select="*">\r\n\t\t<xsl:apply-templates select="."/>\r\n\t\t<xsl:if test="position()!=last()"><xsl:text>\\\\ </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>\\end{array}\\right)</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.2 matrix  --\x3e\r\n<xsl:template match="m:matrix">\r\n\t<xsl:text>\\begin{pmatrix}</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>\\end{pmatrix}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.3 matrixrow  --\x3e\r\n<xsl:template match="m:matrixrow">\r\n\t<xsl:for-each select="*">\r\n\t\t<xsl:apply-templates select="."/>\r\n\t\t<xsl:if test="position()!=last()"><xsl:text> &amp; </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:if test="position()!=last()"><xsl:text>\\\\ </xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.4 determinant  --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:determinant]]">\r\n\t<xsl:text>\\det </xsl:text>\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n</xsl:template>\r\n\r\n<xsl:template match="m:apply[*[1][self::m:determinant]][*[2][self::m:matrix]]" priority="2">\r\n\t<xsl:text>\\begin{vmatrix}</xsl:text>\r\n\t<xsl:apply-templates select="m:matrix/*"/>\r\n\t<xsl:text>\\end{vmatrix}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.5 transpose --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:transpose]]">\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>^T</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.5 selector --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:selector]]">\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="7"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:text>_{</xsl:text>\r\n\t<xsl:for-each select="*[position()&gt;2]">\r\n\t\t<xsl:apply-templates select="."/>\r\n\t\t<xsl:if test="position() !=last()"><xsl:text>, </xsl:text></xsl:if>\r\n\t</xsl:for-each>\r\n\t<xsl:text>}</xsl:text>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.10.7 scalarproduct 4.4.10.8 outerproduct --\x3e\r\n<xsl:template match="m:apply[*[1][self::m:scalarproduct or self::m:outerproduct]]">\r\n\t<xsl:param name="p" select="0"/>\r\n\t<xsl:call-template name="infix">\r\n\t\t<xsl:with-param name="this-p" select="2"/>\r\n\t\t<xsl:with-param name="p" select="$p"/>\r\n\t\t<xsl:with-param name="mo">\\dot </xsl:with-param>\r\n\t</xsl:call-template>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.11.2 semantics --\x3e\r\n<xsl:template match="m:semantics"><xsl:apply-templates select="*[1]"/></xsl:template>\r\n\r\n<xsl:template match="m:semantics[m:annotation/@encoding=\'TeX\']">\r\n\t<xsl:apply-templates select="m:annotation[@encoding=\'TeX\']/node()"/>\r\n</xsl:template>\r\n\r\n\x3c!-- 4.4.12.1 integers --\x3e\r\n<xsl:template match="m:integers"><xsl:text>\\mathbb{Z}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.2 reals --\x3e\r\n<xsl:template match="m:reals"><xsl:text>\\mathbb{R}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.3 rationals --\x3e\r\n<xsl:template match="m:rationals"><xsl:text>\\mathbb{Q}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.4 naturalnumbers --\x3e\r\n<xsl:template match="m:naturalnumbers"><xsl:text>\\mathbb{N}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.5 complexes --\x3e\r\n<xsl:template match="m:complexes"><xsl:text>\\mathbb{C}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.6 primes --\x3e\r\n<xsl:template match="m:primes"><xsl:text>\\mathbb{P}</xsl:text></xsl:template>\r\n\t\r\n\x3c!-- 4.4.12.7 exponentiale --\x3e\r\n<xsl:template match="m:exponentiale"><xsl:text>e</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.8 imaginaryi --\x3e\r\n<xsl:template match="m:imaginaryi"><xsl:text>i</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.9 notanumber --\x3e\r\n<xsl:template match="m:notanumber"><xsl:text>NaN</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.10 true --\x3e\r\n<xsl:template match="m:true"><xsl:text>\\mbox{true}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.11 false --\x3e\r\n<xsl:template match="m:false"><xsl:text>\\mbox{false}</xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.12 emptyset --\x3e\r\n<xsl:template match="m:emptyset"><xsl:text>\\emptyset </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.13 pi --\x3e\r\n<xsl:template match="m:pi"><xsl:text>\\pi </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.14 eulergamma --\x3e\r\n<xsl:template match="m:eulergamma"><xsl:text>\\gamma </xsl:text></xsl:template>\r\n\r\n\x3c!-- 4.4.12.15 infinity --\x3e\r\n<xsl:template match="m:infinity"><xsl:text>\\infty </xsl:text></xsl:template>\r\n\r\n\x3c!-- ****************************** --\x3e\r\n<xsl:template name="infix" >\r\n  <xsl:param name="mo"/>\r\n  <xsl:param name="p" select="0"/>\r\n  <xsl:param name="this-p" select="0"/>\r\n  <xsl:if test="$this-p &lt; $p"><xsl:text>(</xsl:text></xsl:if>\r\n  <xsl:for-each select="*[position()&gt;1]">\r\n\t\t<xsl:if test="position() &gt; 1">\r\n\t\t\t<xsl:copy-of select="$mo"/>\r\n\t\t</xsl:if>   \r\n\t\t<xsl:apply-templates select=".">\r\n\t\t\t<xsl:with-param name="p" select="$this-p"/>\r\n\t\t</xsl:apply-templates>\r\n\t</xsl:for-each>\r\n  <xsl:if test="$this-p &lt; $p"><xsl:text>)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:template name="binary" >\r\n  <xsl:param name="mo"/>\r\n  <xsl:param name="p" select="0"/>\r\n  <xsl:param name="this-p" select="0"/>\r\n  <xsl:if test="$this-p &lt; $p"><xsl:text>(</xsl:text></xsl:if>\r\n\t<xsl:apply-templates select="*[2]">\r\n\t\t<xsl:with-param name="p" select="$this-p"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:value-of select="$mo"/>\r\n\t<xsl:apply-templates select="*[3]">\r\n    \t<xsl:with-param name="p" select="$this-p"/>\r\n\t</xsl:apply-templates>\r\n\t<xsl:if test="$this-p &lt; $p"><xsl:text>)</xsl:text></xsl:if>\r\n</xsl:template>\r\n\r\n\x3c!-- Note: variables colora (template color) and symbola (template startspace) only for Sablotron --\x3e\r\n\r\n<xsl:template name="startspace">\r\n\t<xsl:param name="symbol"/>\r\n\t<xsl:if test="contains($symbol,\' \')">\r\n\t\t<xsl:variable name="symbola" select="concat(substring-before($symbol,\' \'),substring-after($symbol,\' \'))"/>\r\n\t\t<xsl:call-template name="startspace">\r\n\t\t\t<xsl:with-param name="symbol" select="$symbola"/>\r\n\t\t</xsl:call-template>\r\n\t</xsl:if>\r\n\t<xsl:if test="not(contains($symbol,\' \'))">\r\n\t\t<xsl:value-of select="$symbol"/>\r\n\t</xsl:if>\r\n</xsl:template>\r\n\r\n<xsl:strip-space elements="m:*"/>\r\n\r\n<xsl:template match="m:math">\r\n\t<xsl:text>&#x00024;</xsl:text>\r\n\t<xsl:apply-templates/>\r\n\t<xsl:text>&#x00024;</xsl:text>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>\r\n',Widget=P(function(widget){function RegexMap(options){var regexList=[],terms=[],variableRegex="",escapeTerms=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,operatorsAllowed="",allowDigits=!1,allowOperators=!1;this.getTerms=function(){return terms},this.addTerm=function(term){return-1==terms.indexOf(term)&&terms.push(term),this},this.addRegExp=function(regexp){if(!(regexp instanceof RegExp))throw new TypeError("Invalid type passed in. Only RegExp instances can be added");return regexList.push(regexp),this},this.compile=function(){var variables=[];return terms.forEach(function(term){if(1==term.length&&/^[a-zA-Z]$/g.test(term))variables.push(term);else if(1==term.length&&/[\d]/.test(term))allowDigits=!0;else if(1==term.length&&/[\+\-\.\/\_\^><=\(\)\*\|]/.test(term))operatorsAllowed+="|"+term.replace(escapeTerms,"\\$&"),allowOperators=!0;else{var regex="^";regex+="(";for(var i=1;i<term.length;i++)regex+=term.substring(0,i).replace(escapeTerms,"\\$&"),regex+="|";regex+=term.replace(escapeTerms,"\\$&"),regex+=")$",regexList.push(new RegExp(regex))}}),regexList.push(new RegExp("^("+operatorsAllowed.substring(1)+")$")),variableRegex=new RegExp("^["+variables.join("")+(allowDigits?"(\\d)?":"")+(allowOperators?"("+operatorsAllowed.substring(1)+")?":"")+"]+"),this},this.match=function(input){return input=input.replace(escapeTerms,"\\$&"),0==(input=input.replace(variableRegex,"")).length||(input=input.replace(/\\/g,""),regexList.some(function(regexp){var result=regexp.test(input);return result&&window.DEBUG&&console.log("RegExp:"+regexp+":"+regexp.test(input)),result}))}}function pushUndoState(self){if(!self.ignorePushUndoState){var newState=self.getLatexResponses();newState.some(function(latex,i){return latex!==self.undoState[i]})&&(self.undoStack.push(self.undoState),self.undoState=newState,self.redoStack.splice(0),1===self.undoStack.length&&self.$undo.prop("disabled",!1),self.$redo.prop("disabled",!0))}}if(this.version="0.3.12",widget.init=function(el,configXML,eventCallback,restrictContentFlag){var self=this;this.el=el,this.configXML=configXML,this.eventCallback=eventCallback;var xml=this.xml=$(configXML);$(el).addClass("widget"),this.$placeholder=$('<div class="widget-placeholder">').appendTo(el),this.$body=$('<div class="widget-body">').appendTo(el);var $inputs=this.$inputs=$('<div class="inputs"></div>').appendTo(this.$body);xml.find("editorRow").each(function(i){var latexText=$(this).text().trim();""!=latexText&&/\\MathQuillMathField\{/i.test(latexText)?$('<div class="input mje_dynamic_inputbox"><span class="input-box"></span></div>').children().text(latexText).end().appendTo($inputs).find(".input-box").mathquill():(latexText="\\MathQuillMathField{"+latexText+"}",$('<div class="input"><span class="input-box"></span></div>').children().text(latexText).end().appendTo($inputs).find(".input-box").mathquill())}),this.isValid=function(){return JSON.stringify(this.getLatexResponses())!=JSON.stringify(this.initialResponses)},this.restrictContentFlag=void 0===restrictContentFlag||restrictContentFlag,this.restrictContentFlag&&(this.AutoCmds={sin:1,cos:1,tan:1,arcsin:1,arccos:1,arctan:1,sqrt:1,nthroot:1,sum:1,prod:1,pi:1,phi:1,tau:1,gamma:1,theta:1},this.restrictContentKeys=new RegexMap),this.mathOperatorOverride=[],this.createKeypad(xml).appendTo(this.$body),this.sendKey=function(key){this.lastFocusedMathquill.mathquill("onKey",key)},this.lastFocusedMathquill=$inputs.find(".mathquill-editable:first"),null!==navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?$inputs.on("touchstart click",function(e){e.preventDefault(),e.stopPropagation();var focusedMathquill=$(e.target).closest(".mathquill-editable");focusedMathquill.length&&(self.lastFocusedMathquill=focusedMathquill),self.lastFocusedMathquill.mathquill("focus")}):$inputs.on("focusin",function(e){e.preventDefault(),e.stopPropagation();var focusedMathquill=$(e.target).closest(".mathquill-editable");focusedMathquill.length&&(self.lastFocusedMathquill=focusedMathquill)}),this.restrictContentFlag&&this.restrictContentKeys.compile(),this.$inputs.find(".mathquill-editable").each(function(i){self.mathOperatorOverride&&$(this).mathquill("mathOperatorOverride",self.mathOperatorOverride),self.restrictContentFlag&&$(this).mathquill("restrictContentKeys",self.restrictContentKeys)}),this.$body.on("render",function(){self.resize()}),this.scale(1),this.undoStack=[],this.redoStack=[],this.undoState=this.getLatexResponses(),this.initialResponses=this.getLatexResponses(),this.$body.on("render",function(){pushUndoState(self)}).on("keydown",function(evt){if(evt.ctrlKey||evt.metaKey)switch(evt.which){case 90:return evt.shiftKey?self.redo():self.undo(),!1;case 89:return self.redo(),!1}}),this.eventCallback("READY")},widget.createKeypad=function(xml){var self=this,$keypad=$('<div class="keypad mje_controls"><div class="toolbar"><button class="mje_nav_next" mathquillonkey="Left">&larr;</button><button class="mje_nav_prev" mathquillonkey="Right">&rarr;</button><button disabled class="mje_nav_undo" callselfmethod="undo">Undo</button><button disabled class="mje_nav_redo" callselfmethod="redo">Redo</button><button class="mje_nav_del" mathquillonkey="Backspace">&lArr;</button></div><div class="keypad-body"></div></div>');self.$undo=$keypad.find("button[callselfmethod=undo]"),self.$redo=$keypad.find("button[callselfmethod=redo]"),$keypad.on("selectstart",!1),self.$toolbar=$keypad.find(".toolbar").on("click","button",function(){var lastFocusedMathquill=self.lastFocusedMathquill.mathquill("focus"),$this=$(this),onKey=$this.attr("mathquillonkey");onKey?lastFocusedMathquill.mathquill("onKey",onKey):self[$this.attr("callselfmethod")]()});var $keypadbody=$keypad.find(".keypad-body");return self.$tabs=$([]),self.$tabButtons=$([]),xml.find("tabConfig").find("tab").each(function(){self.eventCallback("Creating Tab '"+$(this).attr("title")+"':"),self.createKeypadTab(this).appendTo($keypadbody)}),self.$tabButtons.first().click(),$keypad},widget.createKeypadTab=function(xml){var self=this,ariaLabel=$(xml).attr("aria-label")||$(xml).attr("title"),$tab=$('<div class="keypad-tab">').attr("aria-label",ariaLabel);return $(xml).find("grid").each(function(){self.createKeypadGrid(this).appendTo($tab)}),$rows=$('<div class="keypad-rows">').appendTo($tab),$(xml).find("row").each(function(){self.createKeypadRow(this).appendTo($rows)}),this.$tabs=this.$tabs.add($tab),this.createTabButton(xml,$tab),this.$tabButtons.length>1&&this.$tabButtons.appendTo(this.$toolbar),$tab},widget.createTabButton=function(xml,$tab){var self=this;this.$tabButtons=this.$tabButtons.add($('<span class="keypad-tab-button">'+$(xml).attr("title")+"</span>").click(function(){self.$tabs.add(self.$tabButtons).removeClass("selected"),$tab.add(this).addClass("selected"),self.resize()}))},widget.createKeypadRow=function(xml){var self=this,numItems=$(xml).find("item").length,$row=$('<div class="keypad-row">').addClass($(xml).attr("class")).attr("aria-label",$(xml).attr("aria-label")).attr("style","min-width:"+Math.round(2.3*numItems*10)/10+"em");return self.eventCallback(" Creating Row:"),$(xml).find("item").each(function(){self.createKeypadItem(this).appendTo($row)}),$row},widget.createKeypadGrid=function(xml){var self=this,$grid=$('<div class="keypad-grid">').addClass($(xml).attr("class")).attr("aria-label",$(xml).attr("aria-label"));self.eventCallback(" Creating Grid:");var $row,numCols=$(xml).attr("cols")||3;return $(xml).find("item").each(function(i){i%numCols==0&&($row=$('<div class="keypad-grid-row">').appendTo($grid)),self.createKeypadItem(this).appendTo($row)}),$grid},widget.createKeypadItem=function(xml){var self=this,$xml=$(xml),text=$xml.text(),cmd=$xml.attr("cmd")||text,wrap=$xml.attr("wrap-args")||!1,insert=$xml.attr("insert-raw")||!1,ariaLabel=$xml.attr("aria-label"),title=$xml.attr("title");return self.restrictContentFlag&&("asterisk"==title||"cdot"==title||"times"==title?(self.restrictContentKeys.addTerm("*"),self.restrictContentKeys.addTerm(text)):"( )"==text?self.restrictContentKeys.addTerm("("):"| |"==text?self.restrictContentKeys.addTerm("|"):/^[\\]/.test(cmd)&&self.AutoCmds.hasOwnProperty(cmd.substring(1))?self.restrictContentKeys.addTerm(cmd.substring(1)):cmd!=text&&""==text?self.restrictContentKeys.addTerm(cmd):self.restrictContentKeys.addTerm(text)),"cdot"!=title&&"times"!=title||this.mathOperatorOverride.push("*|"+cmd),"le"!=title&&"ge"!=title||this.mathOperatorOverride.push(title+"|"+title),self.eventCallback("  Creating Item: "+text),$('<div class="keypad-item">').text(text).addClass($xml.attr("class")).attr("aria-label",ariaLabel).on("touchstart click",function(evt){evt.preventDefault(),evt.stopPropagation();var mq=self.lastFocusedMathquill.mathquill("focus");wrap?mq.mathquill("cmd","(",!0).mathquill("onKey","Left").mathquill("cmd",cmd).mathquill("onKey","Right"):insert?mq.mathquill("write",cmd):mq.mathquill("cmd",cmd,!0),pushUndoState(self),self.resize(),self.eventCallback("Typed ["+cmd+"] with onscreen keypad")})},widget.scale=function(factor){this.eventCallback("Scaling widget to "+factor+"x");for(var prefixes=["-webkit-","-moz-","-ms-",""],i=0;i<prefixes.length;i++)this.$body.css(prefixes[i]+"transform","scale("+factor+")");this.scaleFactor=factor,this.resize()},widget.resize=function(){this.$placeholder.width(this.$body.width()*this.scaleFactor),this.$placeholder.height(this.$body.height()*this.scaleFactor)},widget.focus=function(){this.lastFocusedMathquill.mathquill("focus"),this.eventCallback("Focused")},widget.unfocus=function(){this.lastFocusedMathquill.mathquill("blur"),this.eventCallback("Unfocused")},widget.getResponse=function(){if(this.readOnlyResponse)return this.readOnlyResponse;var doc=$.parseXML("<response/>"),responses=doc.firstChild,self=this;return this.$inputs.find(".mathquill-editable").each(function(){responses.appendChild(self.mathmlFromLatex($(this).mathquill("latex")))}),doc},widget.setResponse=function(doc){var responses=$(doc).children("response").children("math"),self=this,readOnly="readOnly"===this.mode;readOnly&&this.setMode("readWrite"),this.$inputs.find(".mathquill-editable").each(function(i){$(this).mathquill("latex",self.latexFromMathml(responses[i]))}),readOnly&&this.setMode("readOnly")},widget.getLatexResponses=function(){return this.$inputs.find(".mathquill-editable").map(function(){return $(this).mathquill("latex")}).get()},widget.setLatexResponses=function(responses){return this.$inputs.find(".mathquill-editable").each(function(i){$(this).mathquill("latex",responses[i])}),responses},widget.mode="readWrite",widget.setMode=function(mode){if("readOnly"===mode)this.readOnlyResponse=this.getResponse(),this.$inputs.find(".input-box").each(function(){void 0===$(this).data("latex")&&$(this).data("latex",$(this).mathquill("mqLatex")).mathquill("latex",$(this).mathquill("latex")),$(this).addClass("readOnly")}),this.lastFocusedMathquill=$([]);else{if("readWrite"!==mode)return void this.eventCallback("Unrecognized mode (neither 'readOnly' nor 'readWrite'): '"+mode+"'");delete this.readOnlyResponse,this.$inputs.find(".input-box").each(function(){void 0!==$(this).data("latex")&&$(this).mathquill("latex",$(this).data("latex")).removeData("latex"),$(this).removeClass("readOnly")}),this.lastFocusedMathquill=this.$inputs.find(".mathquill-editable:first")}this.mode=mode,this.eventCallback("Set mode to '"+mode+"'")},widget.undo=function(){if(!this.undoStack.length)return this.eventCallback("Nothing to undo");this.ignorePushUndoState=!0,this.redoStack.push(this.undoState),this.undoState=this.setLatexResponses(this.undoStack.pop()),1===this.redoStack.length&&this.$redo.prop("disabled",!1),0===this.undoStack.length&&this.$undo.prop("disabled",!0),this.ignorePushUndoState=!1,this.eventCallback("Undid")},widget.redo=function(){if(!this.redoStack.length)return this.eventCallback("Nothing to redo");this.ignorePushUndoState=!0,this.undoStack.push(this.undoState),this.undoState=this.setLatexResponses(this.redoStack.pop()),1===this.undoStack.length&&this.$undo.prop("disabled",!1),0===this.redoStack.length&&this.$redo.prop("disabled",!0),this.ignorePushUndoState=!1,this.eventCallback("Redid")},widget.mathmlFromLatex=function(latex){return AMparseMath(latex)},window.ActiveXObject||"ActiveXObject"in window){var xsltTree=new ActiveXObject("Msxml2.DOMDocument.6.0");xsltTree.async=!1,xsltTree.loadXML(xsltMathml);var srcTree=new ActiveXObject("Msxml2.DOMDocument.6.0");srcTree.async=!1,widget.latexFromMathml=function(math){return mathml=$(math).children("mstyle")[0],mathml.transformNode?mathml.transformNode(xsltTree):(srcTree.loadXML((new XMLSerializer).serializeToString(mathml)),srcTree.transformNode(xsltTree).replace(/\\space/g,"\\space "))}}else{var mathmlProcessor=new XSLTProcessor;mathmlProcessor.importStylesheet($.parseXML(xsltMathml)),widget.latexFromMathml=function(math){return mathml=$(math).children("mstyle")[0],mathmlProcessor.transformToFragment(mathml,document).textContent.replace(/\\space/g,"\\space ")}}});Widget.convertMathMlToLatex=function(mathml){if(window.ActiveXObject||"ActiveXObject"in window){var xsltTree=new ActiveXObject("Msxml2.DOMDocument.6.0");xsltTree.async=!1,xsltTree.loadXML(xsltMathml);var srcTree=new ActiveXObject("Msxml2.DOMDocument.6.0");return srcTree.async=!1,mathml=(new XMLSerializer).serializeToString(mathml),(mathml=$(mathml).children("mstyle")[0]).transformNode?mathml.transformNode(xsltTree):(srcTree.loadXML((new XMLSerializer).serializeToString(mathml)),srcTree.transformNode(xsltTree).replace(/\\space/g,"\\space "))}var mathmlProcessor=new XSLTProcessor;return mathmlProcessor.importStylesheet($.parseXML(xsltMathml)),mathml=$(mathml).children("mstyle")[0],mathmlProcessor.transformToFragment(mathml,document).textContent.replace(/\\space/g,"\\space ")},Widget.convertLatexToMathml=function(latex){return AMparseMath(latex)},function(){for(AMsymbols.sort(compareNames),i=0;i<AMsymbols.length;i++)AMnames[i]=AMsymbols[i].input}(),window.MathEditorWidget=Widget}(),function(CM){function Widget_EQ(wdgId,element,config){this.eq=null}function Widget_EQA(page,item,config){this.textAreaEl=null}CM.registerWidget("equationeditor",Widget_EQ,function(page,item){var id="EquationEditor_"+item.position,el=document.getElementById(id);return!(!el||page.getAccProps().hasBraille())&&new CM.WidgetConfig(id,el,item.rendererSpec)});var match_QTI=CM.QTI.createWidgetMatch("customInteraction","eq");CM.registerWidget("qti.eq",Widget_EQ,match_QTI),Widget_EQ.prototype.load=function(){this.page;var item=this.entity,containerEl=this.element,renderXml=this.config;"string"!=typeof renderXml&&(renderXml=Util.Xml.serializeToString(renderXml)),renderXml&&-1!=renderXml.indexOf("<editorRow>")||(renderXml=MathEditorContent.Config.EquationAdapter.convertToDesmosXml(renderXml));var renderDoc=MathEditorContent.Config.PreviewFormatter.getPreviewXmlDoc(renderXml),oldClasses=containerEl.getAttribute("class");containerEl.setAttribute("class",oldClasses+" no-highlight lr-skip");var eq=this.eq=MathEditorWidget(containerEl,renderDoc,function(msg){});null!=item.value&&item.setResponse(item.value);var eqComponent={id:"EQ_"+item.position,focus:function(){eq.focus()},blur:function(){eq.unfocus()}};item.addComponent(eqComponent),YUE.on(containerEl,"click",function(){item.setActiveComponent(eqComponent)}),item.isReadOnly()&&eq.setMode("readOnly")},Widget_EQ.prototype.getResponse=function(){var eq=this.eq;try{var val=eq.getResponse();val=Util.Xml.serializeToString(val);var isValid=eq.isValid();return this.createResponse(val,isValid)}catch(e){console.error("Failed to get a response for the EQ item.",eq,e)}return null},Widget_EQ.prototype.setResponse=function(value){try{if(value){var eq=this.eq,response=$.parseXML(value);eq.setResponse(response)}}catch(e){console.error("Faield to update the mathML with this value.",value,e)}},CM.registerWidget("equationeditor.text",Widget_EQA,function(page,item){var id="EquationEditor_"+item.position,el=document.getElementById(id);return!(!el||!page.getAccProps().hasBraille())&&new CM.WidgetConfig(id,el)}),Widget_EQA.prototype.load=function(){var item=this.entity,textAreaEl=HTML.TEXTAREA();textAreaEl.disabled=item.isReadOnly(),this.textAreaEl=textAreaEl,this.element.appendChild(textAreaEl),null!=item.value&&item.setResponse(item.value)},Widget_EQA.prototype.getResponse=function(){var text=this.textAreaEl.value,xmlDoc=Util.Xml.parseFromString('<response type="plaintext"></response>'),textNode=xmlDoc.createTextNode(text);xmlDoc.documentElement.appendChild(textNode);var value=Util.Xml.serializeToString(xmlDoc),isValid=text.length>0;return this.createResponse(value,isValid)},Widget_EQA.prototype.setResponse=function(value){value=(value=(value=value.replace("<![CDATA[","")).replace("]]&gt;","")).replace("]]>","");var text="",xmlDoc=Util.Xml.parseFromString(value);xmlDoc&&xmlDoc.documentElement&&xmlDoc.documentElement.childNodes[0]&&(text=Util.Xml.getNodeText(xmlDoc.documentElement.childNodes[0])),this.textAreaEl.value=text}}(window.ContentManager);var TDS=window.TDS||{},CSS_LR_CLASSNAME="lr-enabled";TDS.LineReaderControl={Instance:null,toggle:function(){TDS.LineReaderControl.Instance?TDS.LineReaderControl.off():TDS.LineReaderControl.on()},on:function(el){if(!TDS.LineReaderControl.Instance){var page=ContentManager.getCurrentPage(),item=ContentManager.getCurrentEntity(),menu=ContentManager.Menu;page&&page.disableScroll(),item&&item.resetComponent(),menu&&menu.isShowing()&&menu.hide();var el=YAHOO.util.Selector.query("#contents")[0],root=YAHOO.util.Selector.query(".showing"),passages=YAHOO.util.Selector.query(".thePassage,.theQuestions",root[0]),stems=YAHOO.util.Selector.query(".stemContainer",root[0]),fin=YAHOO.lang.isArray(el)?el:passages.concat(stems);passages.length>0&&Util.Dom.sort(fin),$(document.body).addClass(CSS_LR_CLASSNAME);var lr=new TDS.LineReader(fin);lr.selectFirst(),TDS.LineReaderControl.Instance=lr}},off:function(){if(TDS.LineReaderControl.Instance){if(window.ContentManager){var page=ContentManager.getCurrentPage();page&&page.enableScroll()}$(document.body).removeClass(CSS_LR_CLASSNAME),TDS.LineReaderControl.Instance.dispose(),delete TDS.LineReaderControl.Instance,TDS.LineReaderControl.Instance=null}},reset:function(){TDS.LineReaderControl.Instance&&(TDS.LineReaderControl.off(),TDS.LineReaderControl.on())},setupEvents:function(){window.ContentManager&&(ContentManager.onItemEvent("zoom",TDS.LineReaderControl.reset),ContentManager.onItemEvent("hide",TDS.LineReaderControl.off),ContentManager.onPageEvent("hide",TDS.LineReaderControl.off),ContentManager.onEntityEvent("menushow",TDS.LineReaderControl.off),ContentManager.onEntityEvent("passageExpandCollapse",TDS.LineReaderControl.reset))}},YAHOO.util.Event.onDOMReady(function(){TDS.LineReaderControl.setupEvents()}),TDS.LineReader=function(el){var that=this;this.TheLine,this._parsers=[],this._arguments=arguments,this._linesList=[],this._parentContainers,this._textContainers=[],this._ignoreContainers=[],this._scrollableContainers=[],this._parentWindow=window,this._activeLineIndex=-1,this._savedBackgroundColor="transparent",this._bgActiveClassName="TDS_Line_Reader_bgActive",this._onLineMove=new YAHOO.util.CustomEvent("onLineMove"),this._settings={lineColor:"rgba(0, 191, 243, 0.2)",lineBorder:"none",lineID:"#theLine",lineZIndex:"-1",debug:!1,onLineMove:null},this.line=function(){this.element=null,this.top=0,this.width=0,this.height=0,this.bottom=0},this._hasSingleImageOrMath=function(parEl){var imgLen=$("img",parEl).length,mathLen=$("math",parEl).length,brCount=$("br",parEl).length,childrenCount=$(parEl).children().length;return!(!$(parEl).is("p")||1!=childrenCount&&(2!=childrenCount||1!=brCount)||1!=imgLen&&1!=mathLen)},this._hasFitImageOrMath=function(parEl,lnHeight){var img=$("img",parEl),math=$("math",parEl),imgLen=img.length,mathLen=math.length,imgHeight=1==imgLen?img[0].clientHeight:null,mathHeight=1==mathLen?math[0].clientHeight:null,heightLimit=2.5*lnHeight;return!(imgHeight>heightLimit||mathHeight>heightLimit)},this._findElements=function(el){var _foundElementsArray=[];return YAHOO.util.Dom.getElementsBy(function(x){if($(x).closest("div.itemContainer.hiding").length||$(x).closest(".lr-skip").length>0)return!1;var overflow=$(x.parentNode).css("overflow").toLowerCase();"auto"!==overflow&&"scroll"!==overflow||that._scrollableContainers.push(x.parentNode),overflow=null;var p=that._get_parser(x.nodeName);return!!p&&p._criteria.call(that,x)},"",el,function(x){-1===that._ignoreContainers.indexOf(x)&&-1===_foundElementsArray.indexOf(x)&&_foundElementsArray.push(x)}),_foundElementsArray},this._processElement=function(el){var p=that._get_parser(el.nodeName);p&&p._processLines instanceof Function&&p._processLines.call(this,el)},this._selectLineAt=function(index){if(this._linesList&&index>=0&&index<this._linesList.length){var l=this._linesList[index];this._activeLineIndex=this._linesList.indexOf(l),this._moveLine(l)}},this._findLine=function(el,Y){for(var i=0;i<this._linesList.length;i++){var l=this._linesList[i];if((l.element===el||($(el).is("img")||$(el).is("math"))&&1==$(l.element).has(el).length)&&l.top<Y&&l.bottom>Y)return l}return null},this._moveLine=function(line){if(line){var le=$(line.element);if(this._hasSingleImageOrMath(line.element))$(this.TheLine).is(":visible")&&$(this.TheLine).hide(),$("."+this._bgActiveClassName).removeClass(this._bgActiveClassName),le.addClass(this._bgActiveClassName);else{YAHOO.util.Dom.getXY(line.element)[1];$("."+this._bgActiveClassName).removeClass(this._bgActiveClassName),YAHOO.util.Dom.setStyle(this.TheLine,"top",line.top+"px"),YAHOO.util.Dom.setStyle(this.TheLine,"left",line.left),YAHOO.util.Dom.setStyle(this.TheLine,"height",line.height+"px"),YAHOO.util.Dom.setStyle(this.TheLine,"width",line.width),YAHOO.util.Dom.addClass(this.TheLine,"TDS_Line_Reader_Active"),"none"===YAHOO.util.Dom.getStyle(this.TheLine,"display")&&YAHOO.util.Dom.setStyle(this.TheLine,"display","block"),line.element.appendChild(this.TheLine)}this._onLineMove.fire()}},this._hideLine=function(){var ln=this._linesList[this._activeLineIndex];this._activeLineIndex>-1&&ln&&"TR"===ln.element.nodeName?YAHOO.util.Dom.setStyle(ln.element,"background-color",that._savedBackgroundColor):ln&&YAHOO.util.Dom.setStyle(that.TheLine,"display","none")},this._initialize=function(){this._linesList=[],this._textContainers=[],this._scrollableContainers=[],this._activeLineIndex=-1;for(var textContArray=[],i=0;i<this._parentContainers.length;++i){var els=this._findElements.call(this,this._parentContainers[i]);els&&els.length&&(textContArray=textContArray.concat(els))}for(var j=0;j<textContArray.length;j++)-1===this._textContainers.indexOf(textContArray[j])&&this._textContainers.push(textContArray[j]);textContArray=null;for(i=0;i<this._textContainers.length;i++)this._processElement(this._textContainers[i]);for(i=0;i<this._textContainers.length;i++){var p=that._get_parser(this._textContainers[i].nodeName);p&&p._onClick&&YAHOO.util.Event.on(this._textContainers[i],"click",p._onClick,null,this)}if(this._onKeyDownRef=YAHOO.util.Event.on(this._parentContainers[0].ownerDocument,"keydown",this._onArrowKeyPress,null,this),this._settings.onLineMove&&this._onLineMove.subscribe(this._settings.onLineMove),this._createLine(),this._settings.debug)for(i=0;i<this._linesList.length;i++){var l=this._linesList[i];if("TR"!==l.element.nodeName){var div=document.createElement("div");div.id="LR_DEBUG_"+i,div.title="LR_DEBUG_"+i,div.className="LINERREADERDEBUGLINE",YAHOO.util.Dom.setStyle(div,"position","absolute"),YAHOO.util.Dom.setStyle(div,"top",l.top+"px"),YAHOO.util.Dom.setStyle(div,"height","1px"),YAHOO.util.Dom.setStyle(div,"width",l.width+"px"),l.EXP?YAHOO.util.Dom.setStyle(div,"background-color","#0f0"):YAHOO.util.Dom.setStyle(div,"background-color","#f00"),YAHOO.util.Dom.setStyle(div,"z-index","-1"),YAHOO.util.Dom.setStyle(div,"display","block"),l.element.appendChild(div)}else YAHOO.util.Dom.setStyle(l.element,"border","1px solid #00f")}},this._dispose=function(){for(i=0;i<this._textContainers.length;i++){var p=this._get_parser(this._textContainers[i].nodeName);p._onClick&&YAHOO.util.Event.removeListener(this._textContainers[i],"click",p._onClick)}YAHOO.util.Event.removeListener(this._parentContainers[0].ownerDocument,"keydown",this._onArrowKeyPress);for(var elements=YAHOO.util.Selector.query(".TDS_Line_Reader"),j=0;j<elements.length;++j){var el=elements[j];el&&el.parentNode&&"function"==typeof el.parentNode.removeChild&&el.parentNode.removeChild(el)}for(i=0;i<this._linesList.length;i++)for(var l=this._linesList[i],debugLines=YAHOO.util.Dom.getChildrenBy(l.element,function(x){return"LINERREADERDEBUGLINE"===x.className}),j=0;j<debugLines.length;j++)l.element.removeChild(debugLines[j]);$("."+this._bgActiveClassName).removeClass(this._bgActiveClassName);for(var elRelative=YAHOO.util.Selector.query(".TDS_Line_Reader_Relative_Pos"),i=0;i<elRelative.length;++i)YAHOO.util.Dom.removeClass(elRelative[i],"TDS_Line_Reader_Relative_Pos")},this._createLine=function(){this.TheLine=YAHOO.util.Selector.query(this._settings.lineID).length>0?YAHOO.util.Selector.query(this._settings.lineID)[0]:document.createElement("div"),0===YAHOO.util.Selector.query(this._settings.lineID).length&&this.TheLine.setAttribute("id",this._settings.lineID.replace("#","")),YAHOO.util.Dom.addClass(this.TheLine,"TDS_Line_Reader")},this._applySettings=function(settings){return settings&&(settings.lineColor&&(this._settings.lineColor=settings.lineColor),settings.lineBorder&&(this._settings.lineBorder=settings.lineBorder),settings.lineID&&(this._settings.lineID=settings.lineID),settings.lineZIndex&&(this._settings.lineZIndex=settings.lineZIndex),settings.onLineMove&&(this._settings.onLineMove=settings.onLineMove),"boolean"==typeof settings.debug&&(this._settings.debug=settings.debug)),!0},this._add_parser=function(parserObj){this._parsers.push(parserObj)},this._get_parser=function(nodeName){for(var i=0;i<this._parsers.length;i++){var nodeNames=[];this._parsers[i]._nodeName.indexOf(",")>-1?nodeNames=this._parsers[i]._nodeName.split(","):nodeNames.push(this._parsers[i]._nodeName);for(var j=0;j<nodeNames.length;j++)if(nodeNames[j].toUpperCase()===nodeName)return nodeNames=null,this._parsers[i]}return null},this._getSuperScriptOffset=function(el,fontSize){var measurement1=0,measurement1=0,experimentDiv=document.createElement("div");experimentDiv.id="SUPERSCRIPT_TEST",experimentDiv.innerHTML="this is a test",YAHOO.util.Dom.setStyle(experimentDiv,"font-size","inherit"),YAHOO.util.Dom.setStyle(experimentDiv,"line-height","inherit");var experimentSpan1=document.createElement("span");experimentSpan1.innerHTML="1",YAHOO.util.Dom.setStyle(experimentSpan1,"vertical-align","super"),YAHOO.util.Dom.setStyle(experimentSpan1,"font-size",fontSize);var experimentSpan2=document.createElement("span");experimentSpan2.innerHTML="2",YAHOO.util.Dom.setStyle(experimentSpan1,"font-size",fontSize),experimentDiv.appendChild(experimentSpan1),experimentDiv.appendChild(experimentSpan2),el.appendChild(experimentDiv),measurement1=YAHOO.util.Dom.getY(experimentSpan2),YAHOO.util.Dom.setStyle(experimentSpan1,"vertical-align","bottom"),measurement2=YAHOO.util.Dom.getY(experimentSpan2);var diff=parseFloat(measurement1)-parseFloat(measurement2)+1;return el.removeChild(experimentDiv),diff},this._textContainerOnClick=function(e){var target=e.target||e.srcElement;if("P"!=target.nodeName){var itemBoundary=$(this._parentContainers[0]).parent().get(0);target=$(target).closest("p",itemBoundary).get(0)}var Y=YAHOO.util.Event.getXY(e)[1];Y-=YAHOO.util.Region.getRegion(target).top;var l=this._findLine(target,Y);l&&(this._activeLineIndex=this._linesList.indexOf(l),this._moveLine(l))},this.up=function(){this._activeLineIndex>0&&(pOff=this._get_parser(this._linesList[this._activeLineIndex].element.nodeName),pOff._onLineExit.call(this,this._linesList[this._activeLineIndex])),this._activeLineIndex-1>=0&&(this._activeLineIndex=this._activeLineIndex-1,pOn=this._get_parser(this._linesList[this._activeLineIndex].element.nodeName),pOn._onLineEnter.call(this,this._linesList[this._activeLineIndex]))},this.down=function(){this._activeLineIndex>-1&&this._activeLineIndex<this._linesList.length-1&&(pOff=this._get_parser(this._linesList[this._activeLineIndex].element.nodeName),pOff._onLineExit.call(this,this._linesList[this._activeLineIndex])),this._activeLineIndex<this._linesList.length-1&&(this._activeLineIndex=this._activeLineIndex+1,pOn=this._get_parser(this._linesList[this._activeLineIndex].element.nodeName),pOn._onLineEnter.call(this,this._linesList[this._activeLineIndex]))},this._onArrowKeyPress=function(e){if(38===e.keyCode||40===e.keyCode){YAHOO.util.Event.stopEvent(e);e.target||e.srcElement,this._parentWindow.pageYOffset;for(var scrollParent=null,i=0;i<this._scrollableContainers.length;i++)if(this._activeLineIndex>-1&&YAHOO.util.Dom.isAncestor(this._scrollableContainers[i],this._linesList[this._activeLineIndex].element)){scrollParent=this._scrollableContainers[i];break}38===e.keyCode&&this.up(),40===e.keyCode&&this.down();var currentLinePostion=YAHOO.util.Dom.getY(this.TheLine)-YAHOO.util.Dom.getY(scrollParent),bottomofViewableArea=(YAHOO.util.Dom.getY(scrollParent),parseInt(YAHOO.util.Dom.getStyle(scrollParent,"height")));(currentLinePostion<1||currentLinePostion+44>bottomofViewableArea)&&this.TheLine.scrollIntoView(!0)}};var par=new TDS.LineReader.Parser("P,DIV,LI"),exclude={TD:!0,BUTTON:!0,H:!0},excludeClasses=["prompt","format_wb"],excludeClass=function(el){for(var i=0;i<excludeClasses.length;++i)if(el&&YAHOO.util.Dom.hasClass(el,excludeClasses[i]))return!0},hasSingleImageOrMath=this._hasSingleImageOrMath,dfsText=function(x){if(!excludeClass(x)){var parEles=YAHOO.util.Dom.getAncestorBy(x,function(e){return!0});if(!exclude[parEles.nodeName]&&!excludeClass(parEles)||"TD"==parEles.nodeName&&0==$(parEles).siblings().length)for(var i=0;i<x.childNodes.length;i++){var cn=x.childNodes[i],nv="string"==typeof cn.nodeValue?cn.nodeValue.trim():"";if(3===cn.nodeType&&nv.length>0){if(x.offsetWidth&&x.offsetHeight)return!0}else if("SPAN"==cn.nodeName){if(cn.textContent.trim()||!x.childNodes[i+1])return dfsText(cn)}else if(hasSingleImageOrMath(x)&&($(cn).is("img")||$(cn).is("math")))return!0}}};par._criteria=function(x){var parent=x.parentNode;return"P"!=x.nodeName||"TH"!=parent.nodeName&&"TD"!=parent.nodeName?dfsText(x):("TD"==parent.nodeName||"TH"==parent.nodeName)&&0==$(parent).siblings().length&&dfsText(x)},par._processLines=function(el){var el_h=el.clientHeight,el_w=el.clientWidth,el_y=YAHOO.util.Dom.getY(el),el_left=$(el).css("text-indent"),el_padding=parseInt(YAHOO.util.Dom.getStyle(el,"padding-top")),ln_height=0,el_line_height=$(el).css("line-height"),el_font_size=YAHOO.util.Dom.getStyle(el,"font-size"),pfel_lh=parseFloat(el_line_height),pfel_fs=parseFloat(el_font_size);ln_height=isNaN(pfel_lh)?1.25*pfel_fs:el_line_height.indexOf("%")>-1?pfel_fs*(pfel_lh/100):el_line_height.indexOf("in")>-1?1.25*pfel_fs:pfel_lh;var curr_pos=0,pos=YAHOO.util.Dom.getStyle(el,"position");"SPAN"===el.nodeName&&(el_h=ln_height),"relative"!==pos.toLowerCase()&&"absolute"!==pos.toLowerCase()&&YAHOO.util.Dom.addClass(el,"TDS_Line_Reader_Relative_Pos");for(var foundSpans=YAHOO.util.Dom.getElementsBy(function(fel){return"baseline"!==YAHOO.util.Dom.getStyle(fel,"vertical-align")},"span",el),spansArray=[],i=0;i<foundSpans.length;i++){var topY=YAHOO.util.Dom.getY(foundSpans[i])-el_y,bottom=topY+2;spansArray.push({obj:foundSpans[i],bottom:bottom,height:2,topY:topY,left:YAHOO.util.Dom.getX(foundSpans[i])})}for(var ssOffset=0,curSuperOffset=spansArray.length>0?that._getSuperScriptOffset(el,YAHOO.util.Dom.getStyle(spansArray[0].obj,"font-size")):0;curr_pos<el_h&&!(el_h-curr_pos<ln_height/2);){var linObj=new that.line;linObj.height=el_h-curr_pos>ln_height?ln_height:el_h-curr_pos,linObj.width=el_w,linObj.top=curr_pos+el_padding+ssOffset,linObj.element=el,linObj.bottom=linObj.top+linObj.height,linObj.left=el_left||0;for(i=0;i<spansArray.length;i++)if(spansArray[i].bottom>linObj.top&&spansArray[i].bottom<linObj.bottom){linObj.height+=curSuperOffset,linObj.EXP=!0,ssOffset+=curSuperOffset;break}if(this._hasSingleImageOrMath(el)){if(!this._hasFitImageOrMath(el,ln_height))break;curr_pos+=el_h}else curr_pos+=ln_height;if(this._linesList.push(linObj),"TR"===el.nodeName)break}},par._onClick=function(e){this._textContainerOnClick(e)},par._onLineEnter=function(line){this._moveLine(line)},par._onLineExit=function(line){},this._add_parser(par),(par=new TDS.LineReader.Parser("TR"))._criteria=function(x){return!0},par._processLines=function(el){var linObj=new that.line;linObj.height=0,linObj.width=0,linObj.top=0,linObj.element=el,linObj.bottom=0,this._linesList.push(linObj)},par._onClick=function(e){var target=e.target||e.srcElement;"TD"!==target.nodeName&&"P"!==target.nodeName&&"DIV"!==target.nodeName&&"SPAN"!==target.nodeName||(target=YAHOO.util.Dom.getAncestorByTagName(target,"TR"));for(var i=0;i<this._linesList.length;i++)if(this._linesList[i].element===target){this._activeLineIndex=i;break}YAHOO.util.Dom.addClass(target,"TDS_Line_Reader_Active"),this._onLineMove.fire()},par._onLineEnter=function(line){that.TheLine&&(YAHOO.util.Dom.setStyle(that.TheLine,"display","none"),that._settings.lineColor=YAHOO.util.Dom.getStyle(that.TheLine,"background-color")),YAHOO.util.Dom.setStyle(line.element,"background-color",that._settings.lineColor)},par._onLineExit=function(line){YAHOO.util.Dom.setStyle(line.element,"background-color",that._savedBackgroundColor)},this._parentContainers=YAHOO.lang.isArray(arguments[0])?arguments[0]:[arguments[0]];for(var i=1;i<arguments.length;i++)if(arguments[i]){if(arguments[i].lineColor||arguments[i].lineBorder||arguments[i].lineID||arguments[i].lineZIndex||arguments[i].debug||arguments[i].onLineMove,arguments[i].toString().toLowerCase().indexOf("window")>-1&&(this._parentWindow=arguments[i]),arguments[i].toString().toLowerCase().indexOf("nodelist")>-1||arguments[i].toString().toLowerCase().indexOf("htmlcollection")>-1)for(j=0;j<arguments[i].length;j++)this._ignoreContainers.push(arguments[i][j]);if(arguments[i]instanceof Array)for(var j=0;j<arguments[i].length;j++)this._add_parser(arguments[i][j])}return this._initialize(),{obj:this,dispose:function(){return that._dispose.call(that),!0},refresh:function(){return that.TheLine||that._dispose.call(that),that._initialize.call(that),!0},applySettings:function(settings){return that._applySettings.call(that,settings),that._dispose.call(that),that._initialize.call(that),!0},settings:this._settings,addParser:function(p){return that._add_parser.call(that,p),that._dispose.call(that),that._initialize.call(that),!0},selectFirst:function(){that._selectLineAt(0)},parsers:this._parsers}},TDS.LineReader.Parser=function(nodeName){this._nodeName=nodeName.toUpperCase(),this._criteria={},this._processLines={},this._onClick={},this._onLineEnter={},this._onLineExit={}},function(exports){function SlideshowManager(){this._labels={play:"Play Slideshow",stop:"Stop Slideshow",prev:"Previous Slide",next:"Next Slide"},this._slideshowFactory=new SlideshowFactory(this),this._slideshows=[]}function SlideshowFactory(slideshowManager){this._slideshowManager=slideshowManager}function Slide(slideshow,beginTime,content){this.slideshow=slideshow,this.beginTime=beginTime,this.content=content}function Slideshow(slideshowManager,configElement,audioElement){this.id="slideshow"+ ++_slideshowId,this.slideshowManager=slideshowManager,this.element=configElement,this.slides=[],this._currentIndex=0,audioElement&&(this.audioId=audioElement.id=audioElement.id||this.id+"_audio",TDS.Audio.Player.createSoundFromElement(this.audioId)&&TDS.Audio.Player.onTimeUpdate[this.audioId].subscribe(function(time){this._updateSlideForTime(time)}.bind(this))),this._isRendered=!1,this._isPlaying=!1}SlideshowManager.prototype.setAriaLabels=function(labels){this._labels=labels},SlideshowManager.prototype.getAriaLabels=function(){return this._labels},SlideshowManager.prototype.getFactory=function(){return this._slideshowFactory},SlideshowManager.prototype.findAndBuildSlideshows=function(elementOrId){var slideshows=this.getFactory().findAndBuildSlideshows(elementOrId);return Array.prototype.push.apply(this._slideshows,slideshows),slideshows},SlideshowManager.prototype.stopAll=function(){this._slideshows.forEach(function(slideshow){slideshow.stop()})},SlideshowManager.prototype.api={SlideshowManager:SlideshowManager,SlideshowFactory:SlideshowFactory,Slide:Slide,Slideshow:Slideshow},SlideshowFactory.prototype.findSlideshowNodes=function(elementOrId){var element="string"==typeof elementOrId?document.getElementById(elementOrId):elementOrId,nodes=(element=element instanceof Element?element:document).querySelectorAll(".slides_config");return Array.prototype.slice.call(nodes)},SlideshowFactory.prototype.findSlideNodes=function(slideshowElement){var nodes=slideshowElement.querySelectorAll(".slide");return Array.prototype.slice.call(nodes)},SlideshowFactory.prototype.findSlideshowAudio=function(slideshowElement){return slideshowElement.querySelector(".slides_audio")||null},SlideshowFactory.prototype.parseBeginTime=function(beginTime){var seconds=0;if(6===beginTime.length){var ss=parseInt(beginTime.substring(4,6),10),mm=parseInt(beginTime.substring(2,4),10),hh=parseInt(beginTime.substring(0,2),10);ss<60&&mm<60&&(seconds=3600*hh+60*mm+ss)}return 0===seconds&&(seconds=parseInt(beginTime,10)),seconds},SlideshowFactory.prototype.buildSlideshow=function(slideshowElement){var slideElements=this.findSlideNodes(slideshowElement),audioElement=this.findSlideshowAudio(slideshowElement),self=this,slideshow=new Slideshow(this._slideshowManager,slideshowElement,audioElement);return slideElements.forEach(function(slideElement){var beginTime=self.parseBeginTime(slideElement.getAttribute("data-begin"));slideshow.addSlide(beginTime,slideElement)}),slideshow},SlideshowFactory.prototype.findAndBuildSlideshows=function(elementOrId){var self=this,slideshows=this.findSlideshowNodes(elementOrId).map(function(slideshowElement){return self.buildSlideshow(slideshowElement)});return slideshows.forEach(function(slideshow){slideshow.render()}),slideshows},Slide.prototype.show=function(){this.content.classList.remove("hidden")},Slide.prototype.hide=function(){this.content.classList.add("hidden")},Slide.prototype.isVisible=function(){return!this.content.classList.contains("hidden")};var _slideshowId=0;Slideshow.prototype._updateSlideForTime=function(time){for(var i=0;i<this.slides.length&&this.slides[i].beginTime<=time;++i);var newIndex=Math.max(0,Math.min(i-1,this.slides.length-1)),willChange=newIndex!=this._currentIndex,newSlide=this.slides[newIndex];willChange&&time>=newSlide.beginTime&&this._setSlideByIndex(newIndex,!1)},Slideshow.prototype.getDuration=function(){return TDS.Audio.Player.getDuration(this.audioId)},Slideshow.prototype.addSlide=function(beginTime,content){if(this._isRendered)throw new Error("slideshow has already been rendered");var index,i,slide=new Slide(this,beginTime,content);for(i=0;i<this.slides.length&&this.slides[i].beginTime<=beginTime;index=++i);return this.slides.splice(index,0,slide),slide},Slideshow.prototype.render=function(){if(!this._isRendered){this._isRendered=!0,this.element.classList.remove("hidden"),this.slides.length&&(this.hideAll(),this.slides[0].show());var container=document.createElement("span");container.className="slide_controls_contain",container.setAttribute("aria-controls",this.id),this.element.appendChild(container),this._createControls(container),this._createSlider(container)}},Slideshow.prototype._createControls=function(container){var labels=this.slideshowManager.getAriaLabels(),prev=document.createElement("span");prev.className="slide_controls_btn slide_controls_prev_btn",prev.setAttribute("aria-label",labels.prev),container.appendChild(prev);var play=document.createElement("span");play.className="slide_controls_btn slide_controls_play_btn",play.setAttribute("aria-label",labels.play),container.appendChild(play);var pause=document.createElement("span");pause.className="slide_controls_btn slide_controls_stop_btn hidden",pause.setAttribute("aria-label",labels.stop),container.appendChild(pause);var next=document.createElement("span");next.className="slide_controls_btn slide_controls_next_btn",next.setAttribute("aria-label",labels.next),container.appendChild(next);var self=this;this.audioId&&TDS.Audio.Player.onFinish.subscribe(function(id){id==this.audioId&&(pause.classList.add("hidden"),play.classList.remove("hidden"))}.bind(this)),prev.addEventListener("click",function(){self.goPrev()},!1),play.addEventListener("click",function(){self.play(),pause.classList.remove("hidden"),play.classList.add("hidden")},!1),pause.addEventListener("click",function(){self.pause(),pause.classList.add("hidden"),play.classList.remove("hidden")},!1),next.addEventListener("click",function(){self.goNext()},!1)},Slideshow.prototype._createSlider=function(container){this.slider=TDS.Audio.Widget.createScrubber(this.audioId),this.slider.render(container,190),this.slider.onChange.subscribe(function(time){this._updateSlideForTime(time)}.bind(this))},Slideshow.prototype.hideAll=function(){this.slides.forEach(function(slide){slide.hide()})},Slideshow.prototype.play=function(){this.audioId&&(this._isPaused?TDS.Audio.Player.resume(this.audioId):TDS.Audio.Player.play(this.audioId)),this._isPlaying=!0,this._isPaused=!1},Slideshow.prototype.pause=function(){this.audioId&&TDS.Audio.Player.pause(this.audioId),this._isPlaying=!1,this._isPaused=!0},Slideshow.prototype.stop=function(){this.audioId&&TDS.Audio.Player.stop(this.audioId),this._isPlaying=!1,this._isPaused=!1},Slideshow.prototype.getCurrent=function(){return this.slides[this._currentIndex]},Slideshow.prototype._setSlideByIndex=function(index,seekAudio){if("number"==typeof index){this._currentIndex=index,this.hideAll();var currentSlide=this.getCurrent();currentSlide.show(),seekAudio&&this._setPosition(currentSlide.beginTime)}},Slideshow.prototype._setPosition=function(time){TDS.Audio.Player.setPosition(this.audioId,time)},Slideshow.prototype.setSlide=function(index,resetIfCurrentSlide){index=Math.min(index,this.slides.length-1),((index=Math.max(index,0))!==this._currentIndex||resetIfCurrentSlide)&&this._setSlideByIndex(index,!0)},Slideshow.prototype.goPrev=function(){var slideIndex,position=TDS.Audio.Player.getPosition(this.audioId);slideIndex=this.getCurrent().beginTime+2<position?this._currentIndex:this._currentIndex-1,this.setSlide(slideIndex,!0)},Slideshow.prototype.goNext=function(){this.setSlide(this._currentIndex+1,!1)},exports.slideshows=new SlideshowManager}(window),ContentManager.onPageEvent("loaded",function(page){if(page&&window.slideshows){var doc=page.getElement();doc&&slideshows.findAndBuildSlideshows(doc)}}),ContentManager.onPageEvent("hide",function(page){page&&window.slideshows&&slideshows.stopAll()}),TDS=window.TDS||{};var YUD=YAHOO.util.Dom;TDS.Mask={Config:{minH:0,minW:5,Debug:!0,Enabled:!0,altEventName:"",eventName:"",cls:{INIT:"tds_mask_init",MOVE:"tds_mask_move",FIN:"tds_mask_fin"},DialogClass:"TDS.Mask.Dialog",EnableClickClass:!0,ClickClasses:["thePassage","theQuestions","layoutColumnLeft","layoutColumnRight","itemContainer"],isScrollable:function(el){return!0===YUD.hasClass(el,"thePassage")||!0===YUD.hasClass(el,"theQuestions")},isTouchScreen:"ontouchstart"in window},EVENTS:null,CONTROL:null,STATUS:"off",PAGE:null,initialize:function(){var ctrl=new TDS.Mask.Control;ctrl.setDialogClass(TDS.Mask.Config.DialogClass),TDS.Mask.CONTROL=ctrl;var em=new TDS.Mask.EventManager;em.setControl(ctrl),TDS.Mask.EVENTS=em},getControl:function(){return TDS.Mask.CONTROL},getEvents:function(){return TDS.Mask.EVENTS},setPageDom:function(pageDom){TDS.Mask.PAGE=pageDom},setPageId:function(pageId){var ctrl=TDS.Mask.getControl();if(ctrl){var pId=ctrl.getActivePageId();ctrl.setActivePageId(pageId),pId!=pageId&&ctrl.off()}},create:function(pageDom,pageId,evt){var ctrl=TDS.Mask.getControl();ctrl&&(pageDom=pageDom||TDS.Mask.PAGE,ctrl.newMask(pageDom,pageId,evt),this.on(null,pageId),this.STATUS="on")},on:function(id,pageId,win){win=win||window;var ctrl=TDS.Mask.getControl();if(ctrl){id||pageId?ctrl.on({id:id,pageId:pageId}):ctrl.on();var eM=TDS.Mask.getEvents();eM&&(eM.setPageId(pageId),eM.listen(TDS.Mask.PAGE))}},off:function(id,pageId){var ctrl=TDS.Mask.getControl();ctrl&&(ctrl.off({id:id,pageId:pageId}),this.STATUS="off")},hide:function(id,pageId){var ctrl=TDS.Mask.getControl();ctrl&&(ctrl.hide({id:id,pageId:pageId}),this.getEvents().sleep(),this.STATUS="off")},clear:function(instanceOrId){},toggle:function(){"off"===this.STATUS?this.create():this.off()}},function(){var YUD=YAHOO.util.Dom,CFG=TDS.Mask.Config||{};TDS.Mask.Control=function(args){args=args||{},this.setActivePageId(args.pageId),this.setDialogClass(args.dialogClass||TDS.Mask.Config.DialogClass),this._maskInCreation=null,this.sequence=0},C=TDS.Mask.Control,C.prototype.setDialogClass=function(str){if("string"==typeof str){for(var cmp=str.split("."),ref=window,i=0;i<cmp.length;++i)ref[cmp[i]]&&(ref=ref[cmp[i]]);CFG.Debug&&console.log("lookup the class?",ref)}this._dialogClass=str},C.prototype.getScrollParent=function(el){if(el){for(var pScroll=CFG.isScrollable(el)?el:null;!pScroll&&el&&el.parentNode&&"BODY"!=!el.nodeName;)el=el.parentNode,CFG.isScrollable(el)&&(pScroll=el);return pScroll}},C.prototype.genId=function(){return"tds_mask_"+this.sequence++},C.prototype.createMask=function(page,x,y,w,h,debugMsg){var dialog=null,id=this.genId();if("function"==typeof this._dialogClass)(dialog=new this._dialogClass(x,y,w,h,debugMsg)).id=id,dialog.close=this.close.bind(this,id);else{(dialog=document.createElement("div")).id=id,dialog.innerHTML=debugMsg||"",YUD.addClass(dialog,"tds_mask_container");var close=document.createElement("button");close.innerHTML="x",close.onclick=this.close.bind(this,id),YUD.addClass(close,"tds_mask_close"),dialog.appendChild(close),CFG.Debug&&console.log("createMask div (page, dialog, x, y, w, h)",page,dialog,x,y,w,h),YUD.setStyle(dialog,"position","fixed"),YUD.setStyle(dialog,"left",x+"px"),YUD.setStyle(dialog,"top",y+"px"),YUD.setStyle(dialog,"width",w+"px"),YUD.setStyle(dialog,"height",h+"px"),document.body.appendChild(dialog)}return dialog},C.prototype.close=function(id){console.log("Close this item.",id);var dialog=TDS.Mask.Store.get(id);dialog&&"function"==typeof dialog.close?(dialog.close(),delete dialog):dialog.parentNode&&dialog.parentNode.removeChild(dialog),TDS.Mask.Store.remove(id)},C.prototype.hide=function(optionalQuery){var masks=TDS.Mask.Store.query(optionalQuery);if(console.log("What came from masks?",masks),masks){for(var i=0;i<masks.length;++i){var mask=masks[i];mask&&"function"==typeof mask.hide?mask.hide():YUD.addClass(mask,"hidden")}this.removeIndicateDrawingContainer()}},C.prototype.show=function(optionalQuery){var masks=TDS.Mask.Store.query(optionalQuery);if(masks){CFG.Debug&&console.log("Should show these (masks, query)",masks,optionalQuery);for(var i=0;i<masks.length;++i){var mask=masks[i];mask&&"function"==typeof mask.show?mask.hide():YUD.removeClass(mask,"hidden")}}},C.prototype.on=function(query){try{query=query||{pageId:this.getActivePageId()},CFG.Debug&&console.log("TDS.Mask.Conrol.on with query: ",query),this.show(query)}catch(e){console.error("Failed to turn on the masks for this query.",query,e)}},C.prototype.off=function(query){try{console.log("Turn off the items.",query),this.removeAllListeners()}catch(e){console.error("Failed to turn off the masks for this query.",query)}this.removeIndicateDrawingContainer()},C.prototype.move=function(x,y,scrollDomSource,pageId){CFG.Debug&&console.log("Move the masks (x, y, el, pageId)",x,y,scrollDomSource,pageId),pageId=pageId||this.getActivePageId();var masks=TDS.Mask.Store.query({pageId:pageId});if(masks&&masks.length)for(var mask=null,i=0;i<masks.length;++i)if(mask=masks[i],scrollDomSource==mask.scrollDomSource&&mask.scrollDomSource){var initX=YUD.getAttribute(mask,"initialX"),initY=YUD.getAttribute(mask,"initialY");YUD.setStyle(mask,"top",initY-y+"px"),YUD.setStyle(mask,"left",initX-x+"px")}},C.prototype.newMask=function(page,pageId,evt){page=page||TDS.Mask.PAGE||document.body,(pageId=pageId||this.getActivePageId()||page.id)&&this.setActivePageId(pageId),CFG.Debug&&console.log("newMask (page, pageId, evt)",page,pageId,evt),this.removeAllListeners(),this.createListeners(this.getClickElements(page),this.initMaskClick.bind(this),"mousedown",CFG.cls.INIT)},C.prototype.getActiveMasks=function(){return TDS.Mask.Store.query({pageId:this.getActivePageId()})},C.prototype.getClickElements=function(page){if(!CFG.EnableClickClass)return[page];for(var cls=null,elements=[],i=0;i<CFG.ClickClasses.length;++i){cls=CFG.ClickClasses[i];var s=YAHOO.util.Selector.query("."+cls,page);s&&s.length&&(elements=elements.concat(s))}return elements.length||(elements=[page]),elements},C.prototype.stopEvt=function(evt){(evt=evt||window.event)&&(evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault?evt.preventDefault():evt.returnValue=!1)},C.prototype.createListeners=function(elements,func,evtName,cls){if(elements&&"function"==typeof func){YAHOO.lang.isArray(elements)||(elements=[elements]),evtName=evtName||"click",this.pageListeners||(this.pageListeners=[]);for(var el=null,listener=null,i=0;i<elements.length;++i)if(el=elements[i]){listener=function(el,cb,evt){cb(el,evt)}.bind(this,el,func);var lsnr=this.addMouseListener(el,evtName,listener);CFG.altEventName&&this.pageListeners.push({el:el,evtName:CFG.altEventName,listener:lsnr}),this.pageListeners.push({el:el,evtName:CFG.eventName,listener:lsnr}),cls&&YUD.addClass(el,cls)}return this.pageListeners}},C.prototype.addMouseListener=function(target,name,fn){var eventName,altEventName,touchScreen="ontouchstart"in window,touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},mouseEvents={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove"},getWindowsNTVersion=function(){var value,matches=navigator.userAgent.match(/Windows NT (\d+\.\d+)/);return matches&&matches[1]&&(value=parseFloat(matches[1])),value||0},normalizeTouchEvent=function(evt){if(evt.changedTouches)for(var touches=evt.changedTouches,i=0,ii=touches.length;i<ii;i++)if(touches[i].target==evt.target){var oldevt=evt;return evt=touches[i],evt.preventDefault=function(){return oldevt.preventDefault()},evt.stopPropagation=function(){return oldevt.stopPropagation()},evt}return evt},touchAndMouse=touchScreen&&(getWindowsNTVersion()>=6.1||window.navigator.userAgent.indexOf("CrOS")>-1);touchScreen?(eventName=touchEvents[name]||name,touchAndMouse&&(altEventName=mouseEvents[name]||name)):eventName=mouseEvents[name]||name;var processEvent=function(evt){touchAndMouse&&evt.preventDefault(),touchScreen&&(evt=normalizeTouchEvent(evt)),fn(evt)};return eventName&&(target.addEventListener(eventName,processEvent,!1),altEventName&&target.addEventListener(altEventName,processEvent,!1)),CFG.eventName=eventName,altEventName&&(CFG.altEventName=altEventName),processEvent},C.prototype.removeMaskClasses=function(elements){if(elements&&elements.length)for(var el=null,i=0;i<elements.length;++i)el=elements[i],YUD.removeClass(el,CFG.cls.INIT),YUD.removeClass(el,CFG.cls.MOVE),YUD.removeClass(el,CFG.cls.FIN)},C.prototype.removeAllListeners=function(){if(this.pageListeners)for(var i=0;i<this.pageListeners.length;++i)try{var cfg=this.pageListeners[i];cfg&&cfg.el&&cfg.listener&&(cfg.el.removeEventListener(cfg.evtName,cfg.listener,!1),this.removeMaskClasses([cfg.el]))}catch(e){CFG.Debug&&console.error("Failed to remove event listener. cfg, e",cfg,e)}this.pageListeners=null},C.prototype.initMaskClick=function(page,evt){this.stopEvt(evt),this.removeAllListeners(),this.firstClick=evt,CFG.isTouchScreen&&(this.firstClick={clientX:evt.clientX,clientY:evt.clientY}),this.createListeners(this.getClickElements(page),this.mouseMove.bind(this),"mousemove"),this.createListeners(this.getClickElements(page),this.mouseUp.bind(this),"mouseup",CFG.cls.MOVE)},C.prototype.mouseMove=function(page,evt){this.stopEvt(evt),this.firstClick&&this.indicateDrawing(this.firstClick,evt)},C.prototype.indicateDrawing=function(a,b){if(a&&b){var x=a.clientX<=b.clientX?a.clientX:b.clientX,y=a.clientY<=b.clientY?a.clientY:b.clientY,w=Math.abs(a.clientX-b.clientX),h=Math.abs(a.clientY-b.clientY),iDrawing=document.getElementById("indicateDrawingContainer");!iDrawing&&w>CFG.minW&&h>CFG.minH&&((iDrawing=document.createElement("div")).setAttribute("id","indicateDrawingContainer"),YUD.setStyle(iDrawing,"position","fixed"),YUD.addClass(iDrawing,"tds_mask_container tds_mask_container_drawing"),document.body.appendChild(iDrawing),this.createListeners(iDrawing,this.mouseMove.bind(this),"mousemove"),this.createListeners(iDrawing,this.mouseUp.bind(this),"mouseup",CFG.cls.MOVE)),YUD.setStyle(iDrawing,"left",x+"px"),YUD.setStyle(iDrawing,"top",y+"px"),YUD.setStyle(iDrawing,"width",w+"px"),YUD.setStyle(iDrawing,"height",h+"px")}},C.prototype.mouseUp=function(page,evt){this.determineBox(this.firstClick,evt)?this.finishMaskClick(page,evt):(this.removeAllListeners(),this.createListeners(this.getClickElements(page),this.finishMaskClick.bind(this),"mousedown",CFG.cls.FIN),CFG.isTouchScreen||this.createListeners(this.getClickElements(page),this.mouseMove.bind(this),"mousemove"))},C.prototype.finishMaskClick=function(page,evt){try{this.stopEvt(evt),this.removeAllListeners(),this.removeIndicateDrawingContainer(),this.secondClick=evt,CFG.Debug&&console.log("Finish mask click",page,this.firstClick,this.secondClick);var box=this.determineBox(this.firstClick,this.secondClick);box&&this.initializeBox(page,box),TDS.Mask.create()}catch(e){console.error("Cannot finish mask click.",e)}},C.prototype.removeIndicateDrawingContainer=function(){var iDrawing=document.getElementById("indicateDrawingContainer");iDrawing&&document.body.removeChild(iDrawing)},C.prototype.determineBox=function(a,b){if(a&&b){var box={tX:a.clientX<=b.clientX?a.clientX:b.clientX,tY:a.clientY<=b.clientY?a.clientY:b.clientY,bX:a.clientY<=b.clientX?b.clientX:a.clientX,bY:a.clientY<=b.clientX?b.clientY:a.clientY,w:Math.abs(a.clientX-b.clientX),h:Math.abs(a.clientY-b.clientY)};return box&&box.w>CFG.minW&&box.h>CFG.minH?box:void 0}},C.prototype.initializeBox=function(page,box){try{var dialog=this.createMask(page,box.tX,box.tY,box.w,box.h);if(dialog){var pScroll=this.getScrollParent(page);pScroll&&(box.tX+=pScroll.scrollLeft||0,box.tY+=pScroll.scrollTop||0,dialog.scrollDomSource=pScroll),YUD.setAttribute(dialog,"initialX",box.tX),YUD.setAttribute(dialog,"initialY",box.tY),dialog.pageId=this.getActivePageId()||page.id,TDS.Mask.Store.set(dialog)}}catch(e){console.error("Failed to initialize basic box model.",e)}},C.prototype.abortMask=function(){},C.prototype.setActivePageId=function(pageId){this._pageId=pageId},C.prototype.getActivePageId=function(){return this._pageId},TDS.Mask.Store={Instances:{},get:function(id){return TDS.Mask.Store.Instances[id]},remove:function(id){TDS.Mask.Store.Instances[id]&&delete TDS.Mask.Store.Instances[id]},set:function(obj,id){obj&&(obj.id||(obj.id=obj.id||id||"tds_mask_"+ ++TDS.Mask.Store.id),TDS.Mask.Store.Instances[id||obj.id]=obj)},match:function(q,obj){if(obj&&obj.id)return!(q.id&&"*"!=q.id&&-1==q.id.indexOf(obj.id)||q.pageId&&"*"!=q.pageId&&-1==q.pageId.indexOf(obj.pageId))||void 0},query:function(q,matchFunc){(q=q||{id:"*"})&&(q.id||q.pageId)&&(q.id&&"*"!=q.id&&!YAHOO.lang.isArray(q.id)&&(q.id=[q.id]),q.pageId&&!YAHOO.lang.isArray(q.pageId)&&(q.pageId=[q.pageId])),"function"!=typeof matchFunc&&(matchFunc=TDS.Mask.Store.match);var results=[];for(var k in TDS.Mask.Store.Instances)if(k&&"function"!=typeof k){var obj=TDS.Mask.Store.Instances[k];matchFunc(q,obj)&&results.push(obj)}return results}}}(),function(){var CFG=TDS.Mask.Config;TDS.Mask.EventManager=function(ctrl,doc){this._listeners=null,this.setControl(ctrl),this.setScrollDocument(doc)};var eM=TDS.Mask.EventManager;eM.prototype.getPageId=function(){return this._pageId},eM.prototype.setPageId=function(pageId){this._pageId=pageId},eM.prototype.getControl=function(){return this._ctrl},eM.prototype.setControl=function(ctrl){this._ctrl=ctrl},eM.prototype.setScrollDocument=function(doc){doc=doc||document,this._document=doc},eM.prototype.getScrollDocument=function(){return this._document||document.body},eM.prototype.isElScrollable=function(dom){if(dom){var hasHorizontalScrollbar=dom.scrollWidth>div.clientWidth,hasVerticalScrollbar=dom.scrollHeight>div.clientHeight;return!(!hasHorizontalScrollbar&&!hasVerticalScrollbar)&&{vertical:hasVerticalScrollbar,horizontal:hasHorizontalScrollbar}}},eM.prototype.applyScroll=function(x,y,scrollContainer){var ctrl=this.getControl();ctrl&&ctrl.move(x,y,scrollContainer)},eM.prototype.findScrollable=function(dom){return!(!dom||!CFG.isScrollable(dom))},eM.prototype.dfs=function(el,match,results){if(el){match="function"==typeof match?match:function(){return!0},results=results||[],match(el)&&results.push(el);var children=el.childNodes;if(children)for(var i=0;i<children.length;++i)this.dfs(children[i],match,results);return results}},eM.prototype.stopEvt=function(evt){(evt=evt||window.event)&&(evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault?evt.preventDefault():evt.returnValue=!1)},eM.prototype.scrollDiff=function(el,evt){try{var sD=this.getScrollDocument(),doc=sD&&sD.documentElement?sD.documentElement:document.documentElement,left=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),top=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),elTop=el?el.scrollTop:0,elLeft=el?el.scrollLeft:0;this.getControl().move(left+elLeft,top+elTop,el)}catch(e){console.error("Failed to scroll correctly.",e)}},eM.prototype.listen=function(docOrDom,cb,evtName){if(!this._listeners||!this._listeners.length){CFG.Debug&&console.log("What is in eventManager listen?",docOrDom,cb),evtName=evtName||"scroll",docOrDom=(docOrDom=docOrDom||this.getScrollDocument())&&docOrDom.body?docOrDom.body:docOrDom,cb="function"==typeof cb?cb:this.scrollDiff;var results=this.dfs(docOrDom,this.findScrollable);CFG.Debug&&console.log("Tried to find scrollable elements, results (docOrDom, results) ",docOrDom,results),results&&results.length||(results=[this.getScrollDocument()]),this._listeners=[];for(var i=0;i<results.length;++i){var el=results[i],listen=cb.bind(this,el);el.addEventListener(evtName,listen,!1),this._listeners.push({evtName:evtName,el:el,listen:listen})}}},eM.prototype.sleep=function(){if(this._listeners){for(var i=0;i<this._listeners.length;++i){var cfg=this._listeners[i];cfg&&cfg.el&&"function"==typeof cfg.listen&&cfg.el.removeEventListener(cfg.evtName,cfg.listen,!1)}this._listeners=null}}}(),YAHOO.util.Event.onDOMReady(function(){window.TDS&&!window.TDS.Mask||("TDS_Masking0"!=ContentManager.getAccommodationProperties().getSelectedCode("Masking")?(TDS.Mask.Config.Debug=!0,TDS.Mask.initialize(),ContentManager.onPageEvent("show",function(page){if(page){var doc=page.getElement(),pageId=page.id;TDS.Mask.setPageId(pageId),TDS.Mask.setPageDom(doc)}}),ContentManager.onPageEvent("hide",function(page){console.log("Turn of masking on a hide."),TDS.Mask.hide()})):console.warn("Masking not enabled."))}),EditItem="undefined"==typeof EditItem?{}:EditItem,EditItem.InteractionSet=function(){var self=this;this.interactions=[],this.forEachInteraction=function(ftor){for(var i=0;i<self.interactions.length;++i)ftor.call(this,self.interactions[i])},this.getInteraction=function(ctor){for(var i=0;i<self.interactions.length;++i)if(ctor.call(this,self.interactions[i]))return self.interactions[i];return null},this.push=function(interaction){self.interactions.push(interaction)},this.get=function(i){return self.interactions[i]},this.getResponse=function(){var isValid=!1,responseBody="";return this.forEachInteraction(function(interaction){isValid=isValid||interaction.getResponse().isValid,responseBody+=interaction.getResponse().responseBody}),{isValid:isValid,responseBody:"<testeeResponse>"+responseBody+"</testeeResponse>"}},this.setXmlResponse=function(xmlString){for(var valueNodes=Util.Xml.parseFromString(xmlString).getElementsByTagName("value"),i=0;valueNodes&&i<valueNodes.length;++i){var valueNode=valueNodes[i],responseIdentifier=valueNode.getAttribute("responseIdentifier"),matchInteraction=self.getInteraction(function(interaction){return interaction.getId()===responseIdentifier});if(matchInteraction){var value=EditItem.Html.Text.entityEncode(valueNode.textContent);matchInteraction.setXmlResponse(value)}}this.redisplay()}},EditItem.Interaction=function(parentIdentifier,identifier){this.getId=function(){return identifier},this.getParentId=function(){return parentIdentifier}},EditItem.Interaction.Choice=function(parentId,identifier,shuffle,inlineChoices){var self=this;this._inlineChoices=inlineChoices,EditItem.Interaction.call(this,parentId,identifier),this.forEachInlineChoice=function(ftor){for(var j=0;j<inlineChoices.length;++j)ftor.call(this,inlineChoices[j])},this.getInlineChoice=function(comparator){for(var j=0;j<inlineChoices.length;++j)if(comparator.call(this,inlineChoices[j]))return inlineChoices[j];return null},this.getDefaultChoice=function(){return this.getInlineChoice(function(choice){return choice.showDefault})},this.createDivId=function(){return self.getParentId()+"-inlineChoiceInteraction-"+self.getId()},this.get=function(i){return inlineChoices.length>i?inlineChoices[i]:null},this.setXmlResponse=function(value){if(!value){var defaultChoice=this.getDefaultChoice();defaultChoice&&(value=defaultChoice.identifier)}this.forEachInlineChoice(function(choice){choice.selected=!1,choice.identifier==value&&(choice.selected=!0)})},this.getResponse=function(){var responseBody="",nonDefaultChosen=!1,defaultChoice=this.getDefaultChoice();return this.forEachInlineChoice(function(choice){!0===choice.selected&&!1===choice.showDefault&&(responseBody='<value responseIdentifier="'+this.getId()+'" choiceIdentifier="'+defaultChoice.identifier+'">'+choice.identifier+"</value>\n",nonDefaultChosen=!0)}),nonDefaultChosen||(responseBody='<value responseIdentifier="'+this.getId()+'"/>\n'),{isValid:nonDefaultChosen,responseBody:responseBody}}},EditItem.Interaction.Text=function(parentId,identifier,content){this.responseValue="",EditItem.Interaction.call(this,parentId,identifier),this.setXmlResponse=function(text){this.responseValue=text},this.createDivId=function(){return this.getParentId()+"-textEntryInteraction-"+this.getId()},this.getContent=function(){return content},this.getResponse=function(){return this.responseValue&&/\S/.test(this.responseValue)?{isValid:!0,responseBody:'<value responseIdentifier="'+this.getId()+'">'+this.responseValue+"</value>\n"}:{isValid:!1,responseBody:'<value responseIdentifier="'+this.getId()+'"/>\n'}}},EditItem="undefined"==typeof EditItem?{}:EditItem,EditItem.Parse=function(id){this.mid=id;var self=this;this.choiceInteractions=new EditItem.Html.Choice,this.textInteractions=new EditItem.Html.Text,this.createFromFile=function(xmlUrl){var xmlhttp;(xmlhttp="function"==typeof window.XMLHttpRequest||"object"==typeof window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")).open("GET",xmlUrl,!1),xmlhttp.send();var xmlDoc=xmlhttp.responseText;return this.createFromXml(xmlDoc)},this.createDivId=function(nodeType,identifier){return self.mid+"-"+nodeType+"-"+identifier};var fixXmlTasks,fixXmlRecurse=function(parentNode){for(var i=0;i<parentNode.childNodes.length;++i){var childNode=parentNode.childNodes[i];if("inlineChoiceInteraction"==childNode.nodeName||"textEntryInteraction"==childNode.nodeName){var obj={parent:parentNode,child:childNode};fixXmlTasks.push(obj)}else fixXmlRecurse(childNode)}},fixXml=function(xmlDoc,parentNode){fixXmlTasks=[],fixXmlRecurse(parentNode);for(var i=0;i<fixXmlTasks.length;++i){var span=xmlDoc.createElement("span"),parent=fixXmlTasks[i].parent,child=fixXmlTasks[i].child,identifier=YUD.getAttribute(child,"responseIdentifier"),nid=self.createDivId(child.nodeName,identifier);span.setAttribute("id",nid),Util.Dom.setTextContent(span," "),parent.replaceChild(span,child)}},removeItemBody=function(doc){var itemBody=doc.getElementsByTagName("itemBody");if(itemBody&&itemBody.length&&itemBody&&1==itemBody.length){for(var bodyElement=itemBody[0],ndiv=doc.createElement("div"),bodyChildren=YUD.getChildren(bodyElement),j=0;j<bodyChildren.length;++j){var childClone=bodyChildren[j].cloneNode(!0);ndiv.appendChild(childClone)}bodyElement.parentNode.replaceChild(ndiv,bodyElement)}},parseChoiceInteractions=function(xmlElements){for(var interactionElements=xmlElements.getElementsByTagName("inlineChoiceInteraction"),i=0;i<interactionElements.length;++i){for(var interactionElement=interactionElements[i],choices=interactionElement.getElementsByTagName("inlineChoice"),interactionObj={identifier:YUD.getAttribute(interactionElement,"responseIdentifier"),shuffle:YUD.getAttribute(interactionElement,"shuffle"),inlineChoices:[]},j=0;j<choices.length;++j){for(var choice=choices[j],obj={identifier:YUD.getAttribute(choice,"identifier"),showDefault:"true"==YUD.getAttribute(choice,"default"),content:""},k=0;k<choice.childNodes.length;++k){var cnode=choice.childNodes[k],cstr=Util.Xml.serializeToString(cnode);obj.content=obj.content+cstr}interactionObj.inlineChoices.push(obj)}var choiceInteraction=new EditItem.Interaction.Choice(id,interactionObj.identifier,interactionObj.shuffle,interactionObj.inlineChoices);self.choiceInteractions.push(choiceInteraction)}},parseTextInteractions=function(xmlElements){for(var interactionElements=xmlElements.getElementsByTagName("textEntryInteraction"),i=0;i<interactionElements.length;++i){for(var interactionElement=interactionElements[i],interactionObj={identifier:YUD.getAttribute(interactionElement,"responseIdentifier"),content:""},k=0;k<interactionElement.childNodes.length;++k){var cnode=interactionElement.childNodes[k],cstr=Util.Xml.serializeToString(cnode);interactionObj.content=interactionObj.content+cstr}var editObj=new EditItem.Interaction.Text(id,interactionObj.identifier,interactionObj.content);self.textInteractions.push(editObj)}};this.createFromXml=function(xmlString,container){var xmlDoc=Util.Xml.parseFromString(xmlString);removeItemBody(xmlDoc);var xmlNodes=xmlDoc.documentElement;parseChoiceInteractions(xmlNodes),parseTextInteractions(xmlNodes),fixXml(xmlDoc,xmlNodes);var aDiv=document.createElement("div");aDiv.innerHTML=Util.Xml.serializeToString(xmlNodes),container.innerHTML=aDiv.childNodes[0].innerHTML}},EditItem="undefined"==typeof EditItem?{}:EditItem,EditItem.Html=function(){void 0===EditItem.Html._activeDbInstance&&(EditItem.Html._activeDbInstance={interaction:null,okHandler:null,enterHandler:null,choiceSpans:[],textSpan:null});var self=this;EditItem.InteractionSet.call(this),this.getInteractionFromSpan=function(span){var nameAr=span.getAttribute("id").split("-");return self.getInteraction(function(interaction){return interaction.getId()==nameAr[2]})},this.createCrossoutSpan=function(crossoutContent,replaceContent,parentDiv){parentDiv.innerHTML="",YUD.setAttribute(parentDiv,"tabindex","0");var crossoutSpan=document.createElement("span"),replacementSpan=document.createElement("span");crossoutSpan.innerHTML=crossoutContent,replaceContent?(YUD.addClass(crossoutSpan,"edit-crossout"),crossoutSpan.setAttribute("title","crossed-out text"),YUD.addClass(replacementSpan,"edit-newtext")):YUD.addClass(crossoutSpan,"edit-originaltext");var startCrossoutSpan=document.createElement("span");YUD.addClass(startCrossoutSpan,"hidden-spoken");var spokenCue=Messages.getAlt("ET.strikethrough.begin","start crossed out text");Util.Dom.setTextContent(startCrossoutSpan,spokenCue);var endCrossoutSpan=document.createElement("span");YUD.addClass(endCrossoutSpan,"hidden-spoken"),spokenCue=Messages.getAlt("ET.strikethrough.end","end crossed out text"),Util.Dom.setTextContent(endCrossoutSpan,spokenCue),replaceContent?(parentDiv.appendChild(startCrossoutSpan),parentDiv.appendChild(crossoutSpan),parentDiv.appendChild(endCrossoutSpan),Util.Dom.setTextContent(replacementSpan,replaceContent),parentDiv.appendChild(replacementSpan)):parentDiv.appendChild(crossoutSpan)},this.createLabel=function(defaultPhrase,parentDiv,id){var stemLabel=document.createElement("label");stemLabel.innerHTML='Replace "'+defaultPhrase+'" with:',YUD.addClass(stemLabel,"edit-db-stem"),YUD.setAttribute(stemLabel,"for",id),parentDiv.appendChild(stemLabel)},this.setDbPosition=function(){if(EditItem.Html._activeDbInstance.activeSpan&&EditItem.Html._activeDbInstance.panelWidget){var spanRegion=YUD.getRegion(EditItem.Html._activeDbInstance.activeSpan);EditItem.Html._activeDbInstance.panelWidget.cfg.setProperty("xy",[spanRegion.x,spanRegion.y+spanRegion.height])}},this.setKeyHandlers=function(target,scope,clickHandler){new YAHOO.util.KeyListener(target,{keys:[32,13]},{fn:function(evtName,args){YUE.stopEvent(args[1]),clickHandler()},scope:scope,correctScope:!0}).enable()},this.populateDialogBox=function(dialog,interaction){dialog.setHeader("Edit Tool"),YUD.addClass(dialog.header,"edit-db-header");var parentForm=this.createInteractionCore(interaction);dialog.setBody(parentForm),dialog.render(document.body)}},EditItem.Dialog={textDialog:null,choiceDialog:null,getTextDialog:function(){return null==this.textDialog&&(this.textDialog=this._buildEditDialog("EditTaskTextDialog"),YUD.addClass(this.textDialog.element,"edit-text itemMessage editTaskMessage")),this.textDialog},getChoiceDialog:function(){return null==this.choiceDialog&&(this.choiceDialog=this._buildEditDialog("EditTaskChoiceDialog"),YUD.addClass(this.choiceDialog.element,"edit-text itemMessage editTaskMessage")),this.choiceDialog},_handleCancelButton:function(ev){var activeInst=EditItem.Html._activeDbInstance;if(activeInst.panelWidget){activeInst.choiceSpans=[],activeInst.panelWidget.hide();var span=activeInst.activeSpan;span&&(YUD.removeClass(span,"TDS_EDIT_SPAN_HOVER"),span.focus())}activeInst.interaction=null},_handleOkButton:function(ev){var activeInst=EditItem.Html._activeDbInstance;if(activeInst.interaction&&activeInst.panelWidget&&activeInst.okHandler){var interaction=activeInst.interaction;activeInst.okHandler(interaction),activeInst.choiceSpans=[],activeInst.textSpan=null,activeInst.panelWidget.hide();var span=activeInst.activeSpan;span&&(YUD.removeClass(span,"TDS_EDIT_SPAN_HOVER"),span.focus())}EditItem.Html._activeDbInstance.interaction=null},_addOkCancel:function(){return EditItem.Html.submit=EditItem.Dialog._handleOkButton,[{text:"OK",handler:EditItem.Dialog._handleOkButton},{text:"Cancel",handler:EditItem.Dialog._handleCancelButton}]},_buildEditDialog:function(label){var buttons=this._addOkCancel(),escKeyListener=new YAHOO.util.KeyListener(document,{keys:[27]},{fn:this._handleCancelButton,scope:this,correctScope:!0}),editDialog=new YAHOO.widget.Dialog(label,{width:"320px",constraintoviewport:!0,modal:!0,visible:!1,draggable:!0,close:!1,postmethod:"none",usearia:!1,buttons:buttons,keylisteners:escKeyListener,role:"dialog"});return editDialog.showEvent.subscribe(function(){TDS.Dialog.onShow(),editDialog.focusFirst(),editDialog.setTabLoop(editDialog.firstElement,editDialog.lastElement)}),editDialog.hideEvent.subscribe(function(){TDS.Dialog.onHide()}),this._setTabIndexOnDialog(editDialog),editDialog},_setTabIndexOnDialog:function(dialog){dialog.beforeShowEvent.subscribe(function(){this.setFirstLastFocusable();for(var i=0;i<dialog.focusableElements.length;i++)dialog.focusableElements[i].setAttribute("tabindex",0);if(dialog.cfg.getProperty("usearia")){var id=dialog.body.id||YUD.generateId(dialog.body);dialog.cfg.setProperty("describedby",id)}})}},EditItem="undefined"==typeof EditItem?{}:EditItem,EditItem.Html.Text=function(){EditItem.Html.call(this);var self=this,addComponentArray=[];this.textDialog=YUD.get("EditTaskTextDialog"),this.textDialog=void 0===this.textDialog?"EditTaskTextDialog":this.textDialog,this.showItem=function(){this.forEachInteraction(function(interaction){var aDiv=YUD.get(interaction.createDivId());YUD.addClass(aDiv,"TDS_EDIT_SPAN "),this.createCrossoutSpan(interaction.getContent(),null,aDiv),YUE.addListener(aDiv,"click",clickOnTextItem,this);var boundClick=clickOnTextItem.bind(aDiv);this.setKeyHandlers(aDiv,this,boundClick),aDiv&&addComponentArray.push(aDiv),YUD.addClass(aDiv,"TTS speakAs"),aDiv.setAttribute("ssml","sub"),aDiv.setAttribute("ssml_alias","{silence:1000}"),aDiv.setAttribute("role","button"),aDiv.setAttribute("title","click to correct")})},this.getComponentArray=function(){return addComponentArray};var entityDecode=function(text,code){if(text&&"string"==typeof text){var textElement=document.createElement("span");return textElement.innerHTML=text,text=Util.Dom.getTextContent(textElement)}};this.createInteractionCore=function(interaction){var parentForm=document.createElement("form");YUD.addClass(parentForm,"edit-text"),this.createLabel(interaction.getContent(),parentForm,"edit-textarea"),YUD.setAttribute(parentForm,"onSubmit","EditItem.Html.submit()");var textInput=document.createElement("input"),textValue=entityDecode(interaction.responseValue);return textValue&&"string"==typeof textValue&&(textInput.value=textValue),YUD.addClass(textInput,"edit-textarea"),YUD.setAttribute(textInput,"id","edit-textarea"),YUD.setAttribute(textInput,"type","text"),parentForm.appendChild(textInput),interaction.textSpan=textInput,parentForm};var createTextInteractionMarkup=function(interaction){var dialog=EditItem.Dialog.getTextDialog();this.populateDialogBox(dialog,interaction),EditItem.Html._activeDbInstance.interaction=interaction,EditItem.Html._activeDbInstance.textSpan=interaction.textSpan,EditItem.Html._activeDbInstance.okHandler=handleOkButtonText,EditItem.Html._activeDbInstance.panelWidget=dialog,dialog.show(),dialog.cfg.setProperty("zindex",1005),inputPos(interaction.textSpan),setTimeout(this.setDbPosition,1)},inputPos=function(node){var position=0;if(node&&node.value&&(position=node.value.length),node.setSelectionRange)node.focus(),node.setSelectionRange(0,position);else if(node.createTextRange){var range=node.createTextRange();range.collapse(!0),range.moveEnd("character",position),range.moveStart("character",0),range.select()}};this.redisplay=function(){this.forEachInteraction(function(interaction){var textSpan=YUD.get(interaction.createDivId()),text=entityDecode(interaction.responseValue);this.createCrossoutSpan(interaction.getContent(),text,textSpan)})};var handleOkButtonText=function(ev){var text=EditItem.Html._activeDbInstance.textSpan.value;/\S/.test(text)||(text=null);var interaction=EditItem.Html._activeDbInstance.interaction;self.createCrossoutSpan(interaction.getContent(),text,YUD.get(interaction.createDivId())),interaction.responseValue=EditItem.Html.Text.entityEncode(text)},clickOnTextItem=function(ev){if(!self.isReadOnly()){var span=this;if(!EditItem.Html._activeDbInstance.interaction){var interaction=self.getInteractionFromSpan(span);YUD.addClass(span,"TDS_EDIT_SPAN_HOVER"),EditItem.Html._activeDbInstance.activeSpan=span,interaction&&createTextInteractionMarkup.call(self,interaction)}}}},EditItem.Html.Text.prototype.isReadOnly=function(){return!1},EditItem.Html.Text.entityEncode=function(text){if(text&&"string"==typeof text){var textElement=document.createElement("span");return Util.Dom.setTextContent(textElement,text),textElement.innerHTML}return""},EditItem="undefined"==typeof EditItem?{}:EditItem,EditItem.Html=void 0===EditItem.Html?{}:EditItem.Html,EditItem.Html.Choice=function(){EditItem.Html.call(this);var self=this,addComponentArray=[],forAllInlineChoices=function(ftor){self.forEachInteraction(function(interaction){interaction.forEachInlineChoice(function(choice){ftor(choice)})})},initializeChoiceInteractions=function(){forAllInlineChoices(function(choice){choice.showDefault?choice.selected=!0:choice.selected=!1})};this.showItem=function(){initializeChoiceInteractions(),self.forEachInteraction(function(interaction){var aDiv=YUD.get(interaction.createDivId()),aChoice=interaction.getDefaultChoice();if(aDiv&&aChoice){aDiv.innerHTML=aChoice.content,YUD.addClass(aDiv,"TDS_EDIT_SPAN "),YUD.addClass(aDiv,"edit-originaltext"),YUE.addListener(aDiv,"click",clickOnChoiceItem,this);var boundClick=clickOnChoiceItem.bind(aDiv);this.setKeyHandlers(aDiv,this,boundClick),addComponentArray.push(aDiv),YUD.addClass(aDiv,"TTS speakAs"),aDiv.setAttribute("ssml","sub"),aDiv.setAttribute("ssml_alias","{silence:1000}"),aDiv.setAttribute("role","button"),aDiv.setAttribute("title","click to correct")}}),this.getComponentArray=function(){return addComponentArray}};var getInlineChoiceId=function(interaction,choice){return interaction.createDivId()+"-"+choice.identifier+"-value"},clickOnChoiceItem=function(ev){if(!self.isReadOnly()){var span=this;if(!EditItem.Html._activeDbInstance.interaction){var interaction=self.getInteractionFromSpan(span);YUD.addClass(span,"TDS_EDIT_SPAN_HOVER"),EditItem.Html._activeDbInstance.activeSpan=span,interaction&&createChoiceInteractionMarkup(interaction)}}};this.redisplay=function(){this.forEachInteraction(function(interaction){var choiceSpan=YUD.get(interaction.createDivId()),selectedValue="";interaction.forEachInlineChoice(function(choice){choice.selected&&!choice.showDefault&&(selectedValue=choice.content)}),this.createCrossoutSpan(interaction.getDefaultChoice().content,selectedValue,choiceSpan)})};var handleOkButtonChoice=function(interaction){var responseContent=EditItem.Html._activeDbInstance.activeSelect.value,choiceSpan=YUD.get(interaction.createDivId()),defaultChoice=interaction.getDefaultChoice();self.createCrossoutSpan(defaultChoice.content,responseContent,choiceSpan);for(var choiceSpans=EditItem.Html._activeDbInstance.choiceSpans,i=0;i<choiceSpans.length;i++)if(1==choiceSpans[i].selected){var choiceId=choiceSpans[i].id.split("-")[3];interaction.forEachInlineChoice(function(choice){choice.identifier==choiceId?choice.selected=!0:choice.selected=!1})}},createChoiceInteractionMarkup=function(interaction){var dialog=EditItem.Dialog.getChoiceDialog();EditItem.Html._activeDbInstance.okHandler=handleOkButtonChoice,EditItem.Html._activeDbInstance.interaction=interaction,EditItem.Html._activeDbInstance.panelWidget=dialog,self.populateDialogBox(dialog,interaction),dialog.show()};this.createInteractionCore=function(interaction){var parentForm=document.createElement("form");YUD.addClass(parentForm,"edit-nav"),YUD.setAttribute(parentForm,"onSubmit","EditItem.Html.submit()");var defaultChoice=interaction.getDefaultChoice();this.createLabel(defaultChoice.content,parentForm,"edit-select");var select=document.createElement("select");YUD.addClass(select,"first-of-type"),YUD.addClass(select,"edit-nav-closed"),YUD.setAttribute(select,"id","edit-select"),EditItem.Html._activeDbInstance.activeSelect=select;var i=0;return interaction.forEachInlineChoice(function(choice){if(!choice.showDefault&&!choice.selected){var li=document.createElement("option");YUD.addClass(li,"yuimenuitem edit-nav"),choice.selected&&(YUD.addClass(li,"edit-list-selected"),YUD.setAttribute(li,"selected","selected")),YUD.setAttribute(li,"id",getInlineChoiceId(interaction,choice)),YUD.setAttribute(li,"groupindex",0),YUD.setAttribute(li,"index",i.toString()),YUD.setAttribute(li,"value",choice.content),li.innerHTML=choice.content,choice.selected&&select.firstChild?YUD.insertBefore(li,select.firstChild):select.appendChild(li),EditItem.Html._activeDbInstance.choiceSpans.push(li)}i++}),parentForm.appendChild(select),parentForm}},EditItem.Html.Choice.prototype.isReadOnly=function(){return!1},function(CM){function isEditTaskText(item){return item.isResponseType("EditTask")}function isEditTaskChoice(item){return item.isResponseType("EditTaskChoice")}function Widget_ET(){this._editing=null}CM.registerWidget("edittask",Widget_ET,function(page,item,content){var id="EditContainer_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el,item.qti.xml)}),Widget_ET.prototype.init=function(){var page=this.page,item=this.entity;item.getStemElement=function(){var compoundEl=page.getCompoundElement();return compoundEl||item.getElement()}},Widget_ET.prototype.load=function(){var item=this.entity,container=this.element,qtiXml=this.config,ei=new EditItem.Parse(item.position);ei.createFromXml(qtiXml,container),YUD.removeClass(container,"loading"),YUD.addClass(container,"edit-container");var editTextInstance=ei.textInteractions;editTextInstance.isReadOnly=item.isReadOnly.bind(item);var editChoiceInstance=ei.choiceInteractions;editChoiceInstance.isReadOnly=item.isReadOnly.bind(item);var editing={editText:editTextInstance,editChoice:editChoiceInstance};this._editing=editing,YUE.on(window,"resize",function(){null!=onresize&&onresize(),editTextInstance&&editTextInstance.setDbPosition()}),editChoiceInstance.showItem(),editTextInstance.showItem();var componentArray=editTextInstance.getComponentArray();componentArray.push.apply(componentArray,editChoiceInstance.getComponentArray());for(var i=0;i<componentArray.length;++i)item.addComponent(componentArray[i]);item.value&&(isEditTaskText(item)?editTextInstance.setXmlResponse(item.value):isEditTaskChoice(item)&&editChoiceInstance.setXmlResponse(item.value))},Widget_ET.prototype.zoom=function(){var editing=this._editing;editing&&editing.editText&&editing.editText.setDbPosition()},Widget_ET.prototype.hide=function(){var activeInstance=EditItem.Html._activeDbInstance;activeInstance&&activeInstance.panelWidget&&(activeInstance.panelWidget.hide(),activeInstance.interaction=null,activeInstance.activeSpan&&(YUD.removeClass(activeInstance.activeSpan,"TDS_EDIT_SPAN_HOVER"),activeInstance.activeSpan=null))},Widget_ET.prototype.isResponseAvailable=function(){return null!=this._editing},Widget_ET.prototype.getResponse=function(){var item=this.entity,editing=this._editing,response=(isEditTaskText(item)?editing.editText:editing.editChoice).getResponse(),value=response.responseBody,isValid=response.isValid;return this.createResponse(value,isValid)},Widget_ET.prototype.setResponse=function(value){var item=this.entity,editing=this._editing;(isEditTaskText(item)?editing.editText:editing.editChoice).setXmlResponse(value)}}(window.ContentManager),function(){"use strict";function xml2jsonv2(xml,tab){var X={toObj:function(xml){var o={};if(1===xml.nodeType){if(xml.attributes.length)for(var i=0;i<xml.attributes.length;i++)o["@"+xml.attributes[i].nodeName]=(xml.attributes[i].value||"").toString();if(xml.firstChild){for(var textChild=0,cdataChild=0,hasElementChild=!1,n=xml.firstChild;n;n=n.nextSibling)1===n.nodeType?hasElementChild=!0:3===n.nodeType&&n.nodeValue.match(/[^ \f\n\r\t\v]/)?textChild++:4===n.nodeType&&cdataChild++;if(hasElementChild)if(textChild<2&&cdataChild<2)for(X.removeWhite(xml),n=xml.firstChild;n;n=n.nextSibling)3===n.nodeType?o["#text"]=X.escape(n.nodeValue):4===n.nodeType?o["#cdata"]=X.escape(n.nodeValue):n.nodeName in o?o[n.nodeName]instanceof Array?o[n.nodeName][o[n.nodeName].length]=X.toObj(n):o[n.nodeName]=[o[n.nodeName],X.toObj(n)]:o[n.nodeName]=X.toObj(n);else xml.attributes.length?o["#text"]=X.escape(X.innerXml(xml)):o=X.escape(X.innerXml(xml));else if(textChild)xml.attributes.length?o["#text"]=X.escape(X.innerXml(xml)):o=X.escape(X.innerXml(xml));else if(cdataChild)if(cdataChild>1)o=X.escape(X.innerXml(xml));else for(n=xml.firstChild;n;n=n.nextSibling)o["#cdata"]=X.escape(n.nodeValue)}xml.attributes.length||xml.firstChild||(o=null)}else 9===xml.nodeType?o=X.toObj(xml.documentElement):console.error("unhandled node type: ",xml.nodeType,xml);return o},toJson:function(o,name,ind){var json=name?'"'+name+'"':"";if(o instanceof Array){for(var i=0,n=o.length;i<n;i++)o[i]=X.toJson(o[i],"",ind+"\t");json+=(name?":[":"[")+(o.length>1?"\n"+ind+"\t"+o.join(",\n"+ind+"\t")+"\n"+ind:o.join(""))+"]"}else if(null===o)json+=(name&&":")+"null";else if("object"==typeof o){var arr=[];for(var m in o)o.hasOwnProperty(m)&&(arr[arr.length]=X.toJson(o[m],m,ind+"\t"));json+=(name?":{":"{")+(arr.length>1?"\n"+ind+"\t"+arr.join(",\n"+ind+"\t")+"\n"+ind:arr.join(""))+"}"}else"string"==typeof o?"nmb_"===name.substr(0,4)||"bln_"===name.substr(0,4)?json=(name&&'"'+name.substr(4)+'":')+o.toString():json+=(name&&":")+'"'+o.toString()+'"':json+=(name&&":")+o.toString();return json},innerXml:function(node){var s="";if("innerHTML"in node)s=node.innerHTML;else for(var asXml=function(n){var s="";if(1===n.nodeType){s+="<"+n.nodeName;for(var i=0;i<n.attributes.length;i++)s+=" "+n.attributes[i].nodeName+'="'+(n.attributes[i].value||"").toString()+'"';if(n.firstChild){s+=">";for(var c=n.firstChild;c;c=c.nextSibling)s+=asXml(c);s+="</"+n.nodeName+">"}else s+="/>"}else 3===n.nodeType?s+=n.nodeValue:4===n.nodeType&&(s+="<![CDATA["+n.nodeValue+"]]>");return s},c=node.firstChild;c;c=c.nextSibling)s+=asXml(c);return s},escape:function(txt){return txt.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;)if(3===n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var nxt=n.nextSibling;e.removeChild(n),n=nxt}else 1===n.nodeType?(X.removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e}};9===xml.nodeType&&(xml=xml.documentElement);var json=X.toJson(X.toObj(X.removeWhite(xml)),xml.nodeName,"\t");return"{\n"+tab+(tab?json.replace(/\t/g,tab):json.replace(/\t|\n/g,""))+"\n}"}function parseXml(xml){var dom=null;if(window.DOMParser)try{dom=(new DOMParser).parseFromString(xml,"text/xml")}catch(e){dom=null}else if(window.ActiveXObject)try{(dom=new ActiveXObject("Microsoft.XMLDOM")).async=!1,dom.loadXML(xml)||console.error(dom.parseError.reason+dom.parseError.srcText)}catch(e2){dom=null}else console.error("Failed to pare xml.");return dom}function resolveUrl(url){url=(url=url.replace(/&amp;/g,"&")).split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var el=document.createElement("div");return el.innerHTML='<a href="'+url+'">x</a>',el.firstChild.href}function Toolbar(useTouch){this.div=$("<div>",{class:"sp_toolbar_container"}),this.div_toolbarleftcol=$("<div>",{class:"sp_toolbar_leftcolumn"}),this.div_toolbarrightcol=$("<div>",{class:"sp_toolbar_rightcolumn"}),this.ul_Left=$("<ul>",{class:"sp_toolbar_ul_left sp_controls"}),this.ul_Right=$("<ul>",{class:"sp_toolbar_ul_right sp_tools"}),this.div.append(this.div_toolbarleftcol.append(this.ul_Left)),this.div.append(this.div_toolbarrightcol.append(this.ul_Right)),this.lastClick=(new Date).getTime(),this.named={},this.buttons=[],this.focusedIndex=0,this.zwibblerContext=null}function MoveSegment(previous,to){this.init(previous,to)}function DrawSegmentControls(ctx,segment){segment.previous&&segment.control1&&segment.control2&&(ctx.moveTo(segment.previous.to.x,segment.previous.to.y),ctx.lineTo(segment.control1.x,segment.control1.y),ctx.moveTo(segment.to.x,segment.to.y),ctx.lineTo(segment.control2.x,segment.control2.y))}function LineSegment(previous,to,randomSequence,sloppiness){this.init(previous,to,randomSequence,sloppiness)}function CurveSegment(previous,to,smoothness){this.init(previous,to,smoothness)}function QuadraticSegment(previous,control,to){this.init(previous,control,to)}function ArcSegment(previous,control,to,radius){this.init(previous,control,to,radius)}function BezierSegment(previous,control1,control2,to){this.init(previous,control1,control2,to)}function CornerSegment(previous,corner,to,randomSequence,sloppiness){this.init(previous,corner,to,randomSequence,sloppiness)}function SelectBoxBehaviour(view,previousBehaviour,x,y){this.view=view,this.dx=0,this.dy=0,this.dragging=!1,this.previousBehaviour=previousBehaviour,this.onMouseDown(x,y)}function SplitQueryString(b){for(var a={},c=b.split("#"),fields=c[c.length-1].split("&"),f=0;f<fields.length;f++){var i=fields[f].split("=");if(i[0])try{i.length>1?(i[1]=i[1].replace(/\+/g," "),window.decodeURIComponent?a[i[0]]=decodeURIComponent(i[1]):a[i[0]]=unescape(i[1])):a[i[0]]=""}catch(except){}}return a}function Inherit(base,child){for(var key in base)base.hasOwnProperty(key)&&!child.hasOwnProperty(key)&&(child[key]=base[key])}function Point(x,y){this.x=x,this.y=y}function Size(width,height){this.width=width,this.height=height}function CalcLineLength(x1,y1,x2,y2){return Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2))}function CreateVector(x1,y1,x2,y2){var len=CalcLineLength(x1,y1,x2,y2);return 0===len?{x:1,y:0}:{x:(x2-x1)/len,y:(y2-y1)/len}}function CalculateCentroid(points){if(0===points.length)return new Point(0,0);for(var x=points[0].x,y=points[0].y,i=1;i<points.length;i++)x+=points[i].x,y+=points[i].y;return new Point(x/points.length,y/points.length)}function Rectangle(x,y,w,h){this.x=x,this.y=y,this.width=w,this.height=h,this.repair()}function Clone(obj){var copy;if(obj instanceof Function)return obj;if(obj instanceof Array)copy=obj.concat();else if(obj instanceof Object){copy={};for(var prop in obj)copy[prop]=Clone(obj[prop])}else copy=obj;return copy}function Matrix(var_args){if(0===arguments.length)this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0;else if(1===arguments.length){if(6!==arguments[0].length)throw"Bad array initializer for Matrix.";this.m11=arguments[0][0],this.m12=arguments[0][1],this.m21=arguments[0][2],this.m22=arguments[0][3],this.dx=arguments[0][4],this.dy=arguments[0][5]}else{if(6!==arguments.length)throw"Bad initializer for Matrix.";this.m11=arguments[0],this.m12=arguments[1],this.m21=arguments[2],this.m22=arguments[3],this.dx=arguments[4],this.dy=arguments[5]}}function ScaleMatrix(sx,sy,ox,oy){0===sx&&(sx=.1),0===sy&&(sy=.1),void 0===ox?(this.m11=sx,this.m12=0,this.m21=0,this.m22=sy,this.dx=0,this.dy=0,this.ox=0,this.oy=0):(this.m11=sx,this.m12=0,this.m21=0,this.m22=sy,this.dx=ox-sx*ox,this.dy=oy-sy*oy,this.ox=ox,this.oy=oy),this.sx=sx,this.sy=sy}function RotateMatrix(angle,x,y){var cosa=Math.cos(angle),sina=Math.sin(angle);this.m11=cosa,this.m12=sina,this.m21=-sina,this.m22=cosa,this.dx=-x*cosa-y*sina+x,this.dy=x*sina-y*cosa+y,this.angle=angle,this.x=x,this.y=y}function TranslateMatrix(dx,dy){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=dx,this.dy=dy}function recursive_bezier(points,x1,y1,x2,y2,x3,y3,x4,y4,max_error){if(++recursive_bezier.depth>8)recursive_bezier.depth-=1;else{var x12=(x1+x2)/2,y12=(y1+y2)/2,x23=(x2+x3)/2,y23=(y2+y3)/2,x34=(x3+x4)/2,y34=(y3+y4)/2,x123=(x12+x23)/2,y123=(y12+y23)/2,x234=(x23+x34)/2,y234=(y23+y34)/2,x1234=(x123+x234)/2,y1234=(y123+y234)/2,dx=x4-x1,dy=y4-y1,d2=Math.abs((x2-x4)*dy-(y2-y4)*dx),d3=Math.abs((x3-x4)*dy-(y3-y4)*dx);if((d2+d3)*(d2+d3)<max_error*(dx*dx+dy*dy))return points.push(new Point(x1234,y1234)),void(recursive_bezier.depth-=1);recursive_bezier(points,x1,y1,x12,y12,x123,y123,x1234,y1234,max_error),recursive_bezier(points,x1234,y1234,x234,y234,x34,y34,x4,y4,max_error),recursive_bezier.depth-=1}}function bezier(points,x1,y1,x2,y2,x3,y3,x4,y4,max_error){x1!==x4&&y1!==y4&&recursive_bezier(points,x1,y1,x2,y2,x3,y3,x4,y4,max_error*max_error),points.push(new Point(x4,y4))}function PointInPolygon(poly,x,y,radius){var xnew,ynew,xold,yold,x1,y1,x2,y2,i,inside=0;if(poly.length<3)return 0;for(xold=poly[poly.length-1].x,yold=poly[poly.length-1].y,i=0;i<poly.length;i++)xnew=poly[i].x,ynew=poly[i].y,xnew>xold?(x1=xold,x2=xnew,y1=yold,y2=ynew):(x1=xnew,x2=xold,y1=ynew,y2=yold),xnew<x==x<=xold&&(y-y1)*(x2-x1)<(y2-y1)*(x-x1)&&(inside=!inside),xold=xnew,yold=ynew;return inside}function PointNearPath(path,x3,y3,radius){radius*=radius;for(var i=1;i<path.length;i++){var x1=path[i-1].x,y1=path[i-1].y,px=path[i].x-x1,py=path[i].y-y1,u=((x3-x1)*px+(y3-y1)*py)/(px*px+py*py);u>1?u=1:u<0&&(u=0);var dx=x1+u*px-x3,dy=y1+u*py-y3;if(dx*dx+dy*dy<=radius)return!0}return!1}function ImageManipulator(imageData){this.image=imageData}function BitmapImage(width,height){this._width=width,this._height=height,this.data=[]}function PathData(){this.closed=!1,this.commands=[]}function blur_image_data(srcdata,radius,MAX_ITERATIONS){radius=Math.round(radius);var iteration,width=srcdata.width,height=srcdata.height,width4=4*width,radius4=4*radius,precalc=[],src=srcdata.data,mul=1/(2*radius*(2*radius));for(iteration=0;iteration<MAX_ITERATIONS;iteration++){var x,y,i;for(precalc[0]=src[0],precalc[1]=src[1],precalc[2]=src[2],precalc[3]=src[3],i=4;i<width4;i++)precalc[i]=src[i]+precalc[i-4];for(y=1;y<height;y++)for(precalc[i]=src[i]+precalc[i-width4],precalc[i+1]=src[i+1]+precalc[i+1-width4],precalc[i+2]=src[i+2]+precalc[i+2-width4],precalc[i+3]=src[i+3]+precalc[i+3-width4],i+=4,x=4;x<width4;x++)precalc[i]=src[i]+precalc[i-width4]+precalc[i-4]-precalc[i-width4-4],i++;for(y=radius;y<height-radius;y++){var r=radius*width4;for(i=y*width4+radius4,x=radius4;x<width4-radius;x++)src[i]=Math.floor(mul*(precalc[i+radius4+r]+precalc[i-radius4-r]-precalc[i-radius4+r]-precalc[i+radius4-r])),i++}}}function blur_image_data2(srcdata,radius,MAX_ITERATIONS){var channel,iteration,width=srcdata.width,height=srcdata.height,precalc=[],src=srcdata.data,mul=1/(2*radius*(2*radius));for(iteration=0;iteration<MAX_ITERATIONS;iteration++)for(channel=0;channel<4;channel++){var x,y,i,tot,pix=0;for(pix=channel,i=1,x=0,y=1,precalc[0]=src[pix];i<width;)precalc[i]=src[pix]+precalc[i-1],i+=1,pix+=4;for(;y<height;){for(precalc[i]=src[pix]+precalc[i-width],i++,pix+=4,x=1;x<width;)precalc[i]=src[pix]+precalc[i-width]+precalc[i-1]-precalc[i-width-1],x++,i++,pix+=4;y++}for(pix=radius*width*4+4*radius+channel,y=radius;y<height-radius;y++){for(x=radius;x<width-radius;x++){var l=x<radius?0:x-radius,t=y<radius?0:y-radius,r=x+radius>=width?width-1:x+radius,b=y+radius>=height?height-1:y+radius;tot=precalc[r+b*width]+precalc[l+t*width]-precalc[l+b*width]-precalc[r+t*width],src[pix]=Math.round(tot*mul),pix+=4}pix+=2*radius*4}}}function Canvas_drawRoundRect(ctx,x,y,width,height,radius){if(0===radius)ctx.rect(x,y,width,height);else{var x1=x,x2=x+width,y1=y,y2=y+height;ctx.moveTo(x1+radius,y1),ctx.lineTo(x2-radius,y1),ctx.quadraticCurveTo(x2,y1,x2,y1+radius),ctx.lineTo(x2,y2-radius),ctx.quadraticCurveTo(x2,y2,x2-radius,y2),ctx.lineTo(x1+radius,y2),ctx.quadraticCurveTo(x1,y2,x1,y2-radius),ctx.lineTo(x1,y1+radius),ctx.quadraticCurveTo(x1,y1,x1+radius,y1),ctx.closePath()}}function Polygon(var_args){if(this.points=[],1===arguments.length){var arg=arguments[0];arg instanceof Rectangle?(this.points.push(new Point(arg.x,arg.y)),this.points.push(new Point(arg.right(),arg.y)),this.points.push(new Point(arg.right(),arg.bottom())),this.points.push(new Point(arg.x,arg.bottom()))):arg instanceof Array?this.points=arg:console.error("Bad parameter passed to Polygon() constructor.")}}function TransformSelectionBehaviour(view,previousBehaviour,handle,toggleEditNode,x,y){this.view=view,this.handle=handle,this.previousBehaviour=previousBehaviour,this.toggleEditNode=toggleEditNode,this.view.showRotationHandle(this.handle===this.view.ROT),this.haveGesture=!1,this.onMouseDown(x,y)}function GetNodeIds(nodes){for(var result=[],i=0;i<nodes.length;i++)result.push(nodes[i].id);return result}function GenerateCurvesFromPoints(points,error){function DrawBezierCurve(n,curve){path.bezierCurveTo(curve[1].x,curve[1].y,curve[2].x,curve[2].y,curve[3].x,curve[3].y),_fitLogger("Bezier: (%s,%s), (%s,%s), (%s,%s), (%s,%s)",curve[0].x,curve[0].y,curve[1].x,curve[1].y,curve[2].x,curve[2].y,curve[3].x,curve[3].y)}function V2Negate(v){return v.x=-v.x,v.y=-v.y,v}function V2Dot(a,b){return a.x*b.x+a.y*b.y}function B0(u){var tmp=1-u;return tmp*tmp*tmp}function B1(u){var tmp=1-u;return 3*u*(tmp*tmp)}function B2(u){return 3*u*u*(1-u)}function B3(u){return u*u*u}function V2DistanceBetween2Points(a,b){var dx=a.x-b.x,dy=a.y-b.y;return Math.sqrt(dx*dx+dy*dy)}function V2SquaredLength(a){return a.x*a.x+a.y*a.y}function V2Length(a){return Math.sqrt(V2SquaredLength(a))}function V2Scale(v,newlen){var len=V2Length(v);return 0!==len&&(v.x*=newlen/len,v.y*=newlen/len),v}function V2Add(a,b,c){return void 0===c&&_fitLogger("Undef!"),c.x=a.x+b.x,c.y=a.y+b.y,c}function V2AddII(a,b){return{x:a.x+b.x,y:a.y+b.y}}function V2ScaleII(v,s){return{x:v.x*s,y:v.y*s}}function V2SubII(a,b){return{x:a.x-b.x,y:a.y-b.y}}function GenerateBezier(d,first,last,uPrime,tHat1,tHat2){var i,nPts,det_C0_C1,det_C0_X,det_X_C1,alpha_l,alpha_r,tmp,bezCurve,A=[],C=[[],[]],X=[];for(bezCurve=[{},{},{},{}],nPts=last-first+1,i=0;i<nPts;i++){var v1={x:tHat1.x,y:tHat1.y},v2={x:tHat2.x,y:tHat2.y};V2Scale(v1,B1(uPrime[i])),V2Scale(v2,B2(uPrime[i])),A[i]=[v1,v2]}for(C[0][0]=0,C[0][1]=0,C[1][0]=0,C[1][1]=0,X[0]=0,X[1]=0,i=0;i<nPts;i++)C[0][0]+=V2Dot(A[i][0],A[i][0]),C[0][1]+=V2Dot(A[i][0],A[i][1]),C[1][0]=C[0][1],C[1][1]+=V2Dot(A[i][1],A[i][1]),tmp=V2SubII(d[first+i],V2AddII(V2ScaleII(d[first],B0(uPrime[i])),V2AddII(V2ScaleII(d[first],B1(uPrime[i])),V2AddII(V2ScaleII(d[last],B2(uPrime[i])),V2ScaleII(d[last],B3(uPrime[i])))))),X[0]+=V2Dot(A[i][0],tmp),X[1]+=V2Dot(A[i][1],tmp);if(det_C0_C1=C[0][0]*C[1][1]-C[1][0]*C[0][1],det_C0_X=C[0][0]*X[1]-C[0][1]*X[0],det_X_C1=X[0]*C[1][1]-X[1]*C[0][1],0===det_C0_C1&&(det_C0_C1=C[0][0]*C[1][1]*1e-11),alpha_l=det_X_C1/det_C0_C1,alpha_r=det_C0_X/det_C0_C1,alpha_l<0||alpha_r<0){var dist=V2DistanceBetween2Points(d[last],d[first])/3;return bezCurve[0]=d[first],bezCurve[3]=d[last],V2Add(bezCurve[0],V2Scale(tHat1,dist),bezCurve[1]),V2Add(bezCurve[3],V2Scale(tHat2,dist),bezCurve[2]),bezCurve}return bezCurve[0]=d[first],bezCurve[3]=d[last],V2Add(bezCurve[0],V2Scale(tHat1,alpha_l),bezCurve[1]),V2Add(bezCurve[3],V2Scale(tHat2,alpha_r),bezCurve[2]),bezCurve}function Bezier(degree,V,t){var i,j,Vtemp;for(Vtemp=[],i=0;i<=degree;i++)Vtemp[i]={x:V[i].x,y:V[i].y};for(i=1;i<=degree;i++)for(j=0;j<=degree-i;j++)Vtemp[j].x=(1-t)*Vtemp[j].x+t*Vtemp[j+1].x,Vtemp[j].y=(1-t)*Vtemp[j].y+t*Vtemp[j+1].y;return Vtemp[0]}function NewtonRaphsonRootFind(Q,P,u){var numerator,denominator,Q_u,Q1_u,Q2_u,i,Q1=[],Q2=[];for(Q_u=Bezier(3,Q,u),i=0;i<=2;i++)Q1[i]={},Q1[i].x=3*(Q[i+1].x-Q[i].x),Q1[i].y=3*(Q[i+1].y-Q[i].y);for(i=0;i<=1;i++)Q2[i]={},Q2[i].x=2*(Q1[i+1].x-Q1[i].x),Q2[i].y=2*(Q1[i+1].y-Q1[i].y);return Q1_u=Bezier(2,Q1,u),Q2_u=Bezier(1,Q2,u),numerator=(Q_u.x-P.x)*Q1_u.x+(Q_u.y-P.y)*Q1_u.y,denominator=Q1_u.x*Q1_u.x+Q1_u.y*Q1_u.y+(Q_u.x-P.x)*Q2_u.x+(Q_u.y-P.y)*Q2_u.y,u-numerator/denominator}function Reparameterize(d,first,last,u,bezCurve){var i,uPrime=[];for(uPrime=[],i=first;i<=last;i++)uPrime[i-first]=NewtonRaphsonRootFind(bezCurve,d[i],u[i-first]);return uPrime}function V2Normalize(v){var len=Math.sqrt(V2Length(v));return 0!==len&&(v.x/=len,v.y/=len),v}function ComputeCenterTangent(d,center){var V1,V2,tHatCenter={};return V1=V2SubII(d[center-1],d[center]),V2=V2SubII(d[center],d[center+1]),tHatCenter.x=(V1.x+V2.x)/2,tHatCenter.y=(V1.y+V2.y)/2,tHatCenter=V2Normalize(tHatCenter)}function ChordLengthParameterize(d,first,last){var i,u=[];for(u[0]=0,i=first+1;i<=last;i++)u[i-first]=u[i-first-1]+V2DistanceBetween2Points(d[i],d[i-1]);for(i=first+1;i<=last;i++)u[i-first]=u[i-first]/u[last-first];return u}function ComputeMaxError(d,first,last,bezCurve,u){var i,maxDist,dist,splitPoint=(last-first+1)/2;for(maxDist=0,i=first+1;i<last;i++)(dist=V2SquaredLength(V2SubII(Bezier(3,bezCurve,u[i-first]),d[i])))>=maxDist&&(maxDist=dist,splitPoint=i);return{maxError:maxDist,splitPoint:splitPoint}}function FitCubic(d,first,last,tHat1,tHat2,error){var bezCurve,u,uPrime,maxError,splitPoint,iterationError,tHatCenter,i;if(bezCurve=[{},{},{},{}],iterationError=error*error,2===last-first+1){var dist=V2DistanceBetween2Points(d[last],d[first])/3;return bezCurve[0]=d[first],bezCurve[3]=d[last],V2Add(bezCurve[0],V2Scale(tHat1,dist),bezCurve[1]),V2Add(bezCurve[3],V2Scale(tHat2,dist),bezCurve[2]),void DrawBezierCurve(3,bezCurve)}var ret=ComputeMaxError(d,first,last,bezCurve=GenerateBezier(d,first,last,u=ChordLengthParameterize(d,first,last),tHat1,tHat2),u);if(maxError=ret.maxError,splitPoint=ret.splitPoint,maxError<error)DrawBezierCurve(3,bezCurve);else{if(maxError<iterationError)for(i=0;i<4;i++){if(uPrime=Reparameterize(d,first,last,u,bezCurve),bezCurve=GenerateBezier(d,first,last,uPrime,tHat1,tHat2),ret=ComputeMaxError(d,first,last,bezCurve,uPrime),maxError=ret.maxError,splitPoint=ret.splitPoint,maxError<error)return void DrawBezierCurve(3,bezCurve);u=uPrime}FitCubic(d,first,splitPoint,tHat1,tHatCenter=ComputeCenterTangent(d,splitPoint),error),V2Negate(tHatCenter),FitCubic(d,splitPoint,last,tHatCenter,tHat2,error)}}function ComputeLeftTangent(d,end){var tHat1;return tHat1=V2SubII(d[end+1],d[end]),tHat1=V2Normalize(tHat1)}function ComputeRightTangent(d,end){var tHat2;return tHat2=V2SubII(d[end-1],d[end]),tHat2=V2Normalize(tHat2)}var path=new PathData;return path.moveTo(points[0].x,points[0].y),function(d,nPts,error){FitCubic(d,0,nPts-1,ComputeLeftTangent(d,0),ComputeRightTangent(d,nPts-1),error)}(points,points.length,error*error),path}function main(){for(var d=[],j=0;j<10;j++)d.push({x:640*Math.random(),y:480*Math.random()});var canvas=document.createElement("canvas");canvas.width=640,canvas.height=480,canvas.style.borderWidth="1px",canvas.style.borderColor="#000000",canvas.style.borderStyle="solid",canvas.strokeStyle="#000000",canvas.lineWidth=1,document.getElementById("debug").appendChild(canvas);for(var ctx=canvas.getContext("2d"),i=0;i<d.length;i++)ctx.rect(1*d[i].x-2,1*d[i].y-2,4,4);ctx.stroke(),ctx.beginPath();var path=GenerateCurvesFromPoints(d,4);ctx.lineWidth=3,path.draw(ctx),ctx.stroke(),ctx.beginPath(),ctx.lineWidth=1,ctx.strokeStyle="#c0c0ff",path.drawControls(ctx),ctx.stroke()}function DrawTextBehaviour(view){this.view=view,this.editing=!1,this.editBox=null,this.editPoint=null,this.editNodeId=0,this.textPosition="normal"}function BaseNode(id){this.initBase(id,BaseNode)}function DomNode(id){this.initBase(id,DomNode),this.properties.data="",this.element=null,this.dataRequested=""}function GroupNode(name){this.init(name)}function KeyboardMap(){EventEmitter.call(this),this.init()}function Panel(div){this.initPanel(div)}function RandomSequence(seed){this.init(seed)}function PathNode(name){this.init(name)}function PathCommands(commands){this.init(commands)}function CreatePolygonPath(centre,corners,outerRadius,innerRadius){for(var outer=!0,commands=new PathCommands,angle=Math.PI/corners+Math.PI,startx=0,starty=0,i=0;i<corners;i++){var radius=outer?outerRadius:innerRadius,x=centre.x-Math.sin(angle)*radius,y=centre.y-Math.cos(angle)*radius;0===i?(commands.moveTo(x,y),startx=x,starty=y):commands.lineTo(x,y),angle+=2*Math.PI/corners,outer=!outer}return commands.lineTo(startx,starty),commands.close(),commands.toArray()}function CreateCirclePath(center,radius){var commands=new PathCommands;return commands.moveTo(center.x,center.y-radius),commands.cornerTo(center.x+radius,center.y-radius,center.x+radius,center.y),commands.cornerTo(center.x+radius,center.y+radius,center.x,center.y+radius),commands.cornerTo(center.x-radius,center.y+radius,center.x-radius,center.y),commands.cornerTo(center.x-radius,center.y-radius,center.x,center.y-radius),commands.close(),commands.toArray()}function DrawLinesBehaviour(view,isCurves,hasArrow){this.view=view,this.node=null,this.isCurves=isCurves,this.hasArrow=hasArrow}function MoveEditNodeBehaviour(view,node,handle,x,y){this.view=view,this.node=node,this.handle=handle,this.onMouseDown(x,y)}function Overlay(colour,left,top,width,height){this.colour=colour||"transparent",this.left=left||0,this.top=top||0,this.width=width||$(window).width(),this.height=height||$(window).height()}function Menubar(menu,eventSource,popup){this.init(menu,eventSource,popup)}function DefaultBehaviour(view){this.init(view)}function ZwibblerView(canvas,doc,colourPanel,eventSource,config){this.init(canvas,doc,colourPanel,eventSource,config)}function Colour(type,values){if(this.type=type,this.values=values,this.values.length<4)throw"Bad value"}function ColourPanel(parent,size,useTouch,colours){this.init(parent,size,useTouch,colours)}function ColourWheel(size){this.div=document.createElement("div"),this.canvas=document.createElement("canvas"),this.width=size,this.height=size,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.cursor="crosshair",this.ctx=this.canvas.getContext("2d"),this.div.appendChild(this.canvas);var input=document.createElement("input");if(input.setAttribute("type","range"),"range"===input.type)this.div.appendChild(document.createElement("br")),this.div.appendChild(input),input.min=0,input.max=255,input.value=255,this.alphaSlider=input;else{this.nextId=nextIdForColorWheelSlider,this.alphaSlider=null;var id="colourSlider"+this.nextId,colourSlider=Util.Slider.create(id,0,100),sliderEl=colourSlider.getEl();this.div.appendChild(document.createElement("br")),this.div.appendChild(sliderEl),this.colourSlider=colourSlider,this.nextId+=1}if(nextIdForColorWheelSlider=this.nextId,this.outer=this.height,this.inner=.8*this.height,ColourWheel[size])this.data=ColourWheel[size];else{for(var rgb,a,data=this.ctx.getImageData(0,0,this.outer,this.outer),r=this.outer/2,r2=this.inner/2,y=0;y<this.outer;y++){var p,x,s=Math.sqrt(r*r-(y-r)*(y-r)),fromX1=Math.floor(-s+r),toX1=Math.floor(s+r),b=r2*r2-(y-r)*(y-r);if(b>=0){s=Math.sqrt(b);var fromX2=Math.floor(-s+r),toX2=Math.floor(s+r);for(p=y*this.outer*4+4*fromX1,x=fromX1;x<=fromX2;x++)a=Math.atan2(y-r,x-r),rgb=new Colour(Colour.HSVA,[a/Math.PI*180,1,1,1]).convertTo(Colour.RGBA),data.data[p++]=255*rgb.values[0],data.data[p++]=255*rgb.values[1],data.data[p++]=255*rgb.values[2],data.data[p++]=255;for(p=y*this.outer*4+4*toX2,x=toX2;x<=toX1;x++)a=Math.atan2(y-r,x-r),rgb=new Colour(Colour.HSVA,[a/Math.PI*180,1,1,1]).convertTo(Colour.RGBA),data.data[p++]=255*rgb.values[0],data.data[p++]=255*rgb.values[1],data.data[p++]=255*rgb.values[2],data.data[p++]=255}else for(p=y*this.outer*4+4*fromX1,x=fromX1;x<=toX1;x++)a=Math.atan2(y-r,x-r),rgb=new Colour(Colour.HSVA,[a/Math.PI*180,1,1,1]).convertTo(Colour.RGBA),data.data[p++]=255*rgb.values[0],data.data[p++]=255*rgb.values[1],data.data[p++]=255*rgb.values[2],data.data[p++]=255}this.data=data,ColourWheel[size]=data}this.hsv=new Colour(Colour.HSVA,[20,1,1,1]),this.update(),this.draw();var self=this;self.buttonDown=!1,self.mouseArea="",$(this.canvas).mousedown(function(e){var offset=$(self.canvas).offset(),x=e.pageX-offset.left,y=e.pageY-offset.top;self.buttonDown=!0,self.calcClick(x,y),e.stopPropagation(),e.preventDefault()}),$(this.canvas).mousemove(function(e){if(self.buttonDown){var offset=$(self.canvas).offset(),x=e.pageX-offset.left,y=e.pageY-offset.top;self.calcClick(x,y)}e.stopPropagation(),e.preventDefault()}),$(window).mouseup(function(e){self.buttonDown=!1,self.mouseArea=""}),null!==this.alphaSlider?$(this.alphaSlider).change(function(e){self.hsv.values[3]=self.alphaSlider.value/255,self.update(),self.draw()}):colourSlider.onEnd.subscribe(function(e){console.log("Slider start"),self.hsv.values[3]=2.55*this.getValue()/255,self.update(),self.draw()})}function PropertyPanel(config,id){this.config=config,this.initPanel($("<div>")),this.div.addClass("sp_property_panel"),this.SPID=id,this.div.attr("id",id+"_sp_property-panel"),this.wrapperDiv=$("<div>",{class:"sp_property_panel_wrapper"}),this.div.append(this.wrapperDiv);var dragHanldeId=this.SPID+"_property_panel_drag_handle",dragHandle=$("<div>",{class:"sp_drag_panel_handle",title:"Move",id:dragHanldeId}).text("Property Panel");this.makeDraggableElement(this.div,dragHandle,$(".theQuestions")),this.wrapperDiv.append(dragHandle);var self=this,a=$("<a>",{class:"sp_close_panel",title:"Close",href:"#"}).text("Hide Options").click(function(){self.hide()});this.wrapperDiv.append(a);var contentsDiv=$("<div>",{class:"sp_property_panel_contents"});this.contentsDiv=contentsDiv,this.wrapperDiv.append(contentsDiv),this.config=config,this.records=[],this.recordsByName={},this.view=null,this.nodes=[],this.action=null}var __hasProp=Object.prototype.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=Array.prototype.indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(this[i]===item)return i;return-1},__slice=Array.prototype.slice;jQuery.event.special.dbltap={bindType:"touchend",delegateType:"touchend",handle:function(event){var handleObj=event.handleObj,targetData=jQuery.data(event.target),now=(new Date).getTime(),delta=targetData.lastTouch?now-targetData.lastTouch:0,delay=null==delay?300:delay;delta<delay&&delta>30?(targetData.lastTouch=null,event.type=handleObj.origType,["clientX","clientY","pageX","pageY"].forEach(function(property){event[property]=event.originalEvent.changedTouches[0][property]}),handleObj.handler.apply(this,arguments)):targetData.lastTouch=now}};var log=function(key,args){if(console){var i,message=[],format=args[0];if(!log.disabled[key]){var segments=format.split("%s");for(message.push(segments[0]),i=1;i<segments.length;i++)i-1>=args.length-1?message.push("<too few args>"):"string"==typeof args[i]||"number"==typeof args[i]?message.push(args[i]):message.push(JSON.stringify(args[i])),message.push(segments[i]);var joined=message.join("");for(i=0;i<log.listeners.length;i++)log.listeners[i](key,joined)}}};log.disabled={},log.listeners=[],log.enable=function(key,enabled){log.disabled[key]=!enabled},log.create=function(key,enabled){return!1===enabled&&(log.disabled[key]=!0),function(args){log(key,arguments)}},log.addListener=function(listenerFn){log.listeners.push(listenerFn)},log.enableConsole=function(){log.emulatedConsole||log.listeners.push(function(key,message){console.log(key+": "+message)})},"console"in window||(log.emulatedConsole=!0,window.console={log:function(){for(var parts=[],i=0;i<arguments.length;i++)parts.push(JSON.stringify(arguments[i]));for(i=0;i<log.listeners.length;i++)log.listeners[i]("Console",parts.join(""))}},window.console.error=window.console.log),Toolbar.prototype={log:log.create("TOOLBAR"),focus:function(index){this.buttons.length>0&&(arguments.length>0&&(this.buttons[this.focusedIndex].element.removeClass("focus"),this.focusedIndex=index),this.buttons[this.focusedIndex].element.addClass("focus"))},blur:function(){this.buttons.length>0&&this.buttons[this.focusedIndex].element.removeClass("focus")},onKeyCommand:function(action,e){if(0!==this.buttons.length){var change="next"===action||"previous"===action;switch(change&&this.buttons[this.focusedIndex].element.removeClass("focus"),action){case"next":this.focusedIndex=Math.min(this.focusedIndex+1,this.buttons.length-1);break;case"previous":this.focusedIndex=Math.max(this.focusedIndex-1,0);break;case"enter":this.buttons[this.focusedIndex].clickfn(e)}change&&(this.buttons[this.focusedIndex].element.addClass("focus"),e.stopPropagation(),e.preventDefault())}},width:function(){return 50},moveTo:function(x,y){this.div.css("left",x+"px"),this.div.css("top",y+"px")},clearHighlights:function(){console.warn("Clear highlights")},setButtonHighlight:function(name,highlighted){$(".sp_tool_btn").removeClass("sp_tool_btn_select"),$(".sp_tool_"+name).addClass("sp_tool_btn_select")},addButton:function(name,clickfn,col_name,text){var self=this,a=$("<a>",{class:"sp_tool_btn sp_tool_"+name,title:name}).text(text),li=$("<li>",{class:"sp_tool_list_item"}).append(a),index=this.buttons.length;clickfn&&a.on("click touchend",function(evt){evt.stopPropagation(),evt.preventDefault(),self.isReadOnly()||(self.focus(index),clickfn(evt))}),col_name==this.ul_Left.valueOf(0)?this.ul_Left.append(li):this.ul_Right.append(li),this.buttons.push({element:li,clickfn:clickfn})},isReadOnly:function(){return this.zwibblerContext&&this.zwibblerContext.isReadOnly()}};var Url;Url={log:log.create("URL"),unescape:function(string){return string=string.replace(/\+/g," "),window.decodeURIComponent?window.decodeURIComponent(string):unescape(string)},splitQueryString:function(string,separator){var a,fields,i,index,key,value,_i,_len;for(null==separator&&(separator="?"),a={},(index=string.indexOf(separator))>=0&&(string=string.substr(index+1)),(index=string.indexOf("#"))>=0&&(string=string.substr(0,index)),_i=0,_len=(fields=string.split("&")).length;_i<_len;_i++)i=fields[_i].split("="),key=Url.unescape(i[0]),value=i.length>1?Url.unescape(i[1]):"",key.length&&(a[key]=value);return a},encode:function(mapping){var first,key,parts;parts=[],first=!0;for(key in mapping)first||parts.push("&"),first=!1,parts.push(encodeURIComponent(key)),""!==mapping[key]&&(parts.push("="),parts.push(encodeURIComponent(mapping[key])));return parts.join("")},replaceHashValue:function(key,value){var encoded,query;return query=Url.hash(),query[key]=value,encoded=Url.encode(query),window.location.hash=encoded},deleteHashValue:function(key){var encoded,query;return query=Url.hash(),delete query[key],encoded=Url.encode(query),window.location.hash=encoded},setBooleanHashValue:function(key,value){var encoded,query;return query=Url.hash(),value?query[key]="1":delete query[key],encoded=Url.encode(query),window.location.hash=encoded},hash:function(){return Url.splitQueryString(window.location.hash,"#")}};var GetMyScript,ScriptSrc;GetMyScript=function(){var script,scripts;return scripts=document.getElementsByTagName("script"),script=scripts[scripts.length-1],0!==script.getAttribute.length?script.src:script.getAttribute("src",-1)},ScriptSrc=GetMyScript();var Config=function(options){var key,name,query,touch;this.options={backgroundImage:null,debug:!1,defaultArrowHeadSize:"Medium",defaultBrushColour:"#ff0000",defaultBrushThickness:"Brush",defaultFillStyle:"#00ff00",defaultFont:"Arial",defaultFontSize:20,defaultOutlineColour:"#000000",defaultOutlineThickness:"Pen",defaultSmoothness:"smooth",defaultTextColour:"#000000",defaultShadow:!1,fonts:["Arial","Times New Roman"],imageFolder:"$SCRIPT/images",nudge:10,showArrowTool:!0,showArrowHeadSizeProperty:!0,showBackgroundSelector:!1,showBrushColourProperty:!0,showBrushThicknessProperty:!0,showBrushTool:!0,showCircleTool:!0,showColourPanel:!0,showCopyPaste:!0,showCurveTool:!0,showDebug:!1,showFillColourProperty:!0,showFontProperty:!0,showFontSizeProperty:!0,showFreeformCurveTool:!1,showImageSelector:!1,showImageTool:!1,showLineTool:!0,showMathTool:!0,showMenu:!1,showOutlineColourProperty:!0,showOutlineThicknessProperty:!0,showPickTool:!0,showPropertyPanel:!1,showShadowProperty:!0,showSquareTool:!0,showKeyboardHelp:!0,showTextColourProperty:!0,showTextTool:!0,showUndoRedo:!0,showDeleteButton:!0,sloppy:!0,snap:0,useTouch:"auto",canvasSize:""};for(name in options)if(name&&"function"!=typeof options[name])if(name in this.options){var oldValue=this.options[name],newValue=options[name];"string"==typeof oldValue||("number"==typeof oldValue?newValue=parseFloat(newValue):"boolean"==typeof oldValue&&(newValue="true"===newValue)),this.options[name]=newValue}else"@xmlns"!=name&&console.error("Zwibbler: Unknown option: ",name,options[name]);query=Url.hash();for(name in query)"number"==typeof this.options[name]?this.options[name]=parseFloat(query[name]):"boolean"==typeof this.options[name]?this.options[name]="true"===query[name]:this.options[name]=query[name];""===this.getScriptFolder()?(this.imageFolder=this.options.imageFolder.replace("$SCRIPT/",""),this.imageFolder=this.imageFolder.replace("$SCRIPT","")):this.imageFolder=this.options.imageFolder.replace("$SCRIPT",this.getScriptFolder()),""!==this.imageFolder&&"/"!==this.imageFolder[this.imageFolder.length-1]&&(this.imageFolder+="/"),"auto"===this.options.useTouch&&(touch="ontouchstart"in window||"onmsgesturechange"in window,this.log("Detected touch support: %s",touch));for(key in this.options)"function"!=typeof this.options[key]&&this.log("%s=%s",key,this.options[key])};Config.prototype.log=log.create("CONFIG"),Config.prototype.getScriptFolder=function(){var i,src;return src=ScriptSrc,i=src.lastIndexOf("/"),src=i>=0?src.substr(0,i+1):""},Config.prototype.hasMenu=function(){return this.options.showMenu},Config.prototype.showFreeformCurveTool=function(){return this.options.showFreeformCurveTool},Config.prototype.showBrushTool=function(){return this.options.showBrushTool},Config.prototype.showPropertyPanel=function(){return this.options.showPropertyPanel},Config.prototype.showColourPanel=function(){return this.options.showColourPanel},Config.prototype.showKeyboardHelp=function(){return this.options.showKeyboardHelp},Config.prototype.showDebug=function(){return this.options.showDebug},Config.prototype.getOption=function(name){return this.options[name]},Config.prototype.get=function(name){return this.getOption(name)},Config.prototype.useTouch=function(){return"auto"===this.options.useTouch?"ontouchstart"in window||"onmsgesturechange"in window:this.options.useTouch},Config.prototype.getDefaultSmoothness=function(){var smoothness;return"sharper"===(smoothness=(""+this.options.defaultSmoothness).toLowerCase())?.1:"sharp"===smoothness?.2:"smoothest"===smoothness?.5:.3},Config.prototype.getThickness=function(name){var thickness;return"pencil"===(thickness=(""+this.options[name]).toLowerCase())?1:"pen"===thickness?2:"marker"===thickness?4:"brush"===thickness?10:0},Config.prototype.getDefaultBrushThickness=function(){return this.getThickness("defaultBrushThickness")},Config.prototype.getDefaultOutlineThickness=function(){return this.getThickness("defaultOutlineThickness")},Config.prototype.getDefaultArrowSize=function(){var size;return"tiny"===(size=(""+this.options.defaultArrowHeadSize).toLowerCase())?10:"small"===size?15:"medium"===size?20:"large"===size?30:0},Config.prototype.getImageUrl=function(icon){return this.imageFolder+icon};var Transaction=function(parentid,actions,base,data){this.parentid=parentid,this.actions=actions,this.base=base,this.id="-1"};Transaction.prototype.log=log.create("TRANS",!0),Transaction.prototype.getId=function(){return this.id},Transaction.prototype.getParentId=function(){return this.parentid},Transaction.prototype.rename=function(replacer){var _i,_len,_ref;for(_i=0,_len=(_ref=this.actions).length;_i<_len;_i++)_ref[_i].rename(replacer)},MoveSegment.prototype={init:function(previous,to){this.to=to},draw:function(ctx){ctx.moveTo(this.to.x,this.to.y)},drawControls:function(ctx){},outline:function(points,error){points.push(this.to)},startSlope:function(){return null},endSlope:function(){return{x:1,y:0}}},LineSegment.prototype={init:function(previous,to,randomSeq,sloppiness){this.to=to,this.previous=previous;var offset=CalcLineLength(this.previous.to.x,this.previous.to.y,this.to.x,this.to.y)/10*sloppiness;offset>10&&(offset=10);var r1=randomSeq.next(),r2=randomSeq.next(),r3=randomSeq.next();this.to.x=this.to.x+sloppiness*r1*offset/4,this.to.y=this.to.y+sloppiness*r2*offset/4;var t1X=this.previous.to.x,t1Y=this.previous.to.y,t2X=this.to.x,t2Y=this.to.y;t1X+=offset,t2X+=offset,t1Y+=offset,t2Y+=offset,this.control1=new Point(t1X+r2*(t2X-t1X),t1Y+r2*(t2Y-t1Y)),t1X=this.previous.to.x-offset,t2X=this.to.x-offset,t1Y=this.previous.to.y-offset,t2Y=this.to.y-offset,this.control2=new Point(t1X+r3*(t2X-t1X),t1Y+r3*(t2Y-t1Y))},draw:function(ctx){ctx.bezierCurveTo(this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y)},drawControls:function(ctx){DrawSegmentControls(ctx,this)},outline:function(points,error){bezier(points,this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y,error)},startSlope:function(){return this.previous?CreateVector(this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y):null},endSlope:function(){return CreateVector(this.control2.x,this.control2.y,this.to.x,this.to.y)}},CurveSegment.prototype={init:function(previous,to,smoothness){this.to=to,this.previous=previous,this.smoothness=smoothness;var length=CalcLineLength(previous.to.x,previous.to.y,to.x,to.y);length||(length=1);var vx=(to.x-previous.to.x)/length,vy=(to.y-previous.to.y)/length;this.control2=new Point(to.x-length*smoothness*vx,to.y-length*smoothness*vy);var pcontrol2=previous.control2;if(pcontrol2){var slope=CreateVector(previous.previous.to.x,previous.previous.to.y,previous.to.x,previous.to.y),plength=CalcLineLength(previous.previous.to.x,previous.previous.to.y,previous.to.x,previous.to.y);vx=.5*(vx+slope.x),vy=.5*(vy+slope.y),pcontrol2.x=previous.to.x-plength*smoothness*vx,pcontrol2.y=previous.to.y-plength*smoothness*vy}this.control1=new Point(previous.to.x+length*smoothness*vx,previous.to.y+length*smoothness*vy),this.length=length},setPrevious:function(previous){this.previous=previous;var pcontrol2=previous.control2,vx=(this.to.x-previous.to.x)/this.length,vy=(this.to.y-previous.to.y)/this.length,smoothness=this.smoothness;if(pcontrol2){var slope=CreateVector(previous.previous.to.x,previous.previous.to.y,previous.to.x,previous.to.y),plength=CalcLineLength(previous.previous.to.x,previous.previous.to.y,previous.to.x,previous.to.y);vx=.5*(vx+slope.x),vy=.5*(vy+slope.y),pcontrol2.x=previous.to.x-plength*smoothness*vx,pcontrol2.y=previous.to.y-plength*smoothness*vy}this.control1=new Point(previous.to.x+this.length*smoothness*vx,previous.to.y+this.length*smoothness*vy)},draw:function(ctx){ctx.bezierCurveTo(this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y)},drawControls:function(ctx){DrawSegmentControls(ctx,this)},outline:function(points,error){bezier(points,this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y,error)},startSlope:function(){return this.previous?CreateVector(this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y):null},endSlope:function(){return CreateVector(this.control2.x,this.control2.y,this.to.x,this.to.y)}},QuadraticSegment.prototype={init:function(previous,control,to){this.control=control,this.to=to},draw:function(ctx){ctx.quadraticCurveTo(this.control.x,this.control.y,this.to.x,this.to.y)},drawControls:function(ctx){DrawSegmentControls(ctx,this)},outline:function(points,error){points.push(this.control),points.push(this.to)},startSlope:function(){return this.previous?CreateVector(this.previous.to.x,this.previous.to.y,this.control.x,this.control.y):null},endSlope:function(){return CreateVector(this.control.x,this.control.y,this.to.x,this.to.y)}},ArcSegment.prototype={init:function(previous,control,to,radius){this.control=control,this.to=to,this.radius=radius},draw:function(ctx){ctx.arcTo(this.control.x,this.control.y,this.to.x,this.to.y,this.radius)},drawControls:function(ctx){DrawSegmentControls(ctx,this)},outline:function(points,error){points.push(this.control),points.push(this.to)}},BezierSegment.prototype={init:function(previous,control1,control2,to){this.control1=control1,this.control2=control2,this.to=to,this.previous=previous},draw:function(ctx){ctx.bezierCurveTo(this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y)},drawControls:function(ctx){DrawSegmentControls(ctx,this)},outline:function(points,error){bezier(points,this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y,error)},startSlope:function(){return this.previous?CreateVector(this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y):null},endSlope:function(){return CreateVector(this.control2.x,this.control2.y,this.to.x,this.to.y)}},CornerSegment.prototype={log:log.create("SEGMENT"),init:function(previous,corner,to,randomSequence,sloppiness){var KAPPA=.5522847498;this.previous=previous,sloppiness*=2;var r1=2*randomSequence.next()-1,r2=2*randomSequence.next()-1,slope=this.previous.endSlope();if(slope){var radius=CalcLineLength(previous.to.x,previous.to.y,corner.x,corner.y);this.control1=new Point(previous.to.x+slope.x*KAPPA*radius,previous.to.y+slope.y*KAPPA*radius)}else this.control1=new Point(previous.to.x+KAPPA*(corner.x-previous.to.x),previous.to.y+KAPPA*(corner.y-previous.to.y));this.control2=new Point(to.x-KAPPA*(to.x-corner.x)*(1-r1*sloppiness),to.y-KAPPA*(to.y-corner.y)*(1-r2*sloppiness)),this.to=to},draw:function(ctx){ctx.bezierCurveTo(this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y)},drawControls:function(ctx){DrawSegmentControls(ctx,this)},outline:function(points,error){bezier(points,this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.to.x,this.to.y,error)},startSlope:function(){return this.previous?CreateVector(this.previous.to.x,this.previous.to.y,this.control1.x,this.control1.y):null},endSlope:function(){return CreateVector(this.control2.x,this.control2.y,this.to.x,this.to.y)}},SelectBoxBehaviour.prototype={log:log.create("SelectBehaviour"),onTouch:function(e){var pt;"touchmove"===e.type?(pt=this.view.touchPoint(e.changedTouches[0]),this.onMouseMove(pt.x,pt.y)):"touchend"===e.type&&(pt=this.view.touchPoint(e.changedTouches[0]),this.onMouseUp(pt.x,pt.y))},onMouseDown:function(x,y){this.dx=x,this.dy=y,this.dragging=!0},onMouseMove:function(x,y){if(this.dragging){var ctx=this.view.ctx;this.view.draw(),ctx.save(),ctx.strokeStyle="#0050B7",ctx.lineWidth=2/this.view.scale,ctx.fillStyle="rgba(0, 80, 183, 0.2)";var rect=new Rectangle(this.dx+.5,this.dy+.5,x-this.dx,y-this.dy);ctx.fillRect(rect.x,rect.y,rect.width,rect.height),ctx.strokeRect(rect.x,rect.y,rect.width,rect.height),ctx.restore()}},onMouseUp:function(x,y){this.dragging=!1,this.view.clearSelection(),this.view.selectByRect(new Rectangle(this.dx,this.dy,x-this.dx,y-this.dy)),this.view.doneSelecting(),this.view.draw(),this.view.behaviour=this.previousBehaviour}};var ZwibblerContext=function(app){this.app=app,this.app=app,this.events={},this.app.setZwibblerContext(this),this.id=""+ZwibblerContext.nextId,ZwibblerContext.nextId+=1};ZwibblerContext.nextId=0,ZwibblerContext.prototype.enableConsoleLogging=function(){log.enableConsole()},ZwibblerContext.prototype.emit=function(name,var_args){var args;return this.events||(this.events={}),args=Array.prototype.slice.call(arguments,1),setTimeout(__bind(function(){var _i,_len,_ref;if(name in this.events)for(_i=0,_len=(_ref=this.events[name]).length;_i<_len;_i++)_ref[_i].apply(null,args)},this),0),this},ZwibblerContext.prototype.on=function(name,fn){return name in this.events?this.events[name].push(fn):this.events[name]=[fn],this},ZwibblerContext.prototype.newDocument=function(){return this.app.newDocument()},ZwibblerContext.prototype.isValid=function(){var docNodes=this.app.view.doc.nodes,nitems=0;for(var p in docNodes)if(docNodes.hasOwnProperty(p)&&"GroupNode"!==docNodes[p].type()&&"ImageNode"!==docNodes[p].type()&&++nitems,nitems>0)return!0;return!1},ZwibblerContext.prototype.getResponseXml=function(){return this.save("xml")},ZwibblerContext.prototype.setResponseXml=function(contents){return this.load("xml",contents)},ZwibblerContext.prototype.save=function(format){return"list"===format?this.app.saveAsList():"png"===format?this.app.saveAsDataUrl():"zwibbler3"===format||0===arguments.length?this.app.view.doc.save("zwibbler3"):"xml"===format?this.app.view.doc.getResponseXml():"Unsupported format: "+format},ZwibblerContext.prototype.load=function(format,data){if("list"===format)return this.app.loadFromList(data);if("xml"===format){for(var eqParent=this.app.canvasContainer[0],eqItems=YAHOO.util.Dom.getElementsByClassName("mje_container","div",eqParent),i=0;i<eqItems.length;i++)eqParent.removeChild(eqItems[i]);return this.app.newDocument(),this.app.setBackgroundImageFromConfig(),this.app.loadFromList(this.app.view.doc.processResponseXml(data))}return this.app.setDocument(ZwibblerDocument.load(data))},ZwibblerContext.prototype.setBackgroundBrowserImages=function(urls){return this.app.setBackgroundImageList(urls)},ZwibblerContext.prototype.setIconBrowserImages=function(urls){return this.app.setIconBrowserList(urls)},ZwibblerContext.prototype.resize=function(){return this.app._onResize()},ZwibblerContext.prototype.dirty=function(){return 1===arguments.length&&!1===arguments[0]&&this.app.view.doc.markClean(),this.app.view.doc.dirty()},ZwibblerContext.prototype.setItemProperty=function(id,property,value){this.app.setItemProperty(id,property,value)},ZwibblerContext.prototype.setImage=function(id,img){var doc=this.app.view.doc,view=this.app.view,node=doc.getNode(id,!0);"MathNode"===node.type()?(node.setImage(img),view.update()):this.log("setImage() error: node %s is of type %s",id,node.type())},ZwibblerContext.prototype.getItemProperty=function(id,property){return this.app.getItemProperty(id,property)},ZwibblerContext.prototype.setDomElement=function(nodeid,element){var node=this.app.view.doc.getNode(nodeid);node||this.error("setDomElement: Node %s does not exist",nodeid),"DomNode"!==node.type()&&this.error("setDomElement: Node %s is not a DomNode. It is %s",nodeid,node.type()),node.setElement(element)},ZwibblerContext.prototype.error=function(formatString,var_args){for(var parts=arguments[0].split("%s"),message=[],i=0;i<parts.length;i++)message.push(parts[i]),i<parts.length-1&&message.push(JSON.stringify(arguments[i+1]));throw this.log(message.join("")),{message:message,toString:function(){return message}}},ZwibblerContext.prototype.setInstanceId=function(id){this.id=id},ZwibblerContext.prototype.getInstanceId=function(){return this.id},ZwibblerContext.prototype.isReadOnly=function(){return!1};var Cookies;Cookies={log:log.create("Cookies"),set:function(name,value,secondsValid){var date,str;null==secondsValid&&(secondsValid=31536e3),(date=new Date).setTime(date.getTime()+1e3*secondsValid),str=(name=encodeURIComponent(name))+"="+(value=encodeURIComponent(value))+"; expires="+date.toGMTString()+"; path=/",Cookies.log("Set document.cookie=%s",str),document.cookie=str},get:function(name){var cookie,i,_i,_len,_ref;for(name=encodeURIComponent(name),_i=0,_len=(_ref=document.cookie.split(";")).length;_i<_len;_i++){for(cookie=_ref[_i],i=0;i<cookie.length&&" "===cookie[i];)i+=1;if(cookie.indexOf(name+"=")===i)return decodeURIComponent(cookie.substr(i+name.length+1))}return null},remove:function(name){return Cookies.set(name,"",-1)},test:function(){return Cookies.set("steve","blah blah"),Cookies.set("alice","wife"),Cookies.log("Steve=%s",Cookies.get("steve")),Cookies.log("Alice=%s",Cookies.get("alice")),Cookies.remove("steve"),Cookies.log("Steve=%s",Cookies.get("steve"))}};var EventEmitter=function(){this.events={},this.nolog=!1};EventEmitter.prototype.log=log.create("EventEmitter"),EventEmitter.prototype.emit=function(name,var_args){var args;return this.events||(this.events={}),args=Array.prototype.slice.call(arguments,1),setTimeout(__bind(function(){var fn,_i,_len,_ref;if(name in this.events)for(_i=0,_len=(_ref=this.events[name]).length;_i<_len;_i++)fn=_ref[_i],this.nolog||this.log("Emit %s",name),fn.apply(null,args)},this),0),this},EventEmitter.prototype.emitNow=function(name,var_args){var args;this.events||(this.events={}),args=Array.prototype.slice.call(arguments,1);var fn,_i,_len,_ref;if(name in this.events)for(_i=0,_len=(_ref=this.events[name]).length;_i<_len;_i++)fn=_ref[_i],this.nolog||this.log("Emit %s",name),fn.apply(null,args);return this},EventEmitter.prototype.on=function(name,fn){return this.events||(this.events={}),this.bind(name,fn),this},EventEmitter.prototype.bind=function(name,fn){return name in this.events?this.events[name].push(fn):this.events[name]=[fn],fn},EventEmitter.prototype.unbind=function(name,fn){var arr,i,_ref;if(name in this.events)for(i=0,_ref=(arr=this.events[name]).length-1;i<=_ref;i+=1)if(arr[i]===fn){arr.splice(i,1);break}},EventEmitter.prototype.joinEvents=function(emitter){var key;if(emitter.events!==this.events){for(key in emitter.events)key in this.events?this.events[key]=this.events[key].concat(emitter.events[key]):this.events[key]=emitter.events[key];emitter.events=this.events}};var Menu=function(){this.items=[]};Menu.prototype.addItem=function(display,event,eventData){return this.items.push({type:"normal",display:display,event:event,eventData:eventData})},Menu.prototype.addSeparator=function(){return this.items.push({type:"separator"})},Menu.prototype.addSubmenu=function(display,menu){return this.items.push({type:"menu",display:display,menu:menu})};var RandomString=function(length){for(var digits="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890",usernameChars=[],i=0;i<length;i++)usernameChars.push(digits[Math.floor(Math.random()*digits.length)]);return usernameChars.join("")};"object"==typeof module&&(exports.RandomString=RandomString),Point.prototype.distanceTo=function(point){return Math.sqrt((point.x-this.x)*(point.x-this.x)+(point.y-this.y)*(point.y-this.y))},Point.prototype.toString=function(){return"("+this.x+", "+this.y+")"},Rectangle.load=function(s){return new Rectangle(s.x,s.y,s.width,s.height)},Rectangle.CreateBoundingBox=function(points){if(0===points.length)return new Rectangle(0,0,0,0);for(var minX=points[0].x,maxX=points[0].x,minY=points[0].y,maxY=points[0].y,i=1;i<points.length;i++)points[i].x<minX&&(minX=points[i].x),points[i].x>maxX&&(maxX=points[i].x),points[i].y<minY&&(minY=points[i].y),points[i].y>maxY&&(maxY=points[i].y);return new Rectangle(minX,minY,maxX-minX,maxY-minY)},Rectangle.prototype={save:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},union:function(other){other.x<this.x&&(this.width+=this.x-other.x,this.x=other.x),other.y<this.y&&(this.height+=this.y-other.y,this.y=other.y),other.x+other.width>this.x+this.width&&(this.width+=other.x+other.width-this.x-this.width),other.y+other.height>this.y+this.height&&(this.height+=other.y+other.height-this.y-this.height)},unionPoint:function(x,y){x<this.x?(this.width+=this.x-x,this.x=x):x>this.x+this.width&&(this.width=x-this.x),y<this.y?(this.height+=this.y-y,this.y=y):y>this.y+this.height&&(this.height=y-this.y)},contains:function(other){return this.x<=other.x&&this.x+this.width>other.x+other.width&&this.y<=other.y&&this.y+this.height>other.y+other.height},containsPoint:function(x,y){return this.x<=x&&this.x+this.width>x&&this.y<=y&&this.y+this.height>y},repair:function(){this.width<0&&(this.x+=this.width,this.width=-this.width),this.height<0&&(this.y+=this.height,this.height=-this.height)},inflate:function(dx,dy){this.x-=dx/2,this.y-=dy/2,this.width+=dx,this.height+=dy},transform:function(matrix){var tl,tr,bl,br;tl=matrix.apply(this.x,this.y),tr=matrix.apply(this.x+this.width,this.y),br=matrix.apply(this.x+this.width,this.y+this.height),bl=matrix.apply(this.x,this.y+this.height),this.x=Math.min(tl.x,tr.x,br.x,bl.x),this.y=Math.min(tl.y,tr.y,br.y,bl.y),this.width=Math.max(tl.x,tr.x,br.x,bl.x)-this.x,this.height=Math.max(tl.y,tr.y,br.y,bl.y)-this.y},right:function(){return this.x+this.width},bottom:function(){return this.y+this.height},centre:function(){return new Point(this.x+this.width/2,this.y+this.height/2)}},Matrix.prototype.toString=function(){return"[ "+this.m11+" "+this.m12+" "+this.dx+"\n   "+this.m21+" "+this.m22+" "+this.dy+"\n   0 0 1 ]"},Matrix.prototype.toArray=function(){return[this.m11,this.m12,this.m21,this.m22,this.dx,this.dy]},Matrix.prototype.toCssTransformString=function(){return"matrix("+[this.m11,this.m21,this.m12,this.m22,this.dx,this.dy].join(", ")+")"},Matrix.prototype._class="Matrix",Matrix.prototype.isIdentity=function(){return 1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22&&0===this.dx&&0===this.dy},Matrix.prototype.multiply=function(o){var m=new Matrix;return m.m11=this.m11*o.m11+this.m12*o.m21,m.m21=this.m21*o.m11+this.m22*o.m21,m.m12=this.m11*o.m12+this.m12*o.m22,m.m22=this.m21*o.m12+this.m22*o.m22,m.dx=this.m11*o.dx+this.m12*o.dy+this.dx,m.dy=this.m21*o.dx+this.m22*o.dy+this.dy,m},Matrix.prototype.apply=function(x,y){return new Point(this.m11*x+this.m12*y+this.dx,this.m21*x+this.m22*y+this.dy)},Matrix.prototype.applyWRTContext=function(x,y,ctx){return this.m11*x+this.dx<0?this.dx+=10:this.m11*x+this.dx>ctx.canvas.width?this.dx-=10:this.m22*y+this.dy<0?this.dy+=10:this.m22*y+this.dy>ctx.canvas.height&&(this.dy-=10),new Point(this.m11*x+this.m12*y+this.dx,this.m21*x+this.m22*y+this.dy)},Matrix.prototype.clone=function(){return new Matrix(this.m11,this.m12,this.m21,this.m22,this.dx,this.dy)},Matrix.prototype.inverse=function(){var det=this.m11*this.m22-this.m12*this.m21;return new Matrix(this.m22/det,-this.m12/det,-this.m21/det,this.m11/det,(this.m12*this.dy-this.dx*this.m22)/det,(this.dx*this.m21-this.m11*this.dy)/det)},ScaleMatrix.prototype.inverse=function(){return new ScaleMatrix(1/this.sx,1/this.sy,this.ox,this.oy)},Inherit(Matrix.prototype,ScaleMatrix.prototype),RotateMatrix.prototype.inverse=function(){return new RotateMatrix(-this.angle,this.x,this.y)},Inherit(Matrix.prototype,RotateMatrix.prototype),TranslateMatrix.prototype.inverse=function(){return new TranslateMatrix(-this.dx,-this.dy)},Inherit(Matrix.prototype,TranslateMatrix.prototype),recursive_bezier.depth=0,ImageManipulator.prototype={clear:function(){for(var i=0;i<this.image.width*this.image.height*4;i++)this.image.data[i]=0},getImageData:function(){return this.image},width:function(){return this.image.width},height:function(){return this.image.height},get:function(x,y){var i=this.image.width*y*4+4*x;return this.image.data[i]|this.image.data[i+1]<<8|this.image.data[i+2]<<16|this.image.data[i+3]<<24},set:function(x,y,clr){var i=this.image.width*y*4+4*x;this.image.data[i]=255&clr,this.image.data[i+1]=clr>>8&255,this.image.data[i+2]=clr>>16&255,this.image.data[i+3]=clr>>24&255},invertScanline:function(y,x1,x2){}},BitmapImage.prototype={width:function(){return this._width},height:function(){return this._height},getImageData:function(){var canvas=document.createElement("canvas");canvas.width=this._width,canvas.height=this._height;for(var image=canvas.getContext("2d").getImageData(0,0,this._width,this._height),size=this._width*this._height,i=0;i<size;i++){var clr=!0===this.data[i]?255:0;image.data[4*i]=clr,image.data[4*i+1]=clr,image.data[4*i+2]=clr,image.data[4*i+3]=255}return image},get:function(x,y){return!0===this.data[this._width*y+x]},set:function(x,y,isSet){this.data[this._width*y+x]=isSet},invertScanline:function(y,x1,x2){for(var start=this._width*y+x1,end=this._width*y+x2,i=start;i<end;i++)this.data[i]=!this.data[i]},findFirstOnPixel:function(){for(var i=0;i<this.data.length-1;i++)if(this.data[i+1])return{x:i%this._width,y:Math.floor(i/this._width)};return null}},PathData.MOVE=0,PathData.LINE=1,PathData.BEZIER_CURVE=2,PathData.CLOSE=4,PathData.SizeOf=[3,3,7,1],PathData.NumPoints=[1,1,3,0],PathData.prototype={save:function(){var s={};return s.strokeStyle=this.strokeStyle,s.fillStyle=this.fillStyle,s.lineWidth=this.lineWidth,s.d=this.commands.concat(),s},load:function(s){this.commands=s.d,this.strokeStyle=s.strokeStyle,this.fillStyle=s.fillStyle,this.lineWidth=s.lineWidth},moveTo:function(x,y){this.commands.push(PathData.MOVE,x,y)},lineTo:function(x,y){this.commands.push(PathData.LINE,x,y)},bezierCurveTo:function(x2,y2,x3,y3,x4,y4){this.commands.push(PathData.BEZIER_CURVE,x2,y2,x3,y3,x4,y4)},close:function(){this.commands.push(PathData.CLOSE)},draw:function(ctx){for(var i=0;i<this.commands.length;){switch(this.commands[i]){case PathData.MOVE:ctx.moveTo(this.commands[i+1],this.commands[i+2]);break;case PathData.LINE:ctx.lineTo(this.commands[i+1],this.commands[i+2]);break;case PathData.BEZIER_CURVE:ctx.bezierCurveTo(this.commands[i+1],this.commands[i+2],this.commands[i+3],this.commands[i+4],this.commands[i+5],this.commands[i+6]);break;case PathData.CLOSE:ctx.closePath();break;default:console.error("Error!")}i+=PathData.SizeOf[this.commands[i]]}void 0!==this.lineWidth&&(ctx.lineWidth=this.lineWidth),void 0!==this.fillStyle&&(ctx.fillStyle=this.fillStyle),void 0!==this.strokeStyle&&(ctx.strokeStyle=this.strokeStyle)},drawControls:function(ctx){for(var i=0,x=0,y=0;i<this.commands.length;){switch(this.commands[i]){case PathData.MOVE:case PathData.LINE:x=this.commands[i+1],y=this.commands[i+2];break;case PathData.BEZIER_CURVE:ctx.rect(x-2,y-2,4,4),ctx.moveTo(x,y),ctx.lineTo(this.commands[i+1],this.commands[i+2]),ctx.moveTo(this.commands[i+3],this.commands[i+4]),ctx.lineTo(this.commands[i+5],this.commands[i+6]),x=this.commands[i+5],y=this.commands[i+6];break;case PathData.CLOSE:ctx.closePath()}i+=PathData.SizeOf[this.commands[i]]}},transform:function(matrix){for(var j,numPoints,i=0;i<this.commands.length;){for(numPoints=PathData.NumPoints[this.commands[i]],j=0;j<numPoints;j++){var pt=matrix.apply(this.commands[i+1+2*j],this.commands[i+1+2*j+1]);this.commands[i+1+2*j]=pt.x,this.commands[i+1+2*j+1]=pt.y}i+=PathData.SizeOf[this.commands[i]]}},clone:function(){var newPath=new PathData;return newPath.commands=this.commands.concat(),newPath.fillStyle=this.fillStyle,newPath.strokeStyle=this.strokeStyle,newPath},calcBoundingRect:function(tolerance){for(var x,y,i=0,rect=new Rectangle(this.commands[1],this.commands[2],0,0);i<this.commands.length;){switch(this.commands[i]){case PathData.MOVE:case PathData.LINE:x=this.commands[i+1],y=this.commands[i+2],rect.unionPoint(x,y);break;case PathData.BEZIER_CURVE:var points=[];bezier(points,x,y,this.commands[i+1],this.commands[i+2],this.commands[i+3],this.commands[i+4],this.commands[i+5],this.commands[i+6],tolerance);for(var j=0;j<points.length;j++)rect.unionPoint(points[j].x,points[j].y)}i+=PathData.SizeOf[this.commands[i]]}return rect},append:function(otherPath){this.commands=this.commands.concat(otherPath.commands)}},Polygon.prototype={transform:function(matrix){for(var i=0;i<this.points.length;i++)this.points[i]=matrix.apply(this.points[i].x,this.points[i].y)},transformWRTContext:function(matrix,ctx){for(var i=0;i<this.points.length;i++)this.points[i]=matrix.applyWRTContext(this.points[i].x,this.points[i].y,ctx)},containsPoint:function(x,y,radius){return PointInPolygon(this.points,x,y)}},TransformSelectionBehaviour.prototype={log:log.create("TransformSelectionBehaviour"),onTouch:function(e){var touch,i,point;if(!this.haveGesture){for(i=0;i<e.touches.length;){touch=e.touches[i],point=this.view.screenPoint(touch.pageX,touch.pageY),"touchmove"===e.type&&this.onMouseMove(point.x,point.y);break}for(i=0;i<e.changedTouches.length;){touch=e.changedTouches[i],point=this.view.screenPoint(touch.pageX,touch.pageY),"touchend"===e.type&&this.onMouseUp(point.x,point.y);break}}},onGesture:function(e){this.log("%s scale=%s rotation=%s",e.type,e.scale,e.rotation),this.haveGesture=!0;var i,cx=this.selRect.x+this.selRect.width/2,cy=this.selRect.y+this.selRect.height/2,scale=new ScaleMatrix(e.scale,e.scale,cx,cy),rotate=new RotateMatrix(-e.rotation/180*Math.PI,cx,cy),xform=scale.multiply(rotate),inverse=xform.inverse();for(i=0;i<this.nodes.length;i++)this.nodes[i].setMatrix(xform.multiply(this.matrices[i]),this.inverses[i].multiply(inverse)),this.nodes[i].format(this.view.ctx,this.view.request);if(this.view.transformSelectHandles(xform),this.view.draw(),"gestureend"===e.type){for(i=0;i<this.nodes.length;i++)this.nodes[i].setMatrix(this.matrices[i],this.inverses[i]);this.view.commit([new TransformAction(GetNodeIds(this.nodes),xform,xform.inverse())]),this.exit()}},onMouseDown:function(x,y){this.log("onMouseDown");var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y,this.dx=x,this.dy=y,this.nodes=this.view.getSelectedNodes(),this.extractMatrices(this.nodes),this.selRect=new Rectangle(this.view.selectionBounds.x,this.view.selectionBounds.y,this.view.selectionBounds.width,this.view.selectionBounds.height),this.handle===this.view.ROT&&(this.cx=this.selRect.x+this.selRect.width/2,this.cy=this.selRect.y+this.selRect.height/2,this.startAngle=Math.atan2(this.cy-y,x-this.cx))},extractMatrices:function(nodes){this.matrices=[],this.inverses=[];for(var i=0;i<nodes.length;i++)this.matrices.push(nodes[i].getMatrix()),this.inverses.push(nodes[i].getInverseMatrix())},getTransform:function(x,y){var xform,offsetX=x-this.dx,offsetY=y-this.dy;switch(this.handle){case this.view.NE:xform=new ScaleMatrix((x-this.selRect.x)/this.selRect.width,(this.selRect.y+this.selRect.height-y)/this.selRect.height,this.selRect.x,this.selRect.y+this.selRect.height);break;case this.view.SE:xform=new ScaleMatrix((x-this.selRect.x)/this.selRect.width,(y-this.selRect.y)/this.selRect.height,this.selRect.x,this.selRect.y);break;case this.view.SW:xform=new ScaleMatrix((this.selRect.x+this.selRect.width-x)/this.selRect.width,(y-this.selRect.y)/this.selRect.height,this.selRect.x+this.selRect.width,this.selRect.y);break;case this.view.NW:xform=new ScaleMatrix((this.selRect.x+this.selRect.width-x)/this.selRect.width,(this.selRect.y+this.selRect.height-y)/this.selRect.height,this.selRect.x+this.selRect.width,this.selRect.y+this.selRect.height);break;case this.view.ROT:xform=new RotateMatrix(Math.atan2(this.cy-y,x-this.cx)-this.startAngle,this.cx,this.cy);break;default:xform=new TranslateMatrix(offsetX,offsetY)}return xform},onMouseMove:function(x,y){var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y;for(var xform=this.getTransform(x,y),inverse=xform.inverse(),i=0;i<this.nodes.length;i++)this.nodes[i].setMatrix(xform.multiply(this.matrices[i]),this.inverses[i].multiply(inverse)),this.nodes[i].format(this.view.ctx,this.view.request);if(this.view.transformSelectHandles(xform),this.handle===this.view.ROT&&(this.view.rotHandleX=x,this.view.rotHandleY=y),this.view.draw(),this.handle===this.view.ROT){var ctx=this.view.ctx;ctx.save(),ctx.beginPath(),ctx.strokeStyle="#0050B7",ctx.lineWidth=1/this.view.scale,ctx.moveTo(this.cx,this.cy),ctx.lineTo(x,y),ctx.stroke(),ctx.restore()}},onMouseUp:function(x,y){this.log("onMouseUp");var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y;var node;if(x!==this.dx||y!==this.dy){for(var xform=this.getTransform(x,y),i=0;i<this.nodes.length;i++)this.nodes[i].setMatrix(this.matrices[i],this.inverses[i]);this.view.commit([new TransformAction(GetNodeIds(this.nodes),xform,xform.inverse())])}else this.toggleEditNode&&(node=this.view.doc.hittest(x,y))&&node.hasEditMode()&&(this.log("Didn't move, and has edit mode. Selecting node %s",node.id),this.view.clearSelection(),this.view.setEditNode(node));this.exit()},exit:function(){this.view.transformSelectHandles(new Matrix),this.view.showRotationHandle(!0),this.view.calcSelection(),this.view.update(!0),this.view.behaviour=this.previousBehaviour},onDoubleClick:function(x,y){this.log("onDoubleClick")}};var _fitLogger=log.create("FitCurve");DrawTextBehaviour.prototype={log:log.create("Text"),enter:function(){this.log("Entering text mode"),this.view.canvas.style.cursor="text"},leave:function(){this.editing&&this.createText(),this.view.canvas.style.cursor="default",this.log("Leaving text mode"),this.editBox&&($(this.editBox).remove(),this.editBox=null)},onTouch:function(e){for(var i=0;i<e.touches.length;i++){var touch=e.touches[i],point=this.view.screenPoint(touch.pageX,touch.pageY);"touchstart"===e.type&&this.onMouseDown(point.x,point.y,e)}},onMouseDown:function(x,y,e){if(this.editing)return this.log("Editing somewhere else on mousedown; submit that first."),this.createText(),void this.view.pickTool();var fontName,fontSize,node=this.view.doc.hittest(x,y);node&&"TextNode"===node.type()?(this.editNode=node,"top"!==this.textPosition&&this.editNode.setHidden(!0),this.view.draw(),this.editPoint=new Point(node.rect.x,node.rect.y),fontName=node.getProperty("fontName"),fontSize=node.getProperty("fontSize")):(this.editNode=null,this.editPoint=new Point(x,y),fontName=this.view.defaults.fontName,fontSize=this.view.defaults.fontSize);var self=this,self=this,cContainer=$(this.view.canvas).parent(),cOffset=cContainer.offset();this.editBox=document.createElement("input"),this.editBox.type="text",cContainer.append(this.editBox);var height=$(this.editBox).height();this.editPoint.x<$(this.view.canvas.parentNode.parentNode).find("div.sp_toolbar_container")[0].offsetWidth&&(this.editPoint.x=$(this.view.canvas.parentNode.parentNode).find("div.sp_toolbar_container")[0].offsetWidth);var pos=this.view.documentPoint(this.editPoint.x,this.editPoint.y);if(this.editBox.style.position="absolute",this.editBox.style.fontFamily=fontName,this.editBox.style.fontSize=fontSize*this.view.scale+"px","top"===this.textPosition){var offset=$(this.view.canvas).offset(),width=$(this.view.canvas).width(),editWidth=$(this.editBox).width();this.editBox.style.left=offset.left+width/2-editWidth/2+"px",this.editBox.style.top=offset.top+"px"}else this.editBox.style.left=Math.round(pos.x-cOffset.left)+"px",this.editBox.style.top=Math.round(pos.y-cOffset.top)+"px";this.editing=!0,this.editPoint=new Point(x,y+height),this.editNode&&(this.editBox.value=this.editNode.getProperty("text")),$(this.editBox).bind("keydown",function(e){27===e.keyCode?(self.log("ESC pressed; cancel."),self.cancel(),self.view.pickTool(),self.view.eventSource.emit("goto-toolbar")):13===e.keyCode&&(self.log("Enter pressed. create text."),self.createText(),self.view.isKeyboardCursorShown()&&self.view.showKeyboardCursorAndStartMoving(),self.view.pickTool(),self.view.eventSource.emitNow("goto-canvas"))}),setTimeout(function(){self.editBox&&$(self.editBox).focus()},300),$(self.editBox).focus()},cancel:function(){$(this.editBox).remove(),this.editBox=null,this.editing=!1,this.editNode&&(this.editNode.setHidden(!1),this.view.draw())},createText:function(){var text=this.editBox.value;if(this.cancel(),this.editNode&&this.editNode.getProperty("text")===text)this.log("Text was not changed.");else if(null!==this.editNode||""!==text)if(this.editNode)this.log("Update text in node %s",this.editNode.id),this.view.commit([new SetAction([this.editNode.id],"text",text)]),this.view.doneSelecting();else{this.log("Create new text node.");var id=this.view.doc.peekNextId(),xform=new TranslateMatrix(this.editPoint.x,this.editPoint.y);this.view.commit([new CreateAction("TextNode",{text:text,fontSize:this.view.defaults.fontSize,fontName:this.view.defaults.fontName,textFillStyle:this.view.defaults.textFillStyle}),new TransformAction([id],xform,xform.inverse())])}else this.log("No text entered.")},onMouseMove:function(x,y){},onKeyCommand:function(action){this.log("keyboard: %s",action),"cancel"===action&&null===this.editBox&&(this.view.pickTool(),this.view.eventSource.emit("goto-toolbar"))},onColourClicked:function(e){this.log("Set text colour to %s",e.colour),this.view.setProperty("textFillStyle",e.colour)}},BaseNode.defaults={fillStyle:"#cccccc",strokeStyle:"#000000",lineWidth:2,shadow:!1},BaseNode.prototype={initBase:function(id,constructor){this.id=id,this.properties={},this.applyDefaults(BaseNode.defaults),this.rect=new Rectangle(0,0,1,1),this.properties.matrix=new Matrix,this.properties.inverse=new Matrix,this.parent=null,this.constructor=constructor,this._hidden=!1},applyDefaults:function(defaults){for(var key in defaults)this.properties[key]=defaults[key]},hasEditMode:function(){return!1},hasText:function(){return"text"in this.properties},hasData:function(){return"data"in this.properties},clone:function(nameGenerator){var clone=new this.constructor(nameGenerator());return clone.setProperties(this.getProperties()),clone},getProperties:function(){return this.properties},setProperties:function(properties){for(var key in properties)properties.hasOwnProperty(key)&&this.setProperty(key,properties[key])},isGroup:function(){return void 0!==this.children},isRoot:function(){return null===this.parent},isGroupMember:function(){return null!==this.parent&&!this.parent.isRoot()},type:function(){return"BaseNode"},getMatrix:function(){return this.properties.matrix},getInverseMatrix:function(){return this.properties.inverse},setMatrix:function(matrix,inverse){this.properties.matrix=matrix,this.properties.inverse=inverse},setProperty:function(name,value){name in this.properties&&(this.properties[name]=value)},getProperty:function(name){return this.properties[name]},getRect:function(){return this.rect},transform:function(matrix,inverse){this.properties.matrix=matrix.multiply(this.properties.matrix),this.properties.inverse=this.properties.inverse.multiply(inverse)},format:function(ctx,request){},hittest:function(x,y){return this.rect.containsPoint(x,y)?this:null},setHidden:function(hidden){this._hidden=hidden},hidden:function(){return this._hidden},draw:function(ctx){ctx.save();var matrix=this.properties.matrix;ctx.transform(matrix.m11,matrix.m21,matrix.m12,matrix.m22,matrix.dx,matrix.dy),ctx.strokeStyle=this.properties.strokeStyle,ctx.fillStyle=this.properties.fillStyle,ctx.lineWidth=this.properties.lineWidth,this.properties.shadow&&(ctx.shadowOffsetX=3,ctx.shadowOffsetY=3,ctx.shadowBlur=5,ctx.shadowColor="rgba(0,0,0,0.5)"),this._draw(ctx),ctx.restore()},_draw:function(ctx){},onAdded:function(){},onRemoved:function(){}};var ImageNode=function(id){this.initBase(id,ImageNode),this.properties.url="",this.img=null,this.width=100,this.height=20,this.poly=new Polygon,this.locked=!1};__extends(ImageNode,BaseNode),ImageNode.prototype.log=log.create("IMAGE",!0),ImageNode.prototype.type=function(){return"ImageNode"},ImageNode.prototype.setProperty=function(name,value){if(this.properties[name]=value,"url"===name)return this.img=null},ImageNode.prototype.format=function(ctx,request){return null===this.img?(this.rect=new Rectangle(0,0,this.width,this.height),"image-"+this.id+this.properties.url,request.add(this,"image",this.properties.url,null,__bind(function(img,url){return this.log("Got image response."),this.img=img,request.emit("reformat",this)},this))):this.rect=new Rectangle(0,0,this.img.width,this.img.height),this.poly=new Polygon(this.rect),this.poly.transform(this.properties.matrix),this.rect.transform(this.properties.matrix)},ImageNode.prototype.hittest=function(x,y){return!this.properties.locked&&this.poly.containsPoint(x,y,3)?this:null},ImageNode.prototype._draw=function(ctx){return null===this.img?(ctx.save(),ctx.lineWidth=1,ctx.strokeStyle="#cccccc",ctx.strokeRect(0,0,this.width,this.height),ctx.restore()):ctx.drawImage(this.img,0,0)},DomNode.prototype={log:log.create("DomNode",!0),type:function(){return"DomNode"},setProperty:function(key,value){"data"===key&&this.element&&($(this.element).remove(),this.element=null,this.dataRequested=null),BaseNode.prototype.setProperty.call(this,key,value)},setElement:function(element){this.log("Node %s receives DOM element and requests reformat",this.id),this.element=element,this.element.style.position="absolute",this.element.style.pointerEvents="none",$(this.formatRequest.canvas.parentNode).append(this.element),this.originalWidth=this.element.offsetWidth,this.originalHeight=this.element.offsetHeight,this.element.style.top="0px",this.element.style.left="0px",this._setStyle("transformOrigin","top left"),this.formatRequest.requestReformat(this)},_setStyle:function(name,value){for(var upper=name.charAt(0).toUpperCase()+name.substr(1),prefixes=["ms","Webkit","O","Moz"],i=0;i<prefixes.length;i++)this.element.style[prefixes[i]+upper]=value;this.element.style[name]=value},format:function(ctx,request){if(null===this.element&&this.dataRequested!==this.getProperty("data")&&(this.dataRequested=this.getProperty("data"),this.formatRequest=request,this.log("DomNode %s requests conversion to DOM element",this.id),this.formatRequest.convertDomRequest(this.dataRequested,this.id)),this.element){var scale=request.getScale(),matrix=this.getMatrix();this.rect.x=0,this.rect.y=0,this.rect.width=this.originalWidth,this.rect.height=this.originalHeight,this.rect.transform(matrix);var elementTransform=new ScaleMatrix(scale,scale).multiply(matrix);this._setStyle("transform",elementTransform.toCssTransformString())}},_draw:function(ctx){this.element||(ctx.beginPath(),ctx.lineWidth=1,ctx.fillStyle="#888888",ctx.strokeStyle="#CCCCCC",ctx.rect(0,0,100,22),ctx.stroke(),ctx.font="20px Arial",ctx.textBaseline="top",ctx.fillText("",0,0))},hittest:function(x,y){return!this.properties.locked&&this.rect.containsPoint(x,y)?this:null},onAdded:function(){this.element&&document.body.appendChild(this.element)},onRemoved:function(){this.element&&$(this.element).remove()}},DomNode.prototype=$.extend({},BaseNode.prototype,DomNode.prototype),GroupNode.prototype.init=function(name){this.initBase(name,GroupNode),this.parent=null,this.children=[]},GroupNode.prototype.type=function(){return"GroupNode"},GroupNode.prototype.clone=function(namer){for(var clone=new GroupNode(namer()),i=0;i<this.children.length;i++){var child=this.children[i].clone(namer);child.parent=clone,clone.children.push(child)}return clone},GroupNode.prototype.setProperty=function(key,value){for(var i=0;i<this.children.length;i++)this.children[i].setProperty(key,value)},GroupNode.prototype.format=function(ctx,request){for(var i=0;i<this.children.length;i++)this.children[i].format(ctx,request),0===i?this.rect=this.children[i].rect.clone():this.rect.union(this.children[i].rect)},GroupNode.prototype.draw=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].draw(ctx)},GroupNode.prototype.hittest=function(x,y){for(var i=this.children.length-1;i>=0;i--){var result=this.children[i].hittest(x,y);if(result)return result}return null},GroupNode.prototype.findChildIndex=function(child){for(var i=0;i<this.children.length;i++)if(child===this.children[i])return i;return-1},Inherit(BaseNode.prototype,GroupNode.prototype);var MathNode=function(id){this.initBase(id,MathNode),this.properties.mathml="",this.img=null,this.width=100,this.height=20,this.poly=new Polygon,this.locked=!1,this.zoomed=!1};__extends(MathNode,BaseNode),MathNode.prototype.log=log.create("MATHNODE",!0),MathNode.prototype.type=function(){return"MathNode"},MathNode.prototype.setProperty=function(name,value){this.properties[name]=value,"mathml"!==name||(this.img=null)},MathNode.prototype.setImage=function(img){img&&(this.img=img)},MathNode.prototype.format=function(ctx,request){return null===this.img?(this.zoomed=!1,this.rect=new Rectangle(0,0,this.width,this.height),console.log("Format call in the math node.",ctx,request),request.add(this,"math",this.properties.mathml,null,__bind(function(img,url){if(this.log("Got math response."),this.img=img,this.img)return request.emit("reformat",this)},this))):(this.realWidth=this.img.width,this.realHeight=this.img.height,this.zoomedWidth=this.img.width,this.zoomedHeight=this.img.height,this.rect=new Rectangle(0,0,this.realWidth,this.realHeight)),this.poly=new Polygon(this.rect),this.poly.transform(this.properties.matrix),this.rect.transform(this.properties.matrix)},MathNode.prototype.hittest=function(x,y){return!this.properties.locked&&this.poly.containsPoint(x,y,3)?this:null},MathNode.prototype._draw=function(ctx){if(console.log("What is the draw context?",ctx),null===this.img)return ctx.save(),ctx.lineWidth=1,ctx.strokeStyle="#cccccc",ctx.strokeRect(0,0,this.width,this.height),ctx.restore();try{return ctx.drawImage(this.img,0,0)}catch(e){return console.error("Error drawing the image",e)}};var TextNode=function(id){this.initBase(id,TextNode),this.applyDefaults(TextNode.defaults),this.properties.text="lorum ipsum dolor",this.textWidth=0,this.textHeight=0,this.path=null,this.xpath=null,this.bounds=[],this.lines=[]};__extends(TextNode,BaseNode),TextNode.prototype.log=log.create("TEXT",!0),TextNode.prototype.type=function(){return"TextNode"},TextNode.prototype.setProperty=function(name,value){return this.properties[name]=value,"fontName"!==name&&"text"!==name||(this.path=null),"textFillStyle"===name?this.properties.fillStyle=value:"fillStyle"===name?this.properties.textFillStyle=value:void 0},TextNode.prototype.strip=function(text){if(null===text)return"";var len;for(len=text.length;len>0&&"\n"===text[len-1];)len-=1;return text.substr(0,len)},TextNode.prototype.format=function(ctx,request){var bl,br,i,line,lineHeight,matrix,pt,text,tl,tr,width,_i,_len,_ref;if(this.font=this.properties.fontSize+"px "+this.properties.fontName,ctx.font=this.font,ctx.getTextOutline&&(ctx.textBaseline="alphabetic",this.path=ctx.getTextOutline(this.properties.text,0,0)),null===this.path){for(ctx.save(),(matrix=this.properties.matrix).dx<0&&(matrix.dx=0),matrix.dx>ctx.canvas.width-this.textWidth&&(matrix.dx=ctx.canvas.width-this.textWidth),matrix.dy<this.textHeight&&(matrix.dy=this.textHeight),matrix.dy>ctx.canvas.height&&(matrix.dy=ctx.canvas.height),ctx.transform(matrix.m11,matrix.m21,matrix.m12,matrix.m22,matrix.dx,matrix.dy),i=0,this.textWidth=0,this.lines=[],text=this.strip(this.properties.text),lineHeight=this.properties.fontSize,_i=0,_len=(_ref=text.split("\n")).length;_i<_len;_i++)line=_ref[_i],this.lines.push({text:line,x:0,y:this.properties.fontSize*i}),width=ctx.measureText(line).width,this.textWidth=Math.max(this.textWidth,width),i+=1;this.textHeight=lineHeight*this.lines.length,ctx.restore(),tl=matrix.apply(0,-lineHeight),tr=matrix.apply(this.textWidth,-lineHeight),br=matrix.apply(this.textWidth,lineHeight*(this.lines.length-1)),bl=matrix.apply(0,lineHeight*(this.lines.length-1)),this.bounds=[tl,tr,br,bl],this.rect=Rectangle.CreateBoundingBox(this.bounds)}else for(i=0,matrix=this.properties.matrix,this.xpath=this.path.concat();i<this.xpath.length;)switch(this.xpath[i]){case 0:case 1:pt=matrix.apply(this.xpath[i+1],this.xpath[i+2]),this.xpath[i+1]=pt.x,this.xpath[i+2]=pt.y,0===i?(this.rect.x=pt.x,this.rect.y=pt.y,this.rect.width=0,this.rect.height=0):this.rect.unionPoint(pt.x,pt.y),i+=3;break;case 2:pt=matrix.apply(this.xpath[i+1],this.xpath[i+2]),this.xpath[i+1]=pt.x,this.xpath[i+2]=pt.y,this.rect.unionPoint(pt.x,pt.y),pt=matrix.apply(this.xpath[i+3],this.xpath[i+4]),this.xpath[i+3]=pt.x,this.xpath[i+4]=pt.y,this.rect.unionPoint(pt.x,pt.y),pt=matrix.apply(this.xpath[i+5],this.xpath[i+6]),this.xpath[i+5]=pt.x,this.xpath[i+6]=pt.y,this.rect.unionPoint(pt.x,pt.y),i+=7;break;case 3:i+=1;break;default:this.log("Bad path command: %s",this.xpath[i]),i=this.xpath.length}},TextNode.prototype._draw=function(ctx){var i,line,matrix,offset,_i,_len,_ref;if(this.path){for(matrix=this.properties.inverse,ctx.transform(matrix.m11,matrix.m21,matrix.m12,matrix.m22,matrix.dx,matrix.dy),ctx.beginPath(),i=0;i<this.xpath.length;)switch(this.xpath[i]){case 0:ctx.moveTo(this.xpath[i+1],this.xpath[i+2]),i+=3;break;case 1:ctx.lineTo(this.xpath[i+1],this.xpath[i+2]),i+=3;break;case 2:ctx.bezierCurveTo(this.xpath[i+1],this.xpath[i+2],this.xpath[i+3],this.xpath[i+4],this.xpath[i+5],this.xpath[i+6]),i+=7;break;case 3:ctx.closePath(),i+=1;break;default:this.log("Bad xpath command: %s",this.xpath[i]),i=this.xpath.length}ctx.fill(),this.properties.lineWidth>0&&(ctx.shadowColor="rgba(0,0,0,0.0)",ctx.stroke())}else for(ctx.font=this.font,ctx.textBaseline="alphabetic",offset=0,!0===window.IN_SERVER_CGI&&(offset=-this.properties.fontSize),_i=0,_len=(_ref=this.lines).length;_i<_len;_i++)line=_ref[_i],this.properties.lineWidth>0&&ctx.strokeText(line.text,line.x,line.y+offset),ctx.fillText(line.text,line.x,line.y+offset)},TextNode.defaults={textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:0,fillStyle:"#000000"};var BrushNode=function(id){this.initBase(id,BrushNode),this.log("New BrushNode created."),this.properties.points=[],this.properties.strokeStyle="#ff00ff",this.properties.lineWidth=10,this.points=[],this.inverse=null};__extends(BrushNode,BaseNode),BrushNode.prototype.log=log.create("BRUSH",!0),BrushNode.prototype.type=function(){return"BrushNode"},BrushNode.prototype.setProperty=function(name,value){if("fillStyle"===name&&(name="strokeStyle"),name in this.properties)return this.properties[name]=value},BrushNode.prototype.format=function(ctx,request){var i,points,poly,rect,_ref;for(this.points.length=0,i=0,_ref=(points=this.properties.points).length-1;i<=_ref;i+=2)this.points.push(new Point(points[i],points[i+1]));return(rect=Rectangle.CreateBoundingBox(this.points)).inflate(this.properties.lineWidth+3,this.properties.lineWidth+3),(poly=new Polygon(rect)).transformWRTContext(this.properties.matrix,ctx),this.rect=Rectangle.CreateBoundingBox(poly.points),this.inverse=this.properties.matrix.inverse()},BrushNode.prototype.hittest=function(x,y){var point;return this.rect.containsPoint(x,y)&&(point=this.inverse.apply(x,y),PointNearPath(this.points,point.x,point.y,this.properties.lineWidth/2))?this:null},BrushNode.prototype._draw=function(ctx){var i,points,_ref;if(0!==(points=this.properties.points).length){for(ctx.save(),ctx.beginPath(),ctx.lineCap="round",ctx.lineJoin="round",ctx.moveTo(points[0],points[1]),i=2,_ref=points.length-1;i<=_ref;i+=2)ctx.lineTo(points[i],points[i+1]);return ctx.stroke(),ctx.restore()}};var DrawBrushBehaviour=function(view,previousBehaviour){this.view=view,this.previousBehaviour=previousBehaviour,this.dragging=!1,this.paths=[]};DrawBrushBehaviour.prototype.log=log.create("Brush"),DrawBrushBehaviour.prototype.enter=function(){this.view.setHintText("Hold down the button to draw"),this.view.canvas.style.cursor="crosshair"},DrawBrushBehaviour.prototype.reset=function(){this.dragging=!1,this.paths=[]},DrawBrushBehaviour.prototype.onTouch=function(e){var p,path,touch,_i,_j,_len,_len2,_ref,_ref2;if("touchstart"===e.type)for(_i=0,_len=(_ref=e.changedTouches).length;_i<_len;_i++)touch=_ref[_i],p=this.view.screenPoint(touch.pageX,touch.pageY),this.paths.push([p]);else if("touchmove"===e.type)for(_j=0,_len2=(_ref2=e.changedTouches).length;_j<_len2;_j++)touch=_ref2[_j],p=this.view.screenPoint(touch.pageX,touch.pageY),path=this.findNearest(p),p.x===path[path.length-1].x&&p.y===path[path.length-1].y||(path.push(p),this.draw(path));else"touchend"===e.type&&0===e.touches.length&&this.commit()},DrawBrushBehaviour.prototype.findNearest=function(point){var best,bestDist,path,_i,_len,_ref;for(best=null,bestDist=1e6,_i=0,_len=(_ref=this.paths).length;_i<_len;_i++)path=_ref[_i],(null===best||path[path.length-1].distanceTo(point)<bestDist)&&(best=path,bestDist=path[path.length-1].distanceTo(point));return best},DrawBrushBehaviour.prototype.onMouseDown=function(x,y){var pt;return pt=this.view.snap(new Point(x,y)),this.dragging=!0,this.view.setHintText(null),this.paths.push([pt])},DrawBrushBehaviour.prototype.draw=function(points){this.from=points[points.length-2],this.to=points[points.length-1],this.view.ctx.beginPath(),this.view.ctx.moveTo(this.from.x,this.from.y),this.view.ctx.lineTo(this.to.x,this.to.y),this.stroke(this.view.ctx)},DrawBrushBehaviour.prototype.stroke=function(ctx){ctx.strokeStyle=this.view.defaultBrushStyle,ctx.lineCap="round",ctx.joinCap="round",ctx.lineWidth=this.view.defaultBrushThickness,ctx.stroke()},DrawBrushBehaviour.prototype.onRedraw=function(ctx){if(0!==this.paths.length){ctx.beginPath();for(var i=0;i<this.paths.length;i++){var path=this.paths[i];ctx.moveTo(path[0].x,path[0].y);for(var j=1;j<path.length;j++){var p=path[j];ctx.lineTo(p.x,p.y)}}this.stroke(ctx)}},DrawBrushBehaviour.prototype.onMouseMove=function(x,y){var pt;pt=this.view.snap(new Point(x,y)),this.dragging&&(this.from=this.paths[0][this.paths[0].length-1],pt.x===this.from.x&&pt.y===this.from.y||(this.paths[0].push(pt),this.draw(this.paths[0])))},DrawBrushBehaviour.prototype.onMouseUp=function(x,y){this.onMouseMove(x,y),this.dragging=!1,this.commit(),this.view.pickTool()},DrawBrushBehaviour.prototype.commit=function(){var actions,commands,i,path,_i,_len,_ref,_ref2;for(actions=[],_i=0,_len=(_ref=this.paths).length;_i<_len;_i++){for(commands=[],i=0,_ref2=(path=_ref[_i]).length-1;i<=_ref2;i+=1)commands.push(path[i].x),commands.push(path[i].y);actions.push(new CreateAction("BrushNode",{points:commands,strokeStyle:this.view.defaultBrushStyle,lineWidth:this.view.defaultBrushThickness}))}this.view.commit(actions),this.reset()},DrawBrushBehaviour.prototype.leave=function(){this.view.canvas.style.cursor="default",this.view.setHintText(null),this.view.draw()},DrawBrushBehaviour.prototype.onColourClicked=function(e){1===e.button&&(this.view.defaultBrushStyle=e.colour)},DrawBrushBehaviour.prototype.onKeyCommand=function(action,e){"cancel"===action&&(this.log("ESC pressed. Abort brush and go back to toolbar."),this.view.pickTool(),this.view.eventSource.emit("goto-toolbar"))},KeyboardMap.prototype={init:function(){this.keys={},this.nolog=!0,this.specialWords=new RegExp(["alt","control","ctrl","del","delete","down","end","esc","enter","home","ins","insert","left","pagedown","pageup","right","shift","up","backspace"].sort(function(a,b){return b.length-a.length}).join("|"),"g");var self=this;this.handler=function(e){self.handleKeyboardEvent(e)}},log:log.create("KEYMAP"),map:function(keyString,actionString){for(var keys=keyString.toLowerCase().split(","),actions=actionString.split(","),i=0;i<keys.length;i++)for(var j=0;j<actions.length;j++)this._addMapping(keys[i],actions[j])},_addMapping:function(keyString,action){if(0===keyString.length)return!1;var i,words=keyString.match(this.specialWords)||[],shift=!1,control=!1,alt=!1,codes=[];for(i=0;i<words.length;i++)switch(words[i]){case"alt":alt=!0;break;case"control":case"ctrl":control=!0;break;case"shift":case"shift":shift=!0;break;case"home":codes.push(36);break;case"end":codes.push(35);break;case"pageup":codes.push(33);break;case"pagedown":codes.push(34);break;case"delete":case"del":codes.push(46);break;case"backspace":codes.push(8);break;case"up":codes.push(38);break;case"right":codes.push(39);break;case"down":codes.push(40);break;case"left":codes.push(37);break;case"esc":codes.push(27);break;case"enter":codes.push(13);break;default:console.error("key entry not found: "+words[i])}var self=this,assign=function(key){if(shift&&-1===key.indexOf("-shift")&&(key+="-shift"),control&&-1===key.indexOf("-control")&&(key+="-control"),alt&&-1===key.indexOf("-alt")&&(key+="-alt"),self.log("Keyboard mapping: %s->%s",key,action),key in self.keys){var i=0,actions=self.keys[key];for(i=0;i<actions.length&&actions[i]!==action;i++);i===actions.length&&self.keys[key].push(action)}else self.keys[key]=[action]};if(0===codes.length){var ch=keyString.toUpperCase()[keyString.length-1];switch(ch){case"=":assign("107-shift"),assign("187"),assign("61");break;case"+":assign("107"),assign("61-shift");break;case"-":assign("109"),assign("189"),assign("173");break;default:codes.push(ch.charCodeAt(0))}}for(i=0;i<codes.length;i++)assign(""+codes[i])},getKeyName:function(e){var key="";return e.keyCode&&(key+=e.keyCode),e.shiftKey&&(key+="-shift"),e.ctrlKey&&(key+="-control"),e.altKey&&(key+="-alt"),key},translate:function(e){var actions=[],key=this.getKeyName(e);return key in this.keys&&(actions=this.keys[key]),this.log("%s",key),actions},each:function(e,fn){for(var actions=this.translate(e),i=0;i<actions.length;i++)fn(actions[i])},handleKeyboardEvent:function(e){for(var actions=this.translate(e),i=0;i<actions.length;i++)this.log("action: %s",actions[i]),this.emitNow("*",actions[i],e)},attachTo:function(element){element.addEventListener("keydown",this.handler,!1)}},Inherit(EventEmitter.prototype,KeyboardMap.prototype),Panel.prototype.initPanel=function(div){this.div=div||$("<div>"),$("body").append(this.div)},Panel.prototype.width=function(width){function get(name){var v=parseInt(self.div.css(name),10);return isNaN(v)?0:v}var self=this;if(void 0===width)return this.div.outerWidth();width-=get("border-left-width"),width-=get("border-right-width"),width-=get("padding-right"),width-=get("padding-left"),width-=get("margin-left"),width-=get("margin-right"),this._width=width,this.div.css("width",width+"px")},Panel.prototype.height=function(height){function get(name){var v=parseInt(self.div.css(name),10);return isNaN(v)?0:v}var self=this;if(void 0===height)return this.div.outerHeight();height-=get("border-top-width"),height-=get("border-bottom-width"),height-=get("padding-top"),height-=get("padding-bottom"),height-=get("margin-top"),height-=get("margin-bottom"),this._height=height,this.div.css("height",this._height+"px")},Panel.prototype.moveTo=function(x,y){this.div.css("left",x+"px"),this.div.css("top",y+"px")},Panel.prototype.show=function(){this.div.show()},Panel.prototype.hide=function(){this.div.hide()},Panel.prototype.destroy=function(){this.div.remove()};var DebugPanel=function(div){Panel.apply(this,arguments),this.div.css("background","black"),this.div.css("font-family",'"Lucida Console","Dejavu Sans Mono",Monospace,"Courier New"'),this.div.css("font-size","10px"),this.div.css("line-height","12px"),this.div.css("overflow","scroll"),this.div.css("z-index",1),this.nextColour=0,this.keyColours={},this.curColour=this.colours[0],this.shown=!1,this.width(300),log.addListener(__bind(function(key,line){return this.addLine(key,line)},this)),this.timeout=null,this.lines=[],this.addLine("DEBUG","Debug window starting")};__extends(DebugPanel,Panel),DebugPanel.prototype.colours=["#ffffff","#008800","#008888","#880000","#880088","#884400","#888888","#444444","#0000ff","#00ff00","#00ffff","#ff0000","#ff00ff","#ffff00"],DebugPanel.prototype.show=function(){Panel.prototype.show.apply(this,arguments),this.shown=!0,this._addLine(),this.div[0].scrollTop=this.div[0].scrollHeight},DebugPanel.prototype.hide=function(){return this.shown=!1,Panel.prototype.hide.apply(this,arguments)},DebugPanel.prototype.getColourOf=function(key){return key in this.keyColours||(this.keyColours[key]=this.colours[this.nextColour],this.nextColour=(this.nextColour+1)%this.colours.length),this.keyColours[key]},DebugPanel.prototype.addLine=function(key,line){var part,_i,_len,_ref,self=this;for(_i=0,_len=(_ref=line.split("\n")).length;_i<_len;_i++)part=_ref[_i],this.lines.push({key:key,line:part});this.shown&&null===this.timeout&&(this.timeout=setTimeout(function(){self._addLine()},100))},DebugPanel.prototype._addLine=function(){var colour,div,item,key,line,_i,_len,_ref;for(!0,_i=0,_len=(_ref=this.lines).length;_i<_len;_i++)key=(item=_ref[_i]).key,line=item.line,colour=this.getColourOf(key),(div=$("<div>").css("color",colour)).css("border-bottom","1px solid #222"),div.text(key+": "+line),this.div.append(div);this.div[0].scrollTop=this.div[0].scrollHeight,this.timeout=null,this.lines.length=0};var ImageLoader={loading:[],timeoutRunning:null,timeout:function(){for(var self=ImageLoader,repl=[],i=0;i<self.loading.length;i++)self.loading[i].complete?self.loading[i].fn(self.loading[i],self.loading[i].srcWanted):repl.push(self.loading[i]);self.loading=repl,self.loading.length?setTimeout(self.timeout,250):self.timeoutRunning=!1},load:function(url,fn){var self=ImageLoader,img=new Image;return self.loading.push(img),img.fn=fn,img.src=url,img.srcWanted=url,img.onload=function(){if(img.complete){for(var i=0;i<self.loading.length;i++)if(self.loading[i]===this){self.loading.splice(i,1),fn(img,img.srcWanted);break}}else self.timeoutRunning||(self.timeoutRunning=!0,setTimeout(self.timeout,250))},img},loadDebug:function(url,fn){setTimeout(function(){ImageLoader.load(url,fn)},Math.floor(2500*Math.random()))}},FormatRequest=function(){EventEmitter.apply(this,arguments),this.queue=[],this.busy=!1,this.mathjax=null,this.canvas=null};__extends(FormatRequest,EventEmitter),FormatRequest.prototype.log=log.create("FORMAT",!0),FormatRequest.prototype.add=function(node,type,url,params,callback){var item,_i,_len,_ref;for(_i=0,_len=(_ref=this.queue).length;_i<_len;_i++)(item=_ref[_i]).type===type&&item.node===node&&(item.skip=!0);return this.log("Request URL %s",url),this.queue.push({node:node,type:type,url:url,params:params,callback:callback,skip:!1}),this.check()},FormatRequest.prototype.check=function(){console.log("Checking the format request.");var item;for(0;!this.busy&&0<this.queue.length;)this.queue[0].skip?this.queue.shift():(this.busy=!0,item=this.queue[0],this.log("Processing request for item %s url=%s",item.node.id,item.url),0===item.type.indexOf("image")?ImageLoader.load(item.url,__bind(function(img,url){this.log("Image request completed for item %s",item.node.id),item.callback(img,url),this.log("Image request completed for url %s",url),this.busy=!1,item.skip=!0,this.check()},this)):$.ajax({url:item.url,data:item.params,dataType:"json",success:__bind(function(data){item.skip||(this.log("Request completed for item %s",item.node.id),item.callback(data),this.emit("reformat",item.node),this.busy=!1,this.queue.shift(),this.check())},this),error:__bind(function(jqXHR,textStatus,errorThrown){this.log("Error: %s %s",textStatus,errorThrown),this.busy=!1,this.queue.shift(),this.check()},this)}))},FormatRequest.prototype.getCanvasRect=function(){var offset=$(this.canvas).offset();return new Rectangle(offset.left,offset.top,this.canvas.width,this.canvas.height)},FormatRequest.prototype.convertDomRequest=function(dataString,domNodeId){this.emit("convert-dom-request",dataString,domNodeId)},FormatRequest.prototype.requestReformat=function(node){this.emit("reformat",node)};var ListView=function(parent){Panel.call(this,$("<div>")),parent.append(this.div),this.events={},this.maxWidth=60,this.spacing=5,this.div.css("overflow-x","auto"),this.div.css("overflow-y","auto"),this.layout="grid",this.nextIndex=0,this.generation=1,this.cells=[]};__extends(ListView,Panel),ListView.prototype.on=function(name,fn){return this.events[name]=fn},ListView.prototype.setIconWidth=function(width,height){return this.maxWidth=width},ListView.prototype.log=log.create("ListView"),ListView.prototype.setLayout=function(layout){if(this.layout=layout,"grid"!==this.layout)return this.div.css("white-space","no-wrap")},ListView.prototype.addImage=function(url,data){var cell,generation;return generation=this.generation,cell={img:null,index:this.nextIndex,inserted:!1},this.nextIndex+=1,ImageLoader.load(url,__bind(function(img){var height,ratio,width;if(generation===this.generation)return width=img.width,height=img.height,width>this.maxWidth&&(ratio=height/width,img.width=this.maxWidth,img.height=this.maxWidth*ratio),(img=$(img)).css("margin",this.spacing+"px"),img.css("border-width","3"),img.css("border-color","white"),img.css("border-style","solid"),img.css("image-rendering","optimizeQuality"),img.mouseenter(__bind(function(e){return this.log("Mouseenter"),img.css("border-color","#888888")},this)),img.mouseleave(function(e){return img.css("border-color","white")}),img.click(__bind(function(e){if("click"in this.events)return this.events.click(data)},this)),cell.img=img,this.cells.push(cell),this.cells.sort(function(a,b){return a.index-b.index}),this.format()},this))},ListView.prototype.format=function(){var cell,prev,_i,_len,_ref,_results;for(prev=null,_results=[],_i=0,_len=(_ref=this.cells).length;_i<_len;_i++)(cell=_ref[_i]).inserted||(null===prev?this.div.prepend(cell.img):prev.img.after(cell.img),cell.inserted=!0),_results.push(prev=cell);return _results},ListView.prototype.clear=function(){return this.div.empty(),this.cells.length=0,this.generation+=1},RandomSequence.prototype={init:function(seed){if("string"==typeof seed){for(;seed.length<8;)seed+=seed;for(var d=16777619,i=0;i<seed.length;i++)d=4294967295&(16777619*d^seed.charCodeAt(i));seed=d}this.seed=seed,this.reset()},reset:function(){this.m_w=this.seed,this.m_z=this.seed},next:function(){return this.m_z=36969*(65535&this.m_z)+(this.m_z>>16),this.m_w=18e3*(65535&this.m_w)+(this.m_w>>16),((this.m_z<<16)+this.m_w)/4294967295/2+.5}};var SHOW_LINES=!1,SHOW_CONTROL_POINTS=!1;PathNode.defaults={strokeStyle:"#000000",fillStyle:"#ffffff",textFillStyle:"#000000",fontName:"Arial",fontSize:20,lineWidth:2,smoothness:.3,sloppiness:.5,shadow:!1,closed:!1,arrowSize:0,text:"",isTextEditable:!0},PathNode.BEZIER_ERROR=16,PathNode.MOVE_TO=0,PathNode.LINE_TO=1,PathNode.QUADRATIC_TO=2,PathNode.ARC_TO=3,PathNode.BEZIER_TO=4,PathNode.CURVE_TO=5,PathNode.CORNER_TO=6,PathNode.CLOSE=7,PathNode.KAPPA=.5522847498,PathNode.CommandLengths=[],PathNode.CommandLengths[PathNode.MOVE_TO]=2,PathNode.CommandLengths[PathNode.LINE_TO]=2,PathNode.CommandLengths[PathNode.QUADRATIC_TO]=4,PathNode.CommandLengths[PathNode.ARC_TO]=5,PathNode.CommandLengths[PathNode.BEZIER_TO]=6,PathNode.CommandLengths[PathNode.CURVE_TO]=2,PathNode.CommandLengths[PathNode.CORNER_TO]=4,PathNode.CommandLengths[PathNode.CLOSE]=0,PathNode.prototype.init=function(name){this.initBase(name,PathNode),this.applyDefaults(PathNode.defaults),this.properties.closed=!1,this.properties.commands=[],this.segments=[],this.properties.seed=0,this.textNode=new TextNode(0),this.textNode.setProperty("text",this.properties.text)},PathNode.prototype.moveTo=function(x,y){var commands=this.properties.commands;commands.push(PathNode.MOVE_TO),commands.push(x),commands.push(y)},PathNode.prototype.bezierTo=function(c1x,c1y,c2x,c2y,x,y){var commands=this.properties.commands;commands.push(PathNode.BEZIER_TO),commands.push(x),commands.push(y),commands.push(c1x),commands.push(c1y),commands.push(c2x),commands.push(c2y)},PathNode.prototype.type=function(){return"PathNode"},PathNode.prototype.setPath=function(commands){var old=this.properties.commands;return this.properties.commands=commands,old},PathNode.prototype.getPath=function(){return this.properties.commands},PathNode.prototype.setProperty=function(key,value){BaseNode.prototype.setProperty.apply(this,arguments),"fontName"===key||"fontSize"===key||"text"===key?this.textNode.setProperty(key,value):"textFillStyle"===key&&this.textNode.setProperty("fillStyle",value)},PathNode.prototype.moveEditHandle=function(index,x,y){for(var pos=0,commands=this.properties.commands,i=0;i<index;i++)pos+=PathNode.CommandLengths[commands[pos]]+1;var point=this.properties.matrix.apply(commands[pos+1],commands[pos+2]);if(point=this.properties.inverse.apply(point.x+x,point.y+y),commands[pos+1]=point.x,commands[pos+2]=point.y,0===index&&this.properties.closed){for(var lastCommand=null;pos<commands.length;){var length=PathNode.CommandLengths[commands[pos]];length>=2&&(lastCommand=pos),pos+=length+1}lastCommand&&(pos=lastCommand,point=this.properties.matrix.apply(commands[pos+1],commands[pos+2]),point=this.properties.inverse.apply(point.x+x,point.y+y),commands[pos+1]=point.x,commands[pos+2]=point.y)}},PathNode.prototype.removePoint=function(index){for(var commands=this.properties.commands,pos=0,i=0;i<index;i++)pos+=PathNode.CommandLengths[commands[pos]]+1;commands.splice(pos,PathNode.CommandLengths[commands[pos]]+1)},PathNode.prototype.getStartPoint=function(){return this.origin},PathNode.prototype.getEndPoint=function(){return this.segments[this.segments.length-1].to},PathNode.prototype.format=function(ctx,request){new Point(0,0);this.origin=null,this.segments.length=0;var control,control1,control2,radius,to=new Point(0,0),commands=this.properties.commands,prev=null,matrix=this.properties.matrix,randomSequence=new RandomSequence(this.properties.seed);if(commands.length>0){for(var canvasWidth=ctx.canvas.width,canvasheight=ctx.canvas.height,j=0;j<commands.length;)for(var cmd=commands[j++],k=0;k<PathNode.CommandLengths[cmd];){var cp=new Point(commands[j++],commands[j++]);matrix.m11*cp.x+matrix.dx<0?matrix.dx+=10:matrix.m11*cp.x+matrix.dx>canvasWidth?matrix.dx-=10:matrix.m22*cp.y+matrix.dy<0?matrix.dy+=10:matrix.m22*cp.y+matrix.dy>canvasheight&&(matrix.dy-=10),k+=2}this.properties.matrix=matrix,this.properties.inverse=matrix.inverse()}for(var i=0;i<commands.length;){switch(commands[i++]){case PathNode.MOVE_TO:to=matrix.apply(commands[i++],commands[i++]),this.segments.push(new MoveSegment(prev,to)),null===this.origin&&(this.origin=to);break;case PathNode.LINE_TO:to=matrix.apply(commands[i++],commands[i++]),this.segments.push(new LineSegment(prev,to,randomSequence,this.properties.sloppiness));break;case PathNode.QUADRATIC_TO:to=matrix.apply(commands[i++],commands[i++]),control=matrix.apply(commands[i++],commands[i++]),this.segments.push(new QuadraticSegment(prev,control,to));break;case PathNode.ARC_TO:to=matrix.apply(commands[i++],commands[i++]),control=matrix.apply(commands[i++],commands[i++]),radius=commands[i++],this.segments.push(new ArcSegment(prev,control,to,radius));break;case PathNode.BEZIER_TO:to=matrix.apply(commands[i++],commands[i++]),control1=matrix.apply(commands[i++],commands[i++]),control2=matrix.apply(commands[i++],commands[i++]),this.segments.push(new BezierSegment(prev,control1,control2,to));break;case PathNode.CURVE_TO:to=matrix.apply(commands[i++],commands[i++]),this.segments.push(new CurveSegment(prev,to,this.properties.smoothness));break;case PathNode.CORNER_TO:to=matrix.apply(commands[i++],commands[i++]),control1=matrix.apply(commands[i++],commands[i++]),this.segments.push(new CornerSegment(prev,control1,to,randomSequence,this.properties.sloppiness));break;case PathNode.CLOSE:this.properties.closed=!0;break;default:i++}prev=this.segments[this.segments.length-1]}this.properties.closed&&this.segments.length>=4&&this.segments[1].setPrevious&&(this.segments[1].setPrevious(prev),prev.to=this.origin),this.formatArrow(),this.rect.x=this.origin.x,this.rect.y=this.origin.y,this.rect.width=0,this.rect.height=0,this.points=this.calcPoints(PathNode.BEZIER_ERROR),this.rect=Rectangle.CreateBoundingBox(this.points);var lineWidth=this.properties.lineWidth;if(this.rect.inflate(2*lineWidth+1,2*lineWidth+1),this.rect.width<8&&(this.rect.x+=this.rect.width/2-4,this.rect.width=8),this.rect.height<8&&(this.rect.y+=this.rect.height/2-4,this.rect.height=8),this.properties.closed){var centroid=CalculateCentroid(this.points);this.textNode.format(ctx,request);var xshift=centroid.x-this.textNode.rect.x-this.textNode.rect.width/2,yshift=centroid.y-this.textNode.rect.y-this.textNode.rect.height/2;this.textNode.transform(new TranslateMatrix(xshift,yshift),new TranslateMatrix(-xshift,-yshift)),this.textNode.format(ctx,request)}},PathNode.prototype.formatArrow=function(){if(this.hasArrow=this.properties.arrowSize>0&&!this.properties.closed&&this.segments.length>0,this.hasArrow){var x1,y1,x2,y2,finalSegment=this.segments[this.segments.length-1],endPoint=finalSegment.to,directionVector=finalSegment.endSlope(),arrowSize=this.properties.arrowSize,smoothness=this.properties.smoothness;x1=endPoint.x-directionVector.x*arrowSize,y1=endPoint.y-directionVector.y*arrowSize,x2=x1+directionVector.y*arrowSize/2,y2=y1-directionVector.x*arrowSize/2,x1+=-directionVector.y*arrowSize/2,y1+=directionVector.x*arrowSize/2,this.segments.push(new MoveSegment(finalSegment,new Point(x1,y1))),this.segments.push(new CurveSegment(this.segments[this.segments.length-1],endPoint,smoothness)),this.segments.push(new CurveSegment(this.segments[this.segments.length-1],new Point(x2,y2),smoothness))}},PathNode.prototype.close=function(){this.properties.commands.push(PathNode.CLOSE)},PathNode.prototype.autoclose=function(){var seg=this.segments[this.segments.length-1];CalcLineLength(seg.to.x,seg.to.y,this.origin.x,this.origin.y)<=8&&this.close()},PathNode.prototype._draw=function(ctx){var matrix=this.properties.inverse;ctx.save(),ctx.lineJoin="round",ctx.transform(matrix.m11,matrix.m21,matrix.m12,matrix.m22,matrix.dx,matrix.dy),ctx.beginPath(),ctx.lineCap="round",ctx.joinCap="round";for(var i=0;i<this.segments.length;i++)this.segments[i].draw(ctx);if(this.properties.closed&&(ctx.closePath(),ctx.fill(),ctx.shadowColor="rgba(0,0,0,0.0)"),this.properties.lineWidth>0&&ctx.stroke(),SHOW_LINES&&this.points.length>0){for(ctx.shadowColor="rgba(0,0,0,0.0)",ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y),i=1;i<this.points.length;i++)ctx.lineTo(this.points[i].x,this.points[i].y);for(ctx.lineWidth=1,ctx.strokeStyle="#ff0000",ctx.stroke(),ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y),i=1;i<this.points.length;i++)ctx.rect(this.points[i].x-4,this.points[i].y-4,8,8);ctx.lineWidth=1,ctx.fillStyle="#a0a0e0",ctx.fill()}if(SHOW_CONTROL_POINTS&&this.segments.length>0){for(ctx.shadowColor="rgba(0,0,0,0.0)",ctx.beginPath(),i=0;i<this.segments.length;i++)this.segments[i].drawControls(ctx);ctx.strokeStyle="#800000",ctx.lineWidth=.5,ctx.stroke()}this.properties.closed&&this.textNode.draw(ctx),ctx.restore()},PathNode.prototype.hittest=function(x,y){if(x>=this.rect.x-8&&x<this.rect.x+8+this.rect.width&&y>=this.rect.y-8&&y<this.rect.y+8+this.rect.height)if(this.properties.closed){if(PointInPolygon(this.points,x,y))return this}else if(PointNearPath(this.points,x,y,8))return this;return null},PathNode.prototype.calcPoints=function(resolution){for(var points=[],i=0;i<this.segments.length;i++)this.segments[i].outline(points,resolution);return points},PathNode.prototype.lineTo=function(x,y){var commands=this.properties.commands;commands.push(PathNode.LINE_TO),commands.push(x),commands.push(y)},PathNode.prototype.curveTo=function(x,y){var commands=this.properties.commands;commands.push(PathNode.CURVE_TO),commands.push(x),commands.push(y)},PathNode.prototype.hasEditMode=function(){return!1!==this.properties.editable},PathNode.prototype.hitTestEditHandle=function(x,y,scale){var r=8*scale;if(x>=this.origin.x-r&&x<this.origin.x+r&&y>=this.origin.y-r&&y<this.origin.y+r)return 0;var num=this.properties.closed?this.segments.length-1:this.segments.length;this.hasArrow&&(num-=3);for(var i=0;i<num;i++)if(x>=this.segments[i].to.x-r&&x<this.segments[i].to.x+r&&y>=this.segments[i].to.y-r&&y<this.segments[i].to.y+r)return i;return null},PathNode.prototype.drawEditHandles=function(ctx,scale){ctx.save(),ctx.lineWidth=1*scale,ctx.strokeStyle="#0050B7";var r=4*scale;ctx.strokeRect(this.origin.x-r,this.origin.y-r,2*r,2*r);var num=this.segments.length;this.properties.closed&&(num-=1),this.hasArrow&&(num-=3);for(var i=1;i<num;i++)ctx.strokeRect(this.segments[i].to.x-r,this.segments[i].to.y-r,2*r,2*r);ctx.restore()},Inherit(BaseNode.prototype,PathNode.prototype),PathCommands.prototype={init:function(commands){this.commands=void 0===commands?[]:commands},change:function(index,x,y){for(var pos=0,i=0;i<index;i++)pos+=PathNode.CommandLengths[this.commands[pos]]+1;this.commands[pos+1]=x,this.commands[pos+2]=y},moveTo:function(x,y){this.commands.push(PathNode.MOVE_TO),this.commands.push(x),this.commands.push(y)},lineTo:function(x,y){this.commands.push(PathNode.LINE_TO),this.commands.push(x),this.commands.push(y)},curveTo:function(x,y){this.commands.push(PathNode.CURVE_TO),this.commands.push(x),this.commands.push(y)},quadraticTo:function(cx,cy,x,y){this.commands.push(PathNode.QUADRATIC_TO),this.commands.push(x),this.commands.push(y),this.commands.push(cx),this.commands.push(cy)},cornerTo:function(cx,cy,x,y){this.commands.push(PathNode.CORNER_TO),this.commands.push(x),this.commands.push(y),this.commands.push(cx),this.commands.push(cy)},bezierTo:function(c1x,c1y,c2x,c2y,x,y){this.commands.push(PathNode.BEZIER_TO),this.commands.push(x),this.commands.push(y),this.commands.push(c1x),this.commands.push(c1y),this.commands.push(c2x),this.commands.push(c2y)},arcTo:function(x1,y1,x2,y2,radius){this.commands.push(PathNode.ARC_TO),this.commands.push(x2),this.commands.push(y2),this.commands.push(x1),this.commands.push(y1),this.commands.push(radius)},close:function(){this.commands.push(PathNode.CLOSE)},toArray:function(){return this.commands}};var DrawFreeformBehaviour=function(view,previousBehaviour){this.view=view,this.previousBehaviour=previousBehaviour,this.view.setHintText("Hold down the button to draw"),this.view.canvas.style.cursor="crosshair",this.dragging=!1,this.points=[]};DrawFreeformBehaviour.prototype.log=log.create("Freeform"),DrawFreeformBehaviour.prototype.onMouseDown=function(x,y){return this.dragging=!0,this.view.setHintText(null),this.points.push(new Point(x,y))},DrawFreeformBehaviour.prototype.onMouseUp=function(x,y){var commands,i,node,path;for(this.onMouseMove(x,y),this.dragging=!1,this.log("Points=%s",""+this.points),path=GenerateCurvesFromPoints(this.points,8),node=new PathNode(this.view.doc.getNextId()),commands=path.commands,i=0;i<commands.length;)commands[i]===PathData.MOVE?(node.moveTo(commands[i+1],commands[i+2]),this.log("MoveTo: %s, %s",commands[i+1],commands[i+2])):commands[i]===PathData.BEZIER_CURVE?(node.bezierTo(commands[i+1],commands[i+2],commands[i+3],commands[i+4],commands[i+5],commands[i+6]),this.log("CurveTo: %s, %s, %s, %s, %s, %s",commands[i+1],commands[i+2],commands[i+3],commands[i+4],commands[i+5],commands[i+6])):this.log("Unknown command %s",commands[i]),i+=PathData.SizeOf[commands[i]];return node.format(this.view.ctx,this.view.request),node.autoclose(),this.view.commit([new CreateAction("PathNode",{commands:node.getProperty("commands"),seed:node.getProperty("seed"),fillStyle:this.view.defaultFillStyle,strokeStyle:this.view.defaultStrokeStyle,lineWidth:this.view.defaults.lineWidth})]),this.exit()},DrawFreeformBehaviour.prototype.onMouseMove=function(x,y){if(this.dragging&&(this.from=this.points[this.points.length-1],x!==this.from.x||y!==this.from.y))return this.points.push(new Point(x,y)),this.to=this.points[this.points.length-1],this.view.ctx.beginPath(),this.view.ctx.moveTo(this.from.x,this.from.y),this.view.ctx.lineTo(this.to.x,this.to.y),this.view.ctx.strokeStyle="black",this.view.ctx.lineWidth=1,this.view.ctx.stroke()},DrawFreeformBehaviour.prototype.exit=function(){return this.view.behaviour=this.previousBehaviour,this.view.canvas.style.cursor="default",this.view.setHintText(null),this.view.draw()},DrawLinesBehaviour.prototype={enter:function(){this.numPoints=0,this.view.canvas.style.cursor="crosshair",this.view.setHintText("Click to place first point of line"),this.view.draw(),this.oldId=this.view.doc.peekNextId(),this.lastPoint=new Point(0,0),this.node=null},reset:function(){this.enter()},onTouch:function(e){var touch,pt;"touchstart"===e.type?(touch=e.changedTouches[0],(pt=this.view.screenPoint(touch.pageX,touch.pageY)).distanceTo(this.lastPoint)>10?this.onMouseClick(pt.x,pt.y):(this.onMouseClick(pt.x,pt.y),this.onMouseClick(pt.x,pt.y),this.onDoubleClick(pt.x,pt.y))):"touchmove"===e.type&&(touch=e.changedTouches[0],pt=this.view.screenPoint(touch.pageX,touch.pageY),this.onMouseMove(pt.x,pt.y))},onKeyCommand:function(action,e){"cancel"===action&&(null!==this.node&&this.view.isKeyboardCursorShown&&this.isCurves&&!this.hasArrow&&this.commit(),null!==this.node&&(this.view.doc.removeNode(this.node),this.view.doc.setNextId(this.oldId)),this.view.isKeyboardCursorShown()?this.view.eventSource.emit("goto-toolbar"):this.view.pickTool())},addPoint:function(x,y){this.isCurves?this.node.curveTo(x,y):this.node.lineTo(x,y)},onMouseClick:function(x,y){var pt=this.view.snap(new Point(x,y));if(x=pt.x,y=pt.y,null===this.node){this.node=new PathNode(this.view.doc.getNextId()),this.node.setProperty("seed",Math.round(65535*Math.random())),this.node.setProperty("strokeStyle",this.view.defaultStrokeStyle),this.node.setProperty("lineWidth",this.view.defaults.lineWidth),this.node.setProperty("sloppiness",this.view.defaults.sloppiness),this.node.setProperty("smoothness",this.view.defaults.smoothness),this.view.doc.addNode(this.node),this.hasArrow&&this.node.setProperty("arrowSize",this.view.defaults.arrowSize),this.node.moveTo(x,y),this.addPoint(x,y),this.index=1,this.view.setHintText("Click to place another point, or double-click to end the line"),this.view.update(),this.numPoints=2;var self=this;$(this.view.canvas).mouseleave(function(e){console.log("Mouse Leave on canvas called !!"),self&&self.node&&"function"==typeof self.commit&&(self.commit(),self.view.pickTool()),e.preventDefault()})}else!this.view.isKeyboardCursorShown()||this.isCurves&&!this.hasArrow?(this.addPoint(x,y),this.numPoints++,this.index+=1,this.view.doc.markRedraw(this.node.id),this.view.update()):(this.commit(),this.view.pickTool(),this.view.eventSource.emit("goto-toolbar"));this.lastPoint.x=x,this.lastPoint.y=y},onMouseMove:function(x,y){var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y,this.node&&(this.node.moveEditHandle(this.index,x-this.lastPoint.x,y-this.lastPoint.y),this.node.format(this.view.ctx,this.view.request),this.view.draw(),this.lastPoint.x=x,this.lastPoint.y=y)},onDoubleClick:function(x,y){var pt=this.view.snap(new Point(x,y));if(x=pt.x,y=pt.y,this.node&&this.index>1){var numPoints=this.index;this.node.removePoint(numPoints),this.node.removePoint(numPoints-1),this.commit()}this.reset(),this.view.pickTool()},commit:function(){this.node.autoclose(),this.view.doc.removeNode(this.node),this.view.doc.setNextId(this.oldId),this.view.commit([new CreateAction("PathNode",{arrowSize:this.hasArrow?this.view.defaults.arrowSize:0,commands:this.node.getProperty("commands"),seed:this.node.getProperty("seed"),fillStyle:this.view.defaultFillStyle,strokeStyle:this.view.defaultStrokeStyle,lineWidth:this.view.defaults.lineWidth,sloppiness:this.view.defaults.sloppiness,smoothness:this.view.defaults.smoothness,shadow:this.view.defaults.shadow,isTextEditable:!1})]),this.node=null},leave:function(){this.view.canvas.style.cursor="default",this.view.setHintText(null),this.node&&this.commit(),this.view.draw(),$(this.view.canvas).unbind("mouseleave")},onColourClicked:function(e){var property;1===e.button?(this.view.defaultFillStyle=e.colour,this.view.defaultBrushStyle=e.colour,property="fillStyle"):(this.view.defaultStrokeStyle=e.colour,property="strokeStyle"),this.view.setProperty(property,e.colour)}},MoveEditNodeBehaviour.prototype={onTouch:function(e){var touch,pt;"touchmove"===e.type?(touch=e.touches[0],pt=this.view.screenPoint(touch.pageX,touch.pageY),this.onMouseMove(pt.x,pt.y)):"touchend"===e.type&&(touch=e.changedTouches[0],pt=this.view.screenPoint(touch.pageX,touch.pageY),this.onMouseUp(pt.x,pt.y))},onMouseDown:function(x,y){var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y,this.startX=x,this.startY=y,this.prevX=x,this.prevY=y},onMouseMove:function(x,y){var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y,this.node.moveEditHandle(this.handle,x-this.prevX,y-this.prevY),this.node.format(this.view.ctx,this.view.request),this.view.draw(),this.prevX=x,this.prevY=y},onMouseUp:function(x,y){var pt=this.view.snap(new Point(x,y));x=pt.x,y=pt.y,x===this.startX&&y===this.startY||this.view.commit([new MoveEditHandleAction(this.node.id,this.handle,x-this.startX,y-this.startY)],this.view.doc.peekNextId()),this.view.draw(),this.view.setBehaviour(new DefaultBehaviour(this.view))}},Overlay.prototype.hide=function(){this.div.remove()},Overlay.prototype.show=function(clickfn){this.div=$("<div>");$(window);this.div.css("position","fixed"),this.div.css("background",this.colour),this.div.css("opacity","0.25"),this.div.css("left",this.left+"px"),this.div.css("top",this.top+"px"),this.div.css("z-index","1"),this.div.css("width",this.width+"px"),this.div.css("height",this.height+"px"),this.div.css("display","none"),this.div.click(function(e){clickfn(e)}),$("body").append(this.div),this.div.fadeIn("normal")},Menubar.HilightColour="#ff9900",Menubar.ClickColour="#ffffff",Menubar.BackgroundColour="#ccc",Menubar.prototype.log=log.create("Menubar"),Menubar.prototype.init=function(menu,eventSource,popup){this.initPanel($("<div>")),this.popup=popup,this.div.css("position","absolute"),this.div.css("background",Menubar.BackgroundColour),this.div.css("font-family","tahoma,helvetica,arial,sans"),this.div.css("font-size","12px"),this.div.css("padding","0.5em"),this.div.css("cursor","default"),this.div.css("MozUserSelect","none"),this.div[0].onselectstart=function(){return!1},popup&&(this.div.css("background","white"),this.div.css("border-left","1px solid #ccc"),this.div.css("border-bottom","1px solid #888"),this.div.css("border-right","1px solid #888"),this.div.css("box-shadow","3px 3px 5px #ccc")),this.menu=menu,this.eventSource=eventSource;for(var i=0;i<menu.items.length;i++){var item=menu.items[i];this._append(item)}this.overlay=null,this.currentlyShownMenu=null,this.div.css("z-index",3001)},Menubar.prototype._append=function(item){var div,self=this;if(this.popup){if("separator"===item.type)return div=$("<hr>"),void this.div.append(div);(div=$("<div>")).css("padding-left","0.5em"),div.css("padding-right","0.5em"),div.text(item.display),div.hover(function(){div.css("background",Menubar.HilightColour)},function(){div.css("background","transparent")}),div.mouseup(function(){self.clickfn&&self.clickfn(),self.eventSource.emit(item.event,item.eventData)}),this.div.append(div)}else{if("separator"===item.type)return;item.display.length>6&&"image:"===item.display.substr(0,6)?((div=$("<img>")).attr("src",item.display.substr(6)),div.load(function(){self.eventSource.emit("resize",{})}),div.css("border","1px solid #888"),div.css("box-shadow","3px 3px 3px #000"),div.css("border-radius","5px"),div.css("vertical-align","middle"),div.css("margin-left","0.5em"),div.css("margin-right","0.5em"),div.hover(function(){div.css("background",Menubar.HilightColour),div.css("color","white")},function(){div.css("background","transparent"),div.css("color","black")}),this.div.append(div)):((div=$("<div>")).css("display","inline"),div.css("padding-left","0.5em"),div.css("padding-right","0.5em"),div.css("padding-top","0.5em"),div.css("padding-bottom","0.5em"),div.css("MozUserSelect","none"),div[0].onselectstart=function(){return!1},div.css("vertical-align","middle"),div.text(item.display),div.hover(function(){div.css("background",Menubar.HilightColour)},function(){div.css("background","transparent")})),"menu"===item.type?div.mousedown(function(){var offset=div.offset();self.showMenu(item,offset.left,offset.top+div.outerHeight())}):div.click(function(){self.eventSource.emit(item.event,{})}),this.div.append(div)}},Menubar.prototype.click=function(clickfn){this.clickfn=clickfn},Menubar.prototype.hideActive=function(){this.currentlyShownMenu&&(this.currentlyShownMenu.destroy(),this.currentlyShownMenu=null),this.overlay&&(this.overlay.hide(),this.overlay=null)},Menubar.prototype.showMenu=function(item,x,y){if(this.currentlyShownMenu&&this.currentlyShownMenu.menu===item.menu)this.hideActive();else{this.hideActive();var menu,overlay=new Overlay("transparent",0,$(this.div).offset().top+this.height()),self=this,hidefn=function(e){self.hideActive()};overlay.show(hidefn),(menu=new Menubar(item.menu,this.eventSource,!0)).click(hidefn),menu.moveTo(x,y),this.currentlyShownMenu=menu,this.overlay=overlay}},Inherit(Panel.prototype,Menubar.prototype);var Dialog=function(name){this.name=name,EventEmitter.apply(this,arguments),"string"==typeof this.name?this.div=$("#"+this.name):(this.div=$("<div>").addClass("dialog"),$(document.body).append(this.div),this.div.css("z-index","2")),this.overlay=null};__extends(Dialog,EventEmitter),Dialog.prototype.log=log.create("Dialog"),Dialog.prototype.show=function(){return Dialog._current&&Dialog._current.hide(),this.log("Set Dialog.current"),Dialog._current=this,this.overlay=new Overlay("black"),this.overlay.show(__bind(function(){return this.hide()},this)),this.onResize(),this.div.slideDown("fast"),this.on("cancel",__bind(function(){return this.hide()},this))},Dialog.prototype.onResize=function(){var winHeight,winWidth;return winWidth=$(window).width(),winHeight=$(window).height(),this.div.css("left",winWidth/2-this.div.outerWidth()/2+"px"),this.div.css("top",winHeight/2-this.div.outerHeight()/2+"px")},Dialog.prototype.hide=function(){if(Dialog._current===this)return this.overlay.hide(),this.div.hide(),Dialog._current=null,this.log("Clear Dialog.current")},Dialog._current=null,Dialog.emit=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[],Dialog._current&&Dialog._current.emit.apply(Dialog._current,args)},Dialog.current=function(){return Dialog._current},$(document).keydown(function(e){if(null!==Dialog._current&&27===e.keyCode)return Dialog._current.emit("cancel")}),$(window).resize(function(){if(Dialog._current)return Dialog._current.onResize()});var editTextDialog=function(){function getDialog(){return _dialog||createDialog()}function createDialog(){var dialog=$('            <div id="editTextDialog">                 <div class="hd title"></div>                 <div class="bd">                     <input type="text"></input>                 </div>             </div>')[0];return document.body.appendChild(dialog),(_dialog=new YAHOO.widget.Dialog(dialog,{modal:!0,visible:!1,draggable:!1,close:!1,postmethod:"none",width:"auto"})).renderEvent.subscribe(function(){this.element.style.marginLeft=-this.element.offsetWidth/2+"px"}),_dialog}var _dialog;return function(title,value,onOk){var dialog=getDialog(),$input=$(dialog.body).find("input");dialog.header.innerHTML=title,$input.val(value);dialog.cfg.queueProperty("buttons",[{text:"OK",handler:function(){var value=$input.val();this.hide(),onOk(value)},isDefault:!0},{text:"Cancel",handler:function(){this.hide()}}]),dialog.render(),dialog.show(),$input.focus().select()}}();DefaultBehaviour.prototype={init:function(view){this.view=view,this.view.setHintText(""),this.useTouch=this.view.config.useTouch(),this.scaleTouchRadius=1,this.useTouch&&(this.scaleTouchRadius=2)},log:log.create("DefaultBehaviour"),enter:function(){this.log("Entering pick tool.")},leave:function(){this.log("Leaving pick tool.")},onTouch:function(e){for(var i=0;i<e.touches.length;i++){var touch=e.touches[i],point=this.view.screenPoint(touch.pageX,touch.pageY);"touchstart"===e.type?this.handleTouchStart(point.x,point.y,e):"touchend"===e.type&&this.onMouseUp(point.x,point.y)}},handleTouchStart:function(x,y,e){this.onMouseDown(x,y,e)},onMouseDown:function(x,y,e){this.log("onMouseDown");var dir=this.view.getHandleUnderPoint(x,y);if(dir)this.view.setBehaviour(new TransformSelectionBehaviour(this.view,this,dir,!1,x,y));else if(this.view.selection.length&&this.view.selectionBounds.containsPoint(x,y))this.view.setBehaviour(new TransformSelectionBehaviour(this.view,this,-1,!0,x,y));else{var node,handle;if(this.view.editNode&&(node=this.view.editNode,null!==(handle=node.hitTestEditHandle(x,y,1/this.view.scale*this.scaleTouchRadius))))this.view.setBehaviour(new MoveEditNodeBehaviour(this.view,node,handle,x,y));else if(node=this.view.doc.hittest(x,y)){var wasEditNode=node===this.view.editNode,wasSelected=this.view.isNodeSelected(node);this.log("wasEditNode: %s, wasSelected: %s",wasEditNode,wasSelected),wasSelected||(this.view.clearSelection(),this.view.addToSelection(node),this.view.doneSelecting(),this.view.draw()),this.view.setBehaviour(new TransformSelectionBehaviour(this.view,this,-1,!wasEditNode&&wasSelected,x,y))}else this.view.setEditNode(null),this.view.setBehaviour(new SelectBoxBehaviour(this.view,this,x,y))}},onMouseUp:function(x,y){this.log("onMouseUp")},onKeyCommand:function(action,e){this.log("keyboard: %s",action);var handled=!0;switch(action){case"bring-to-front":this.view.eventSource.emit("menu.bringToFront",{});break;case"send-to-back":this.view.eventSource.emit("menu.sendToBack",{});break;case"left":this.view.nudgeSelection(-1,0)||(this.view.translateX=Math.min(this.view.translateX+16,0),this.view.draw());break;case"right":this.view.nudgeSelection(1,0)||(this.view.translateX=Math.max(-(this.view.canvas.width*this.view.scale-this.view.canvas.width),this.view.translateX-16),this.view.draw());break;case"up":this.view.nudgeSelection(0,-1)||(this.view.translateY=Math.min(this.view.translateY+16,0),this.view.draw());break;case"down":this.view.nudgeSelection(0,1)||(this.view.translateY=Math.max(-(this.view.canvas.height*this.view.scale-this.view.canvas.height),this.view.translateY-16),this.view.draw());break;case"select-none":this.view.clearSelection(),this.view.doneSelecting(),this.view.draw(),this.view.isKeyboardCursorShown()&&this.view.eventSource.emit("goto-toolbar");break;case"duplicate":this.view.eventSource.emit("menu.duplicate",{});break;case"move-up":this.view.eventSource.emit("menu.moveUp",{});break;case"move-down":this.view.eventSource.emit("menu.moveDown",{});break;case"delete":this.view.eventSource.emit("menu.delete",{});break;case"curve-tool":this.view.curveTool();break;case"line-tool":this.view.lineTool();break;case"group":this.view.eventSource.emit("menu.group",{});break;case"ungroup":this.view.eventSource.emit("menu.ungroup",{});break;case"undo":this.view.eventSource.emit("menu.undo",{});break;case"redo":this.view.eventSource.emit("menu.redo",{});break;case"cut":this.view.eventSource.emit("menu.cut",{});break;case"copy":this.view.eventSource.emit("menu.copy",{});break;case"paste":this.view.eventSource.emit("menu.paste",{});break;case"zoom-1-1":this.view.scale=1,this.view.translateX=0,this.view.translateY=0,this.view.draw();break;case"zoom-in":this.view.scale=1.1*this.view.scale,this.view.draw();break;case"zoom-out":this.view.scale=this.view.scale/1.1,this.view.draw();break;default:handled=!1}handled&&(e.preventDefault(),e.stopPropagation())},onColourClicked:function(e){var property;1===e.button?(this.view.defaultFillStyle=e.colour,this.view.defaultBrushStyle=e.colour,property="fillStyle"):(this.view.defaultStrokeStyle=e.colour,property="strokeStyle"),this.view.setProperty(property,e.colour)},onDoubleClick:function(x,y){this.log("onDoubleClick");var node=this.view.doc.hittest(x,y);if(node&&node.hasText()&&node.getProperty("isTextEditable")){var oldValue=node.getProperty("text"),self=this;editTextDialog("Enter new text:",oldValue,function(value){null!==value&&value!==oldValue&&self.changeText(node,value)})}node&&node.hasData()&&this.view.zwibblerContext.app.startMathEditor(node.id),node&&"TextNode"==node.type()&&(this.view.setBehaviour(new DrawTextBehaviour(this.view)),this.view.behaviour.onMouseDown(x,y)),this.log("hittest: %s, hasText: %s",null!==node,null!==node&&node.hasText())},changeText:function(node,text){text!==node.getProperty("text")&&this.view.commit([new SetAction([node.id],"text",text)])}};var assert,assertArray,assertArrayOf,assertInstanceOf,assertNumber,assertString,isarray,isnumber,isstring;assert=null,assert=function(condition,message){if(null==message&&(message="Assertion failed"),!condition)throw message},assertInstanceOf=function(fn,arg){return assert(arg instanceof fn)},assertArray=function(arg){return assert("[object Array]"===Object.prototype.toString.apply(arg))},assertArrayOf=function(fn,arg){return assert(0===arg.length||arg[0]instanceof fn)},assertString=function(arg){return assert("string"==typeof arg,"Expected a string")},assertNumber=function(arg){return assert("number"==typeof arg,"Expected a number")},isarray=function(arg){return"object"==typeof arg&&"[object Array]"===Object.prototype.toString.apply(arg)},isstring=function(arg){return"string"==typeof arg},isnumber=function(arg){return"number"==typeof arg};var Set=function(){this.keys={},this.length=0};Set.prototype.contains=function(key){return key in this.keys},Set.prototype.add=function(arg){var _i,_len,_ref,_results;if("string"!=(_ref=typeof arg)&&"number"!==_ref){if("object"==typeof arg&&"[object Array]"===Object.prototype.toString.apply(arg)){for(_results=[],_i=0,_len=arg.length;_i<_len;_i++)arg[_i],_results.push(arg in this.keys?void 0:(this.keys[arg]=!0,this.length+=1));return _results}return assert(!1,"Arg must be an array")}if(!(arg in this.keys))return this.keys[arg]=!0,this.length+=1},Set.prototype.remove=function(key){return delete this.keys[key]},Set.prototype.intersect=function(other){var key,result;assertInstanceOf(Set,other),result=new Set;for(key in this.keys)other.contains(key)&&result.add(key);return result},Set.prototype.unionWith=function(other){var key,_results;assertInstanceOf(Set,other),_results=[];for(key in other.keys)_results.push(this.add(key));return _results},Set.prototype.toArray=function(){var key,_results;_results=[];for(key in this.keys)_results.push(key);return _results},Set.prototype.toMap=function(){return this.keys},Set.prototype.clear=function(){this.keys={}};var TransformNode,Action=function(){};Action.prototype.rename=function(replacer){var i,_ref;if(null!==this.id&&void 0!==this.id&&(this.id=replacer(this.id)),null!==this.ids&&void 0!==this.ids&&this.ids.length>0)for(i=0,_ref=this.ids.length-1;0<=_ref?i<=_ref:i>=_ref;0<=_ref?i++:i--)this.ids[i]=replacer(this.ids[i])},Action.prototype.log=log.create("ACTION"),Action.prototype.getDependentIds=function(doc,set){var ids;return ids=null!==this.ids?this.ids.concat():[],null!==this.id&&ids.push(this.id),doc.closure(ids,set)},Action.prototype.getAffectedIds=function(doc,set){return this.getDependentIds(doc,set)},Action.prototype.toString=function(){return this._class+"()"};var CreateAction=function(type,properties){this.type=type,this.properties=properties};__extends(CreateAction,Action),CreateAction.prototype._class="CreateAction",CreateAction.prototype.redo=function(doc){switch(this.type){case"TextNode":this.node=new TextNode(doc.getNextId());break;case"PathNode":this.node=new PathNode(doc.getNextId());break;case"ImageNode":this.node=new ImageNode(doc.getNextId());break;case"BrushNode":this.node=new BrushNode(doc.getNextId());break;case"MathNode":this.node=new MathNode(doc.getNextId());break;case"DomNode":this.node=new DomNode(doc.getNextId())}return this.node||this.log("Bad node type: %s",this.type),this.node.setProperties(this.properties),doc.addNode(this.node)},CreateAction.prototype.toString=function(){return this._class+"("+this.type+", "+JSON.stringify(this.properties)+")"},CreateAction.prototype.undo=function(doc){return doc.removeNode(this.node)},CreateAction.prototype.getAffectedIds=function(doc,set){return set.add(doc.peekNextId())};var DeleteAction=function(ids){this.ids=ids,this.old=[]};__extends(DeleteAction,Action),DeleteAction.prototype._class="DeleteAction",DeleteAction.prototype.redo=function(doc){var id,node,_i,_len,_ref,_results;for(this.old.length=0,_results=[],_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)id=_ref[_i],node=doc.getNode(id,!1),_results.push(this.old.push({node:node,parent:node.parent,index:doc.removeNode(node)}));return _results},DeleteAction.prototype.undo=function(doc){var old,_i,_len,_ref,_results;if(0!==this.old.length){for(_results=[],_i=0,_len=(_ref=this.old).length;_i<_len;_i++)old=_ref[_i],_results.push(doc.addChild(old.parent,old.node,old.index));return _results}};var SetAction=function(ids,name,value){this.ids=ids,this.name=name,this.value=value,this.oldValues=[]};__extends(SetAction,Action),SetAction.prototype._class="SetAction",SetAction.prototype.redo=function(doc){var id,node,_i,_len,_ref;for(this.oldValues.length=0,_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)id=_ref[_i],node=doc.getNode(id,!0),this.oldValues.push(node.getProperty(this.name)),node.setProperty(this.name,this.value)},SetAction.prototype.undo=function(doc){var i,_ref;if(0!==this.ids.length)for(i=0,_ref=this.ids.length-1;0<=_ref?i<=_ref:i>=_ref;0<=_ref?i++:i--)doc.getNode(this.ids[i],!0).setProperty(this.name,this.oldValues[i])};var TransformAction=function(ids,matrix,inverse){this.ids=ids,this.matrix=matrix,this.inverse=inverse};__extends(TransformAction,Action),TransformAction.prototype._class="TransformAction",TransformAction.prototype.redo=function(doc){var id,_i,_len,_ref;for(_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)id=_ref[_i],doc.getNode(id,!0).transform(this.matrix,this.inverse)},TransformAction.prototype.undo=function(doc){var id,_i,_len,_ref;for(_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)id=_ref[_i],doc.getNode(id,!0).transform(this.inverse,this.matrix)},TransformAction.prototype.rename=function(replacer){var i,_ref;if(0!==this.ids.length)for(i=0,_ref=this.ids.length-1;0<=_ref?i<=_ref:i>=_ref;0<=_ref?i++:i--)this.ids[i]=replacer(this.ids[i])};var SetPathAction=function(id,commands){this.id=id,this.commands=commands};__extends(SetPathAction,Action),SetPathAction.prototype._class="SetPathAction",SetPathAction.prototype.redo=function(doc){var node;node=doc.getNode(this.id,!0),this.oldCommands=node.setPath(this.commands)},SetPathAction.prototype.redo=function(doc){doc.getNode(this.id,!0).setPath(this.oldCommands)};var MoveEditHandleAction=function(id,handle,offsetX,offsetY){this.id=id,this.handle=handle,this.offsetX=offsetX,this.offsetY=offsetY};__extends(MoveEditHandleAction,Action),MoveEditHandleAction.prototype._class="MoveEditHandleAction",MoveEditHandleAction.prototype.redo=function(doc){return doc.getNode(this.id,!0).moveEditHandle(this.handle,this.offsetX,this.offsetY)},MoveEditHandleAction.prototype.undo=function(doc){return doc.getNode(this.id,!0).moveEditHandle(this.handle,-this.offsetX,-this.offsetY)};var GroupAction=function(ids){this.ids=ids,this.old=[]};__extends(GroupAction,Action),GroupAction.prototype._class="GroupAction",GroupAction.prototype.redo=function(doc){var id,node,_i,_len,_ref;for(this.old.length=0,_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)id=_ref[_i],node=doc.getNode(id),this.old.push({node:node,parent:node.parent,index:node.parent.findChildIndex(node)});this.node=doc.createGroup(this.ids)},GroupAction.prototype.undo=function(doc){var i,info;if(0!==this.ids.length){for(i=this.ids.length-1;i>=0&&!(i<0);i+=-1)info=this.old[i],doc.addChild(info.parent,info.node,info.index);return doc.removeNode(this.node)}},GroupAction.prototype.getAffectedIds=function(doc,set){return set.add(doc.peekNextId())},GroupAction.prototype.toString=function(){return"GroupAction("+JSON.stringify(this.ids)+")"};var UngroupAction=function(ids){this.ids=ids,this.groups=[]};__extends(UngroupAction,Action),UngroupAction.prototype._class="UngroupAction",UngroupAction.prototype.redo=function(doc){var child,id,info,node,nodesProcessed,_i,_j,_len,_len2,_ref,_ref2,_ref3;for(nodesProcessed=[],_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)if(id=_ref[_i],(node=doc.getNode(id)).isGroup()&&(_ref2=node.id,!(__indexOf.call(nodesProcessed,_ref2)>=0)))for(nodesProcessed[node.id]=!0,info={node:node,parent:node.parent,children:node.children.concat(),index:doc.removeNode(node)},this.groups.push(info),_j=0,_len2=(_ref3=info.children).length;_j<_len2;_j++)child=_ref3[_j],doc.addChild(info.parent,child,-1)},UngroupAction.prototype.undo=function(doc){var group,i,j;if(0!==this.groups.length){for(i=this.groups.length-1;i>=0&&!(i<0);i+=-1)if(0!==(group=this.groups[i]).children.length){for(j=group.children.length-1;j>=0&&!(j<0);j+=-1)doc.addChild(group.node,group.children[j],-1);doc.addChild(group.parent,group.node,group.index)}doc.forceRenumber()}},TransformNode=function(node,matrix,inverse){var child,_i,_len,_ref,_results;if(node.isGroup()){for(_results=[],_i=0,_len=(_ref=node.children).length;_i<_len;_i++)child=_ref[_i],_results.push(TransformNode(child,matrix,inverse));return _results}return node.transform(matrix,inverse)};var DuplicateAction=function(ids,offset){this.ids=ids,this.offset=offset,this.nodes=[]};__extends(DuplicateAction,Action),DuplicateAction.prototype._class="DuplicateAction",DuplicateAction.prototype.redo=function(doc){var id,inverse,namer,node,xform,_i,_len,_ref;for(inverse=(xform=new TranslateMatrix(this.offset,this.offset)).inverse(),this.nodes.length=0,namer=function(){return doc.getNextId()},_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)id=_ref[_i],node=doc.getNode(id).clone(namer),TransformNode(node,xform,inverse),doc.addNode(node),this.nodes.push(node)},DuplicateAction.prototype.undo=function(doc){var i;if(0!==this.nodes.length)for(i=this.nodes.length-1;i>=0&&!(i<0);i+=-1)doc.removeNode(this.nodes[i])},DuplicateAction.prototype.getAffectedIds=function(doc,set){var id,_ref;for(id=doc.peekNextId(),_ref=doc.closure(this.ids).length-1;id<=_ref;id+=1)set.add(id)};var ChangeOrderAction=function(ids,type){this.ids=ids,this.type=type,this.nodes=[],this.oldPositions=[]};__extends(ChangeOrderAction,Action),ChangeOrderAction.prototype._class="ChangeOrderAction",ChangeOrderAction.prototype.redo=function(doc){var id,node,oldIndex,parent,_i,_len,_ref;for(this.oldPositions.length=0,this.nodes.length=0,_i=0,_len=(_ref=this.ids).length;_i<_len;_i++)switch(id=_ref[_i],node=doc.getNode(id),parent=node.parent,oldIndex=doc.removeNode(node),this.oldPositions.push(oldIndex),this.nodes.push(node),this.type){case ChangeOrderAction.BRING_TO_FRONT:doc.addChild(parent,node,-1);break;case ChangeOrderAction.SEND_TO_BACK:doc.addChild(parent,node,0);break;case ChangeOrderAction.MOVE_DOWN:oldIndex>0?doc.addChild(parent,node,oldIndex-1):doc.addChild(parent,node,oldIndex);break;case ChangeOrderAction.MOVE_UP:oldIndex<parent.children.length?doc.addChild(parent,node,oldIndex+1):doc.addChild(parent,node,oldIndex)}},ChangeOrderAction.prototype.undo=function(doc){var i,node,parent;if(0!==this.ids.length)for(i=this.ids.length-1;i>=0&&!(i<0);i+=-1)parent=(node=this.nodes[i]).parent,doc.removeNode(node),doc.addChild(parent,node,this.oldPositions[i])},ChangeOrderAction.BRING_TO_FRONT=0,ChangeOrderAction.SEND_TO_BACK=1,ChangeOrderAction.MOVE_UP=2,ChangeOrderAction.MOVE_DOWN=3;var SetBackgroundAction=function(url){this.createAction=new CreateAction("ImageNode",{url:resolveUrl(decodeURIComponent(url)),locked:!0}),this.oldBackground=null};__extends(SetBackgroundAction,Action),SetBackgroundAction.prototype._class="SetBackgroundAction",SetBackgroundAction.prototype.redo=function(doc){this.oldBackground=doc.findBackground(),this.createAction.redo(doc),doc.setBackground(this.createAction.node)},SetBackgroundAction.prototype.undo=function(doc){this.createAction.undo(doc),this.oldBackground&&doc.setBackground(this.oldBackground)},ZwibblerView.prototype={init:function(canvas,doc,colourPanel,eventSource,config){this.config=config,this.scale=config.scale,this.colourPanel=colourPanel,this.eventSource=eventSource,this.canvas=canvas[0],this.ctx=this.canvas.getContext("2d"),this.zwibblerContext=null,this.registerEvents(),this.initializeKeyboardCursor(),this.behaviour=null,this.setBehaviour(new DefaultBehaviour(this)),this.propertyPanel=null;var self=this;this.request=new FormatRequest,this.request.canvas=this.canvas,this.request.getScale=function(){return self.scale},this.request.on("reformat",function(node){self.log("Node %s requests reformat",node.id),self.doc.exists(node.id)&&(self.log("   Reformatting..."),self.doc.markRedraw(node.id),self.update())}),this.request.on("convert-dom-request",function(dataString,node){self.zwibblerContext.emit("convert-dom-request",dataString,node)}),this.editNode=null,this.HANDLE_RADIUS=4,this.RESIZE_RADIUS=9,this.config.useTouch()?this.HANDLE_TOUCH_RADIUS=4*this.HANDLE_RADIUS:this.HANDLE_TOUCH_RADIUS=2*this.HANDLE_RADIUS,this.NE=1,this.SE=2,this.SW=3,this.NW=4,this.ROT=5,this.eventSource.bind("menu.edit",function(e){self.propertyPanel&&(self.propertyPanel.resetOffset(),self.propertyPanel.show())}),this.eventSource.bind("menu.undo",function(e){self.undo()}),this.eventSource.bind("menu.redo",function(e){self.redo()}),this.eventSource.bind("menu.copy",function(e){self.copy()}),this.eventSource.bind("menu.cut",function(e){self.copy(),self.deleteAction()}),this.eventSource.bind("menu.paste",function(e){self.paste()}),this.eventSource.bind("menu.duplicate",function(e){self.duplicate()}),this.eventSource.bind("menu.moveUp",function(e){self.moveUp()}),this.eventSource.bind("menu.moveDown",function(e){self.moveDown()}),this.eventSource.bind("menu.bringToFront",function(e){self.bringToFront()}),this.eventSource.bind("menu.sendToBack",function(e){self.sendToBack()}),this.eventSource.bind("menu.group",function(e){self.group()}),this.eventSource.bind("menu.ungroup",function(e){self.ungroup()}),this.eventSource.bind("menu.delete",function(e){self.deleteAction()}),this.eventSource.bind("menu.outline-none",function(e){self.setProperty("lineWidth",0)}),this.eventSource.bind("menu.outline-pencil",function(e){self.setProperty("lineWidth",1)}),this.eventSource.bind("menu.outline-pen",function(e){self.setProperty("lineWidth",2)}),this.eventSource.bind("menu.outline-marker",function(e){self.setProperty("lineWidth",4)}),this.eventSource.bind("menu.shadow-none",function(e){self.setProperty("shadow",!1)}),this.eventSource.bind("menu.shadow",function(e){self.setProperty("shadow",!0)}),this.eventSource.bind("menu.font.FG Virgil",function(e){self.setProperty("fontName","FG Virgil")}),this.eventSource.bind("menu.font.Stinky Kitty",function(e){self.setProperty("fontName","Stinky Kitty")}),this.eventSource.bind("menu.font.Arial",function(e){self.setProperty("fontName","Arial")}),this.eventSource.bind("menu.font.Times New Roman",function(e){self.setProperty("fontName","Times New Roman")}),this.eventSource.bind("menu.sloppiness-draftsman",function(e){self.setProperty("sloppiness",0)}),this.eventSource.bind("menu.sloppiness-artist",function(e){self.setProperty("sloppiness",.25)}),this.eventSource.bind("menu.sloppiness-Cartoonist",function(e){self.setProperty("sloppiness",.5)}),this.eventSource.bind("menu.sloppiness-child",function(e){self.setProperty("sloppiness",1)}),this.eventSource.bind("menu.sloppiness-dizzy",function(e){self.setProperty("sloppiness",2)}),this.eventSource.bind("menu.insert.cylinder",function(e){var id=self.doc.peekNextId(),commands=new PathCommands([]);commands.moveTo(100,100),commands.lineTo(200,100),commands.lineTo(200,200),commands.cornerTo(200,225,150,225),commands.cornerTo(100,225,100,200),commands.lineTo(100,100),commands.close();var circle=new PathCommands;circle.moveTo(100,100),circle.cornerTo(100,75,150,75),circle.cornerTo(200,75,200,100),circle.cornerTo(200,125,150,125),circle.cornerTo(100,125,100,100),circle.close(),self.commit([new CreateAction("PathNode",{commands:commands.toArray()}),new CreateAction("PathNode",{commands:circle.toArray()}),new GroupAction([id,id+1])])}),this.setDocument(doc)},log:log.create("VIEW"),setDocument:function(doc){this.doc=doc,this.translateX=0,this.translateY=0,this.selection=[],this.editNode=null,this.selectGeneration=1,this.selectionBounds=new Rectangle(0,0,0,0),this.selectHandleTransform=new Matrix,this.enableRotationHandle=!0,this.rotHandleX=0,this.rotHandleY=0,this.hintText="",this.defaultFillStyle="#ffffff",this.defaultBrushStyle=this.config.getOption("defaultBrushColour"),this.defaultStrokeStyle=this.config.getOption("defaultOutlineColour"),this.defaults={},this.defaults.lineWidth=this.config.getDefaultOutlineThickness(),this.defaults.sloppiness=.5,this.defaults.fontName=this.config.getOption("defaultFont"),this.defaults.fontSize=this.config.getOption("defaultFontSize"),this.defaults.arrowSize=this.config.getDefaultArrowSize(),this.defaults.smoothness=.3,this.defaults.textFillStyle=this.config.getOption("defaultTextColour"),this.defaults.shadow=this.config.getOption("defaultShadow"),this.defaultBrushThickness=this.config.getDefaultBrushThickness(),this.doc.format(this.ctx,this.request),this.draw()},setDefault:function(name,value){this.defaults[name]=value,"fillStyle"===name?this.defaultFillStyle=value:"strokeStyle"===name&&(this.defaultStrokeStyle=value)},screenPoint:function(pagex,pagey){var offset=$(this.canvas).offset(),x=(pagex-offset.left-4-this.translateX)/this.scale,y=(pagey-offset.top-4-this.translateY)/this.scale;return this.snap(new Point(x,y))},documentPoint:function(docx,docy){var offset=$(this.canvas).offset();return new Point(docx*this.scale+this.translateX+offset.left+4,docy*this.scale+this.translateY+offset.top+4)},touchPoint:function(touch){return this.screenPoint(touch.pageX,touch.pageY)},onKeyCommand:function(action,e){if(!this.handleKeyboardCursorKeys(action,e))switch(this.behaviour.onKeyCommand&&this.behaviour.onKeyCommand(action,e),action){case"send-to-back":case"bring-to-front":case"move-up":case"move-down":case"up":case"down":e.preventDefault(),e.stopPropagation()}},registerEvents:function(){var self=this;this.canvas.addEventListener("touchstart",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.behaviour.onTouch&&(self.behaviour.onTouch(e),e.stopPropagation(),e.preventDefault())},!1),this.canvas.addEventListener("touchmove",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.behaviour.onTouch&&(self.behaviour.onTouch(e),e.stopPropagation(),e.preventDefault())},!1),this.canvas.addEventListener("touchend",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.behaviour.onTouch&&(self.behaviour.onTouch(e),e.stopPropagation(),e.preventDefault())},!1),this.canvas.addEventListener("gesturestart",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.log("GestureStart"),self.behaviour.onGesture&&(self.behaviour.onGesture(e),e.stopPropagation(),e.preventDefault())},!1),this.canvas.addEventListener("gesturechange",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.log("GestureChange"),self.behaviour.onGesture&&(self.behaviour.onGesture(e),e.stopPropagation(),e.preventDefault())},!1),this.canvas.addEventListener("gestureend",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.log("GestureEnd"),self.behaviour.onGesture&&(self.behaviour.onGesture(e),e.stopPropagation(),e.preventDefault())},!1),$(this.canvas).mousemove(function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();if(self.behaviour.onMouseMove){var offset=$(self.canvas).offset(),x=(e.pageX-offset.left-4-self.translateX)/self.scale,y=(e.pageY-offset.top-4-self.translateY)/self.scale;self.behaviour.onMouseMove(x,y)}}),$(this.canvas).mousedown(function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();var offset=$(self.canvas).offset();if(self.log("Offset=%s",offset),self.behaviour.onMouseDown){var x=(e.pageX-offset.left-4-self.translateX)/self.scale,y=(e.pageY-offset.top-4-self.translateY)/self.scale;self.behaviour.onMouseDown(x,y,e)}e.preventDefault()}),$(this.canvas).mouseup(function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();var offset=$(self.canvas).offset();if(self.behaviour.onMouseUp){var x=(e.pageX-offset.left-4-self.translateX)/self.scale,y=(e.pageY-offset.top-4-self.translateY)/self.scale;self.behaviour.onMouseUp(x,y)}e.preventDefault()}),$(this.canvas).click(function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();var offset=$(self.canvas).offset();if($(self.canvas).focus(),self.behaviour.onMouseClick){var x=(e.pageX-offset.left-4-self.translateX)/self.scale,y=(e.pageY-offset.top-4-self.translateY)/self.scale;self.behaviour.onMouseClick(x,y)}e.preventDefault()}),$(this.canvas).on("dblclick dbltap",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();var offset=$(self.canvas).offset();if(self.behaviour.onDoubleClick){var x=(e.pageX-offset.left-4-self.translateX)/self.scale,y=(e.pageY-offset.top-4-self.translateY)/self.scale;self.behaviour.onDoubleClick(x,y)}e.preventDefault()}),$(this.canvas).focus(),this.colourPanel.bind("colour",function(e){if(self.isReadOnly())return e.stopPropagation(),void e.preventDefault();self.behaviour.onColourClicked&&self.behaviour.onColourClicked(e)})},initializeKeyboardCursor:function(){this.keyboardCursor={shown:!1,dragging:!1,caret:!1,x:100,y:100}},handleKeyboardCursorKeys:function(action,e){if(!this.keyboardCursor.shown)return!1;var eventType,moveX=0,moveY=0,nudge=this.config.get("nudge");switch(action){case"right":moveX=nudge;break;case"left":moveX=-nudge;break;case"down":moveY=nudge;break;case"up":moveY=-nudge;break;case"enter":this.behaviour.onMouseClick?(this.keyboardCursor.dragging=!1,eventType="click"):(this.keyboardCursor.dragging=!this.keyboardCursor.dragging,eventType=this.keyboardCursor.dragging?"mousedown":"mouseup")}if((moveX||moveY)&&(this.keyboardCursor.x+=moveX,this.keyboardCursor.x=Math.max(this.keyboardCursor.x,0),this.keyboardCursor.x=Math.min(this.canvas.width,this.keyboardCursor.x),this.keyboardCursor.y+=moveY,this.keyboardCursor.y=Math.max(this.keyboardCursor.y,0),this.keyboardCursor.y=Math.min(this.canvas.height,this.keyboardCursor.y),this.draw(),eventType="mousemove"),eventType){e.preventDefault(),e.stopPropagation(),this.draw();var offset=$(this.canvas).offset(),x=this.keyboardCursor.x+offset.left,y=this.keyboardCursor.y+offset.top;this.log("Simulate a %s at (%s,%s)",eventType,x,y);var evt=document.createEvent("MouseEvents");return evt.initMouseEvent(eventType,!0,!0,window,0,x,y,x,y,!1,!1,!1,!1,this.keyboardCursor.dragging?1:0,null),this.canvas.dispatchEvent(evt),!0}return!1},showKeyboardCursor:function(caret){this.keyboardCursor.shown=!0,this.keyboardCursor.dragging=!1,this.keyboardCursor.caret=caret,this.log("Showing keyboard cursor, caret=%s",caret),this.draw()},showKeyboardCursorAndStartMoving:function(){if(this.keyboardCursor.shown=!0,this.keyboardCursor.caret=!1,this.selection.length>0){this.log("showKeyboardCursorAndStartMoving()"),this.keyboardCursor.dragging=!0;var centre=this.selectionBounds.centre();this.keyboardCursor.x=centre.x,this.keyboardCursor.y=centre.y,this.pickTool(),this.setBehaviour(new TransformSelectionBehaviour(this,this.behaviour,null,!1,centre.x-4,centre.y-4))}this.draw()},hideKeyboardCursor:function(){this.keyboardCursor.shown&&(this.keyboardCursor.shown=!1,this.draw())},isKeyboardCursorShown:function(){return this.keyboardCursor.shown},snap:function(pt){var x,y,snap=this.config.get("snap");return snap>0?(x=Math.round(pt.x/snap)*snap,y=Math.round(pt.y/snap)*snap):(x=pt.x,y=pt.y),new Point(x,y)},moveUp:function(){var ids=this.getSelectedIds();ids.length&&this.commit([new ChangeOrderAction(ids,ChangeOrderAction.MOVE_UP)])},moveDown:function(){var ids=this.getSelectedIds();ids.length&&this.commit([new ChangeOrderAction(ids,ChangeOrderAction.MOVE_DOWN)])},bringToFront:function(){var ids=this.getSelectedIds();ids.length&&this.commit([new ChangeOrderAction(ids,ChangeOrderAction.BRING_TO_FRONT)])},sendToBack:function(){var ids=this.getSelectedIds();ids.length&&this.commit([new ChangeOrderAction(ids,ChangeOrderAction.SEND_TO_BACK)])},setProperty:function(key,value){var ids=this.getSelectedIds();this.defaults[key]=value,ids.length&&this.commit([new SetAction(ids,key,value)]),this.selection.length>0&&"lineWidth"===key&&"BrushNode"===this.selection[0].type()&&(this.defaultBrushThickness=value)},group:function(){var ids=this.getSelectedIds();ids.length&&this.commit([new GroupAction(ids)])},ungroup:function(){var ids=this.getSelectedIds();ids.length&&this.commit([new UngroupAction(ids)])},deleteAction:function(){var ids=this.getSelectedIds();ids.length&&(this.commit([new DeleteAction(ids)]),this.propertyPanel&&this.propertyPanel.loadFromNodes([])),this.pickTool()},clearSelection:function(){this.selection.length>0&&(this.selectGeneration+=1,this.selection.length=0,this.log("Clear selection. selectGeneration=%s",this.selectGeneration))},addToSelection:function(node){if(this.setEditNode(null),node.selectGeneration!==this.selectGeneration){if(this.selection.push(node),node.selectGeneration=this.selectGeneration,node.isGroupMember()){for(var parent=node.parent,i=0;i<parent.children.length;i++)this.addToSelection(parent.children[i]);this.addToSelection(parent)}node.children&&node.children.length>0&&this.addToSelection(node.children[0])}},selectNodes:function(nodes){this.clearSelection();for(var i=0;i<nodes.length;i++)this.addToSelection(nodes[i]);this.doneSelecting()},commit:function(actions,alreadyDone){var addedNodes=this.doc.commit(actions,alreadyDone);if(this.doc.format(this.ctx,this.request),addedNodes.length)this.selectNodes(addedNodes);else if(this.selection.length||this.editNode){var j=0;this.selectGeneration+=1;for(var i=0;i<this.selection.length;i++)i!==j&&(this.selection[j]=this.selection[i]),this.doc.exists(this.selection[j].id)&&(this.selection[j].selectGeneration=this.selectGeneration,j++);this.selection.length!==j&&(this.selection.length=j,this.calcSelection()),0===this.selection.length&&this.clearSelection(),this.editNode&&!this.doc.exists(this.editNode.id)&&(this.editNode=null)}this.calcSelection(),this.draw(),this.eventSource.emit("document-changed")},selectByRect:function(rect){for(var nodes=this.doc.getNodesInRectangle(rect),i=0;i<nodes.length;i++)this.addToSelection(nodes[i])},doneSelecting:function(){this.calcSelection(),this.propertyPanel&&this.propertyPanel.loadFromNodes(this.selection)},calcSelection:function(){if(0!==this.selection.length){this.selectionBounds=this.selection[0].getRect().clone();for(var i=1;i<this.selection.length;i++)this.selectionBounds.union(this.selection[i].getRect());this.rotHandleX=this.selectionBounds.x+this.selectionBounds.width-20/this.scale,this.rotHandleY=this.selectionBounds.y}},checkSelection:function(){for(var dest=0,i=0;i<this.selection.length;i++)i!==dest&&(this.selection[dest]=this.selection[i]),this.doc.exists(this.selection[dest].id)&&(dest+=1);this.selection.length!==dest&&(this.selection.length=dest)},getSelectedNodes:function(){var nodes=this.selection.concat();this.editNode&&nodes.push(this.editNode),this.log("editNode=%s",this.editNode?this.editNode.id:"none");for(var i=0;i<nodes.length;i++)this.log("Selected node=%s",nodes[i].id);return nodes},getSelectedIds:function(){for(var result=[],nodes=this.doc.collapseGroups(this.getSelectedNodes()),i=0;i<nodes.length;i++)this.log("Selected id=%s",nodes[i].id),result.push(nodes[i].id);return result},hasSelection:function(){return this.selection.length>0},update:function(forceDraw){this.doc.forceRedraw=!0===forceDraw||this.doc.forceRedraw,(this.doc.format(this.ctx,this.request)||forceDraw)&&(this.calcSelection(),this.draw())},drawBackground:function(){var snap=this.config.get("snap");if(snap>0){this.ctx.beginPath();for(var y=0;y<this.canvas.height;y+=snap)for(var x=0;x<this.canvas.width;x+=snap)this.ctx.arc(x,y,3,0,2*Math.PI,!1),this.log("x=%s width=%s",x,this.canvas.width);this.ctx.fillStyle="#c0c0c0",this.ctx.fill()}},drawKeyboardCursor:function(ctx){if(this.keyboardCursor.shown){var x=this.keyboardCursor.x,y=this.keyboardCursor.y;ctx.globalCompositeOperation="xor",ctx.beginPath(),this.keyboardCursor.caret?(ctx.moveTo(x-3,y-10),ctx.lineTo(x+3,y-10),ctx.moveTo(x-3,y+10),ctx.lineTo(x+3,y+10),ctx.moveTo(x,y-10),ctx.lineTo(x,y+10)):(ctx.moveTo(x,y-3),ctx.lineTo(x,y-15),ctx.moveTo(x,y+3),ctx.lineTo(x,y+15),ctx.moveTo(x-3,y),ctx.lineTo(x-15,y),ctx.moveTo(x+3,y),ctx.lineTo(x+15,y)),this.keyboardCursor.dragging&&this.ctx.arc(x,y,8,0,2*Math.PI,!1),ctx.lineWidth=2,ctx.strokeStyle="#000000",ctx.stroke(),ctx.globalCompositeOperation="source-over"}},draw:function(){if(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawBackground(),this.ctx.translate(this.translateX,this.translateY),this.ctx.scale(this.scale,this.scale),this.doc.draw(this.ctx),this.behaviour.onRedraw&&this.behaviour.onRedraw(this.ctx),this.selection.length>0){this.ctx.save(),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1/this.scale;var tr=this.selectHandleTransform.apply(this.selectionBounds.x,this.selectionBounds.y),tl=this.selectHandleTransform.apply(this.selectionBounds.x+this.selectionBounds.width,this.selectionBounds.y),bl=this.selectHandleTransform.apply(this.selectionBounds.x+this.selectionBounds.width,this.selectionBounds.y+this.selectionBounds.height),br=this.selectHandleTransform.apply(this.selectionBounds.x,this.selectionBounds.y+this.selectionBounds.height);tr.x<0&&(tr.x=0,br.x=0,tl.x=this.selectionBounds.width,bl.x=this.selectionBounds.width),tr.y<0&&(tr.y=0,tl.y=0,br.y=this.selectionBounds.height,bl.y=this.selectionBounds.height),tl.x>this.canvas.width&&(tl.x=this.canvas.width,bl.x=this.canvas.width,tr.x=this.canvas.width-this.selectionBounds.width,br.x=this.canvas.width-this.selectionBounds.width),br.y>this.canvas.height&&(br.y=this.canvas.height,bl.y=this.canvas.height,tl.y=this.canvas.height-this.selectionBounds.height,tr.y=this.canvas.height-this.selectionBounds.height);var rh=new Point(this.rotHandleX,this.rotHandleY),r=this.HANDLE_RADIUS/this.scale;this.ctx.strokeRect(tl.x-r,tl.y-r,2*r,2*r),this.ctx.strokeRect(tr.x-r,tr.y-r,2*r,2*r),this.ctx.strokeRect(br.x-r,br.y-r,2*r,2*r),this.ctx.strokeRect(bl.x-r,bl.y-r,2*r,2*r),this.enableRotationHandle&&(this.ctx.beginPath(),this.ctx.strokeStyle="#008000",this.ctx.lineWidth=3/this.scale,this.ctx.moveTo(rh.x,rh.y),this.ctx.arc(rh.x,rh.y,6/this.scale,0,1.5*Math.PI,!1),this.ctx.stroke())}this.editNode&&this.editNode.drawEditHandles(this.ctx,1/this.scale),this.hintText&&(this.ctx.save(),this.ctx.font="12px Arial",this.ctx.fillStyle="#000000",this.ctx.textBaseline="top",this.ctx.textAlign="right",this.ctx.fillText(this.hintText,this.ctx.canvas.width,0),this.ctx.restore()),this.drawKeyboardCursor(this.ctx)},setEditNode:function(node){this.editNode=node},transformSelectHandles:function(matrix){this.selectHandleTransform=matrix},showRotationHandle:function(shown){this.enableRotationHandle=shown},isNodeSelected:function(node){return node.selectGeneration===this.selectGeneration},getHandleUnderPoint:function(x,y){if(this.selection.length){var r=this.HANDLE_TOUCH_RADIUS/this.scale;if(x>=this.selectionBounds.x-r&&x<this.selectionBounds.x+r){if(y>=this.selectionBounds.y-r&&y<this.selectionBounds.y+r)return this.NW;if(y>=this.selectionBounds.y+this.selectionBounds.height-r&&y<this.selectionBounds.y+this.selectionBounds.height+r)return this.SW}else if(x>=this.selectionBounds.x+this.selectionBounds.width-r&&x<this.selectionBounds.x+this.selectionBounds.width+r){if(y>=this.selectionBounds.y-r&&y<this.selectionBounds.y+r)return this.NE;if(y>=this.selectionBounds.y+this.selectionBounds.height-r&&y<this.selectionBounds.y+this.selectionBounds.height+r)return this.SE}if(x>=this.rotHandleX-r&&x<this.rotHandleX+r&&y>=this.rotHandleY-r&&y<this.rotHandleY+r)return this.ROT}return null},undo:function(){this.zwibblerContext&&!this.zwibblerContext.isValid()||(this.doc.undo(),this.doc.format(this.ctx,this.request),this.checkSelection(),this.calcSelection(),this.draw(),this.eventSource.emit("document-changed"),this.pickTool())},redo:function(){this.doc.redo(),this.doc.format(this.ctx,this.request),this.checkSelection(),this.calcSelection(),this.draw(),this.eventSource.emit("document-changed"),this.pickTool()},objectCounter:0,copy:function(){var nodes=this.getSelectedNodes();0!==nodes.length&&(this.objectCounter=0,this.copiedTransaction=this.doc.saveTransactions(nodes),this.pickTool())},duplicate:function(){var ids=this.getSelectedIds();ids.length>0&&this.commit([new DuplicateAction(ids,10)])},paste:function(){var saved=this.copiedTransaction;if(saved){var offset=5*++this.objectCounter,actions=this.doc.loads(saved,offset);this.commit(actions),this.update(),this.pickTool()}},setHintText:function(text){this.hintText=text},pickTool:function(){this.setBehaviour(new DefaultBehaviour(this))},setBehaviour:function(behaviour){this.behaviour&&this.behaviour.leave&&this.behaviour.leave(),this.behaviour=behaviour,behaviour.enter&&behaviour.enter()},lineTool:function(){this.setBehaviour(new DrawLinesBehaviour(this,!1,!1))},drawFreeformTool:function(){this.setBehaviour(new DrawFreeformBehaviour(this,this.behaviour))},drawBrushTool:function(){this.setBehaviour(new DrawBrushBehaviour(this,this.behaviour))},curveTool:function(){this.setBehaviour(new DrawLinesBehaviour(this,!0,!1))},arrowTool:function(){this.setBehaviour(new DrawLinesBehaviour(this,!0,!0))},textTool:function(){this.setBehaviour(new DrawTextBehaviour(this))},onPropertyButtonClicked:function(propertyName){this.log("Someone clicked a button for %s",propertyName),"mathml"===propertyName&&this.eventSource.emit("math.edit",this.getSelectedIds()[0])},nudgeSelection:function(dx,dy){var nudge=this.config.get("nudge");dx*=nudge/this.scale,dy*=nudge/this.scale,this.log("Nudge selection by %s, %s",dx,dy);var ids=this.getSelectedIds();if(ids.length){var xform=new TranslateMatrix(dx,dy);this.commit([new TransformAction(ids,xform,xform.inverse())])}return ids.length>0},isReadOnly:function(){return this.zwibblerContext&&this.zwibblerContext.isReadOnly()}};var TransactionList=function(){this.transactions=[],this.next=0};TransactionList.prototype.log=log.create("TRANSLIST"),TransactionList.prototype.getIndex=function(){return this.next},TransactionList.prototype.commit=function(doc,actions,base){var parentid;return null==base&&(base=null),parentid=this.transactions.length?this.transactions[this.transactions.length-1].getId():"0",this.transactions.length=this.next,null===base?(this.transactions.push(new Transaction(parentid,actions,doc.peekNextId(),null)),this.redo(doc)):(this.transactions.push(new Transaction(parentid,actions,base,null)),this.next+=1)},TransactionList.prototype.commitTransaction=function(doc,transaction,affectedIds,dependentIds){var parentid;if(parentid=this.transactions.length?this.transactions[this.transactions.length-1].getId():"0",transaction.parentid!==parentid)throw"ERROR! mismatched parent id";if(transaction.base!==doc.peekNextId())throw"ERROR! mismatched base id";return this.transactions.length=this.next,this.transactions.push(transaction),this.redo(doc,affectedIds,dependentIds)},TransactionList.prototype.redo=function(doc,affectedIds,dependentIds){var action,_i,_len,_ref;if(null==affectedIds&&(affectedIds=null),null==dependentIds&&(dependentIds=null),this.next===this.transactions.length)return!1;for(assert(doc.peekNextId()===this.transactions[this.next].base),_i=0,_len=(_ref=this.transactions[this.next].actions).length;_i<_len;_i++)action=_ref[_i],affectedIds&&action.getAffectedIds(doc,affectedIds),dependentIds&&action.getDependentIds(doc,dependentIds),action.redo(doc);return this.next+=1,!0},TransactionList.prototype.undo=function(doc,affectedIds,dependentIds){var actions,i;if(null==affectedIds&&(affectedIds=null),null==dependentIds&&(dependentIds=null),0===this.next)return!1;if(this.next-=1,0!==(actions=this.transactions[this.next].actions).length){for(i=actions.length-1;i>=0&&!(i<0);i+=-1)actions[i].undo(doc),affectedIds&&actions[i].getAffectedIds(doc,affectedIds),dependentIds&&actions[i].getDependentIds(doc,dependentIds);return doc.setNextId(this.transactions[this.next].base)}},window.JSON||(window.JSON={}),function(){function f(n){return n<10?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;i<length;i+=1)"string"==typeof(k=rep[i])&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);else for(k in value)Object.hasOwnProperty.call(value,k)&&(v=str(k,value))&&partial.push(quote(k)+(gap?": ":":")+v);return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":""},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return""+this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof window.JSON.stringify&&(window.JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;i<space;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof window.JSON.parse&&(window.JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.hasOwnProperty.call(value,k)&&(void 0!==(v=walk(value,k))?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var Api=function(){EventEmitter.apply(this,arguments),window.addEventListener("message",__bind(function(e){return this.receive(e)},this),!1),window.parent.postMessage('{"event": "ready"}',"*")};__extends(Api,EventEmitter),Api.prototype.log=log.create("Api"),Api.prototype.receive=function(e){var fn,json,replyFn,_i,_len,_ref,_results;try{json=window.JSON.parse(e.data)}catch(except){return void this.log("Error parsing %s from %s",e.data,e.origin)}if(this.log("Received %s",e.data),replyFn=function(args_array){var rep;if("ticket"in json)return rep={ticket:json.ticket,args:args_array},window.parent.postMessage(window.JSON.stringify(rep),"*")},json.function in this.events){for(_results=[],_i=0,_len=(_ref=this.events[json.function]).length;_i<_len;_i++)fn=_ref[_i],_results.push(fn(json.args,replyFn));return _results}};var ZwibblerDocument=function(){EventEmitter.apply(this,arguments),this.transactions=new TransactionList,this.nodes={},this.redraw=new Set,this.forceRedraw=!0,this.forceRenumber=!0,this.nextId=0,this.newNodes=[],this.root=new GroupNode(this.getNextId()),this.markClean(),this._insert(this.root),this.domRoot=new GroupNode(this.getNextId()),this.addChild(this.root,this.domRoot),this.domRoot.parent=null};__extends(ZwibblerDocument,EventEmitter),ZwibblerDocument.prototype.log=log.create("DOC"),ZwibblerDocument.prototype.markClean=function(){this.savedTo=this.transactions.getIndex()},ZwibblerDocument.prototype.dirty=function(){return this.savedTo!==this.transactions.getIndex()},ZwibblerDocument.prototype.rebuild=function(){for(;this.transactions.undo(this););if(this.root.children.length)throw"Error: There should be 0 children length.";if(1!==this.nextId)throw"Error: nextId should be 1";for(;this.transactions.redo(this););},ZwibblerDocument.prototype.getNextId=function(){return this.nextId++},ZwibblerDocument.prototype.setNextId=function(id){assertNumber(id),this.nextId=id,this.log("nextId now %s",id)},ZwibblerDocument.prototype.peekNextId=function(){return this.nextId},ZwibblerDocument.prototype.exists=function(id){return id in this.nodes},ZwibblerDocument.prototype._insert=function(node,redraw){var child,_i,_len,_ref;if(void 0===redraw&&(redraw=!0),assert("id"in node,"Must be a node"),!(node.id in this.nodes)&&(this.nodes[node.id]=node,this.newNodes.push(node),node.onAdded(),node.isGroup()))for(_i=0,_len=(_ref=node.children).length;_i<_len;_i++)child=_ref[_i],this._insert(child,redraw);redraw&&this.redraw.add(node.id)},ZwibblerDocument.prototype.markRedraw=function(id){return assertNumber(id),this.redraw.add(id)},ZwibblerDocument.prototype.addNode=function(node){return this.addChild(this.domRoot,node,-1)},ZwibblerDocument.prototype.getNode=function(id,redraw){var node;return void 0===redraw&&(redraw=!1),assertNumber(id),id in this.nodes?(node=this.nodes[id],this.redraw.add(id),node):null},ZwibblerDocument.prototype.commit=function(actions,base){return this.newNodes.length=0,this.transactions.commit(this,actions,base),this.newNodes},ZwibblerDocument.prototype.undo=function(){return this.transactions.undo(this)},ZwibblerDocument.prototype.redo=function(){return this.transactions.redo(this)},ZwibblerDocument.prototype.format=function(ctx,request){var ids=this.forceRedraw?this.nodes:this.redraw.toMap(),nodes=[];for(var id in ids)ids.hasOwnProperty(id)&&nodes.push(this.nodes[id]);nodes=this.collapseGroups(nodes);for(var i=0;i<nodes.length;i++)nodes[i].format(ctx,request);return this.redraw.clear(),this.forceRedraw=!1,nodes.length},ZwibblerDocument.prototype.draw=function(ctx){this.each(!1,function(node){node.hidden()||node.draw(ctx)})},ZwibblerDocument.prototype.hittest=function(x,y){return this.root.hittest(x,y)},ZwibblerDocument.prototype.getNodesInRectangle=function(rect){return this.filter(function(node){return rect.contains(node.getRect())})},ZwibblerDocument.prototype.collapseGroups=function(nodes){var added,node,result,_i,_len;for(result=[],added={},_i=0,_len=nodes.length;_i<_len;_i++){for(node=nodes[_i];node.isGroupMember();)node=node.parent;node.id in added||(added[node.id]=!0,result.push(node))}return this.sortNodes(result),result},ZwibblerDocument.prototype.closure=function(ids,result){var id,process,_i,_len;for(result=result||new Set,process=function(node){var child,_i,_len,_ref,_results;if(result.add(node.id),node.isGroup()){for(_results=[],_i=0,_len=(_ref=node.children).length;_i<_len;_i++)child=_ref[_i],_results.push(process(child));return _results}},_i=0,_len=ids.length;_i<_len;_i++)id=ids[_i],process(this.nodes[id]);return result},ZwibblerDocument.prototype.each=function(wantGroups,fn){var process;(process=function(node){var child,_i,_len,_ref;if(node.isGroup())for(wantGroups&&fn(node),_i=0,_len=(_ref=node.children).length;_i<_len;_i++)child=_ref[_i],process(child);else fn(node)})(this.root)},ZwibblerDocument.prototype.filter=function(fn){var results;return results=[],this.each(!1,function(node){if(fn(node))return results.push(node)}),results},ZwibblerDocument.prototype.sortNodes=function(nodes){var count;return count=0,this.forceRenumber&&(this.forceRenumber=!1,this.each(!0,function(node){node.order=count++})),nodes.sort(function(a,b){return a.order-b.order}),nodes},ZwibblerDocument.prototype.createGroup=function(ids){var group,id,_i,_len;for(group=new GroupNode(this.getNextId()),this.addNode(group),_i=0,_len=ids.length;_i<_len;_i++)id=ids[_i],this.addChild(group,this.nodes[id],-1);return group},ZwibblerDocument.prototype.getTransactionCount=function(){return this.transactions.transactions.length},ZwibblerDocument.prototype.saveTransactions=function(nodes){var actions,id,node,_i,_len,_ref;for(actions=[],id=0,_i=0,_len=(_ref=this.collapseGroups(nodes)).length;_i<_len;_i++)node=_ref[_i],id=this._save(node,actions,id);return JSON.stringify(actions)},ZwibblerDocument.prototype._save=function(node,actions,nextid){var child,members,name,properties,value,x,_i,_len,_ref;if(node.isGroup()){for(members=[],_i=0,_len=(_ref=node.children).length;_i<_len;_i++)child=_ref[_i],nextid=this._save(child,actions,nextid),members.push(nextid-1);actions.push({type:"GroupAction",members:members})}else{properties=node.getProperties(),x={};for(name in properties)properties.hasOwnProperty(name)&&((value=properties[name])instanceof Matrix&&(value=["Matrix",value.m11,value.m12,value.m21,value.m22,value.dx,value.dy]),x[name]=value);actions.push({type:"CreateAction",node:node.type(),properties:x})}return nextid+1},ZwibblerDocument.prototype.loads=function(input,offset){var actions,base,item,items,name,properties,renamer,value,x,_i,_j,_len,_len2;for(actions=[],_i=0,_len=(items=JSON.parse(input)).length;_i<_len;_i++)if("GroupAction"===(item=items[_i]).type)actions.push(new GroupAction(item.members));else if("CreateAction"===item.type){x=item.properties,properties={};for(name in x)x.hasOwnProperty(name)&&(value=x[name],"[object Array]"===Object.prototype.toString.apply(value)&&"Matrix"===value[0]&&(value.splice(0,1),"inverse"===name?(value[4]-=offset,value[5]-=offset):(value[4]+=offset,value[5]+=offset),value=new Matrix(value)),properties[name]=value);actions.push(new CreateAction(item.node,properties))}for(base=this.nextId,renamer=__bind(function(oldName){return this.log("Remap %s -> %s",oldName,oldName+base),oldName+base},this),_j=0,_len2=actions.length;_j<_len2;_j++)actions[_j].rename(renamer);return actions},ZwibblerDocument.prototype.addChild=function(parent,child,index){child.parent&&this.removeNode(child,!1),-1===index?parent.children.push(child):parent.children.splice(index,0,child),this._insert(child),this.forceRenumber=!0,child.parent=parent},ZwibblerDocument.prototype.removeNode=function(child,detach){var index,process;return void 0===detach&&(detach=!0),(index=child.parent.findChildIndex(child))>=0&&(child.parent.children.splice(index,1),child.parent=null,detach&&(process=__bind(function(node){var n,_i,_len,_ref;if(delete this.nodes[node.id],child.onRemoved(),this.redraw.remove(node.id),node.isGroup())for(_i=0,_len=(_ref=node.children).length;_i<_len;_i++)n=_ref[_i],process(n)},this))(child)),index},ZwibblerDocument.prototype.findBackground=function(){var firstNode=this.root.children[0];if(firstNode&&firstNode.locked&&"ImageNode"==firstNode.type())return firstNode},ZwibblerDocument.prototype.setBackground=function(background){var oldBackground=this.findBackground();oldBackground&&this.removeNode(oldBackground),"number"==typeof background&&(background=this.getNode(background),this.removeNode(background)),this.addChild(this.root,background,0)},ZwibblerDocument.prototype.docString=function(){var parts,process;return parts=[],(process=function(node,level){var child,i,_i,_len,_ref,_ref2;for(i=0,_ref=level-1;i<=_ref;i+=1)parts.push("  ");if(parts.push(node.type()),parts.push(":"+node.id+"\n"),node.isGroup())for(_i=0,_len=(_ref2=node.children).length;_i<_len;_i++)child=_ref2[_i],process(child,level+1)})(this.root,0),parts.join("")},ZwibblerDocument.prototype.getRect=function(){var bottom,left,right,top;return left=null,right=null,top=null,bottom=null,this.each(!1,function(node){(null===left||node.rect.x<left)&&(left=node.rect.x),(null===right||node.rect.right()>right)&&(right=node.rect.right()),(null===top||node.rect.y<top)&&(top=node.rect.y),(null===bottom||node.rect.bottom()>bottom)&&(bottom=node.rect.bottom())}),null===left?new Rectangle(0,0,10,10):new Rectangle(left,top,right-left,bottom-top)},ZwibblerDocument.log=log.create("DOC"),ZwibblerDocument.prototype.getResponseXml=function(){try{for(var list=ZwibblerDocument.exportAsList(this.root),j=0,resArr=[],i=0;i<list.length;i++){var lItem=list[i],res="<node>";if("ImageNode"!==lItem.type){for(var p in lItem)if("matrix"===p||"commands"===p||"points"===p){var matrixData=lItem[p];for(j=0;j<matrixData.length;j++)res+="<"+p+">"+matrixData[j]+"</"+p+">"}else if("url"===p)res+="<"+p+">nobgimg</"+p+">";else if("data"===p){res+="<data>";for(var eqd in lItem[p])if("tabConfig"==eqd){res+="<tabConfig>";var tcOrder=lItem[p][eqd];for(j=0;j<tcOrder.Order.length;j++)res+="<Order>"+tcOrder.Order[j]+"</Order>";res+="</tabConfig>"}else"editorlabels"==eqd.toLowerCase()||(res+="<"+eqd+">"+lItem[p][eqd]+"</"+eqd+">");res+="</data>"}else res+="<"+p+">"+lItem[p]+"</"+p+">";res+="</node>",resArr.push(res)}}return"<response>"+resArr.join(" ")+"</response>"}catch(e){return"Unsupported format: xml"}},ZwibblerDocument.prototype.processResponseXml=function(contents){try{contents=(contents=contents.replace(/<mathML>/g,"<mathML><![CDATA[")).replace(/<\/mathML>/g,"]]></mathML>");var list=JSON.parse(xml2jsonv2(parseXml(contents),""));for(var i in list.response.node)for(var p in list.response.node[i])if("id"===p||"lineWidth"==p||"parent"==p||"arrowSize"==p)list.response.node[i][p]=parseInt(list.response.node[i][p]);else if("fontSize"===p||"smoothness"==p||"sloppiness"==p)list.response.node[i][p]=parseFloat(list.response.node[i][p]);else if("matrix"===p||"commands"===p||"points"===p)for(var j=0;j<list.response.node[i][p].length;j++)list.response.node[i][p][j]=parseFloat(list.response.node[i][p][j]);else"string"!=typeof list.response.node[i][p]||"true"!=list.response.node[i][p]&&"false"!=list.response.node[i][p]?"text"==p&&(list.response.node[i][p]=null!=list.response.node[i][p]?list.response.node[i][p]:""):list.response.node[i][p]="true"==list.response.node[i][p];for(i in list.response.node){var n=list.response.node[i];void 0!==n.data&&(n.data.mathML=[n.data.mathML["#cdata"]])}return list.response.node}catch(e){throw"XML Format detection failed."}},ZwibblerDocument.prototype.save=function(format){if("list"===format)return ZwibblerDocument.exportAsList(this.root);if("zwibbler3"===format){var list=ZwibblerDocument.exportAsList(this.root);return"zwibbler3."+window.JSON.stringify(list)}throw"Unknown save format: "+format},ZwibblerDocument.load=function(contents){if(0===contents.indexOf("zwibbler3.")){var list=window.JSON.parse(contents.substr(10));return ZwibblerDocument.importFromList(list)}throw"Format detection failed."},ZwibblerDocument.exportAsList=function(root){function handle(parent,node){var saved={id:node.id,type:node.type()};list.push(saved),parent&&(saved.parent=parent.id);var properties=node.getProperties();for(var name in properties)properties.hasOwnProperty(name)&&("matrix"===name?saved[name]=properties[name].toArray():"inverse"===name||(saved[name]=properties[name]));if(node.isGroup())for(var i=0;i<node.children.length;i++)handle(node,node.children[i])}var list=[];return handle(null,root),list},ZwibblerDocument.importFromList=function(list,zwibblerDocument){function handle(item){var j;if(void 0!==item){if(void 0!==item.children){for(j=0;j<item.children.length;j++)handle(item.children[j]);if(0!==item.id){var members=[];for(j=0;j<item.children.length;j++)members.push(mapping[item.children[j].id]);actions.push(new GroupAction(members))}}else{var properties={};for(var key in item)item.hasOwnProperty(key)&&("children"===key||"parent"===key||"id"===key||"type"===key||("matrix"===key?(properties[key]=new Matrix(item[key]),properties.inverse=properties.matrix.inverse()):properties[key]=item[key]));actions.push(new CreateAction(item.type,properties))}0!==item.id&&(mapping[nextId]=item.id,nextId+=1)}}var i,parent,child;list=window.JSON.parse(window.JSON.stringify(list));var actions=[],mapping={},nextId=1,tree={};for(i=0;i<list.length;i++){if("parent"in(child=list[i])){if(!(child.parent in tree))throw"Error: child "+child.id+" references parent "+child.parent+" before it was defined.";void 0!==(parent=tree[child.parent]).children?parent.children.push(child):parent.children=[child]}"GroupNode"===child.type&&void 0===child.children&&(child.children=[]),tree[child.id]=child}for(handle(tree[0]),ZwibblerDocument.log(JSON.stringify(mapping)),i=0;i<actions.length;i++)ZwibblerDocument.log(actions[i].toString()),zwibblerDocument.commit([actions[i]]);return zwibblerDocument},Colour.RGBA=0,Colour.XYZA=1,Colour.HSVA=2,Colour.LABA=3,Colour.LAST_COLOURSPACE=3,Colour.fromString=function(colourString){colourString.toLowerCase()in Colour.CssColours&&(colourString=Colour.CssColours[colourString.toLowerCase()]);var r,g,b,a,rgbStr=/rgba\( *([0-9]+) *, *([0-9]+) *, *([0-9]+) *, *([0-9\.]+) *\)/,m=/\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i.exec(colourString);return null!==m?(r=parseInt(m[1],16)/255,g=parseInt(m[2],16)/255,b=parseInt(m[3],16)/255,a=1):null!==(m=rgbStr.exec(colourString))?(r=parseFloat(m[1])/255,g=parseFloat(m[2])/255,b=parseFloat(m[3])/255,a=parseFloat(m[4])):(r=1,g=0,b=1,a=1),new Colour(Colour.RGBA,[r,g,b,a])},Colour.prototype={toString:function(){function toHex(val){return(val=Math.round(255*val))<16?"0"+val.toString(16):val.toString(16)}var clr=this.convertTo(Colour.RGBA);return 1===clr.values[3]?"#"+toHex(clr.values[0])+toHex(clr.values[1])+toHex(clr.values[2]):"rgba("+Math.round(255*clr.values[0])+","+Math.round(255*clr.values[1])+","+Math.round(255*clr.values[2])+","+clr.values[3]+")"},convertTo:function(type){return Colour.converters[this.type][type](this)},distanceTo:function(colour){if(colour.type!==this.type&&(colour=colour.convertTo(this.type)),this.type===Colour.HSVA){var hueDiff,a=this.values[0],b=colour.values[0];return hueDiff=a>b?Math.min(a-b,b-a+360):Math.min(b-a,a-b+360),hueDiff/=360,Math.pow(hueDiff*hueDiff+(this.values[1]-colour.values[1])*(this.values[1]-colour.values[1])+(this.values[2]-colour.values[2])*(this.values[2]-colour.values[2]),.5)}return Math.pow((this.values[0]-colour.values[0])*(this.values[0]-colour.values[0])+(this.values[1]-colour.values[1])*(this.values[1]-colour.values[1])+(this.values[2]-colour.values[2])*(this.values[2]-colour.values[2]),.5)}},function(){function convert_HSVA_RGBA(clr){var h=clr.values[0],s=clr.values[1],v=clr.values[2];h<0&&(h+=360);var r,g,b,hi=Math.floor(h/60)%6,f=h/60-Math.floor(h/60),p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s);switch(hi){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q}return new Colour(Colour.RGBA,[r,g,b,clr.values[3]])}function convert_RGBA_HSVA(clr){var h,s,v,r=clr.values[0],g=clr.values[1],b=clr.values[2],max=Math.max(r,g,b),min=Math.min(r,g,b);return max===min?h=0:max===r?h=(60*(g-b)/(max-min)+360)%360:max===g?h=60*(b-r)/(max-min)+120:max===b&&(h=60*(r-g)/(max-min)+240),s=0===max?0:1-min/max,v=max,new Colour(Colour.HSVA,[h,s,v,clr.values[3]])}function convert_XYZA_LABA(clr){function f(t){return t>6/29*(6/29)*(6/29)?Math.pow(t,1/3):7.787037037037035*t+4/29}var X=f(clr.values[0]/WHITE.X),Y=f(clr.values[1]/WHITE.Y),Z=f(clr.values[2]/WHITE.Z);return new Colour(Colour.LABA,[116*Y-16,500*(X-Y),200*(Y-Z),clr.values[3]])}function convert_LABA_XYZA(clr){var X,Y,Z,fy=(clr.values[0]+16)/116,fx=fy+clr.values[1]/500,fz=fy-clr.values[2]/200;return Y=fy>6/29?WHITE.Y*fy*fy*fy:3*(fy-16/116)*(6/29)*(6/29)*WHITE.Y,X=fx>6/29?WHITE.X*fx*fx*fx:3*(fx-16/116)*(6/29)*(6/29)*WHITE.X,Z=fz>6/29?WHITE.Z*fz*fz*fz:3*(fz-16/116)*(6/29)*(6/29)*WHITE.Z,new Colour(Colour.XYZA,[X,Y,Z,clr.values[3]])}function convert_RGBA_XYZA(rgb){for(var temp=[],i=0;i<3;i++)rgb.values[i]<=.04045?temp[i]=rgb.values[i]/12.92:temp[i]=Math.pow((rgb.values[i]+.055)/1.055,2.4);return new Colour(Colour.XYZA,[.4124*temp[0]+.3576*temp[1]+.1805*temp[2],.2126*temp[0]+.7152*temp[1]+.0722*temp[2],.0193*temp[0]+.1192*temp[1]+.9505*temp[2],rgb.values[3]])}function convert_XYZA_RGBA(xyz){var temp=[],values=[];temp[0]=3.241*xyz.values[0]-1.5374*xyz.values[1]-.4986*xyz.values[2],temp[1]=-.9692*xyz.values[0]+1.876*xyz.values[1]+.0416*xyz.values[2],temp[2]=.0556*xyz.values[0]-.204*xyz.values[1]+1.057*xyz.values[2];for(var i=0;i<3;i++)temp[i]<=.0031308?values[i]=12.92*temp[i]:values[i]=1.055*Math.pow(temp[i],1/2.4)-.055;return values[3]=xyz.values[3],new Colour(Colour.RGBA,values)}function convert_SAME(clr){return new Colour(clr.type,clr.values.concat())}function convert_RGBA_LABA(clr){return convert_XYZA_LABA(convert_RGBA_XYZA(clr))}function convert_XYZA_HSVA(clr){return convert_RGBA_HSVA(convert_XYZA_RGBA(clr))}var WHITE={X:.9505,Y:1,Z:1.089};Colour.converters=[[convert_SAME,convert_RGBA_XYZA,convert_RGBA_HSVA,convert_RGBA_LABA],[convert_XYZA_RGBA,convert_SAME,convert_XYZA_HSVA,convert_XYZA_LABA],[convert_HSVA_RGBA,function(clr){return convert_RGBA_XYZA(convert_HSVA_RGBA(clr))},convert_SAME,function(clr){return convert_RGBA_LABA(convert_HSVA_RGBA(clr))}],[function(clr){return convert_XYZA_RGBA(convert_LABA_XYZA(clr))},convert_LABA_XYZA,function(clr){return convert_XYZA_HSVA(convert_LABA_XYZA(clr))},convert_SAME]]}(),Colour.CssColours={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ColourPanel.prototype.init=function(parent,size,useTouch,colours){EventEmitter.call(this),this.canvas=$("<div>",{class:"sp_colour_panel"}),this.useTouch=useTouch,this.colours=colours||["#000000","#ffffff","#000088","#008800","#008888","#880000","#880088","#884400","#888888","#444444","#0000ff","#00ff00","#00ffff","#ff0000","#ff00ff","#ffff00"],this.buildPanel(this.colours,this.canvas),parent.append(this.canvas)},ColourPanel.prototype.buildPanel=function(colours,p){for(var ul=$("<ul>",{class:"sp_color_ul"}),i=0;i<colours.length;++i){var colour=colours[i],li=$("<li>",{class:"sp_colour_list_item"}).append($("<a>",{title:"Fill color",class:"sp_colour sp_colour_"+colour.replace("#",""),text:colour,click:this.onMouseClick.bind(this,colour)}));ul.append(li)}p.append(ul)},ColourPanel.prototype.setWidth=function(width){this.width=width},ColourPanel.prototype.setHeight=function(height){this._height=height},ColourPanel.prototype.height=function(){return this._height},ColourPanel.prototype.moveTo=function(x,y){},ColourPanel.prototype.draw=function(){},ColourPanel.prototype.hide=function(){this.canvas.hide()},ColourPanel.prototype.show=function(){this.canvas.show()},ColourPanel.prototype.onMouseClick=function(colour,evt){evt=evt||window.event,console.log("The colour, the button etc.",colour,evt),$(".sp_colour").removeClass("sp_colour_select"),$(".sp_colour_"+colour.replace("#","")).addClass("sp_colour_select"),console.log($(".sp_color_"+colour.replace("#",""))),this.emit("colour",{colour:colour,button:evt.which})},$.extend(ColourPanel.prototype,EventEmitter.prototype);var nextIdForColorWheelSlider=0;ColourWheel.prototype={setFromColour:function(colourString){this.hsv=Colour.fromString(colourString).convertTo(Colour.HSVA),null!==this.alphaSlider?this.alphaSlider.value=Math.round(255*this.hsv.values[3]):null!==this.colourSlider&&(this.colourSlider.value=Math.round(255*this.hsv.values[3])),this.draw(),this.update()},update:function(){this.onUpdate&&this.onUpdate(this.hsv.toString())},draw:function(){this.ctx.save(),this.ctx.lineWidth=1,this.ctx.fillStyle="rgb(128, 128, 128)",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.putImageData(this.data,0,0);var a=this.hsv.values[0]/180*Math.PI;this.ctx.beginPath();var p1={x:Math.cos(a)*this.inner/2+this.outer/2,y:Math.sin(a)*this.inner/2+this.outer/2},p2={x:Math.cos(a+2*Math.PI/3)*this.inner/2+this.outer/2,y:Math.sin(a+2*Math.PI/3)*this.inner/2+this.outer/2},p3={x:Math.cos(a+4*Math.PI/3)*this.inner/2+this.outer/2,y:Math.sin(a+4*Math.PI/3)*this.inner/2+this.outer/2},outLine={x:Math.cos(a)*this.outer/2+this.outer/2,y:Math.sin(a)*this.outer/2+this.outer/2},mid={x:p2.x+(p3.x-p2.x)/2,y:p2.y+(p3.y-p2.y)/2};this.ctx.moveTo(p1.x,p1.y),this.ctx.lineTo(p2.x,p2.y),this.ctx.lineTo(p3.x,p3.y),this.ctx.lineTo(p1.x,p1.y);var fill=this.ctx.createLinearGradient(p2.x,p2.y,p3.x,p3.y);fill.addColorStop(0,"#ffffff"),fill.addColorStop(1,"#000000"),this.ctx.fillStyle=fill,this.ctx.fill(),fill=this.ctx.createLinearGradient(p1.x,p1.y,mid.x,mid.y);var hsv=this.hsv.convertTo(Colour.HSVA);hsv.values[1]=1,hsv.values[2]=1;var fullRgb=hsv.convertTo(Colour.RGBA);fullRgb.values[3]=1,fill.addColorStop(0,fullRgb.toString()),fullRgb.values[3]=0,fill.addColorStop(1,fullRgb.toString()),this.ctx.fillStyle=fill,this.ctx.fill(),this.strokeStyle="#000000",this.ctx.beginPath(),this.ctx.moveTo(p1.x,p1.y),this.ctx.lineTo(outLine.x,outLine.y),this.ctx.stroke();var x,y,v;v=1-this.hsv.values[2],x=this.hsv.values[1]*p1.x+v*p3.x+(1-this.hsv.values[1]-v)*p2.x,y=this.hsv.values[1]*p1.y+v*p3.y+(1-this.hsv.values[1]-v)*p2.y,this.ctx.beginPath(),this.ctx.arc(x,y,4,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.restore(),this.p1=p1,this.p2=p2,this.p3=p3,this.mid=mid},calcClick:function(x,y){var distance=Math.sqrt((x-this.outer/2)*(x-this.outer/2)+(y-this.outer/2)*(y-this.outer/2));if("ring"===this.mouseArea||"triangle"!==this.mouseArea&&distance>=this.inner/2&&distance<=this.outer/2){var a=Math.atan2(this.outer/2-y,this.outer/2-x);this.hsv.values[0]=a/Math.PI*180+180,0===this.hsv.values[1]&&(this.hsv.values[1]=1,this.hsv.values[2]=1),this.mouseArea="ring"}else{var lambda1,lambda2,lambda3,det,p1=this.p1,p2=this.p2,p3=this.p3;det=(p1.x-p3.x)*(p2.y-p3.y)-(p2.x-p3.x)*(p1.y-p3.y),lambda1=((p2.y-p3.y)*(x-p3.x)-(p2.x-p3.x)*(y-p3.y))/det,lambda2=(-(p1.y-p3.y)*(x-p3.x)+(p1.x-p3.x)*(y-p3.y))/det,lambda3=1-Math.max(0,lambda1)-Math.max(0,lambda2),this.hsv.values[1]=Math.min(Math.max(lambda1,0),1),this.hsv.values[2]=1-Math.min(Math.max(lambda3,0),1),this.mouseArea="triangle"}this.draw(),this.update()}},PropertyPanel.prototype={log:log.create("PROP"),loadFromNodes:function(nodes){this.action=null,this.records.length=0,this.recordsByName={},this.nodes=nodes.concat();for(var hasGroup=!1,i=0;i<nodes.length;i++){var node=nodes[i];if(node.isGroupMember()&&(hasGroup=!0),"DomNode"!==node.type()){var properties=node.getProperties();for(var key in properties)properties.hasOwnProperty(key)&&this.loadFromNode(key,node)}}this.createControls(),this.config.showKeyboardHelp()&&this.showKeyboardShortcuts(nodes,hasGroup)},showKeyboardShortcuts:function(nodes,hasGroup){var keydiv=$("<div>").addClass("keydiv");$(this.contentsDiv).append(keydiv),keydiv.append("<h4>Keyboard</h4>");var Shortcuts=[{key:"C",description:"Draw curves"},{key:"L",description:"Draw lines"}];nodes.length>0&&Shortcuts.push({key:"Del",description:"Delete Selection"},{key:"Ctrl+D",description:"Duplicate Selection"},{key:"PageUp",description:"Move selection closer"},{key:"PageDown",description:"Move selection away"}),nodes.length>1&&Shortcuts.push({key:"Ctrl+G",description:"Group selection"}),hasGroup&&Shortcuts.push({key:"Ctrl+Shift+G",description:"Break apart group"}),Shortcuts.push({key:"Arrow Keys",description:"Move while zoomed"});for(var i=0;i<Shortcuts.length;i++){var a=$("<span>").text(Shortcuts[i].key).addClass("key sp_property_shortcut"),p=$("<p>").append(a);p[0].appendChild(document.createTextNode(Shortcuts[i].description)),keydiv.append(p)}},createProperty:function(node,name){var i;if("strokeStyle"===name)return{name:name,type:"colour",display:"Outline Colour"};if("fillStyle"===name)return{name:name,type:"colour",display:"Fill Colour"};if("lineWidth"===name){var values=[{name:"Pencil",value:1},{name:"Pen",value:2},{name:"Marker",value:4},{name:"Brush",value:10}];return!0!==node.getProperty("closed")&&"TextNode"!==node.type()||values.unshift({name:"None",value:0}),{name:name,display:"Outline Thickness",type:"select",values:values}}if("sloppiness"===name)return{name:"sloppiness",display:"Sloppiness",type:"select",values:[{name:"Draftsman",value:0},{name:"Artist",value:.25},{name:"Cartoonist",value:.5},{name:"Child",value:1},{name:"Dizzy",value:2}]};if("smoothness"===name)return{name:"smoothness",display:"Smoothness",type:"select",values:[{name:"Sharper",value:.1},{name:"Sharp",value:.2},{name:"Smooth",value:.3},{name:"Smoothest",value:.5}]};if("shadow"===name)return{name:"shadow",display:"Shadow",type:"select",values:[{name:"Shadow",value:!0},{name:"None",value:!1}]};if("matrix"===name||"inverse"===name||"closed"===name||"commands"===name||"seed"===name)return{name:name,type:"none"};if("text"===name)return{name:"text",display:"Text",type:"textarea"};if("textFillStyle"===name)return{name:"textFillStyle",display:"Text Colour",type:"colour"};if("fontSize"===name)return{name:"fontSize",display:"Font Size",type:"select",values:[{name:"10",value:10},{name:"12",value:12},{name:"15",value:15},{name:"20",value:20},{name:"30",value:30},{name:"40",value:40},{name:"50",value:50},{name:"60",value:60}]};if("fontName"===name){var fonts=[],allowedFonts=this.config.getOption("fonts");for(i=0;i<allowedFonts.length;i++)fonts.push({name:allowedFonts[i],value:allowedFonts[i]});return{name:"fontName",display:"Font",type:"select",values:fonts}}return"arrowSize"===name?{name:"arrowSize",display:"Arrow Head Size",type:"select",values:[{name:"None",value:0},{name:"Tiny",value:10},{name:"Small",value:15},{name:"Medium",value:20},{name:"Large",value:30}]}:"url"===name?{name:"url",display:"Image URL",type:"text"}:"mathml"===name?{name:"mathml",display:"Equation",type:"button"}:"isTextEditable"===name?{name:"isTextEditable",display:"isTextEditable",type:"none"}:{name:name,display:"Display-"+name,type:"text"}},loadFromNode:function(property,node){var record,config=this.config;property in this.recordsByName?(record=this.recordsByName[property]).value!==node.getProperty(property)&&(record.value=null):"locked"===property||"points"===property||!0===node.getProperty("closed")&&"arrowSize"===property||!1===node.getProperty("closed")&&("fontName"===property||"fontSize"===property||"textFillStyle"===property||"text"===property||"fillStyle"===property)||"BrushNode"===node.type()&&"fillStyle"===property||("MathNode"!==node.type()||"fillStyle"!==property&&"strokeStyle"!==property&&"lineWidth"!==property)&&("TextNode"===node.type()&&"fillStyle"===property||"fillStyle"===property&&!config.get("showFillColourProperty")||"strokeStyle"===property&&!config.get("showOutlineColourProperty")||"BrushNode"!==node.type()&&"lineWidth"===property&&!config.get("showOutlineThicknessProperty")||"BrushNode"===node.type()&&"lineWidth"===property&&!config.get("showBrushThicknessProperty")||"BrushNode"===node.type()&&"strokeStyle"===property&&!config.get("showBrushColourProperty")||"shadow"===property&&!config.get("showShadowProperty")||"textFillStyle"===property&&!config.get("showTextColourProperty")||"fontName"===property&&!config.get("showFontProperty")||"fontSize"===property&&!config.get("showFontSizeProperty")||"arrowSize"===property&&!config.get("showArrowHeadSizeProperty")||(record={property:this.createProperty(node,property),value:node.getProperty(property)},this.records.push(record),this.recordsByName[property]=record))},createControls:function(){$(this.contentsDiv).empty();var i,j,input,self=this,self=this,onWheelClickFn=function(wheel,input){wheel.input=input,self.wheelClicked(wheel)};for(i=0;i<this.records.length;i++){var record=this.records[i],prop=record.property;if("none"!==prop.type){var div=document.createElement("div"),span=document.createElement("span");if(span.appendChild(document.createTextNode(prop.display)),div.appendChild(span),div.appendChild(document.createElement("br")),"select"===prop.type){var select=document.createElement("select");for(j=0;j<prop.values.length;j++){var item=prop.values[j],option=document.createElement("option");option.appendChild(document.createTextNode(item.name)),option.setAttribute("value",j),item.value===record.value&&option.setAttribute("selected",""),select.appendChild(option)}select.prop=prop,select.onchange=function(){var which=parseInt(this.value,10);self.apply(this.prop.name,this.prop.values[which].value)},div.appendChild(select)}else if("colour"===prop.type){(input=document.createElement("input")).setAttribute("type","text"),input.className="sp_colour_input",input.value=record.value,input.prop=prop,input.readOnly=!0,$(input).keydown(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),div.appendChild(input);var wheel=document.createElement("a");wheel.className="sp_colour_wheel",div.appendChild(wheel),$(wheel).click(onWheelClickFn.bind(this,wheel,input)),$(input).click(onWheelClickFn.bind(this,wheel,input))}else if("text"===prop.type)(input=document.createElement("input")).setAttribute("type","text"),input.value=record.value,input.prop=prop,$(input).keydown(function(e){13===e.keyCode&&self.apply(this.prop.name,this.value)}),div.appendChild(input);else if("textarea"===prop.type)(input=document.createElement("textarea")).setAttribute("rows","3"),input.setAttribute("cols","20"),input.value=record.value,input.prop=prop,$(input).keyup(function(e){self.apply(this.prop.name,this.value)}),div.appendChild(input);else{if("button"!==prop.type)throw"Error: No such property";(input=document.createElement("input")).setAttribute("type","button"),input.value="Edit",input.prop=prop,$(input).click(function(){self.view.onPropertyButtonClicked(this.prop.name)}),div.appendChild(input)}this.contentsDiv.append(div)}}},apply:function(name,value){this.view.setProperty(name,value)},wheelClicked:function(element){if(element.hasWheel)""==element.wheel.div.style.display?element.wheel.div.style.display="none":element.wheel.div.style.display="";else{var wheel=new ColourWheel(120),self=this;wheel.setFromColour(element.input.value),wheel.onUpdate=function(colourStr){self.colourChanged(colourStr,element.input,element.input.prop)},element.wheel=wheel,element.hasWheel=!0,element.parentNode.appendChild(wheel.div)}},colourChanged:function(colour,input,prop){null!==this.action&&this.action.name===prop.name||this.view.setProperty(prop.name,colour),input.value=colour},resetOffset:function(){parseInt(this.div.css("left"))>0&&parseInt(this.div.css("top"))>-30||this.div.css({left:"155px",top:"30px"})},makeDraggableElement:function($element,$dragHandle,$boundingElement){function getPoint(event){return"number"!=typeof event.screenX&&(event=event.originalEvent.changedTouches[0]),{x:0|event.screenX,y:0|event.screenY}}function getDelta(currentEvent){var point=getPoint(currentEvent);return point.x-=mouseOrigin.x,point.y-=mouseOrigin.y,point}function getRect($element,outter){var element=$element[0],elementOffset=$element.offset();return{left:0|elementOffset.left,top:0|elementOffset.top,right:elementOffset.left+(outter?element.offsetWidth:element.scrollWidth)|0,bottom:elementOffset.top+(outter?element.offsetHeight:element.scrollHeight)|0,width:function(){return this.right-this.left},height:function(){return this.bottom-this.top}}}function getOutterRect($element){return getRect($element,!0)}function getInnerRect($element){return getRect($element,!1)}function startDrag(event){dragging||(dragging=!0,mouseOrigin=getPoint(event),elementOffsetOrigin=getOutterRect($element),$dragHandle.off("mousedown touchstart",startDrag).on("mouseup touchend",endDrag),$document.on("mousemove touchmove",drag),event.stopPropagation(),event.preventDefault())}function drag(event){function constrain(dimension,axis){elementOffsetOrigin[dimension]()<bounds[dimension]()?(delta[axis]=Math.max(delta[axis],deltaLimits.min[axis]),delta[axis]=Math.min(delta[axis],deltaLimits.max[axis])):delta[axis]=0}if(!dragging)return endDrag(event);var delta=getDelta(event),bounds=getInnerRect($boundingElement),deltaLimits={min:{x:bounds.left-elementOffsetOrigin.left,y:bounds.top-elementOffsetOrigin.top},max:{x:bounds.right-elementOffsetOrigin.right,y:bounds.bottom-elementOffsetOrigin.bottom}};constrain("width","x"),constrain("height","y"),(delta.x||delta.y)&&$element.offset({left:elementOffsetOrigin.left+delta.x,top:elementOffsetOrigin.top+delta.y}),event.stopPropagation(),event.preventDefault()}function endDrag(event){dragging&&($dragHandle.on("mousedown touchstart",startDrag).off("mouseup touchend",endDrag),$document.off("mousemove touchmove",drag),dragging=!1),event.stopPropagation(),event.preventDefault()}var mouseOrigin,elementOffsetOrigin,dragging=!1,$document=$(document);$dragHandle.on("mousedown",startDrag)}},PropertyPanel.prototype=$.extend({},Panel.prototype,PropertyPanel.prototype);var Application=function(div,options){this.div=div,this.minimal=!0,this.div.empty(),this.objectCounter=0,this.readOnly=!1,this.debugPanel=new DebugPanel($("<div>")),this.div.append(this.debugPanel.div),this.config=new Config(options),this.backgroundImageId=null,this.toolbarContainer=$("<div>",{class:"sp_toolbar"}),this.div.append(this.toolbarContainer),this.config.scale=this.config.scale||1;var canvasSize=(this.config.options.canvasSize||"600X800").split("X");this.config.originalWidth=canvasSize[0],this.config.originalHeight=canvasSize[1],this.canvasContainer=$("<div>",{class:"sp_canvas_container",width:this.config.originalWidth+"px",height:this.config.originalHeight+"px"}),this.div.append(this.canvasContainer),this.canvas=$("<canvas>",{class:"sp_main_canvas"}),this.resizeCanvas(),this.canvasContainer.append(this.canvas),this.ctx=this.canvas[0].getContext("2d"),this.config.useTouch()?this.colourPanel=new ColourPanel(this.toolbarContainer,40,!0):this.colourPanel=new ColourPanel(this.toolbarContainer,20,!1),this.eventSource=new EventEmitter,this.eventSource.bind("document-changed",__bind(function(e){return this.onLocalDocumentChanged(e)},this)),this.eventSource.bind("math.edit",__bind(function(id){this.startMathEditor(id)},this)),this.view=new ZwibblerView(this.canvas,new ZwibblerDocument,this.colourPanel,this.eventSource,this.config),this.setDefaults(),this.createToolbar(this.toolbarContainer),this.propertyPanel=new PropertyPanel(this.config,this.div.attr("id")),this.div.append(this.propertyPanel.div),this.config.showPropertyPanel()&&(this.view.propertyPanel=this.propertyPanel),this.propertyPanel.view=this.view,$(window).resize(__bind(function(){return this._onResize()},this)),this.eventSource.bind("resize",__bind(function(e){return this._onResize},this)),this.query=Url.hash(),this.showDebug="debug"in this.query||this.config.showDebug(),this.backgroundSelector=new ListView(this.div),this.backgroundSelector.div.css("border-right","1px solid black"),this.imageSelector=new ListView(this.div),this.imageSelector.div.css("border-top","1px solid black"),this.imageSelector.setLayout("horizontal"),this.imageSelector.on("click",__bind(function(url){return this.newImage(url)},this)),this.backgroundSelector.on("click",__bind(function(url){return this.setBackgroundImage(url)},this)),this.oldWidth=-1,this.oldHeight=-1,this._onResize(),this.setupKeyboardSupport(),null!==this.config.getOption("backgroundImage")&&this.setBackgroundImage(this.config.getOption("backgroundImage")),this.ensureFontsAreLoaded(),this.zwibblerContext=null};Application.prototype.log=log.create("APP"),Application.prototype.ensureFontsAreLoaded=function(){var div,fontname,_i,_len,_ref,_results;for(this.canvas[0].getContext("2d"),_results=[],_i=0,_len=(_ref=this.config.getOption("fonts")).length;_i<_len;_i++)fontname=_ref[_i],this.log("Preloading: %s",fontname),(div=$("<div>",{class:"hidden"}).css("font-family",fontname).text("abcd")).css("color","white"),_results.push(this.div.append(div));return _results},Application.prototype.setDefaults=function(){return this.config.getOption("sloppy")||this.view.setDefault("sloppiness",0),this.view.setDefault("smoothness",this.config.getDefaultSmoothness()),this.view.setDefault("fillStyle",this.config.getOption("defaultFillStyle"))},Application.prototype.setBackgroundImageList=function(images){var arg,_i,_len,_results;for(this.backgroundSelector.clear(),_results=[],_i=0,_len=images.length;_i<_len;_i++)arg=images[_i],_results.push("string"==typeof arg?this.backgroundSelector.addImage(arg,arg):this.backgroundSelector.addImage(arg.small,arg.large));return _results},Application.prototype.setIconBrowserList=function(images){var arg,_i,_len,_results;for(this.imageSelector.clear(),_results=[],_i=0,_len=images.length;_i<_len;_i++)arg=images[_i],_results.push("string"==typeof arg?this.imageSelector.addImage(arg,arg):this.imageSelector.addImage(arg.small,arg.large));return _results},Application.prototype.setDocument=function(doc){this.backgroundImageId=null,this.view.setDocument(doc),this.setDefaults(),this.findBackgroundImage()},Application.prototype.notify=function(text){return $("#notifier").text(text)},Application.prototype.onLocalDocumentChanged=function(doc){return this.log("Local document changed.")},Application.prototype.zoom=function(scale){this.canvasContainer.css({width:this.config.originalWidth*scale+"px",height:this.config.originalHeight*scale+"px"}),this.resizeCanvas(),this.view.scale=scale,this.view.update(!0)},Application.prototype.resizeCanvas=function(){var rect=this.getCanvasRectangle(this.canvasContainer);this.canvas[0].setAttribute("width",rect.width),this.canvas[0].setAttribute("height",rect.height)},Application.prototype.getCanvasRectangle=function(dom){dom=dom||this.canvasContainer;var outerRect=this.div[0].getBoundingClientRect(),innerRect=dom[0].getBoundingClientRect();return{width:innerRect.width||outerRect.width||window.innerWidth-200,height:innerRect.height||outerRect.height||window.innerHeight}},Application.prototype.createToolbar=function(div){function isKeyEvent(e){return 0===e.type.indexOf("key")}div=div||this.div;var menu,submenu,self=this;this.toolbar=new Toolbar(this.config.useTouch());var leftList=this.toolbar.ul_Left,rightList=this.toolbar.ul_Right;return this.config.get("showPickTool")&&this.toolbar.addButton("pick",function(e){self.toolbar.setButtonHighlight("pick",!0),self.view.pickTool(),isKeyEvent(e)&&self.showKeyboardCursor()},leftList,"Pick"),this.config.hasMenu()||(this.config.get("showDeleteButton")&&this.toolbar.addButton("delete",__bind(function(e){return this.eventSource.emit("menu.delete")},this),leftList,"Delete"),this.config.get("showUndoRedo")&&(this.toolbar.addButton("undo",__bind(function(e){return this.eventSource.emit("menu.undo")},this),leftList,"Undo"),this.toolbar.addButton("redo",__bind(function(e){return this.eventSource.emit("menu.redo")},this),leftList,"Redo")),this.config.get("showCopyPaste")&&(this.toolbar.addButton("copy",__bind(function(e){return this.eventSource.emit("menu.copy")},this),leftList,"Copy"),this.toolbar.addButton("paste",__bind(function(e){return this.eventSource.emit("menu.paste")},this),leftList,"Paste"))),this.config.get("showPropertyPanel")&&this.toolbar.addButton("edit",__bind(function(e){return this.eventSource.emit("menu.edit")},this),leftList,"Options"),this.config.get("showSquareTool")&&this.toolbar.addButton("box",function(e){self.toolbar.clearHighlights(),self.newRect(),isKeyEvent(e)&&self.startMovingWithKeyboard()},rightList,"Box"),this.config.get("showCircleTool")&&this.toolbar.addButton("circle",function(e){self.toolbar.clearHighlights(),self.newCircle(),isKeyEvent(e)&&self.startMovingWithKeyboard()},rightList,"Circle"),this.config.showBrushTool()&&this.toolbar.addButton("brush",function(e){self.toolbar.setButtonHighlight("brush",!0),self.view.drawBrushTool(),isKeyEvent(e)&&self.showKeyboardCursor()},rightList,"Brush"),this.config.get("showLineTool")&&this.toolbar.addButton("line",function(e){self.toolbar.setButtonHighlight("line",!0),self.view.lineTool(),isKeyEvent(e)&&self.showKeyboardCursor()},rightList,"Line"),this.config.get("showCurveTool")&&this.toolbar.addButton("curve",function(e){self.toolbar.setButtonHighlight("curve",!0),self.view.curveTool(),isKeyEvent(e)&&self.showKeyboardCursor()},rightList,"Curve"),this.config.get("showArrowTool")&&this.toolbar.addButton("arrow",function(e){self.toolbar.setButtonHighlight("arrow",!0),self.view.arrowTool(),isKeyEvent(e)&&self.showKeyboardCursor()},rightList,"Arrow"),this.config.get("showTextTool")&&this.toolbar.addButton("text",__bind(function(e){this.toolbar.clearHighlights(),this.newText(),isKeyEvent(e)&&self.showKeyboardCursor(!0)},this),rightList,"Text"),this.toolbar.setButtonHighlight("pick",!0),this.config.getOption("showImageTool")&&this.toolbar.addButton("pick",__bind(function(e){return this.newImage("logo.png")},this,rightList)),div.prepend(this.toolbar.div),menu=new Menu,(submenu=new Menu).addItem("New","menu.new"),menu.addSubmenu("File",submenu),(submenu=new Menu).addItem("Undo\tCtrl+Z","menu.undo"),submenu.addItem("Redo\tCtrl+Shift+Z","menu.redo"),submenu.addSeparator(),submenu.addItem("Cut\tCtrl+X","menu.cut"),submenu.addItem("Copy\tCtrl+C","menu.copy"),submenu.addItem("Paste\tCtrl+V","menu.paste"),submenu.addItem("Duplicate\tCtrl+D","menu.duplicate"),submenu.addSeparator(),submenu.addItem("Delete\tDel","menu.delete"),menu.addSubmenu("Edit",submenu),(submenu=new Menu).addItem("Raise","menu.moveUp"),submenu.addItem("Lower","menu.moveDown"),submenu.addItem("Raise to front","menu.bringToFront"),submenu.addItem("Send to back","menu.sendToBack"),submenu.addSeparator(),submenu.addItem("Group","menu.group"),submenu.addItem("Break apart group","menu.ungroup"),menu.addSubmenu("Arrange",submenu),(submenu=new Menu).addItem("No Outline","menu.outline-none"),submenu.addItem("Pencil Outline","menu.outline-pencil"),submenu.addItem("Pen Outline","menu.outline-pen"),submenu.addItem("Marker Outline","menu.outline-marker"),submenu.addSeparator(),submenu.addItem("No shadow","menu.shadow-none"),submenu.addItem("Shadow","menu.shadow"),submenu.addSeparator(),submenu.addItem("Draftsman","menu.sloppiness-draftsman"),submenu.addItem("Artist","menu.sloppiness-artist"),submenu.addItem("Cartoonist","menu.sloppiness-cartoonist"),submenu.addItem("Child","menu.sloppiness-child"),submenu.addItem("Dizzy","menu.sloppiness-dizzy"),menu.addSubmenu("Appearance",submenu),(submenu=new Menu).addItem("Arial","menu.font.Arial"),submenu.addItem("Times New Roman","menu.font.Times New Roman"),menu.addSubmenu("Font",submenu),(submenu=new Menu).addItem("Force redraw","menu.force-redraw"),submenu.addSeparator(),submenu.addItem("Rebuild document","menu.rebuild-doc"),submenu.addItem("Show/Hide Debug Panel","menu.toggle-debug"),submenu.addItem("dump","menu.dump"),menu.addSubmenu("Debug",submenu),this.menuBar=new Menubar(menu,this.eventSource),this.div.append(this.menuBar.div),this.menuBar.moveTo(0,0),this.eventSource.bind("menu.new",__bind(function(){return this.newDocument()},this)),this.eventSource.bind("menu.force-redraw",__bind(function(){return this.view.update(!0)},this)),this.eventSource.bind("menu.remove-cookie",__bind(function(){return Cookies.remove("cookieid")},this)),this.eventSource.bind("menu.rebuild-doc",__bind(function(){return this.view.doc.rebuild()},this)),this.eventSource.bind("menu.toggle-debug",__bind(function(){return this.showDebug=!this.showDebug,Url.setBooleanHashValue("debug",this.showDebug),this._onResize()},this))},Application.prototype.newRect=function(){var bl,br,commands,tl,tr;commands=new PathCommands;var offset=5*++this.objectCounter;return tl=this.view.snap(new Point(100+offset,100+offset)),tr=this.view.snap(new Point(200+offset,100+offset)),br=this.view.snap(new Point(200+offset,200+offset)),bl=this.view.snap(new Point(100+offset,200+offset)),commands.moveTo(tl.x,tl.y),commands.lineTo(tr.x,tr.y),commands.lineTo(br.x,br.y),commands.lineTo(bl.x,bl.y),commands.lineTo(tl.x,tl.y),commands.close(),this.view.pickTool(),this.view.commit([new CreateAction("PathNode",{commands:commands.toArray(),fillStyle:this.view.defaultFillStyle,strokeStyle:this.view.defaultStrokeStyle,seed:Math.round(65535*Math.random()),lineWidth:this.view.defaults.lineWidth,sloppiness:this.view.defaults.sloppiness})])},Application.prototype.newCircle=function(){var offset=5*++this.objectCounter;return this.view.pickTool(),this.view.commit([new CreateAction("PathNode",{commands:CreateCirclePath(this.view.snap(new Point(150+offset,150+offset)),50),fillStyle:this.view.defaultFillStyle,strokeStyle:this.view.defaultStrokeStyle,seed:Math.round(65535*Math.random()),lineWidth:this.view.defaults.lineWidth,sloppiness:this.view.defaults.sloppiness})])},Application.prototype.newText=function(){this.view.textTool()},Application.prototype.newImage=function(url){var id,pt,xform;return id=this.view.doc.peekNextId(),pt=this.view.snap(new Point(100,100)),xform=new TranslateMatrix(pt.x,pt.y),this.view.commit([new CreateAction("ImageNode",{url:url}),new TransformAction([id],xform,xform.inverse())])},Application.prototype.newMathML=function(){var id,xform;this.view.pickTool(),id=this.view.doc.peekNextId();var offset=5*++this.objectCounter;xform=new TranslateMatrix(100+offset,100+offset);var mn=new CreateAction("DomNode",{});console.log("Math node?",mn);var ret=this.view.commit([mn,new TransformAction([id],xform,xform.inverse())]);console.log("What is the return from the commit action?",ret),this.startMathEditor(id,mn.node)},Application.prototype.findBackgroundImage=function(){return this.backgroundImageId=null,this.view.doc.each(!1,__bind(function(node){if("ImageNode"===node.type()&&!0===node.getProperty("locked"))return this.log("Found background image at nodeid %s",node.id),this.backgroundImageId=node.id},this))},Application.prototype.setBackgroundImage=function(url){var actions=[new SetBackgroundAction(url)];return this.view.commit(actions),this.view.clearSelection(),this.view.doneSelecting()},Application.prototype.setBackgroundImageFromConfig=function(){this.config.getOption("backgroundImage")&&this.setBackgroundImage(this.config.getOption("backgroundImage"))},Application.prototype.newDocument=function(){return this.setDocument(new ZwibblerDocument)},Application.prototype._onResize=function(){var backgroundSelectorWidth,colourHeight,colourPanelTop,debugPanelWidth,height,imageSelectorHeight,imageSelectorWidth,menuHeight,propPanelWidth,sideWidth,width;width=this.div.width()-5,height=this.div.height()-5,width===this.oldWidth&&height===this.oldHeight||(this.oldWidth=width,this.oldHeight=height,this.toolbar.width(),4,menuHeight=this.menuBar.height(),this.config.hasMenu()?(this.menuBar.show(),this.menuBar.moveTo(0,0),this.menuBar.width(width)):(this.menuBar.hide(),menuHeight=0),this.config.getOption("showBackgroundSelector")?(backgroundSelectorWidth=100,this.backgroundSelector.show()):(backgroundSelectorWidth=0,this.backgroundSelector.hide()),this.config.getOption("showImageSelector")?(imageSelectorHeight=100,this.imageSelector.show()):(imageSelectorHeight=0,this.imageSelector.hide()),this.config.showColourPanel()?(this.colourPanel.show(),colourHeight=this.colourPanel.height()):(this.colourPanel.hide(),colourHeight=0),colourPanelTop=height-colourHeight,sideWidth=0,propPanelWidth=0,debugPanelWidth=0,this.showDebug&&(debugPanelWidth=this.debugPanel.width()),this.config.showPropertyPanel()&&(propPanelWidth=300),imageSelectorWidth=width-8-backgroundSelectorWidth-(sideWidth+=propPanelWidth+debugPanelWidth),height-8-colourHeight-menuHeight-imageSelectorHeight,this.backgroundSelector.width(backgroundSelectorWidth),this.backgroundSelector.height(height-8-menuHeight-colourHeight),this.backgroundSelector.moveTo(0,menuHeight),this.imageSelector.width(imageSelectorWidth),this.imageSelector.height(imageSelectorHeight),this.imageSelector.moveTo(backgroundSelectorWidth,height-8-colourHeight-imageSelectorHeight),this.colourPanel.moveTo(0,colourPanelTop),this.colourPanel.setWidth(width),this.colourPanel.draw(),this.showDebug?(this.debugPanel.show(),this.debugPanel.moveTo(width-debugPanelWidth,menuHeight),this.debugPanel.height(0|$(window).height())):this.debugPanel.hide(),this.view.draw())},Application.prototype.setupKeyboardSupport=function(){var self=this;this.toolbarInFocus=!1,this.keymap=new KeyboardMap,this.keymap.map("left","left"),this.keymap.map("right","right"),this.keymap.map("up","up"),this.keymap.map("down","down"),this.keymap.map("esc","select-none"),this.keymap.map("esc","cancel"),this.keymap.map("home","bring-to-front"),this.keymap.map("end","send-to-back"),this.keymap.map("pageup","move-up"),this.keymap.map("pagedown","move-down"),this.keymap.map("ctrl+d","duplicate"),this.keymap.map("delete,backspace","delete"),this.keymap.map("c,C","curve-tool"),this.keymap.map("l,L","line-tool"),this.keymap.map("ctrl+shift+g","ungroup"),this.keymap.map("ctrl+g","group"),this.keymap.map("ctrl+z","undo"),this.keymap.map("ctrl+shift+z","redo"),this.keymap.map("ctrl+x","cut"),this.keymap.map("ctrl+c","copy"),this.keymap.map("ctrl+v","paste"),this.keymap.map("left,up","previous"),this.keymap.map("down,right","next"),this.keymap.map("enter","enter"),this.keymap.on("*",function(action,e){self.isReadOnly()||"div"===(e.target||e.srcElement).tagName.toLowerCase()&&(self.toolbarInFocus?self.toolbar.onKeyCommand(action,e):self.view.onKeyCommand(action,e))}),this.div.attr("tabindex","-1"),this.div.on("focus",function(e){self.log("Got keyboard focus")}),this.div.on("blur",function(e){self.log("Lost keyboard focus")}),this.keymap.attachTo(this.div[0]),this.canvas.click(function(e){self.focus(!1)}),this.toolbar.div.click(function(e){self.focus(!0)}),this.colourPanel.on("colour",function(colour){self.focus(!1)}),this.eventSource.on("goto-toolbar",function(){self.focus(!0)}),this.eventSource.on("goto-canvas",function(){self.focus(!1)})},Application.prototype.focus=function(toolbar){var container=$(".theQuestions"),scrollTop=container.scrollTop();this.toolbarInFocus=toolbar,this.toolbarInFocus?(this.toolbar.focus(),this.view.hideKeyboardCursor()):this.toolbar.blur(),this.div.focus(),container.scrollTop(scrollTop)},Application.prototype.startMovingWithKeyboard=function(){this.focus(!1),this.view.showKeyboardCursorAndStartMoving()},Application.prototype.showKeyboardCursor=function(caret){this.focus(!1),this.view.showKeyboardCursor(caret)},Application.prototype.emit=function(name,data){return this.eventSource.emit(name,data)},Application.prototype.saveAsList=function(){return ZwibblerDocument.exportAsList(this.view.doc.root)},Application.prototype.saveAsDataUrl=function(){var canvas,ctx,rect;return rect=this.view.doc.getRect(),(canvas=$("<canvas>")).attr("width",""+rect.width),canvas.attr("height",""+rect.height),(ctx=canvas[0].getContext("2d")).translate(-rect.x,-rect.y),this.view.doc.draw(ctx),canvas[0].toDataURL()},Application.prototype.loadFromList=function(list){return ZwibblerDocument.importFromList(list,this.view.doc)},Application.prototype.setZwibblerContext=function(zwibblerContext){this.zwibblerContext=zwibblerContext,this.view.zwibblerContext=zwibblerContext,this.toolbar&&(this.toolbar.zwibblerContext=zwibblerContext)},Application.prototype.startMathEditor=function(id,mn){if(this.log("Starting equation editor"),void 0===mn){var node=this.view.doc.getNode(id);void 0===node?this.app.newMathML():this.startMathEditor(id,node)}else this.zwibblerContext.emit("math.edit",id,mn)},Application.prototype.setItemProperty=function(id,property,value){this.log("External app setItemProperty %s: %s=%s",id,property,value),this.view.commit([new SetAction([id],property,value)])},Application.prototype.getItemProperty=function(id,property){var node,value;return node=this.view.doc.getNode(id),value=0,node&&(value=node.getProperty(property)),this.log("GetItemProperty %s: %s=%s",id,property,value),value},Application.prototype.isReadOnly=function(){return this.zwibblerContext&&this.zwibblerContext.isReadOnly()},"jQuery"in window&&(window.jQuery.fn.zwibbler=function(options){options=options||{};var context=null;return this.each(function(i,elem){elem.zwibbler&&$(elem).empty();var app=new Application($(elem),options);elem.zwibbler=new ZwibblerContext(app),context=elem.zwibbler}),context},window.jQuery.fn.zwibblerContext=function(){return this[0].zwibbler});var Zwibbler={create:function(id,options){var div=document.getElementById(id);if(null===div)return console.error("Zwibbler.create: Cannot find an element with id "+id),null;var app=new Application($(div),window.Zwibbler.parseConfig(options));return new ZwibblerContext(app)},parseConfig:function(config){var object={};if("string"==typeof config)try{object=JSON.parse(config)}catch(e){config&&"scratchpad"in(object=JSON.parse(xml2jsonv2(parseXml(config),"")))&&(object=object.scratchpad)}else object=config;return object}};window.Zwibbler=Zwibbler,Zwibbler.create=Zwibbler.create,Zwibbler.parseConfig=Zwibbler.parseConfig;var ScratchPad={};window.ScratchPad=ScratchPad,ScratchPad.Factory={Instance:null,Sequence:{id:0},getInstance:function(){return ScratchPad.Factory.Instance||(ScratchPad.Factory.Instance=new ScratchPad.ZwibblerFactory),ScratchPad.Factory.Instance},setInstance:function(impl){ScratchPad.Factory.Instance=impl}};var ZwibblerFactory=function(){this.Store={},this.targetDom=document.body};ScratchPad.ZwibblerFactory=ZwibblerFactory,ZwibblerFactory.prototype.createScratchPad=function(id,configuration){id=id||"ScratchPad_"+ ++ScratchPad.Factory.Sequence.id;var zwibbler=Zwibbler.create(this.assureDomExists(id),configuration);return zwibbler&&zwibbler.setInstanceId(id),zwibbler},ZwibblerFactory.prototype.assureDomExists=function(id,pNode){if(id){pNode=pNode||this.targetDom||document.body;var dom=document.getElementById(id);return!dom&&pNode&&((dom=document.createElement("div")).id=id,pNode.appendChild(dom)),dom.className+=" sp_container",id}},ZwibblerFactory.prototype.getGlobalScratchPad=function(){return this.getScratchPadById("global_scratchpad")},ZwibblerFactory.prototype.getOrCreateScratchPadById=function(id,configuration){if(id){configuration=configuration||"";try{return this.Store[id]||(this.Store[id]=this.createScratchPad(id,configuration)),this.Store[id]}catch(e){console.error("Failed to create a new instance (id, e)",id,e)}return this.Store[id]}},ZwibblerFactory.prototype.getScratchPadById=function(id){try{if(!id)return;return this.Store[id]}catch(e){console.error("Failed to initialize or find a new Scratchpad (id, e)",id,e)}},ScratchPad.Factory=ScratchPad.Factory,ScratchPad.Factory.getInstance=ScratchPad.Factory.getInstance,ScratchPad.ZwibblerFactory=ScratchPad.ZwibblerFactory,ZwibblerFactory.prototype.getGlobalScratchPad=ZwibblerFactory.prototype.getGlobalScratchPad,ZwibblerFactory.prototype.getOrCreateScratchPadById=ZwibblerFactory.prototype.getOrCreateScratchPadById,ZwibblerFactory.prototype.getScratchPadById=ZwibblerFactory.prototype.getScratchPadById,ZwibblerContext.prototype.enableConsoleLogging=ZwibblerContext.prototype.enableConsoleLogging,ZwibblerContext.prototype.on=ZwibblerContext.prototype.on,ZwibblerContext.prototype.newDocument=ZwibblerContext.prototype.newDocument,ZwibblerContext.prototype.save=ZwibblerContext.prototype.save,ZwibblerContext.prototype.load=ZwibblerContext.prototype.load,ZwibblerContext.prototype.setBackgroundBrowserImages=ZwibblerContext.prototype.setBackgroundBrowserImages,ZwibblerContext.prototype.setIconBrowserImages=ZwibblerContext.prototype.setIconBrowserImages,ZwibblerContext.prototype.resize=ZwibblerContext.prototype.resize,ZwibblerContext.prototype.dirty=ZwibblerContext.prototype.dirty,ZwibblerContext.prototype.setItemProperty=ZwibblerContext.prototype.setItemProperty,ZwibblerContext.prototype.setImage=ZwibblerContext.prototype.setImage,ZwibblerContext.prototype.getItemProperty=ZwibblerContext.prototype.getItemProperty,ZwibblerContext.prototype.setDomElement=ZwibblerContext.prototype.setDomElement,ZwibblerContext.prototype.getInstanceId=ZwibblerContext.prototype.getInstanceId,Application.prototype.newMathML=Application.prototype.newMathML,Application.prototype.emit=Application.prototype.emit,window.Dialog=Dialog,Dialog.emit=Dialog.emit,Dialog.current=Dialog.current,DomNode.prototype.setElement=DomNode.prototype.setElement}();var SPEquations={_store:[],_storeHash:[],_activeWndId:"",_widgetList:[],cfg:{width:"500px",height:"331px",label:"Equation Editor"},init:function(wndId,equation){wndId="Eq_Equation_"+wndId;var wnd=this._store[this._storeHash.indexOf(wndId)];if(!wnd){this._createDOM(wndId);wnd=new YAHOO.widget.Dialog(wndId,{visible:!0,draggable:!1,modal:!0,close:!1,fixedcenter:!0,width:this.cfg.width,height:this.cfg.height,zIndex:1,postmethod:"none"});var buttons=[{text:Messages.get("Cancel"),handler:{fn:this.close,scope:this}},{text:Messages.get("Submit and Close"),handler:{fn:this.submit,scope:this},isDefault:!0}];wnd.cfg.queueProperty("buttons",buttons),wnd.setHeader(this.cfg.label),this._applyCSS(wnd),this._storeHash.push(wndId),this._store.push(wnd)}this._activeWndId=wndId;var widget=this._createEquation(wndId,equation);return this._widgetList.push(widget),this},_createDOM:function(wndId){var dom=document.getElementById(wndId);dom||((dom=document.createElement("form")).id=wndId,dom.className+="notes_dialog_form notes_dialog_form_equation",document.body.appendChild(dom));var cId="note_container_"+wndId,c=document.getElementById(cId);return c||((c=document.createElement("div")).className="notes_dialog_container",c.id=cId,dom.appendChild(c)),dom},_createEquation:function(wndId,equation){var widget=this._widgetList[this._storeHash.indexOf(wndId)];return widget||(widget=new MathJax.Editor.Widget({containerId:"note_container_"+wndId,RestrictKeysToContent:!0,tabs:!0,tabConfig:{Order:["Algebra","Basic"]}})),"object"==typeof equation.properties.data&&widget.updateEditors(equation.properties.data.mathML),widget},_applyCSS:function(wnd){YAHOO.util.Dom.addClass(wnd.element,"TDS_Notes_dialog"),YAHOO.util.Dom.addClass(wnd.innerElement,"comment"),YAHOO.util.Dom.addClass(wnd.header,"comment-header"),YAHOO.util.Dom.addClass(wnd.body,"comment-body"),YAHOO.util.Dom.addClass(wnd.form,"comment-form")},show:function(){var wnd=this._store[this._storeHash.indexOf(this._activeWndId)];wnd&&(wnd.render(document.body),wnd.show())},preSave:function(){return!0},submit:function(){var widget=this._widgetList[this._storeHash.indexOf(this._activeWndId)],wnd=this._store[this._storeHash.indexOf(this._activeWndId)],args={id:this._activeWndId,data:{type:"Equation",comment:widget.serializeSettings()}};this.preSave(args,wnd),this._remove()},preClose:function(){return!0},close:function(){this.preClose(),this._remove()},_remove:function(){var wnd=this._store[this._storeHash.indexOf(this._activeWndId)],wdget=this._widgetList[this._storeHash.indexOf(this._activeWndId)];wnd&&(wdget.clearAll(),wnd.hide())}};!function(CM,ScratchPad){function editListener(nodeId,node){console.log("what is this?",this,nodeId);var isNew="object"!=typeof node.properties.data,wnd=SPEquations.init(this.id,node);wnd.show(),wnd.preSave=function(args,eqWnd){console.log("$$$$equation item save",this);var data=args.data?args.data.comment:{};return data.isNew=isNew,this.setItemProperty(nodeId,"data",data),!1}.bind(this),wnd.preClose=function(){return console.log("$$$$equation item cancel",this),isNew&&this.app.view.eventSource.emit("menu.undo",{}),!1}.bind(this)}function parseImageFiles(questionXml){var getTextContent=function(node){return node&&node.childNodes&&node.childNodes.length?node.childNodes[0].nodeValue:null},imageFiles=[];return function(nodeList,func){for(var nodes=[],i=0;i<nodeList.length;i++)nodes.push(nodeList[i]||nodeList.item(i));YAHOO.util.Dom.batch(nodes,func)}(Util.Xml.parseFromString(questionXml).getElementsByTagName("backgroundImage"),function(imageNode){var imageFile=getTextContent(imageNode);-1==imageFiles.indexOf(imageFile)&&imageFiles.push(imageFile)}),imageFiles}function loadImageFiles(page,questionXml){for(var imageFiles=parseImageFiles(questionXml),i=0;i<imageFiles.length;i++){var imageUrl=resolveUrl(imageFiles[i]),img=new Image;page.getRenderer().addImage(img),img.src=imageUrl}}function resolveUrl(url){url=(url=url.replace(/&amp;/g,"&")).split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");var el=document.createElement("div");return el.innerHTML='<a href="'+url+'">x</a>',el.firstChild.href}function Widget_SP(page,item,content){this.scratchpad=null}ScratchPad&&(ScratchPad.Config=ScratchPad.Config||{},ScratchPad.Config.DefaultLabel=CM.getCommentLabel(),ScratchPad.Config.CommentCode="ScratchPad",CM.registerWidget("scratchpad",Widget_SP,function(page,item,config){var id="ScratchPad_"+item.position,el=document.getElementById(id);return!(!el||!item.rendererSpec)&&new CM.WidgetConfig(id,el,item.rendererSpec)}),Widget_SP.prototype.init=function(){loadImageFiles(this.page,this.entity.rendererSpec)},Widget_SP.prototype.load=function(){var item=this.entity,sp=ScratchPad.Factory.getInstance().createScratchPad(this.id,this.config);this.scratchpad=sp,setTimeout(function(){sp.app.resizeCanvas(),sp.app.view.draw(),item.value&&sp.setResponseXml(item.value)},100),sp.on("math.edit",editListener.bind(sp)),sp.isReadOnly=item.isReadOnly},Widget_SP.prototype.zoom=function(level){this.scratchpad.app.zoom(level)},Widget_SP.prototype.getResponse=function(){var value=this.scratchpad.getResponseXml(),isValid=this.scratchpad.isValid();return this.createResponse(value,isValid)},Widget_SP.prototype.setResponse=function(value){this.scratchpad.setResponseXml(value)})}(window.ContentManager,window.ScratchPad),"object"!=typeof AsiItem&&(AsiItem={}),"object"!=typeof AsiItem.Audio&&(AsiItem.Audio={}),function(SM,Audio){function parseSources(el){var sources=[];if("A"==el.nodeName)sources.push({url:decodeURIComponent(el.href),type:el.getAttribute("type")});else if("AUDIO"==el.nodeName)for(var i=0;i<el.children.length;++i){var source=el.children[i];sources.push({url:decodeURIComponent(source.src),type:source.type})}return sources}function getPlayableSource(el){for(var sources=parseSources(el),i=0;i<sources.length;i++){var source=sources[i],url=source.url?source.url:null;if(url&&SM.canPlayURL(url))return source}return null}SM.audioFormats.mp3.required=!1;var rebooted=!1;Audio.setup=function(flashPath){SM.setup({url:flashPath,flashVersion:9,preferFlash:!1,useHTML5Audio:!0}),SM.ontimeout(function(){console.warn("AudioManager Error: SM2 timeout"),rebooted||(rebooted=!0,setTimeout(function(){SM.reboot()},1e3))})},Audio.onReady=SM.onready,Audio.stopAll=SM.stopAll,Audio.getPlayableSource=getPlayableSource,Audio.createSound=function(id,url){var config={id:id,url:url};return new Audio.Sound(config)},Audio.createSoundFromElement=function(id,el,config){var source=getPlayableSource(el);return null==source?null:((config=config||{}).id=id,config=YAHOO.lang.augmentObject(config,source),new Audio.Sound(config))}}(soundManager,AsiItem.Audio),function(SM,Audio){var Sound=function(settings){this.onPlay=new YAHOO.util.CustomEvent("onPlay",this,!1,YAHOO.util.CustomEvent.FLAT),this.onStop=new YAHOO.util.CustomEvent("onStop",this,!1,YAHOO.util.CustomEvent.FLAT),this.onFinish=new YAHOO.util.CustomEvent("onFinish",this,!1,YAHOO.util.CustomEvent.FLAT),this.onIdle=new YAHOO.util.CustomEvent("onIdle",this,!1,YAHOO.util.CustomEvent.FLAT),this.onFailure=new YAHOO.util.CustomEvent("onFailure",this,!1,YAHOO.util.CustomEvent.FLAT),settings.onload=this._onLoad.bind(this),settings.onplay=this._onPlay.bind(this),settings.onstop=this._onStop.bind(this),settings.onfinish=this._onFinish.bind(this),settings.onfailure=this._onFailure.bind(this),this._service=SM.createSound(settings)};Sound.prototype.getId=function(){return this._service.id},Sound.prototype.isPlaying=function(){return 1===this._service.playState},Sound.prototype.play=function(){var result=this._service.play();return!(!result||2===result.readyState)},Sound.prototype.stop=function(){return this._service.stop()},Sound.prototype._onLoad=function(success){!1===success&&(console.log("AUDIO FAILED: "+this.getId()),YAHOO.lang.later(0,this.onFailure,this.onFailure.fire,this))},Sound.prototype._onPlay=function(){console.log("AUDIO PLAY: "+this.getId()),YAHOO.lang.later(0,this.onPlay,this.onPlay.fire,this)},Sound.prototype._onStop=function(){console.log("AUDIO STOP: "+this.getId()),YAHOO.lang.later(0,this.onStop,this.onStop.fire,this),YAHOO.lang.later(0,this.onIdle,this.onIdle.fire,this)},Sound.prototype._onFinish=function(){console.log("AUDIO FINISH: "+this.getId()),YAHOO.lang.later(0,this.onFinish,this.onFinish.fire,this),YAHOO.lang.later(0,this.onIdle,this.onIdle.fire,this)},Sound.prototype._onFailure=function(){console.log("AUDIO FAILURE: "+this.getId()),YAHOO.lang.later(0,this.onFailure,this.onFailure.fire,this)},Audio.Sound=Sound}(soundManager,AsiItem.Audio),function(YAHOO,Audio){var numInstances=0,Queue=function(){this._instance=++numInstances,this._isStarted=!1,this._sounds=[],this._current=null,this.onStart=new YAHOO.util.CustomEvent("onStart",this,!1,YAHOO.util.CustomEvent.FLAT),this.onStop=new YAHOO.util.CustomEvent("onStop",this,!1,YAHOO.util.CustomEvent.FLAT)};Queue.prototype.getSounds=function(){return this._sounds},Queue.prototype.add=function(sound){this._log("Add",sound),sound.onFailure.subscribe(this._onStop,this,!0),sound.onStop.subscribe(this._onStop,this,!0),sound.onIdle.subscribe(this._onFinish,this,!0),this._sounds.push(sound)},Queue.prototype.remove=function(sound){sound.onFailure.unsubscribe(this._onStop,this,!0),sound.onStop.unsubscribe(this._onStop,this,!0),sound.onIdle.unsubscribe(this._onFinish,this,!0),Util.Array.remove(this._sounds,sound)},Queue.prototype.clear=function(){for(var i=0;i<this._sounds.length;i++)this.remove(this._sounds[i])},Queue.prototype.dispose=function(){this._log("Dispose"),this.stop(),this.clear(),this.onStart.unsubscribeAll(),this.onStop.unsubscribeAll()},Queue.prototype.isStarted=function(){return this._isStarted},Queue.prototype.getCurrent=function(){return this._current},Queue.prototype.start=function(){if(this._isStarted)return!1;if(0==this._sounds.length)return!1;var played=this._play(this._sounds[0]);return played&&(this._log("Start"),this._isStarted=!0,this.onStart.fire(this)),played},Queue.prototype.stop=function(){this._current&&this._current.stop()},Queue.prototype._play=function(sound){return!!sound.play()&&(this._current=sound,!0)},Queue.prototype._onStop=function(sound){this._isStarted&&this._current==sound&&this._setStopped()},Queue.prototype._onFinish=function(sound){if(this._isStarted&&this._current==sound){var inactiveIdx=this._sounds.indexOf(sound);if(-1!=inactiveIdx){var nextSound=this._sounds[inactiveIdx+1];nextSound?this._play(nextSound)||this._setStopped():this._setStopped()}}},Queue.prototype._setStopped=function(){this._isStarted&&(this._log("Stop"),this._isStarted=!1,this._current=null,this.onStop.fire(this))},Queue.prototype._log=function(name,sound){var msg="AUDIO QUEUE "+this._instance+": "+name;sound&&(msg+=" - "+sound.getId()),console.log(msg)},Audio.createQueue=function(){return new Queue}}(YAHOO,AsiItem.Audio),AsiItem="undefined"==typeof AsiItem?{}:AsiItem,AsiItem.Parse=function(item){var YUD=YAHOO.util.Dom;this.mid=item.position,this.createAsiChoices=function(){var stem=item.getStemElement(),answers=YUD.get("ScaffoldingContainer_"+this.mid);this.identifier="ScaffoldingItemId_"+this.mid,this.stem=stem,this.asiContent=this.processNodes(this.mid,stem,answers),this.minSelection=1,this.maxAttempts=this.asiContent.choices.length-1}},AsiItem.Parse.prototype.processNodes=function(itemId,aStem,aAnswers){aStem.audioCue=this.processSoundLinks(this.stem);for(var choiceAr=[],choiceElems=aAnswers.childNodes,j=0;j<choiceElems.length;++j){var choiceNode=choiceElems[j];if(choiceNode.nodeType==Util.Dom.NodeType.ELEMENT){var id=YUD.getAttribute(choiceNode,"data-asi-identifier");if(id&&id.length>0){var audioCue=this.processSoundLinks(choiceNode);if(null!=audioCue){var choiceContent={id:"asi-"+itemId+"-response-"+id,identifier:id,complete:/true/i.test(choiceNode.getAttribute("data-asi-complete")),audioCue:audioCue,feedback:this.readFeedbackContent(choiceElems,j)};choiceAr.push(choiceContent)}}}}return{stem:this.stem,choices:choiceAr}},AsiItem.Parse.prototype.processSoundLinks=function(parentSpan){for(var anchors=parentSpan.getElementsByTagName("a"),i=0;i<anchors.length;++i){var anchor=anchors[i],source=AsiItem.Audio.getPlayableSource(anchor);if(null!=source)return anchor.parentNode.removeChild(anchor),source.url}return null},AsiItem.Parse.prototype.readChoiceContent=function(choiceNode,index){for(var htmlContent,htmlContentString="",choiceChildNodes=choiceNode.getElementById(""),k=0;k<choiceChildNodes.length;++k){var childNode=choiceChildNodes[k];choiceNode.nodeType==Util.Dom.NodeType.ELEMENT&&(htmlContentString+=Util.Xml.serializeToString(childNode))}return htmlContent=document.createElement("div"),AsiItem.Html.setSpanId(htmlContent,this.mid,index),htmlContent.innerHTML=htmlContentString,htmlContent},AsiItem.Parse.prototype.readFeedbackContent=function(nodes,index){for(var k=index;k<nodes.length;++k)if(nodes[k].nodeType==Util.Dom.NodeType.ELEMENT){var childNode=nodes[k],feedbackId=YUD.getAttribute(childNode,"data-feedback-identifier");if(feedbackId&&feedbackId.length>0)return{identifier:feedbackId,audioCue:this.processSoundLinks(childNode)}}return null},AsiItem="undefined"==typeof AsiItem?{}:AsiItem,AsiItem.AudioInterface=function(){this._tracksToPlay=[],this._lastPlayed=0,this._audioQ=AsiItem.Audio.createQueue();var self=this;this.disposed=!1,this.add=function(url,id,startFunction,stopFunction,instance){var obj={url:url,id:id,startFunction:startFunction,stopFunction:stopFunction,instance:instance};this._tracksToPlay.push(obj);var audioData=AsiItem.AudioInterface.audioData[id];null==audioData&&(audioData=AsiItem.Audio.createSound(id,url),AsiItem.AudioInterface.audioData[id]=audioData),audioData.onPlay.subscribe(function(){self.disposed||self.onStart()}),audioData.onIdle.subscribe(function(){self.disposed||self.onStop()}),this._audioQ.add(audioData)}},AsiItem.AudioInterface.prototype.dispose=function(){AsiItem.EventLog("AudioInterface - dispose"),this._audioQ.dispose(),this.disposed=!0},AsiItem.AudioInterface.prototype.start=function(){this._audioQ.start()},AsiItem.AudioInterface.prototype.stop=function(){this._audioQ.stop()},AsiItem.AudioInterface.prototype.onStop=function(){if(this._lastPlayed>0&&this._tracksToPlay.length>=this._lastPlayed){var current=this._tracksToPlay[this._lastPlayed-1],spid=current.id,instance=current.instance;current.stopFunction&&current.stopFunction(spid,instance)}},AsiItem.AudioInterface.prototype.onStart=function(){if(this._tracksToPlay.length>this._lastPlayed){var current=this._tracksToPlay[this._lastPlayed],spid=current.id,instance=current.instance;current.startFunction&&current.startFunction(spid,instance),this._lastPlayed++}},AsiItem.AudioInterface.audioData=[],AsiItem="undefined"==typeof AsiItem?{}:AsiItem,AsiItem.WAPIAudioInterface=function(context){this._tracksToPlay=[],this._currentTrack=0,this.disposed=!1,this._context=context,this._source=null,this._isPlaying=!1,this._timer=null},AsiItem.WAPIAudioInterface.prototype.add=function(url,id,startFunction,stopFunction,instance){var buffer=AsiItem.WAPIAudioInterface.audioDataHash[url];if("undefined"!==buffer){var track={url:url,id:id,startFunction:startFunction,stopFunction:stopFunction,instance:instance,audioData:buffer};this._tracksToPlay.push(track)}else AsiItem.EventLog("WAPIAudioInterface.add - Audio is not preloaded.")},AsiItem.WAPIAudioInterface.prototype.start=function(){this._isPlaying&&this.stop(),AsiItem.EventLog("WAPI Interface start - Intialize player for playing"),this._currentTrack=0,this._isPlaying=!0,this.playCurrentTrack()},AsiItem.WAPIAudioInterface.prototype.createSource=function(buffer){var source=this._context.createBufferSource();return source.buffer=buffer,source.connect(this._context.destination),source},AsiItem.WAPIAudioInterface.prototype.playCurrentTrack=function(){var audioData=AsiItem.WAPIAudioInterface.audioDataHash[this._tracksToPlay[this._currentTrack].url];if(audioData){var source=this.createSource(audioData),duration=audioData.duration;this._source=source,source.start?source.start(0):source.noteOn(0),this.onTrackStarted();var self=this,recurse=arguments.callee;this._timer=setTimeout(function(){self.onTrackEnded(),self._currentTrack+=1,self._currentTrack<self._tracksToPlay.length?recurse.call(self):self.stop()},1e3*(duration+1))}else for(AsiItem.EventLog("WAPIAudioInterface.playCurrentTrack - audioData no longer available.");this._currentTrack<this._tracksToPlay.length;){var current=this._tracksToPlay[this._currentTrack];current.startFunction(current.id,current.instance),current.stopFunction(current.id,current.instance),this._currentTrack+=1}},AsiItem.WAPIAudioInterface.prototype.stop=function(){if(clearTimeout(this._timer),this._source&&this._isPlaying&&(this._source.stop?this._source.stop(0):this._source.noteOff(0)),this._currentTrack<this._tracksToPlay.length){var track=this._tracksToPlay[this._currentTrack];track&&track.stopFunction&&track.stopFunction(track.id)}this._isPlaying=!1},AsiItem.WAPIAudioInterface.prototype.dispose=function(){this._tracksToPlay=[],this.disposed=!0,this._context=null,this._source=null,this._isPlaying=!1,this._timer=null,this.audioDataHash={}},AsiItem.WAPIAudioInterface.prototype.onTrackStarted=function(){if(this._currentTrack<this._tracksToPlay.length){var current=this._tracksToPlay[this._currentTrack];current.startFunction&&current.startFunction(current.id,current.instance)}},AsiItem.WAPIAudioInterface.prototype.onTrackEnded=function(){if(this._currentTrack<this._tracksToPlay.length&&this._isPlaying){var current=this._tracksToPlay[this._currentTrack];current.stopFunction&&current.stopFunction(current.id,current.instance)}},AsiItem.WAPIAudioInterface.audioDataHash={},AsiItem="undefined"==typeof AsiItem?{}:AsiItem,AsiItem.AudioPlayerFactory=function(){if(void 0===AsiItem.AudioPlayerFactory.Context)if(AsiItem.AudioPlayerFactory.Context=null,window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{var audioContext=new window.AudioContext;AsiItem.AudioPlayerFactory.Context=audioContext}catch(e){AsiItem.EventLog("Web Audio API not supported on this browser")}else AsiItem.EventLog("Web Audio API is not supported in this browser.");null!==AsiItem.AudioPlayerFactory.Context?(this.context=AsiItem.AudioPlayerFactory.Context,this.EnvSupportsWebAPI=!0):this.EnvSupportsWebAPI=!1},AsiItem.AudioPlayerFactory.prototype.createAudioInterface=function(){return this.EnvSupportsWebAPI?new AsiItem.WAPIAudioInterface(this.context):new AsiItem.AudioInterface},AsiItem.AudioPlayerFactory.prototype.onReady=function(playerContent,onReady){if(this.EnvSupportsWebAPI)try{new AsiItem.AudioPlayerFactory.BufferLoader(this.context,playerContent,function(){AsiItem.EventLog("onReady - ASI audio content loaded"),onReady()})}catch(e){AsiItem.EventLog("Failed to load audio tracks for Web Audio API... reverting to SM2 audio"),this.EnvSupportsWebAPI=!1,onReady()}else onReady()},AsiItem.AudioPlayerFactory.BufferLoader=function(context,playerContent,callback){this.context=context,this.onLoadComplete=callback,this.loadCount=0;for(var len=playerContent?playerContent.length:0,loadInitiated={},i=0;i<len;++i)void 0===loadInitiated[playerContent[i].url]?(loadInitiated[playerContent[i].url]=!0,this.loadBuffer(playerContent[i],playerContent.length)):this.loadCount+=1},AsiItem.AudioPlayerFactory.BufferLoader.prototype.loadBuffer=function(track,numTracks){var request=new XMLHttpRequest;request.open("GET",track.url,!0),request.responseType="arraybuffer";var self=this;request.onload=function(){self.context.decodeAudioData(request.response,function(decodedBuffer){decodedBuffer?(AsiItem.EventLog("BufferLoader.loadBuffer: Buffer decoded successfully ("+self.loadCount+")"),void 0!==AsiItem.WAPIAudioInterface.audioDataHash[track.url]&&AsiItem.EventLog("BufferLoader.loadBuffer: Track "+track.url+" already loaded"),AsiItem.WAPIAudioInterface.audioDataHash[track.url]=decodedBuffer,self.loadCount+=1,self.loadCount===numTracks&&self.onLoadComplete()):AsiItem.EventLog("BufferLoader.loadBuffer: Error decoding file data")},function(error){AsiItem.EventLog("BufferLoader.loadBuffer: decodeAudioData error")})},request.onerror=function(){AsiItem.EventLog("BufferLoader.loadBuffer: XHR error")},request.send()},AsiItem="undefined"==typeof AsiItem?{}:AsiItem,AsiItem.EventLog=function(str){AsiItem.EventLog.enabled&&ContentManager.log("ASI: "+str)},AsiItem.EventLog.enabled=!0,AsiItem.Html=function(parser,parentDiv){this._parentDiv=parentDiv,this._parser=parser,this._stemCell=parser.stem,this.setSpanId(this._stemCell,"asiStem")},AsiItem.Html.prototype.getStemCell=function(){return this._stemCell},AsiItem.Html.prototype.getParentDiv=function(){return this._parentDiv},AsiItem.Html.prototype.resetInteractions=function(responseSpanIds){for(var i=0;i<responseSpanIds.length;++i)YUD.addClass(responseSpanIds,"asi-response-hidden"),YUD.removeClass(responseSpanIds,"asi-response-shown"),YUD.removeClass(responseSpanIds,"asi-response-subdued")},AsiItem.Html.prototype.showFeedbackHideResponse=function(fSpan,rSpan){var region=YUD.getRegion(rSpan);YUD.removeClass(rSpan,"asi-response-shown"),YUD.removeClass(fSpan,"asi-response-hidden"),YUD.addClass(rSpan,"asi-response-hidden"),YUD.addClass(fSpan,"asi-feedback-shown"),YUD.setStyle(fSpan,"width",region.width.toString()+"px"),YUD.setStyle(fSpan,"height",region.height.toString()+"px")},AsiItem.Html.prototype.createAudioButton=function(){var audioWidget=document.createElement("button");return audioWidget.type="button",this.setPlayIcon(audioWidget),YUD.addClass(audioWidget,"asi-playback-span"),audioWidget},AsiItem.Html.prototype.allowInteractiveGui=function(){YUD.addClass(this._stemCell,"stemContainer contextAreaFocus asi-stem")},AsiItem.Html.prototype.setPlayIcon=function(widget){AsiItem.EventLog("setPlayIcon"),YUD.removeClass(widget,"asi-stop-button"),YUD.addClass(widget,"asi-playback-button"),YUD.removeClass(widget,"asi-response-subdued")},AsiItem.Html.prototype.subduePlayIcon=function(widget){AsiItem.EventLog("subduePlayIcon"),YUD.addClass(widget,"asi-response-subdued")},AsiItem.Html.prototype.setStopIcon=function(widget){AsiItem.EventLog("setStopIcon"),YUD.removeClass(widget,"asi-playback-button"),YUD.addClass(widget,"asi-stop-button"),YUD.removeClass(widget,"asi-response-subdued")},AsiItem.Html.prototype.enableResponses=function(responseArray){AsiItem.EventLog("enableResponses");for(var i=0;i<responseArray.length;++i){var span=YUD.get(responseArray[i]);AsiItem.EventLog("enableResponses span "+YUD.getAttribute(span,"id")),YUD.removeClass(span,"asi-response-subdued"),YUD.removeClass(span,"asi-response-emphasis"),YUD.addClass(span,"asi-response-enabled");var audioResponse=this.getAudioSpanFromResponseSpan(span);audioResponse&&(YUD.removeClass(audioResponse,"asi-response-subdued"),YUD.removeClass(audioResponse,"asi-stop-button"),YUD.addClass(audioResponse,"asi-playback-button"))}},AsiItem.Html.prototype.emphasizeResponse=function(span){YUD.addClass(span,"asi-response-emphasis"),YUD.addClass(span,"asi-response-shown"),YUD.removeClass(span,"asi-response-subdued"),YUD.removeClass(span,"asi-response-hidden")},AsiItem.Html.prototype.disableResponses=function(responseArray){AsiItem.EventLog("disableResponses");for(var i=0;i<responseArray.length;++i){var span=YUD.get(responseArray[i]);AsiItem.EventLog("disableResponses span "+YUD.getAttribute(span,"id")),YUD.removeClass(span,"asi-response-enabled"),YUD.removeClass(span,"asi-response-emphasis")}},AsiItem.Html.prototype.subdueSpan=function(span){YUD.addClass(span,"asi-response-subdued"),YUD.removeClass(span,"asi-response-emphasis")},AsiItem.Html.prototype.subdueResponses=function(responseArray){AsiItem.EventLog("subdueResponses");for(var i=0;i<responseArray.length;++i){var span=YUD.get(responseArray[i]);AsiItem.EventLog("subdue span "+YUD.getAttribute(span,"id")),this.subdueSpan(span)}},AsiItem.Html.prototype.createSpanId=function(purpose){return AsiItem.Html.createSpanId(this._parser.mid,purpose)},AsiItem.Html.prototype.setSpanId=function(stemDiv,purpose){AsiItem.Html.setSpanId(stemDiv,this._parser.mid,purpose)},AsiItem.Html.createSpanId=function(itemId,purpose){return"asi-"+itemId.toString()+"-"+purpose},AsiItem.Html.setSpanId=function(spanId,itemId,purpose){YUD.setAttribute(spanId,"id",AsiItem.Html.createSpanId(itemId,purpose))},AsiItem.Html.prototype.getResponseChoice=function(span){var id="",idSplit=(id="string"==typeof span?span:YUD.getAttribute(span,"id")).split("-");return idSplit.length>=4?idSplit[3]:""},AsiItem.Html.prototype.getRelatedFeedbackSpan=function(span){var fid=AsiItem.Html.createSpanId(this._parser.mid,"feedback-"+this.getResponseChoice(span));return YUD.get(fid)},AsiItem.Html.prototype.getResponseSpanFromIdentifier=function(identifier){for(var choiceContent=this._parser.asiContent.choices,i=0;i<choiceContent.length;i++)if(choiceContent[i].identifier==identifier){var spid=this.createSpanId("response-"+identifier);return YUD.get(spid)}return null},AsiItem.Html.prototype.getAudioSpanFromResponseSpan=function(responseSpan){var id=responseSpan;"object"==typeof responseSpan&&(id=responseSpan.id);var rindex=this.getResponseChoice(id),responseAudioSpanIndex=this.createSpanId("audioResponse-"+rindex);return YUD.get(responseAudioSpanIndex)},AsiItem.Interaction=function(asiHtmlObject,parser,voiceGuidance){this._html=asiHtmlObject,this._parser=parser,this._voiceGuidance=voiceGuidance,this._playSourceFromResponse=!1,this._player=null,this._responsePlayer=null,this._isPlaying=!1,this._isResponsePlaying=!1,this._isFeedbackPlaying=!1,this._attempts=[],this._terminateEvent=new YAHOO.util.CustomEvent("onTerminate",this),this._responseSpanIds=[],this.complete=!1,this.responsesLeft=parser.maxAttempts,this.isReadOnly=function(){return!1},this._html.setSpanId(this._stemCell,"asiStem"),this._playbackInfo={stemId:YUD.getAttribute(this._html.getStemCell(),"id"),stemAudio:parser.asiContent.stem.audioCue,playStemAudio:!0,responseAudio:[]},this._terminalSpanIds=[],this._spanToIdentifierMap=[],this.audioWidget=null,this._responseButtons=[],this.hasPlayedOnce=!1,this._feedbackCues={},this._responseIdentifiers=[],this._audioFactory=new AsiItem.AudioPlayerFactory},AsiItem.Interaction.prototype.hidePage=function(){this.complete||(this._isPlaying&&this._player&&(this._player.stop(),this._player.dispose(),this._player=null,this._isPlaying=!1),this._isResponsePlaying&&this._responsePlayer&&(this._responsePlayer.stop(),this._responsePlayer.dispose(),this._responsePlayer=null,this._isResponsePlaying=!1),this._voiceGuidance&&(this.hasPlayedOnce?this._html.enableResponses(this._responseSpanIds):this._html.resetInteractions(this._responseSpanIds),this._html.setPlayIcon(this.audioWidget)))},AsiItem.Interaction.prototype.startInteraction=function(valueToRestore){if(this._voiceGuidance){var playerContent=[],track={id:YUD.getAttribute(this._html.getStemCell(),"id"),url:this._parser.asiContent.stem.audioCue,audioData:null};playerContent.push(track);for(var choiceContent=this._parser.asiContent.choices,i=0;i<choiceContent.length;i++)track={id:this._html.createSpanId("response-"+String.fromCharCode(65+i)),url:choiceContent[i].audioCue,audioData:null},playerContent.push(track),choiceContent[i].feedback&&choiceContent[i].feedback.audioCue&&(track={id:this._html.createSpanId("feedback-"+i.toString()),url:choiceContent[i].feedback.audioCue,audioData:null},playerContent.push(track));var self=this;this._audioFactory.onReady(playerContent,function(){self.constructAudioTag(self._html.getStemCell()),self.populateResponses(self._parentDiv),self._html.allowInteractiveGui(),self._playSourceFromResponse=!1,valueToRestore&&self.setResponse(valueToRestore)})}else this.populateResponses(this._parentDiv),this._html.allowInteractiveGui(),valueToRestore&&this.setResponse(valueToRestore)},AsiItem.Interaction.prototype.playStory=function(){AsiItem.EventLog("AsiItem.Interaction.prototype.playStory"),this._html.setPlayIcon(this.audioWidget)},AsiItem.Interaction.prototype.getResponse=function(){return this._responseIdentifiers.join(" ")},AsiItem.Interaction.prototype.setResponse=function(value){var values=value.split(" ");this.hasPlayedOnce=!0,this.displayResponses(this._responseSpanIds),this._html.enableResponses(this._responseSpanIds);for(var i=0;i<values.length;++i){var span=this._html.getResponseSpanFromIdentifier(values[i]);if(span){this._responseIdentifiers.push(values[i]);var fSpan=this._html.getRelatedFeedbackSpan(span);fSpan&&(this.responsesLeft--,this._html.showFeedbackHideResponse(fSpan,span),(this._terminalSpanIds[YUD.getAttribute(span,"id")]||0==this.responsesLeft)&&(this.complete=!0,this.terminateInteraction()))}}},AsiItem.Interaction.prototype.onTerminate=function(callback){this._terminateEvent.subscribe(callback,this)},AsiItem.Interaction.prototype.terminateInteraction=function(){if(this._html.subdueResponses(this._responseSpanIds),this._html.disableResponses(this._responseSpanIds),this._html.subduePlayIcon(this.audioWidget),this._terminateEvent.fire(),this._player&&this._player._tracksToPlay)for(var tracks=this._player._tracksToPlay,i=0;i<tracks.length;i++){var track=tracks[i];AsiItem.WAPIAudioInterface.audioDataHash[track.url]&&delete AsiItem.WAPIAudioInterface.audioDataHash[track.url]}},AsiItem.Interaction.prototype.constructAudioTag=function(parentDiv){var audioWidgetSpan=document.createElement("span");this.audioWidget=this._html.createAudioButton(),audioWidgetSpan.appendChild(this.audioWidget),parentDiv.appendChild(audioWidgetSpan),YUE.addListener(audioWidgetSpan,"click",AsiItem.Interaction.handlePlayAudioButton,this)},AsiItem.Interaction.prototype.processResponse=function(span){if(!(this._isPlaying||this._isResponsePlaying||this._isFeedbackPlaying)){this.responsesLeft--;var spid=YUD.getAttribute(span,"id");this._responseIdentifiers.push(this._spanToIdentifierMap[spid]),this._terminalSpanIds[spid]?(this.complete=!0,this.terminateInteraction()):0==this.complete&&0==this.responsesLeft&&(this.complete=!0,this.terminateInteraction());var fspan=this._html.getRelatedFeedbackSpan(span);if(fspan&&1!=this.complete){var fid=YUD.getAttribute(fspan,"id");if(this._html.showFeedbackHideResponse(fspan,span),this._feedbackCues[fid]){this._isFeedbackPlaying=!0,this._html.subdueResponses(this._responseSpanIds),this._html.disableResponses(this._responseSpanIds),this._html.subduePlayIcon(this.audioWidget);var hap=this._audioFactory.createAudioInterface();hap.add(this._feedbackCues[fid],fid,function(){},AsiItem.Interaction.handleEndFeedbackAudio,this),hap.start()}else AsiItem.Interaction.handleEndFeedbackAudio(fid,this)}}},AsiItem.Interaction.prototype.processResponse_noVoiceGuidance=function(span){this.responsesLeft--;var spid=YUD.getAttribute(span,"id");this._responseIdentifiers.push(this._spanToIdentifierMap[spid]),this._terminalSpanIds[spid]?(this.complete=!0,this.terminateInteraction()):0==this.complete&&0==this.responsesLeft?(this.complete=!0,this.terminateInteraction()):(YUD.removeClass(span,"asi-response-shown"),YUD.removeClass(span,"asi-response-enabled"),YUD.addClass(span,"asi-response-hidden"))},AsiItem.Interaction.handleResponseCallback=function(ev,instance){if(!(instance.isReadOnly()||instance._isPlaying||instance._isFeedbackPlaying||instance._isResponsePlaying||instance.complete)){var span=this;instance._playSourceFromResponse=!0,instance.processResponse(span)}},AsiItem.Interaction.handleResponseCallback_noVoiceGuidance=function(ev,instance){if(!instance.isReadOnly()&&!instance.complete){var span=this;instance.processResponse_noVoiceGuidance(span)}},AsiItem.Interaction.handleEndFeedbackAudio=function(spid,instance){AsiItem.EventLog("handleEndFeedbackAudio"),instance._isFeedbackPlaying=!1,!instance.complete&&instance.responsesLeft>0?(instance.populateResponseAudio(instance._playbackInfo),instance._html.setStopIcon(instance.audioWidget),instance.playAudio(instance._playbackInfo)):0==instance.complete&&0==instance.responsesLeft&&(instance.complete=!0,instance.terminateInteraction())},AsiItem.Interaction.prototype.displayResponses=function(responseArray){AsiItem.EventLog("subdueResponses");for(var i=0;i<responseArray.length;++i){var span=YUD.get(responseArray[i]);AsiItem.EventLog("display span "+YUD.getAttribute(span,"id")),YUD.addClass(span,"asi-response-shown"),YUD.removeClass(span,"asi-response-hidden")}},AsiItem.Interaction.handlePlayAudioButton=function(ev,instance){instance.isReadOnly()||(AsiItem.EventLog("Main story button pressed"),instance._playSourceFromResponse=!1,instance.playAudio(instance._playbackInfo))},AsiItem.Interaction.handleResponseAudioButton=function(ev,instance){if(!instance.isReadOnly()){if(YUE.stopEvent(ev),instance._isResponsePlaying&&instance._responsePlayer)return AsiItem.EventLog("handleResponseAudioButton - playing, treat like stop"),void instance._responsePlayer.stop();if(!instance.complete){AsiItem.EventLog("handleResponseAudioButton");for(var playbackInfo={stemId:null,stemAudio:null,responseAudio:[]},responseChoice=instance._html.getResponseChoice(this),responseIndex=-1,choices=instance._parser.asiContent.choices,i=0;i<choices.length;++i)if(choices[i].identifier==responseChoice){responseIndex=i;break}if(responseIndex<0)AsiItem.EventLog("handleResponseAudioButton - Error: Could not find responseIndex for choice "+responseChoice);else{var audioObject={audioCue:instance._parser.asiContent.choices[responseIndex].audioCue,spanId:YUD.getAttribute(this,"id")};playbackInfo.responseAudio[responseIndex]=audioObject,instance._html.subdueResponses(instance._responseSpanIds),instance._html.subduePlayIcon(instance.audioWidget);var responseId=instance._html.createSpanId("response-"+responseChoice);YUD.addClass(responseId,"asi-response-emphasis"),YUD.removeClass(responseId,"asi-response-subdued"),instance.populateResponseAudio(playbackInfo,responseChoice),instance.playAudioResponse(playbackInfo)}}}},AsiItem.Interaction.prototype.playAudioResponse=function(audioArray){if(!0===this._isPlaying||this._isResponsePlaying||this._isFeedbackPlaying)AsiItem.EventLog("no audio response - playing already");else if(!0!==this.complete){this._responsePlayer=this._audioFactory.createAudioInterface();var self=this;AsiItem.EventLog("playAudioResponse - setting up audio");for(var i=0;i<audioArray.responseAudio.length;++i){var responseInfo=audioArray.responseAudio[i];if(responseInfo.audioCue){var responseSpan=YUD.get(responseInfo.spanId);responseSpan&&"none"!=YUD.getStyle(responseSpan,"display")&&this._responsePlayer.add(responseInfo.audioCue,responseInfo.spanId,function(){AsiItem.EventLog("playAudioResponse - startPlaying"),self._isResponsePlaying=!0,self._html.setStopIcon(responseSpan)},function(){AsiItem.EventLog("playAudioResponse - stopPlaying"),self._isResponsePlaying=!1,self._html.setPlayIcon(responseSpan),self._html.enableResponses(self._responseSpanIds),self._html.setPlayIcon(self.audioWidget)})}}this._responsePlayer.start()}else AsiItem.EventLog("complete")},AsiItem.Interaction.prototype.playAudio=function(audioArray){var self=this;if(this._isResponsePlaying||this._isFeedbackPlaying)AsiItem.EventLog("playAudio - already playing response");else{if(0==this.hasPlayedOnce&&!0===this._isPlaying&&AsiItem.EventLog("playAudio - already playing first time, replay entire story "),!0===this._isPlaying&&this._player)return AsiItem.EventLog("playAudio - already playing, treat like stop"),this._player.stop(),this._player.dispose(),this._player=null,this._isPlaying=!1,this._html.setPlayIcon(this.audioWidget),this._html.enableResponses(this._responseSpanIds),void(0==this.hasPlayedOnce&&setTimeout(function(){self.populateResponseAudio(audioArray),self.playAudio(audioArray)},1));if(this._player&&(this._player.stop(),this._player.dispose(),this._player=null),!0!==this.complete){this._player=this._audioFactory.createAudioInterface(),this._html.subdueResponses(this._responseSpanIds);var startAudioCallback=function(id){var span=YUD.get(id);if(/asiStem/.test(id))AsiItem.EventLog("playAudio - starting stem");else if(AsiItem.EventLog("playAudio - starting a response "+id),span){self._html.emphasizeResponse(span);var responseAudioSpan=self._html.getAudioSpanFromResponseSpan(span);responseAudioSpan&&self._html.subduePlayIcon(responseAudioSpan)}},stopAudioCallback=function(id){if(0==self._isPlaying)return AsiItem.EventLog("playAudio - stopAudioCallback late stop event, enabling"),void self._html.enableResponses(self._responseSpanIds);if(AsiItem.EventLog("playAudio - stopAudioCallback"),/asiStem/.test(id))return 0==audioArray.responseAudio.length&&(AsiItem.EventLog("playAudio - finished playing stem and no responses"),self._isPlaying=!1,self._html.enableResponses(self._responseSpanIds),self._html.setPlayIcon(self.audioWidget)),void AsiItem.EventLog("playAudio - finished playing stem");var span=YUD.get(id);span&&(AsiItem.EventLog("playAudio - finished playing response "+id+", remove emphasis"),YUD.removeClass(span,"asi-response-emphasis")),audioArray.lastChoiceToPlay==self._html.getResponseChoice(id)?(AsiItem.EventLog("playAudio - playing last response "+id+", enabling"),self._isPlaying=!1,self._html.enableResponses(self._responseSpanIds),self._html.setPlayIcon(self.audioWidget),self.hasPlayedOnce=!0):(AsiItem.EventLog("playAudio - finished playing response "+id+", subdue"),YUD.addClass(span,"asi-response-subdued"))};AsiItem.EventLog("playAudio - populating player"),(audioArray.playStemAudio||0==self._playSourceFromResponse)&&this._player.add(audioArray.stemAudio,audioArray.stemId,startAudioCallback,stopAudioCallback);for(var i=0;i<audioArray.responseAudio.length;++i){var responseInfo=audioArray.responseAudio[i];if(responseInfo.audioCue){var responseSpan=YUD.get(responseInfo.spanId);!responseSpan||0!=this.hasPlayedOnce&&"none"==YUD.getStyle(responseSpan,"display")||this._player.add(responseInfo.audioCue,responseInfo.spanId,startAudioCallback,stopAudioCallback)}}this._isPlaying=!0,0==this.hasPlayedOnce?(this._html.setStopIcon(this.audioWidget),this._html.subduePlayIcon(this.audioWidget)):this._html.setStopIcon(this.audioWidget),this._player.start()}else AsiItem.EventLog("playAudio - complete")}},AsiItem.Interaction.prototype.hasResponseBeenChosen=function(spid){for(var i=0;i<this._responseIdentifiers.length;++i){var responseSpan=this._html.getResponseSpanFromIdentifier(this._responseIdentifiers[i]);if(null!=responseSpan&&responseSpan.id==spid)return!0}return!1},AsiItem.Interaction.prototype.populateResponseAudio=function(audioObject,responseId){var ar=[];audioObject.lastChoiceToPlay="A";for(var i=0;i<this._responseSpanIds.length;++i){var spid=this._responseSpanIds[i],choice=this._html.getResponseChoice(spid);null!=responseId&&responseId!=choice||this.hasResponseBeenChosen(spid)||audioObject.responseAudio[i]&&(ar.push(audioObject.responseAudio[i]),choice>audioObject.lastChoiceToPlay&&(audioObject.lastChoiceToPlay=choice))}audioObject.responseAudio=ar},AsiItem.Interaction.prototype.populateResponses=function(parentDiv){var choices=this._parser.asiContent.choices;this._playbackInfo.lastChoiceToPlay="A";for(var i=0;i<choices.length;i++){var choice=choices[i],responseSpan=document.getElementById(choice.id);this._voiceGuidance||(YUD.addClass(responseSpan,"asi-response-shown"),YUD.removeClass(responseSpan,"asi-response-hidden")),this._spanToIdentifierMap[choice.id]=choice.identifier,this._responseSpanIds.push(choice.id);var audioTag=choice.audioCue;if(audioTag){var audioObject={audioCue:audioTag,spanId:choice.id};this._playbackInfo.responseAudio.push(audioObject),choice.identifier>this._playbackInfo.lastChoiceToPlay&&(this._playbackInfo.lastChoiceToPlay=choice.identifier)}if(choice.complete&&(this._terminalSpanIds[choice.id]=!0),this._voiceGuidance&&YUD.addClass(responseSpan,"asi-response-hidden"),this._voiceGuidance){var responseAudioButton=this._html.createAudioButton();this._html.setPlayIcon(responseAudioButton),this._html.setSpanId(responseAudioButton,"audioResponse-"+choice.identifier),YUE.addListener(responseAudioButton,"click",AsiItem.Interaction.handleResponseAudioButton,this),responseSpan.appendChild(responseAudioButton),this._responseButtons.push(responseAudioButton)}var feedbackContent=choice.feedback,feedbackSpan=document.getElementById(this._html.createSpanId("feedback-"+choice.identifier));if(YUD.addClass(feedbackSpan,"asi-feedback-hidden"),feedbackContent.audioCue){var spanId=this._html.createSpanId("feedback-"+choice.identifier);this._feedbackCues[spanId]=feedbackContent.audioCue,this._playbackInfo.playStemAudio=!1}this._voiceGuidance?YUE.addListener(responseSpan,"click",AsiItem.Interaction.handleResponseCallback,this):YUE.addListener(responseSpan,"click",AsiItem.Interaction.handleResponseCallback_noVoiceGuidance,this)}},function(CM){function Widget_ASI(){this.scaffolding=null}CM.registerWidget("scaffolding",Widget_ASI,function(page,item,content){var id="ScaffoldingContainer_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el)}),Widget_ASI.prototype.init=function(){var page=this.page,item=this.entity,containerEl=this.element,hasASIVoiceGuidance=page.getAccommodationProperties().hasASIVoiceGuidance(),stem=item.getStemElement();if(stem){var exitAudioCue=this._processExitAudioLink(stem,hasASIVoiceGuidance),exitAudioPlayer=new AsiItem.AudioInterface;if(exitAudioCue){var exitAudioPlayerId="asi-"+item.position+"exitAudio";exitAudioPlayer.add(exitAudioCue,exitAudioPlayerId)}}CM.log("ASI: Processing item. ");var asi=new AsiItem.Parse(item);asi.createAsiChoices();var html=new AsiItem.Html(asi,containerEl);this.scaffolding=new AsiItem.Interaction(html,asi,hasASIVoiceGuidance),this.scaffolding.isReadOnly=item.isReadOnly,this.scaffolding.onTerminate(function(type,args,instance){for(var itemContainer=containerEl;itemContainer&&!$(itemContainer).hasClass("itemContainer");)itemContainer=itemContainer.parentNode;if(itemContainer){var completeDiv=document.createElement("div");YUD.addClass(completeDiv,"asi-complete-span"),itemContainer.appendChild(completeDiv);var nextFunction=ContentManager.setItemCompleted;nextFunction&&item&&YUE.addListener(completeDiv,"click",function(){nextFunction(item)})}exitAudioPlayer.start()}),this.scaffolding.startInteraction(item.value)},Widget_ASI.prototype.show=function(){this.scaffolding&&AsiItem.Audio.onReady(function(){this.scaffolding.playStory()}.bind(this))},Widget_ASI.prototype.hide=function(){this.scaffolding&&this.scaffolding.hidePage()},Widget_ASI.prototype._processExitAudioLink=function(parentSpan,hasVoiceGuide){for(var anchors=parentSpan.getElementsByTagName("a"),i=0;i<anchors.length;i++){var anchor=anchors[i],source=AsiItem.Audio.getPlayableSource(anchor);if("true"==YUD.getAttribute(anchor,"data-its-exitaudio")&&null!=source)return anchor.parentNode.removeChild(anchor),hasVoiceGuide?source.url:null}return null},Widget_ASI.prototype.getResponse=function(){var value="",empty=!0,valid=!1;return this.scaffolding&&(valid=!(empty=!(value=this.scaffolding.getResponse())||0==value.length)&&this.scaffolding.complete),this.createResponse(value,valid,empty)},Widget_ASI.prototype.setResponse=function(value){this.scaffolding&&this.scaffolding.setResponse(value)}}(window.ContentManager),TDS=window.TDS||{},function(TDS){var TI=function(el,useTextArea){this._tableEl=el,this._useTextArea=useTextArea||!1,this._columnIds=[],this._inputValidators=[]};TI.CSS_INPUT="ti-input",TI.CSS_EDITABLE="ti-editable",TI.CSS_ACTIVE="ti-active",TI.CSS_INVALID="ti-invalid";var globalValidator;TI.setValidator=function(fn){globalValidator=fn},TI.prototype.getColumnIds=function(){return this._columnIds},TI.prototype.getElement=function(){return this._tableEl},TI.prototype.getInputs=function(){var tableEl=this.getElement();return $("."+TI.CSS_INPUT,tableEl)},TI.prototype.validateInputs=function(){this._inputValidators.forEach(function(inputValidator){inputValidator()})},TI.prototype._processTag=function(idx,tagEl){var $tag=$(tagEl),validationRule=$tag.data("itsValidationrule"),includedInResponse=!0===$tag.data("itsIncludedinresponse"),tagName=this._useTextArea?"textarea":"input",$input=$(document.createElement(tagName));$input.attr("type","text").attr("autocomplete","off").attr("autocorrect","off").attr("autocapitalize","off").attr("spellcheck","false"),$input.addClass(TI.CSS_INPUT),"center"==$tag.parent().css("text-align")&&$input.css("text-align","center");var tableEl=this.getElement(),$cell=$tag.closest("td, th",tableEl);if($cell.addClass(TI.CSS_EDITABLE),$input.focus(function(){$cell.addClass(TI.CSS_ACTIVE)}).blur(function(){$cell.removeClass(TI.CSS_ACTIVE)}),includedInResponse){var tagText=$tag.text().trim();tagText&&$input.val(tagText)}if($input.data("originalResponse",$input.val()),"function"==typeof globalValidator){var inputValidator=globalValidator.bind(this,$input,$cell,validationRule);$input.on("input",inputValidator),this._inputValidators.push(inputValidator)}$tag.replaceWith($input)},TI.prototype.render=function(){var tableEl=this.getElement();$("thead th",tableEl).each(function(idx,thEl){var $cell=$(thEl);if("TH"==$cell.prop("tagName")){var id=$cell.data("itsIdentifier");this._columnIds.push(id)}}.bind(this)),$('span[data-its-input="true"]',tableEl).each(this._processTag.bind(this))},TDS.TableInput=TI}(TDS),function(TI){function showAlert(msg){TDS.Dialog?TDS.Dialog.showWarning(msg):alert(msg)}var Rules={alphaOnly:/^[a-zA-Z]+$/i,numericOnly:/^(\+|-)?(\d+)?([.]?\d*)?$/,alphaNumericOnly:/[a-zA-Z0-9]/i,textOnly:null};TI.setValidator(function($input,$cell,rule,evt){var textValid=!0,re=Rules[rule];if(re){var text=$input.val().trim();text&&(textValid=re.test(text))}var styleInvalid=$cell.hasClass(TI.CSS_INVALID);textValid&&styleInvalid?$cell.removeClass(TI.CSS_INVALID):textValid||styleInvalid||($cell.addClass(TI.CSS_INVALID),evt&&setTimeout(function(){showAlert("TI.InvalidInput."+rule)},0))})}(TDS.TableInput),function(TI){TI.prototype.getResponseXml=function(){var xmlDoc=Util.Xml.createDocument("responseSpec"),rootEl=xmlDoc.documentElement,tableNode=xmlDoc.createElement("responseTable"),tableEl=this.getElement();return $("tr",tableEl).each(function(rowIdx,rowEl){var rowNode=xmlDoc.createElement("tr");$("th, td",rowEl).each(function(colIdx,colEl){var colName=colEl.nodeName.toLowerCase(),colNode=xmlDoc.createElement(colName),id=$(colEl).data("itsIdentifier");id&&$(colNode).attr("id",id);var response=$("."+TI.CSS_INPUT,colEl).first().val();response&&$(colNode).text(response),rowNode.appendChild(colNode)}),tableNode.appendChild(rowNode)}),rootEl.appendChild(tableNode),xmlDoc},TI.prototype.getResponse=function(){var xmlDoc=this.getResponseXml();return Util.Xml.serializeToString(xmlDoc)},TI.prototype.setResponseXml=function(xmlDoc){for(var tableEl=this.getElement(),$htmlRows=$("tr",tableEl),$xmlRows=$("tr",xmlDoc),i=0,ii=$htmlRows.length;i<ii;i++)for(var $htmlCols=$("th, td",$htmlRows[i]),$xmlCols=$("th, td",$xmlRows[i]),j=0,jj=$htmlCols.length;j<jj;j++){var $htmlCol=$($htmlCols[j]),$xmlCol=$($xmlCols[j]),$input=$("."+TI.CSS_INPUT,$htmlCol).first();if($input){var response=$xmlCol.text();$input.val(response||"")}}},TI.prototype.setResponse=function(xmlStr){var xmlDoc=Util.Xml.parseFromString(xmlStr);this.setResponseXml(xmlDoc)},TI.prototype.isResponseValid=function(){var $inputs=this.getInputs();if(0==$inputs.length)return!1;var valid=!1;return $inputs.each(function(idx,inputEl){if($(inputEl).data("originalResponse")!==$(inputEl).val())return valid=!0,!1}),valid}}(TDS.TableInput),function(CM){function Widget_TI(page,item,config){this._tableInput=null}CM.registerWidget("tableinput",Widget_TI,function(page,item,content){if(!item.isResponseType("TableInput")&&!item.isResponseType("TableInputExt"))return!1;var $tables=$("table.tableItem",item.getElement());if(0==$tables.length)throw new Error('Could not find table matching class "tableItem" for TableInput item');var tableEl=$tables.get(0),id="TableContainer_"+item.position,containerEl=document.getElementById(id);return new CM.WidgetConfig(id,tableEl,containerEl)}),Widget_TI.prototype.load=function(){var item=this.entity,tableEl=this.element,containerEl=this.config;containerEl&&containerEl.appendChild(tableEl);var useTextArea=item.isResponseType("TableInputExt"),ti=new TDS.TableInput(tableEl,useTextArea);this._tableInput=ti,ti.render(),item.value&&(ti.setResponse(item.value),ti.validateInputs());for(var inputEls=ti.getInputs(),i=0;i<inputEls.length;++i)item.addComponent(inputEls[i]);var readOnlyFunc=function(evt){item.isReadOnly()&&YUE.stopEvent(evt)};YUE.on(tableEl,"keypress",readOnlyFunc),YUE.on(tableEl,"mousedown",readOnlyFunc)},Widget_TI.prototype.getResponse=function(){var ti=this._tableInput,value=ti.getResponse(),isValid=ti.isResponseValid();return this.createResponse(value,isValid)},Widget_TI.prototype.setResponse=function(value){this._tableInput.setResponse(value)}}(window.ContentManager),TDS.Moogle=void 0===TDS.Moogle?{}:TDS.Moogle,TDS.Moogle=function(identifier){},TDS.Moogle.prototype.load=function(parent,spec){parent=YUD.get(parent);var searchResultsTitle=Messages.get("TDSMoogle.searchResults"),searchResultsDiv=document.createElement("div"),searchResultsHeaderH3=document.createElement("h3");YUD.addClass(searchResultsHeaderH3,"moogle-Header");var searchResultsText=document.createTextNode(searchResultsTitle);YUD.addClass(searchResultsText,"moogle-title"),searchResultsHeaderH3.appendChild(searchResultsText),searchResultsDiv.appendChild(searchResultsHeaderH3),YUD.setAttribute(searchResultsDiv,"id","moogleSearchResults");var articleDiv=[],resultElements=YUD.getChildren(spec);if(resultElements.length>0)for(var titleLink=[],i=0;i<resultElements.length;i++){var result=resultElements[i],resultDiv=document.createElement("div");YUD.setAttribute(resultDiv,"id","moogleSearchResult_"+i),YUD.addClass(resultDiv,"moogleSearchResultContainer"),titleLink[i]=document.createElement("a"),YUD.setAttribute(titleLink[i],"id","moogleSearchResultTitle_"+i),YUD.addClass(titleLink[i],"moogle-resultTitle"),titleLink[i].innerHTML=result.children[1].textContent,resultDiv.appendChild(titleLink[i]);var thumbnailSnippetDiv=document.createElement("div");YUD.setAttribute(thumbnailSnippetDiv,"id","moogleSearchResultThumbnailSnippet_"+i);var thumbnailSpan=document.createElement("span");YUD.setAttribute(thumbnailSpan,"id","moogleSearchResultThumbnail_"+i),YUD.setAttribute(thumbnailSpan,"moogle-thumbnailLeft"),thumbnailSpan.innerHTML=result.children[0].textContent,thumbnailSnippetDiv.appendChild(thumbnailSpan);var snippetSpan=document.createElement("span");YUD.setAttribute(snippetSpan,"moogle-snippetRight"),YUD.setAttribute(snippetSpan,"id","moogleSearchResultSnippet_"+i),snippetSpan.innerHTML=result.children[2].textContent,thumbnailSnippetDiv.appendChild(snippetSpan),resultDiv.appendChild(thumbnailSnippetDiv),searchResultsDiv.appendChild(resultDiv),YUD.addClass(searchResultsDiv,"moogle-show"),articleDiv[i]=document.createElement("div"),YUD.setAttribute(articleDiv[i],"id","moogleSearchResultArticle_"+i),articleDiv[i].innerHTML=result.children[3].textContent,YUD.addClass(articleDiv[i],"moogle-hide")}var backToIndexLink=document.createElement("a"),backToIndexText=document.createTextNode("Back to Index");backToIndexLink.appendChild(backToIndexText),YUD.addClass(backToIndexLink,"moogle-btiLink"),YUD.addClass(backToIndexLink,"moogle-hide");var paddingEl=Util.Dom.getElementByClassName("padding","div",parent);if(paddingEl){paddingEl.appendChild(searchResultsDiv),paddingEl.appendChild(backToIndexLink);for(var m=0;m<articleDiv.length;m++)paddingEl.appendChild(articleDiv[m])}YAHOO.util.Event.onDOMReady(function(){for(var j=0;j<resultElements.length;j++)YUE.addListener(titleLink[j],"click",function(k){return function(){YUD.removeClass(searchResultsDiv,"moogle-show"),YUD.addClass(searchResultsDiv,"moogle-hide"),YUD.removeClass(backToIndexLink,"moogle-hide"),YUD.addClass(backToIndexLink,"moogle-show"),YUD.removeClass(articleDiv[k],"moogle-hide"),YUD.addClass(articleDiv[k],"moogle-show"),YUE.addListener(backToIndexLink,"click",function(){YUD.removeClass(backToIndexLink,"moogle-show"),YUD.addClass(backToIndexLink,"moogle-hide"),YUD.removeClass(articleDiv[k],"moogle-show"),YUD.addClass(articleDiv[k],"moogle-hide"),YUD.removeClass(searchResultsDiv,"moogle-hide"),YUD.addClass(searchResultsDiv,"moogle-show")})}}(j))})},function(CM){function Plugin_Moogle(page,entity,config){}window.ContentManager.registerEntityPlugin("moogle",Plugin_Moogle,function(page,entity){if(entity.specs&&entity.specs.length>0){var results=Util.Array.find(entity.specs,function(spec){return"search"==spec.nodeName});if(results)return results}return!1}),Plugin_Moogle.prototype.load=function(){var passage=this.entity,results=this.config,moogle=new TDS.Moogle("moogle"+passage.getID()),passageContainer=passage.getElement();moogle.load(passageContainer,results)}}(),function(){function MC(item){this._item=item,this._options=[],this._optionHash={},this._role="radiogroup",this.autoRespond=!1}MC.prototype.getItem=function(){return this._item},MC.prototype.addOption=function(option){this._options.push(option),this._optionHash[option.key]=option},MC.prototype.getOptions=function(){return this._options},MC.prototype.getOption=function(optionKey){var option=null;return"string"==typeof optionKey?(optionKey=optionKey.toUpperCase(),option=this._optionHash[optionKey]||null):"number"==typeof optionKey&&(option=this._options[optionKey-1]||null),option},MC.prototype.getSelected=function(){for(var i=0;i<this._options.length;i++)if(this._options[i].isSelected())return this._options[i];return null},MC.prototype.clear=function(){var selected=this.getSelected();null!=selected&&selected.deselect()},MC.prototype.getValue=function(){var option=this.getSelected();return option?option.key:null},MC.prototype.setValue=function(optionKey){var option=this.getOption(optionKey);if(!option){var selected=this.getSelected();return selected&&selected.deselect(),!1}return option.select(),!0},MC.prototype.getFocusedOption=function(){for(var focusedComponent=this.getItem().getActiveComponent(),i=0;i<this._options.length;i++){var option=this._options[i];if(option.getElement()==focusedComponent)return option}return null},MC.prototype.navigate=function(dir){var focusedOption=this.getFocusedOption();if(!focusedOption)return null;var iter=new Util.Iterator(this.getOptions());iter.jumpTo(focusedOption);var option;return(option="prev"==dir?iter.prev():iter.next())&&this.getItem().setActiveComponent(option.getElement()),option},MC.prototype.render=function(el){el&&(el.setAttribute("role",this._role),el.setAttribute("aria-required","true")),this.getOptions().forEach(function(option){option.render()})},window.ContentMCGroup=MC}(),function(CM){function MCOption(options,key){Util.Event.Emitter(this),this._options=options,this._role="radio",this.key=key,this.audioLink=null,this.tts=null,this.feedback=null}MCOption.prototype.getElement=function(){var item=this._options.getItem();return document.getElementById("Item_OptionContainer_Response_MC_"+item.position+"_"+this.key)},MCOption.prototype.getInputElement=function(){var inputName="Item_Response_MC_"+this._options.getItem().position+"_"+this.key;return document.getElementById(inputName)},MCOption.prototype.getSoundLink=function(){var item=this._options.getItem(),soundEl=document.getElementById("Item_OptionSound_Response_MC_"+item.position+"_"+this.key);return soundEl?soundEl.getElementsByTagName("a")[0]:null},MCOption.prototype.getContentElement=function(){var optionElement=this.getElement();return Util.Dom.getElementByClassName("optionContent","div",optionElement)},MCOption.prototype.getFeedbackElement=function(){var optionElement=this.getElement();return Util.Dom.getElementByClassName("optionFeedback","div",optionElement)},MCOption.prototype.showFeedback=function(){var feedbackElement=this.getFeedbackElement();null!=feedbackElement&&YUD.addClass(feedbackElement,"showing")},MCOption.prototype.hideFeedback=function(){var feedbackElement=this.getFeedbackElement();null!=feedbackElement&&YUD.removeClass(feedbackElement,"showing")},MCOption.prototype.createFeedback=function(){var accProps=this._options.getItem().getPage().getAccProps();if(accProps&&accProps.showFeedback()){var feedbackEl=document.createElement("div");YUD.addClass(feedbackEl,"optionFeedback"),feedbackEl.innerHTML=this.feedback,this.getElement().appendChild(feedbackEl),this.isSelected()?this.showFeedback():this.hideFeedback()}},MCOption.prototype.select=function(force){var group=this._options,item=group.getItem(),page=item.getPage(),currentSelection=group.getSelected();if(currentSelection==this&&!0!==force)return!1;if(!1===this.fire("beforeSelect"))return!1;if(force){var options=group.getOptions();Util.Array.each(options,function(option){option.deselect()})}else currentSelection&&currentSelection.deselect();var inputEl=this.getInputElement();inputEl.checked||(inputEl.checked=!0);var optionEl=this.getElement();YUD.addClass(optionEl,"optionSelected"),optionEl.setAttribute("aria-checked","true");var accProps=page.getAccProps();return accProps&&accProps.showFeedback()&&this.showFeedback(),this.fire("select"),group.autoRespond&&"function"==typeof window.tdsUpdateItemResponse&&window.tdsUpdateItemResponse(item.position,this.key),!0},MCOption.prototype.deselect=function(){this._options;var optionEl=this.getElement(),inputEl=this.getInputElement();YUD.removeClass(optionEl,"optionSelected"),optionEl.setAttribute("aria-checked","false"),inputEl.checked=!1,this.hideFeedback(),this.fire("deselect")},MCOption.prototype.isSelected=function(){var inputEl=this.getInputElement();return inputEl&&!0===inputEl.checked},MCOption.prototype.hasStrikethrough=function(){var element=this.getElement();return element&&YUD.hasClass(element,"strikethrough")},MCOption.prototype.toggleStrikethrough=function(){var element=this.getElement();element&&YUD.toggleClass(element,"strikethrough")},MCOption.prototype.render=function(){function navigateWrapper(dir,type,args){group.navigate(dir)&&args&&args.length&&YUE.stopEvent(args[1])}var group=this._options,item=group.getItem(),optionEl=this.getElement();optionEl.setAttribute("role",this._role),optionEl.setAttribute("aria-checked",this.isSelected()),optionEl.setAttribute("aria-label","Option "+this.key);var contentEl=this.getContentElement(),contentId=contentEl.getAttribute("id");contentId||(contentId="Item_OptionContent_Response_MC_"+item.position+"_"+this.key,contentEl.setAttribute("id",contentId)),optionEl.setAttribute("aria-labelledby",contentId);var clickerEl=Util.Dom.getElementByClassName("optionClicker","span",optionEl);clickerEl&&(clickerEl.setAttribute("style","text-indent:-9999px;overflow:hidden;"),clickerEl.innerHTML="&nbsp"),this.feedback&&this.createFeedback(),YUE.on(optionEl,"click",function(evt){item.isReadOnly()||this.select()},this,!0),new YAHOO.util.KeyListener(optionEl,{keys:[32]},{fn:function(evt){item.isReadOnly()||this.select()},scope:this,correctScope:!0}).enable(),CM.isAccessibilityEnabled()&&(new YAHOO.util.KeyListener(optionEl,{keys:[38]},{fn:navigateWrapper.bind(null,"prev")}).enable(),new YAHOO.util.KeyListener(optionEl,{keys:[40]},{fn:navigateWrapper.bind(null,"next")}).enable())},MCOption.prototype.toString=function(){return this.key},window.ContentMCOption=MCOption}(window.ContentManager),function(){function MS(item){MS.superclass.constructor.call(this,item),this._role="group",this._minChoices=0,this._maxChoices=0}YAHOO.lang.extend(MS,ContentMCGroup),MS.prototype.setMinChoices=function(num){this._minChoices=num},MS.prototype.getMinChoices=function(){return this._minChoices},MS.prototype.setMaxChoices=function(num){this._maxChoices=num},MS.prototype.getMaxChoices=function(){return this._maxChoices},MS.prototype.getSelected=function(){for(var selectedOptions=[],i=0;i<this._options.length;i++)this._options[i].isSelected()&&selectedOptions.push(this._options[i]);return selectedOptions},MS.prototype.clear=function(){for(var selected=this.getSelected(),i=0;i<selected.length;i++)selected[i].deselect()},MS.prototype.getValue=function(){return this.getSelected().join(",")},MS.prototype.setValue=function(value){if(this.clear(),null==value)return!1;for(var optionKeys=value.split(","),i=0;i<optionKeys.length;i++){var optionKey=optionKeys[i],option=this.getOption(optionKey);null!=option&&option.select()}return!0},window.ContentMSGroup=MS}(),function(){var MSOption=function(options,key){MSOption.superclass.constructor.call(this,options,key),this._role="checkbox"};YAHOO.lang.extend(MSOption,ContentMCOption),MSOption.prototype._validateSelection=function(){var maxChoices=this._options.getMaxChoices(),selected=this._options.getSelected(),selectedCount=selected.length;if(1==maxChoices&&selectedCount>0)selected[0].deselect();else if(maxChoices>0&&maxChoices<=selectedCount)return!1;return!0},MSOption.prototype.select=function(){var page=this._options.getItem().getPage();if(!1===this.fire("beforeSelect"))return!1;var inputEl=this.getInputElement();if(inputEl.checked)this.deselect();else{if(!this._validateSelection())return!1;inputEl.checked=!0;var optionEl=this.getElement();YUD.addClass(optionEl,"optionSelected"),optionEl.setAttribute("aria-checked","true");var accProps=page.getAccommodationProperties();null!=accProps&&accProps.showFeedback()&&this.showFeedback()}return this.fire("select"),!0},window.ContentMSOption=MSOption}(),function(CM){function Widget_MC(page,entity,config){this._ready=!1,this._group=null}CM.registerWidget("mc",Widget_MC,function(page,entity,content){var id="OptionsContainer_"+entity.position,optionsEl=document.getElementById(id);return!(!optionsEl||!content.options)&&new CM.WidgetConfig("choice",optionsEl,{options:content.options,constraints:content.optionsConfig})}),Widget_MC.prototype.init=function(config){var item=this.entity,group=null;null!=item.format&&"MS"==item.format.toUpperCase()?(group=new ContentMSGroup(item),config.constraints&&(group.setMinChoices(config.constraints.minChoices),group.setMaxChoices(config.constraints.maxChoices))):(group=new ContentMCGroup(item)).autoRespond=!0,config.options.forEach(function(configOption){var option,optionKey=configOption.key.toUpperCase();option=null!=item.format&&"MS"==item.format.toUpperCase()?new ContentMSOption(group,optionKey):new ContentMCOption(group,optionKey),group.addOption(option),option.tts=configOption.tts,option.feedback=configOption.feedback}.bind(this)),this._group=group},Widget_MC.prototype.load=function(){if("wai"==this.page.layout){var item=this.entity,itemEl=item.getElement();YUD.addClass(itemEl,"multipleChoiceItem"),"MS"==item.format?YUD.addClass(itemEl,"format_ms"):YUD.addClass(itemEl,"format_mc")}this._group.render(this.element),this._ready=!0},Widget_MC.prototype.getComponents=function(){return this._group.getOptions().map(function(option){return option.getElement()})},Widget_MC.prototype.isReady=function(){return this._ready},Widget_MC.prototype.isBusy=function(){return this.isReady()},Widget_MC.prototype.getResponse=function(){var value=this._group.getValue();return value?this.createResponse(value,!0):this.createResponse(null,!1)},Widget_MC.prototype.setResponse=function(value){return this._group.setValue(value)},Widget_MC.prototype.toString=function(){return"widget-mc"}}(ContentManager);var EBSR=function(xmlString,item){this._xmlString=xmlString;var ebsrItem=this;this._position=item.position;var docElement=Util.Xml.parseFromString(xmlString).documentElement;this.interactionsXml=docElement.getElementsByTagName("choiceInteraction"),this._interactions=[],this._interactionHash={},$.each(this.interactionsXml,function(i,interactionXml){var contentOptionClass=[];contentOptionClass.MS=EBSR.MSOption,contentOptionClass.MC=EBSR.MCOption;var interaction=new EBSR.QTI(interactionXml,item.position,contentOptionClass,i+1);interaction.options.getItem=function(){return item},ebsrItem.addInteraction(interaction)})};EBSR.prototype.addInteraction=function(interaction){this._interactions.push(interaction),this._interactionHash[interaction.responseId]=interaction},EBSR.prototype.getInteractions=function(){return this._interactions},EBSR.prototype.getPrompts=function(){var interactions=this.getInteractions(),prompts=[];return Util.Array.each(interactions,function(interaction){var prompt=interaction.getPrompt();prompt&&1==prompt.length&&prompts.push(prompt[0])}),prompts},EBSR.prototype.getInteractionByKey=function(key){var interactions=this.getInteractions(),targetInteraction={};return Util.Array.each(interactions,function(interaction){interaction.key==key&&(targetInteraction=interaction)}),targetInteraction},EBSR.prototype.getInteraction=function(key){return this._interactionHash[key]},EBSR.prototype.getFocusedOption=function(focusedComponent){for(var i=0;i<this._interactions.length;i++)for(var options=this._interactions[i].getOptions(),j=0;j<options.length;j++){var option=options[j];if(option.getElement()==focusedComponent)return option}},EBSR.prototype.populateStem=function(){if(null!=this._xmlString){var itemBodyNode=Util.Xml.parseFromString(this._xmlString).documentElement;$("choiceInteraction",itemBodyNode).remove(),$("#Stem_"+this._position).html(Util.Xml.innerHTML(itemBodyNode))}},EBSR.prototype.generateHTML=function(answerContainer){var interactions=this.getInteractions();Util.Array.each(interactions,function(interaction){interaction.generateInteractionHTML(answerContainer)})},EBSR.prototype.getAllComponentLists=function(){var componentList=[],interactions=this.getInteractions();return Util.Array.each(interactions,function(interaction){var interactionComponentList=interaction.getComponentList();componentList=componentList.concat(interactionComponentList)}),componentList},EBSR.prototype.getAllRadioButtons=function(){var radioButtons=[],interactions=this.getInteractions();return Util.Array.each(interactions,function(interaction){var interactionRadioButtons=interaction.getRadioButtons();radioButtons=radioButtons.concat(interactionRadioButtons)}),radioButtons},EBSR.prototype.setValue=function(value){if("string"!=typeof value||-1==value.indexOf("<itemResponse>"))return!1;var ebsr=this,docElement=Util.Xml.parseFromString(value).documentElement;return $("response",docElement).each(function(responseIdx,responseNode){var responseId=responseNode.getAttribute("id"),interaction=ebsr.getInteraction(responseId);interaction&&interaction.options&&(interaction.options.clear(),$("value",responseNode).each(function(valueIdx,valueNode){var optionId=$(valueNode).text();if(optionId){var option=interaction.options.getOption(optionId);option&&option.select(!0)}}))}),!0},EBSR.prototype.getResponse=function(){var responseEl=["<itemResponse>"],interactions=this.getInteractions(),createSelectedNode=function(selected){selected&&(responseEl.push("<value>"),responseEl.push(selected),responseEl.push("</value>"))};return Util.Array.each(interactions,function(interaction){responseEl.push('<response id="'+interaction.responseId+'">');var selected=interaction.options.getSelected();if("MS"==interaction.type.toUpperCase())for(var i=0;i<selected.length;i++)createSelectedNode(selected[i]);else createSelectedNode(selected);responseEl.push("</response>")}),responseEl.push("</itemResponse>"),responseEl.join("")},EBSR.prototype.isValid=function(){var interactions=this.getInteractions(),response=!0;return Util.Array.each(interactions,function(interaction){var selected=interaction.options.getSelected();selected&&0!=selected.length||(response=!1)}),response},EBSR.prototype.isEmpty=function(){return this.getInteractions().every(function(interaction){var selected=interaction.options.getSelected();return"MC"==interaction.type?!selected:"MS"!=interaction.type||0==selected.length})},function(){var getElement=function(){var item=this._options.getItem();return item.getPage().getDoc().getElementById("Item_OptionContainer_Response_EBSR_"+item.position+"_Part"+this._interactionKey+"_"+this.key)},getInputElement=function(){var item=this._options.getItem();return item.getPage().getDoc().getElementById("Item_Response_EBSR_"+item.position+"_Part"+this._interactionKey+"_"+this.key)},getSoundLink=function(){var item=this._options.getItem(),soundDIV=item.getPage().getDoc().getElementById("Item_OptionSound_Response_EBSR_"+item.position+"_Part"+this._interactionKey+"_"+this.key);return null==soundDIV?null:soundDIV.getElementsByTagName("a")[0]};EBSR.MCOption=function(options,key,interactionKey){EBSR.MCOption.superclass.constructor.call(this,options,key),this._interactionKey=interactionKey},YAHOO.lang.extend(EBSR.MCOption,ContentMCOption),EBSR.MCOption.prototype.getElement=getElement,EBSR.MCOption.prototype.getInputElement=getInputElement,EBSR.MCOption.prototype.getSoundLink=getSoundLink,EBSR.MSOption=function(options,key,interactionKey){EBSR.MSOption.superclass.constructor.call(this,options,key,interactionKey),this._interactionKey=interactionKey},YAHOO.lang.extend(EBSR.MSOption,ContentMSOption),EBSR.MSOption.prototype.getElement=getElement,EBSR.MSOption.prototype.getInputElement=getInputElement,EBSR.MSOption.prototype.getSoundLink=getSoundLink}(),EBSR.QTI=function(interactionXml,itemKey,contentOptionClass,interactionKey){this._componentList=[],null==contentOptionClass&&((contentOptionClass=[]).MS=ContentMSOption,contentOptionClass.MC=ContentMCOption);var options;this.responseId=interactionXml.getAttribute("responseIdentifier");var maxChoices=1*(interactionXml.getAttribute("maxChoice")||interactionXml.getAttribute("maxChoices")),minChoices=1*interactionXml.getAttribute("minChoices");1!=maxChoices?(this.type="MS",(options=new ContentMSGroup).setMinChoices(minChoices),options.setMaxChoices(maxChoices)):(this.type="MC",options=new ContentMCGroup),this.itemKey=itemKey,this.key=interactionKey;var prompt=interactionXml.getElementsByTagName("prompt")[0],promptToHtml=Util.Xml.serializeToString(prompt);this.promptText=$(promptToHtml).html();var optionsXml=interactionXml.getElementsByTagName("simpleChoice"),optionsArray=[],contentOption=contentOptionClass[this.type];Util.Array.each(optionsXml,function(optionXml){var optionKey=optionXml.getAttribute("identifier").toUpperCase(),option=new contentOption(options,optionKey,interactionKey);options.addOption(option);var parsedOption={};parsedOption.key=optionKey;var optionToHtml=Util.Xml.serializeToString(optionXml);parsedOption.innerHTML=$(optionToHtml).html(),optionsArray[optionKey]=parsedOption}),this.options=options,this.parsedOptions=optionsArray},EBSR.QTI.prototype.getOptions=function(){return this.options.getOptions()},EBSR.QTI.prototype.getPrompt=function(){return this._prompt},EBSR.QTI.prototype.getHeader=function(){return this._header},EBSR.QTI.prototype.getComponentList=function(){return this._componentList},EBSR.QTI.prototype.generateInteractionHTML=function(answerContainer){var interactionHTML=$("<div></div").attr("id","Item_Container_EBSR_"+this.itemKey+"_"+this.key).attr("role",this.options._role).addClass("interactionContainer").appendTo(answerContainer);this.generatePromptHTML(interactionHTML),this._componentList.push(this._prompt[0]);var interaction=this,options=this.getOptions();options&&options.length>0&&Util.Array.each(options,function(option){var optionContainer=interaction.generateOptionHTML(interactionHTML,option);interaction._componentList.push(optionContainer),option.render()})},EBSR.QTI.prototype.generatePromptHTML=function(parent){var headerKey="EBSR.Header.Part"+this.key,ttsKey="TDSTTS.Speak.EBSR.Part"+this.key,headerText=Messages.get(headerKey);if(this._header=$("<h3>"+headerText+"</h3>").appendTo(parent),Messages.has(ttsKey)){var ttsText=Messages.get(ttsKey);this._header.attr("ssml","sub").attr("ssml_alias",ttsText).addClass("TTS").addClass("speakAs")}this._prompt=$("<div></div>").attr("id","Item_InteractionPrompt_Response_EBSR_"+this.itemKey+"_"+this.key).addClass("interactionPrompt").html(this.promptText).appendTo(parent)},EBSR.QTI.prototype.generateOptionHTML=function(parent,option){var optionIdString=this.itemKey+"_Part"+this.key,nodeId="Item_OptionContainer_Response_EBSR_"+optionIdString+"_"+option.key,nodeClass="EBSR_"+this.type.toLowerCase(),node=$("<div></div>").attr("id",nodeId).attr("title",Messages.get("EBSR.Header.Part"+this.key)+" Option "+option.key).addClass("optionContainer option"+option.key+" "+nodeClass).append('<span class="striked"></span>').append('<span class="optionClicker"></span>').appendTo(parent),inputButton=$("<input></input").attr("name","Item_Response_EBSR_"+optionIdString).attr("value",option.key).attr("id","Item_Response_EBSR_"+optionIdString+"_"+option.key).addClass("option").appendTo(node);if("MS"==this.type.toUpperCase()){var type="checkbox";inputButton.attr("data-tts-prefix","TDSTTS.Speak.Select"+option.key)}else type="radio";return inputButton.prop("type",type),$("<div></div>").addClass("optionContent").attr("id","Item_OptionContent_Response_EBSR_"+optionIdString+"_"+option.key).html(this.parsedOptions[option.key].innerHTML).appendTo(node),node[0]},function(CM){function Widget_EBSR(page,item,config){this.ebsr=null}function onMenuShowTTS(page,item,menu,ebsr,interaction,selection){if(page.getAccommodationProperties().hasTTSItem()){var pageWin=page.getActiveWin(),languages="ESN"==CM.getLanguage()?["ESN","ENU"]:["ENU"],focusedComponent=item.getActiveComponent(),domToParse=(ebsr.getFocusedOption(focusedComponent),[]);domToParse.push(interaction.getHeader()[0]),domToParse.push(interaction.getPrompt()[0]);for(var ttsMenu=new TTS.Menu(languages),menuCfg=ttsMenu.getMenuCfg(domToParse,selection,pageWin,item.stemTTS,page,item),i=0;i<interaction.getOptions().length;++i){var element=interaction.getOptions()[i].getElement(),testCfg=null;(testCfg=new TTS.Menu(languages).addFocusedOption(testCfg,element))&&testCfg.PRI.cb&&domToParse.push(element)}domToParse.length>2&&ttsMenu.addOptions(menuCfg,domToParse),TTS.MenuSystem.addMenuSetup(menu,menuCfg),TTS.Config.Debug&&console.log("TTS On Item Menushow config",menuCfg)}}function onMenuShowASL(page,item,menu,ebsr,interaction){var attachments=item.getAslAttachments();if(attachments&&attachments.length>0)for(var i=0;i<attachments.length;++i){var at=attachments[i];if("targeted"==at.subType.toLowerCase()){var target=at.target;if(interaction.responseId==target){var menuItem={text:Messages.get("TDSContentEventJS.Label.ASLItem"),classname:"ASL",onclick:{fn:function(){AslModule.showImageDialog(at.url,page.getZoomFactor())}}};return void menu.addMenuItem("component",menuItem)}}}}function onMenuShowStemTTS(page,item,menu,ebsr,stem,selection){if(page.getAccommodationProperties().hasTTSItem()){var pageWin=page.getActiveWin(),languages="ESN"==CM.getLanguage()?["ESN","ENU"]:["ENU"],domToParse=[];domToParse.push(stem);for(var ttsMenu=new TTS.Menu(languages),menuCfg=ttsMenu.getMenuCfg(domToParse,selection,pageWin,item.stemTTS,page,item),interactions=ebsr.getInteractions(),i=0;i<interactions.length;i++){var interaction=interactions[i];domToParse.push(interaction.getHeader()[0]),domToParse.push(interaction.getPrompt()[0]);for(var j=0;j<interaction.getOptions().length;++j)domToParse.push(interaction.getOptions()[j].getElement())}ttsMenu.addOptions(menuCfg,domToParse),TTS.MenuSystem.addMenuSetup(menu,menuCfg),TTS.Config.Debug&&console.log("TTS On Item Menushow config",menuCfg)}}CM.registerWidget("ebsr",Widget_EBSR,function(page,item,content){var id="EBSR_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el,item.qti.xml)}),Widget_EBSR.prototype.load=function(){var item=this.entity,ebsrEl=this.element,qtiXml=this.config,ebsr=new EBSR(qtiXml,item);this.ebsr=ebsr,ebsr.generateHTML(ebsrEl),ebsr.populateStem();var componentList=ebsr.getAllComponentLists();if(componentList&&componentList.length)for(var i=0;i<componentList.length;i++)item.addComponent(componentList[i]);item.value&&ebsr.setValue(item.value)},Widget_EBSR.prototype.keyEvent=function(evt){var item=this.entity,ebsr=this.ebsr;if("keydown"==evt.type&&!evt.ctrlKey&&!evt.altKey&&"Enter"==evt.key){if(item.isReadOnly())return;var focusedComponent=item.getActiveComponent();if(focusedComponent){var option=ebsr.getFocusedOption(focusedComponent);option&&option.select()}}},Widget_EBSR.prototype.showMenu=function(menu,evt,selection){function getClosestInteraction(target){var pageEl=page.getElement();return $(target).closest("div.interactionContainer",pageEl)}var page=this.page,item=this.entity,ebsr=this.ebsr,interaction=null,$interactionContainer=getClosestInteraction(evt.target);if($interactionContainer&&0==$interactionContainer.length&&($interactionContainer=getClosestInteraction(item.getActiveComponent())),$interactionContainer.length>0){var interactionId=$interactionContainer.attr("id");if(interactionId){var interactionKey=interactionId.split("_").pop();interactionKey&&(interaction=ebsr.getInteractionByKey(interactionKey))}}null!=interaction&&(onMenuShowTTS(page,item,menu,ebsr,interaction,selection),onMenuShowASL(page,item,menu,0,interaction));var $stemContainer=$(evt.target).closest("div.stemContainer");$stemContainer.length>0&&onMenuShowStemTTS(page,item,menu,ebsr,$stemContainer[0],selection)},Widget_EBSR.prototype.hide=function(){TTS.getInstance().stop()},Widget_EBSR.prototype.isResponseAvailable=function(){return null!=this.ebsr},Widget_EBSR.prototype.getResponse=function(){var ebsr=this.ebsr,value=ebsr.getResponse(),valid=ebsr.isValid(),empty=ebsr.isEmpty();return this.createResponse(value,valid,empty)},Widget_EBSR.prototype.setResponse=function(value){this.ebsr.setValue(value)}}(window.ContentManager),WordListItem.tagType=["div","span"],WordListItem.attributeName="data-word-index",WordListItem.groupAttributeName="data-wl-group",WordListItem.ClassNameString="TDS_WORD_LIST",WordListItem.ClassNameStringHover="TDS_WORD_LIST_HOVER",WordListItem.CTag=0,WordListItem.GTag=0,WordListItem.mouseOver=function(event,wl){var div=this;wl.AddClassToGroup(div,WordListItem.ClassNameStringHover,WordListItem.ClassNameString)},WordListItem.mouseOut=function(event,wl){var div=this;wl.AddClassToGroup(div,WordListItem.ClassNameString,WordListItem.ClassNameStringHover)},WordListItem.clickHandler=function(event,wl){if("click"==event.type||"keyup"==event.type&&(13==event.keyCode||32==event.keyCode)){var div=this,entry={wl_item:wl,span:div},headerText=wl.getGroupHtml(div);WordListPanel.processClick(entry,headerText)}},WordListPanel.queryName="key",WordListPanel.bankKeyHdr="bankKey",WordListPanel.itemKeyHdr="itemKey",WordListPanel.indexHdr="index",WordListPanel.AccType="Word List",WordListPanel.AccIllustrationType="Illustration Glossary",WordListPanel.AccNoAccs="TDS_WL0",WordListPanel.AccIllistrationAccs="TDS_WL_Illustration",WordListPanel.AccNoIllustrationAccs="TDS_ILG0",WordListPanel.AccShowIllustrationAccs="TDS_ILG1",WordListPanel.AccHdr="TDS_ACCS",WordListPanel.divId="WordListTool",WordListPanel.toolDiv=null,WordListPanel.panel=null,WordListPanel.resizer=null,WordListPanel.generalPanelWidth=320,WordListPanel.minImageSize=200,WordListPanel.absoluteMinPanelWidth=110,WordListPanel.zoomFactor=1,WordListPanel.tabView=null,WordListPanel.tabCount=0,WordListPanel.tabCurrent=0,WordListPanel.requestQ={},WordListPanel.tagQ={},WordListPanel.xhrUrl="Pages/API/WordList.axd",WordListPanel.xhrMethod="resolve",WordListPanel.tabbedDivName="word-list-list-div",WordListPanel.contentWordCache={},WordListPanel.headerWordCache={},WordListPanel.message={},WordListPanel.getKeyFromQEntry=function(entry){var keyIndex=YUD.getAttribute(entry.span,WordListItem.attributeName);return entry.wl_item.wl_res.bankKey+"-"+entry.wl_item.wl_res.itemKey+"-"+keyIndex},WordListPanel.postCallback={success:function(resp){var messages=YAHOO.lang.JSON.parse(resp.responseText);if(messages){for(var i=0;i<messages.length;++i){var tabString=WordListPanel.RenderHtmlTabs(messages[i]),key=messages[i].EntryKey,itemKey=key.split("-")[1];WordListPanel.contentWordCache[key]=tabString,WordListPanel.message[key]=messages[i]}WordListPanel.ProcessTagQ(itemKey)}else console.error("word list: server returned no word list words")},argument:[]},WordListPanel.ProcessTagQ=function(itemKey){var itemTagQ=WordListPanel.tagQ[itemKey];if(null!=itemTagQ)for(var i=itemTagQ.length-1;i>=0;--i){var entry=itemTagQ[i],cacheEntry=WordListPanel.message[entry.key];cacheEntry&&cacheEntry.EntryFound&&(entry.wl_item.TagSingleSpan(entry.span),itemTagQ.splice(i,1))}else console.log("word list: server returned empty response, returning.")},WordListPanel.processClick=function(entry,headerText){if(null!=WordListPanel.panel&&null!=WordListPanel.toolDiv&&null!=entry){var cacheKey=WordListPanel.getKeyFromQEntry(entry);null!=WordListPanel.contentWordCache[cacheKey]?(WordListPanel.headerWordCache[cacheKey]=headerText,WordListPanel.curWLItem=entry.wl_item,WordListPanel.setPanel(WordListPanel.headerWordCache[cacheKey],WordListPanel.contentWordCache[cacheKey]),WordListPanel.panel.mask.style.display="none"):ContentManager.log("WordList: errantly tagged span")}},WordListPanel.sendRequest=function(wl_item){var bankKey=wl_item.wl_res.bankKey,itemKey=wl_item.wl_res.itemKey,str=WordListPanel.bankKeyHdr+"="+bankKey.toString()+"&"+WordListPanel.itemKeyHdr+"="+itemKey.toString(),strValues="",requestQ=WordListPanel.requestQ[itemKey];if($.each(requestQ,function(key,value){strValues=strValues+"&index="+value}),""!=strValues){str+=strValues;var accommodationManager=Accommodations.Manager.getCurrent(),wlCodes=accommodationManager.getType(WordListPanel.AccType).getCodes(!0),ilgType=accommodationManager.getType(WordListPanel.AccIllustrationType);if(null!=ilgType){var ilgs=ilgType.getCodes(!0);0!=ilgs.length&&ilgs[0]==WordListPanel.AccShowIllustrationAccs&&wlCodes.push(WordListPanel.AccIllistrationAccs)}for(var i=0,ii=wlCodes.length;i<ii;i++)for(var wlInner=wlCodes[i].split("&"),j=0;j<wlInner.length;++j)str+="&"+WordListPanel.AccHdr+"="+wlInner[j];var urlString=TDS.baseUrl+WordListPanel.xhrUrl+"/"+WordListPanel.xhrMethod;/^http/.test(WordListPanel.xhrUrl)&&(urlString=WordListPanel.xhrUrl+"/"+WordListPanel.xhrMethod),YAHOO.util.Connect.asyncRequest("POST",urlString,WordListPanel.postCallback,str)}else WordListPanel.ProcessTagQ(itemKey)},WordListPanel.IsWordListEnabled=function(){var accs=Accommodations.Manager.getCurrent(),wlType=accs.getType(WordListPanel.AccType),ilgType=accs.getType(WordListPanel.AccIllustrationType),doesGlossaryExist=!1,doesIllustrationExist=!1;if(wlType){var wlValues=wlType.getSelected();if(0!=wlValues.length){doesGlossaryExist=!0;for(i=0;i<wlValues.length;++i)for(var codes=wlValues[i].getCodes(),j=0;j<codes.length;++j)if(codes[j]==WordListPanel.AccNoAccs){doesGlossaryExist=!1;break}}}if(ilgType){var ilgValues=ilgType.getSelected();if(0!=ilgValues.length)for(var i=0;i<ilgValues.length;++i)for(var codes=ilgValues[i].getCodes(),j=0;j<codes.length;++j)if(codes[j]==WordListPanel.AccShowIllustrationAccs){doesIllustrationExist=!0;break}}return doesGlossaryExist||doesIllustrationExist},WordListPanel.setPanel=function(hd,bd){if(null!=WordListPanel.panel&&null!=WordListPanel.toolDiv){for(null!=hd&&WordListPanel.panel.setHeader(hd),WordListPanel.panel.setBody(bd),WordListPanel.panel.show(),WordListPanel.tabView=new YAHOO.widget.TabView(WordListPanel.tabbedDivName),WordListPanel.tabCount=0,WordListPanel.absoluteMinPanelWidth=24;null!=WordListPanel.tabView.getTab(WordListPanel.tabCount);)WordListPanel.absoluteMinPanelWidth+=$(WordListPanel.tabView.getTab(WordListPanel.tabCount).get("element")).outerWidth(!0),WordListPanel.tabCount++;WordListPanel.determineDefaultPanelSizes(),WordListPanel.initializeIllustration(),WordListPanel.tabCurrent=0,WordListPanel.tabView.on("activeTabChange",function(event){for(var oTabEl,i=0;i<WordListPanel.tabCount;++i)oTabEl=WordListPanel.tabView.getTab(i).get("element"),$(oTabEl).removeAttr("aria-title");oTabEl=this.get("activeTab").get("element"),$(oTabEl).attr("aria-title","Selected"),WordListPanel.initializeResizing()}),WordListPanel.initializeResizing(),WordListPanel.fitPanelToIllustrationSize(),WordListPanel.handlePanelOutsideWindow(),setTimeout(function(){WordListPanel.postProcessAudioTags()}.bind(this),1)}},WordListPanel.panelSizes={},WordListPanel.fitPanelToIllustrationSize=function(){var bd=WordListPanel.panel.body;try{if(!bd)return;var imgEls=YAHOO.util.Selector.query("img",bd)||[];if(1==imgEls.length){var img=$(imgEls[0]),newWidth=img.width()+WordListPanel.getPanelExtraWidth(),newHeight=img.height()+WordListPanel.getPanelExtraHeight();newWidth=Math.max(newWidth,WordListPanel.absoluteMinPanelWidth);var panel=$("#"+WordListPanel.panel.id),activeTabId=$(WordListPanel.tabView.get("activeTab").get("element")).find("a").attr("href"),size=WordListPanel.panelSizes[activeTabId]||{};size.width=newWidth,size.height=newHeight,size.baseWidth=size.width/WordListPanel.zoomFactor,size.baseHeight=size.height/WordListPanel.zoomFactor,WordListPanel.panelSizes[activeTabId]=size,panel.width(newWidth).height(newHeight),panel.attr("data-width",size.baseWidth),panel.attr("data-height",size.baseHeight)}}catch(e){console.error("Error fitting panel to illustration.",e)}},WordListPanel.savePanelSize=function(){var panel=$("#"+WordListPanel.panel.id),activeTabId=$(WordListPanel.tabView.get("activeTab").get("element")).find("a").attr("href"),size=WordListPanel.panelSizes[activeTabId]||{};size.width=panel.width(),size.height=panel.height(),size.baseWidth=size.width/WordListPanel.zoomFactor,size.baseHeight=size.height/WordListPanel.zoomFactor,WordListPanel.panelSizes[activeTabId]=size,panel.attr("data-width",size.baseWidth),panel.attr("data-height",size.baseHeight)},WordListPanel.determineDefaultPanelSizes=function(){WordListPanel.panelSizes={};for(var contentDivs=$(WordListPanel.panel.body).find("div.yui-content > div"),i=0;i<contentDivs.length;i++){var width=WordListPanel.generalPanelWidth*WordListPanel.zoomFactor,height="",img=$(contentDivs[i]).find("img");1==img.length&&(width=img.width()+WordListPanel.getPanelExtraWidth(),height=img.height()+WordListPanel.getPanelExtraHeight()),width=Math.max(WordListPanel.absoluteMinPanelWidth,width),WordListPanel.panelSizes["#"+contentDivs[i].id]={width:width,height:height,baseWidth:width/WordListPanel.zoomFactor,baseHeight:""==height?"":height/WordListPanel.zoomFactor}}},WordListPanel.getPanelExtraHeight=function(){var height=0,panel=$("#"+WordListPanel.panel.id);return height+=panel.find(".hd").outerHeight(!0),height+=panel.find(".bd ul.yui-nav").outerHeight(!0),height+=panel.find(".bd").innerHeight()-panel.find(".bd").height(),height+=panel.find(".bd .yui-content").innerHeight()-panel.find(".bd .yui-content").height(),height+=6},WordListPanel.getPanelExtraWidth=function(){return 40*WordListPanel.zoomFactor},WordListPanel.handlePanelOutsideWindow=function(){var panel=$("#"+WordListPanel.panel.id+"_c"),moveLeft=0,moveTop=0,widthGap=window.innerWidth-(panel.offset().left+panel.outerWidth());widthGap<5&&(moveLeft=widthGap-10);var heightGap=window.innerHeight-(panel.offset().top+panel.outerHeight());if(heightGap<5&&(moveTop=heightGap-10),0!=moveLeft||0!=moveTop){var newLeft=panel.position().left+moveLeft,newTop=panel.position().top+moveTop,shrinkHeightToFit=!1,shrinkWidthToFit=!1;if(newLeft<0&&(newLeft=0,shrinkWidthToFit=!0),newTop<0&&(newTop=0,shrinkHeightToFit=!0),panel.css({left:newLeft+"px",top:newTop+"px"}),shrinkWidthToFit||shrinkHeightToFit){var newWidth=0,newHeight=0;shrinkWidthToFit?newHeight=(newWidth=window.innerWidth-10)/WordListPanel.illustrationRatio:newWidth=(newHeight=window.innerHeight-10)*WordListPanel.illustrationRatio,WordListPanel.resizeIllustration(newWidth-WordListPanel.getPanelExtraWidth(),newHeight-WordListPanel.getPanelExtraHeight())}}},WordListPanel.getActiveTabPanelSize=function(){var activeTabId=$(WordListPanel.tabView.get("activeTab").get("element")).find("a").attr("href");return WordListPanel.panelSizes[activeTabId]},WordListPanel.initializeResizing=function(){var activePanelSize=WordListPanel.getActiveTabPanelSize();if(activePanelSize){var panel=$("#"+WordListPanel.panel.id);panel.width(activePanelSize.width).height(activePanelSize.height),panel.attr("data-width",activePanelSize.width),activePanelSize.height?panel.attr("data-height",activePanelSize.height):panel.attr("data-height",panel.height())}else WordListPanel.savePanelSize();if(1==$(WordListPanel.tabView.get("activeTab").get("content")).find("img").length){var resizeConfig={handles:["br"],ratio:!0,status:!1};WordListPanel.illustrationRatio>1?(resizeConfig.minHeight=WordListPanel.minImageSize+WordListPanel.getPanelExtraHeight(),resizeConfig.minWidth=Math.max(WordListPanel.minImageSize+WordListPanel.getPanelExtraWidth(),WordListPanel.absoluteMinPanelWidth)):(resizeConfig.minHeight=WordListPanel.minImageSize+WordListPanel.getPanelExtraHeight(),resizeConfig.minWidth=WordListPanel.absoluteMinPanelWidth),null==WordListPanel.resizer&&(WordListPanel.resizer=new YAHOO.util.Resize(WordListPanel.panel.id,resizeConfig)),WordListPanel.resizer.on("resize",function(args){WordListPanel.resizeHelper(args.width,args.height,this,!0)},WordListPanel.panel,!0),WordListPanel.resizer.on("startResize",function(args){if(this.cfg.getProperty("constraintoviewport")){var D=YAHOO.util.Dom,clientRegion=D.getClientRegion(),elRegion=D.getRegion(this.element);WordListPanel.resizer.set("maxWidth",clientRegion.right-elRegion.left-YAHOO.widget.Overlay.VIEWPORT_OFFSET),WordListPanel.resizer.set("maxHeight",clientRegion.bottom-elRegion.top-YAHOO.widget.Overlay.VIEWPORT_OFFSET)}else WordListPanel.resizer.set("maxWidth",null),WordListPanel.resizer.set("maxHeight",null)},WordListPanel.panel,!0)}else null!=WordListPanel.resizer&&(WordListPanel.resizer.destroy(),WordListPanel.resizer=null)},WordListPanel.doZoomResize=function(){if(WordListPanel.IsVisible()){var activePanelSize=WordListPanel.getActiveTabPanelSize();WordListPanel.resizeHelper(activePanelSize.width,activePanelSize.height,WordListPanel.panel,!1)}},WordListPanel.resizeHelper=function(w,h,panel,isResize){WordListPanel.resizeIllustration(w-WordListPanel.getPanelExtraWidth(),h-WordListPanel.getPanelExtraHeight()),panel.cfg.setProperty("height",h+"px"),isResize&&WordListPanel.savePanelSize()},WordListPanel.InitializePane=function(){YAHOO.widget.Tab.prototype.ACTIVE_TITLE="";var toolDiv=document.getElementById("tools");if(null!=toolDiv){WordListPanel.toolDiv=document.createElement("div"),YUD.addClass(WordListPanel.toolDiv,"yui-dialog focused"),YUD.setAttribute(WordListPanel.toolDiv,"id",WordListPanel.divId);var clink=document.createElement("link");YUD.setAttribute(clink,"type","text/css"),YUD.setAttribute(clink,"rel","stylesheet"),YUD.setAttribute(clink,"media","screen"),YUD.setAttribute(clink,"href",ContentManager.resolveBaseUrl("Scripts/Libraries/yahoo/yui2/build/tabview/assets/skins/sam/tabview.css")),WordListPanel.toolDiv.appendChild(clink),toolDiv.appendChild(WordListPanel.toolDiv),WordListPanel.panel=new YAHOO.widget.Panel("wordListPanel",{width:"600px",zindex:1004,visible:!1,constraintoviewport:!0,modal:!0,autofillheight:"body"})}WordListPanel.panel.render(WordListPanel.toolDiv),Accommodations.Manager.getCurrentProps().isStreamlinedMode()&&$(WordListPanel.toolDiv).find(".container-close").keyup(function(evt){null!=WordListPanel.panel&&(13!=evt.which&&32!=evt.which||(WordListPanel.panel.hide(),evt.preventDefault()))}),WordListPanel.panel.subscribe("hide",function(){WordListPanel.curWLItem&&(WordListPanel.curWLItem.ClearSelectedWord(),WordListPanel.curWLItem=null)})},WordListPanel.RenderHtmlTabs=function(messages){var entries=messages.Entries;if(entries.length>1){for(var firstItem=0,j=1;j<messages.Entries.length;j++)if("glossary"==entries[j].wlType){firstItem=j;break}(entries=[]).push(messages.Entries[firstItem]);for(j=0;j<messages.Entries.length;j++)j!=firstItem&&entries.push(messages.Entries[j])}var tabString='<div id="'+WordListPanel.tabbedDivName+'" class="yui-navset"> \r\n';tabString+='<ul class="yui-nav">\r\n';var i,contentString=' <div class="yui-content">\r\n';for(i=0;i<entries.length;++i)tabString+="<li",0==i&&(tabString+=' class="selected" aria-title="Selected"'),tabString=(tabString=tabString+'> <a href="#word-list-'+i.toString())+'">'+Messages.get("TDS.WordList."+entries[i].wlType)+"</a></li>\r\n",contentString=contentString+'<div id="word-list-'+i.toString()+'"><p>'+entries[i].wlContent+"</p></div>";return tabString+="</ul>",tabString=tabString+contentString+"</div>"},WordListPanel.illustrationWidth=null,WordListPanel.illustrationHeight=null,WordListPanel.illustrationRatio=1,WordListPanel.initializeIllustration=function(){var bd=WordListPanel.panel.body;try{if(!bd)return;var imgEls=YAHOO.util.Selector.query("img",bd)||[];if(1==imgEls.length){var img=$(imgEls[0]);return WordListPanel.illustrationWidth=img.width(),WordListPanel.illustrationHeight=img.height(),WordListPanel.illustrationRatio=WordListPanel.illustrationWidth/WordListPanel.illustrationHeight,WordListPanel.resizeIllustration(WordListPanel.illustrationWidth*WordListPanel.zoomFactor,WordListPanel.illustrationHeight*WordListPanel.zoomFactor),!0}}catch(e){console.error("Error initializing the illustration (error, dom).",e,bd)}return!1},WordListPanel.resizeIllustration=function(w,h){var bd=WordListPanel.panel.body;try{if(!bd)return;var imgEls=YAHOO.util.Selector.query("img",bd)||[];if(1==imgEls.length){var img=$(imgEls[0]);img.attr("width",w),img.attr("height",h),img.attr("data-width",w),img.attr("data-height",h)}}catch(e){console.error("Error resizing the illustration (error, dom).",e,bd)}},WordListPanel.postProcessAudioTags=function(){if(window.TDS&&window.TDS.Audio&&window.TDS.Audio.Widget){var bd=WordListPanel.panel.body;try{if(!bd)return;for(var audioEls=YAHOO.util.Selector.query("a",bd)||[],i=0;i<audioEls.length;++i){var span=audioEls[i];if(span&&span.href){var href=span.href;-1==href.indexOf(".ogg")&&-1==href.indexOf(".m4a")||(YUD.addClass(span,"sound_repeat"),href=href.replace(/&amp;/gim,"&"),span.href=href,TDS.Audio.Widget.createPlayer(span))}}}catch(e){console.error("Error creating players in the word list panel (error, dom).",e,bd)}}},WordListPanel.IsVisible=function(){return!!WordListPanel.panel&&WordListPanel.panel.cfg.getProperty("visible")},WordListPanel.clearCache=function(){WordListPanel.contentWordCache={},WordListPanel.headerWordCache={},WordListPanel.message={}},function(CM){CM&&CM.onPageEvent("zoom",function(page,level){console.log("zoom event level",level),WordListPanel.zoomFactor=level;for(var key in WordListPanel.panelSizes){var val=WordListPanel.panelSizes[key];WordListPanel.panelSizes[key].width=val.baseWidth*level,WordListPanel.panelSizes[key].height=""==val.baseHeight?"":val.baseHeight*level}WordListPanel.doZoomResize(),WordListPanel.handlePanelOutsideWindow()})}(window.ContentManager),Retagger.verboseDebug=!1,function(CM){function processEntity(page,entity){if(0!=WordListPanel.IsWordListEnabled()){var wordListResource=entity.getResource("wordList");if(null!=wordListResource){var inst=new WordListItem;inst.wl_res=wordListResource,entity.wordList=inst;var elements=entity.getElement();inst.TagSpans(elements),null==WordListPanel.toolDiv&&WordListPanel.InitializePane()}}}CM.onPassageEvent("available",processEntity),CM.onItemEvent("available",processEntity),CM.onEntityEvent("keyevent",function(page,entity,evt){var inst=entity.wordList;inst&&inst.HandleKey(evt)&&YUE.stopEvent(evt)}),CM.onEntityEvent("hide",function(page,entity){WordListPanel&&WordListPanel.panel&&WordListPanel.panel.hide()})}(ContentManager),function(CM){function getInputEl(item){var itemEl=item.getElement();return $("input[name=textbox1_item_"+item.itemKey+"]",itemEl).get(0)}function Widget_WB(page,item){}CM.registerWidget("wordbuilder",Widget_WB,function(page,item,content){if(item.isResponseType("keyboard custom")||item.isResponseType("keyboard alphabetical")){var id="keyboard_"+item.position,el=getInputEl(item);if(el)return new CM.WidgetConfig(id,el)}return!1}),Widget_WB.prototype.load=function(){var item=this.entity,inputEl=this.element,keyboardEl=document.getElementById("keyboard_"+item.position);if(null!=keyboardEl&&null!=inputEl){new WordBuilder(keyboardEl,inputEl).activate(),CM.setReadOnlyKeyEvent(item,inputEl),null!=item.value&&(inputEl.value=item.value);var ariaTag=inputEl.getAttribute("data-desc");ariaTag&&(inputEl.removeAttribute("data-desc"),inputEl.setAttribute("aria-label",ariaTag)),keyboardEl.setAttribute("aria-hidden",!0),keyboardEl.setAttribute("role","presentation"),Accommodations.Manager.getCurrentProps().isStreamlinedMode()&&$(".keydisplay").children("a").attr("tabIndex","-1")}},Widget_WB.prototype.focus=function(){CM.focus(this.element)},Widget_WB.prototype.isResponseAvailable=function(){return null!=getInputEl(this.entity)},Widget_WB.prototype.getResponse=function(){var value=this.element.value,isValid=value.length>0;return this.createResponse(value,isValid)},Widget_WB.prototype.setResponse=function(value){this.element.value=value}}(window.ContentManager),function(CM){function Widget_PT(page,item){}CM.registerWidget("plaintext",Widget_PT,function(page,item){var id="Item_Response_"+item.position,el=document.getElementById(id);return!!el&&new CM.WidgetConfig(id,el)}),Widget_PT.prototype.load=function(){var item=this.entity,inputEl=this.element;item.isReadOnly()?inputEl.disabled=!0:inputEl.setAttribute("aria-required","true"),item.addComponent(inputEl)},Widget_PT.prototype.focus=function(){},Widget_PT.prototype.blur=function(){},Widget_PT.prototype.isResponseAvailable=function(){return null!=this.element},Widget_PT.prototype.getResponse=function(){var value=this.element.value,isValid=value.length>0;return value&&(value=value.replace(/]]>/g,"]]&gt;")),this.createResponse(value,isValid)},Widget_PT.prototype.setResponse=function(value){this.element.value=value}}(window.ContentManager),TDS.Config.messages={c_l:null,c_a:[{c:"AnimationSet2.js",m_a:[{id:12280,m:"Simulator.Animation.PosterAltText",t_a:[{t:"This image is a placeholder for the animation.  Start a new trial to view the animation.",l:"ENU"},{t:"This image is a placeholder for the animation.  Start a new trial to view the animation.",l:"ENU"}]}]},{c:"calculator",m_a:[{id:11472,m:"Calculator.Error.InvalidMode",t_a:[{t:"Error loading calculator. Give this message code to your TA.",l:"ENU"},{t:"Error al cargar la calculadora. Entregue este cdigo a su administrador de pruebas.",l:"ESN"}]},{id:11473,m:"Calculator.Error.NoMode",t_a:[{t:"Error loading calculator. Give this message code to your TA.",l:"ENU"},{t:"Error al cargar la calculadora. Entregue este cdigo a su administrador de pruebas.",l:"ESN"}]}]},{c:"Default.aspx",m_a:[{id:11706,m:"LoginShell.Alert.MustSelectForm",t_a:[{t:"Select a test form from the drop-down list.",l:"ENU"},{t:"Seleccione una prueba de la lista desplegable.",l:"ESN"}]},{id:11707,m:"LoginShell.Alert.FormSelectionInvalid",t_a:[{t:"The form you have selected does not match with the assigned form for this student.  If you believe this is an error please contact the help desk.",l:"ENU"},{t:"Ha seleccionado la prueba incorrecta.",l:"ESN"}]},{id:11963,m:"LoginShell.Alert.EnvironmentInsecureiOSVolumeControl",t_a:[{t:"Guided Access is not turned on. Please notify your proctor. (Before turning on Guided Access, check the volume on your iPad to make sure you can hear the audio.)",l:"ENU"},{t:"Acceso Guiado no est activado. Por favor notifique a su administrador. (Antes de activar Acceso Guiado, compruebe el volumen de su iPad para asegurarse de que se puede escuchar el audio.)",l:"ESN"}]},{id:11964,m:"LoginShell.Alert.EnvironmentSecureiOSVolumeControl",t_a:[{t:"Warning: You cannot adjust the volume of your iPad during the test. If you need to adjust the volume, please turn off Guided Access. Adjust the volume using the volume control buttons on the iPad, and then activate Guided Access.  If you need help, please ask your proctor.",l:"ENU"},{t:"Advertencia: No se puede ajustar el volumen de su iPad durante la prueba. Si necesita ajustar el volumen, por favor apague Acceso Guiado. Ajuste el volumen con los botones de control de volumen en el iPad y, entonces, activar Acceso Guiado. Si usted necesita ayuda, por favor, consulte a su administrador.",l:"ESN"}]},{id:11961,m:"Login.Label.Error",t_a:[{t:"Error logging in. Please try again or check with your Test Administrator.",l:"ENU"},{t:"Ocurri un error al iniciar la sesin. Por favor, intntelo de nuevo o consulte con su Administrador de Pruebas.",l:"ESN"}]}]},{c:"Global",m_a:[{id:11891,m:"Diagnostics.Label.Header",t_a:[{t:"Diagnostic Screen",l:"ENU"},{t:"Pantalla diagnstica",l:"ESN"}]},{id:11893,m:"Diagnostics.Label.Browser.UserAgent",t_a:[{t:"User Agent:",l:"ENU"},{t:"Agente de Usuario:",l:"ESN"}]},{id:11894,m:"Diagnostics.Label.Browser.Platform",t_a:[{t:"Platform:",l:"ENU"},{t:"Plataforma:",l:"ESN"}]},{id:11895,m:"Diagnostics.Label.Browser.Browser",t_a:[{t:"Browser:",l:"ENU"},{t:"Navegador:",l:"ESN"}]},{id:11896,m:"Diagnostics.Label.Browser.Type",t_a:[{t:"Type:",l:"ENU"},{t:"Tipo:",l:"ESN"}]},{id:11903,m:"Diagnostics.Label.Browser.Version",t_a:[{t:"Your Browser Version:",l:"ENU"}]},{id:11898,m:"Diagnostics.Label.Browser.MajorVersion",t_a:[{t:"Major Version:",l:"ENU"},{t:"Versin mayor:",l:"ESN"}]},{id:11899,m:"Diagnostics.Label.Browser.MinorVersion",t_a:[{t:"Minor Version:",l:"ENU"},{t:"Versin menor:",l:"ESN"}]},{id:11900,m:"Diagnostics.Label.Browser.Preferences",t_a:[{t:"Browser Preferences:",l:"ENU"},{t:"Preferencias de navegador:",l:"ESN"}]},{id:11901,m:"Diagnostics.Label.Browser.IP",t_a:[{t:"IP Address:",l:"ENU"},{t:"Direccin IP:",l:"ESN"}]},{id:11902,m:"Diagnostics.Label.Browser.OSFullName",t_a:[{t:"Your Operating System:",l:"ENU"},{t:"Su sistema operativo:",l:"ESN"}]},{id:11904,m:"Diagnostics.Label.Browser.SecureBrowser",t_a:[{t:"Secure Browser:",l:"ENU"},{t:"Navegador seguro:",l:"ESN"}]},{id:11905,m:"Diagnostics.Label.NetworkDiagnostics",t_a:[{t:"Network Diagnostics:",l:"ENU"},{t:"Diagnsticos de la red:",l:"ESN"}]},{id:11906,m:"Diagnostics.Label.SelectTest",t_a:[{t:"Select Test:",l:"ENU"},{t:"Seleccione una prueba",l:"ESN"}]},{id:11907,m:"Diagnostics.Label.PleaseSelectTest",t_a:[{t:"Please select a Test",l:"ENU"},{t:"Por favor seleccione una prueba",l:"ESN"}]},{id:11908,m:"Diagnostics.Label.TotalNumberOfStudentsTakingTest",t_a:[{t:"Enter the total number of students you would like to test at one time:",l:"ENU"},{t:"Ingrese el nmero total de estudiantes que le gustara ensayar a la vez:",l:"ESN"}]},{id:11909,m:"Diagnostics.Label.PleaseEnterTotalNumberOfStudentsTakingTest",t_a:[{t:"Enter the total number of students you would like to test at one time:",l:"ENU"},{t:"Ingrese el nmero total de estudiantes que le gustara ensayar a la vez:",l:"ESN"}]},{id:11910,m:"Diagnostics.Label.DownloadResults",t_a:[{t:"Download Results:",l:"ENU"},{t:"Resultados de descarga:",l:"ESN"}]},{id:11911,m:"Diagnostics.Label.UploadResults",t_a:[{t:"Upload Results:",l:"ENU"},{t:"Resultados de cargue:",l:"ESN"}]},{id:11912,m:"Diagnostics.Label.BandwidthSummary",t_a:[{t:"Bandwidth Summary:",l:"ENU"},{t:"Resumen del ancho de banda:",l:"ESN"}]},{id:11913,m:"Diagnostics.Label.FlashVersion",t_a:[{t:"Flash Version:",l:"ENU"},{t:"Versin de Flash:",l:"ESN"}]},{id:11914,m:"Diagnostics.Label.Loading",t_a:[{t:"Loading...",l:"ENU"},{t:"Cargando ",l:"ESN"}]},{id:11915,m:"Diagnostics.Label.FlashMinVersion",t_a:[{t:"(version 10 or higher required)",l:"ENU"},{t:"(versin 10 o superior requerida)",l:"ESN"}]},{id:11916,m:"Diagnostics.Label.JREVersion",t_a:[{t:"JRE Version:",l:"ENU"},{t:"Versin JRE:",l:"ESN"}]},{id:11917,m:"Diagnostics.Label.JREMinVersion",t_a:[{t:"(version 1.4 or higher required)",l:"ENU"},{t:"(versin 1.4 o superior requerida)",l:"ESN"}]},{id:11918,m:"Diagnostics.Label.RunNetworkDiagnosticsTests",t_a:[{t:"Run Network Diagnostics Tests",l:"ENU"},{t:"Ejecutar diagnsticos de red ",l:"ESN"}]},{id:11919,m:"Diagnostics.Label.ReturnToLogin",t_a:[{t:"Return to Login",l:"ENU"},{t:"Volver a inicio",l:"ESN"}]},{id:11920,m:"Diagnostics.Label.ELPACheck",t_a:[{t:"ELPA Check",l:"ENU"},{t:"Compruebe ELPA",l:"ESN"}]},{id:11921,m:"Diagnostics.Label.TTSCheck",t_a:[{t:"TTS Check",l:"ENU"},{t:"Compruebe de texto a voz",l:"ESN"}]},{id:11658,m:"ReviewShell.Message.PageFirst",t_a:[{t:"Please select an option from the list to review.",l:"ENU"},{t:"Seleccionar una opcin de la lista para revisar.",l:"ESN"}]},{id:11660,m:"ReviewShell.Message.SubmitTest",t_a:[{t:"Are you sure you want to submit the test?",l:"ENU"},{t:"Ests seguro de que quieres enviar la prueba?",l:"ESN"}]},{id:11687,m:"TestShell.UI.WaitNextPage",t_a:[{t:"Waiting for the next page.",l:"ENU"},{t:"Esperando la siguiente pgina.",l:"ESN"}]},{id:11688,m:"TestShell.UI.LoadingContent",t_a:[{t:"Loading the page content.",l:"ENU"},{t:"Cargando el contenido de la pgina.",l:"ESN"}]},{id:11689,m:"TestShell.UI.WaitSegmentApproval",t_a:[{t:"Waiting for segment approval.",l:"ENU"},{t:"Esperando la aprobacin del segmento.",l:"ESN"}]},{id:11690,m:"Messages.Label.XHRError",t_a:[{t:"Click [Yes] to try again or [No] to log out.",l:"ENU"},{t:"Seleccionar [S] para volver a intentarlo o [No] para cerrar la sesin.",l:"ESN"}]},{id:11691,m:"TestShell.Label.ErrorLoggedOut",t_a:[{t:"A problem was encountered while processing the request. You will be logged out.",l:"ENU"},{t:"Se detect un problema al procesar la solicitud. Se cerrar tu sesin.",l:"ESN"}]},{id:11693,m:"TDSShellObjectsJS.Label.PageLabel",t_a:[{t:"page ",l:"ENU"},{t:"pgina",l:"ESN"}]},{id:11702,m:"TDSContentJS.Label.StartSpeaking",t_a:[{t:"Start Speaking",l:"ENU"},{t:"Comenzar a hablar",l:"ESN"}]},{id:11714,m:"Global.Label.GoBack",t_a:[{t:"Go Back",l:"ENU"},{t:"Volver",l:"ESN"}]},{id:11724,m:"Global.Label.Submit",t_a:[{t:"Enviar",l:"ESN"}]},{id:11727,m:"Global.Label.Select",t_a:[{t:"Select",l:"ENU"},{t:"Seleccionar",l:"ESN"}]},{id:11737,m:"Diagnostics.Label.Disclaimer",t_a:[{t:"(Please note: The throughput estimates include the encryption/decryption overhead for data transfer. Throughput estimates change as the network conditions change and can vary from run to run.)",l:"ENU"},{t:"(Nota: Las estimaciones de rendimiento incluyen la sobrecarga de cifrado/descifrado para la transferencia de datos. Las estimaciones de rendimiento cambian a medida que las condiciones de la red cambian y pueden variar de una ejecucin a otra.)",l:"ESN"}]},{id:11738,m:"Diagnostics.Label.RiskUnknown",t_a:[{t:"Unable to complete analysis. Please contact the help desk.",l:"ENU"},{t:"No se puede completar el anlisis. Por favor, contactar el puesto de informaciones.",l:"ESN"}]},{id:11739,m:"Diagnostics.Label.RiskNearCertain",t_a:[{t:"Given the current load on your system, you cannot successfully test the requested number of students at this location. Please try a number close to {0}.",l:"ENU"},{t:"Dada la carga actual en el sistema, no puede probar con xito el nmero requerido de estudiantes en este sitio. Por favor, intente un nmero cercano a {0}.",l:"ESN"}]},{id:11740,m:"Diagnostics.Label.RiskHigh",t_a:[{t:"Given the current load on your system, it is unlikely you will successfully test the requested number of students at this location. Some students can experience disruptions or delays. Please try a number close to {0}.",l:"ENU"},{t:"Dada la carga actual en el sistema, es poco probable que se pruebe con xito el nmero requerido de estudiantes en este sitio. Algunos estudiantes pueden sufrir interrupciones o demoras. Por favor, intente un nmero cercano a {0}.",l:"ESN"}]},{id:11741,m:"Diagnostics.Label.RiskModerate",t_a:[{t:"Given the current load on your system, you should be able to test the requested number of students at this location. You are near capacity for this location.",l:"ENU"},{t:"Dada la carga actual en su sistema, usted debe ser capaz de probar el nmero solicitado de estudiantes en este sitio. Usted est cerca de su capacidad para esta localidad.",l:"ESN"}]},{id:11742,m:"Diagnostics.Label.RiskVeryLow",t_a:[{t:"Given the current load on your system, you should be able to test the requested number of students at this location.",l:"ENU"},{t:"Dada la carga actual en su sistema, usted debe ser capaz de probar el nmero solicitado de estudiantes en este sitio.",l:"ESN"}]},{id:11459,m:"TDSShellObjectsJS.Label.Marked",t_a:[{t:"marked",l:"ENU"},{t:"marcado",l:"ESN"}]},{id:11892,m:"Diagnostics.Label.IntroText",t_a:[{t:'<p>This page allows you to check the <strong>current</strong> bandwidth of your network. The following operating systems and web browsers are supported: </p>  <ul>  <li>Windows XP, Vista: Firefox 10-36, Chrome 31-42</li> <li>Windows 7, 8.0: Firefox 10-36, Chrome 31-42, IE 10-11</li> <li>Windows 8.1: Firefox 10-36, Chrome 31-42,IE 11</li> <li>Windows 8.0 Pro, 8.0 RT: IE 10-11</li> <li>Mac OS 10.6: Firefox 10-36, Chrome 31-42, Safari 5</li> <li>Mac OS 10.7: Firefox 10-36, Chrome 31-42, Safari 5-6</li> <li>Mac OS 10.8: Firefox 10-36, Chrome 31-42, Safari 6</li> <li>Mac OS 10.9: Firefox 10-36, Chrome 31-42, Safari 7</li> <li>Mac OS 10.10: Firefox 10-36, Chrome 31-42, Safari 8</li> <li>Linux Fedora 19-21, OpenSUSE 13.1, Ubuntu (LTS) 12.04,14.04: Firefox 10-36, Chrome 31-42</li>    <li>Apple tablets (iPad) running iOS 6: Safari 6, iOS 7: Safari 7, iOS 8: Safari 8</li>  <li>Android tablets running 4.0.4-5.0: Chrome 31-42</li> <li>ChromeOS: Chrome31-42</li> </ul>       <p>To determine your bandwidth, select a test from the drop-down list and enter the maximum number of students likely to test at one time, then click [Run Network Diagnostics Tests].  </p>     <p>The [<strong>Text-to-Speech Check</strong>] is for schools who will be administering the Field test and requires the use of the secure browser. The secure browser is available from <a target="_blank" href="ftp://ftps.smarterbalanced.org/~sbacpublic/Public/SecureBrowsers/">ftp://ftps.smarterbalanced.org/~sbacpublic/Public/SecureBrowsers/</a>.  </p>',l:"ENU"},{t:'<p>This page allows you to check the <strong>current</strong> bandwidth of your network. The following operating systems and web browsers are supported: </p>  <ul>  <li>Windows XP, Vista: Firefox 10-36, Chrome 31-42</li> <li>Windows 7, 8.0: Firefox 10-36, Chrome 31-42, IE 10-11</li> <li>Windows 8.1: Firefox 10-36, Chrome 31-42,IE 11</li> <li>Windows 8.0 Pro, 8.0 RT: IE 10-11</li> <li>Mac OS 10.6: Firefox 10-36, Chrome 31-42, Safari 5</li> <li>Mac OS 10.7: Firefox 10-36, Chrome 31-42, Safari 5-6</li> <li>Mac OS 10.8: Firefox 10-36, Chrome 31-42, Safari 6</li> <li>Mac OS 10.9: Firefox 10-36, Chrome 31-42, Safari 7</li> <li>Mac OS 10.10: Firefox 10-36, Chrome 31-42, Safari 8</li> <li>Linux Fedora 19-21, OpenSUSE 13.1, Ubuntu (LTS) 12.04,14.04: Firefox 10-36, Chrome 31-42</li>    <li>Apple tablets (iPad) running iOS 6: Safari 6, iOS 7: Safari 7, iOS 8: Safari 8</li>  <li>Android tablets running 4.0.4-5.0: Chrome 31-42</li> <li>ChromeOS: Chrome31-42</li> </ul>      <p>To determine your bandwidth, select a test from the drop-down list and enter the maximum number of students likely to test at one time, then click [Run Network Diagnostics Tests].  </p>     <p>The [<strong>Text-to-Speech Check</strong>] is for schools who will be administering the Field test and requires the use of the secure browser. The secure browser is available from <a target="_blank" href="ftp://ftps.smarterbalanced.org/~sbacpublic/Public/SecureBrowsers/">ftp://ftps.smarterbalanced.org/~sbacpublic/Public/SecureBrowsers/</a>.  </p>',l:"ENU"}]},{id:12239,m:"Global.Path.Help.Streamlined",t_a:[{t:"../Projects/SBAC/Help/help_streamlined.html",l:"ENU"},{t:"../Projects/SBAC/Help/help_streamlined.html",l:"ENU"}]},{id:10906,m:"IdleTimeout",t_a:[{t:"Are you still there? Click OK to continue or you will be logged out in {1} seconds.",l:"ENU"},{t:"An se encuentra all? Haga clic en Aceptar para continuar o se cerrar la sesin en {1} segundos.",l:"ESN"}]},{id:11479,m:"Global.Prompt.Button.TryAgain",t_a:[{t:"Try Again",l:"ENU"},{t:"Intentar nuevamente",l:"ESN"}]},{id:11480,m:"Global.Prompt.Button.KeepIt",t_a:[{t:"Keep  It",l:"ENU"},{t:"Conservar",l:"ESN"}]},{id:11489,m:"Global.Label.LoadingNextPage",t_a:[{t:"Getting the next page.",l:"ENU"},{t:"Buscando la prxima pgina.",l:"ESN"}]},{id:11490,m:"Global.Label.LoadingPageContent",t_a:[{t:"Loading the page content.",l:"ENU"},{t:"Cargando el contenido de la pgina.",l:"ESN"}]},{id:11525,m:"Global.Button.Submit",t_a:[{t:"Submit",l:"ENU"},{t:"Enviar",l:"ESN"}]},{id:11526,m:"Global.Button.Cancel",t_a:[{t:"Cancel",l:"ENU"},{t:"Cancelar",l:"ESN"}]},{id:11563,m:"Global.Error.CommunicationProblem",t_a:[{t:"There was an error communicating with the server. Please try again.",l:"ENU"},{t:"Se produjo un error de comunicacin con el servidor. Intntelo de nuevo.",l:"ESN"}]},{id:11565,m:"Global.Label.Logout",t_a:[{t:"Log Out",l:"ENU"},{t:"Cerrar sesin",l:"ESN"}]},{id:11233,m:"Global.Label.Warning",t_a:[{t:"Warning",l:"ENU"},{t:"Aviso",l:"ESN"}]},{id:11246,m:"Global.Label.OK",t_a:[{t:"OK",l:"ENU"},{t:"Aceptar",l:"ESN"}]},{id:11247,m:"Global.Label.No",t_a:[{t:"No",l:"ENU"},{t:"No ",l:"ESN"}]},{id:11248,m:"Global.Label.Yes",t_a:[{t:"Yes",l:"ENU"},{t:"S",l:"ESN"}]},{id:11249,m:"Global.Label.PleaseWait",t_a:[{t:"Please wait ",l:"ENU"},{t:"Espere",l:"ESN"}]},{id:10884,m:"Global.Path.Help",t_a:[{t:"../Projects/SBAC/Help/help.html",l:"ENU"},{t:"../Projects/SBAC/Help/help_esn.html",l:"ESN"}]},{id:11700,m:"Global.Label.SSID",t_a:[{t:"State-SSID",l:"ENU"},{t:"State-SSID",l:"ENU"}]},{id:11126,m:"TDSContentJS.Label.StopSpeaking",t_a:[{t:"Stop Speaking",l:"ENU"},{t:"Deje de hablar",l:"ESN"}]},{id:11180,m:"TDSTimeoutJS.Label.Idle",t_a:[{t:"Idle Timeout",l:"ENU"},{t:"Tiempo de espera inactivo",l:"ESN"}]}]},{c:"grid.js",m_a:[{id:11181,m:"GridJS.Label.HintSetPoint",t_a:[{t:"Select locations of points.",l:"ENU"},{t:"Seleccione las ubicaciones de los puntos.",l:"ESN"}]},{id:11182,m:"GridJS.Label.HintConnect",t_a:[{t:"Select two (2) points to connect or press and drag to create and connect points.",l:"ENU"},{t:"Seleccione 2 puntos para conectar o presione y arrastre para crear y conectar puntos.",l:"ESN"}]},{id:11183,m:"GridJS.Label.HintArrow",t_a:[{t:"Select two (2) points to connect with the arrow.",l:"ENU"},{t:"Seleccione 2 puntos para conectar con una flecha.",l:"ESN"}]},{id:11184,m:"GridJS.Label.HintDoubleArrow",t_a:[{t:"Select two (2) points to connect with the double arrow.",l:"ENU"},{t:"Seleccione 2 puntos para conectar con una flecha doble.",l:"ESN"}]},{id:11185,m:"GridJS.Label.HintDelete",t_a:[{t:"Select an object to remove.",l:"ENU"},{t:"Seleccione el objeto que desee eliminar.",l:"ESN"}]},{id:11186,m:"GridJS.Label.HintAddValue",t_a:[{t:"Select a point or edge to add value.",l:"ENU"},{t:"Seleccione un punto o borde para agregar valor.",l:"ESN"}]},{id:11187,m:"GridJS.Label.HintAddLabel",t_a:[{t:"Select the location for the label.",l:"ENU"},{t:"Seleccione la ubicacin de la etiqueta.",l:"ESN"}]},{id:11188,m:"GridJS.Label.HintMotionPending",t_a:[{t:"Move the object to a new location and click the mouse button to place the object.",l:"ENU"},{t:"Mueva el objeto a una nueva ubicacin y haga clic donde desee colocarlo.",l:"ESN"}]},{id:11189,m:"GridJS.Label.HintDraggingObject",t_a:[{t:"Release the mouse button to place the object where you want it.",l:"ENU"},{t:"Libere el botn del mouse para soltarlo donde desee colocarlo.",l:"ESN"}]},{id:11190,m:"GridJS.Label.HintWaitForDropDragging",t_a:[{t:"Release the mouse button to drop the object where you want it.",l:"ENU"},{t:"Suelta el ratn para dejar el objeto en la posicin  preferida.",l:"ESN"}]},{id:11191,m:"GridJS.Label.HintWaitForDrop",t_a:[{t:"Click the mouse button to drop the object where you want it.",l:"ENU"},{t:"Haga clic para soltar el objeto donde desee colocarlo.",l:"ESN"}]},{id:11192,m:"GridJS.Label.HintNone",t_a:[{t:"",l:"ENU"},{t:"",l:"ENU"}]},{id:11218,m:"GridSVG.Label.button_Delete",t_a:[{t:"Delete",l:"ENU"},{t:"Borrar",l:"ESN"}]},{id:11219,m:"GridSVG.Label.button_Add_Point",t_a:[{t:"Add Point",l:"ENU"},{t:"Agregar punto",l:"ESN"}]},{id:11220,m:"GridSVG.Label.button_Connect_Line",t_a:[{t:"Connect Line",l:"ENU"},{t:"Conectar lnea",l:"ESN"}]},{id:11221,m:"GridSVG.Label.button_Add_Arrow",t_a:[{t:"Add Arrow",l:"ENU"},{t:"Agregar flecha",l:"ESN"}]},{id:11237,m:"GridJS.Label.HintAddComponent",t_a:[{t:"",l:"ENU"},{t:"",l:"ENU"}]},{id:12230,m:"GridSVG.Label.button_Circle",t_a:[{t:"Add Circle",l:"ENU"},{t:"Agregar crculo",l:"ESN"}]},{id:12231,m:"GridSVG.Label.button_Connect_Dash",t_a:[{t:"Connect Dash",l:"ENU"},{t:"Conectar guin",l:"ESN"}]},{id:12366,m:"GridJS.Label.HintDraggingPaletteObject",t_a:[{t:"Release or click the mouse button to place the object where you want it.",l:"ENU"},{t:"Release or click the mouse button to place the object where you want it.",l:"ENU"}]}]},{c:"Layout_1.ascx",m_a:[{id:11349,m:"Layout1.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11350,m:"Layout1.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11351,m:"Layout1.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11352,m:"Layout1.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11353,m:"Layout1.HyperLink.CloseComment",t_a:[{t:"Close Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_11.ascx",m_a:[{id:11354,m:"Layout11.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11355,m:"Layout11.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11356,m:"Layout11.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11357,m:"Layout11.HyperLink.CloseComment",t_a:[{t:"Close Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]},{id:11358,m:"Layout11.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]}]},{c:"Layout_12.ascx",m_a:[{id:11359,m:"Layout12.HyperLink.ExpandAllPrompts",t_a:[{t:"Expand  All Prompts",l:"ENU"},{t:"Expandir todos los ejercicios",l:"ESN"}]},{id:11360,m:"Layout12.HyperLink.CollapseAllPrompts",t_a:[{t:"Collapse All Prompts",l:"ENU"},{t:"Contraer todos los ejercisios",l:"ESN"}]},{id:11361,m:"Layout12.HyperLink.StartWriting",t_a:[{t:"Start  Writing on Selected Prompt",l:"ENU"},{t:"Empezar a escribir sobre el ejercicio seleccionado",l:"ESN"}]},{id:11362,m:"Layout12.HyperLink.ChangePrompt",t_a:[{t:"Change Prompt",l:"ENU"},{t:"Cambiar ejercicio",l:"ESN"}]}]},{c:"Layout_12_Unit.ascx",m_a:[{id:11363,m:"Layout12Unit.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11364,m:"Layout12Unit.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11365,m:"Layout12Unit.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11366,m:"Layout12Unit.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11367,m:"Layout12Unit.HyperLink.ChangePrompt",t_a:[{t:"Change<br />Prompt",l:"ENU"},{t:"Cambiar <br/>ejercicio",l:"ESN"}]},{id:11368,m:"Layout12Unit.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_13.ascx",m_a:[{id:11369,m:"Layout13.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11370,m:"Layout13.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11371,m:"Layout13.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11372,m:"Layout13.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11373,m:"Layout13.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_14.ascx",m_a:[{id:11374,m:"Layout14.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11375,m:"Layout14.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11376,m:"Layout14.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11377,m:"Layout14.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11378,m:"Layout14.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_15.ascx",m_a:[{id:11379,m:"Layout15.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11380,m:"Layout15.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11381,m:"Layout15.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11382,m:"Layout15.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11383,m:"Layout15.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_16.ascx",m_a:[{id:11384,m:"Layout16.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11385,m:"Layout16.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11386,m:"Layout16.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11387,m:"Layout16.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11388,m:"Layout16.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_17.ascx",m_a:[{id:11389,m:"Layout17.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11390,m:"Layout17.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11391,m:"Layout17.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11392,m:"Layout17.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11393,m:"Layout17.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_18.ascx",m_a:[{id:11394,m:"Layout18.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11395,m:"Layout18.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11396,m:"Layout18.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11397,m:"Layout18.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11398,m:"Layout18.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_19.ascx",m_a:[{id:11399,m:"Layout19.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11400,m:"Layout19.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11401,m:"Layout19.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11402,m:"Layout19.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11403,m:"Layout19.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_2.ascx",m_a:[{id:11404,m:"Layout2.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11405,m:"Layout2.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11406,m:"Layout2.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11407,m:"Layout2.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11408,m:"Layout2.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_21.ascx",m_a:[{id:11409,m:"Layout21.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11410,m:"Layout21.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11411,m:"Layout21.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11412,m:"Layout21.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11413,m:"Layout21.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_22.ascx",m_a:[{id:11414,m:"Layout22.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11415,m:"Layout22.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11416,m:"Layout22.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11417,m:"Layout22.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11418,m:"Layout22.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_3.ascx",m_a:[{id:11419,m:"Layout3.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11420,m:"Layout3.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11421,m:"Layout3.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11422,m:"Layout3.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11423,m:"Layout3.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_4.ascx",m_a:[{id:11424,m:"Layout4.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11425,m:"Layout4.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11426,m:"Layout4.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11427,m:"Layout4.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11428,m:"Layout4.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_5.ascx",m_a:[{id:11429,m:"Layout5.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11430,m:"Layout5.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11431,m:"Layout5.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11432,m:"Layout5.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11433,m:"Layout5.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_6.ascx",m_a:[{id:11434,m:"Layout6.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11435,m:"Layout6.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11436,m:"Layout6.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11437,m:"Layout6.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11438,m:"Layout6.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_7.ascx",m_a:[{id:11439,m:"Layout7.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11440,m:"Layout7.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11441,m:"Layout7.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11442,m:"Layout7.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11443,m:"Layout7.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]}]},{c:"Layout_8.ascx",m_a:[{id:11444,m:"Layout8.HyperLink.ItemTutorial",t_a:[{t:"Item Tutorial",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11445,m:"Layout8.HyperLink.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11446,m:"Layout8.HyperLink.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Someter un comentario para este tem.",l:"ESN"}]},{id:11447,m:"Layout8.HyperLink.MarkReview",t_a:[{t:"Mark Item for Review",l:"ENU"},{t:"Marcar Item para Revisar",l:"ESN"}]},{id:11448,m:"Layout8.HyperLink.CloseComment",t_a:[{t:"Close  Comment",l:"ENU"},{t:"Cerrar Comentario",l:"ESN"}]},{id:11449,m:"Layout8.HyperLink.TutorialPath",t_a:[{t:"Tutorial",l:"ENU"},{t:"Tutorial",l:"ESN"}]}]},{c:"Layouts",m_a:[{id:11564,m:"LayoutWriting.Label.ScoringHelpMessage",t_a:[{t:'<span style="font-weight:bold; ">Papers may not be scored if the paper:</span> is so short that scores would be meaningless, is blank, is written in a language other than English, is written in the form of poetry or drama, is plagiarized from other sources, is not written to one of the provided topics, or contains profanity or graphic violence beyond usual community standards for school writing.',l:"ENU"},{t:'<span style="font-weight:bold; ">Es posible que el examen no reciba calificacin si:</span> es tan breve que una calificacin sera irrelevante, est en blanco, est escrito en otro idioma que no sea ingls, est escrito en forma de poesa o drama, es un plagio de otras fuentes, no corresponde a uno de los temas dados, o contiene blasfemias o violencia grfica que exceden los estndares habituales de la comunidad respecto a la escritura escolar.',l:"ESN"}]},{id:11464,m:"Layout.Link.SubmitComment",t_a:[{t:"Submit a comment for this item.",l:"ENU"},{t:"Agregar un comentario a este item",l:"ESN"}]},{id:11465,m:"LayoutWriting.Link.ExpandPrompt",t_a:[{t:"Click to Expand",l:"ENU"},{t:"Hacer clic para expandir",l:"ESN"}]},{id:11466,m:"LayoutWriting.Link.CollapsePrompt",t_a:[{t:"Click to Close",l:"ENU"},{t:"Hacer clic para cerrar",l:"ESN"}]},{id:11467,m:"LayoutWriting.Link.ExpandAllPrompts",t_a:[{t:"Expand  All Prompts",l:"ENU"},{t:"Expandir  todos los avisos",l:"ESN"}]},{id:11468,m:"LayoutWriting.Link.CollapseAllPrompts",t_a:[{t:"Collapse All Prompts",l:"ENU"},{t:"Contraer todos los ejercisios.",l:"ESN"}]},{id:11469,m:"LayoutWriting.Link.StartWriting",t_a:[{t:"Start Writing on Selected Prompt",l:"ENU"},{t:"Comenzar a escribir en el aviso seleccionado",l:"ESN"}]},{id:11470,m:"LayoutWriting.Link.ChangePrompt",t_a:[{t:"Change Prompt",l:"ENU"},{t:"Cambiar aviso",l:"ESN"}]},{id:11471,m:"LayoutWriting.Link.ChangeConfirm",t_a:[{t:"Are you sure you want to change the prompt you previously selected?",l:"ENU"},{t:"Est seguro que desea cambiar el ejercisio previamente seleccionado?",l:"ESN"}]}]},{c:"Opportunity.aspx",m_a:[{id:11251,m:"Opportunity.Label.Validating",t_a:[{t:"Validating test",l:"ENU"},{t:"Validando prueba",l:"ESN"}]}]},{c:"Simulator2.js",m_a:[{id:12279,m:"Simulator.Animation.MissingAltText",t_a:[{t:"Animation alt text not found.",l:"ENU"},{t:"Animation alt text not found.",l:"ENU"}]}]},{c:"SoundCheck.aspx",m_a:[{id:12227,m:"SoundCheck.Label.SelectRecordingSource",t_a:[{t:"Recording Input Device Selection",l:"ENU"},{t:"Recording Input Device Selection",l:"ENU"}]},{id:12228,m:"SoundCheck.Label.SourceSelectWait",t_a:[{t:"Finding recording input devices, please wait.",l:"ENU"},{t:"Finding recording input devices, please wait.",l:"ENU"}]},{id:12229,m:"SoundCheck.Label.SourceSelectInstructions",t_a:[{t:"Please speak and select the recording input device which best detects your voice, and then click [Yes].<br />\r\nIf there are no devices, or if none of the devices detects your voice, click [Problem (No)].",l:"ENU"},{t:"Please speak and select the recording input device which best detects your voice, and then click [Yes].<br />\r\nIf there are no devices, or if none of the devices detects your voice, click [Problem (No)].",l:"ENU"}]},{id:12233,m:"SoundCheck.Label.RecordingErrorMessage",t_a:[{t:"There appears to be a problem with recording audio on this device.  You try a different recording device by clicking [Select New Recording Device] below.  If youd like to try again with the current device click [Try Again].",l:"ENU"},{t:"There appears to be a problem with recording audio on this device.  You try a different recording device by clicking [Select New Recording Device] below.  If youd like to try again with the current device click [Try Again].",l:"ENU"}]}]},{c:"tds_audio.js",m_a:[{id:11692,m:"TDSAudioJS.Label.AddMenuPlayInstruction",t_a:[{t:"Play Instructions",l:"ENU"},{t:"Reproducir instrucciones",l:"ESN"}]},{id:11166,m:"TDSAudioJS.Label.AudioOption",t_a:[{t:"Audio Option ",l:"ENU"},{t:"Opcin de audio ",l:"ESN"}]},{id:11167,m:"TDSAudioJS.Label.AudioQuestion",t_a:[{t:"Audio Question",l:"ENU"},{t:"Pregunta de audio",l:"ESN"}]},{id:11168,m:"TDSAudioJS.Label.AudioStem",t_a:[{t:"Audio Stem",l:"ENU"},{t:"Recurso de audio",l:"ESN"}]},{id:11169,m:"TDSAudioJS.Label.Stop",t_a:[{t:"Stop",l:"ENU"},{t:"Detener",l:"ESN"}]},{id:11170,m:"TDSAudioJS.Label.Play",t_a:[{t:"Play",l:"ENU"},{t:"Reproducir",l:"ESN"}]},{id:11171,m:"TDSAudioJS.Label.AddMenuQuestion",t_a:[{t:"Question",l:"ENU"},{t:"Pregunta",l:"ESN"}]},{id:11172,m:"TDSAudioJS.Label.AddMenuOption",t_a:[{t:"Option",l:"ENU"},{t:"Opcin",l:"ESN"}]},{id:11173,m:"TDSAudioJS.Label.StopRecording",t_a:[{t:"Stop Recording",l:"ENU"},{t:"Detener grabacin",l:"ESN"}]},{id:11174,m:"TDSAudioJS.Label.StopPlayRecording",t_a:[{t:"Stop Playing Recording",l:"ENU"},{t:"Detener reproduccin de grabacin",l:"ESN"}]},{id:11175,m:"TDSAudioJS.Label.PlayRecording",t_a:[{t:"Play Recording",l:"ENU"},{t:"Reproducir grabacin",l:"ESN"}]}]},{c:"tds_common.js",m_a:[{id:11122,m:"TDSCommonJS.Label.Loading",t_a:[{t:"Loading, please wait...",l:"ENU"},{t:"Cargando, espere...",l:"ESN"}]}]},{c:"tds_content.js",m_a:[{id:11127,m:"TDSContentJS.Label.Highlight",t_a:[{t:"Highlight Selection",l:"ENU"},{t:"Resaltar seleccin",l:"ESN"}]},{id:11128,m:"TDSContentJS.Label.ResetHighlight",t_a:[{t:"Reset Highlighting",l:"ENU"},{t:"Restablecer resaltado",l:"ESN"}]},{id:11238,m:"TDSContentJS.Label.SpeakSelected",t_a:[{t:"Speak Selected Text",l:"ENU"},{t:"Leer el texto seleccionado",l:"ESN"}]},{id:11125,m:"TDSContentJS.Label.SpealSelected",t_a:[{t:"Speak Selected Text",l:"ENU"},{t:"Diga el texto seleccionado",l:"ESN"}]},{id:12301,m:"TDSContentJS.Label.QuestionRequired",t_a:[{t:"Required: Question Number",l:"ENU"},{t:"Required: Question Number",l:"ENU"}]},{id:12302,m:"TDSContentJS.Label.QuestionOptional",t_a:[{t:"Question Number",l:"ENU"},{t:"Question Number",l:"ENU"}]}]},{c:"tds_content_events.js",m_a:[{id:12277,m:"TDSContentEventsJS.Label.ResetItems",t_a:[{t:"Item Response Reset",l:"ENU"}]},{id:12225,m:"TDSContentEventsJS.Label.PrintPage",t_a:[{t:"Print Page",l:"ENU"}]},{id:12223,m:"TDSContentEventsJS.Label.EmptyMenu",t_a:[{t:"No options available",l:"ENU"},{t:"No opciones disponibles",l:"ESN"}]},{id:12226,m:"TDSContentEventsJS.Label.GTRItem",t_a:[{t:"Open Guide for Revision",l:"ENU"},{t:"Open Guide for Revision",l:"ENU"}]},{id:11967,m:"TDSContentEventJS.Label.ASLItem",t_a:[{t:"American Sign Language",l:"ENU"},{t:"American Sign Language",l:"ENU"}]},{id:11225,m:"TDSContentEventsJS.Label.PrintItem",t_a:[{t:"Print Item",l:"ENU"},{t:"Imprimir item",l:"ESN"}]},{id:11226,m:"TDSContentEventsJS.Label.HelpItem",t_a:[{t:"Tutorial",l:"ENU"},{t:"Tutorial",l:"ESN"}]},{id:11235,m:"TDSContentEventsJS.Label.PrintPassage",t_a:[{t:"Print Passage",l:"ENU"},{t:"Imprimir el artculo",l:"ESN"}]},{id:11245,m:"TDSContentEventsJS.Label.UnmarkForReview",t_a:[{t:"Unmark Review Item",l:"ENU"},{t:"Desmarcar el artculo de revisin",l:"ESN"}]},{id:11462,m:"TDSContentEventsJS.Label.CloseComment",t_a:[{t:"Close",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:11457,m:"TDSContentEventsJS.Link.EnableTextSelection",t_a:[{t:"Enable Text Selection",l:"ENU"},{t:"Permitir la seleccin de texto",l:"ESN"}]},{id:11458,m:"TDSContentEventsJS.Link.DisableTextSelection",t_a:[{t:"Disable Text Selection",l:"ENU"},{t:"No permitir la seleccin de texto",l:"ESN"}]},{id:11123,m:"TDSContentEventsJS.Label.MarkForReview",t_a:[{t:"Mark for Review",l:"ENU"},{t:"Marcar para revisin",l:"ESN"}]},{id:11124,m:"TDSContentEventsJS.Label.Comment",t_a:[{t:"Comment",l:"ENU"},{t:"Comentario",l:"ESN"}]},{id:12224,m:"TDSContentEventsJS.Label.ResetItem",t_a:[{t:"Item Response Reset",l:"ENU"},{t:"Reset Question",l:"ENU"}]}]},{c:"tds_grid.js",m_a:[{id:11176,m:"TDSGridJS.Label.Error",t_a:[{t:"Problem",l:"ENU"},{t:"Problema",l:"ESN"}]},{id:11177,m:"TDSGridJS.Label.ErrorConnecting",t_a:[{t:"There is a problem connecting to the Internet. Pause your test and try again.",l:"ENU"},{t:"Se produjo un problema al conectarse con Internet. Ponga la prueba en pausa e intntelo nuevamente.",l:"ESN"}]}]},{c:"tds_mc.js",m_a:[{id:11024,m:"TDSMC.MenuLabel.UndoStrikethrough",t_a:[{t:"Undo Strikethrough",l:"ENU"},{t:"Deshacer tachado",l:"ESN"}]},{id:11025,m:"TDSMC.MenuLabel.Strikethrough",t_a:[{t:"Strikethrough",l:"ENU"},{t:"Tachado",l:"ESN"}]}]},{c:"tds_shell.js",m_a:[{id:11129,m:"TDSShellJS.Label.PauseTest",t_a:[{t:"Are you sure you want to pause the test?",l:"ENU"},{t:"Est seguro de que desea poner la prueba en pausa?",l:"ESN"}]},{id:11130,m:"TDSShellJS.Label.PauseTest20Minues",t_a:[{t:"Are you sure you want to pause the test? If you pause your test for more than {0} minutes, you may be unable to make changes to questions that you have already answered. Ask your Test Administrator before pausing your test.",l:"ENU"},{t:"Est seguro de que desea detener la prueba? Si se detiene la prueba por ms de {0} minutos, usted quizs no pueda hacer cambios a las preguntas que usted ya ha contestado. Consulte a su administrador de prueba antes de pausar la prueba.",l:"ESN"}]},{id:11131,m:"TDSShellJS.Label.Tutorial",t_a:[{t:"Tutorial",l:"ENU"},{t:"Tutorial",l:"ESN"}]},{id:11475,m:"TDSAudioJS.Label.StartRecording",t_a:[{t:"Start Recording",l:"ENU"},{t:"Comenzar la grabacin",l:"ESN"}]}]},{c:"tds_shell_objects.js",m_a:[{id:11132,m:"TDSShellObjectsJS.Label.Error",t_a:[{t:"Problem",l:"ENU"},{t:"Problema",l:"ESN"}]},{id:11133,m:"TDSShellObjectsJS.Label.Warning",t_a:[{t:"Attention",l:"ENU"},{t:"Atencin",l:"ESN"}]},{id:11134,m:"TDSShellObjectsJS.Label.SaveBeforePrint",t_a:[{t:"Save your work before making a print request.",l:"ENU"},{t:"Guarde el trabajo antes de enviar una solicitud de impresin.",l:"ESN"}]}]},{c:"tds_shell_ui.js",m_a:[{id:11135,m:"TDSShellUIJS.Label.Warning",t_a:[{t:"Attention",l:"ENU"},{t:"Atencin",l:"ESN"}]},{id:11136,m:"TDSShellUIJS.Label.WaitForGridToLoad",t_a:[{t:"Loading, please wait...",l:"ENU"},{t:"Cargando, espere...",l:"ESN"}]},{id:11137,m:"TDSShellUIJS.Label.Notice",t_a:[{t:"Attention",l:"ENU"},{t:"Atencin",l:"ESN"}]},{id:11138,m:"TDSShellUIJS.Label.Error",t_a:[{t:"Problem",l:"ENU"},{t:"Problema",l:"ESN"}]},{id:11139,m:"TDSShellUIJS.Label.PrintRequestFailed",t_a:[{t:"There was a problem with your print request. Try again or ask your Test Administrator for help.",l:"ENU"},{t:"Se produjo un problema con la solicitud de impresin.  Intntelo nuevamente o consulte con el administrador de pruebas.",l:"ESN"}]},{id:11140,m:"TDSShellUIJS.Label.Debug",t_a:[{t:"Click here to send helpful information.",l:"ENU"},{t:"Haga clic aqu para enviar informacin til.",l:"ESN"}]},{id:11141,m:"TDSShellUIJS.Label.SendDebugToServer",t_a:[{t:"To send helpful information, describe what the problem is and click [Yes].",l:"ENU"},{t:"Para enviar informacin til, describa el problema y haga clic en [S].",l:"ESN"}]},{id:11252,m:"TDSShellUIJS.Label.OutOf",t_a:[{t:"out of",l:"ENU"},{t:"fuera de",l:"ESN"}]}]},{c:"tds_shell_xhr.js",m_a:[{id:11142,m:"TDSShellXHRJS.Label.Error",t_a:[{t:"Problem",l:"ENU"},{t:"Problema",l:"ESN"}]}]},{c:"tds_tts.js",m_a:[{id:11143,m:"TDSTTS.Label.SpeakTextPrimary",t_a:[{t:"Speak Selection",l:"ENU"},{t:"Diga la seleccin",l:"ESN"}]},{id:11144,m:"TDSTTS.Label.SpeakTextSecondary",t_a:[{t:"Hable la Seleccin",l:"ENU"},{t:"Seccin oral (en ingls)",l:"ESN"}]},{id:11145,m:"TDSTTS.Label.SpeakStemAndOptionsPrimary",t_a:[{t:"Speak Question and Options",l:"ENU"},{t:"Diga las preguntas y las opciones",l:"ESN"}]},{id:11146,m:"TDSTTS.Label.SpeakStemAndOptionsSecondary",t_a:[{t:"Hable las preguntas y las opciones",l:"ENU"},{t:"Preguntas y opciones orales (en ingls)",l:"ESN"}]},{id:11147,m:"TDSTTS.Label.StopSpeaking",t_a:[{t:"Stop speaking",l:"ENU"},{t:"Deje de hablar",l:"ESN"}]},{id:11148,m:"TDSTTS.Label.SpeakQuestionPrimary",t_a:[{t:"Speak Question",l:"ENU"},{t:"Diga la pregunta",l:"ESN"}]},{id:11149,m:"TDSTTS.Label.SpeakQuestionSecondary",t_a:[{t:"Hable la Pregunta",l:"ENU"},{t:"Pregunta oral (en ingls)",l:"ESN"}]},{id:11150,m:"TDSTTS.Label.SpeakOptionAPrimary",t_a:[{t:"Speak Option A",l:"ENU"},{t:"Diga la opcin A",l:"ESN"}]},{id:11151,m:"TDSTTS.Label.SpeakOptionASecondary",t_a:[{t:"Hable la Opcin A",l:"ENU"},{t:"Opcin oral A (en ingls)",l:"ESN"}]},{id:11152,m:"TDSTTS.Label.SpeakOptionBPrimary",t_a:[{t:"Speak Option B",l:"ENU"},{t:"Diga la opcin B",l:"ESN"}]},{id:11153,m:"TDSTTS.Label.SpeakOptionBSecondary",t_a:[{t:"Hable la Opcin B",l:"ENU"},{t:"Opcin oral B (en ingls)",l:"ESN"}]},{id:11154,m:"TDSTTS.Label.SpeakOptionCPrimary",t_a:[{t:"Speak Option C",l:"ENU"},{t:"Diga la opcin C",l:"ESN"}]},{id:11155,m:"TDSTTS.Label.SpeakOptionCSecondary",t_a:[{t:"Hable la Opcin C",l:"ENU"},{t:"Opcin oral C (en ingls)",l:"ESN"}]},{id:11156,m:"TDSTTS.Label.SpeakOptionDPrimary",t_a:[{t:"Speak Option D",l:"ENU"},{t:"Diga la opcin D",l:"ESN"}]},{id:11157,m:"TDSTTS.Label.SpeakOptionDSecondary",t_a:[{t:"Hable la Opcin D",l:"ENU"},{t:"Opcin oral D (en ingls)",l:"ESN"}]},{id:11158,m:"TDSTTS.Label.SpeakOptionEPrimary",t_a:[{t:"Speak Option E",l:"ENU"},{t:"Diga la opcin E",l:"ESN"}]},{id:11159,m:"TDSTTS.Label.SpeakOptionESecondary",t_a:[{t:"Hable la Opcin E",l:"ENU"},{t:"Opcin oral E (en ingls)",l:"ESN"}]},{id:11160,m:"TDSTTS.Label.SpeakOptionFPrimary",t_a:[{t:"Speak Option F",l:"ENU"},{t:"Diga la opcin F",l:"ESN"}]},{id:11161,m:"TDSTTS.Label.SpeakOptionFSecondary",t_a:[{t:"Hable la Opcin F",l:"ENU"},{t:"Opcin oral F (en ingls)",l:"ESN"}]},{id:11162,m:"TDSTTS.Label.SpeakPassagePrimary",t_a:[{t:"Speak Passage",l:"ENU"},{t:"Diga el pasaje",l:"ESN"}]},{id:11163,m:"TDSTTS.Label.SpeakPassageSecondary",t_a:[{t:"Hable el Paso",l:"ENU"},{t:"Texto oral (en ingls)",l:"ESN"}]},{id:11164,m:"TDSTTS.Label.SpeakIllustrationPrimary",t_a:[{t:"Speak Image",l:"ENU"},{t:"Diga la imagen",l:"ESN"}]},{id:11165,m:"TDSTTS.Label.SpeakIllustrationSecondary",t_a:[{t:"Speak Image",l:"ENU"},{t:"Ilustracin oral (en ingls)",l:"ESN"}]},{id:11476,m:"TDSTTS.Label.SpeakDirectionsPrimary",t_a:[{t:"Speak Instructions",l:"ENU"},{t:"Instrucciones orales (en ingls)",l:"ESN"}]},{id:11474,m:"TDSTTS.Label.SpeakPromptPrimary",t_a:[{t:"Speak Writing Prompt",l:"ENU"},{t:"Leer oralmente las instrucciones por escrito",l:"ESN"}]},{id:11948,m:"TDSTTS.Speak.OptionA.ENU",t_a:[{t:"{silence} A.{silence}",l:"ENU"},{t:"{silence} A.{silence}",l:"ENU"}]},{id:11949,m:"TDSTTS.Speak.OptionB.ENU",t_a:[{t:"{silence} B.{silence}",l:"ENU"},{t:"{silence} B.{silence}",l:"ENU"}]},{id:11950,m:"TDSTTS.Speak.OptionC.ENU",t_a:[{t:"{silence} C.{silence}",l:"ENU"},{t:"{silence} C.{silence}",l:"ENU"}]},{id:11951,m:"TDSTTS.Speak.OptionD.ENU",t_a:[{t:"{silence} D.{silence}",l:"ENU"},{t:"{silence} D.{silence}",l:"ENU"}]},{id:11952,m:"TDSTTS.Speak.OptionE.ENU",t_a:[{t:"{silence} E.{silence}",l:"ENU"},{t:"{silence} E.{silence}",l:"ENU"}]},{id:11953,m:"TDSTTS.Speak.OptionF.ENU",t_a:[{t:"{silence} F.{silence}",l:"ENU"},{t:"{silence} F.{silence}",l:"ENU"}]},{id:12094,m:"TDSTTS.Speak.OptionA.ESN",t_a:[{t:"{silence}Opcin A.{silence}",l:"ENU"}]},{id:12095,m:"TDSTTS.Speak.OptionB.ESN",t_a:[{t:"{silence}Opcin B.{silence}",l:"ENU"}]},{id:12096,m:"TDSTTS.Speak.OptionC.ESN",t_a:[{t:"{silence}Opcin C.{silence}",l:"ENU"}]},{id:12097,m:"TDSTTS.Speak.OptionD.ESN",t_a:[{t:"{silence}Opcin D.{silence}",l:"ENU"}]},{id:12098,m:"TDSTTS.Speak.OptionE.ESN",t_a:[{t:"{silence}Opcin E.{silence}",l:"ENU"}]},{id:12099,m:"TDSTTS.Speak.OptionF.ESN",t_a:[{t:"{silence}Opcin F.{silence}",l:"ENU"}]},{id:11481,m:"TDSTTS.Label.SpeakPromptSecondary",t_a:[{t:"Speak Writing Prompt (in English)",l:"ENU"},{t:"Pautas orales de escritura (en ingls)",l:"ESN"}]},{id:11482,m:"TDSTTS.Label.SpeakDirectionsSecondary",t_a:[{t:"Speak Instructions (in English)",l:"ENU"},{t:"Instrucciones orales (en ingls)",l:"ESN"}]},{id:11674,m:"TDSTTS.Speak.OptionAPrimary",t_a:[{t:"{silence}Option A.{silence}",l:"ENU"},{t:"{silence}Opcin A.{silence}",l:"ESN"}]},{id:11675,m:"TDSTTS.Speak.OptionBPrimary",t_a:[{t:"{silence}Option B.{silence}",l:"ENU"},{t:"{silence}Opcin B.{silence}",l:"ESN"}]},{id:11676,m:"TDSTTS.Speak.OptionCPrimary",t_a:[{t:"{silence}Option C.{silence}",l:"ENU"},{t:"{silence}Opcin C.{silence}",l:"ESN"}]},{id:11677,m:"TDSTTS.Speak.OptionDPrimary",t_a:[{t:"{silence}Option D.{silence}",l:"ENU"},{t:"{silence}Opcin D.{silence}",l:"ESN"}]},{id:11678,m:"TDSTTS.Speak.OptionEPrimary",t_a:[{t:"{silence}Option E.{silence}",l:"ENU"},{t:"{silence}Opcin E.{silence}",l:"ESN"}]},{id:11679,m:"TDSTTS.Speak.OptionFPrimary",t_a:[{t:"{silence}Option F.{silence}",l:"ENU"},{t:"{silence}Opcin F.{silence}",l:"ESN"}]},{id:11680,m:"TDSTTS.Speak.OptionASecondary",t_a:[{t:"{silence}Option A.{silence}",l:"ENU"},{t:"{silence}Option A.{silence}",l:"ESN"}]},{id:11681,m:"TDSTTS.Speak.OptionBSecondary",t_a:[{t:"{silence}Option B.{silence}",l:"ENU"},{t:"{silence}Option B.{silence}",l:"ESN"}]},{id:11682,m:"TDSTTS.Speak.OptionCSecondary",t_a:[{t:"{silence}Option C.{silence}",l:"ENU"},{t:"{silence}Option C.{silence}",l:"ESN"}]},{id:11683,m:"TDSTTS.Speak.OptionDSecondary",t_a:[{t:"{silence}Option D.{silence}",l:"ENU"},{t:"{silence}Option D.{silence}",l:"ESN"}]},{id:11684,m:"TDSTTS.Speak.OptionESecondary",t_a:[{t:"{silence}Option E.{silence}",l:"ENU"},{t:"{silence}Option E.{silence}",l:"ESN"}]},{id:11685,m:"TDSTTS.Speak.OptionFSecondary",t_a:[{t:"{silence}Option F.{silence}",l:"ENU"},{t:"{silence}Option F.{silence}",l:"ESN"}]},{id:12054,m:"TDSTTS.Speak.EBSR.Part1",t_a:[{t:"{silence}Part A.{silence}",l:"ENU"},{t:"{silence}Parte A.{silence}",l:"ESN"}]},{id:12055,m:"TDSTTS.Speak.EBSR.Part2",t_a:[{t:"{silence}Part B.{silence}",l:"ENU"},{t:"{silence}Parte B.{silence}",l:"ESN"}]},{id:12056,m:"TDSTTS.Speak.EBSR.Part3",t_a:[{t:"{silence}Part C.{silence}",l:"ENU"},{t:"{silence}Part C.{silence}",l:"ENU"}]},{id:12057,m:"TDSTTS.Speak.EBSR.Part4",t_a:[{t:"{silence}Part D.{silence}",l:"ENU"},{t:"{silence}Part D.{silence}",l:"ENU"}]},{id:12058,m:"TDSTTS.Speak.EBSR.Part5",t_a:[{t:"{silence}Part E.{silence}",l:"ENU"},{t:"{silence}Part E.{silence}",l:"ENU"}]},{id:12059,m:"TDSTTS.Speak.EBSR.Part6",t_a:[{t:"{silence}Part F.{silence}",l:"ENU"},{t:"{silence}Part F.{silence}",l:"ENU"}]},{id:11995,m:"TDSTTS.Speak.SelectA.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:11996,m:"TDSTTS.Speak.SelectB.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:11997,m:"TDSTTS.Speak.SelectC.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:11998,m:"TDSTTS.Speak.SelectD.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:11999,m:"TDSTTS.Speak.SelectE.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:12e3,m:"TDSTTS.Speak.SelectF.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:12001,m:"TDSTTS.Speak.SelectG.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:12002,m:"TDSTTS.Speak.SelectH.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:12003,m:"TDSTTS.Speak.SelectI.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:12004,m:"TDSTTS.Speak.SelectJ.ENU",t_a:[{t:"{silence} {silence}",l:"ENU"},{t:"{silence} {silence}",l:"ENU"}]},{id:12100,m:"TDSTTS.Speak.SelectA.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12101,m:"TDSTTS.Speak.SelectB.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12102,m:"TDSTTS.Speak.SelectC.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12103,m:"TDSTTS.Speak.SelectD.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12104,m:"TDSTTS.Speak.SelectE.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12105,m:"TDSTTS.Speak.SelectF.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12106,m:"TDSTTS.Speak.SelectG.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12107,m:"TDSTTS.Speak.SelectH.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12108,m:"TDSTTS.Speak.SelectI.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12109,m:"TDSTTS.Speak.SelectJ.ESN",t_a:[{t:"{silence} {silence}",l:"ENU"}]},{id:12016,m:"TDSTTS.Label.SpeakPart1OptionAPrimary",t_a:[{t:"Speak Part A Option A",l:"ENU"},{t:"Speak Part A Option A",l:"ENU"}]},{id:12017,m:"TDSTTS.Label.SpeakPart1OptionBPrimary",t_a:[{t:"Speak Part A Option B",l:"ENU"},{t:"Speak Part A Option B",l:"ENU"}]},{id:12018,m:"TDSTTS.Label.SpeakPart1OptionCPrimary",t_a:[{t:"Speak Part A Option C",l:"ENU"},{t:"Speak Part A Option C",l:"ENU"}]},{id:12019,m:"TDSTTS.Label.SpeakPart1OptionDPrimary",t_a:[{t:"Speak Part A Option D",l:"ENU"},{t:"Speak Part A Option D",l:"ENU"}]},{id:12020,m:"TDSTTS.Label.SpeakPart1OptionEPrimary",t_a:[{t:"Speak Part A Option E",l:"ENU"},{t:"Speak Part A Option E",l:"ENU"}]},{id:12021,m:"TDSTTS.Label.SpeakPart1OptionFPrimary",t_a:[{t:"Speak Part A Option F",l:"ENU"},{t:"Speak Part A Option F",l:"ENU"}]},{id:12022,m:"TDSTTS.Label.SpeakPart1OptionASecondary",t_a:[{t:"Speak Part A Option A",l:"ENU"},{t:"Speak Part A Option A",l:"ENU"}]},{id:12023,m:"TDSTTS.Label.SpeakPart1OptionBSecondary",t_a:[{t:"Speak Part A Option B",l:"ENU"},{t:"Speak Part A Option B",l:"ENU"}]},{id:12024,m:"TDSTTS.Label.SpeakPart1OptionCSecondary",t_a:[{t:"Speak Part A Option C",l:"ENU"},{t:"Speak Part A Option C",l:"ENU"}]},{id:12025,m:"TDSTTS.Label.SpeakPart1OptionDSecondary",t_a:[{t:"Speak Part A Option D",l:"ENU"},{t:"Speak Part A Option D",l:"ENU"}]},{id:12026,m:"TDSTTS.Label.SpeakPart1OptionESecondary",t_a:[{t:"Speak Part A Option E",l:"ENU"},{t:"Speak Part A Option E",l:"ENU"}]},{id:12027,m:"TDSTTS.Label.SpeakPart1OptionFSecondary",t_a:[{t:"Speak Part A Option F",l:"ENU"},{t:"Speak Part A Option F",l:"ENU"}]},{id:12028,m:"TDSTTS.Label.SpeakPart2OptionAPrimary",t_a:[{t:"Speak Part B Option A",l:"ENU"},{t:"Speak Part B Option A",l:"ENU"}]},{id:12029,m:"TDSTTS.Label.SpeakPart2OptionBPrimary",t_a:[{t:"Speak Part B Option B",l:"ENU"},{t:"Speak Part B Option B",l:"ENU"}]},{id:12030,m:"TDSTTS.Label.SpeakPart2OptionCPrimary",t_a:[{t:"Speak Part B Option C",l:"ENU"},{t:"Speak Part B Option C",l:"ENU"}]},{id:12031,m:"TDSTTS.Label.SpeakPart2OptionDPrimary",t_a:[{t:"Speak Part B Option D",l:"ENU"},{t:"Speak Part B Option D",l:"ENU"}]},{id:12032,m:"TDSTTS.Label.SpeakPart2OptionEPrimary",t_a:[{t:"Speak Part B Option E",l:"ENU"},{t:"Speak Part B Option E",l:"ENU"}]},{id:12033,m:"TDSTTS.Label.SpeakPart2OptionFPrimary",t_a:[{t:"Speak Part B Option F",l:"ENU"},{t:"Speak Part B Option F",l:"ENU"}]},{id:12034,m:"TDSTTS.Label.SpeakPart2OptionASecondary",t_a:[{t:"Speak Part B Option A",l:"ENU"},{t:"Speak Part B Option A",l:"ENU"}]},{id:12035,m:"TDSTTS.Label.SpeakPart2OptionBSecondary",t_a:[{t:"Speak Part B Option B",l:"ENU"},{t:"Speak Part B Option B",l:"ENU"}]},{id:12036,m:"TDSTTS.Label.SpeakPart2OptionCSecondary",t_a:[{t:"Speak Part B Option C",l:"ENU"},{t:"Speak Part B Option C",l:"ENU"}]},{id:12037,m:"TDSTTS.Label.SpeakPart2OptionDSecondary",t_a:[{t:"Speak Part B Option D",l:"ENU"},{t:"Speak Part B Option D",l:"ENU"}]},{id:12038,m:"TDSTTS.Label.SpeakPart2OptionESecondary",t_a:[{t:"Speak Part B Option E",l:"ENU"},{t:"Speak Part B Option E",l:"ENU"}]},{id:12039,m:"TDSTTS.Label.SpeakPart2OptionFSecondary",t_a:[{t:"Speak Part B Option F",l:"ENU"},{t:"Speak Part B Option F",l:"ENU"}]},{id:11872,m:"TDSTTS.Label.PauseSpeaking",t_a:[{t:"Pause Speaking",l:"ENU"},{t:"Haga una pausa",l:"ESN"}]},{id:11873,m:"TDSTTS.Label.ResumeSpeaking",t_a:[{t:"Resume Speaking",l:"ENU"},{t:"Contine hablando",l:"ESN"}]},{id:12064,m:"TDSTTS.Label.SpeakTextENU",t_a:[{t:"Speak Selection",l:"ENU"},{t:"Speak Selection",l:"ENU"}]},{id:12065,m:"TDSTTS.Label.SpeakOptionAENU",t_a:[{t:"Speak Option A",l:"ENU"},{t:"Speak Option A",l:"ENU"}]},{id:12066,m:"TDSTTS.Label.SpeakOptionBENU",t_a:[{t:"Speak Option B",l:"ENU"},{t:"Speak Option B",l:"ENU"}]},{id:12068,m:"TDSTTS.Label.SpeakOptionCENU",t_a:[{t:"Speak Option C",l:"ENU"},{t:"Speak Option C",l:"ENU"}]},{id:12069,m:"TDSTTS.Label.SpeakOptionDENU",t_a:[{t:"Speak Option D",l:"ENU"},{t:"Speak Option D",l:"ENU"}]},{id:12070,m:"TDSTTS.Label.SpeakOptionEENU",t_a:[{t:"Speak Option E",l:"ENU"},{t:"Speak Option E",l:"ENU"}]},{id:12071,m:"TDSTTS.Label.SpeakOptionFENU",t_a:[{t:"Speak Option F",l:"ENU"},{t:"Speak Option F",l:"ENU"}]},{id:12072,m:"TDSTTS.Label.SpeakPassageENU",t_a:[{t:"Speak Passage",l:"ENU"},{t:"Speak Passage",l:"ENU"}]},{id:12073,m:"TDSTTS.Label.SpeakIllustrationENU",t_a:[{t:"Speak Image",l:"ENU"},{t:"Speak Image",l:"ENU"}]},{id:12074,m:"TDSTTS.Label.SpeakDirectionsENU",t_a:[{t:"Speak Instructions",l:"ENU"},{t:"Speak Instructions",l:"ENU"}]},{id:12075,m:"TDSTTS.Label.SpeakPromptENU",t_a:[{t:"Speak Writing Prompt",l:"ENU"},{t:"Speak Writing Prompt",l:"ENU"}]},{id:12076,m:"TDSTTS.Label.Speak.OptionA.ENU",t_a:[{t:"Speak Option A",l:"ENU"}]},{id:12077,m:"TDSTTS.Label.Speak.OptionB.ENU",t_a:[{t:"Speak Option B",l:"ENU"}]},{id:12078,m:"TDSTTS.Label.Speak.OptionC.ENU",t_a:[{t:"Speak Option C",l:"ENU"}]},{id:12079,m:"TDSTTS.Label.Speak.OptionD.ENU",t_a:[{t:"Speak Option D",l:"ENU"}]},{id:12080,m:"TDSTTS.Label.Speak.OptionE.ENU",t_a:[{t:"Speak Option E",l:"ENU"}]},{id:12081,m:"TDSTTS.Label.Speak.OptionF.ENU",t_a:[{t:"Speak Option F",l:"ENU"}]},{id:12082,m:"TDSTTS.Label.SpeakPartAOptionAENU",t_a:[{t:"Speak Part A Option A",l:"ENU"},{t:"Speak Part A Option A",l:"ENU"}]},{id:12083,m:"TDSTTS.Label.SpeakPartAOptionBENU",t_a:[{t:"Speak Part A Option B",l:"ENU"},{t:"Speak Part A Option B",l:"ENU"}]},{id:12084,m:"TDSTTS.Label.SpeakPartAOptionCENU",t_a:[{t:"Speak Part A Option C",l:"ENU"},{t:"Speak Part A Option C",l:"ENU"}]},{id:12085,m:"TDSTTS.Label.SpeakPartAOptionDENU",t_a:[{t:"Speak Part A Option D",l:"ENU"},{t:"Speak Part A Option D",l:"ENU"}]},{id:12086,m:"TDSTTS.Label.SpeakPartAOptionEENU",t_a:[{t:"Speak Part A Option E",l:"ENU"},{t:"Speak Part A Option E",l:"ENU"}]},{id:12087,m:"TDSTTS.Label.SpeakPartAOptionFENU",t_a:[{t:"Speak Part A Option F",l:"ENU"},{t:"Speak Part A Option F",l:"ENU"}]},{id:12088,m:"TDSTTS.Label.SpeakPartBOptionAENU",t_a:[{t:"Speak Part B Option A",l:"ENU"},{t:"Speak Part B Option A",l:"ENU"}]},{id:12089,m:"TDSTTS.Label.SpeakPartBOptionBENU",t_a:[{t:"Speak Part B Option B",l:"ENU"},{t:"Speak Part B Option B",l:"ENU"}]},{id:12090,m:"TDSTTS.Label.SpeakPartBOptionCENU",t_a:[{t:"Speak Part B Option C",l:"ENU"},{t:"Speak Part B Option C",l:"ENU"}]},{id:12091,m:"TDSTTS.Label.SpeakPartBOptionDENU",t_a:[{t:"Speak Part B Option D",l:"ENU"},{t:"Speak Part B Option D",l:"ENU"}]},{id:12092,m:"TDSTTS.Label.SpeakPartBOptionEENU",t_a:[{t:"Speak Part B Option E",l:"ENU"},{t:"Speak Part B Option E",l:"ENU"}]},{id:12093,m:"TDSTTS.Label.SpeakPartBOptionFENU",t_a:[{t:"Speak Part B Option F",l:"ENU"},{t:"Speak Part B Option F",l:"ENU"}]},{id:12110,m:"TDSTTS.Label.SpeakTextESN",t_a:[{t:"Hable la Selection",l:"ENU"},{t:"Hable la Selection",l:"ENU"}]},{id:12111,m:"TDSTTS.Label.SpeakOptionAESN",t_a:[{t:"Hable la Opcin A",l:"ENU"},{t:"Hable la Opcin A",l:"ENU"}]},{id:12112,m:"TDSTTS.Label.SpeakOptionBESN",t_a:[{t:"Hable la Opcin B",l:"ENU"},{t:"Hable la Opcin B",l:"ENU"}]},{id:12113,m:"TDSTTS.Label.SpeakOptionCESN",t_a:[{t:"Hable la Opcin C",l:"ENU"},{t:"Hable la Opcin C",l:"ENU"}]},{id:12114,m:"TDSTTS.Label.SpeakOptionDESN",t_a:[{t:"Hable la Opcin D",l:"ENU"},{t:"Hable la Opcin D",l:"ENU"}]},{id:12115,m:"TDSTTS.Label.SpeakOptionEESN",t_a:[{t:"Hable la Opcin E",l:"ENU"},{t:"Hable la Opcin E",l:"ENU"}]},{id:12116,m:"TDSTTS.Label.SpeakOptionFESN",t_a:[{t:"Hable la Opcin F",l:"ENU"},{t:"Hable la Opcin F",l:"ENU"}]},{id:12117,m:"TDSTTS.Label.SpeakPassageESN",t_a:[{t:"Hable la Passage",l:"ENU"},{t:"Hable la Passage",l:"ENU"}]},{id:12118,m:"TDSTTS.Label.SpeakIllustrationESN",t_a:[{t:"Hable la Image",l:"ENU"},{t:"Hable la Image",l:"ENU"}]},{id:12119,m:"TDSTTS.Label.SpeakDirectionsESN",t_a:[{t:"Hable la Instructions",l:"ENU"},{t:"Hable la Instructions",l:"ENU"}]},{id:12120,m:"TDSTTS.Label.SpeakPromptESN",t_a:[{t:"Hable la Writing Prompt",l:"ENU"},{t:"Hable la Writing Prompt",l:"ENU"}]},{id:12121,m:"TDSTTS.Label.Speak.OptionA.ESN",t_a:[{t:"Hable la Opcin A",l:"ENU"},{t:"Hable la Opcin A",l:"ENU"}]},{id:12122,m:"TDSTTS.Label.Speak.OptionB.ESN",t_a:[{t:"Hable la Opcin B",l:"ENU"},{t:"Hable la Opcin B",l:"ENU"}]},{id:12123,m:"TDSTTS.Label.Speak.OptionC.ESN",t_a:[{t:"Hable la Opcin C",l:"ENU"},{t:"Hable la Opcin C",l:"ENU"}]},{id:12124,m:"TDSTTS.Label.Speak.OptionD.ESN",t_a:[{t:"Hable la Opcin D",l:"ENU"},{t:"Hable la Opcin D",l:"ENU"}]},{id:12125,m:"TDSTTS.Label.Speak.OptionE.ESN",t_a:[{t:"Hable la Opcin E",l:"ENU"},{t:"Hable la Opcin E",l:"ENU"}]},{id:12126,m:"TDSTTS.Label.Speak.OptionF.ESN",t_a:[{t:"Hable la Opcin F",l:"ENU"},{t:"Hable la Opcin F",l:"ENU"}]},{id:12127,m:"TDSTTS.Label.SpeakPartAOptionAESN",t_a:[{t:"Hable la Part A Opcin A",l:"ENU"},{t:"Hable la Part A Opcin A",l:"ENU"}]},{id:12128,m:"TDSTTS.Label.SpeakPartAOptionBESN",t_a:[{t:"Hable la Part A Opcin B",l:"ENU"},{t:"Hable la Part A Opcin B",l:"ENU"}]},{id:12129,m:"TDSTTS.Label.SpeakPartAOptionCESN",t_a:[{t:"Hable la Part A Opcin C",l:"ENU"},{t:"Hable la Part A Opcin C",l:"ENU"}]},{id:12130,m:"TDSTTS.Label.SpeakPartAOptionDESN",t_a:[{t:"Hable la Part A Opcin D",l:"ENU"},{t:"Hable la Part A Opcin D",l:"ENU"}]},{id:12131,m:"TDSTTS.Label.SpeakPartAOptionEESN",t_a:[{t:"Hable la Part A Opcin E",l:"ENU"},{t:"Hable la Part A Opcin E",l:"ENU"}]},{id:12132,m:"TDSTTS.Label.SpeakPartAOptionFESN",t_a:[{t:"Hable la Part A Opcin F",l:"ENU"},{t:"Hable la Part A Opcin F",l:"ENU"}]},{id:12133,m:"TDSTTS.Label.SpeakPartBOptionAESN",t_a:[{t:"Hable la Part B Opcin A",l:"ENU"},{t:"Hable la Part B Opcin A",l:"ENU"}]},{id:12134,m:"TDSTTS.Label.SpeakPartBOptionBESN",t_a:[{t:"Hable la Part B Opcin B",l:"ENU"},{t:"Hable la Part B Opcin B",l:"ENU"}]},{id:12135,m:"TDSTTS.Label.SpeakPartBOptionCESN",t_a:[{t:"Hable la Part B Opcin C",l:"ENU"},{t:"Hable la Part B Opcin C",l:"ENU"}]},{id:12136,m:"TDSTTS.Label.SpeakPartBOptionDESN",t_a:[{t:"Hable la Part B Opcin D",l:"ENU"},{t:"Hable la Part B Opcin D",l:"ENU"}]},{id:12137,m:"TDSTTS.Label.SpeakPartBOptionEESN",t_a:[{t:"Hable la Part B Opcin E",l:"ENU"},{t:"Hable la Part B Opcin E",l:"ENU"}]},{id:12138,m:"TDSTTS.Label.SpeakPartBOptionFESN",t_a:[{t:"Hable la Part A Opcin F",l:"ENU"},{t:"Hable la Part A Opcin F",l:"ENU"}]},{id:12139,m:"TDSTTS.Label.SpeakQuestionENU",t_a:[{t:"Speak Question",l:"ENU"},{t:"Speak Question",l:"ENU"}]},{id:12149,m:"TDSTTS.Label.SpeakOptionA.ENU",t_a:[{t:"Speak Option A",l:"ENU"},{t:"Speak Option A",l:"ENU"}]},{id:12150,m:"TDSTTS.Label.SpeakOptionB.ENU",t_a:[{t:"Speak Option B",l:"ENU"},{t:"Speak Option B",l:"ENU"}]},{id:12151,m:"TDSTTS.Label.SpeakOptionC.ENU",t_a:[{t:"Speak Option C",l:"ENU"},{t:"Speak Option C",l:"ENU"}]},{id:12152,m:"TDSTTS.Label.SpeakOptionD.ENU",t_a:[{t:"Speak Option D",l:"ENU"},{t:"Speak Option D",l:"ENU"}]},{id:12153,m:"TDSTTS.Label.SpeakOptionE.ENU",t_a:[{t:"Speak Option E",l:"ENU"},{t:"Speak Option E",l:"ENU"}]},{id:12154,m:"TDSTTS.Label.SpeakOptionF.ENU",t_a:[{t:"Speak Option F",l:"ENU"},{t:"Speak Option F",l:"ENU"}]},{id:12155,m:"TDSTTS.Label.SpeakPassage.ENU",t_a:[{t:"Speak Passage",l:"ENU"},{t:"Speak Passage",l:"ENU"}]},{id:12156,m:"TDSTTS.Label.SpeakIllustration.ENU",t_a:[{t:"Speak Image",l:"ENU"},{t:"Speak Image",l:"ENU"}]},{id:12157,m:"TDSTTS.Label.SpeakDirections.ENU",t_a:[{t:"Speak Instructions",l:"ENU"},{t:"Speak Instructions",l:"ENU"}]},{id:12158,m:"TDSTTS.Label.SpeakPrompt.ENU",t_a:[{t:"Speak Writing Prompt",l:"ENU"},{t:"Speak Writing Prompt",l:"ENU"}]},{id:12165,m:"TDSTTS.Label.SpeakPartAOptionA.ENU",t_a:[{t:"Speak Part A Option A",l:"ENU"},{t:"Speak Part A Option A",l:"ENU"}]},{id:12166,m:"TDSTTS.Label.SpeakPartAOptionB.ENU",t_a:[{t:"Speak Part A Option B",l:"ENU"},{t:"Speak Part A Option B",l:"ENU"}]},{id:12167,m:"TDSTTS.Label.SpeakPartAOptionC.ENU",t_a:[{t:"Speak Part A Option C",l:"ENU"},{t:"Speak Part A Option C",l:"ENU"}]},{id:12168,m:"TDSTTS.Label.SpeakPartAOptionD.ENU",t_a:[{t:"Speak Part A Option D",l:"ENU"},{t:"Speak Part A Option D",l:"ENU"}]},{id:12169,m:"TDSTTS.Label.SpeakPartAOptionE.ENU",t_a:[{t:"Speak Part A Option E",l:"ENU"},{t:"Speak Part A Option E",l:"ENU"}]},{id:12170,m:"TDSTTS.Label.SpeakPartAOptionF.ENU",t_a:[{t:"Speak Part A Option F",l:"ENU"},{t:"Speak Part A Option F",l:"ENU"}]},{id:12171,m:"TDSTTS.Label.SpeakPartBOptionA.ENU",t_a:[{t:"Speak Part B Option A",l:"ENU"},{t:"Speak Part B Option A",l:"ENU"}]},{id:12172,m:"TDSTTS.Label.SpeakPartBOptionB.ENU",t_a:[{t:"Speak Part B Option B",l:"ENU"},{t:"Speak Part B Option B",l:"ENU"}]},{id:12173,m:"TDSTTS.Label.SpeakPartBOptionC.ENU",t_a:[{t:"Speak Part B Option C",l:"ENU"},{t:"Speak Part B Option C",l:"ENU"}]},{id:12174,m:"TDSTTS.Label.SpeakPartBOptionD.ENU",t_a:[{t:"Speak Part B Option D",l:"ENU"},{t:"Speak Part B Option D",l:"ENU"}]},{id:12175,m:"TDSTTS.Label.SpeakPartBOptionE.ENU",t_a:[{t:"Speak Part B Option E",l:"ENU"},{t:"Speak Part B Option E",l:"ENU"}]},{id:12176,m:"TDSTTS.Label.SpeakPartBOptionF.ENU",t_a:[{t:"Speak Part B Option F",l:"ENU"},{t:"Speak Part B Option F",l:"ENU"}]},{id:12177,m:"TDSTTS.Label.SelectA.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12178,m:"TDSTTS.Label.SelectB.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12179,m:"TDSTTS.Label.SelectC.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12180,m:"TDSTTS.Label.SelectD.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12181,m:"TDSTTS.Label.SelectE.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12182,m:"TDSTTS.Label.SelectF.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12183,m:"TDSTTS.Label.Speak.SelectA.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12184,m:"TDSTTS.Label.Speak.SelectB.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12185,m:"TDSTTS.Label.Speak.SelectC.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12186,m:"TDSTTS.Label.Speak.SelectD.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12187,m:"TDSTTS.Label.Speak.SelectE.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12188,m:"TDSTTS.Label.Speak.SelectF.ENU",t_a:[{t:"Speak This Option",l:"ENU"},{t:"Speak This Option",l:"ENU"}]},{id:12189,m:"TDSTTS.Label.SpeakPartASelectA.ENU",t_a:[{t:"Speak This Option for Part A",l:"ENU"},{t:"Speak This Option for Part A",l:"ENU"}]},{id:12190,m:"TDSTTS.Label.SpeakPartASelectB.ENU",t_a:[{t:"Speak This Option for Part A",l:"ENU"},{t:"Speak This Option for Part A",l:"ENU"}]},{id:12191,m:"TDSTTS.Label.SpeakPartASelectC.ENU",t_a:[{t:"Speak This Option for Part A",l:"ENU"},{t:"Speak This Option for Part A",l:"ENU"}]},{id:12192,m:"TDSTTS.Label.SpeakPartASelectD.ENU",t_a:[{t:"Speak This Option for Part A",l:"ENU"},{t:"Speak This Option for Part A",l:"ENU"}]},{id:12193,m:"TDSTTS.Label.SpeakPartASelectE.ENU",t_a:[{t:"Speak This Option for Part A",l:"ENU"},{t:"Speak This Option for Part A",l:"ENU"}]},{id:12194,m:"TDSTTS.Label.SpeakPartASelectF.ENU",t_a:[{t:"Speak This Option for Part A",l:"ENU"},{t:"Speak This Option for Part A",l:"ENU"}]},{id:12195,m:"TDSTTS.Label.SpeakPartBSelectA.ENU",t_a:[{t:"Speak This Option for Part B",l:"ENU"},{t:"Speak This Option for Part B",l:"ENU"}]},{id:12196,m:"TDSTTS.Label.SpeakPartBSelectB.ENU",t_a:[{t:"Speak This Option for Part B",l:"ENU"},{t:"Speak This Option for Part B",l:"ENU"}]},{id:12197,m:"TDSTTS.Label.SpeakPartBSelectC.ENU",t_a:[{t:"Speak This Option for Part B",l:"ENU"},{t:"Speak This Option for Part B",l:"ENU"}]},{id:12198,m:"TDSTTS.Label.SpeakPartBSelectD.ENU",t_a:[{t:"Speak This Option for Part B",l:"ENU"},{t:"Speak This Option for Part B",l:"ENU"}]},{id:12199,m:"TDSTTS.Label.SpeakPartBSelectE.ENU",t_a:[{t:"Speak This Option for Part B",l:"ENU"},{t:"Speak This Option for Part B",l:"ENU"}]},{id:12200,m:"TDSTTS.Label.SpeakPartBSelectF.ENU",t_a:[{t:"Speak This Option for Part B",l:"ENU"},{t:"Speak This Option for Part B",l:"ENU"}]},{id:12221,m:"TDSTTS.Label.SpeakQuestionESN",t_a:[{t:"Speak Question - In Spanish",l:"ENU"},{t:"Diga la pregunta",l:"ESN"}]},{id:12238,m:"TDSTTS.Label.SpeakOption",t_a:[{t:"Speak Option",l:"ENU"},{t:"Speak Option",l:"ENU"}]},{id:12319,m:"TDSTTS.Speak.OptionG.ENU",t_a:[{t:"{silence}Option G.{silence}",l:"ENU"},{t:"{silence}Option G.{silence}",l:"ENU"}]},{id:12320,m:"TDSTTS.Speak.OptionH.ENU",t_a:[{t:"{silence}Option H.{silence}",l:"ENU"},{t:"{silence}Option H.{silence}",l:"ENU"}]},{id:12321,m:"TDSTTS.Speak.OptionI.ENU",t_a:[{t:"{silence}Option I.{silence}",l:"ENU"},{t:"{silence}Option I.{silence}",l:"ENU"}]},{id:12322,m:"TDSTTS.Speak.OptionJ.ENU",t_a:[{t:"{silence}Option J.{silence}",l:"ENU"},{t:"{silence}Option J.{silence}",l:"ENU"}]},{id:12323,m:"TDSTTS.Speak.OptionK.ENU",t_a:[{t:"{silence}Option K.{silence}",l:"ENU"},{t:"{silence}Option K.{silence}",l:"ENU"}]},{id:12324,m:"TDSTTS.Speak.OptionL.ENU",t_a:[{t:"{silence}Option L.{silence}",l:"ENU"},{t:"{silence}Option L.{silence}",l:"ENU"}]},{id:12325,m:"TDSTTS.Speak.OptionG.ESN",t_a:[{t:"{silence}Opcin G.{silence}",l:"ENU"},{t:"{silence}Opcin G.{silence}",l:"ENU"}]},{id:12326,m:"TDSTTS.Speak.OptionH.ESN",t_a:[{t:"{silence}Opcin H.{silence}",l:"ENU"},{t:"{silence}Opcin H.{silence}",l:"ENU"}]},{id:12327,m:"TDSTTS.Speak.OptionI.ESN",t_a:[{t:"{silence}Opcin I.{silence}",l:"ENU"},{t:"{silence}Opcin I.{silence}",l:"ENU"}]},{id:12328,m:"TDSTTS.Speak.OptionJ.ESN",t_a:[{t:"{silence}Opcin J.{silence}",l:"ENU"},{t:"{silence}Opcin J.{silence}",l:"ENU"}]},{id:12329,m:"TDSTTS.Speak.OptionK.ESN",t_a:[{t:"{silence}Opcin K.{silence}",l:"ENU"},{t:"{silence}Opcin K.{silence}",l:"ENU"}]},{id:12330,m:"TDSTTS.Speak.OptionL.ESN",t_a:[{t:"{silence}Opcin L.{silence}",l:"ENU"},{t:"{silence}Opcin L.{silence}",l:"ENU"}]}]},{c:"tds_writing.js",m_a:[{id:11178,m:"TDSWritingJS.Label.Writing",t_a:[{t:"Writing",l:"ENU"},{t:"Escritura",l:"ESN"}]},{id:11179,m:"TDSWritingJS.Label.ChangePassage",t_a:[{t:"Are you sure you want to change the prompt you already selected? <Yes> <No>",l:"ENU"},{t:"Est seguro de que desea cambiar el tema que seleccion anteriormente? <S> <No>",l:"ESN"}]}]},{c:"TestResults.aspx",m_a:[{id:12282,m:"TestResults.Link.ChangeStudent",t_a:[{t:"Enter Data for a Different Student",l:"ENU"},{t:"Enter Data for a Different Student",l:"ENU"}]}]},{c:"TestReview.aspx",m_a:[{id:12354,m:"Pause",t_a:[{t:"Are you sure you want to pause the test? If you pause your test for more than {0} minutes, you may be unable to make changes to questions that you have already answered. Ask your Test Administrator before pausing your test.",l:"ENU"},{t:"Are you sure you want to pause the test? If you pause your test for more than {0} minutes, you may be unable to make changes to questions that you have already answered. Ask your Test Administrator before pausing your test.",l:"ENU"}]},{id:11234,m:"TestReview.Label.EndTest",t_a:[{t:"Are you sure you want to submit this test?",l:"ENU"},{t:"Est seguro de que desea finalizar la prueba?",l:"ESN"}]}]},{c:"TestShell.aspx",m_a:[{id:11231,m:"NavigateAudioPlaying",t_a:[{t:"Audio is playing or paused. Please stop the audio before navigating to another page.",l:"ENU"},{t:"El audio se est reproduciendo o est pausado. Detn el audio antes de navegar hacia otra pgina.",l:"ESN"}]},{id:11232,m:"TestCompleted",t_a:[{t:"The test has been completed and is ready to be submitted.",l:"ENU"},{t:"La prueba se ha finalizado y est lista para entregarse.",l:"ESN"}]},{id:11250,m:"TestShell.Label.Initializing",t_a:[{t:"Initializing",l:"ENU"},{t:"Inicializando",l:"ESN"}]},{id:11239,m:"TestShell.Link.Print",t_a:[{t:"Print Passage",l:"ENU"},{t:"Imprimir",l:"ESN"}]},{id:11240,m:"TestShell.Link.PrintPractice",t_a:[{t:"Print",l:"ENU"},{t:"Imprimir",l:"ESN"}]},{id:11241,m:"TestShell.Label.PracticeTestPrint",t_a:[{t:"Your practice test is printing ",l:"ENU"},{t:"Se est imprimiendo la prueba de prctica",l:"ESN"}]},{id:11242,m:"TestShell.Link.PrintPassage",t_a:[{t:"Click here to print the passage.",l:"ENU"},{t:"Haga clic aqu para imprimir el pasaje.",l:"ESN"}]},{id:11705,m:"Submit and Close",t_a:[{t:"Save and Close",l:"ENU"},{t:"Guardar y Cerrar",l:"ESN"}]},{id:10904,m:"ResponseError",t_a:[{t:"Your answer has not been saved. Click [Yes] to try again. Click [No] to log out of your test without saving your answer.",l:"ENU"},{t:"La respuesta no se ha guardado. Haga clic en [S] para intentarlo nuevamente o en [No] para salir de la prueba sin guardar su respuesta.",l:"ESN"}]},{id:11652,m:"TDS_F_MN_5Math",t_a:[{t:"../tools/formulas/2010/mn_5_math.html",l:"ENU"},{t:"../tools/formulas/2010/mn_5_math.html",l:"ENU"}]},{id:11653,m:"TDS_F_MN_6Math",t_a:[{t:"../tools/formulas/2010/mn_6_math.html",l:"ENU"},{t:"../tools/formulas/2010/mn_6_math.html",l:"ENU"}]},{id:11654,m:"TDS_F_MN_7Math",t_a:[{t:"../tools/formulas/2010/mn_7_math.html",l:"ENU"},{t:"../tools/formulas/2010/mn_7_math.html",l:"ENU"}]},{id:11655,m:"TDS_F_MN_8Math",t_a:[{t:"../tools/formulas/2010/mn_8_math.html",l:"ENU"},{t:"../tools/formulas/2010/mn_8_math.html",l:"ENU"}]},{id:11656,m:"TDS_F_MN_11Math",t_a:[{t:"../tools/formulas/2010/mn_11_math.html",l:"ENU"},{t:"../tools/formulas/2010/mn_11_math.html",l:"ENU"}]},{id:11657,m:"TDS_F_MN_GRADMath",t_a:[{t:"../tools/formulas/2010/mn_GRAD_math.html",l:"ENU"},{t:"../tools/formulas/2010/mn_GRAD_math.html",l:"ENU"}]},{id:11521,m:"TDSShellJS.Label.FrameLogout",t_a:[{t:"The content request requires user authentication. Please log back in and try again.",l:"ENU"},{t:"La solicitud de contenido requiere la autenticacin del usuario. Vuelva a conectarse e intente nuevamente.",l:"ESN"}]},{id:10905,m:"ActionError",t_a:[{t:"Could not send information over the network.  Click [Yes] to try again. Click [No] to log out.",l:"ENU"},{t:"No se pudo enviar informacin por la red.  Haga clic en [S] para intentarlo nuevamente o en [No] para salir de la prueba.",l:"ESN"}]},{id:10907,m:"WritingNoPromptSelected",t_a:[{t:"You must select a prompt before moving to the next page.",l:"ENU"},{t:"Debe seleccionar un tema antes de pasar a la pgina siguiente.",l:"ESN"}]},{id:10908,m:"WritingNoResponse",t_a:[{t:"You must enter some text before you can save your response.",l:"ENU"},{t:"Debe escriba algo antes de guardar su respuesta.",l:"ESN"}]},{id:10909,m:"WritingPause",t_a:[{t:"Are you sure you want to pause the test? Ask your Test Administrator before pausing your test.",l:"ENU"},{t:"Est seguro de que desea pausar la prueba? Consulte al administrador de la prueba antes de hacerlo.",l:"ESN"}]},{id:10914,m:"NextUnanswered",t_a:[{t:"You must answer all questions on this page before moving to the next page. (You may have to scroll down to see all questions.)",l:"ENU"},{t:"Contesta todas las preguntas antes de seguir a la prxima pgina.",l:"ESN"}]},{id:10915,m:"NextTestFinished",t_a:[{t:"You have answered all the questions in this test. When you have finished checking your answers, click the [End Test] button.",l:"ENU"},{t:"Ha respondido todas las preguntas.  Cuando termine de revisar las preguntas, presione [Terminar prueba].",l:"ESN"}]},{id:10916,m:"EndUnanswered",t_a:[{t:"You must answer all of the questions on this page before you can end the test.",l:"ENU"},{t:"Debe responder todas las preguntas de esta pgina antes de terminar la prueba.",l:"ESN"}]},{id:10917,m:"NavigateUnsaved",t_a:[{t:"Do you want to save your answer before moving away from this page?  <Save my answer> <Lose my answer>",l:"ENU"},{t:"Desea guardar la respuesta antes de salir de esta pgina?  <Guardar respuesta> <Eliminar respuesta>",l:"ESN"}]},{id:10918,m:"SaveRecordingInProgress",t_a:[{t:"Press [Stop] on the sound player before you move away from this page.",l:"ENU"},{t:"Presione [Detener] en el reproductor de sonido antes de salir de esta pgina.",l:"ESN"}]},{id:10919,m:"SaveRecordingQuality",t_a:[{t:"The recording is too soft. Click [Try Again] to make a new recording. Click [Keep It] to save this recording and go to the next question.",l:"ENU"},{t:"La grabacin se escucha demasiado baja. Haga clic en [Intentar nuevamente] para hacer una nueva grabacin o [Guardar] para guardarla y pasar a la pregunta siguiente.",l:"ESN"}]},{id:10898,m:"ForbiddenApps",t_a:[{t:"Another program has started, and you will be logged out. Ask your Test Administrator for help.",l:"ENU"},{t:"Se ha iniciado otro programa, y se cerrar la sesin. Consulte con el administrador de la prueba.",l:"ESN"}]},{id:10899,m:"Pause",t_a:[{t:"Are you sure you want to pause the test? If you pause your test for more than {0} minutes, you may be unable to make changes to questions that you have already answered. Ask your Test Administrator before pausing your test.",l:"ENU"},{t:"Est seguro que quiere hacer una pausa en la prueba? Si se hace una pausa durante el examen, las respuestas no sern visibles. Avisa al administrador/a antes de pausar el examen.",l:"ESN"}]},{id:10900,m:"Complete",t_a:[{t:"You have reached the end of the test.  Click [Yes] to continue to the next page.  Click [No] to keep working on your test.",l:"ENU"},{t:"Ha llegado al final de la prueba.  Haga clic en [S] para pasar a la pgina siguiente.  Haga clic en [No] para continuar con la prueba.",l:"ESN"}]},{id:10901,m:"Print",t_a:[{t:"Your print request has been sent to the Test Administrator.",l:"ENU"},{t:"Su solicitud de impresin se ha enviado al administrador de la prueba.",l:"ESN"}]},{id:10902,m:"ContentTimeout",t_a:[{t:"The question did not load. Click [Yes] to try again. Click [No] to log out.",l:"ENU"},{t:"La pregunta no se carg. Haga clic en [S] para intentarlo nuevamente o en [No] para salir de la prueba.",l:"ESN"}]},{id:10903,m:"ContentError",t_a:[{t:"The page did not load. Ask your Test Administrator for help.",l:"ENU"},{t:"La pgina no se carg.  Consulte con el administrador de la prueba.",l:"ESN"}]},{id:10868,m:"TDS_F_DE_2Math",t_a:[{t:"../tools/formulas/2010/de_g2_hundreds.html",l:"ENU"},{t:"../tools/formulas/2010/de_g2_hundreds_esn.html",l:"ESN"}]},{id:10869,m:"TDS_F_DE_6_8Math",t_a:[{t:"../tools/formulas/2010/de_6_8.html",l:"ENU"},{t:"../tools/formulas/2010/de_6_8_esn.html",l:"ESN"}]},{id:10870,m:"TDS_F_DE_9_10Math",t_a:[{t:"../tools/formulas/2010/de_9_10_eoc.html",l:"ENU"},{t:"../tools/formulas/2010/de_9_10_eoc_esn.html",l:"ESN"}]},{id:10871,m:"TDS_F_HI_4Math",t_a:[{t:"../tools/formulas/2010/hi_4_math.html",l:"ENU"},{t:"../tools/formulas/2010/hi_4_math.html",l:"ENU"}]},{id:10872,m:"TDS_F_HI_5Math",t_a:[{t:"../tools/formulas/2010/hi_5_math.html",l:"ENU"},{t:"../tools/formulas/2010/hi_5_math.html",l:"ENU"}]},{id:10873,m:"TDS_F_HI_6Math",t_a:[{t:"../tools/formulas/2010/hi_6_math.html",l:"ENU"},{t:"../tools/formulas/2010/hi_6_math.html",l:"ENU"}]},{id:10874,m:"TDS_F_HI_7Math",t_a:[{t:"../tools/formulas/2010/hi_7_math.html",l:"ENU"},{t:"../tools/formulas/2010/hi_7_math.html",l:"ENU"}]},{id:10875,m:"TDS_F_OR3_5",t_a:[{t:"../tools/formulas/2010/or_3_5_math.html",l:"ENU"},{t:"../tools/formulas/2010/or_3_5_math_esn.html",l:"ESN"}]},{id:10876,m:"TDS_F_ORCIM_Math",t_a:[{t:"../tools/formulas/2010/or_CIM_math.html",l:"ENU"},{t:"../tools/formulas/2010/or_CIM_math_esn.html",l:"ESN"}]},{id:10877,m:"TDS_F_HI_10Math",t_a:[{t:"../tools/formulas/2010/hi_10_math.html",l:"ENU"},{t:"../tools/formulas/2010/hi_10_math.html",l:"ENU"}]},{id:10878,m:"TDS_F_HI_11Sci",t_a:[{t:"../tools/formulas/2010/hi_11_science.html",l:"ENU"},{t:"../tools/formulas/2010/hi_11_science.html",l:"ENU"}]},{id:10879,m:"TDS_F_HI_8Math",t_a:[{t:"../tools/formulas/2010/hi_8_math.html",l:"ENU"},{t:"../tools/formulas/2010/hi_8_math.html",l:"ENU"}]},{id:10880,m:"TDS_FOR6_8Math",t_a:[{t:"../tools/formulas/2010/or_6_8_math.html",l:"ENU"},{t:"../tools/formulas/2010/or_6_8_math_esn.html",l:"ESN"}]},{id:10881,m:"TDS_PT_Basic",t_a:[{t:"../tools/periodic/2010/hi_7_science.html",l:"ENU"},{t:"../tools/periodic/2010/hi_7_science.html",l:"ENU"}]},{id:10882,m:"TDS_PT_Expanded",t_a:[{t:"../tools/periodic/2010/hi_11_science.html",l:"ENU"},{t:"../tools/periodic/2010/hi_11_science.html",l:"ENU"}]},{id:10883,m:"TDS_PT_HTML",t_a:[{t:"../tools/periodic/2010/htmlSimple.html",l:"ENU"},{t:"../tools/periodic/2010/htmlSimple.html",l:"ENU"}]},{id:12309,m:"NextUnansweredPositions",t_a:[{t:"You must answer all questions on this page before moving to the next page. (You may have to scroll down to see all questions.) Question(s) that still require an answer: {0}.",l:"ENU"},{t:"You must answer all questions on this page before moving to the next page. (You may have to scroll down to see all questions.) Question(s) that still require an answer: {0}.",l:"ENU"}]},{id:12310,m:"TDSEditorEventsJS.Label.EditorContentDeleted",t_a:[{t:"You are deleting a lot of text from your answer. Are you sure you want to do this?",l:"ENU"},{t:"You are deleting a lot of text from your answer. Are you sure you want to do this?",l:"ENU"}]},{id:12293,m:"TDS_R_AZ_G35Inform",t_a:[{t:"../tools/rubrics/Arizona/AZ_G3to5_Informative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G3to5_Informative.html",l:"ENU"}]},{id:12294,m:"TDS_R_AZ_G6Argue",t_a:[{t:"../tools/rubrics/Arizona/AZ_G6_Argumentative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G6_Argumentative.html",l:"ENU"}]},{id:12295,m:"TDS_R_AZ_G78Argue",t_a:[{t:"../tools/rubrics/Arizona/AZ_G7to8_Argumentative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G7to8_Argumentative.html",l:"ENU"}]},{id:12296,m:"TDS_R_AZ_G68Inform",t_a:[{t:"../tools/rubrics/Arizona/AZ_G6to8_Informative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G6to8_Informative.html",l:"ENU"}]},{id:12297,m:"TDS_R_AZ_G911Inform",t_a:[{t:"../tools/rubrics/Arizona/AZ_G9to11_Informative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G9to11_Informative.html",l:"ENU"}]},{id:12298,m:"TDS_R_AZ_G911Argue",t_a:[{t:"../tools/rubrics/Arizona/AZ_G9to11_Argumentative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G9to11_Argumentative.html",l:"ENU"}]},{id:12299,m:"TDS_R_AZ_G35Argue",t_a:[{t:"../tools/rubrics/Arizona/AZ_G3to5_Argumentative.html",l:"ENU"},{t:"../tools/rubrics/Arizona/AZ_G3to5_Argumentative.html",l:"ENU"}]},{id:12300,m:"Login.Button.SignOut",t_a:[{t:"Log Out",l:"ENU"},{t:"Log Out",l:"ENU"}]},{id:12331,m:"TDS_F_FL_OP_Math_4",t_a:[{t:"../tools/formulas/2010/fl_op_math_4.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_4.html",l:"ENU"}]},{id:12332,m:"TDS_F_FL_OP_Math_5",t_a:[{t:"../tools/formulas/2010/fl_op_math_5.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_5.html",l:"ENU"}]},{id:12333,m:"TDS_F_FL_OP_Math_6",t_a:[{t:"../tools/formulas/2010/fl_op_math_6.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_6.html",l:"ENU"}]},{id:12334,m:"TDS_F_FL_OP_Math_7",t_a:[{t:"../tools/formulas/2010/fl_op_math_7.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_7.html",l:"ENU"}]},{id:12335,m:"TDS_F_FL_OP_Math_8",t_a:[{t:"../tools/formulas/2010/fl_op_math_8.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_8.html",l:"ENU"}]},{id:12336,m:"TDS_F_FL_OP_Math_EOC_Algebra1",t_a:[{t:"../tools/formulas/2010/fl_op_math_eoc_algebra1.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_eoc_algebra1.html",l:"ENU"}]},{id:12337,m:"TDS_F_FL_OP_Math_EOC_Algebra2",t_a:[{t:"../tools/formulas/2010/fl_op_math_eoc_algebra2.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_eoc_algebra2.html",l:"ENU"}]},{id:12338,m:"TDS_F_FL_OP_Math_EOC_Geometry",t_a:[{t:"../tools/formulas/2010/fl_op_math_eoc_geometry.html",l:"ENU"},{t:"../tools/formulas/2010/fl_op_math_eoc_geometry.html",l:"ENU"}]},{id:12347,m:"TDS_F_WV_7_9_science",t_a:[{t:"../tools/formulas/2010/wv_7-9_science.html",l:"ENU"},{t:"../tools/formulas/2010/wv_7-9_science.html",l:"ENU"}]},{id:12348,m:"TDS.WordList.glossaryWithAudio",t_a:[{t:"Glossary",l:"ENU"},{t:"Glossary",l:"ENU"}]},{id:12349,m:"TDS.WordList.ESNGlossaryWithAudio",t_a:[{t:"Spanish Glossary",l:"ENU"},{t:"Spanish Glossary",l:"ENU"}]},{id:12278,m:"TS.Segment.LeaveWarning",t_a:[{t:"You are leaving the current segment. Are you sure that you want to do this?",l:"ENU"},{t:"You are leaving the current segment. Are you sure that you want to do this?",l:"ENU"}]},{id:12281,m:"TDSCKE.Label.SpecialCharIntro",t_a:[{t:"To add a special character to your response, select the appropriate character below",l:"ENU"},{t:"To add a special character to your response, select the appropriate character below",l:"ENU"}]},{id:12047,m:"EBSR.Header.Part1",t_a:[{t:"Part A",l:"ENU"},{t:"Part A",l:"ENU"}]},{id:12048,m:"EBSR.Header.Part2",t_a:[{t:"Part B",l:"ENU"},{t:"Part B",l:"ENU"}]},{id:12049,m:"EBSR.Header.Part3",t_a:[{t:"Part C",l:"ENU"},{t:"Part C",l:"ENU"}]},{id:12215,m:"TDS_F_MO_alg1",t_a:[{t:"../tools/formulas/2010/mo_alg1.html",l:"ENU"},{t:"../tools/formulas/2010/mo_alg1.html",l:"ENU"}]},{id:12216,m:"TDS_F_MO_alg2",t_a:[{t:"../tools/formulas/2010/mo_alg2.html",l:"ENU"},{t:"../tools/formulas/2010/mo_alg2.html",l:"ENU"}]},{id:12217,m:"TDS_F_MO_geo",t_a:[{t:"../tools/formulas/2010/mo_geo.html",l:"ENU"},{t:"../tools/formulas/2010/mo_geo.html",l:"ENU"}]},{id:12218,m:"TDS_F_MO_math_eoc",t_a:[{t:"../tools/formulas/2010/mo_eoc_math.html",l:"ENU"},{t:"../tools/formulas/2010/mo_eoc_math.html",l:"ENU"}]},{id:12219,m:"TDSCKE.Alert.InvalidHeight.lang",t_a:[{t:"The table height you have entered is invalid. You may enter a number in pixels (e.g., 300) or a percentage (e.g., 100%). You may also choose to leave the height value blank. If you leave the value blank, the browser will automatically adjust the table size.",l:"ENU"},{t:"The table height you have entered is invalid. You may enter a number in pixels (e.g., 300) or a percentage (e.g., 100%). You may also choose to leave the height value blank. If you leave the value blank, the browser will automatically adjust the table size.",l:"ENU"}]},{id:12220,m:"TDSCKE.Alert.InvalidWidth.lang",t_a:[{t:"The table width you have entered is invalid. You may enter a number in pixels (e.g., 300) or a percentage (e.g., 100%). You may also choose to leave the width value blank. If you leave the value blank, the browser will automatically adjust the table size.",l:"ENU"},{t:"The table width you have entered is invalid. You may enter a number in pixels (e.g., 300) or a percentage (e.g., 100%). You may also choose to leave the width value blank. If you leave the value blank, the browser will automatically adjust the table size.",l:"ENU"}]},{id:12240,m:"cm.widget.label.audio.recorder",t_a:[{t:"Record your response.",l:"ENU"},{t:"Record your response.",l:"ENU"}]},{id:12241,m:"cm.widget.label.qti.textentry",t_a:[{t:"Type your response.",l:"ENU"},{t:"Type your response.",l:"ENU"}]},{id:12242,m:"cm.widget.label.qti.inlinechoice",t_a:[{t:"Reorder text.",l:"ENU"},{t:"Reorder text.",l:"ENU"}]},{id:12243,m:"cm.widget.label.qti.choice",t_a:[{t:"Multiple select - choose one or more response.",l:"ENU"},{t:"Multiple select - choose one or more response.",l:"ENU"}]},{id:12244,m:"cm.widget.label.htmleditor",t_a:[{t:"Rich text editor - type your response.",l:"ENU"},{t:"Rich text editor - type your response.",l:"ENU"}]},{id:12245,m:"cm.widget.label.grid",t_a:[{t:"Grid Item.",l:"ENU"},{t:"Grid Item.",l:"ENU"}]},{id:12246,m:"cm.widget.label.qti.grid",t_a:[{t:"Grid Item.",l:"ENU"},{t:"Grid Item.",l:"ENU"}]},{id:12247,m:"cm.widget.label.qti.hottext",t_a:[{t:"Select text.",l:"ENU"},{t:"Select text.",l:"ENU"}]},{id:12248,m:"cm.widget.label.qti.order",t_a:[{t:"Reorder text.",l:"ENU"},{t:"Reorder text.",l:"ENU"}]},{id:12249,m:"cm.widget.label.select",t_a:[{t:"Select text.",l:"ENU"},{t:"Select text.",l:"ENU"}]},{id:12250,m:"cm.widget.label.order",t_a:[{t:"Drag and drop.",l:"ENU"},{t:"Drag and drop.",l:"ENU"}]},{id:12251,m:"cm.widget.label.dragdrop",t_a:[{t:"Drag and drop.",l:"ENU"},{t:"Drag and drop.",l:"ENU"}]},{id:12252,m:"cm.widget.label.matchitem",t_a:[{t:"Table of check boxes.",l:"ENU"},{t:"Table of check boxes.",l:"ENU"}]},{id:12253,m:"cm.widget.label.simulator",t_a:[{t:"Simulator item.",l:"ENU"},{t:"Simulator item.",l:"ENU"}]},{id:12254,m:"cm.widget.label.equationeditor",t_a:[{t:"Math response.",l:"ENU"},{t:"Math response.",l:"ENU"}]},{id:12255,m:"cm.widget.label.equationeditor.text",t_a:[{t:"Math response.",l:"ENU"},{t:"Math response.",l:"ENU"}]},{id:12256,m:"cm.widget.label.edittask",t_a:[{t:"Edit text.",l:"ENU"},{t:"Edit text.",l:"ENU"}]},{id:12257,m:"cm.widget.label.scratchpad",t_a:[{t:"Scratchpad.",l:"ENU"},{t:"Scratchpad.",l:"ENU"}]},{id:12258,m:"cm.widget.label.scaffolding",t_a:[{t:"Choose a response.",l:"ENU"},{t:"Choose a response.",l:"ENU"}]},{id:12259,m:"cm.widget.label.tableinput",t_a:[{t:"Fill in the table.",l:"ENU"},{t:"Fill in the table.",l:"ENU"}]},{id:12260,m:"cm.widget.label.mc",t_a:[{t:"Multiple choice.",l:"ENU"},{t:"Multiple choice.",l:"ENU"}]},{id:12261,m:"cm.widget.label.ebsr",t_a:[{t:"Two part multiple choice and/or multiple select.",l:"ENU"},{t:"Two part multiple choice and/or multiple select.",l:"ENU"}]},{id:12262,m:"cm.widget.label.wordbuilder",t_a:[{t:"Fill in the blank.",l:"ENU"},{t:"Fill in the blank.",l:"ENU"}]},{id:12263,m:"cm.widget.label.plaintext",t_a:[{t:"Type your response.",l:"ENU"},{t:"Type your response.",l:"ENU"}]},{id:12264,m:"TestShell.Link.Masking",t_a:[{t:"Masking",l:"ENU"},{t:"Encubrir",l:"ESN"}]},{id:12265,m:"TDS_F_FL_Math_4",t_a:[{t:"../tools/formulas/2010/fl_math_4.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_4.html",l:"ENU"}]},{id:12266,m:"TDS_F_FL_Math_5",t_a:[{t:"../tools/formulas/2010/fl_math_5.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_5.html",l:"ENU"}]},{id:12267,m:"TDS_F_FL_Math_6",t_a:[{t:"../tools/formulas/2010/fl_math_6.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_6.html",l:"ENU"}]},{id:12268,m:"TDS_F_FL_Math_7",t_a:[{t:"../tools/formulas/2010/fl_math_7.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_7.html",l:"ENU"}]},{id:12269,m:"TDS_F_FL_Math_8",t_a:[{t:"../tools/formulas/2010/fl_math_8.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_8.html",l:"ENU"}]},{id:12270,m:"TDS_F_FL_EOC_Algebra1",t_a:[{t:"../tools/formulas/2010/fl_math_eoc_algebra1.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_eoc_algebra1.html",l:"ENU"}]},{id:12271,m:"TDS_F_FL_EOC_Algebra2",t_a:[{t:"../tools/formulas/2010/fl_math_eoc_algebra2.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_eoc_algebra2.html",l:"ENU"}]},{id:12272,m:"TDS_F_FL_EOC_Geometry",t_a:[{t:"../tools/formulas/2010/fl_math_eoc_geometry.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_eoc_geometry.html",l:"ENU"}]},{id:12273,m:"TDS_F_FL_Math_5-6",t_a:[{t:"../tools/formulas/2010/fl_math_5-6.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_5-6.html",l:"ENU"}]},{id:12274,m:"TDS_F_FL_Math_7-8",t_a:[{t:"../tools/formulas/2010/fl_math_7-8.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_7-8.html",l:"ENU"}]},{id:12275,m:"TDS_F_FL_EOC_All",t_a:[{t:"../tools/formulas/2010/fl_math_eoc_all.html",l:"ENU"},{t:"../tools/formulas/2010/fl_math_eoc_all.html",l:"ENU"}]},{id:12201,m:"TDSCKE.Alert.InvalidRows.ENU",t_a:[{t:"Enter a number between 1 and 100 to define the number of rows.",l:"ENU"},{t:"Enter a number between 1 and 100 to define the number of rows.",l:"ENU"}]},{id:12202,m:"TDSCKE.Alert.InvalidCols.ENU",t_a:[{t:"Enter a number between 1 and 10 to define the number of columns.",l:"ENU"},{t:"Enter a number between 1 and 10 to define the number of columns.",l:"ENU"}]},{id:12203,m:"TestShell.Link.SystemSettings",t_a:[{t:"System Settings",l:"ENU"},{t:"Ajuste sistema",l:"ESN"}]},{id:12140,m:"TDS_F_UT_HS_PT",t_a:[{t:"../tools/formulas/2010/ut_hs_pt.html",l:"ENU"},{t:"../tools/formulas/2010/ut_hs_pt.html",l:"ENU"}]},{id:12141,m:"TDS_R_G35Argue",t_a:[{t:"../tools/rubrics/Utah/TDS_R_G35Argue.html",l:"ENU"},{t:"../tools/rubrics/Utah/TDS_R_G35Argue.html",l:"ENU"}]},{id:12142,m:"TDS_R_G35Inform",t_a:[{t:"../tools/rubrics/Utah/TDS_R_G35Inform.html",l:"ENU"},{t:"../tools/rubrics/Utah/TDS_R_G35Inform.html",l:"ENU"}]},{id:12143,m:"TDS_R_G68Argue",t_a:[{t:"../tools/rubrics/Utah/TDS_R_G68Argue.html",l:"ENU"},{t:"../tools/rubrics/Utah/TDS_R_G68Argue.html",l:"ENU"}]},{id:12144,m:"TDS_R_G68Inform",t_a:[{t:"../tools/rubrics/Utah/TDS_R_G68Inform.html",l:"ENU"},{t:"../tools/rubrics/Utah/TDS_R_G68Inform.html",l:"ENU"}]},{id:12145,m:"TDS_R_G911Argue",t_a:[{t:"../tools/rubrics/Utah/TDS_R_G911Argue.html",l:"ENU"},{t:"../tools/rubrics/Utah/TDS_R_G911Argue.html",l:"ENU"}]},{id:12146,m:"TDS_R_G911Inform",t_a:[{t:"../tools/rubrics/Utah/TDS_R_G911Inform.html",l:"ENU"},{t:"../tools/rubrics/Utah/TDS_R_G911Inform.html",l:"ENU"}]},{id:11946,m:"TDS_F_HI_AlgII",t_a:[{t:"../tools/formulas/2010/hi_Alg_EOC.html",l:"ENU"},{t:"../tools/formulas/2010/hi_Alg_EOC.html",l:"ENU"}]},{id:11947,m:"TDS.WordList.esnGlossary",t_a:[{t:"Spanish Glossary",l:"ENU"},{t:"Glosario espaol",l:"ESN"}]},{id:11960,m:"TestShell.Label.AudioTimeout",t_a:[{t:"Audio did not initialize properly. Do you want to try again?",l:"ENU"},{t:"El sonido no se ha inicializado correctamente. Quieres intentarlo de nuevo?",l:"ESN"}]},{id:11923,m:"TestShell.Segment.Denied",t_a:[{t:"Your request to enter the next segment has been denied.  You will now be logged out.",l:"ENU"},{t:"Su solicitud de  continuar con el siguiente segmento ha sido rechazada. Ahora se cerrar la sesin.",l:"ESN"}]},{id:11924,m:"TDS_F_AR_9_10Math",t_a:[{t:"../tools/formulas/2010/air_HS_math.html",l:"ENU"},{t:"../tools/formulas/2010/air_HS_math.html",l:"ENU"}]},{id:11925,m:"TDS_F_AR_6_8Math",t_a:[{t:"../tools/formulas/2010/air_6_8_math.html",l:"ENU"},{t:"../tools/formulas/2010/air_6_8_math.html",l:"ENU"}]},{id:11926,m:"TDS_F_AR_3_5Math",t_a:[{t:"../tools/formulas/2010/air_3_5_math.html",l:"ENU"},{t:"../tools/formulas/2010/air_3_5_math.html",l:"ENU"}]},{id:11713,m:"TestShell.Label.PeriodicTable",t_a:[{t:"Periodic Table",l:"ENU"},{t:"Tabla Peridica",l:"ESN"}]},{id:11731,m:"TDS_F_DE_EOC2Math",t_a:[{t:"../tools/formulas/2010/de_eoc2.html",l:"ENU"},{t:"../tools/formulas/2010/de_eoc2.html",l:"ENU"}]},{id:11743,m:"OptionalUnansweredResponses",t_a:[{t:"<p>You have not entered a response to one or more items on this page. </p>     <p>If this is correct, click [Yes] to proceed to the next page. </p>     <p>If not, click [No] to remain on this page.</p>",l:"ENU"},{t:"<p>Usted no ha registrado una respuesta a uno o ms elementos en esta pgina. </ p>S esto es correcto, haga clic en [S] para pasar a la pgina siguiente. </ p> Si no es correcto, haga clic en [No] para permanecer en esta pgina. </ p>",l:"ESN"}]},{id:11875,m:"TestItemScores",t_a:[{t:"Congratulations on finishing your test!  After reviewing your responses, click the [Test Results] button to log out.",l:"ENU"},{t:"Felicidades por terminar su prueba! Despus de revisar sus respuestas, haga clic en el botn de finalizar la prueba para cerrar la sesin.",l:"ESN"}]},{id:11876,m:"TestShell.Label.BlockPausing",t_a:[{t:"You may not pause the test until all questions on this page have been answered.",l:"ENU"},{t:"Usted no puede pausar la prueba hasta que se contesten todas las preguntas en esta pgina.",l:"ESN"}]},{id:11877,m:"SimulatorPlayingWhileSaving",t_a:[{t:"Please wait for the simulation to finish before saving your response.",l:"ENU"},{t:"Por favor espere a que la simulacin se termine antes de guardar su respuesta.",l:"ESN"}]},{id:11879,m:"SimulatorPlayingWhileNavigating",t_a:[{t:"Please wait for the simulation to finish before continuing.",l:"ENU"},{t:"Por favor espere a que la simulacin se termine antes de continuar.",l:"ESN"}]},{id:11881,m:"TestShell.Label.RemoveResponseWarning",t_a:[{t:"This action will clear all data for this item. Are you sure you want to proceed?<br/><br/>Click [Yes] to clear the data for this item.  Click [No] to cancel this action.",l:"ENU"},{t:"Esta accin borrar todos los datos para este artculo. Est seguro que desea continuar? <br/>Haga clic en [S] para borrar los datos para este artculo. Haga clic en [No] para cancelar esta accin.",l:"ESN"}]},{id:11882,m:"TestShell.Segment.ImpermeableIncomplete",t_a:[{t:"You may not leave this segment until all required questions have a response.",l:"ENU"},{t:"Usted no puede dejar este segmento hasta que todas las preguntas requeridas han sido contestadas.",l:"ESN"}]},{id:11883,m:"TestShell.Segment.LeaveWarning",t_a:[{t:"You cannot come back to this part of the test.  Are you sure you want to continue?",l:"ENU"},{t:"No puede regresar a esta parte del examen. Est seguro de que quiere continuar?",l:"ESN"}]},{id:12060,m:"TI.InvalidInput.alphaOnly",t_a:[{t:"This cell only accepts alpha characters A through Z.",l:"ENU"},{t:"This cell only accepts alpha characters A through Z.",l:"ENU"}]},{id:12061,m:"TI.InvalidInput.numericOnly",t_a:[{t:"This cell only accepts valid numerical data.",l:"ENU"},{t:"This cell only accepts valid numerical data.",l:"ENU"}]},{id:12062,m:"TI.InvalidInput.alphaNumericOnly",t_a:[{t:"This cell only accepts alphanumerical data.",l:"ENU"},{t:"This cell only accepts alphanumerical data.",l:"ENU"}]},{id:12063,m:"TI.InvalidInput.textOnly",t_a:[{t:"This cell accepts any type of input.",l:"ENU"},{t:"This cell accepts any type of input.",l:"ENU"}]},{id:11968,m:"TDS.WordList.thesaurus",t_a:[{t:"Thesaurus",l:"ENU"},{t:"Thesaurus",l:"ENU"}]},{id:11992,m:"TestShell.Fullscreen.PasswordRequest",t_a:[{t:"Please enter the password to exit fullscreen mode:",l:"ENU"},{t:"Please enter the password to exit fullscreen mode:",l:"ENU"}]},{id:11974,m:"TDS_PT_HTMLv2",t_a:[{t:"../tools/periodic/2010/periodic_standard.html",l:"ENU"},{t:"../tools/periodic/2010/periodic_standard.html",l:"ENU"}]},{id:11975,m:"TDS_F_OH_HS_Physics",t_a:[{t:"../tools/formulas/2010/oh_hs_physics.html",l:"ENU"},{t:"../tools/formulas/2010/oh_hs_physics.html",l:"ENU"}]},{id:11976,m:"TDS_F_UT_HS_Physics",t_a:[{t:"../tools/formulas/2010/ut_hs_physics.html",l:"ENU"},{t:"../tools/formulas/2010/ut_hs_physics.html",l:"ENU"}]},{id:11962,m:"TDS.WordList.glossary",t_a:[{t:"Glossary",l:"ENU"},{t:"Glosario",l:"ESN"}]},{id:11979,m:"TDS.WordList.arabicGlossary",t_a:[{t:"Arabic Glossary",l:"ENU"},{t:"Arabic Glossary",l:"ENU"}]},{id:11980,m:"TDS.WordList.vietnameseGlossary",t_a:[{t:"Vietnamese Glossary",l:"ENU"},{t:"Vietnamese Glossary",l:"ENU"}]},{id:11981,m:"TDS.WordList.cantoneseGlossary",t_a:[{t:"Cantonese Glossary",l:"ENU"},{t:"Cantonese Glossary",l:"ENU"}]},{id:11982,m:"TDS.WordList.mandarinGlossary",t_a:[{t:"Mandarin Glossary",l:"ENU"},{t:"Mandarin Glossary",l:"ENU"}]},{id:11983,m:"TDS.WordList.tagalGlossary",t_a:[{t:"Tagal Glossary",l:"ENU"},{t:"Tagal Glossary",l:"ENU"}]},{id:11984,m:"TDS.WordList.russianGlossary",t_a:[{t:"Russian Glossary",l:"ENU"},{t:"Russian Glossary",l:"ENU"}]},{id:11985,m:"TDS.WordList.koreanGlossary",t_a:[{t:"Korean Glossary",l:"ENU"},{t:"Korean Glossary",l:"ENU"}]},{id:11986,m:"TDS.WordList.punjabiGlossary",t_a:[{t:"Punjabi Glossary",l:"ENU"},{t:"Punjabi Glossary",l:"ENU"}]},{id:11987,m:"TDS.WordList.ukrainianGlossary",t_a:[{t:"Ukrainian Glossary",l:"ENU"},{t:"Ukrainian Glossary",l:"ENU"}]},{id:11990,m:"TDS_F_UT_HS_Science",t_a:[{t:"../tools/formulas/2010/ut_hs_science.html",l:"ENU"},{t:"../tools/formulas/2010/ut_hs_science.html",l:"ENU"}]}]},{c:"AccType",m_a:[{id:12053,m:"Scaffolding Voice Guidance",t_a:[{t:"Voice Guidance",l:"ENU"},{t:"Voice Guidance",l:"ENU"}]},{id:12044,m:"American Sign Language",t_a:[{t:"American Sign Language",l:"ENU"},{t:"American Sign Language",l:"ENU"}]},{id:12312,m:"Streamlined Mode",t_a:[{t:"Streamline",l:"ENU"},{t:"Streamline",l:"ENU"}]},{id:11269,m:"Student Comments",t_a:[{t:"Student Comments",l:"ENU"},{t:"Comentarios del estudiante",l:"ESN"}]},{id:11253,m:"Braille",t_a:[{t:"Braille",l:"ENU"},{t:"Braille",l:"ESN"}]},{id:11254,m:"Calculator",t_a:[{t:"Calculator",l:"ENU"},{t:"Calculadora",l:"ESN"}]},{id:11255,m:"Color Choices",t_a:[{t:"Color Contrast",l:"ENU"},{t:"Opciones de colores",l:"ESN"}]},{id:11256,m:"Passage Font Size",t_a:[{t:"Passage Font Size",l:"ENU"},{t:"Tamao de fuente",l:"ESN"}]},{id:11257,m:"Font Type",t_a:[{t:"Font Type",l:"ENU"},{t:"Tipo de fuente",l:"ESN"}]},{id:11258,m:"Formula",t_a:[{t:"Formula",l:"ENU"},{t:"Frmula",l:"ESN"}]},{id:11259,m:"Guide for Revision",t_a:[{t:"Guide for Revision",l:"ENU"},{t:"Pautas para la revisin ",l:"ESN"}]},{id:11260,m:"Highlight",t_a:[{t:"Highlighter",l:"ENU"},{t:"Resaltar",l:"ESN"}]},{id:11261,m:"Item Types Exclusion",t_a:[{t:"Item Types Exclusion",l:"ENU"},{t:"Exclusin de tipos de items",l:"ESN"}]},{id:11262,m:"Language",t_a:[{t:"Language",l:"ENU"},{t:"Idioma",l:"ESN"}]},{id:11263,m:"Mark for Review",t_a:[{t:"Mark for Review",l:"ENU"},{t:"Marcar para la revisin",l:"ESN"}]},{id:11264,m:"Parent Exempt",t_a:[{t:"Parent Exempt",l:"ENU"},{t:"Padres exentos",l:"ESN"}]},{id:11265,m:"Periodic Table",t_a:[{t:"Periodic Table",l:"ENU"},{t:"Tabla Peridica",l:"ESN"}]},{id:11266,m:"Print on Request",t_a:[{t:"Print on Demand",l:"ENU"},{t:"Imprimir segn solicitud",l:"ESN"}]},{id:11268,m:"Strikethrough",t_a:[{t:"Strikethrough",l:"ENU"},{t:"Tachar",l:"ESN"}]},{id:11270,m:"Tutorial",t_a:[{t:"Item Tutorials",l:"ENU"},{t:"Tutorial",l:"ESN"}]},{id:12236,m:"Word List",t_a:[{t:"Translations (Glossaries)",l:"ENU"},{t:"Translations (Glossaries)",l:"ENU"}]},{id:11611,m:"Braille Type",t_a:[{t:"Braille Type",l:"ENU"},{t:"Tipo de Braille",l:"ESN"}]},{id:11612,m:"Emboss",t_a:[{t:"Emboss",l:"ENU"},{t:"Grabar en relieve",l:"ESN"}]},{id:11613,m:"Emboss Request Type",t_a:[{t:"Emboss Request Type",l:"ENU"},{t:"Tipo de solicitud de relieve",l:"ESN"}]},{id:11614,m:"Offline Tester",t_a:[{t:"Offline Tester",l:"ENU"},{t:"Probador desconectado",l:"ESN"}]},{id:11615,m:"Suppress Score",t_a:[{t:"Suppress Score",l:"ENU"},{t:"Suprimir puntuacin",l:"ESN"}]},{id:11616,m:"TTX Business Rules",t_a:[{t:"Audio Settings",l:"ENU"},{t:"Audio Settings",l:"ENU"}]},{id:11267,m:"Print Size",t_a:[{t:"Zoom",l:"ENU"},{t:"Zoom",l:"ENU"}]},{id:11243,m:"TTS",t_a:[{t:"Text-to-Speech",l:"ENU"},{t:"Texto a voz",l:"ESN"}]}]},{c:"AccValue",m_a:[{id:11244,m:"TDS_TTS0",t_a:[{t:"No Text-to-Speech",l:"ENU"},{t:"Sin texto a voz",l:"ESN"}]},{id:11289,m:"TDS_CCMagenta",t_a:[{t:"Black on Rose",l:"ENU"},{t:"Black on Rose",l:"ENU"}]},{id:11326,m:"TDS_PoD_Stim&TDS_PoD_Item",t_a:[{t:"Passages and Items",l:"ENU"},{t:"Passages and Items",l:"ENU"}]},{id:11342,m:"TDS_TTS_Inst&TDS_TTS_Stim&TDS_TTS_Item",t_a:[{t:"Instructions, Stimuli and Items",l:"ENU"},{t:"Instructions, Stimuli and Items",l:"ENU"}]},{id:11347,m:"TDS_TTS_Stim&TDS_TTS_Item",t_a:[{t:"Passages and Items",l:"ENU"},{t:"Passages and Items",l:"ENU"}]},{id:11617,m:"TDS_BT_G1",t_a:[{t:"Uncontracted",l:"ENU"},{t:"Braille sin contracciones",l:"ESN"}]},{id:11618,m:"TDS_BT_G2",t_a:[{t:"Contracted",l:"ENU"},{t:"Braille contratado",l:"ESN"}]},{id:11619,m:"TDS_BT_NM",t_a:[{t:"Nemeth",l:"ENU"},{t:"Nemeth",l:"ESN"}]},{id:11620,m:"TDS_BT0",t_a:[{t:"Not Applicable",l:"ENU"},{t:"No aplicable",l:"ESN"}]},{id:11621,m:"TDS_Emboss_Item",t_a:[{t:"Item",l:"ENU"},{t:"Item",l:"ESN"}]},{id:11622,m:"TDS_Emboss_Stim",t_a:[{t:"Stimulus",l:"ENU"},{t:"Estmulo",l:"ESN"}]},{id:11623,m:"TDS_Emboss0",t_a:[{t:"None",l:"ENU"},{t:"Ninguno",l:"ESN"}]},{id:11624,m:"TDS_ERT_Auto",t_a:[{t:"Auto-Request",l:"ENU"},{t:"Auto-solicitud",l:"ESN"}]},{id:11625,m:"TDS_ERT_OR",t_a:[{t:"On-Request",l:"ENU"},{t:"Por demanda",l:"ESN"}]},{id:11626,m:"TDS_ERT0",t_a:[{t:"Not Applicable",l:"ENU"},{t:"No aplicable",l:"ESN"}]},{id:11627,m:"TDS_FT_Verdana",t_a:[{t:"Verdana",l:"ENU"},{t:"Verdana",l:"ESN"}]},{id:11628,m:"TDS_OfflineTester0",t_a:[{t:"N",l:"ENU"},{t:"No",l:"ESN"}]},{id:11629,m:"TDS_OfflineTester1",t_a:[{t:"Y",l:"ENU"},{t:"S",l:"ESN"}]},{id:11630,m:"TDS_PS_L0",t_a:[{t:"No default zoom applied",l:"ENU"},{t:"No se aplic ningn zoom predeterminado",l:"ESN"}]},{id:11631,m:"TDS_PS_L1",t_a:[{t:"Level 1",l:"ENU"},{t:"Nivel 1",l:"ESN"}]},{id:11632,m:"TDS_PS_L2",t_a:[{t:"Level 2",l:"ENU"},{t:"Nivel 2",l:"ESN"}]},{id:11633,m:"TDS_PS_L3",t_a:[{t:"Level 3",l:"ENU"},{t:"Nivel 3",l:"ESN"}]},{id:11634,m:"TDS_PS_L4",t_a:[{t:"Level 4",l:"ENU"},{t:"Nivel 4",l:"ESN"}]},{id:11635,m:"TDS_SCDropDown",t_a:[{t:"Drop-Down",l:"ENU"},{t:"Men desplegable",l:"ESN"}]},{id:11636,m:"TDS_SCNotepad",t_a:[{t:"Notepad",l:"ENU"},{t:"cuaderno",l:"ESN"}]},{id:11637,m:"TDS_SCTextArea",t_a:[{t:"Text Area",l:"ENU"},{t:"rea de texto",l:"ESN"}]},{id:11638,m:"TDS_SS0",t_a:[{t:"Display score to student",l:"ENU"},{t:"Mostrarle la puntuacin al estudiante",l:"ESN"}]},{id:11639,m:"TDS_SS1",t_a:[{t:"Do not display score to student",l:"ENU"},{t:"No mostrarle la puntuacin al estudiante",l:"ESN"}]},{id:11640,m:"TDS_TTX_0",t_a:[{t:"Read As-Is",l:"ENU"},{t:"Leer tal cual",l:"ESN"}]},{id:11641,m:"TDS_TTX_A202",t_a:[{t:"A202",l:"ENU"},{t:"A202",l:"ENU"}]},{id:11642,m:"TDS_TTX_A203",t_a:[{t:"A203",l:"ENU"},{t:"A203",l:"ENU"}]},{id:11643,m:"TDS_TTX_A204",t_a:[{t:"A204",l:"ENU"},{t:"A204",l:"ENU"}]},{id:11644,m:"TDS_TTX_A205",t_a:[{t:"A205",l:"ENU"},{t:"A205",l:"ENU"}]},{id:11271,m:"ENU",t_a:[{t:"English",l:"ENU"},{t:"Ingls",l:"ESN"}]},{id:11272,m:"ESN",t_a:[{t:"Spanish",l:"ENU"},{t:"Espaol",l:"ESN"}]},{id:11273,m:"HAW",t_a:[{t:"Hawaiian",l:"ENU"},{t:"Hawaiian",l:"ENU"}]},{id:11274,m:"TDS_Braille0",t_a:[{t:"FALSE",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11275,m:"TDS_Braille1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11276,m:"TDS_Calc0",t_a:[{t:"None",l:"ENU"},{t:"Ninguno",l:"ESN"}]},{id:11277,m:"TDS_CalcBasic",t_a:[{t:"Basic",l:"ENU"},{t:"Bsico",l:"ESN"}]},{id:11278,m:"TDS_CalcGraphing",t_a:[{t:"Graphing",l:"ENU"},{t:"Grfico",l:"ESN"}]},{id:11279,m:"TDS_CalcSci",t_a:[{t:"Scientific",l:"ENU"},{t:"Cientfico",l:"ESN"}]},{id:11280,m:"TDS_CalcStd",t_a:[{t:"Standard",l:"ENU"},{t:"Estndar",l:"ESN"}]},{id:11281,m:"TDS_CC0",t_a:[{t:"Black on White (default)",l:"ENU"},{t:"Negro sobre blanco",l:"ESN"}]},{id:11282,m:"TDS_CCBlue",t_a:[{t:"Blue",l:"ENU"},{t:"Azul",l:"ESN"}]},{id:11283,m:"TDS_CCBlue2",t_a:[{t:"Light Blue",l:"ENU"},{t:"Celeste",l:"ESN"}]},{id:11284,m:"TDS_CCGray",t_a:[{t:"Gray",l:"ENU"},{t:"Gris",l:"ESN"}]},{id:11285,m:"TDS_CCGray2",t_a:[{t:"Light Gray",l:"ENU"},{t:"Gris claro",l:"ESN"}]},{id:11286,m:"TDS_CCGreen",t_a:[{t:"Green",l:"ENU"},{t:"Verde",l:"ESN"}]},{id:11287,m:"TDS_CCGreen2",t_a:[{t:"Light Green",l:"ENU"},{t:"Verde claro",l:"ESN"}]},{id:11288,m:"TDS_CCInvert",t_a:[{t:"Reverse Contrast",l:"ENU"},{t:"Color invertido",l:"ESN"}]},{id:11290,m:"TDS_CCMagenta2",t_a:[{t:"Light Magenta",l:"ENU"},{t:"Magenta claro",l:"ESN"}]},{id:11291,m:"TDS_CCWhiteN",t_a:[{t:"White on Navy",l:"ENU"},{t:"Blanco sobre azul marino",l:"ESN"}]},{id:11292,m:"TDS_CCYellow",t_a:[{t:"Yellow",l:"ENU"},{t:"Amarillo",l:"ESN"}]},{id:11293,m:"TDS_CCYellow2",t_a:[{t:"Light Yellow",l:"ENU"},{t:"Amarillo claro",l:"ESN"}]},{id:11294,m:"TDS_CCYellowB",t_a:[{t:"Yellow on Blue",l:"ENU"},{t:"Amarillo sobre azul",l:"ESN"}]},{id:11295,m:"TDS_F_DE_2Math",t_a:[{t:"DE 2 Math",l:"ENU"},{t:"DE 2 Math",l:"ENU"}]},{id:11296,m:"TDS_F_DE_6_8Math",t_a:[{t:"DE 6-8 Math",l:"ENU"},{t:"DE 6-8 Math",l:"ENU"}]},{id:11297,m:"TDS_F_DE_9_10Math",t_a:[{t:"DE 9-10 Math",l:"ENU"},{t:"DE 9-10 Math",l:"ENU"}]},{id:11298,m:"TDS_F_HI_4Math",t_a:[{t:"HI 4 Math",l:"ENU"},{t:"HI 4 Math",l:"ENU"}]},{id:11299,m:"TDS_F_HI_5Math",t_a:[{t:"HI 5 Math",l:"ENU"},{t:"HI 5 Math",l:"ENU"}]},{id:11300,m:"TDS_F_HI_6Math",t_a:[{t:"HI 6 Math",l:"ENU"},{t:"HI 6 Math",l:"ENU"}]},{id:11301,m:"TDS_F_HI_7Math",t_a:[{t:"HI 7 Math",l:"ENU"},{t:"HI 7 Math",l:"ENU"}]},{id:11302,m:"TDS_F_OR3_5",t_a:[{t:"OR 3-5 Math",l:"ENU"},{t:"OR 3-5 Math",l:"ENU"}]},{id:11303,m:"TDS_F_ORCIM_Math",t_a:[{t:"OR CIM Math",l:"ENU"},{t:"OR CIM Math",l:"ENU"}]},{id:11304,m:"TDS_F_S12",t_a:[{t:"12pt",l:"ENU"},{t:"12pt",l:"ENU"}]},{id:11305,m:"TDS_F_S14",t_a:[{t:"14pt",l:"ENU"},{t:"14pt",l:"ENU"}]},{id:11306,m:"TDS_F0",t_a:[{t:"None",l:"ENU"},{t:"Ninguno",l:"ESN"}]},{id:11307,m:"TDS_F_HI_10Math",t_a:[{t:"HI 10 Math",l:"ENU"},{t:"HI 10 Math",l:"ENU"}]},{id:11308,m:"TDS_F_HI_11Sci",t_a:[{t:"HI 11 Science",l:"ENU"},{t:"HI 11 Science",l:"ENU"}]},{id:11309,m:"TDS_F_HI_8Math",t_a:[{t:"HI 8 Math",l:"ENU"},{t:"HI 8 Math",l:"ENU"}]},{id:11310,m:"TDS_FOR6_8Math",t_a:[{t:"OR 6-8 Math",l:"ENU"},{t:"OR 6-8 Math",l:"ENU"}]},{id:11311,m:"TDS_FT_San-Serif",t_a:[{t:"Sans-Serif (Arial)",l:"ENU"},{t:"Sans-Serif (Arial)",l:"ESN"}]},{id:11312,m:"TDS_FT_Serif",t_a:[{t:"Serif (Times)",l:"ENU"},{t:"Serif (Times)",l:"ESN"}]},{id:11313,m:"TDS_GfR0",t_a:[{t:"FALSE",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11314,m:"TDS_GfR1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11315,m:"TDS_Highlight0",t_a:[{t:"FALSE",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11316,m:"TDS_Highlight1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11317,m:"TDS_ItemTypeExcl_GI",t_a:[{t:"Grid Items",l:"ENU"},{t:"Ejercicios de la grilla",l:"ESN"}]},{id:11318,m:"TDS_ItemTypeExcl_NL",t_a:[{t:"NL Items",l:"ENU"},{t:"Ejercicios de NL",l:"ESN"}]},{id:11319,m:"TDS_ItemTypeExcl_None",t_a:[{t:"None",l:"ENU"},{t:"Ninguno",l:"ESN"}]},{id:11320,m:"TDS_MfR0",t_a:[{t:"FALSE",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11321,m:"TDS_MfR1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11322,m:"TDS_ParentExempt0",t_a:[{t:"FALSE",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11323,m:"TDS_ParentExempt1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11325,m:"TDS_PoD_Item",t_a:[{t:"Item",l:"ENU"},{t:"Artculo",l:"ESN"}]},{id:11327,m:"TDS_PoD_Stim",t_a:[{t:"Passages",l:"ENU"},{t:"Estmulos",l:"ESN"}]},{id:11328,m:"TDS_PoD0",t_a:[{t:"None",l:"ENU"},{t:"Ninguno",l:"ESN"}]},{id:11329,m:"TDS_PS_Larger",t_a:[{t:"Larger",l:"ENU"},{t:"Ms grande",l:"ESN"}]},{id:11330,m:"TDS_PS_Largest",t_a:[{t:"Largest",l:"ENU"},{t:"El mayor",l:"ESN"}]},{id:11331,m:"TDS_PS_Normal",t_a:[{t:"Normal",l:"ENU"},{t:"Normal",l:"ESN"}]},{id:11332,m:"TDS_PT_Basic",t_a:[{t:"Basic",l:"ENU"},{t:"Bsico",l:"ESN"}]},{id:11333,m:"TDS_PT_Expanded",t_a:[{t:"Expanded",l:"ENU"},{t:"Expandido",l:"ESN"}]},{id:11334,m:"TDS_PT_HTML",t_a:[{t:"HTML",l:"ENU"},{t:"HTML",l:"ESN"}]},{id:11335,m:"TDS_PT0",t_a:[{t:"None",l:"ENU"},{t:"Ninguno",l:"ESN"}]},{id:11336,m:"TDS_SC0",t_a:[{t:"Off",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11337,m:"TDS_SC1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11338,m:"TDS_ST0",t_a:[{t:"Off",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11339,m:"TDS_ST1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11340,m:"TDS_T0",t_a:[{t:"FALSE",l:"ENU"},{t:"FALSO",l:"ESN"}]},{id:11341,m:"TDS_T1",t_a:[{t:"TRUE",l:"ENU"},{t:"VERDADERO",l:"ESN"}]},{id:11343,m:"TDS_TTS_Inst",t_a:[{t:"Instructions",l:"ENU"},{t:"Instrucciones",l:"ESN"}]},{id:11344,m:"TDS_TTS_Item&TDS_TTS_Inst",t_a:[{t:"Instructions and Items",l:"ENU"},{t:"Instrucciones y ejercicios",l:"ESN"}]},{id:11345,m:"TDS_TTS_Item&TDS_TTS_Stim",t_a:[{t:"Items and Stimuli",l:"ENU"},{t:"tems y estmulos",l:"ESN"}]},{id:11346,m:"TDS_TTS_Item",t_a:[{t:"Items",l:"ENU"},{t:"Artculos",l:"ESN"}]},{id:11348,m:"TDS_TTS_Stim",t_a:[{t:"Stimuli",l:"ENU"},{t:"Estmulo",l:"ESN"}]},{id:12317,m:"TDS_ExpandablePassages0",t_a:[{t:"Expandable Passages Off",l:"ENU"},{t:"Expandable Passages Off",l:"ENU"}]},{id:12318,m:"TDS_ExpandablePassages1",t_a:[{t:"Expandable Passages On",l:"ENU"},{t:"Expandable Passages On",l:"ENU"}]},{id:12045,m:"TDS_ASL0",t_a:[{t:"Off",l:"ENU"},{t:"Off",l:"ENU"}]},{id:12051,m:"TDS_ASIGuide0",t_a:[{t:"Off",l:"ENU"},{t:"Off",l:"ENU"}]},{id:12052,m:"TDS_ASIGuide1",t_a:[{t:"On",l:"ENU"},{t:"On",l:"ENU"}]},{id:11991,m:"TDS_F_UT_HS_Science",t_a:[{t:"UT HS Science",l:"ENU"},{t:"UT HS Science",l:"ENU"}]},{id:11977,m:"TDS_F_OH_HS_Physics",t_a:[{t:"OH HS Physics",l:"ENU"},{t:"OH HS Physics",l:"ENU"}]},{id:11978,m:"TDS_F_UT_HS_Physics",t_a:[{t:"UT HS Physics",l:"ENU"},{t:"UT HS Physics",l:"ENU"}]},{id:11993,m:"TDS_TTX_M102",t_a:[{t:"M102",l:"ENU"},{t:"M102",l:"ENU"}]},{id:11994,m:"TDS_TTX_M101",t_a:[{t:"M101",l:"ENU"},{t:"M101",l:"ENU"}]},{id:12040,m:"TDS_TTX_U101",t_a:[{t:"U101",l:"ENU"},{t:"U101",l:"ENU"}]},{id:12042,m:"TDS_TTX_U102",t_a:[{t:"U102",l:"ENU"},{t:"U102",l:"ENU"}]},{id:11732,m:"TDS_F_DE_EOC2Math",t_a:[{t:"DE EOC2 Math",l:"ENU"},{t:"DE EOC2 Math",l:"ENU"}]},{id:11922,m:"TDS_CCMedGrayLtGray",t_a:[{t:"Medium Gray on Light Gray",l:"ENU"},{t:"Gris mediano sobre gris claro",l:"ESN"}]}]},{c:"Approval.aspx",m_a:[{id:11033,m:"StaticContent.Label.PleaseWait",t_a:[{t:"<p>Please wait while your Test Administrator reviews the settings for your test. This may take a few minutes...</p>",l:"ENU"},{t:"<p>Espere mientras el administrador de pruebs revisa la configuracin para su prueba. Esto puede tardar algunos minutos...</p>",l:"ESN"}]},{id:11034,m:"StaticContent.Label.IsYourTest",t_a:[{t:"Is the test listed above the test you want to take? If it is, click [Yes, Start My Test]. If not, click [No].</p>",l:"ENU"},{t:"La prueba que aparece arriba es la prueba que desea realizar? Si es as, haga clic en [S, comenzar la prueba], de lo contrario, haga clic en [No].</p> ",l:"ESN"}]},{id:11035,m:"StaticContent.Label.WaitForTA",t_a:[{t:"<p>Please wait while your Test Administrator reviews your test settings. This may take a few minutes...</p>",l:"ENU"},{t:"<p>Espere mientras el administrador de pruebs revisa la configuracin para su prueba. Esto puede tardar algunos minutos...</p>",l:"ESN"}]},{id:10987,m:"Approval.Label.WaitingForApproval",t_a:[{t:"Waiting for TA approval",l:"ENU"},{t:"Esperando aprobacin del AP",l:"ESN"}]},{id:10988,m:"Approval.Button.ClickToCancel",t_a:[{t:"Click to cancel the request and return to the login page.",l:"ENU"},{t:"Haga clic aqu para cancelar y regresar al inicio.",l:"ESN"}]},{id:10989,m:"Approval.Label.IsYourTest",t_a:[{t:"Is This Your Test?",l:"ENU"},{t:"Es sta su prueba?",l:"ESN"}]},{id:10990,m:"Approval.Label.YourTestSessionId",t_a:[{t:"Session ID:",l:"ENU"},{t:"ID de sesin:",l:"ESN"}]},{id:10991,m:"Approval.Label.YourTestTestName",t_a:[{t:"Test Name:",l:"ENU"},{t:"Nombre de la prueba:",l:"ESN"}]},{id:10992,m:"Approval.Label.YourTestLanguage",t_a:[{t:"Language:",l:"ENU"},{t:"Idioma:",l:"ESN"}]},{id:10993,m:"Approval.Label.YourTestPrintSize",t_a:[{t:"Print Size:",l:"ENU"},{t:"Tamao de impresin:",l:"ESN"}]},{id:10994,m:"Approval.Button.WrongAccomodation",t_a:[{t:"<span>No</span>",l:"ENU"},{t:"<span>No</span>",l:"ESN"}]},{id:10995,m:"Approval.Button.ApproveAccomodation",t_a:[{t:"<span>Yes, Start My Test</span>",l:"ENU"},{t:"<span>S, comenzar la prueba</span>",l:"ESN"}]},{id:10996,m:"Approval.Label.Wait",t_a:[{t:"Please Wait",l:"ENU"},{t:"Espere",l:"ESN"}]},{id:10997,m:"Approval.Label.TADenied",t_a:[{t:"The Test Administrator has denied your request.",l:"ENU"},{t:"El administrador de pruebas ha rechazado su solicitud.",l:"ESN"}]},{id:10998,m:"Approval.Label.TAMessage",t_a:[{t:"Message from your Test Administrator:",l:"ENU"},{t:"Mensaje del administrador de pruebas:",l:"ESN"}]},{id:10999,m:"Approval.Button.ClickToReturn",t_a:[{t:"Click here to return to the login screen.",l:"ENU"},{t:"Haga clic aqu para volver a la pantalla de inicio de sesin. ",l:"ESN"}]}]},{c:"Default.aspx",m_a:[{id:11224,m:"Browser.Button.RunDiagnosticsPrompt",t_a:[{t:'<a id="btnDiagnostic" href="http://demo.tds.airast.org/systemdiagnostic/pages/default.aspx?c=AIR&url=https://air.tds.uat.airast.org/student">Run Diagnostics</a>',l:"ENU"},{t:'<a id="btnDiagnostic" href="http://demo.tds.airast.org/systemdiagnostic/pages/default.aspx?c=AIR&url=https://air.tds.uat.airast.org/student">Realizar diagnstico</a>',l:"ESN"}]},{id:10889,m:"RequiredFirstName",t_a:[{t:"Enter your first name.",l:"ENU"},{t:"Ingrese su nombre.",l:"ESN"}]},{id:10890,m:"RequiredSSID",t_a:[{t:"Enter your Student ID.",l:"ENU"},{t:"Ingrese la ID de estudiante.",l:"ESN"}]},{id:10891,m:"RequiredSessionID",t_a:[{t:"Enter your Session ID.",l:"ENU"},{t:"Ingrese la ID de sesin que el administrador le asign.",l:"ESN"}]},{id:10894,m:"BrowserDeniedPT",t_a:[{t:"You cannot log in with this browser. Please use the latest Secure Browser or a supported Web browser. ",l:"ENU"},{t:"No puede ingresar con este navegador. Por favor utilice la ltima versin del navegador seguro o un explorador web compatible.",l:"ESN"}]},{id:10895,m:"BrowserUnsecure",t_a:[{t:"Use only the navigation buttons at the top of the screen.",l:"ENU"},{t:"Utilice slo los botones de navegacin en la parte superior de la pantalla.",l:"ESN"}]},{id:10896,m:"ErrorSignIn",t_a:[{t:"Your login did not work. Please try again or ask your Test Administrator for help.",l:"ENU"},{t:"No se pudo iniciar sesin. Intntelo nuevamente o consulte con el administrador de la prueba.",l:"ESN"}]},{id:10897,m:"ForbiddenApps",t_a:[{t:"You cannot log in until the following programs are closed:",l:"ENU"},{t:"No puede iniciar sesin hasta no salir de los siguientes programas:",l:"ESN"}]},{id:10920,m:"Login.Label.Prompt",t_a:[{t:"Please Sign In",l:"ENU"},{t:"Inicie sesin.",l:"ESN"}]},{id:10921,m:"User.Label.Guest",t_a:[{t:"Guest User",l:"ENU"},{t:"Usuario invitado",l:"ESN"}]},{id:10922,m:"User.Label.FirstName",t_a:[{t:"First Name:",l:"ENU"},{t:"Nombre:",l:"ESN"}]},{id:10924,m:"User.Label.Session",t_a:[{t:"Guest Session",l:"ENU"},{t:"Sesin de invitado",l:"ESN"}]},{id:10925,m:"User.Label.SessionID",t_a:[{t:"Session ID:",l:"ENU"},{t:"ID de sesin:",l:"ESN"}]},{id:10926,m:"Login.Button.SignIn",t_a:[{t:"<span>Sign In</span>",l:"ENU"},{t:"<span>Iniciar sesin</span>",l:"ESN"}]},{id:10927,m:"Browser.IncorrectBrowser.MacOSX106",t_a:[{t:"The wrong secure browser is installed on this computer. Please tell your Test Administrator. For now, you should use another computer.",l:"ENU"},{t:"Se instal el navegador seguro incorrecto en esta computadora. Consulte con el administrador de la prueba. Por ahora, debe usar otra computadora.",l:"ESN"}]},{id:10928,m:"Browser.IncorrectBrowser.MacOSX1039",t_a:[{t:"The wrong secure browser is installed on this computer. Please tell your Test Administrator. For now, you should use another computer.",l:"ENU"},{t:"Se instal el navegador seguro incorrecto en esta computadora. Consulte con el administrador de la prueba. Por ahora, debe usar otra computadora.",l:"ESN"}]},{id:10929,m:"Browser.Label.BrowserId",t_a:[{t:"Browser:",l:"ENU"},{t:"Navegador:",l:"ESN"}]},{id:10930,m:"Login.Label.IsThisYou",t_a:[{t:"Is This You?",l:"ENU"},{t:"Es ste usted?",l:"ESN"}]},{id:10931,m:"User.Label.Identified.Name",t_a:[{t:"Name:",l:"ENU"},{t:"Nombre:",l:"ESN"}]},{id:10934,m:"User.Label.Identified.Birthday",t_a:[{t:"Date of Birth:",l:"ENU"},{t:"Cumpleaos:",l:"ESN"}]},{id:10935,m:"User.Label.Identified.School",t_a:[{t:"School:",l:"ENU"},{t:"Escuela:",l:"ESN"}]},{id:10937,m:"User.Button.Identified.No",t_a:[{t:"<span>No</span>",l:"ENU"},{t:"<span>No</span>",l:"ESN"}]},{id:10938,m:"User.Button.Identified.Yes",t_a:[{t:"<span>Yes</span>",l:"ENU"},{t:"<span>S</span>",l:"ESN"}]},{id:10939,m:"User.List.Identified.SelectGradeList",t_a:[{t:"Select Grade",l:"ENU"},{t:"Seleccionar grado",l:"ESN"}]},{id:10940,m:"User.List.Identified.MustSelectGrade",t_a:[{t:"<-- You must select a grade",l:"ENU"},{t:"<-- Debe seleccionar un grado.",l:"ESN"}]},{id:11725,m:"BrowserUnsupported",t_a:[{t:"The web browser you are using was recently released and the American Institutes for Research has not finished testing its compatibility with this system. You may take tests using this browser if you choose to do so; however, there is a possibility that some features may not function correctly.",l:"ENU"},{t:"The web browser you are using was recently released and the American Institutes for Research has not finished testing its compatibility with this system. You may take tests using this browser if you choose to do so; however, there is a possibility that some features may not function correctly.",l:"ENU"}]},{id:10892,m:"InvalidFirstName",t_a:[{t:"Your first name and State-SSID do not match current records. Please try again or ask your Test Administrator for help.",l:"ENU"},{t:"Your first name and State-SSID do not match current records. Please try again or ask your Test Administrator for help.",l:"ENU"}]},{id:10893,m:"BrowserDenied",t_a:[{t:"Ask your Test Administrator to help you log into this site using the secure browser.",l:"ENU"},{t:"Ask your Test Administrator to help you log into this site using the secure browser.",l:"ENU"}]},{id:10923,m:"User.Label.ID",t_a:[{t:'State-SSID:<p style="font-size:0.6em;">(ex: ST-9999999123)</p>',l:"ENU"},{t:'State-SSID:<p style="font-size:0.6em;">(ex: ST-9999999123)</p>',l:"ENU"}]},{id:10932,m:"User.Label.Identified.StudentGradeLevel",t_a:[{t:"Grade:",l:"ENU"},{t:"Grade:",l:"ENU"}]},{id:10933,m:"User.Label.Identified.EnrolledGrade",t_a:[{t:"Grade:",l:"ENU"},{t:"Grade:",l:"ENU"}]},{id:10936,m:"User.Label.Identified.SSID",t_a:[{t:"State-SSID:",l:"ENU"},{t:"State-SSID:",l:"ENU"}]},{id:11028,m:"StaticContent.Label.PTIntroText",t_a:[{t:"\x3c!-- div blurb goes here --\x3e",l:"ENU"},{t:"\x3c!-- div blurb goes here --\x3e",l:"ENU"}]},{id:11029,m:"StaticContent.Label.OpLoginText",t_a:[{t:'<p>Welcome to the Smarter Balanced Assessments Student Testing Site!</p>  <ol type="1"><li>Please enter your first name, State-SSID and the Session ID in the fields above. Your Test Administrator will give you the Session ID.</li><li>Click [Sign In] to continue.</li></ol><hr />',l:"ENU"},{t:'<p>Welcome to the Smarter Balanced Assessments Student Testing Site!</p>  <ol type="1"><li>Please enter your first name, State-SSID and the Session ID in the fields above. Your Test Administrator will give you the Session ID.</li><li>Click [Sign In] to continue.</li></ol><hr />',l:"ENU"}]},{id:11030,m:"StaticContent.Label.PTLoginText",t_a:[{t:" <p><strong>For Students:</strong></p><p></p> <ol><li>Uncheck the Guest User and Guest Session checkboxes.</li><li>Enter your first name into the First Name box.</li><li>Enter your two-digit state code and your SSID into the State-SSID box.</li><li>Enter the Session ID that your TA gave you. </li><li>Click [Sign In].</li> </ol></p> <p><strong>Guest Users:</strong></p><p> To log in to the Practice and Training Tests, simply select [Sign In], then navigate through the login screens. </p>",l:"ENU"},{t:" <p><strong>For Students:</strong></p><p></p> <ol><li>Uncheck the Guest User and Guest Session checkboxes.</li><li>Enter your first name into the First Name box.</li><li>Enter your two-digit state code and your SSID into the State-SSID box.</li><li>Enter the Session ID that your TA gave you. </li><li>Click [Sign In].</li> </ol></p> <p><strong>Guest Users:</strong></p><p> To log in to the Practice and Training Tests, simply select [Sign In], then navigate through the login screens. </p>",l:"ENU"}]},{id:11031,m:"StaticContent.Label.PTLink",t_a:[{t:'<a class="goPractice" href="https://sbacpt.tds.airast.org/student">Click here to go to the Practice and Training Test Site</a>',l:"ENU"},{t:'<a class="goPractice" href="https://sbacpt.tds.airast.org/student">Click here to go to the Practice and Training Test Site</a>',l:"ENU"}]},{id:11032,m:"StaticContent.Label.IsThisYou",t_a:[{t:"Please review the information below. If all of the information is correct, click  [Yes]. If not, click [No].",l:"ENU"},{t:"Revise la siguiente informacin. Si la informacin es correcta, haga clic en [S], de lo contrario, haga clic en [No].",l:"ESN"}]},{id:11708,m:"Browser.IncorrectBrowser.MacOSX107",t_a:[{t:"The wrong secure browser is installed on this computer. Please tell your Test Administrator. For now, you should use another computer.",l:"ENU"},{t:"El navegador seguro equivocado est instalado en este equipo. Informe a su administrador de pruebas. Por ahora, tiene que utilizar otro ordenador.",l:"ESN"}]},{id:11885,m:"Login.TS.DescActive",t_a:[{t:"opportunity {0} of {1}",l:"ENU"},{t:"Oportunidad {0} de {1}",l:"ESN"}]},{id:11703,m:"Approval.Label.YourTestForm",t_a:[{t:"Test Forms:",l:"ENU"},{t:"Pruebas:",l:"ESN"}]},{id:11672,m:"Login.Label.MiscLinks",t_a:[{t:'<span style="display:none"><a href="https://air.tds.airast.org/test_scoreentry/repLogin.aspx?CSS=AIRDataEntry">Go to response/score entry site instead.</a></span>',l:"ENU"},{t:'<span style="display:none"><a href="https://air.tds.airast.org/test_scoreentry/repLogin.aspx?CSS=AIRDataEntry">en vez ir al sitio de puntuacin.</a></span>',l:"ESN"}]},{id:11673,m:"LoginDenied.Header",t_a:[{t:"Access Denied",l:"ENU"},{t:"Acceso denegado",l:"ESN"}]},{id:11744,m:"Browser.Denied.SpacesEnabled",t_a:[{t:'Your computer has "Spaces" enabled. This feature must be disabled before you can log in. Please ask your Test Administrator for help.',l:"ENU"},{t:'Su equipo tiene "Espacios" habilitados. Esta funcin debe ser desactivada antes de iniciar la sesin Por favor, consulte con su administrador de pruebas para obtener ayuda.',l:"ESN"}]},{id:11970,m:"BrowserDeniedTest",t_a:[{t:"You cannot take this test with this browser.",l:"ENU"},{t:"You cannot take this test with this browser.",l:"ENU"}]},{id:12237,m:"Browser.Denied.VMwareUncertified",t_a:[{t:"This browser is running on virtualization software that is not approved for secure testing.",l:"ENU"},{t:"This browser is running on virtualization software that is not approved for secure testing.",l:"ENU"}]},{id:12304,m:"User.Label.Identified.ID",t_a:[{t:"SSID:",l:"ENU"},{t:"SSID:",l:"ENU"}]},{id:12356,m:"responserecovery.Submit",t_a:[{t:"Submit",l:"ENU"},{t:"Submit",l:"ENU"}]},{id:12357,m:"responserecovery.Cancel",t_a:[{t:"Cancel",l:"ENU"},{t:"Cancel",l:"ENU"}]},{id:12358,m:"responserecovery.menuHeader",t_a:[{t:"Saved Drafts",l:"ENU"},{t:"Saved Drafts",l:"ENU"}]},{id:12359,m:"responserecovery.menuSessionLabel",t_a:[{t:"Sitting {index} ({label})",l:"ENU"},{t:"Sitting {index} ({label})",l:"ENU"}]},{id:12360,m:"responserecovery.menuVersionLabel",t_a:[{t:"Version {sequence} - {count} characters",l:"ENU"},{t:"Version {sequence} - {count} characters",l:"ENU"}]},{id:12361,m:"responserecovery.sessionLabel",t_a:[{t:"{month}/{day}/{year}",l:"ENU"},{t:"{month}/{day}/{year}",l:"ENU"}]},{id:12362,m:"responserecovery.sessionLabelCurrent",t_a:[{t:"Now",l:"ENU"},{t:"Now",l:"ENU"}]},{id:12363,m:"responserecovery.toolText",t_a:[{t:"Response Recovery",l:"ENU"},{t:"Response Recovery",l:"ENU"}]},{id:12364,m:"responserecovery.saveMessage",t_a:[{t:"Saving response",l:"ENU"},{t:"Saving response",l:"ENU"}]},{id:12365,m:"responserecovery.previewPlaceholder",t_a:[{t:"",l:"ENU"},{t:"",l:"ENU"}]}]},{c:"Diagnostic.aspx",m_a:[{id:11236,m:"StaticContent.Label.gridtraining",t_a:[{t:'<p>Some advanced test questions require a student to draw a picture, or complete another type of open-ended task.  <a href="https://sbacpt.tds.airast.org/grid/default.aspx">Click here for examples of these open-ended questions</a>.</p>    <p>The Online Testing System and the secure browser have security measures that prevent forbidden applications from being active during a test opportunity. <a href="ProcessListTest3.html">Click here to try the Forbidden Applications Demonstration</a>.</p>',l:"ENU"},{t:'<p>Some advanced test questions require a student to draw a picture, or complete another type of open-ended task.  <a href="https://sbacpt.tds.airast.org/grid/default.aspx">Click here for examples of these open-ended questions</a>.</p>    <p>The Online Testing System and the secure browser have security measures that prevent forbidden applications from being active during a test opportunity. <a href="ProcessListTest3.html">Click here to try the Forbidden Applications Demonstration</a>.</p>',l:"ENU"}]}]},{c:"Diagnostics.xml",m_a:[{id:11044,m:"StaticContent.Label.gridtraining",t_a:[{t:' <p>Some advanced java-based test questions require a student to draw a picture, or complete another type of open-ended task.  <a href="https://airpt.tds.airast.org/grid/DemoTraining.aspx">Click here for examples of these open-ended questions</a>.</p> ',l:"ENU"},{t:'<p>Algunas preguntas avanzadas basadas en java  requieren que los estudiantes realicen un dibujo o completen otro tipo de tarea sin plazo definido. <a href="https://airpt.tds.airast.org/grid/default.aspx">Haga clic aqu para obtener ejemplos de estas preguntas sin plazo definido</a>.</p>    ',l:"ESN"}]}]},{c:"Global",m_a:[{id:11686,m:"Global.Label.MissingContextInfo",t_a:[{t:"There was a problem with the system.  You will be logged out.",l:"ENU"},{t:"Se produjo un problema con el sistema se cerrar la sesin.",l:"ESN"}]},{id:12350,m:"Global.Label.PopupBlockerMessage",t_a:[{t:"This site requires popups to work properly. Please disable your popup blocker for this site, then click [Try again].",l:"ENU"},{t:"This site requires popups to work properly. Please disable your popup blocker for this site, then click [Try again].",l:"ENU"}]},{id:11865,m:"Global.Label.LogoutVerify",t_a:[{t:"Are you sure you want to log out?",l:"ENU"},{t:"Est seguro de que desea cerrar la sesin?",l:"ESN"}]}]},{c:"Notification.aspx",m_a:[{id:11045,m:"Notification.Label.Problem",t_a:[{t:"There was a problem with the system.  Please give this number to your Test Administrator.",l:"ENU"},{t:"Se produjo un problema con el sistema.  Proporcione este nmero al administrador de pruebas.",l:"ESN"}]},{id:11046,m:"Notification.Link.GoToLoginScreen",t_a:[{t:"Return to the login screen.",l:"ENU"},{t:"Volver a la pantalla de inicio de sesin.",l:"ESN"}]}]},{c:"Opportunity.aspx",m_a:[{id:11036,m:"StaticContent.Label.ChooseTest",t_a:[{t:"Select a test.",l:"ENU"},{t:"Seleccione la prueba que desea realizar.",l:"ESN"}]},{id:11037,m:"StaticContent.Label.TestOpp",t_a:[{t:'<p class="selectTest"> </p>',l:"ENU"},{t:'<p class="selectTest"> </p>',l:"ESN"}]},{id:10948,m:"Opportunity.Table.TestsTable.TestName",t_a:[{t:"Test Name",l:"ENU"},{t:"Nombre de la prueba",l:"ESN"}]},{id:10949,m:"Opportunity.Table.TestsTable.Opportunity",t_a:[{t:"Opportunities*",l:"ENU"},{t:"Oportunidades*",l:"ESN"}]},{id:10950,m:"Opportunity.Table.TestsTable.Action",t_a:[{t:"Action",l:"ENU"},{t:"Accin",l:"ESN"}]},{id:10951,m:"Opportunity.Button.BackToLogin",t_a:[{t:"<span>Back to Login</span>",l:"ENU"},{t:"<span>Volver al inicio de sesin</span>",l:"ESN"}]},{id:10952,m:"Opportunity.Label.TAApproval",t_a:[{t:"Waiting for TA Approval",l:"ENU"},{t:"Esperando aprobacin del AP",l:"ESN"}]},{id:10953,m:"Opportunity.Button.ClickHere",t_a:[{t:"Click to cancel the request and return to the login page.",l:"ENU"},{t:"Haga clic aqu para cancelar y volver al inicio.",l:"ESN"}]},{id:10954,m:"Opportunity.Label.TestConfirmation",t_a:[{t:"Is This Your Test?",l:"ENU"},{t:"Es sta su prueba?",l:"ESN"}]},{id:10955,m:"Opportunity.Label.SessionID",t_a:[{t:"Session ID:",l:"ENU"},{t:"ID de sesin:",l:"ESN"}]},{id:10956,m:"Opportunity.Label.TestName",t_a:[{t:"Test Name:",l:"ENU"},{t:"Nombre de la prueba:",l:"ESN"}]},{id:10957,m:"Opportunity.Button.AcceptTest.No",t_a:[{t:"<span>No</span>",l:"ENU"},{t:"<span>No</span>",l:"ESN"}]},{id:10958,m:"Opportunity.Button.AcceptTest.Yes",t_a:[{t:"<span>Yes, Start My Test</span>",l:"ENU"},{t:"<span>S, comenzar la prueba</span>",l:"ESN"}]},{id:10959,m:"Opportunity.Label.PleaseWait",t_a:[{t:"Please Wait",l:"ENU"},{t:"Espere",l:"ESN"}]},{id:10960,m:"Opportunity.Label.Denied",t_a:[{t:"The Test Administrator has denied your request.",l:"ENU"},{t:"El administrador de pruebas ha rechazado su solicitud.",l:"ESN"}]},{id:10961,m:"Opportunity.Label.TAMessage",t_a:[{t:"Message from your Test Administrator:",l:"ENU"},{t:"Mensaje del administrador de pruebas:",l:"ESN"}]},{id:10962,m:"Opportunity.Label.ReturnMessage",t_a:[{t:"Click here to return to the login screen.",l:"ENU"},{t:"Haga clic aqu para volver a la pantalla de inicio de sesin. ",l:"ESN"}]},{id:10963,m:"Opportunity.Javascript.NoFlash",t_a:[{t:"Flash {0} or higher is needed to take this test. Ask your Test Administrator for help.",l:"ENU"},{t:"Se necesita Flash {0} o una versin superior para realizar esta prueba. Consulte a su administrador de pruebas.",l:"ESN"}]},{id:10964,m:"Opportunity.Javascript.NoJava",t_a:[{t:"Java {0} or higher is required for this test. Ask your Test Administrator for help.",l:"ENU"},{t:"Se necesita Java {0} o una versin superior para realizar esta prueba. Consulte a su administrador de pruebas.",l:"ESN"}]},{id:10965,m:"Opportunity.Javascript.JavaDetected",t_a:[{t:"Java was successfully detected.",l:"ENU"},{t:"Java se detect correctamente.",l:"ESN"}]},{id:10966,m:"Opportunity.Javascript.DetectingJava",t_a:[{t:"Please wait while we detect whether Java is installed.",l:"ENU"},{t:"Espere mientras se detecta si Java est instalado.",l:"ESN"}]},{id:11120,m:"Opportunity.Javascript.ValidatingTest",t_a:[{t:"Checking test, please wait",l:"ENU"},{t:"Verificando prueba, espere...",l:"ESN"}]},{id:11121,m:"Opportunity.Javascript.SubmittingTest",t_a:[{t:"Test is starting, please wait",l:"ENU"},{t:"La prueba est comenzando, espere",l:"ESN"}]},{id:11570,m:"No opportunities are available for this test",t_a:[{t:"This test has no more opportunities.",l:"ENU"},{t:"No hay ms oportunidades para realizar esta prueba.",l:"ESN"}]},{id:11571,m:"Your next test opportunity is not yet available.",t_a:[{t:"You cannot take this test until {0}.",l:"ENU"},{t:"No puede realizar esta prueba hasta {0}.",l:"ESN"}]},{id:11572,m:"Current opportunity is active",t_a:[{t:"The current opportunity is active.",l:"ENU"},{t:"La oportunidad actual est activa",l:"ESN"}]},{id:10941,m:"Opportunity.Label.PageMessage",t_a:[{t:"Your Tests",l:"ENU"},{t:"Pruebas",l:"ESN"}]},{id:10942,m:"Opportunity.Label.PageMessageSettings",t_a:[{t:"Test Settings (Optional):",l:"ENU"},{t:"Configuracin de la prueba (opcional):",l:"ESN"}]},{id:10943,m:"Opportunity.Label.Language",t_a:[{t:"Language:",l:"ENU"},{t:"Idioma:",l:"ESN"}]},{id:10944,m:"Opportunity.Label.PrintSize",t_a:[{t:"Print Size:",l:"ENU"},{t:"Tamao de impresin:",l:"ESN"}]},{id:10945,m:"Opportunity.List.PrintSize.Normal",t_a:[{t:"Normal",l:"ENU"},{t:"Normal",l:"ESN"}]},{id:10946,m:"Opportunity.List.PrintSize.Large",t_a:[{t:"Larger",l:"ENU"},{t:"Ms grande",l:"ESN"}]},{id:10947,m:"Opportunity.List.PrintSize.VeryLarge",t_a:[{t:"Largest",l:"ENU"},{t:"El ms grande",l:"ESN"}]},{id:11222,m:"Opportunity.Link.StartTest",t_a:[{t:"Start Test",l:"ENU"},{t:"Comenzar prueba",l:"ESN"}]},{id:11223,m:"Opportunity.Link.ResumeTest",t_a:[{t:"Resume Test",l:"ENU"},{t:"Reanudar prueba",l:"ESN"}]},{id:11884,m:"Opportunity.Label.NoTests",t_a:[{t:"No tests are available at this time.",l:"ENU"},{t:"No hay pruebas disponibles en este momento.",l:"ESN"}]}]},{c:"ReviewShell",m_a:[{id:11736,m:"TestShellScripts.Label.Questions",t_a:[{t:"Questions:",l:"ENU"},{t:"Preguntas:",l:"ESN"}]},{id:12235,m:"TestReview.Label.ItemNavigation",t_a:[{t:"Select question(s) to review:",l:"ENU"},{t:"Select question(s) to review:",l:"ENU"}]}]},{c:"SoundCheck.aspx",m_a:[{id:12234,m:"SoundCheck.Label.SourceSelect",t_a:[{t:"Select New Recording Device",l:"ENU"},{t:"Select New Recording Device",l:"ENU"}]},{id:12232,m:"SoundCheck.Label.RecordingProblem",t_a:[{t:"Problem Recording Audio",l:"ENU"},{t:"Problem Recording Audio",l:"ENU"}]},{id:12240,m:"SoundCheck.Label.SliderVolume",t_a:[{t:"Volume",l:"ENU"},{t:"Volume",l:"ENU"}]},{id:11965,m:"SoundCheck.RecorderRequired.Header",t_a:[{t:"Recorder Plug-in Not Installed",l:"ENU"},{t:"Plug-in de grabadaora no instalado",l:"ESN"}]},{id:11966,m:"SoundCheck.RecorderRequired.Text",t_a:[{t:"<p>The recorder requires a plug-in to be installed when using Firefox. </p>\r\n<p>You may use the secure browser instead of Firefox to access the sound check and recorder check.</p>",l:"ENU"},{t:"<p> La grabadora requiere un plug-in cuando se utiliza el navegador Firefox. </ p> Usted puede utilizar el navegador seguro en lugar de Firefox para acceder al comprobar de sonido y el comprobador de la grabadora. </ p>",l:"ESN"}]},{id:10967,m:"SoundCheck.Label.DidYouHear",t_a:[{t:"Sound Check",l:"ENU"},{t:"Verificacin de sonido: Escucha la voz?",l:"ESN"}]},{id:10968,m:"SoundCheck.Label.ClickToHear",t_a:[{t:"Click on the sound icon to hear the sound.",l:"ENU"},{t:"Haga clic en el icono de sonido para escuchar el sonido.",l:"ESN"}]},{id:10969,m:"SoundCheck.Label.HeardYesOrNo",t_a:[{t:"If you hear the sound, click  [Yes]. If not, click [No].",l:"ENU"},{t:"Si escucha el sonido, haga clic en [S], de lo contrario, haga clic en [No].",l:"ESN"}]},{id:10970,m:"SoundCheck.Label.HeardYes",t_a:[{t:"<span>Yes</span>",l:"ENU"},{t:"<span>S</span>",l:"ESN"}]},{id:10971,m:"SoundCheck.Label.HeardNo",t_a:[{t:"<span>No</span>",l:"ENU"},{t:"<span>No</span>",l:"ESN"}]},{id:10972,m:"SoundCheck.Label.RecordAndPlay",t_a:[{t:"Sound Check: Record Your Voice",l:"ENU"},{t:"Verificacin de sonido: Grabe su voz.",l:"ESN"}]},{id:10973,m:"SoundCheck.Button.StartStopRecording",t_a:[{t:"Start/Stop Recording",l:"ENU"},{t:"Comenzar/detener grabacin",l:"ESN"}]},{id:10974,m:"SoundCheck.Button.Start",t_a:[{t:"Start at Beginning",l:"ENU"},{t:"Comenzar al principio",l:"ESN"}]},{id:10975,m:"SoundCheck.Button.Play",t_a:[{t:"Play/Pause",l:"ENU"},{t:"Reproducir/Pausa",l:"ESN"}]},{id:10976,m:"SoundCheck.Label.SoundCheckInstructions",t_a:[{t:"<ol><li>Press the Microphone button to start recording.</li><li>Say your name into your microphone.</li><li>When you are done, press the Stop button.</li><li>Press the Play button to listen to your recording.</li><li>If you hear your voice, click [Yes]. If you do not hear your voice, click [Problem (No)].</li></ol>",l:"ENU"},{t:"<ol> <li>Presione el botn Micrfono para iniciar la grabacin. </li> <li>Diga su nombre por el micrfono. </li> <li>Cuando haya terminado, pulse el botn Stop. </li> <li>Luego presione el botn de reproduccin para escuchar la grabacion.</li><li>Si escucha su voz, haga clic en  [S]. De lo contrario, haga clic en [Problema].</li></ol>",l:"ESN"}]},{id:10977,m:"SoundCheck.Button.InstructionsFollowUpYes",t_a:[{t:"<span>Yes</span>",l:"ENU"},{t:"<span>S</span>",l:"ESN"}]},{id:10978,m:"SoundCheck.Button.InstructionsFollowUpNo",t_a:[{t:"<span>Problem (No)</span>",l:"ENU"},{t:"<span>Problema (No)</span>",l:"ESN"}]},{id:10979,m:"SoundCheck.Label.AudioProblem",t_a:[{t:"Sound Check: Audio Problem",l:"ENU"},{t:"Verificacin de sonido: Problema de audio",l:"ESN"}]},{id:10980,m:"SoundCheck.Label.TellAdminMessage",t_a:[{t:"Tell the Test Administrator that you have an audio problem. Playing and recording sound is required for this test.",l:"ENU"},{t:"Avsele al administrador de la prueba que tiene un problema de audio. Debe reproducir y grabar para esta prueba.",l:"ESN"}]},{id:10981,m:"SoundChecl.Label.LogoutOnAudioError",t_a:[{t:"<span>Log Out</span>",l:"ENU"},{t:"<span>Cerrar sesin</span>",l:"ESN"}]},{id:10982,m:"SoundCheck.Label.TryAgain",t_a:[{t:"<span>Try Again</span>",l:"ENU"},{t:"<span>Intentar nuevamente</span>",l:"ESN"}]},{id:10983,m:"SoundCheck.Label.Java14Required",t_a:[{t:"Java 1.4 or higher is required for this test.",l:"ENU"},{t:"Se necesita Java 1.4 o una versin superior para realizar esta prueba.",l:"ESN"}]},{id:10984,m:"SoundCheck.Button.LogoutOnJavaError",t_a:[{t:"<span>Log Out</span>",l:"ENU"},{t:"<span>Cerrar sesin</span>",l:"ESN"}]},{id:10985,m:"SoundCheck.Label.Flash9Required",t_a:[{t:"Flash 10 or higher is required for this test.",l:"ENU"},{t:"Se necesita Flash 10 o una versin superior para realizar esta prueba.",l:"ESN"}]},{id:10986,m:"SoundCheck.Label.LogoutOnFlashError",t_a:[{t:"<span>Log Out</span>",l:"ENU"},{t:"<span>Cerrar sesin</span>",l:"ESN"}]}]},{c:"Student.Master",m_a:[{id:11005,m:"StudentMaster.Button.Close",t_a:[{t:"Close Secure Browser",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:11006,m:"StudentMaster.Button.Help",t_a:[{t:"Help",l:"ENU"},{t:"Ayuda",l:"ESN"}]},{id:11007,m:"StudentMaster.Label.StudentInterface",t_a:[{t:"Student Testing Site",l:"ENU"},{t:"Interfaz del estudiante",l:"ESN"}]},{id:11008,m:"StudentMaster.Label.HelpGuider",t_a:[{t:"Help Guide",l:"ENU"},{t:"Gua de ayuda",l:"ESN"}]},{id:11009,m:"StudentMaster.Button.PopUpClose",t_a:[{t:"Close",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:11227,m:"StudentMaster.StaticContent.StudentPTTag",t_a:[{t:"Student Testing Site",l:"ENU"},{t:"Interfaz del Estudiante",l:"ESN"}]},{id:11698,m:"Global.Label.SSID",t_a:[{t:"State-SSID",l:"ENU"},{t:"State-SSID",l:"ENU"}]},{id:11228,m:"StudentMaster.StaticContent.Header",t_a:[{t:"Smarter Balanced Assessment Consortium",l:"ENU"},{t:"Smarter Balanced Assessment Consortium",l:"ENU"}]},{id:11229,m:"StudentMaster.StaticContent.Address",t_a:[{t:"\x3c!--<span>Smarter Balanced Assessment Consortium</span><br />      Address 1<br />     Address 2<br />--\x3e",l:"ENU"},{t:"\x3c!--<span>Smarter Balanced Assessment Consortium</span><br />      Address 1<br />     Address 2<br />--\x3e",l:"ENU"}]},{id:11463,m:"StudentMaster.Label.SessionID",t_a:[{t:"Session ID:",l:"ENU"},{t:"ID de sesin:",l:"ESN"}]},{id:11460,m:"StudentMaster.Label.ChooseAccommodations",t_a:[{t:"Choose Settings:",l:"ENU"},{t:"Elegir adaptaciones:",l:"ESN"}]},{id:11522,m:"TestInstructions.Label.Help",t_a:[{t:'<span class="hasTTS">Select the text you want to hear and clickthe green buttonto have it played.</span>',l:"ENU"},{t:'<span class="hasTTS">Seleccione el texto que desea escuchar y haga clic en el botn verde para reproducirlo.</span>',l:"ESN"}]},{id:11560,m:"TestInstructions.Label.NoTTSHelp",t_a:[{t:'<span class="noTTS">Text-to-Speech is not available.</span>',l:"ENU"},{t:'<span class="noTTS">La funcin texto a voz no est disponible.</span>',l:"ESN"}]},{id:11662,m:"StudentMaster.Button.Logout",t_a:[{t:"Log Out",l:"ENU"},{t:"Cerrar Sesin",l:"ESN"}]}]},{c:"TDSAudio",m_a:[{id:11010,m:"TDSAudio.Link.TitleAudioOption",t_a:[{t:"Audio Option ",l:"ENU"},{t:"Opcin de audio ",l:"ESN"}]},{id:11011,m:"TDSAudio.Link.TitleAudioQuestion",t_a:[{t:"Audio Question",l:"ENU"},{t:"Pregunta de audio",l:"ESN"}]},{id:11012,m:"TDSAudio.Link.TitleAudioStem",t_a:[{t:"Audio Stem",l:"ENU"},{t:"Recurso de audio",l:"ESN"}]},{id:11013,m:"TDSAudio.MenuItems.StopRecording",t_a:[{t:"Stop Recording",l:"ENU"},{t:"Detener grabacin",l:"ESN"}]},{id:11014,m:"TDSAudio.MenuItems.StopPlayingRecording",t_a:[{t:"Stop Playing Recording",l:"ENU"},{t:"Detener reproduccin de grabacin",l:"ESN"}]},{id:11015,m:"TDSAudio.MenuItems.StartRecording",t_a:[{t:"Start Recording",l:"ENU"},{t:"Comenzar grabacin",l:"ESN"}]},{id:11016,m:"TDSAudio.MenuItems.PlayRecording",t_a:[{t:"Play Recording",l:"ENU"},{t:"Reproducir grabacin",l:"ESN"}]}]},{c:"TDSContent",m_a:[{id:11017,m:"TDSContent.ContentManager.TTS_SPEAKTEXT",t_a:[{t:"Speak Selected Text",l:"ENU"},{t:"Diga el texto seleccionado",l:"ESN"}]},{id:11018,m:"TDSContent.ContentManager.TTS_SPEAKSECTION",t_a:[{t:"Speak {title}",l:"ENU"},{t:"Diga {title}",l:"ESN"}]},{id:11019,m:"TDSContent.ContentManager.TTS_STOP",t_a:[{t:"Stop Speaking",l:"ENU"},{t:"Deje de hablar",l:"ESN"}]},{id:11020,m:"TDSContent.ContentManager.HIGHLIGHT_TEXT",t_a:[{t:"Highlight Selection",l:"ENU"},{t:"Resaltar seleccin",l:"ESN"}]},{id:11021,m:"TDSContent.ContentManager.HIGHLIGHT_CLEAR",t_a:[{t:"Reset Highlighting",l:"ENU"},{t:"Restablecer resaltado",l:"ESN"}]}]},{c:"TDSEditor",m_a:[{id:11022,m:"TDSEditor.MenuItems.Data.GoToEditor",t_a:[{t:"Go To Text Editor",l:"ENU"},{t:"Ir al editor de texto",l:"ESN"}]}]},{c:"TDSGrid",m_a:[{id:11023,m:"TDSGrid.PopUp.ProblemWithInternet",t_a:[{t:"There is a problem connecting to the Internet. Pause your test and try again.",l:"ENU"},{t:"Se produjo un problema al conectarse con Internet. Ponga la prueba en pausa e intntelo nuevamente.",l:"ESN"}]}]},{c:"TDSWriting",m_a:[{id:11026,m:"TDSWriting.PopUp.ChangePrompt",t_a:[{t:"Are you sure you want to change the prompt you previously selected? <Yes> <No>",l:"ENU"},{t:"Est seguro de que desea cambiar el tema que seleccion anteriormente? <S> <No>",l:"ESN"}]}]},{c:"TDSWritingHTML",m_a:[{id:11027,m:"TDSWritingHTML.PopUp.ChangePrompt",t_a:[{t:"Are you sure you want to change the prompt you previously selected? <Yes> <No>",l:"ENU"},{t:"Est seguro de que desea cambiar el tema que seleccion anteriormente? <S> <No>",l:"ESN"}]}]},{c:"TestInstructions.aspx",m_a:[{id:11038,m:"StaticContent.Label.AdditionalHelp",t_a:[{t:"Scroll down for more information.",l:"ENU"},{t:"Desplcese hacia abajo para obtener informacin adicional.",l:"ESN"}]},{id:11e3,m:"TestInstructions.Label.TestInstructions",t_a:[{t:"Test Instructions and Help",l:"ENU"},{t:"Instrucciones y ayuda para la prueba",l:"ESN"}]},{id:11001,m:"TestInstructions.Label.ClickImagePart1",t_a:[{t:"Click the question mark button",l:"ENU"},{t:"Haga clic [?]",l:"ESN"}]},{id:11002,m:"TestInstructions.Label.ClickImagePart2",t_a:[{t:" to access this Help Guide at any time during your test.",l:"ENU"},{t:" para acceder a la Gua de ayuda en cualquier momento durante la prueba.",l:"ESN"}]},{id:11003,m:"TestInstructions.Button.CancelTest",t_a:[{t:"<span>Return to Login</span>",l:"ENU"},{t:"<span>Cancelar</span>",l:"ESN"}]},{id:11004,m:"TestInstructions.Button.BeginTest",t_a:[{t:"<span>Begin Test Now</span>",l:"ENU"},{t:"<span>Comenzar la prueba ahora</span>",l:"ESN"}]},{id:11524,m:"TestInstructions.Label.Help",t_a:[{t:"Select the text you want to hear and clickthe green buttonto have it played.",l:"ENU"},{t:"Seleccione el texto que desea escuchar y haga clic en el botn verde para reproducirlo.",l:"ESN"}]},{id:11562,m:"TestInstructions.Label.NoTTSHelp",t_a:[{t:"Text-to-Speech is not available.",l:"ENU"},{t:"La funcin texto a voz no est disponible.",l:"ESN"}]}]},{c:"TestResults.aspx",m_a:[{id:11519,m:"TestResults.Label.Polling",t_a:[{t:"Please wait. Retrieving test score.",l:"ENU"},{t:"Espere. Recuperando los resultados de la prueba.",l:"ESN"}]},{id:11573,m:"TestResults.Button.ReturnToLogin",t_a:[{t:"Return to Student Login",l:"ENU"},{t:"Volver a Inicio de Sesin del Estudiante",l:"ESN"}]},{id:11864,m:"ItemScores.Row.Format.GI",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Technology-Enhanced",l:"ENU"}]},{id:11866,m:"ItemScores.Row.Format.SIM",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Technology-Enhanced",l:"ENU"}]},{id:11867,m:"ItemScores.Row.Format.WB",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Technology-Enhanced",l:"ENU"}]},{id:11868,m:"ItemScores.Row.Format.NL",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Technology-Enhanced",l:"ENU"}]},{id:11869,m:"ItemScores.Row.Format.SI",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Tecnologa aumentada",l:"ESN"}]},{id:11870,m:"ItemScores.Row.Format.HT",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Technology-Enhanced",l:"ENU"}]},{id:11871,m:"ItemScores.Row.Format.EQ",t_a:[{t:"Technology-Enhanced",l:"ENU"},{t:"Technology-Enhanced",l:"ENU"}]},{id:11040,m:"StaticContent.Label.NoResultsForYou",t_a:[{t:"Scores are not displayed for this test.",l:"ENU"},{t:"Scores are not displayed for this test.",l:"ENU"}]},{id:11047,m:"TestResults.Label.YourResults",t_a:[{t:"Test Successfully Submitted",l:"ENU"},{t:"Entreg el examen satisfactoriamente.",l:"ESN"}]},{id:11049,m:"TestResults.Label.SSID",t_a:[{t:"State-SSID:",l:"ENU"},{t:"State-SSID:",l:"ENU"}]},{id:11039,m:"StaticContent.Label.YoureComplete",t_a:[{t:"You have finished the test. You may now log out.",l:"ENU"},{t:"Usted ha terminado la prueba. Puede cerrar la sesin.",l:"ESN"}]},{id:10368,m:"StaticContent.Label.NoScoresForPT",t_a:[{t:"Scores are not shown for this test.",l:"ENU"},{t:"Los puntajes de las pruebas de muestra no se presentan.",l:"ESN"}]},{id:10371,m:"StaticContent.Label.FERPA",t_a:[{t:"In accordance with the Family Educational Rights and Privacy Act (FERPA), the disclosure of personally identifiable information is prohibited by law.",l:"ENU"},{t:"De acuerdo con la Ley de derechos educativos y de privacidad de la familia (FERPA), est legalmente prohibida la divulgacin de informacin de identificacin personal.",l:"ESN"}]},{id:11048,m:"TestResults.Label.StudentName",t_a:[{t:"Student Name:",l:"ENU"},{t:"Nombre del estudiante:",l:"ESN"}]},{id:11050,m:"TestResults.Label.TestName",t_a:[{t:"Test Name:",l:"ENU"},{t:"Nombre de la prueba:",l:"ESN"}]},{id:11051,m:"TestResults.Label.TestCompletedDate",t_a:[{t:"Test Completed On:",l:"ENU"},{t:"Prueba realizada el:",l:"ESN"}]},{id:11052,m:"TestResults.Label.YouScore",t_a:[{t:"This is your score:",l:"ENU"},{t:"ste es su puntaje:",l:"ESN"}]},{id:11053,m:"TestResults.Link.Logout",t_a:[{t:"<span>Log Out</span>",l:"ENU"},{t:"<span>Cerrar sesin</span>",l:"ESN"}]},{id:11874,m:"ItemResults.Table.NoScore",t_a:[{t:"N/A",l:"ENU"},{t:"No aplicable",l:"ESN"}]}]},{c:"TestReview.aspx",m_a:[{id:12236,m:"QuestionsAreUnanswered",t_a:[{t:"Please review your unanswered questions before submitting the test.",l:"ENU"},{t:"Please review your unanswered questions before submitting the test.",l:"ENU"}]},{id:12352,m:"TestReview.Button.Pause",t_a:[{t:"<span>Pause Test</span>",l:"ENU"},{t:"<span>Pause Test</span>",l:"ENU"}]},{id:12313,m:"TestSurvey.header",t_a:[{t:"Survey Question(s)",l:"ENU"},{t:"Survey Question(s)",l:"ENU"}]},{id:12314,m:"TestSurvey.body",t_a:[{t:'<p>This is a survey.</p>\r\n<form>\r\n    <p>\r\n        <label for="optin">Opt-in:</label>\r\n        <input type="radio" name="optin" value="yes" required>Yes</input>\r\n        <input type="radio" name="optin" value="no">No</input>\r\n    </p>\r\n</form>',l:"ENU"},{t:'<p>This is a survey.</p>\r\n<form>\r\n    <p>\r\n        <label for="optin">Opt-in:</label>\r\n        <input type="radio" name="optin" value="yes" required>Yes</input>\r\n        <input type="radio" name="optin" value="no">No</input>\r\n    </p>\r\n</form>',l:"ENU"}]},{id:12315,m:"TestSurvey.validation.required",t_a:[{t:"A response to the survey question(s) is required.",l:"ENU"},{t:"A response to the survey question(s) is required.",l:"ENU"}]},{id:11054,m:"TestReview.Button.MyAnswers",t_a:[{t:"<span>Review My Answers</span>",l:"ENU"},{t:"<span>Revisar respuestas</span>",l:"ESN"}]},{id:11055,m:"TestReview.Button.Submit",t_a:[{t:"<span>Submit Test</span>",l:"ENU"},{t:"<span>Finalizar prueba</span>",l:"ESN"}]},{id:11042,m:"StaticContent.Label.ReviewSubmit",t_a:[{t:"You have reached the end of the test. You may review your answers. If you are done reviewing your answers, click [Submit Test]. You cannot change your answers after you submit the test.",l:"ENU"},{t:"Llego al fin del examen. Se puede repasar las respuestas. Cuando termine repasando las respuestas, cliquea [Entrega el examen para evaluacin]. no puede cambiar sus respuestas despus de que usted se someta su examen.",l:"ESN"}]},{id:11043,m:"QuestionsAreMarkedForReview",t_a:[{t:"You have marked questions. Review these questions before submitting your test.",l:"ENU"},{t:"Usted ha marcado preguntas. Revisar estas preguntas antes de terminar su prueba.",l:"ESN"}]},{id:11056,m:"TestReview.Label.ScoreMessage",t_a:[{t:"Please wait while your test is being submitted.",l:"ENU"},{t:"Please wait while your test is being submitted.",l:"ENU"}]},{id:11041,m:"StaticContent.Label.Congratulations",t_a:[{t:"You have reached the end of the test.",l:"ENU"},{t:"Lleg al fin del examen.",l:"ESN"}]}]},{c:"TestShell.aspx",m_a:[{id:11078,m:"TestShell.Label.PracticeTestPrint",t_a:[{t:"Your test is printing ",l:"ENU"},{t:"Your test is printing ",l:"ENU"}]},{id:11699,m:"Global.Label.SSID",t_a:[{t:"State-SSID",l:"ENU"},{t:"State-SSID",l:"ENU"}]},{id:11735,m:"TestShellScripts.Label.ReviewInstructions",t_a:[{t:'Please review your answers before you continue testing. You <span style="font-weight:bold;">will not</span> be able to come back to these questions later. <br/><br/>Click on a question number below to review it.',l:"ENU"},{t:"<p>Por favor repasa su respuestas antes de continuar el examen. No podr regresar as estas preguntas ms tarde. </p><p> Haga clic en un nmero de pregunta para revisarlo a la izquierda. </p>",l:"ESN"}]},{id:11523,m:"TestInstructions.Label.Help",t_a:[{t:'<span class="hasTTS">Select the text you want to hear and clickthe green buttonto have it played.</span>',l:"ENU"},{t:'<span class="hasTTS">Seleccione el texto que desea escuchar y haga clic en el botn verde para reproducirlo.</span>',l:"ESN"}]},{id:11561,m:"TestInstructions.Label.NoTTSHelp",t_a:[{t:'<span class="noTTS">Text-to-Speech is not available.</span>',l:"ENU"},{t:'<span class="noTTS">La funcin texto a voz no est disponible.</span>',l:"ESN"}]},{id:11057,m:"TestShell.Link.Debug",t_a:[{t:"Click here to send helpful information.",l:"ENU"},{t:"Haga clic aqu para enviar informacin til.",l:"ESN"}]},{id:11058,m:"TestShell.Link.Help",t_a:[{t:"<span>Help</span>",l:"ENU"},{t:"<span>Ayuda</span>",l:"ESN"}]},{id:11059,m:"TestShell.Label.PastQuestions",t_a:[{t:"Past/Marked Questions:",l:"ENU"},{t:"Preguntas pasadas/marcadas:",l:"ESN"}]},{id:11060,m:"TestShell.Link.ZoomIn",t_a:[{t:"Zoom In",l:"ENU"},{t:"Acercar",l:"ESN"}]},{id:11061,m:"TestShell.Link.ZoomOut",t_a:[{t:"Zoom Out",l:"ENU"},{t:"Alejar",l:"ESN"}]},{id:11062,m:"TestShell.Link.Formula",t_a:[{t:"Formula",l:"ENU"},{t:"Frmula",l:"ESN"}]},{id:11063,m:"TestShell.Link.PeriodicTable",t_a:[{t:"Periodic Table",l:"ENU"},{t:"Tabla Peridica",l:"ESN"}]},{id:11064,m:"TestShell.Link.Print",t_a:[{t:"Print Passage",l:"ENU"},{t:"Imprimir",l:"ESN"}]},{id:11065,m:"TestShell.Link.PrintPractice",t_a:[{t:"Print",l:"ENU"},{t:"Imprimir",l:"ESN"}]},{id:11066,m:"TestShell.Link.Highlight",t_a:[{t:"Highlight",l:"ENU"},{t:"Resaltar",l:"ESN"}]},{id:11067,m:"TestShell.Link.ResetHighlighting",t_a:[{t:"Reset Highlighting",l:"ENU"},{t:"Restablecer resaltado",l:"ESN"}]},{id:11068,m:"TestShell.Link.Save",t_a:[{t:"Save",l:"ENU"},{t:"Guardar",l:"ESN"}]},{id:11069,m:"TestShell.Link.Pause",t_a:[{t:"Pause",l:"ENU"},{t:"Pausa",l:"ESN"}]},{id:11070,m:"TestShell.Link.Back",t_a:[{t:"Back",l:"ENU"},{t:"Volver",l:"ESN"}]},{id:11071,m:"TestShell.Link.Next",t_a:[{t:"Next",l:"ENU"},{t:"Siguiente",l:"ESN"}]},{id:11072,m:"TestShell.Link.EndTest",t_a:[{t:"End Test",l:"ENU"},{t:"Terminar prueba",l:"ESN"}]},{id:11073,m:"TestShell.Link.YourChoices.Yes",t_a:[{t:"Yes",l:"ENU"},{t:"S",l:"ESN"}]},{id:11074,m:"TestShell.Link.YourChoices.No",t_a:[{t:"No",l:"ENU"},{t:"No",l:"ESN"}]},{id:11075,m:"TestShell.Link.Logout",t_a:[{t:"Log Out",l:"ENU"},{t:"Cerrar sesin",l:"ESN"}]},{id:11076,m:"TestShell.Link.OK",t_a:[{t:"<span>OK</span>",l:"ENU"},{t:"<span>Aceptar</span>",l:"ESN"}]},{id:11077,m:"TestShell.Label.PleaseWait",t_a:[{t:"Please wait...",l:"ENU"},{t:"Espere...",l:"ESN"}]},{id:11079,m:"TestShell.Label.PromptMessage",t_a:[{t:"Click the [Print Passage] button to print the passage.",l:"ENU"},{t:"Haga clic en el botn [Imprimir pasaje] para imprimir el pasaje.",l:"ESN"}]},{id:11080,m:"TestShell.Link.PrintPassage",t_a:[{t:"Click here to print the passage.",l:"ENU"},{t:"Haga clic aqu para imprimir el pasaje.",l:"ESN"}]},{id:11081,m:"TestShell.Link.CloseAlert",t_a:[{t:"Click here to continue your test.",l:"ENU"},{t:"Haga clic aqu para continuar con la prueba.",l:"ESN"}]},{id:11082,m:"TestShell.Label.Tutorials",t_a:[{t:"Tutorials",l:"ENU"},{t:"Tutoriales",l:"ESN"}]},{id:11083,m:"TestShell.Label.CloseTutorial",t_a:[{t:"Close Tutorial",l:"ENU"},{t:"Cerrar tutorial",l:"ESN"}]},{id:11084,m:"TestShell.Link.CloseTutorial.Yes",t_a:[{t:"Yes",l:"ENU"},{t:"S",l:"ESN"}]},{id:11085,m:"TestShell.Link.CloseTutorial.No",t_a:[{t:"No",l:"ENU"},{t:"No",l:"ESN"}]},{id:11086,m:"TestShell.Label.Formulas",t_a:[{t:"Formulas",l:"ENU"},{t:"Frmulas",l:"ESN"}]},{id:11087,m:"TestShell.Link.CloseFormulas",t_a:[{t:"Close",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:11088,m:"TestShell.Label.PeriodicTable",t_a:[{t:"Periodic Table",l:"ENU"},{t:"Tabla Peridica",l:"ESN"}]},{id:11089,m:"TestShell.Link.PeriodicTable.Close",t_a:[{t:"Close",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:11090,m:"TestShell.Label.HelpGuide",t_a:[{t:"Help Guide",l:"ENU"},{t:"Gua de ayuda",l:"ESN"}]},{id:11091,m:"TestShell.Link.HelpGuide.Close",t_a:[{t:"Close",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:10885,m:"TestShell.Link.Calculator",t_a:[{t:"Calculator",l:"ENU"},{t:"Calculadora",l:"ESN"}]},{id:10886,m:"TestShell.Label.Calculator",t_a:[{t:"Calculator",l:"ENU"},{t:"Calculadora",l:"ESN"}]},{id:10887,m:"TestShell.Link.Calculator.Close",t_a:[{t:"Close",l:"ENU"},{t:"Cerrar",l:"ESN"}]},{id:12283,m:"TestShell.Alert.EnvironmentInsecure",t_a:[{t:"This test environment is not secure.  If you're using an iPad please make sure it is in Guided Access or ASAM.  If you're using a desktop this means that some other application has taken focus away from the secure browser.",l:"ENU"},{t:"This test environment is not secure.  If you're using an iPad please make sure it is in Guided Access or ASAM.  If you're using a desktop this means that some other application has taken focus away from the secure browser.",l:"ENU"}]},{id:11927,m:"TestShell.Link.TestResults",t_a:[{t:"Test Results",l:"ENU"},{t:"Resultados de la prueba",l:"ESN"}]},{id:11930,m:"TestShellModern.Label.Items",t_a:[{t:"Questions:",l:"ENU"},{t:"Preguntas:",l:"ESN"}]},{id:11945,m:"TestShell.Comments.Global",t_a:[{t:"Notepad",l:"ENU"},{t:"cuaderno",l:"ESN"}]},{id:11664,m:"StudentMaster.Button.Logout",t_a:[{t:"Log Out",l:"ENU"},{t:"Cerrar Sesin",l:"ESN"}]},{id:11734,m:"TestShellScripts.Label.Review",t_a:[{t:"You have reached the end of this segment:",l:"ENU"},{t:"Lleg  al fin de la seccin.",l:"ESN"}]},{id:11965,m:"TestShell.Link.LineReader",t_a:[{t:"Line Reader",l:"ENU"},{t:"lector de lnea",l:"ESN"}]},{id:11966,m:"TestShell.Link.GlobalNotes",t_a:[{t:"Notes",l:"ENU"},{t:"Notas",l:"ESN"}]},{id:12147,m:"TestShell.Label.Rubric",t_a:[{t:"Scoring Guide",l:"ENU"},{t:"Scoring Guide",l:"ENU"}]},{id:12148,m:"TestShell.Link.Rubric",t_a:[{t:"Scoring Guide",l:"ENU"},{t:"Scoring Guide",l:"ENU"}]},{id:12204,m:"TDSMoogle.searchResults",t_a:[{t:"Search Results",l:"ENU"},{t:"Search Results",l:"ENU"}]},{id:12205,m:"TestShell.Fullscreen.PasswordDenied",t_a:[{t:"The password you entered is incorrect. To open the navigation bar, enter the correct password.",l:"ENU"},{t:"The password you entered is incorrect. To open the navigation bar, enter the correct password.",l:"ENU"}]},{id:12206,m:"TDSMenu.Speak.SelectAENU",t_a:[{t:"Speak Option A",l:"ENU"},{t:"Speak Option A",l:"ENU"}]},{id:12207,m:"TDSMenu.Speak.SelectBENU",t_a:[{t:"Speak Option B",l:"ENU"},{t:"Speak Option B",l:"ENU"}]},{id:12208,m:"TDSMenu.Speak.SelectCENU",t_a:[{t:"Speak Option C",l:"ENU"},{t:"Speak Option C",l:"ENU"}]},{id:12209,m:"TDSMenu.Speak.SelectDENU",t_a:[{t:"Speak Option D",l:"ENU"},{t:"Speak Option D",l:"ENU"}]},{id:12210,m:"TDSMenu.Speak.SelectEENU",t_a:[{t:"Speak Option E",l:"ENU"},{t:"Speak Option E",l:"ENU"}]},{id:12211,m:"TDSMenu.Speak.SelectFENU",t_a:[{t:"Speak Option F",l:"ENU"},{t:"Speak Option F",l:"ENU"}]},{id:12212,m:"TDSTTS.Label.SpeakQuestionESN",t_a:[{t:"Hable la Pregunta",l:"ENU"},{t:"Hable la Pregunta",l:"ENU"}]},{id:12213,m:"TestShell.Link.Dictionary",t_a:[{t:"Dictionary",l:"ENU"},{t:"Dictionary",l:"ENU"}]},{id:12214,m:"TestShell.Label.Dictionary",t_a:[{t:"Dictionary",l:"ENU"},{t:"Dictionary",l:"ENU"}]}]},{c:"TTSCheck.aspx",m_a:[{id:11862,m:"TTSCheck.Label.SliderVolume",t_a:[{t:"Volume",l:"ENU"},{t:"Volumen",l:"ESN"}]},{id:11863,m:"TTSCheck.Label.SliderPitch",t_a:[{t:"Pitch",l:"ENU"},{t:"Tono",l:"ESN"}]},{id:11886,m:"TTSCheck.Label.SliderRate",t_a:[{t:"Rate",l:"ENU"},{t:"Proporcin",l:"ESN"}]},{id:11887,m:"TTSCheck.Label.SetSystemDefault",t_a:[{t:"Use System Defaults",l:"ENU"},{t:"Utilizar los valores predeterminados del sistema",l:"ESN"}]},{id:11888,m:"TTSCheck.Label.SoundSettingsHeading",t_a:[{t:"Sound Settings",l:"ENU"},{t:"Configuracin de sonido",l:"ESN"}]},{id:11889,m:"TTSCheck.Label.SelectVoicePack",t_a:[{t:"Select a Voice Pack",l:"ENU"},{t:"Seleccione un paquete de voz",l:"ESN"}]},{id:11890,m:"TTSCheck.Label.CurrentVoicePack",t_a:[{t:"Current Voice Pack:",l:"ENU"},{t:"Paquete de voz actual",l:"ESN"}]},{id:11197,m:"TTSCheck.Label.TTSEnglish",t_a:[{t:"&nbsp;",l:"ENU"},{t:"Verificar el audio en ingls.",l:"ESN"}]},{id:11199,m:"TTSCheck.Label.ClickToHear",t_a:[{t:"Click to hear",l:"ENU"},{t:"Escuchar",l:"ESN"}]},{id:11202,m:"TTSCheck.Label.HeardYes",t_a:[{t:"Yes, I heard the voice.",l:"ENU"},{t:"S, lo escuch.",l:"ESN"}]},{id:11203,m:"TTSCheck.Label.HeardNo",t_a:[{t:"No, I did not hear the voice.",l:"ENU"},{t:"No, no escuch la voz",l:"ESN"}]},{id:11205,m:"TTSCheck.Label.TTSSpanish",t_a:[{t:"Spanish Text-to-Speech diagnostics",l:"ENU"},{t:"Diagnsticos del texto para decir en espaol",l:"ESN"}]},{id:11206,m:"TTSCheck.Label.DidYouHearSpanish",t_a:[{t:"Did you hear the Spanish text?  Click [Yes] or [No].",l:"ENU"},{t:"Escuchaste el audio en espaol? Haz clic en [S] o [No].",l:"ESN"}]},{id:11207,m:"TTSCheck.Label.ClickToHearSpanish",t_a:[{t:"Click to listen in Spanish",l:"ENU"},{t:"Haga clic para escuchar en espaol",l:"ESN"}]},{id:11210,m:"TTSCheck.Label.SkipSpanish",t_a:[{t:"Skip Spanish TTS check",l:"ENU"},{t:"Omitir la verificacin de audio en espaol.",l:"ESN"}]},{id:11211,m:"TTSCheck.Label.AudioProblem",t_a:[{t:"Audio Check",l:"ENU"},{t:"Problema de audio",l:"ESN"}]},{id:11212,m:"TTSCheck.Label.TellAdminMessage",t_a:[{t:"Click [Try Again]. Make sure your computers sound is not muted and try adjusting the volume and pitch. If you have done this and you still do not hear the audio, please tell your Test Administrator. Do not log out unless your TA tells you to do so.",l:"ENU"},{t:"Haga clic en [Reintentar]. Asegrese de que el sonido de su ordenador no est en silencio y tratar de ajustar el volumen y el tono. Si usted ha hecho esto, y an as no escucha el audio, por favor consulte a su administrador de pruebas. No cerrar la sesin a menos que su administrador le indica que lo haga.",l:"ESN"}]},{id:11213,m:"TTSCheck.Label.LogoutOnAudioError",t_a:[{t:"Log Out",l:"ENU"},{t:"Cerrar sesin",l:"ESN"}]},{id:11214,m:"TTSCheck.Label.TryAgain",t_a:[{t:"Try Again",l:"ENU"},{t:"Intentar de nuevo",l:"ESN"}]},{id:11215,m:"TTSCheck.Label.Continue",t_a:[{t:"Continue",l:"ENU"},{t:"Continuar",l:"ESN"}]},{id:11216,m:"TTSCheck.Label.NoAudio",t_a:[{t:"Text-to-Speech is Not Available",l:"ENU"},{t:"No hay audio en este equipo.  Consulta al asistente tcnico.",l:"ESN"}]},{id:11487,m:"TTSCheck.Label.NoSpanishVoicePack",t_a:[{t:"No appropriate voice pack for Spanish found on this machine.",l:"ENU"},{t:"No se encontr un paquete de voz apropiado para el idioma espaol en este equipo.",l:"ESN"}]},{id:11488,m:"TTSCheck.Label.NoEnglishVoicePack",t_a:[{t:"No appropriate voice pack for English found on this machine.",l:"ENU"},{t:"No se encontr un paquete de voz apropiado para el idioma ingls en este equipo.",l:"ESN"}]},{id:11461,m:"TTSCheck.Label.HeardNoSpanish",t_a:[{t:"No, I did not hear it.",l:"ENU"},{t:"No, no escuch",l:"ESN"}]},{id:11198,m:"TTSCheck.Label.DidYouHear",t_a:[{t:"Do you hear the voice?",l:"ENU"},{t:"Do you hear the voice?",l:"ENU"}]},{id:11200,m:"TTSCheck.Label.HearMessageEnglish",t_a:[{t:'<span style="display:none;">This is some sample text to test your settings.</span>',l:"ENU"},{t:'<span style="display:none;">This is some sample text to test your settings.</span>',l:"ENU"}]},{id:11201,m:"TTSCheck.Label.HeardYesOrNo",t_a:[{t:'Select the green button to test your Text-to-Speech settings. <br /> You should hear the following phrase: "This is some sample text to test your settings." <br /> Click [Yes, I heard the voice] if it worked. If it did not work, click [No, I did not hear ',l:"ENU"},{t:'Select the green button to test your Text-to-Speech settings. <br /> You should hear the following phrase: "This is some sample text to test your settings." <br /> Click [Yes, I heard the voice] if it worked. If it did not work, click [No, I did not hear ',l:"ENU"}]},{id:11204,m:"TTSCheck.Label.SkipEnglish",t_a:[{t:"Skip this audio check",l:"ENU"},{t:"Skip this audio check",l:"ENU"}]},{id:11208,m:"TTSCheck.Label.HearMessageSpanish",t_a:[{t:'<span style="display:none;">El texto en espaol se est leyendo en voz alta.</span>',l:"ENU"},{t:'<span style="display:none;">El texto en espaol se est leyendo en voz alta.</span>',l:"ENU"}]},{id:11209,m:"TTSCheck.Label.HeardYesOrNoSpanish",t_a:[{t:"Click [Yes] if you heard the voice. If you did not hear the voice, click [No].",l:"ENU"},{t:"Click [Yes] if you heard the voice. If you did not hear the voice, click [No].",l:"ENU"}]},{id:11217,m:"TTSCheck.Label.NoAudioAdminMessage",t_a:[{t:"Text-to-Speech is not available on the browser and/or platform that you are using. Please make sure you are using a supported secure browser.",l:"ENU"},{t:"Text-to-Speech is not available on the browser and/or platform that you are using. Please make sure you are using a supported secure browser.",l:"ENU"}]},{id:11456,m:"TTSCheck.Label.HeardYesSpanish",t_a:[{t:"Yes, I heard the voice",l:"ENU"},{t:"Si, he oido la voz",l:"ESN"}]},{id:11885,m:"TTSCheck.Label.soundsettingsinstructions",t_a:[{t:"Use the sliders to adjust the pitch and volume. You will not be able to change these settings once you begin your test.",l:"ENU"},{t:"Utilice los controles deslizantes para ajustar el tono y el volumen. Usted no ser capaz de cambiar esta configuracin una vez que comience la prueba.",l:"ESN"}]}]}]};var Blackbox={};Blackbox.fireEvent=function(name,obj){Util.log("BLACKBOX EVENT: "+name),"function"==typeof window.blackboxEvent&&window.blackboxEvent(window,name,obj);var parentBlackboxFunc;try{window!=parent&&"function"==typeof parent.blackboxEvent&&(parentBlackboxFunc=parent.blackboxEvent)}catch(ex){Util.log("BLACKBOX ERROR: Parent frame is cross domain.")}parentBlackboxFunc&&parentBlackboxFunc(window,name,obj),Blackbox.events.fire(name)},Blackbox.events=new Util.Event.Emitter,Blackbox.events.create("init",{fireOnce:!0}),Blackbox.events.create("available",{fireOnce:!0}),Blackbox.events.create("ready",{fireOnce:!0}),Blackbox.getConfig=function(){return"object"==typeof blackboxConfig?blackboxConfig:{}},Blackbox.getShell=function(){var shell=this._getQueryObject().getValue("shell");return shell=null!=shell?(shell=shell.toLowerCase()).replace("shell",""):"universal"},Blackbox.init=function(){Blackbox.fireEvent("init");this._getQueryObject();TDS.init();var contentsEl=document.getElementById("contents");contentsEl&&(contentsEl.innerHTML="");var accs=new Accommodations;Accommodations.Manager.add(accs),Blackbox.fireEvent("available"),ContentManager.setBaseUrl(TDS.baseUrl);var flashPath=ContentManager.resolveBaseUrl("Scripts/Libraries/soundmanager2/swf/");TDS.Audio.Player.setup(flashPath),TDS.Audio.Recorder.initialize();var config=Blackbox.getConfig();ContentManager.onPageEvent("loaded",function(page){!0!==config.preventShowOnLoad&&page.show()}),ContentManager.onPageEvent("beforeShow",function(page){TDS.Dialog.hideProgress()}),ContentManager.onPageEvent("show",function(page){page.autoPlayQueue.start()}),Blackbox.setAccommodationsFromUrl(),Accommodations.Manager.getCurrentProps().isStreamlinedMode()&&(TDS.Shell.allowFocus=!0,ContentManager.enableAccessibility()),TDS.Shell.name="universal",TDS.Shell.processConfig(config.testShellToolbars),TDS.Shell.showButton("btnItemScore"),Blackbox.bindUIEvents(),TDS.baseUrl&&TDS.baseUrl.length>0?ContentManager.init(TDS.baseUrl):ContentManager.init(),Blackbox.fireEvent("ready")},Blackbox.bindUIEvents=function(){YUE.on("btnZoomIn","click",function(ev){var currentPage=ContentManager.getCurrentPage();currentPage&&currentPage.zoomIn()}),YUE.on("btnZoomOut","click",function(ev){var currentPage=ContentManager.getCurrentPage();currentPage&&currentPage.zoomOut()}),YUE.on("btnProtractor","click",function(ev){var currentPage=ContentManager.getCurrentPage();currentPage&&currentPage.MT_toggleProtractor&&currentPage.MT_toggleProtractor(null,currentPage)}),YUE.on("btnRuler","click",function(ev){var currentPage=ContentManager.getCurrentPage();currentPage&&currentPage.MT_toggleRuler&&currentPage.MT_toggleRuler(null,currentPage)})},Blackbox.loadContent=function(contentRequest,forceReload){function onContentFail(xhrData){TDS.Dialog.hideProgress(),TDS.Dialog.showWarning("Blackbox Error: "+xhrData.statusText),deferred.reject()}var currentPage=ContentManager.getCurrentPage();currentPage&&currentPage.hide();var page=ContentManager.getPage(contentRequest.id);if(page){if(!forceReload)return Q.resolve(page);ContentManager.removePage(page)}var deferred=Util.Promise.defer();TDS.Dialog.showProgress();var accommodations=Accommodations.Manager.getCurrent();contentRequest.accommodations=accommodations.getSelectedJson();var callback={success:function(xhrData){if(200==xhrData.status){var contents=ContentManager.Xml.create(xhrData.responseXML);if(contents&&0!=contents.length){var content=contents[0];(page=ContentManager.createPage(content)).render(),page.once("loaded",function(){deferred.fulfill(page)})}else onContentFail(xhrData)}else onContentFail(xhrData)},failure:onContentFail,timeout:12e4};YAHOO.util.Connect.setDefaultPostHeader(!1),YAHOO.util.Connect.initHeader("Content-Type","text/plain"),YAHOO.util.Connect.setDefaultXhrHeader(!1);var requestUrl=TDS.resolveBaseUrl("ContentRequest.axd/load"),postData=YAHOO.lang.JSON.stringify(contentRequest);return YAHOO.util.Connect.asyncRequest("POST",requestUrl,callback,postData),deferred.promise},Blackbox.getContentRequestFromUrl=function(){console.warn("The function Blackbox.getContentRequestFromUrl() is deprecated and will be removed soon. Please load content manually using Blackbox.loadContent().");var queryObj=this._getQueryObject(),content={token:queryObj.getValue("auth_token"),client:queryObj.getValue("client"),mode:queryObj.getValue("mode"),language:queryObj.getValue("language"),layoutFile:queryObj.getValue("layoutFile"),layoutName:queryObj.getValue("layoutName"),items:[],accommodations:this.getAccommodationsFromUrl()},passagePath=queryObj.getValue("passage");content.passage=null!=passagePath?{file:passagePath}:null;var items=queryObj.getValues("item");if(null!=items){var disabled=queryObj.getValue("disabled");null==disabled&&(disabled=!1);for(var i=0;i<items.length;i++){var itemPath=items[i];content.items.push({file:itemPath,disabled:disabled,response:null})}}return null==content.passage&&0==content.items.length?null:content},Blackbox._getQueryObject=function(win){var decode=function(s){try{return decodeURIComponent(s).replace(/\r\n|\r|\n/g,"\r\n")}catch(e){return""}},qs=(win=win||window).location.search,multimap={};qs.length>1&&(qs=qs.substr(1)).replace(/([^=&]+)=([^&]*)/g,function(match,hfname,hfvalue){var name=decode(hfname),value=decode(hfvalue);name&&name.length>0&&(name=name.toLowerCase(),multimap.hasOwnProperty(name)||(multimap[name]=[]),multimap[name].push(value))});var getValues=function(name){name=name.toLowerCase();var values=multimap[name];return YAHOO.util.Lang.isArray(values)?values:null};return{getValue:function(name){var values=getValues(name);return null==values||0==values.length?null:values[0]},getValues:getValues}},Blackbox.parseAccommodations=function(accommodationString){if(null==accommodationString||0==accommodationString.length)return null;for(var accPairs=accommodationString.split(";"),accHash={},i=0;i<accPairs.length;i++){var accData=accPairs[i].split(":"),type=accData[0],value=accData[1],values=accHash[type];null==values&&(accHash[type]=[],values=accHash[type]),values.push(value)}var accJson=[];return Util.Array.each(Util.Object.keys(accHash),function(name){accJson.push({type:name,codes:accHash[name]})}),accJson},Blackbox.getAccommodationsFromUrl=function(){var accommodationString=this._getQueryObject().getValue("accommodations");return this.parseAccommodations(accommodationString)},Blackbox.setAccommodationsFromUrl=function(){var accArray=this.getAccommodationsFromUrl();this.setAccommodations(accArray)},Blackbox.setAccommodations=function(typeList){if(null==typeList)return!1;var accommodations=Accommodations.Manager.getCurrent();return Util.Array.each(typeList,function(typeData){var typeName=typeData.type,typeCodes=typeData.codes,accType=accommodations.getType(typeName);null==accType&&(accType=accommodations.createType(typeName,null,!0,!0,!0,!0)),Util.Array.each(typeCodes,function(typeCode){var accValue=accommodations.getValue(typeCode);null==accValue&&(accValue=accType.createValue(typeCode,typeCode,null,!1,!0,null))}),accommodations.selectCodes(typeName,typeCodes)}),!0},Blackbox.changeAccommodations=function(callback){if(!YAHOO.lang.isFunction(callback))throw new Error("Must pass in function that will change accommodations object.");for(var accommodations=Accommodations.Manager.getCurrent(),pages=ContentManager.getPages(),i=0;i<pages.length;i++){body=(page=pages[i]).getBody();accommodations.removeCSS(body)}callback(accommodations);for(i=0;i<pages.length;i++){var page=pages[i],body=page.getBody();accommodations.applyCSS(body)}},Blackbox.showButton=function(name,handler,shouldEnable){var button=document.getElementById(name);return null!=button&&(YUD.setStyle(button.parentNode,"display",""),YAHOO.lang.isFunction(handler)&&YUE.addListener(button,"click",handler),Blackbox.enableButton(name,shouldEnable),!0)},Blackbox.enableButton=function(name,shouldEnable){var button=YUD.get(name);return null!=button&&(shouldEnable?YUD.removeClass(button.parentNode,"inactive"):YUD.addClass(button.parentNode,"inactive"),!0)},Blackbox.createButtonTool=function(id,label,fn){TDS.Shell.addTool({id:id,label:label,fn:fn})},Blackbox.createButtonControl=function(id,label,fn){TDS.Shell.addControl({id:id,label:label,fn:fn})},function($,jQuery){var _$=$,_jQuery=jQuery;jQuery.noConflict(!0),void 0===window.$&&(window.$=_$,window.jQuery=_jQuery)}($,jQuery),function(){var testShellLoader=function(){var tsEl=document.getElementById(blackboxConfig.container),tsTemplateEl=document.getElementById("testShellHtml");if(null!=tsEl&&null!=tsTemplateEl){var tsTemplate=YAHOO.lang.trim(tsTemplateEl.innerHTML);tsEl.innerHTML=tsTemplate}};YAHOO.util.Event.on(window,"load",function(){TDS.baseUrl=blackboxConfig.baseUrl,testShellLoader(),YAHOO.lang.later(0,Blackbox,Blackbox.init)})}(),Calculator.calcMapping={},Calculator.calcMapping.Basic="TDS_CalcBasic",Calculator.calcMapping.StandardMem="TDS_CalcStdMem",Calculator.calcMapping.Standard="TDS_CalcStd",Calculator.calcMapping.Scientific="TDS_CalcSci",Calculator.calcMapping.ScientificInv="TDS_CalcSciInv",Calculator.calcMapping.Graphing="TDS_CalcGraphing",Calculator.calcMapping.GraphingInv="TDS_CalcGraphingInv",Calculator.calcMapping.Matrices="TDS_CalcMatrices",Calculator.calcMapping.Regression="TDS_CalcRegress",Calculator.getCode=function(calcType){return Calculator.calcMapping[calcType]},Calculator.getCodes=function(){return Util.Object.keys(Calculator.calcMapping)},Calculator.getInstance=function(id){var frameCalc=document.getElementById("frame-"+id);if(!frameCalc||!frameCalc.contentWindow)return null;var winCalc=frameCalc.contentWindow;if(!YAHOO.lang.isFunction(winCalc.getWorkingCalcInstance))return null;var calcInstance=winCalc.getWorkingCalcInstance();return null!=calcInstance&&YAHOO.lang.isFunction(calcInstance.setInitKeyboardElement)?calcInstance:null},Calculator.setStyle=function(panel,calcInstance){Calculator.getCodes().forEach(function(name){var code=Calculator.calcMapping[name];YUD.removeClass(panel.element,code)});var currentCalcCode=Calculator.getCode(calcInstance.config.name);currentCalcCode&&YUD.addClass(panel.element,currentCalcCode),panel.refresh()},Calculator.create=function(id,calcUrl){var panel=TDS.ToolManager.createPanel(id,"calculator","Calculator",null);return TDS.ToolManager.loadUrl(panel,calcUrl,function(){YUD.addClass(panel.getFrame().contentDocument.body,"client_"+TDS.clientStylePath);var calcInstance=Calculator.getInstance(id);calcInstance&&calcInstance.parent&&(setTimeout(function(){Calculator.setStyle(panel,calcInstance)},0),calcInstance.parent.CalcModeChange.subscribe(function(ev,arr){arr[0];var newCalc=arr[1];Calculator.setStyle(panel,newCalc);var panelX=panel.cfg.getProperty("x"),panelY=panel.cfg.getProperty("y");panel.moveTo(panelX,panelY)}))}),panel.showEvent.subscribe(function(){var calcInstance=Calculator.getInstance(id);calcInstance&&(calcInstance.clearFocus(calcInstance.config.keyboardRegionDivs),setTimeout(function(){calcInstance.setInitKeyboardElement()},1))}),panel},ContentManager.onPageEvent("hide",function(contentPage){for(var tools=TDS.ToolManager.getAll(),i=0;i<tools.length;i++)try{if(tools[i].id.toLowerCase().indexOf("calculator")>0){var frameCalc=document.getElementById("frame-"+tools[i].id);if(!frameCalc||!frameCalc.contentWindow)continue;var winCalc=frameCalc.contentWindow;if("function"!=typeof winCalc.resetTDSCalc)continue;winCalc.resetTDSCalc()}}catch(ex){Util.log(ex)}}),Calculator.toggle=function(){var contentPage=ContentManager.getCurrentPage();if(null!=contentPage){var accProps=contentPage.getAccommodationProperties();if(null!=accProps&&accProps.hasCalculator()){var calcModes=accProps.getCalculator();Calculator.getCodes().forEach(function(name){var code=Calculator.calcMapping[name];calcModes=calcModes.replace(code,name)});var id="tool-calculator-"+calcModes.replace(/&/g,"-"),calcUrl="Scripts/Calculator/TDSCalculator.html?mode="+calcModes.replace(/&/g,","),panel=TDS.ToolManager.get(id);null==panel&&(panel=Calculator.create(id,calcUrl)),TDS.ToolManager.toggle(panel)}}},Dictionary.createUrlParams=function(){var accProps=TDS.getAccommodationProperties(),urlParams=[],dict=accProps.getDictionary(),spDict=accProps.getSpanishDictionary();dict&&urlParams.push("dictionary="+dict),spDict&&urlParams.push("spanish="+spDict);var dictOptions=accProps.getDictionaryOptions(),spDictOptions=accProps.getSpanishDictionaryOptions();dictOptions&&dictOptions.length>0&&urlParams.push("do="+dictOptions.join(",")),spDictOptions&&spDictOptions.length>0&&urlParams.push("so="+spDictOptions.join(","));var thes=accProps.getThesaurus();thes&&urlParams.push("thesaurus="+thes);var thesOptions=accProps.getThesaurusOptions();thesOptions&&thesOptions.length>0&&urlParams.push("to="+thesOptions.join(",")),urlParams.push("group="+TDS.getAppSetting("tds.dictionary.group","AIR"));location.href;var url="?";return url+=urlParams.join("&")},Dictionary.toggle=function(){Dictionary.createUrlParams();var id="tds-dict-"+Util.String.hashCode("Dictionary"),panel=TDS.ToolManager.get(id);if(null==panel){var handlerUrl=TDS.baseUrl+"Pages/API/accommodations/dictionary";$.get(handlerUrl).then(function(data){var url=data+Dictionary.createUrlParams();panel=TDS.ToolManager.createPanel(id,"dictionary","Dictionary",null,url),TDS.ToolManager.toggle(panel)})}else TDS.ToolManager.toggle(panel)},Masking.isEnabled=function(){return YUD.hasClass(document.body,"msk-enabled")},Masking.enable=function(){YUD.addClass(document.body,"msk-enabled")},Masking.disable=function(){YUD.removeClass(document.body,"msk-enabled")},Masking.toggle=function(){Masking.isEnabled()?Masking.disable():Masking.enable(),TDS.Mask.toggle()},TDS=window.TDS||{},TDS.Notes={Store:{},Debug:!0,Sequence:{id:0},_Factory:null,Events:{Load:new YAHOO.util.CustomEvent("load"),Save:new YAHOO.util.CustomEvent("save")},Types:{Global:"global",DropDown:"DropDown",TextArea:"TextArea",ScratchPad:"ScratchPad",Equation:"Equation"},close:function(obj){var id=TDS.Notes.getIdFromObj(obj);if(id){var notes=TDS.Notes.Store[id];notes&&notes.close()}},get:function(id){return TDS.Notes.Store[id]},open:function(obj){var id=TDS.Notes.getIdFromObj(obj),notes=null;return id&&((notes=TDS.Notes.Store[id])||(notes=TDS.Notes.getInstance(obj,id),TDS.Notes.Store[id]=notes),notes?notes.open():console.error("This object type could note create a valid notes instance?",obj)),notes},closeAll:function(){for(var key in TDS.Notes.Store){var notes=TDS.Notes.Store[key];notes&&notes.close&&"object"==typeof notes&&notes.close()}},getInstance:function(obj,id){return TDS.Notes.getFactory().buildNotes(obj,id)},setFactoryConfig:function(cfg){this.getFactory().setConfig(cfg)},getFactory:function(){if(!TDS.Notes._Factory){TDS.Config=window.TDS.Config||{};var fact=new TDS.Notes.Factory;fact.setConfig(TDS.Config.NotesConfig),TDS.Notes._Factory=fact}return TDS.Notes._Factory},setFactory:function(factory){TDS.Notes._Factory=factory},getIdFromObj:function(obj){return obj?"string"==typeof obj?obj:"number"==typeof obj?obj+"":obj.id?obj.id+"_notes":obj.position?obj.position+"_notes":void 0:TDS.Notes.Types.Global}},TDS.Notes.Base=function(){this._saveState=" "},TDS.Notes.Base.prototype.create=function(){TDS.Notes.Debug&&console.log("Notes.Base class method, should be overriden: create")},TDS.Notes.Base.prototype.serialize=function(){TDS.Notes.Debug&&console.log("Notes.Base class method, should be overriden: serialize")},TDS.Notes.Base.prototype.unserialize=function(response){TDS.Notes.Debug&&console.log("Notes.Base class method, should be overriden: unserialize")},TDS.Notes.Base.prototype.saveState=function(state){this._saveState=state},TDS.Notes.Base.prototype.getState=function(){return this._saveState},TDS.Notes.Base.prototype.revertState=function(){this.unserialize(this.getState())},TDS.Notes.Base.prototype.focus=function(){},TDS.Notes.Base.prototype.unfocus=function(){},TDS.Notes.Dialog=function(args){args=args||{},this.dom=args.dom,this.cfg=args.cfg,this._yuiDialog=null,this._impl=args.impl},Messages=window.Messages||{get:function(str){return str}},TDS.Notes.Dialog.prototype.setInstance=function(impl){this._impl=impl},TDS.Notes.Dialog.prototype._onShow=function(){},TDS.Notes.Dialog.prototype.loading=function(){},TDS.Notes.Dialog.prototype.loadingComplete=function(){},TDS.Notes.Dialog.prototype._onBeforeShow=function(){},TDS.Notes.Dialog.prototype._onHide=function(){},TDS.Notes.Dialog.prototype.loadCb=function(response){TDS.Notes.Debug&&console.log("Load Callback for (this, response)",this,response),this.loadingComplete(),this._impl.unserialize(response)&&this._impl.saveState(response)},TDS.Notes.Dialog.prototype.load=function(){var args={id:this.getId(),data:{type:this._impl.type,id:this.getId()},cb:this.loadCb.bind(this)};return TDS.Notes.Debug&&console.log("Loading information for this Notes instance",this,args),TDS.Notes.Events.Load.fire(args),args},TDS.Notes.Dialog.prototype.preSave=function(args){return!0},TDS.Notes.Dialog.prototype.submit=function(){var args={id:this.getId(),data:{type:this._impl.type,comment:this._impl.serialize()},cb:this.saveCb.bind(this)};return this.preSave(args)&&(this._impl.saveState(args.data.comment),TDS.Notes.Debug&&console.log("Saving information for this Notes instance",this,args),TDS.Notes.Events.Save.fire(args),this.close(!0)),args},TDS.Notes.Dialog.prototype.saveCb=function(response){TDS.Notes.Debug&&console.log("Save cb for the notes has been called, (this, response)",this,response)},TDS.Notes.Dialog.prototype.close=function(preventRevert){this._yuiDialog&&this._yuiDialog.hide(),"function"==typeof this.preClose&&this.preClose(),!0!==preventRevert&&this._impl.revertState()},TDS.Notes.Dialog.prototype.open=function(){this._yuiDialog||this.create(),this._yuiDialog.render(document.body),this._yuiDialog.show(),this._impl&&this._impl.focus()},TDS.Notes.Dialog.prototype.getId=function(){if(this.dom)return this.dom.id},TDS.Notes.Dialog.prototype.create=function(){var id=this.getId();{if(id){var dialog=new YAHOO.widget.Dialog(id,{visible:!0,draggable:!1,modal:!0,close:!1,fixedcenter:!0,width:this.cfg.width,height:this.cfg.height,zIndex:1,postmethod:"none"});dialog.setHeader(this.cfg.label||"Comments"),dialog.beforeShowEvent.subscribe(this._onBeforeShow,this,!0),dialog.showEvent.subscribe(this._onShow,this,!0),dialog.hideEvent.subscribe(this._onHide,this,!0);var buttons=[{text:Messages.get("Cancel"),handler:{fn:this.close,scope:this}},{text:Messages.get("Submit and Close"),handler:{fn:this.submit,scope:this},isDefault:!0}];return dialog.cfg.queueProperty("buttons",buttons),YAHOO.util.Dom.addClass(dialog.element,"TDS_Notes_dialog"),YAHOO.util.Dom.addClass(dialog.innerElement,"comment"),YAHOO.util.Dom.addClass(dialog.header,"comment-header"),YAHOO.util.Dom.addClass(dialog.body,"comment-body"),YAHOO.util.Dom.addClass(dialog.form,"comment-form"),this._yuiDialog=dialog,dialog}console.error("Cannot create a dialog without a valid dom element (id, this): ",id,this)}},TDS.Notes.DropDown=function(args){args=args||{},this.comments=args.DropComments||TDS.Comments||[],this.dom=args.dom,this.type=TDS.Notes.Types.DropDown},YAHOO.lang.extend(TDS.Notes.DropDown,TDS.Notes.Base),TDS.Notes.DropDown.prototype.serialize=function(){return this.note.value},TDS.Notes.DropDown.prototype.unserialize=function(response){if("string"==typeof response)return this.note.value=response},TDS.Notes.DropDown.prototype.create=function(){var selectBox=document.createElement("select");selectBox.className="comment-input comment-selectbox";for(var i=0;i<this.comments.length;++i){var commentLine=this.comments[i],option=document.createElement("option");option.text=commentLine,option.value=commentLine,selectBox.appendChild(option)}return document.getElementById("note_container_"+this.dom.id).appendChild(selectBox),this.note=selectBox,this.comments.length>0&&this.saveState(this.comments[0]),selectBox},TDS.Notes.Equation=function(args){args=args||{},this.dom=args.dom,this.type=TDS.Notes.Types.Equation},YAHOO.lang.extend(TDS.Notes.Equation,TDS.Notes.Base),TDS.Notes.Equation.prototype.serialize=function(){return TDS.Notes.Debug&&console.log("What save callback exists here?"),this.note.serializeSettings()},TDS.Notes.Equation.prototype.unserialize=function(response){if(response)return"string"==typeof response&&(response=JSON.parse(response)),TDS.Notes.Debug&&console.log("What is in the response?",response),this.note&&response&&(this.note.remove(),response.containerId="note_container_"+this.dom.id,this.note=new MathJax.Editor.Widget(response)),!0},TDS.Notes.Equation.prototype.create=function(){this.note=new MathJax.Editor.Widget({containerId:"note_container_"+this.dom.id,RestrictKeysToContent:!0,tabs:!0,tabConfig:{Order:["Algebra","Basic"]}})},TDS.Notes.TypeConfig=TDS.Notes.TypeConfig||{Default:{width:"450px",height:"150px"},ScratchPad:{width:"790px",height:"780px"},Equation:{width:"500px",height:"331px",label:"Equation Editor"}},TDS.Notes.Factory=function(cfg){this.setConfig(cfg)},TDS.Notes.Factory.prototype.setConfig=function(cfg){(cfg=cfg||{}).GlobalClass=cfg.GlobalClass||TDS.Notes.Types.TextArea,cfg.GlobalLabel=cfg.GlobalLabel||"Global Comments",TDS.Notes.global=TDS.Notes[cfg.GlobalClass],cfg.DefaultClass=cfg.DefaultClass||TDS.Notes.Types.TextArea,cfg.DefaultLabel=cfg.DefaultLabel||"Comments",TDS.Notes.Debug&&console.log("Setting the Notes Factory config with cfg:",cfg),this.cfg=cfg},TDS.Notes.Factory.prototype.getConfig=function(){return this.cfg},TDS.Notes.Factory.prototype.getDialogConfigForType=function(type){var cfg=JSON.parse(JSON.stringify(TDS.Notes.TypeConfig[type]||TDS.Notes.TypeConfig.Default));return cfg.label=type==TDS.Notes.Types.Global?this.cfg.GlobalLabel:cfg.label?cfg.label:this.cfg.DefaultLabel,cfg},TDS.Notes.Factory.prototype.getNotesType=function(obj){return obj&&obj.NotesType&&TDS.Notes.Types[obj.NotesType]?TDS.Notes.Types[obj.NotesType]:this.cfg.DefaultClass||TDS.Notes.Types.TextArea},TDS.Notes.Factory.prototype.buildNotes=function(obj,id){var type=null;if(obj?"string"==typeof obj?type=obj:obj&&(type=this.getNotesType(obj)):type=TDS.Notes.Types.Global,"function"==typeof TDS.Notes[type])return TDS.Notes.Debug&&console.log("Building notes for (obj, id, type)",id,type),this.createNotesType(id,type);console.error("Cannot build notes with this type: ",type)},TDS.Notes.Factory.prototype.createNotesType=function(id,type){var dom=this.getContainer(id,type),notes=new TDS.Notes[type]({dom:dom});notes.saveState("");var dialog=new TDS.Notes.Dialog({cfg:this.getDialogConfigForType(type),dom:dom,impl:notes});return TDS.Notes.Debug&&console.log("Creating an instance of this notes (id, type, dialog, notes)",id,type,dialog,notes),dialog.create(),notes.create(),dialog},TDS.Notes.Factory.prototype.getContainer=function(id,type){var dom=document.getElementById(id);dom||((dom=document.createElement("form")).id=id,dom.className+="notes_dialog_form notes_dialog_form_"+type,document.body.appendChild(dom));var cId="note_container_"+id,c=document.getElementById(cId);return c||((c=document.createElement("div")).className="notes_dialog_container bd",c.id=cId,dom.appendChild(c)),dom},TDS.Notes.ScratchPad=function(args){args=args||{},this.dom=args.dom,this.type=TDS.Notes.Types.ScratchPad},YAHOO.lang.extend(TDS.Notes.ScratchPad,TDS.Notes.Base),TDS.Notes.ScratchPad.prototype.serialize=function(){return this.note.save()},TDS.Notes.ScratchPad.prototype.unserialize=function(response){if(response)return"string"==typeof response&&response&&(response=JSON.parse(response)),response&&this.note.load("list",response),!0},TDS.Notes.ScratchPad.prototype.create=function(){var SPF=ScratchPad.Factory.getInstance(),cId="note_container_"+this.dom.id;return this.note=SPF.getOrCreateScratchPadById(cId),this.note},TDS.Notes.TextArea=function(args){args=args||{},this.dom=args.dom,this.type=TDS.Notes.Types.TextArea},YAHOO.lang.extend(TDS.Notes.TextArea,TDS.Notes.Base),TDS.Notes.TextArea.prototype.serialize=function(){return this.note.value},TDS.Notes.TextArea.prototype.unserialize=function(response){if("string"==typeof response)return this.note.value=response},TDS.Notes.TextArea.prototype.create=function(){var ta=document.createElement("textarea");return ta.className="comment-input comment-textbox",ta.rows=4,YAHOO.util.Dom.setStyle(ta,"resize","none"),document.getElementById("note_container_"+this.dom.id).appendChild(ta),this.note=ta,this.note},TDS.Notes.TextArea.prototype.unfocus=function(){this.note&&this.note.unfocus()},TDS.Notes.TextArea.prototype.focus=function(){this.note&&this.note.focus()};